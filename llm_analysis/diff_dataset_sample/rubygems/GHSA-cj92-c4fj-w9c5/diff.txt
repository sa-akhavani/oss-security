--- a/lib/mail/network/delivery_methods/file_delivery.rb
+++ b/lib/mail/network/delivery_methods/file_delivery.rb
@@ -9,15 +9,15 @@
       self.settings = { :location => './mails' }.merge!(values)
     end
     attr_accessor :settings
     def deliver!(mail)
       if ::File.respond_to?(:makedirs)
         ::File.makedirs settings[:location]
       else
         ::FileUtils.mkdir_p settings[:location]
       end
       mail.destinations.uniq.each do |to|
-        ::File.open(::File.join(settings[:location], File.basename(to.to_s)), 'a') { |f| "#{f.write(mail.encoded)}\r\n\r\n" }
+        ::File.open(::File.join(settings[:location], to), 'a') { |f| "#{f.write(mail.encoded)}\r\n\r\n" }
       end
     end
   end
 end

--- a/spec/mail/network/delivery_methods/file_delivery_spec.rb
+++ b/spec/mail/network/delivery_methods/file_delivery_spec.rb
@@ -50,24 +50,12 @@
         delivery_method :file, :location => tmpdir
       end
       Mail.deliver do
         from    'roger@moore.com'
         to      '"Long, stupid email address" <mikel@test.lindsaar.net>'
         subject 'invalid RFC2822'
       end
       delivery = File.join(Mail.delivery_method.settings[:location], 'mikel@test.lindsaar.net')
       File.exists?(delivery).should be_true
     end
-    it "should use the base name of the file name to prevent file system traversal" do
-      Mail.defaults do
-        delivery_method :file, :location => tmpdir
-      end
-      Mail.deliver do
-        from    'roger@moore.com'
-        to      '../../../../../../../../../../../tmp/pwn'
-        subject 'evil hacker'
-      end
-      delivery = File.join(Mail.delivery_method.settings[:location], 'pwn')
-      File.exists?(delivery).should be_true
-    end
   end
 end
