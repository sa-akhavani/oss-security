# ====================================================================
# FILE: backend/spec/spec_helper.rb
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 10-80 ---
    10|   lib_name: 'solidus_backend'
    11| )
    12| require 'rails-controller-testing'
    13| require 'rspec-activemodel-mocks'
    14| require 'rspec/rails'
    15| Dir["#{File.dirname(__FILE__)}/support/**/*.rb"].each { |f| require f }
    16| require 'database_cleaner'
    17| require 'with_model'
    18| require 'spree/testing_support/factory_bot'
    19| require 'spree/testing_support/partial_double_verification'
    20| require 'spree/testing_support/authorization_helpers'
    21| require 'spree/testing_support/preferences'
    22| require 'spree/testing_support/controller_requests'
    23| require 'spree/testing_support/flash'
    24| require 'spree/testing_support/url_helpers'
    25| require 'spree/testing_support/order_walkthrough'
    26| require 'spree/testing_support/capybara_ext'
    27| require 'spree/testing_support/precompiled_assets'
    28| require 'spree/testing_support/translations'
    29| require 'spree/testing_support/job_helpers'
    30| require 'capybara-screenshot/rspec'
    31| Capybara.save_path = ENV['CIRCLE_ARTIFACTS'] if ENV['CIRCLE_ARTIFACTS']
    32| Capybara.exact = true
    33| require "selenium/webdriver"
    34| require 'webdrivers'
    35| Capybara.register_driver :selenium_chrome_headless do |app|
    36|   browser_options = ::Selenium::WebDriver::Chrome::Options.new
    37|   browser_options.args << '--headless'
    38|   browser_options.args << '--disable-gpu'
    39|   browser_options.args << '--window-size=1920,1080'
    40|   Capybara::Selenium::Driver.new(app, browser: :chrome, options: browser_options)
    41| end
    42| Capybara.javascript_driver = (ENV['CAPYBARA_DRIVER'] || :selenium_chrome_headless).to_sym
    43| ActionView::Base.raise_on_missing_translations = true
    44| Capybara.default_max_wait_time = ENV['DEFAULT_MAX_WAIT_TIME'].to_f if ENV['DEFAULT_MAX_WAIT_TIME'].present?
    45| ActiveJob::Base.queue_adapter = :test
    46| Spree::TestingSupport::FactoryBot.add_paths_and_load!
    47| RSpec.configure do |config|
    48|   config.color = true
    49|   config.infer_spec_type_from_file_location!
    50|   config.expect_with :rspec do |c|
    51|     c.syntax = :expect
    52|   end
    53|   config.mock_with :rspec do |c|
    54|     c.syntax = :expect
    55|   end
    56|   config.use_transactional_fixtures = true
    57|   config.fixture_path = "spec/fixtures"
    58|   config.before :suite do
    59|     DatabaseCleaner.clean_with :truncation
    60|   end
    61|   config.before do
    62|     Rails.cache.clear
    63|     if RSpec.current_example.metadata[:js] && page.driver.browser.respond_to?(:url_blacklist)
    64|       page.driver.browser.url_blacklist = ['http://fonts.googleapis.com']
    65|     end
    66|   end
    67|   config.include BaseFeatureHelper, type: :feature
    68|   config.include BaseFeatureHelper, type: :system
    69|   config.include FactoryBot::Syntax::Methods
    70|   config.include Spree::TestingSupport::Preferences
    71|   config.include Spree::TestingSupport::UrlHelpers
    72|   config.include Spree::TestingSupport::ControllerRequests, type: :controller
    73|   config.include Spree::TestingSupport::Flash
    74|   config.include Spree::TestingSupport::Translations
    75|   config.include Spree::TestingSupport::JobHelpers
    76|   config.extend WithModel
    77|   config.example_status_persistence_file_path = "./spec/examples.txt"
    78|   config.order = :random
    79|   Kernel.srand config.seed
    80| end


# ====================================================================
# FILE: core/lib/spree/core/validators/email.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-10 ---
     1| module Spree
     2|   class EmailValidator < ActiveModel::EachValidator
     3|     EMAIL_REGEXP = /\A([^@\.]|[^@\.]([^@\s]*)[^@\.])@([^@\s]+\.)+[^@\s]+\z/
     4|     def validate_each(record, attribute, value)
     5|       unless EMAIL_REGEXP.match? value
     6|         record.errors.add(attribute, :invalid, { value: value }.merge!(options))
     7|       end
     8|     end
     9|   end
    10| end


# ====================================================================
# FILE: core/lib/spree/core/version.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-9 ---
     1| module Spree
     2|   VERSION = "2.11.12"
     3|   def self.solidus_version
     4|     VERSION
     5|   end
     6|   def self.solidus_gem_version
     7|     Gem::Version.new(solidus_version)
     8|   end
     9| end


# ====================================================================
# FILE: core/spec/lib/spree/core/validators/email_spec.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 3-47 ---
     3| RSpec.describe Spree::EmailValidator do
     4|   class Tester
     5|     include ActiveModel::Validations
     6|     attr_accessor :email_address
     7|     validates :email_address, 'spree/email' => true
     8|   end
     9|   let(:valid_emails) {
    10|     [
    11|       'valid@email.com',
    12|       'valid@email.com.uk',
    13|       'e@email.com',
    14|       'valid+email@email.com',
    15|       'valid-email@email.com',
    16|       'valid_email@email.com',
    17|       'valid.email@email.com'
    18|     ]
    19|   }
    20|   let(:invalid_emails) {
    21|     [
    22|       'invalid email@email.com',
    23|       '.invalid.email@email.com',
    24|       'invalid.email.@email.com',
    25|       '@email.com',
    26|       '.@email.com',
    27|       'invalidemailemail.com',
    28|       '@invalid.email@email.com',
    29|       'invalid@email@email.com',
    30|       'invalid.email@@email.com'
    31|     ]
    32|   }
    33|   it 'validates valid email addresses' do
    34|     tester = Tester.new
    35|     valid_emails.each do |email|
    36|       tester.email_address = email
    37|       expect(tester.valid?).to be true
    38|     end
    39|   end
    40|   it 'validates invalid email addresses' do
    41|     tester = Tester.new
    42|     invalid_emails.each do |email|
    43|       tester.email_address = email
    44|       expect(tester.valid?).to be false
    45|     end
    46|   end
    47| end

