# ====================================================================
# FILE: lib/global_id/uri/gid.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 35-97 ---
    35|       "gid://#{app}#{path}#{'?' + query if query}"
    36|     end
    37|     protected
    38|       def set_path(path)
    39|         set_model_components(path) unless defined?(@model_name) && @model_id
    40|         super
    41|       end
    42|       def query=(query)
    43|         set_params parse_query_params(query)
    44|         super
    45|       end
    46|       def set_query(query)
    47|         set_params parse_query_params(query)
    48|         super
    49|       end
    50|       def set_params(params)
    51|         @params = params
    52|       end
    53|     private
    54|       COMPONENT = [ :scheme, :app, :model_name, :model_id, :params ].freeze
    55|       PATH_REGEXP = %r(\A/([^/]+)/?([^/]+)?\z)
    56|       def check_host(host)
    57|         validate_component(host)
    58|         super
    59|       end
    60|       def check_path(path)
    61|         validate_component(path)
    62|         set_model_components(path, true)
    63|       end
    64|       def check_scheme(scheme)
    65|         if scheme == 'gid'
    66|           super
    67|         else
    68|           raise URI::BadURIError, "Not a gid:// URI scheme: #{inspect}"
    69|         end
    70|       end
    71|       def set_model_components(path, validate = false)
    72|         _, model_name, model_id = path.match(PATH_REGEXP).to_a
    73|         model_id = CGI.unescape(model_id) if model_id
    74|         validate_component(model_name) && validate_model_id(model_id, model_name) if validate
    75|         @model_name = model_name
    76|         @model_id = model_id
    77|       end
    78|       def validate_component(component)
    79|         return component unless component.blank?
    80|         raise URI::InvalidComponentError,
    81|           "Expected a URI like gid://app/Person/1234: #{inspect}"
    82|       end
    83|       def validate_model_id(model_id, model_name)
    84|         return model_id unless model_id.blank?
    85|         raise MissingModelIdError, "Unable to create a Global ID for " \
    86|           "#{model_name} without a model id."
    87|       end
    88|       def parse_query_params(query)
    89|         Hash[URI.decode_www_form(query)].with_indifferent_access if query
    90|       end
    91|   end
    92|   if respond_to?(:register_scheme)
    93|     register_scheme('GID', GID)
    94|   else
    95|     @@schemes['GID'] = GID
    96|   end
    97| end

