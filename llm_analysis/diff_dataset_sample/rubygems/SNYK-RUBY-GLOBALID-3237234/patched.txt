# ====================================================================
# FILE: lib/global_id/uri/gid.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 35-96 ---
    35|       "gid://#{app}#{path}#{'?' + query if query}"
    36|     end
    37|     protected
    38|       def set_path(path)
    39|         set_model_components(path) unless defined?(@model_name) && @model_id
    40|         super
    41|       end
    42|       def query=(query)
    43|         set_params parse_query_params(query)
    44|         super
    45|       end
    46|       def set_query(query)
    47|         set_params parse_query_params(query)
    48|         super
    49|       end
    50|       def set_params(params)
    51|         @params = params
    52|       end
    53|     private
    54|       COMPONENT = [ :scheme, :app, :model_name, :model_id, :params ].freeze
    55|       def check_host(host)
    56|         validate_component(host)
    57|         super
    58|       end
    59|       def check_path(path)
    60|         validate_component(path)
    61|         set_model_components(path, true)
    62|       end
    63|       def check_scheme(scheme)
    64|         if scheme == 'gid'
    65|           super
    66|         else
    67|           raise URI::BadURIError, "Not a gid:// URI scheme: #{inspect}"
    68|         end
    69|       end
    70|       def set_model_components(path, validate = false)
    71|         _, model_name, model_id = path.split('/', 3)
    72|         validate_component(model_name) && validate_model_id(model_id, model_name) if validate
    73|         model_id = CGI.unescape(model_id) if model_id
    74|         @model_name = model_name
    75|         @model_id = model_id
    76|       end
    77|       def validate_component(component)
    78|         return component unless component.blank?
    79|         raise URI::InvalidComponentError,
    80|           "Expected a URI like gid://app/Person/1234: #{inspect}"
    81|       end
    82|       def validate_model_id(model_id, model_name)
    83|         return model_id unless model_id.blank? || model_id.include?('/')
    84|         raise MissingModelIdError, "Unable to create a Global ID for " \
    85|           "#{model_name} without a model id."
    86|       end
    87|       def parse_query_params(query)
    88|         Hash[URI.decode_www_form(query)].with_indifferent_access if query
    89|       end
    90|   end
    91|   if respond_to?(:register_scheme)
    92|     register_scheme('GID', GID)
    93|   else
    94|     @@schemes['GID'] = GID
    95|   end
    96| end

