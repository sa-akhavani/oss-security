# ====================================================================
# FILE: lib/avo/fields/belongs_to_field.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 93-149 ---
    93|       end
    94|       def reflection
    95|         reflection_for_key(id)
    96|       rescue
    97|         nil
    98|       end
    99|       def relation_model_class
   100|         @resource.model_class
   101|       end
   102|       def label
   103|         value.send(target_resource.class.title)
   104|       end
   105|       def to_permitted_param
   106|         if polymorphic_as.present?
   107|           return ["#{polymorphic_as}_type".to_sym, "#{polymorphic_as}_id".to_sym]
   108|         end
   109|         foreign_key.to_sym
   110|       end
   111|       def fill_field(model, key, value, params)
   112|         return model unless model.methods.include? key.to_sym
   113|         valid_model_class = valid_polymorphic_class params["#{polymorphic_as}_type"]
   114|         if polymorphic_as.present?
   115|           model.send("#{polymorphic_as}_type=", valid_model_class)
   116|           if valid_model_class.blank?
   117|             model.send("#{polymorphic_as}_id=", nil)
   118|           else
   119|             model.send("#{polymorphic_as}_id=", params["#{polymorphic_as}_id"])
   120|           end
   121|         else
   122|           model.send("#{key}=", value)
   123|         end
   124|         model
   125|       end
   126|       def valid_polymorphic_class(possible_class)
   127|         types.find do |type|
   128|           type.to_s == possible_class.to_s
   129|         end
   130|       end
   131|       def database_id
   132|         return "#{polymorphic_as}_type" if polymorphic_as.present?
   133|         foreign_key
   134|       rescue
   135|         id
   136|       end
   137|       def target_resource
   138|         return use_resource if use_resource.present?
   139|         if is_polymorphic?
   140|           if value.present?
   141|             return App.get_resource_by_model_name(value.class)
   142|           else
   143|             return nil
   144|           end
   145|         end
   146|         reflection_key = polymorphic_as || id
   147|         if @model._reflections[reflection_key.to_s].klass.present?
   148|           App.get_resource_by_model_name @model._reflections[reflection_key.to_s].klass.to_s
   149|         elsif @model._reflections[reflection_key.to_s].options[:class_name].present?


# ====================================================================
# FILE: lib/avo/version.rb
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| module Avo
     2|   VERSION = "2.33.3" unless const_defined?(:VERSION)
     3| end

