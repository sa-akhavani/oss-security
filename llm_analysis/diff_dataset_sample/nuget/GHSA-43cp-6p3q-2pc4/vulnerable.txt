# ====================================================================
# FILE: src/HtmlSanitizer/HtmlSanitizer.cs
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 152-199 ---
   152|         public string SanitizeDocument(string html, string baseUrl = "", IMarkupFormatter? outputFormatter = null)
   153|         {
   154|             var parser = HtmlParserFactory();
   155|             using var dom = parser.ParseDocument(html);
   156|             DoSanitize(dom, dom, baseUrl);
   157|             var output = dom.ToHtml(outputFormatter ?? OutputFormatter);
   158|             return output;
   159|         }
   160|         public string SanitizeDocument(Stream html, string baseUrl = "", IMarkupFormatter? outputFormatter = null)
   161|         {
   162|             var parser = HtmlParserFactory();
   163|             using var dom = parser.ParseDocument(html);
   164|             DoSanitize(dom, dom, baseUrl);
   165|             var output = dom.ToHtml(outputFormatter ?? OutputFormatter);
   166|             return output;
   167|         }
   168|         private void RemoveComments(INode context)
   169|         {
   170|             foreach (var comment in GetAllNodes(context).OfType<IComment>().ToList())
   171|             {
   172|                 var e = new RemovingCommentEventArgs(comment);
   173|                 OnRemovingComment(e);
   174|                 if (!e.Cancel)
   175|                     comment.Remove();
   176|             }
   177|         }
   178|         private void DoSanitize(IHtmlDocument dom, IParentNode context, string baseUrl = "")
   179|         {
   180|             foreach (var tag in context.QuerySelectorAll("*").Where(t => !IsAllowedTag(t)).ToList())
   181|             {
   182|                 RemoveTag(tag, RemoveReason.NotAllowedTag);
   183|             }
   184|             SanitizeStyleSheets(dom, baseUrl);
   185|             foreach (var tag in context.QuerySelectorAll("*").ToList())
   186|             {
   187|                 foreach (var attribute in tag.Attributes.Where(a => !IsAllowedAttribute(a)).ToList())
   188|                 {
   189|                     RemoveAttribute(tag, attribute, RemoveReason.NotAllowedAttribute);
   190|                 }
   191|                 foreach (var attribute in tag.Attributes.Where(IsUriAttribute).ToList())
   192|                 {
   193|                     var url = SanitizeUrl(tag, attribute.Value, baseUrl);
   194|                     if (url == null)
   195|                         RemoveAttribute(tag, attribute, RemoveReason.NotAllowedUrlValue);
   196|                     else
   197|                         tag.SetAttribute(attribute.Name, url);
   198|                 }
   199|                 var oldStyleEmpty = string.IsNullOrEmpty(tag.GetAttribute("style"));

