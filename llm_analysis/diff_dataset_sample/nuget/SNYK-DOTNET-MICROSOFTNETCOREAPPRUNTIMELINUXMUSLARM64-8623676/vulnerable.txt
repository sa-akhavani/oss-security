# ====================================================================
# FILE: .devcontainer/android/postStartCommand.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-2 ---
     1| set -e
     2| nohup bash -c 'flock -n /var/lock/emulator.lock -c '\''${ANDROID_SDK_ROOT}/emulator/emulator -avd ${EMULATOR_NAME_X64} -no-window -no-audio -no-snapstorage'\''&' >/dev/null 2>&1


# ====================================================================
# FILE: .devcontainer/scripts/onCreateCommand.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| set -e
     2| function wasm_common() {
     3|     case "$1" in
     4|     wasm)
     5|         ./build.sh mono+libs -os browser -c Release
     6|         ;;
     7|     wasm-multithreaded)
     8|         ./build.sh mono+libs -os browser -c Release /p:WasmEnableThreads=true
     9|         ;;
    10|     *)
    11|     ./dotnet.sh tool install dotnet-serve --version 1.10.172 --tool-path ./.dotnet-tools-global
    12|     ;;
    13|     esac
    14| }
    15| opt=$1
    16| case "$opt" in
    17|     libraries)
    18|         ./build.sh libs+clr -rc Release
    19|         ./build.sh libs.tests -restore
    20|     ;;
    21|     android)
    22|         ./build.sh mono+libs -os android
    23|         ./build.sh libs.tests -restore
    24|     ;;
    25|     wasm)
    26|         wasm_common $opt
    27|     ;;
    28|     wasm-multithreaded)
    29|         wasm_common $opt
    30|     ;;
    31| esac
    32| git rev-parse HEAD > ./artifacts/prebuild.sha


# ====================================================================
# FILE: .devcontainer/scripts/postCreateCommand.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-8 ---
     1| set -e
     2| opt=$1
     3| case "$opt" in
     4|     android)
     5|         ${ANDROID_SDK_ROOT}/cmdline-tools/cmdline-tools/bin/avdmanager -s create avd --name ${EMULATOR_NAME_X64} --package "system-images;android-${SDK_API_LEVEL};default;x86_64"
     6|     ;;
     7| esac
     8| git reset --hard $(cat ./artifacts/prebuild.sha)


# ====================================================================
# FILE: docs/design/datacontracts/contract_csharp_api_design.cs
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-271 ---
     1| namespace DataContracts
     2| {
     3|     class DataContractTypeAttribute : System.Attribute {}
     4|     class DataContractLayoutAttribute : System.Attribute
     5|     {
     6|         public DataContractLayoutAttribute(uint version, uint typeSize) { Version = version; TypeSize = typeSize; }
     7|         public uint Version;
     8|         public uint TypeSize;
     9|     }
    10|     class DataContractGlobalsAttribute : System.Attribute
    11|     {
    12|         public DataContractGlobalsAttribute(string name, uint version) { Name = name; Version = version; }
    13|         public string Name;
    14|         public uint Version;
    15|     }
    16|     class DataContractAlgorithmAttribute : System.Attribute
    17|     {
    18|         public DataContractAlgorithmAttribute(params uint []version) { Name = name; Version = version; }
    19|         public uint[] Version;
    20|     }
    21|     struct TargetPointer
    22|     {
    23|         public ulong Value;
    24|         public static TargetPointer Null = new TargetPointer(0);
    25|     }
    26|     public readonly struct TargetSpan
    27|     {
    28|         public TargetSpan(TargetPointer address, ulong size)
    29|         {
    30|             Address = address;
    31|             Size = size;
    32|         }
    33|         public TargetPointer Address { get; }
    34|         public ulong Size { get; }
    35|     }
    36|     struct TargetNInt
    37|     {
    38|         public long Value;
    39|     }
    40|     struct TargetNUInt
    41|     {
    42|         public ulong Value;
    43|     }
    44|     enum FieldType
    45|     {
    46|         Int8Type,
    47|         UInt8Type,
    48|         Int16Type,
    49|         UInt16Type,
    50|         Int32Type,
    51|         UInt32Type,
    52|         Int64Type,
    53|         UInt64Type,
    54|         NIntType,
    55|         NUIntType,
    56|         PointerType,
    57|     }
    58|     struct FieldLayout
    59|     {
    60|         public int Offset;
    61|         public FieldType Type;
    62|     }
    63|     interface IContract
    64|     {
    65|         string Name { get; }
    66|         uint Version { get; }
    67|     }
    68|     sealed class Target
    69|     {
    70|         public int CurrentEpoch = 0;
    71|         public T Read<T>(ulong address) where T : unmanaged, IBinaryInteger<T>, IMinMaxValue<T>;
    72|         TargetPointer ReadPointer(ulong address);
    73|         byte[] ReadByteArray(TargetPointer pointer, ulong size);
    74|         void FillByteArray(TargetPointer pointer, byte[] array, ulong size);
    75|         TargetPointer GetTargetPointerForField(TargetPointer pointer, FieldLayout fieldLayout);
    76|         T ReadGlobal<T>(string globalName) where T : unmanaged, IBinaryInteger<T>, IMinMaxValue<T>;
    77|         TargetPointer ReadGlobalPointer(string globalName);
    78|         Contracts.Registry Contracts { get; }
    79|     }
    80|     namespace Contracts
    81|     {
    82|         class Registry
    83|         {
    84|             MethodTableContract MethodTableContract;
    85|         }
    86|         class DataStructureContract
    87|         {
    88|             string MethodTableName {get;}
    89|             List<Tuple<string, FieldLayout>> FieldData;
    90|         }
    91|         interface MethodTableContract : IContract
    92|         {
    93|             public virtual int DynamicTypeID(TargetPointer methodTablePointer) { throw new NotImplementedException(); }
    94|             public virtual int BaseSize(TargetPointer methodTablePointer) { throw new NotImplementedException(); }
    95|         }
    96|     }
    97|     namespace ContractImplementation
    98|     {
    99|         static class PredefinedContracts
   100|         {
   101|             public static IContract GetContract(string name, uint version, Target target)
   102|             {
   103|             }
   104|         }
   105|         [DataContractGlobals("FeatureFlags", 1)]
   106|         public class FeatureFlags_1
   107|         {
   108|             public const int FeatureComInterop = 0;
   109|         }
   110|         [DataContractGlobals("FeatureFlags", 2)]
   111|         public class FeatureFlags_2
   112|         {
   113|             public const int FeatureComInterop = 1;
   114|         }
   115|         [DataContractAlgorithm(1)]
   116|         readonly struct MethodTableContract_1 : Contracts.MethodTableContract
   117|         {
   118|             DataContracts.Target Target;
   119|             readonly uint ContractVersion;
   120|             public MethodTableContract_1(DataContracts.Target target, uint contractVersion) { Target = target; ContractVersion = contractVersion; }
   121|             public virtual int DynamicTypeID(TargetPointer methodTablePointer) { return new MethodTable(_target, methodTablePointer).dynamicTypeId; }
   122|             public virtual int BaseSize(TargetPointer methodTablePointer) { return new MethodTable(_target, methodTablePointer).baseSizeAndFlags & 0x3FFFFFFF; }
   123|         }
   124|         [DataContractAlgorithm(2, 3)]
   125|         readonly struct MethodTableContract_2 : Contracts.MethodTableContract
   126|         {
   127|             DataContracts.Target Target;
   128|             readonly uint ContractVersion;
   129|             public MethodTableContract_2(DataContracts.Target target, uint contractVersion) { Target = target; }
   130|             public virtual int DynamicTypeID(TargetPointer methodTablePointer)
   131|             {
   132|                 throw new NotImplementedException();
   133|             }
   134|             public virtual int BaseSize(TargetPointer methodTablePointer)
   135|             {
   136|                 return new MethodTable(_target, methodTablePointer).baseSizeAndFlags & ((ContractVersion == 3) ? 0x1FFFFFFF : 0x3FFFFFFF);
   137|             }
   138|         }
   139|         [DataContractType]
   140|         partial struct MethodTable
   141|         {
   142|             partial void Get_dynamicTypeId_optional(ref int value);
   143|             partial void Get_baseSizeAndFlags(ref int value);
   144|             [DataContractLayout(1, 8)]
   145|             public class DataLayout1
   146|             {
   147|                 [FieldOffset(0)]
   148|                 public int dynamicTypeId;
   149|                 [FieldOffset(4)]
   150|                 public int baseSize;
   151|             }
   152|             [DataContractLayout(2, 4)]
   153|             public class DataLayout2
   154|             {
   155|                 [FieldOffset(0)]
   156|                 public int baseSize;
   157|             }
   158|             public uint TypeSize => _layout.TypeSize;
   159|             void Get_dynamicTypeId_optional(ref int value)
   160|             {
   161|                 value = dynamicTypeId;
   162|             }
   163|             void Get_baseSizeAndFlags(ref int value)
   164|             {
   165|                 value = baseSizeAndFlags;
   166|             }
   167|             private static int LayoutIndex = DataContracts.Target.RegisterLayout(MethodTableLayout.GetLayoutByTarget);
   168|             public readonly TargetPointer Pointer;
   169|             private int _epoch;
   170|             private readonly MethodTableLayout _layout;
   171|             public MethodTable(DataContracts.Target target, TargetPointer pointer)
   172|             {
   173|                 Pointer = pointer;
   174|                 _epoch = Int32.MinInt;
   175|                 _layout = target.GetLayoutByIndex(LayoutIndex);
   176|             }
   177|             class MethodTableLayout
   178|             {
   179|                 public static object GetLayoutByTarget(DataContracts.Target target)
   180|                 {
   181|                     return new MethodTableLayout(target);
   182|                 }
   183|                 public readonly uint TypeSize;
   184|                 private MethodTableLayout(DataContracts.Target target)
   185|                 {
   186|                     Target = target;
   187|                     TypeSize = target.Contract.GetTypeSize("MethodTable");
   188|                     if (!_target.Contract.TryGetFieldLayout("MethodTable", "dynamicTypeId", out var dynamicTypeIdField))
   189|                     {
   190|                         dynamicTypeId_Offset = -1;
   191|                     }
   192|                     else
   193|                     {
   194|                         if (dynamicTypeIdField.Type != FieldType.Int32Type)
   195|                             dynamicTypeId_Offset = -2;
   196|                         else
   197|                             dynamicTypeId_Offset = dynamicTypeIdField.Offset;
   198|                     }
   199|                     if (!_target.Contract.TryGetFieldLayout("MethodTable", "baseSizeAndFlags", out var baseSizeAndFlagsField))
   200|                     {
   201|                         baseSizeAndFlags_Offset = -1;
   202|                     }
   203|                     else
   204|                     {
   205|                         if (baseSizeAndFlagsField.Type != FieldType.Int32Type)
   206|                             baseSizeAndFlags_Offset = -2;
   207|                         else
   208|                             baseSizeAndFlags_Offset = baseSizeAndFlagsField.Offset;
   209|                     }
   210|                 }
   211|                 public readonly DataContracts.Target Target;
   212|                 int dynamicTypeId_Offset;
   213|                 public int dynamicTypeId(TargetPointer pointer)
   214|                 {
   215|                     if (dynamicTypeId_Offset == -1)
   216|                     {
   217|                         throw new Exception("MethodTable has no field dynamicTypeId");
   218|                     }
   219|                     if (dynamicTypeId_Offset == -2)
   220|                     {
   221|                         throw new Exception("MethodTable field dynamicTypeId does not have type int32");
   222|                     }
   223|                     return _target.ReadInt32(pointer + dynamicTypeId_Offset);
   224|                 }
   225|                 public bool Has_dynamicTypeId => dynamicTypeId_Offset >= 0;
   226|                 int baseSizeAndFlags_Offset;
   227|                 public int baseSizeAndFlags(TargetPointer pointer)
   228|                 {
   229|                     if (baseSizeAndFlags_Offset == -1)
   230|                     {
   231|                         throw new Exception("MethodTable has no field baseSizeAndFlags");
   232|                     }
   233|                     if (baseSizeAndFlags_Offset == -2)
   234|                     {
   235|                         throw new Exception("MethodTable field baseSizeAndFlags does not have type int32");
   236|                     }
   237|                     return _target.ReadInt32(pointer + baseSizeAndFlags_Offset);
   238|                 }
   239|             }
   240|             private int _dynamicTypeId;
   241|             public int dynamicTypeId
   242|             {
   243|                 get
   244|                 {
   245|                     int currentEpoch = _layout.Target.CurrentEpoch;
   246|                     if (_epoch != currentEpoch)
   247|                     {
   248|                         _dynamicTypeId = _layout.dynamicTypeId(Pointer);
   249|                         _epoch = currentEpoch;
   250|                     }
   251|                     return _dynamicTypeId;
   252|                 }
   253|             }
   254|             public bool Has_dynamicTypeId => layout.Has_dynamicTypeId;
   255|             private int _baseSizeAndFlags;
   256|             public int baseSizeAndFlags
   257|             {
   258|                 get
   259|                 {
   260|                     int currentEpoch = _layout.Target.CurrentEpoch;
   261|                     if (_epoch != currentEpoch)
   262|                     {
   263|                         _baseSizeAndFlags = _layout.baseSizeAndFlags(Pointer);
   264|                         _epoch = currentEpoch;
   265|                     }
   266|                     return _baseSizeAndFlags;
   267|                 }
   268|             }
   269|         }
   270|     }
   271| }


# ====================================================================
# FILE: eng/build.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-499 ---
     1| set -ue
     2| source="${BASH_SOURCE[0]}"
     3| while [[ -h "$source" ]]; do
     4|   scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
     5|   source="$(readlink "$source")"
     6|   [[ $source != /* ]] && source="$scriptroot/$source"
     7| done
     8| scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
     9| usage()
    10| {
    11|   echo "Common settings:"
    12|   echo "  --arch (-a)                     Target platform: x86, x64, arm, armv6, armel, arm64, loongarch64, riscv64, s390x, ppc64le or wasm."
    13|   echo "                                  [Default: Your machine's architecture.]"
    14|   echo "  --binaryLog (-bl)               Output binary log."
    15|   echo "  --cross                         Optional argument to signify cross compilation."
    16|   echo "  --configuration (-c)            Build configuration: Debug, Release or Checked."
    17|   echo "                                  Checked is exclusive to the CLR subset. It is the same as Debug, except code is"
    18|   echo "                                  compiled with optimizations enabled."
    19|   echo "                                  [Default: Debug]"
    20|   echo "  --help (-h)                     Print help and exit."
    21|   echo "  --hostConfiguration (-hc)       Host build configuration: Debug, Release or Checked."
    22|   echo "                                  [Default: Debug]"
    23|   echo "  --librariesConfiguration (-lc)  Libraries build configuration: Debug or Release."
    24|   echo "                                  [Default: Debug]"
    25|   echo "  --os                            Target operating system: windows, linux, freebsd, osx, maccatalyst, tvos,"
    26|   echo "                                  tvossimulator, ios, iossimulator, android, browser, wasi, netbsd, illumos, solaris"
    27|   echo "                                  linux-musl, linux-bionic, tizen, or haiku."
    28|   echo "                                  [Default: Your machine's OS.]"
    29|   echo "  --outputrid <rid>               Optional argument that overrides the target rid name."
    30|   echo "  --projects <value>              Project or solution file(s) to build."
    31|   echo "  --runtimeConfiguration (-rc)    Runtime build configuration: Debug, Release or Checked."
    32|   echo "                                  Checked is exclusive to the CLR runtime. It is the same as Debug, except code is"
    33|   echo "                                  compiled with optimizations enabled."
    34|   echo "                                  [Default: Debug]"
    35|   echo "  -runtimeFlavor (-rf)            Runtime flavor: CoreCLR or Mono."
    36|   echo "                                  [Default: CoreCLR]"
    37|   echo "  --subset (-s)                   Build a subset, print available subsets with -subset help."
    38|   echo "                                 '--subset' can be omitted if the subset is given as the first argument."
    39|   echo "                                  [Default: Builds the entire repo.]"
    40|   echo "  --usemonoruntime                Product a .NET runtime with Mono as the underlying runtime."
    41|   echo "  --verbosity (-v)                MSBuild verbosity: q[uiet], m[inimal], n[ormal], d[etailed], and diag[nostic]."
    42|   echo "                                  [Default: Minimal]"
    43|   echo ""
    44|   echo "Actions (defaults to --restore --build):"
    45|   echo "  --build (-b)               Build all source projects."
    46|   echo "                             This assumes --restore has been run already."
    47|   echo "  --clean                    Clean the solution."
    48|   echo "  --pack                     Package build outputs into NuGet packages."
    49|   echo "  --publish                  Publish artifacts (e.g. symbols)."
    50|   echo "                             This assumes --build has been run already."
    51|   echo "  --rebuild                  Rebuild all source projects."
    52|   echo "  --restore (-r)             Restore dependencies."
    53|   echo "  --sign                     Sign build outputs."
    54|   echo "  --test (-t)                Incrementally builds and runs tests."
    55|   echo "                             Use in conjunction with --testnobuild to only run tests."
    56|   echo ""
    57|   echo "Libraries settings:"
    58|   echo "  --allconfigurations        Build packages for all build configurations."
    59|   echo "  --coverage                 Collect code coverage when testing."
    60|   echo "  --framework (-f)           Build framework: net9.0 or net48."
    61|   echo "                             [Default: net9.0]"
    62|   echo "  --testnobuild              Skip building tests when invoking -test."
    63|   echo "  --testscope                Test scope, allowed values: innerloop, outerloop, all."
    64|   echo ""
    65|   echo "Native build settings:"
    66|   echo "  --clang                    Optional argument to build using clang in PATH (default)."
    67|   echo "  --clangx                   Optional argument to build using clang version x (used for Clang 7 and newer)."
    68|   echo "  --clangx.y                 Optional argument to build using clang version x.y (used for Clang 6 and older)."
    69|   echo "  --cmakeargs                User-settable additional arguments passed to CMake."
    70|   echo "  --gcc                      Optional argument to build using gcc in PATH (default)."
    71|   echo "  --gccx.y                   Optional argument to build using gcc version x.y."
    72|   echo "  --portablebuild            Optional argument: set to false to force a non-portable build."
    73|   echo "  --keepnativesymbols        Optional argument: set to true to keep native symbols/debuginfo in generated binaries."
    74|   echo "  --ninja                    Optional argument: set to true to use Ninja instead of Make to run the native build."
    75|   echo "  --pgoinstrument            Optional argument: build PGO-instrumented runtime"
    76|   echo "  --fsanitize                Optional argument: Specify native sanitizers to instrument the native build with. Supported values are: 'address'."
    77|   echo ""
    78|   echo "Command line arguments starting with '/p:' are passed through to MSBuild."
    79|   echo "Arguments can also be passed in with a single hyphen."
    80|   echo ""
    81|   echo "Here are some quick examples. These assume you are on a Linux x64 machine:"
    82|   echo ""
    83|   echo "* Build CoreCLR for Linux x64 on Release configuration:"
    84|   echo "./build.sh clr -c release"
    85|   echo ""
    86|   echo "* Build Debug libraries with a Release runtime for Linux x64."
    87|   echo "./build.sh clr+libs -rc release"
    88|   echo ""
    89|   echo "* Build Release libraries and their tests with a Checked runtime for Linux x64, and run the tests."
    90|   echo "./build.sh clr+libs+libs.tests -rc checked -lc release -test"
    91|   echo ""
    92|   echo "* Build CoreCLR for Linux x64 on Debug configuration using Clang 9."
    93|   echo "./build.sh clr -clang9"
    94|   echo ""
    95|   echo "* Build CoreCLR for Linux x64 on Debug configuration using GCC 8.4."
    96|   echo "./build.sh clr -gcc8.4"
    97|   echo ""
    98|   echo "* Build CoreCLR for Linux x64 using extra compiler flags (-fstack-clash-protection)."
    99|   echo "EXTRA_CFLAGS=-fstack-clash-protection EXTRA_CXXFLAGS=-fstack-clash-protection ./build.sh clr"
   100|   echo ""
   101|   echo "* Cross-compile CoreCLR runtime for Linux ARM64 on Release configuration."
   102|   echo "./build.sh clr.runtime -arch arm64 -c release -cross"
   103|   echo ""
   104|   echo "However, for this example, you need to already have ROOTFS_DIR set up."
   105|   echo "Further information on this can be found here:"
   106|   echo "https://github.com/dotnet/runtime/blob/main/docs/workflow/building/coreclr/linux-instructions.md"
   107|   echo ""
   108|   echo "* Build Mono runtime for Linux x64 on Release configuration."
   109|   echo "./build.sh mono -c release"
   110|   echo ""
   111|   echo "* Build Release coreclr corelib, crossgen corelib and update Debug libraries testhost to run test on an updated corelib."
   112|   echo "./build.sh clr.corelib+clr.nativecorelib+libs.pretest -rc release"
   113|   echo ""
   114|   echo "* Build Debug mono corelib and update Release libraries testhost to run test on an updated corelib."
   115|   echo "./build.sh mono.corelib+libs.pretest -rc debug -c release"
   116|   echo ""
   117|   echo ""
   118|   echo "For more general information, check out https://github.com/dotnet/runtime/blob/main/docs/workflow/README.md"
   119| }
   120| initDistroRid()
   121| {
   122|     source "$scriptroot"/common/native/init-distro-rid.sh
   123|     local passedRootfsDir=""
   124|     local targetOs="$1"
   125|     local targetArch="$2"
   126|     local isCrossBuild="$3"
   127|     if [[ $isCrossBuild == 1 && "$targetOs" != "osx" && "$targetOs" != "ios" && "$targetOs" != "iossimulator" && "$targetOs" != "tvos" && "$targetOs" != "tvossimulator" && "$targetOs" != "maccatalyst" ]]; then
   128|         passedRootfsDir=${ROOTFS_DIR}
   129|     fi
   130|     initDistroRidGlobal "${targetOs}" "${targetArch}" "${passedRootfsDir}"
   131| }
   132| showSubsetHelp()
   133| {
   134|   "$scriptroot/common/build.sh" "-restore" "-build" "/p:Subset=help" "/clp:nosummary /tl:false"
   135| }
   136| arguments=''
   137| cmakeargs=''
   138| extraargs=''
   139| crossBuild=0
   140| portableBuild=1
   141| source $scriptroot/common/native/init-os-and-arch.sh
   142| hostArch=$arch
   143| declare -a actions=("b" "build" "r" "restore" "rebuild" "testnobuild" "sign" "publish" "clean")
   144| actInt=($(comm -12 <(printf '%s\n' "${actions[@]/#/-}" | sort) <(printf '%s\n' "${@/#--/-}" | sort)))
   145| firstArgumentChecked=0
   146| while [[ $# > 0 ]]; do
   147|   opt="$(echo "${1/#--/-}" | tr "[:upper:]" "[:lower:]")"
   148|   if [[ $firstArgumentChecked -eq 0 && $opt =~ ^[a-zA-Z.+]+$ ]]; then
   149|     if [[ "$opt" == "help" ]]; then
   150|       showSubsetHelp
   151|       exit 0
   152|     fi
   153|     arguments="$arguments /p:Subset=$1"
   154|     shift 1
   155|     continue
   156|   fi
   157|   firstArgumentChecked=1
   158|   case "$opt" in
   159|      -help|-h|-\?|/?)
   160|       usage
   161|       exit 0
   162|       ;;
   163|      -subset|-s)
   164|       if [ -z ${2+x} ]; then
   165|         showSubsetHelp
   166|         exit 0
   167|       else
   168|         passedSubset="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   169|         if [[ "$passedSubset" == "help" ]]; then
   170|           showSubsetHelp
   171|           exit 0
   172|         fi
   173|         arguments="$arguments /p:Subset=$2"
   174|         shift 2
   175|       fi
   176|       ;;
   177|      -arch|-a)
   178|       if [ -z ${2+x} ]; then
   179|         echo "No architecture supplied. See help (--help) for supported architectures." 1>&2
   180|         exit 1
   181|       fi
   182|       passedArch="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   183|       case "$passedArch" in
   184|         x64|x86|arm|armv6|armel|arm64|loongarch64|riscv64|s390x|ppc64le|wasm)
   185|           arch=$passedArch
   186|           ;;
   187|         *)
   188|           echo "Unsupported target architecture '$2'."
   189|           echo "The allowed values are x86, x64, arm, armv6, armel, arm64, loongarch64, riscv64, s390x, ppc64le and wasm."
   190|           exit 1
   191|           ;;
   192|       esac
   193|       shift 2
   194|       ;;
   195|      -configuration|-c)
   196|       if [ -z ${2+x} ]; then
   197|         echo "No configuration supplied. See help (--help) for supported configurations." 1>&2
   198|         exit 1
   199|       fi
   200|       passedConfig="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   201|       case "$passedConfig" in
   202|         debug|release|checked)
   203|           val="$(tr '[:lower:]' '[:upper:]' <<< ${passedConfig:0:1})${passedConfig:1}"
   204|           ;;
   205|         *)
   206|           echo "Unsupported target configuration '$2'."
   207|           echo "The allowed values are Debug, Release, and Checked."
   208|           exit 1
   209|           ;;
   210|       esac
   211|       arguments="$arguments -configuration $val"
   212|       shift 2
   213|       ;;
   214|      -framework|-f)
   215|       if [ -z ${2+x} ]; then
   216|         echo "No framework supplied. See help (--help) for supported frameworks." 1>&2
   217|         exit 1
   218|       fi
   219|       val="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   220|       arguments="$arguments /p:BuildTargetFramework=$val"
   221|       shift 2
   222|       ;;
   223|      -os)
   224|       if [ -z ${2+x} ]; then
   225|         echo "No target operating system supplied. See help (--help) for supported target operating systems." 1>&2
   226|         exit 1
   227|       fi
   228|       passedOS="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   229|       case "$passedOS" in
   230|         windows)
   231|           os="windows" ;;
   232|         linux)
   233|           os="linux" ;;
   234|         freebsd)
   235|           os="freebsd" ;;
   236|         osx)
   237|           os="osx" ;;
   238|         maccatalyst)
   239|           os="maccatalyst" ;;
   240|         tvos)
   241|           os="tvos" ;;
   242|         tvossimulator)
   243|           os="tvossimulator" ;;
   244|         ios)
   245|           os="ios" ;;
   246|         iossimulator)
   247|           os="iossimulator" ;;
   248|         android)
   249|           os="android" ;;
   250|         browser)
   251|           os="browser" ;;
   252|         wasi)
   253|           os="wasi" ;;
   254|         illumos)
   255|           os="illumos" ;;
   256|         solaris)
   257|           os="solaris" ;;
   258|         linux-bionic)
   259|           os="linux"
   260|           __PortableTargetOS=linux-bionic
   261|           ;;
   262|         linux-musl)
   263|           os="linux"
   264|           __PortableTargetOS=linux-musl
   265|           ;;
   266|         haiku)
   267|           os="haiku" ;;
   268|         *)
   269|           echo "Unsupported target OS '$2'."
   270|           echo "Try 'build.sh --help' for values supported by '--os'."
   271|           exit 1
   272|           ;;
   273|       esac
   274|       arguments="$arguments /p:TargetOS=$os"
   275|       shift 2
   276|       ;;
   277|      -allconfigurations)
   278|       arguments="$arguments /p:BuildAllConfigurations=true"
   279|       shift 1
   280|       ;;
   281|      -testscope)
   282|       if [ -z ${2+x} ]; then
   283|         echo "No test scope supplied. See help (--help) for supported test scope values." 1>&2
   284|         exit 1
   285|       fi
   286|       arguments="$arguments /p:TestScope=$2"
   287|       shift 2
   288|       ;;
   289|      -testnobuild)
   290|       arguments="$arguments /p:TestNoBuild=true"
   291|       shift 1
   292|       ;;
   293|      -coverage)
   294|       arguments="$arguments /p:Coverage=true"
   295|       shift 1
   296|       ;;
   297|      -runtimeconfiguration|-rc)
   298|       if [ -z ${2+x} ]; then
   299|         echo "No runtime configuration supplied. See help (--help) for supported runtime configurations." 1>&2
   300|         exit 1
   301|       fi
   302|       passedRuntimeConf="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   303|       case "$passedRuntimeConf" in
   304|         debug|release|checked)
   305|           val="$(tr '[:lower:]' '[:upper:]' <<< ${passedRuntimeConf:0:1})${passedRuntimeConf:1}"
   306|           ;;
   307|         *)
   308|           echo "Unsupported runtime configuration '$2'."
   309|           echo "The allowed values are Debug, Release, and Checked."
   310|           exit 1
   311|           ;;
   312|       esac
   313|       arguments="$arguments /p:RuntimeConfiguration=$val"
   314|       shift 2
   315|       ;;
   316|      -runtimeflavor|-rf)
   317|       if [ -z ${2+x} ]; then
   318|         echo "No runtime flavor supplied. See help (--help) for supported runtime flavors." 1>&2
   319|         exit 1
   320|       fi
   321|       passedRuntimeFlav="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   322|       case "$passedRuntimeFlav" in
   323|         coreclr|mono)
   324|           val="$(tr '[:lower:]' '[:upper:]' <<< ${passedRuntimeFlav:0:1})${passedRuntimeFlav:1}"
   325|           ;;
   326|         *)
   327|           echo "Unsupported runtime flavor '$2'."
   328|           echo "The allowed values are CoreCLR and Mono."
   329|           exit 1
   330|           ;;
   331|       esac
   332|       arguments="$arguments /p:RuntimeFlavor=$val"
   333|       shift 2
   334|       ;;
   335|      -usemonoruntime)
   336|       arguments="$arguments /p:PrimaryRuntimeFlavor=Mono"
   337|       shift 1
   338|       ;;
   339|      -librariesconfiguration|-lc)
   340|       if [ -z ${2+x} ]; then
   341|         echo "No libraries configuration supplied. See help (--help) for supported libraries configurations." 1>&2
   342|         exit 1
   343|       fi
   344|       passedLibConf="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   345|       case "$passedLibConf" in
   346|         debug|release)
   347|           val="$(tr '[:lower:]' '[:upper:]' <<< ${passedLibConf:0:1})${passedLibConf:1}"
   348|           ;;
   349|         *)
   350|           echo "Unsupported libraries configuration '$2'."
   351|           echo "The allowed values are Debug and Release."
   352|           exit 1
   353|           ;;
   354|       esac
   355|       arguments="$arguments /p:LibrariesConfiguration=$val"
   356|       shift 2
   357|       ;;
   358|      -hostconfiguration|-hc)
   359|       if [ -z ${2+x} ]; then
   360|         echo "No host configuration supplied. See help (--help) for supported host configurations." 1>&2
   361|         exit 1
   362|       fi
   363|       passedHostConf="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   364|       case "$passedHostConf" in
   365|         debug|release|checked)
   366|           val="$(tr '[:lower:]' '[:upper:]' <<< ${passedHostConf:0:1})${passedHostConf:1}"
   367|           ;;
   368|         *)
   369|           echo "Unsupported host configuration '$2'."
   370|           echo "The allowed values are Debug, Release, and Checked."
   371|           exit 1
   372|           ;;
   373|       esac
   374|       arguments="$arguments /p:HostConfiguration=$val"
   375|       shift 2
   376|       ;;
   377|      -cross)
   378|       crossBuild=1
   379|       arguments="$arguments /p:CrossBuild=True"
   380|       shift 1
   381|       ;;
   382|      *crossbuild=true*)
   383|       crossBuild=1
   384|       extraargs="$extraargs $1"
   385|       shift 1
   386|       ;;
   387|      -clang*)
   388|       compiler="${opt/#-/}" # -clang-9 => clang-9 or clang-9 => (unchanged)
   389|       arguments="$arguments /p:Compiler=$compiler /p:CppCompilerAndLinker=$compiler"
   390|       shift 1
   391|       ;;
   392|      -cmakeargs)
   393|       if [ -z ${2+x} ]; then
   394|         echo "No cmake args supplied." 1>&2
   395|         exit 1
   396|       fi
   397|       cmakeargs="${cmakeargs} $2"
   398|       shift 2
   399|       ;;
   400|      -gcc*)
   401|       compiler="${opt/#-/}" # -gcc-9 => gcc-9 or gcc-9 => (unchanged)
   402|       arguments="$arguments /p:Compiler=$compiler /p:CppCompilerAndLinker=$compiler"
   403|       shift 1
   404|       ;;
   405|      -outputrid)
   406|       if [ -z ${2+x} ]; then
   407|         echo "No value for outputrid is supplied. See help (--help) for supported values." 1>&2
   408|         exit 1
   409|       fi
   410|       arguments="$arguments /p:OutputRID=$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   411|       shift 2
   412|       ;;
   413|      -portablebuild)
   414|       if [ -z ${2+x} ]; then
   415|         echo "No value for portablebuild is supplied. See help (--help) for supported values." 1>&2
   416|         exit 1
   417|       fi
   418|       passedPortable="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   419|       if [ "$passedPortable" = false ]; then
   420|         portableBuild=0
   421|         arguments="$arguments /p:PortableBuild=false"
   422|       fi
   423|       shift 2
   424|       ;;
   425|      -keepnativesymbols)
   426|       if [ -z ${2+x} ]; then
   427|         echo "No value for keepNativeSymbols is supplied. See help (--help) for supported values." 1>&2
   428|         exit 1
   429|       fi
   430|       passedKeepNativeSymbols="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   431|       if [ "$passedKeepNativeSymbols" = true ]; then
   432|         arguments="$arguments /p:KeepNativeSymbols=true"
   433|       fi
   434|       shift 2
   435|       ;;
   436|       -ninja)
   437|       if [ -z ${2+x} ]; then
   438|         arguments="$arguments /p:Ninja=true"
   439|         shift 1
   440|       else
   441|         ninja="$(echo "$2" | tr "[:upper:]" "[:lower:]")"
   442|         if [ "$ninja" = true ]; then
   443|           arguments="$arguments /p:Ninja=true"
   444|           shift 2
   445|         elif [ "$ninja" = false ]; then
   446|           arguments="$arguments /p:Ninja=false"
   447|           shift 2
   448|         else
   449|           arguments="$arguments /p:Ninja=true"
   450|           shift 1
   451|         fi
   452|       fi
   453|       ;;
   454|       -pgoinstrument)
   455|       arguments="$arguments /p:PgoInstrument=true"
   456|       shift 1
   457|       ;;
   458|       -fsanitize)
   459|       if [ -z ${2+x} ]; then
   460|         echo "No value for -fsanitize is supplied. See help (--help) for supported values." 1>&2
   461|         exit 1
   462|       fi
   463|       arguments="$arguments /p:EnableNativeSanitizers=$2"
   464|       shift 2
   465|       ;;
   466|       -fsanitize=*)
   467|       sanitizers="${opt/#-fsanitize=/}" # -fsanitize=address => address
   468|       arguments="$arguments /p:EnableNativeSanitizers=$sanitizers"
   469|       shift 2
   470|       ;;
   471|       -verbose)
   472|       arguments="$arguments /p:CoreclrVerbose=true"
   473|       shift 1
   474|       ;;
   475|       *)
   476|       extraargs="$extraargs $1"
   477|       shift 1
   478|       ;;
   479|   esac
   480| done
   481| if [ ${#actInt[@]} -eq 0 ]; then
   482|     arguments="-restore -build $arguments"
   483| fi
   484| if [[ "$os" == "browser" ]]; then
   485|     arch=wasm
   486| fi
   487| if [[ "$os" == "wasi" ]]; then
   488|     arch=wasm
   489| fi
   490| if [[ "${TreatWarningsAsErrors:-}" == "false" ]]; then
   491|     arguments="$arguments -warnAsError 0"
   492| fi
   493| arguments="$arguments -tl:false"
   494| initDistroRid "$os" "$arch" "$crossBuild"
   495| export DOTNETSDK_ALLOW_TARGETING_PACK_CACHING=0
   496| cmakeargs="${cmakeargs// /%20}"
   497| arguments="$arguments /p:TargetArchitecture=$arch /p:BuildArchitecture=$hostArch"
   498| arguments="$arguments /p:CMakeArgs=\"$cmakeargs\" $extraargs"
   499| "$scriptroot/common/build.sh" $arguments


# ====================================================================
# FILE: eng/common/SetupNugetSources.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-108 ---
     1| ConfigFile=$1
     2| CredToken=$2
     3| NL='\n'
     4| TB='    '
     5| source="${BASH_SOURCE[0]}"
     6| while [[ -h "$source" ]]; do
     7|   scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
     8|   source="$(readlink "$source")"
     9|   [[ $source != /* ]] && source="$scriptroot/$source"
    10| done
    11| scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
    12| . "$scriptroot/tools.sh"
    13| if [ ! -f "$ConfigFile" ]; then
    14|     Write-PipelineTelemetryError -Category 'Build' "Error: Eng/common/SetupNugetSources.sh returned a non-zero exit code. Couldn't find the NuGet config file: $ConfigFile"
    15|     ExitWithExitCode 1
    16| fi
    17| if [[ `uname -s` == "Darwin" ]]; then
    18|     NL=$'\\\n'
    19|     TB=''
    20| fi
    21| grep -i "<packageSources>" $ConfigFile
    22| if [ "$?" != "0" ]; then
    23|     echo "Adding <packageSources>...</packageSources> section."
    24|     ConfigNodeHeader="<configuration>"
    25|     PackageSourcesTemplate="${TB}<packageSources>${NL}${TB}</packageSources>"
    26|     sed -i.bak "s|$ConfigNodeHeader|$ConfigNodeHeader${NL}$PackageSourcesTemplate|" $ConfigFile
    27| fi
    28| grep -i "<packageSourceCredentials>" $ConfigFile
    29| if [ "$?" != "0" ]; then
    30|     echo "Adding <packageSourceCredentials>...</packageSourceCredentials> section."
    31|     PackageSourcesNodeFooter="</packageSources>"
    32|     PackageSourceCredentialsTemplate="${TB}<packageSourceCredentials>${NL}${TB}</packageSourceCredentials>"
    33|     sed -i.bak "s|$PackageSourcesNodeFooter|$PackageSourcesNodeFooter${NL}$PackageSourceCredentialsTemplate|" $ConfigFile
    34| fi
    35| PackageSources=()
    36| grep -i "<add key=\"dotnet3.1\"" $ConfigFile
    37| if [ "$?" == "0" ]; then
    38|     grep -i "<add key=\"dotnet3.1-internal\"" $ConfigFile
    39|     if [ "$?" != "0" ]; then
    40|         echo "Adding dotnet3.1-internal to the packageSources."
    41|         PackageSourcesNodeFooter="</packageSources>"
    42|         PackageSourceTemplate="${TB}<add key=\"dotnet3.1-internal\" value=\"https://pkgs.dev.azure.com/dnceng/_packaging/dotnet3.1-internal/nuget/v2\" />"
    43|         sed -i.bak "s|$PackageSourcesNodeFooter|$PackageSourceTemplate${NL}$PackageSourcesNodeFooter|" $ConfigFile
    44|     fi
    45|     PackageSources+=('dotnet3.1-internal')
    46|     grep -i "<add key=\"dotnet3.1-internal-transport\">" $ConfigFile
    47|     if [ "$?" != "0" ]; then
    48|         echo "Adding dotnet3.1-internal-transport to the packageSources."
    49|         PackageSourcesNodeFooter="</packageSources>"
    50|         PackageSourceTemplate="${TB}<add key=\"dotnet3.1-internal-transport\" value=\"https://pkgs.dev.azure.com/dnceng/_packaging/dotnet3.1-internal-transport/nuget/v2\" />"
    51|         sed -i.bak "s|$PackageSourcesNodeFooter|$PackageSourceTemplate${NL}$PackageSourcesNodeFooter|" $ConfigFile
    52|     fi
    53|     PackageSources+=('dotnet3.1-internal-transport')
    54| fi
    55| DotNetVersions=('5' '6' '7' '8' '9')
    56| for DotNetVersion in ${DotNetVersions[@]} ; do
    57|     FeedPrefix="dotnet${DotNetVersion}";
    58|     grep -i "<add key=\"$FeedPrefix\"" $ConfigFile
    59|     if [ "$?" == "0" ]; then
    60|         grep -i "<add key=\"$FeedPrefix-internal\"" $ConfigFile
    61|         if [ "$?" != "0" ]; then
    62|             echo "Adding $FeedPrefix-internal to the packageSources."
    63|             PackageSourcesNodeFooter="</packageSources>"
    64|             PackageSourceTemplate="${TB}<add key=\"$FeedPrefix-internal\" value=\"https://pkgs.dev.azure.com/dnceng/internal/_packaging/$FeedPrefix-internal/nuget/v2\" />"
    65|             sed -i.bak "s|$PackageSourcesNodeFooter|$PackageSourceTemplate${NL}$PackageSourcesNodeFooter|" $ConfigFile
    66|         fi
    67|         PackageSources+=("$FeedPrefix-internal")
    68|         grep -i "<add key=\"$FeedPrefix-internal-transport\">" $ConfigFile
    69|         if [ "$?" != "0" ]; then
    70|             echo "Adding $FeedPrefix-internal-transport to the packageSources."
    71|             PackageSourcesNodeFooter="</packageSources>"
    72|             PackageSourceTemplate="${TB}<add key=\"$FeedPrefix-internal-transport\" value=\"https://pkgs.dev.azure.com/dnceng/internal/_packaging/$FeedPrefix-internal-transport/nuget/v2\" />"
    73|             sed -i.bak "s|$PackageSourcesNodeFooter|$PackageSourceTemplate${NL}$PackageSourcesNodeFooter|" $ConfigFile
    74|         fi
    75|         PackageSources+=("$FeedPrefix-internal-transport")
    76|     fi
    77| done
    78| PrevIFS=$IFS
    79| IFS=$'\n'
    80| PackageSources+="$IFS"
    81| PackageSources+=$(grep -oh '"darc-int-[^"]*"' $ConfigFile | tr -d '"')
    82| IFS=$PrevIFS
    83| if [ "$CredToken" ]; then
    84|     for FeedName in ${PackageSources[@]} ; do
    85|         grep -i "<$FeedName>" $ConfigFile 
    86|         if [ "$?" != "0" ]; then
    87|             echo "Adding credentials for $FeedName."
    88|             PackageSourceCredentialsNodeFooter="</packageSourceCredentials>"
    89|             NewCredential="${TB}${TB}<$FeedName>${NL}<add key=\"Username\" value=\"dn-bot\" />${NL}<add key=\"ClearTextPassword\" value=\"$CredToken\" />${NL}</$FeedName>"
    90|             sed -i.bak "s|$PackageSourceCredentialsNodeFooter|$NewCredential${NL}$PackageSourceCredentialsNodeFooter|" $ConfigFile
    91|         fi
    92|     done
    93| fi
    94| grep -i "<disabledPackageSources>" $ConfigFile
    95| if [ "$?" == "0" ]; then
    96|     DisabledDarcIntSources=()
    97|     echo "Re-enabling any disabled \"darc-int\" package sources in $ConfigFile"
    98|     DisabledDarcIntSources+=$(grep -oh '"darc-int-[^"]*" value="true"' $ConfigFile  | tr -d '"')
    99|     for DisabledSourceName in ${DisabledDarcIntSources[@]} ; do
   100|         if [[ $DisabledSourceName == darc-int* ]]
   101|             then
   102|                 OldDisableValue="<add key=\"$DisabledSourceName\" value=\"true\" />"
   103|                 NewDisableValue="<!-- Reenabled for build : $DisabledSourceName -->"
   104|                 sed -i.bak "s|$OldDisableValue|$NewDisableValue|" $ConfigFile
   105|                 echo "Neutralized disablePackageSources entry for '$DisabledSourceName'"
   106|         fi
   107|     done
   108| fi


# ====================================================================
# FILE: eng/common/build.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-228 ---
     1| set -u
     2| set -e
     3| usage()
     4| {
     5|   echo "Common settings:"
     6|   echo "  --configuration <value>    Build configuration: 'Debug' or 'Release' (short: -c)"
     7|   echo "  --verbosity <value>        Msbuild verbosity: q[uiet], m[inimal], n[ormal], d[etailed], and diag[nostic] (short: -v)"
     8|   echo "  --binaryLog                Create MSBuild binary log (short: -bl)"
     9|   echo "  --help                     Print help and exit (short: -h)"
    10|   echo ""
    11|   echo "Actions:"
    12|   echo "  --restore                  Restore dependencies (short: -r)"
    13|   echo "  --build                    Build solution (short: -b)"
    14|   echo "  --sourceBuild              Source-build the solution (short: -sb)"
    15|   echo "                             Will additionally trigger the following actions: --restore, --build, --pack"
    16|   echo "                             If --configuration is not set explicitly, will also set it to 'Release'"
    17|   echo "  --productBuild             Build the solution in the way it will be built in the full .NET product (VMR) build (short: -pb)"
    18|   echo "                             Will additionally trigger the following actions: --restore, --build, --pack"
    19|   echo "                             If --configuration is not set explicitly, will also set it to 'Release'"
    20|   echo "  --rebuild                  Rebuild solution"
    21|   echo "  --test                     Run all unit tests in the solution (short: -t)"
    22|   echo "  --integrationTest          Run all integration tests in the solution"
    23|   echo "  --performanceTest          Run all performance tests in the solution"
    24|   echo "  --pack                     Package build outputs into NuGet packages and Willow components"
    25|   echo "  --sign                     Sign build outputs"
    26|   echo "  --publish                  Publish artifacts (e.g. symbols)"
    27|   echo "  --clean                    Clean the solution"
    28|   echo ""
    29|   echo "Advanced settings:"
    30|   echo "  --projects <value>       Project or solution file(s) to build"
    31|   echo "  --ci                     Set when running on CI server"
    32|   echo "  --excludeCIBinarylog     Don't output binary log (short: -nobl)"
    33|   echo "  --prepareMachine         Prepare machine for CI run, clean up processes after build"
    34|   echo "  --nodeReuse <value>      Sets nodereuse msbuild parameter ('true' or 'false')"
    35|   echo "  --warnAsError <value>    Sets warnaserror msbuild parameter ('true' or 'false')"
    36|   echo ""
    37|   echo "Command line arguments not listed above are passed thru to msbuild."
    38|   echo "Arguments can also be passed in with a single hyphen."
    39| }
    40| source="${BASH_SOURCE[0]}"
    41| while [[ -h "$source" ]]; do
    42|   scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
    43|   source="$(readlink "$source")"
    44|   [[ $source != /* ]] && source="$scriptroot/$source"
    45| done
    46| scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
    47| restore=false
    48| build=false
    49| source_build=false
    50| product_build=false
    51| rebuild=false
    52| test=false
    53| integration_test=false
    54| performance_test=false
    55| pack=false
    56| publish=false
    57| sign=false
    58| public=false
    59| ci=false
    60| clean=false
    61| warn_as_error=true
    62| node_reuse=true
    63| binary_log=false
    64| exclude_ci_binary_log=false
    65| pipelines_log=false
    66| projects=''
    67| configuration=''
    68| prepare_machine=false
    69| verbosity='minimal'
    70| runtime_source_feed=''
    71| runtime_source_feed_key=''
    72| properties=''
    73| while [[ $# > 0 ]]; do
    74|   opt="$(echo "${1/#--/-}" | tr "[:upper:]" "[:lower:]")"
    75|   case "$opt" in
    76|     -help|-h)
    77|       usage
    78|       exit 0
    79|       ;;
    80|     -clean)
    81|       clean=true
    82|       ;;
    83|     -configuration|-c)
    84|       configuration=$2
    85|       shift
    86|       ;;
    87|     -verbosity|-v)
    88|       verbosity=$2
    89|       shift
    90|       ;;
    91|     -binarylog|-bl)
    92|       binary_log=true
    93|       ;;
    94|     -excludecibinarylog|-nobl)
    95|       exclude_ci_binary_log=true
    96|       ;;
    97|     -pipelineslog|-pl)
    98|       pipelines_log=true
    99|       ;;
   100|     -restore|-r)
   101|       restore=true
   102|       ;;
   103|     -build|-b)
   104|       build=true
   105|       ;;
   106|     -rebuild)
   107|       rebuild=true
   108|       ;;
   109|     -pack)
   110|       pack=true
   111|       ;;
   112|     -sourcebuild|-sb)
   113|       build=true
   114|       source_build=true
   115|       product_build=true
   116|       restore=true
   117|       pack=true
   118|       ;;
   119|     -productBuild|-pb)
   120|       build=true
   121|       product_build=true
   122|       restore=true
   123|       pack=true
   124|       ;;
   125|     -test|-t)
   126|       test=true
   127|       ;;
   128|     -integrationtest)
   129|       integration_test=true
   130|       ;;
   131|     -performancetest)
   132|       performance_test=true
   133|       ;;
   134|     -sign)
   135|       sign=true
   136|       ;;
   137|     -publish)
   138|       publish=true
   139|       ;;
   140|     -preparemachine)
   141|       prepare_machine=true
   142|       ;;
   143|     -projects)
   144|       projects=$2
   145|       shift
   146|       ;;
   147|     -ci)
   148|       ci=true
   149|       ;;
   150|     -warnaserror)
   151|       warn_as_error=$2
   152|       shift
   153|       ;;
   154|     -nodereuse)
   155|       node_reuse=$2
   156|       shift
   157|       ;;
   158|     -runtimesourcefeed)
   159|       runtime_source_feed=$2
   160|       shift
   161|       ;;
   162|      -runtimesourcefeedkey)
   163|       runtime_source_feed_key=$2
   164|       shift
   165|       ;;
   166|     *)
   167|       properties="$properties $1"
   168|       ;;
   169|   esac
   170|   shift
   171| done
   172| if [[ -z "$configuration" ]]; then
   173|   if [[ "$source_build" = true ]]; then configuration="Release"; else configuration="Debug"; fi
   174| fi
   175| if [[ "$ci" == true ]]; then
   176|   pipelines_log=true
   177|   node_reuse=false
   178|   if [[ "$exclude_ci_binary_log" == false ]]; then
   179|     binary_log=true
   180|   fi
   181| fi
   182| . "$scriptroot/tools.sh"
   183| function InitializeCustomToolset {
   184|   local script="$eng_root/restore-toolset.sh"
   185|   if [[ -a "$script" ]]; then
   186|     . "$script"
   187|   fi
   188| }
   189| function Build {
   190|   InitializeToolset
   191|   InitializeCustomToolset
   192|   if [[ ! -z "$projects" ]]; then
   193|     properties="$properties /p:Projects=$projects"
   194|   fi
   195|   local bl=""
   196|   if [[ "$binary_log" == true ]]; then
   197|     bl="/bl:\"$log_dir/Build.binlog\""
   198|   fi
   199|   MSBuild $_InitializeToolset \
   200|     $bl \
   201|     /p:Configuration=$configuration \
   202|     /p:RepoRoot="$repo_root" \
   203|     /p:Restore=$restore \
   204|     /p:Build=$build \
   205|     /p:DotNetBuildRepo=$product_build \
   206|     /p:ArcadeBuildFromSource=$source_build \
   207|     /p:DotNetBuildSourceOnly=$source_build \
   208|     /p:Rebuild=$rebuild \
   209|     /p:Test=$test \
   210|     /p:Pack=$pack \
   211|     /p:IntegrationTest=$integration_test \
   212|     /p:PerformanceTest=$performance_test \
   213|     /p:Sign=$sign \
   214|     /p:Publish=$publish \
   215|     $properties
   216|   ExitWithExitCode 0
   217| }
   218| if [[ "$clean" == true ]]; then
   219|   if [ -d "$artifacts_dir" ]; then
   220|     rm -rf $artifacts_dir
   221|     echo "Artifacts directory deleted."
   222|   fi
   223|   exit 0
   224| fi
   225| if [[ "$restore" == true ]]; then
   226|   InitializeNativeTools
   227| fi
   228| Build


# ====================================================================
# FILE: eng/common/cross/build-android-rootfs.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-105 ---
     1| set -e
     2| __NDK_Version=r21
     3| usage()
     4| {
     5|     echo "Creates a toolchain and sysroot used for cross-compiling for Android."
     6|     echo
     7|     echo "Usage: $0 [BuildArch] [ApiLevel]"
     8|     echo
     9|     echo "BuildArch is the target architecture of Android. Currently only arm64 is supported."
    10|     echo "ApiLevel is the target Android API level. API levels usually match to Android releases. See https://source.android.com/source/build-numbers.html"
    11|     echo
    12|     echo "By default, the toolchain and sysroot will be generated in cross/android-rootfs/toolchain/[BuildArch]. You can change this behavior"
    13|     echo "by setting the TOOLCHAIN_DIR environment variable"
    14|     echo
    15|     echo "By default, the NDK will be downloaded into the cross/android-rootfs/android-ndk-$__NDK_Version directory. If you already have an NDK installation,"
    16|     echo "you can set the NDK_DIR environment variable to have this script use that installation of the NDK."
    17|     echo "By default, this script will generate a file, android_platform, in the root of the ROOTFS_DIR directory that contains the RID for the supported and tested Android build: android.28-arm64. This file is to replace '/etc/os-release', which is not available for Android."
    18|     exit 1
    19| }
    20| __ApiLevel=28 # The minimum platform for arm64 is API level 21 but the minimum version that support glob(3) is 28. See $ANDROID_NDK/toolchains/llvm/prebuilt/linux-x86_64/sysroot/usr/include/glob.h
    21| __BuildArch=arm64
    22| __AndroidArch=aarch64
    23| __AndroidToolchain=aarch64-linux-android
    24| for i in "$@"
    25|     do
    26|         lowerI="$(echo $i | tr "[:upper:]" "[:lower:]")"
    27|         case $lowerI in
    28|         -?|-h|--help)
    29|             usage
    30|             exit 1
    31|             ;;
    32|         arm64)
    33|             __BuildArch=arm64
    34|             __AndroidArch=aarch64
    35|             __AndroidToolchain=aarch64-linux-android
    36|             ;;
    37|         arm)
    38|             __BuildArch=arm
    39|             __AndroidArch=arm
    40|             __AndroidToolchain=arm-linux-androideabi
    41|             ;;
    42|         *[0-9])
    43|             __ApiLevel=$i
    44|             ;;
    45|         *)
    46|             __UnprocessedBuildArgs="$__UnprocessedBuildArgs $i"
    47|             ;;
    48|     esac
    49| done
    50| __ScriptBaseDir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
    51| __CrossDir="$__ScriptBaseDir/../../../.tools/android-rootfs"
    52| if [[ ! -f "$__CrossDir" ]]; then
    53|     mkdir -p "$__CrossDir"
    54| fi
    55| __CrossDir="$( cd "$__CrossDir" && pwd )"
    56| __NDK_Dir="$__CrossDir/android-ndk-$__NDK_Version"
    57| __lldb_Dir="$__CrossDir/lldb"
    58| __ToolchainDir="$__CrossDir/android-ndk-$__NDK_Version"
    59| if [[ -n "$TOOLCHAIN_DIR" ]]; then
    60|     __ToolchainDir=$TOOLCHAIN_DIR
    61| fi
    62| if [[ -n "$NDK_DIR" ]]; then
    63|     __NDK_Dir=$NDK_DIR
    64| fi
    65| echo "Target API level: $__ApiLevel"
    66| echo "Target architecture: $__BuildArch"
    67| echo "NDK location: $__NDK_Dir"
    68| echo "Target Toolchain location: $__ToolchainDir"
    69| if [ ! -d $__NDK_Dir ]; then
    70|     echo Downloading the NDK into $__NDK_Dir
    71|     mkdir -p $__NDK_Dir
    72|     wget -q --progress=bar:force:noscroll --show-progress https://dl.google.com/android/repository/android-ndk-$__NDK_Version-linux-x86_64.zip -O $__CrossDir/android-ndk-$__NDK_Version-linux-x86_64.zip
    73|     unzip -q $__CrossDir/android-ndk-$__NDK_Version-linux-x86_64.zip -d $__CrossDir
    74| fi
    75| if [ ! -d $__lldb_Dir ]; then
    76|     mkdir -p $__lldb_Dir
    77|     echo Downloading LLDB into $__lldb_Dir
    78|     wget -q --progress=bar:force:noscroll --show-progress https://dl.google.com/android/repository/lldb-2.3.3614996-linux-x86_64.zip -O $__CrossDir/lldb-2.3.3614996-linux-x86_64.zip
    79|     unzip -q $__CrossDir/lldb-2.3.3614996-linux-x86_64.zip -d $__lldb_Dir
    80| fi
    81| echo "Download dependencies..."
    82| __TmpDir=$__CrossDir/tmp/$__BuildArch/
    83| mkdir -p "$__TmpDir"
    84| __AndroidPackages="libicu"
    85| __AndroidPackages+=" libandroid-glob"
    86| __AndroidPackages+=" liblzma"
    87| __AndroidPackages+=" krb5"
    88| __AndroidPackages+=" openssl"
    89| for path in $(wget -qO- https://packages.termux.dev/termux-main-21/dists/stable/main/binary-$__AndroidArch/Packages |\
    90|     grep -A15 "Package: \(${__AndroidPackages// /\\|}\)" | grep -v "static\|tool" | grep Filename); do
    91|     if [[ "$path" != "Filename:" ]]; then
    92|         echo "Working on: $path"
    93|         wget -qO- https://packages.termux.dev/termux-main-21/$path | dpkg -x - "$__TmpDir"
    94|     fi
    95| done
    96| cp -R "$__TmpDir/data/data/com.termux/files/usr/"* "$__ToolchainDir/sysroot/usr/"
    97| echo "Generating platform file..."
    98| echo "RID=android.${__ApiLevel}-${__BuildArch}" > $__ToolchainDir/sysroot/android_platform
    99| echo "Now to build coreclr, libraries and installers; run:"
   100| echo ROOTFS_DIR=\$\(realpath $__ToolchainDir/sysroot\) ./build.sh --cross --arch $__BuildArch \
   101|     --subsetCategory coreclr
   102| echo ROOTFS_DIR=\$\(realpath $__ToolchainDir/sysroot\) ./build.sh --cross --arch $__BuildArch \
   103|     --subsetCategory libraries
   104| echo ROOTFS_DIR=\$\(realpath $__ToolchainDir/sysroot\) ./build.sh --cross --arch $__BuildArch \
   105|     --subsetCategory installer


# ====================================================================
# FILE: eng/common/cross/build-rootfs.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-679 ---
     1| set -e
     2| usage()
     3| {
     4|     echo "Usage: $0 [BuildArch] [CodeName] [lldbx.y] [llvmx[.y]] [--skipunmount] --rootfsdir <directory>]"
     5|     echo "BuildArch can be: arm(default), arm64, armel, armv6, ppc64le, riscv64, s390x, x64, x86"
     6|     echo "CodeName - optional, Code name for Linux, can be: xenial(default), zesty, bionic, alpine"
     7|     echo "                               for alpine can be specified with version: alpineX.YY or alpineedge"
     8|     echo "                               for FreeBSD can be: freebsd13, freebsd14"
     9|     echo "                               for illumos can be: illumos"
    10|     echo "                               for Haiku can be: haiku."
    11|     echo "lldbx.y - optional, LLDB version, can be: lldb3.9(default), lldb4.0, lldb5.0, lldb6.0 no-lldb. Ignored for alpine and FreeBSD"
    12|     echo "llvmx[.y] - optional, LLVM version for LLVM related packages."
    13|     echo "--skipunmount - optional, will skip the unmount of rootfs folder."
    14|     echo "--skipsigcheck - optional, will skip package signature checks (allowing untrusted packages)."
    15|     echo "--use-mirror - optional, use mirror URL to fetch resources, when available."
    16|     echo "--jobs N - optional, restrict to N jobs."
    17|     exit 1
    18| }
    19| __CodeName=xenial
    20| __CrossDir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
    21| __BuildArch=arm
    22| __AlpineArch=armv7
    23| __FreeBSDArch=arm
    24| __FreeBSDMachineArch=armv7
    25| __IllumosArch=arm7
    26| __HaikuArch=arm
    27| __QEMUArch=arm
    28| __UbuntuArch=armhf
    29| __UbuntuRepo=
    30| __UbuntuSuites="updates security backports"
    31| __LLDB_Package="liblldb-3.9-dev"
    32| __SkipUnmount=0
    33| __UbuntuPackages="build-essential"
    34| __AlpinePackages="alpine-base"
    35| __AlpinePackages+=" build-base"
    36| __AlpinePackages+=" linux-headers"
    37| __AlpinePackages+=" lldb-dev"
    38| __AlpinePackages+=" python3"
    39| __AlpinePackages+=" libedit"
    40| __UbuntuPackages+=" symlinks"
    41| __UbuntuPackages+=" libicu-dev"
    42| __UbuntuPackages+=" liblttng-ust-dev"
    43| __UbuntuPackages+=" libunwind8-dev"
    44| __UbuntuPackages+=" libnuma-dev"
    45| __AlpinePackages+=" gettext-dev"
    46| __AlpinePackages+=" icu-dev"
    47| __AlpinePackages+=" libunwind-dev"
    48| __AlpinePackages+=" lttng-ust-dev"
    49| __AlpinePackages+=" compiler-rt"
    50| __AlpinePackages+=" numactl-dev"
    51| __UbuntuPackages+=" libcurl4-openssl-dev"
    52| __UbuntuPackages+=" libkrb5-dev"
    53| __UbuntuPackages+=" libssl-dev"
    54| __UbuntuPackages+=" zlib1g-dev"
    55| __AlpinePackages+=" curl-dev"
    56| __AlpinePackages+=" krb5-dev"
    57| __AlpinePackages+=" openssl-dev"
    58| __AlpinePackages+=" zlib-dev"
    59| __FreeBSDBase="13.3-RELEASE"
    60| __FreeBSDPkg="1.17.0"
    61| __FreeBSDABI="13"
    62| __FreeBSDPackages="libunwind"
    63| __FreeBSDPackages+=" icu"
    64| __FreeBSDPackages+=" libinotify"
    65| __FreeBSDPackages+=" openssl"
    66| __FreeBSDPackages+=" krb5"
    67| __FreeBSDPackages+=" terminfo-db"
    68| __IllumosPackages="icu"
    69| __IllumosPackages+=" mit-krb5"
    70| __IllumosPackages+=" openssl"
    71| __IllumosPackages+=" zlib"
    72| __HaikuPackages="gcc_syslibs"
    73| __HaikuPackages+=" gcc_syslibs_devel"
    74| __HaikuPackages+=" gmp"
    75| __HaikuPackages+=" gmp_devel"
    76| __HaikuPackages+=" icu66"
    77| __HaikuPackages+=" icu66_devel"
    78| __HaikuPackages+=" krb5"
    79| __HaikuPackages+=" krb5_devel"
    80| __HaikuPackages+=" libiconv"
    81| __HaikuPackages+=" libiconv_devel"
    82| __HaikuPackages+=" llvm12_libunwind"
    83| __HaikuPackages+=" llvm12_libunwind_devel"
    84| __HaikuPackages+=" mpfr"
    85| __HaikuPackages+=" mpfr_devel"
    86| __HaikuPackages+=" openssl"
    87| __HaikuPackages+=" openssl_devel"
    88| __HaikuPackages+=" zlib"
    89| __HaikuPackages+=" zlib_devel"
    90| __UbuntuPackages+=" libomp5"
    91| __UbuntuPackages+=" libomp-dev"
    92| __AlpineKeys='
    93| 4a6a0840:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA1yHJxQgsHQREclQu4Ohe\nqxTxd1tHcNnvnQTu/UrTky8wWvgXT+jpveroeWWnzmsYlDI93eLI2ORakxb3gA2O\nQ0Ry4ws8vhaxLQGC74uQR5+/yYrLuTKydFzuPaS1dK19qJPXB8GMdmFOijnXX4SA\njixuHLe1WW7kZVtjL7nufvpXkWBGjsfrvskdNA/5MfxAeBbqPgaq0QMEfxMAn6/R\nL5kNepi/Vr4S39Xvf2DzWkTLEK8pcnjNkt9/aafhWqFVW7m3HCAII6h/qlQNQKSo\nGuH34Q8GsFG30izUENV9avY7hSLq7nggsvknlNBZtFUcmGoQrtx3FmyYsIC8/R+B\nywIDAQAB
    94| 5243ef4b:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvNijDxJ8kloskKQpJdx+\nmTMVFFUGDoDCbulnhZMJoKNkSuZOzBoFC94omYPtxnIcBdWBGnrm6ncbKRlR+6oy\nDO0W7c44uHKCFGFqBhDasdI4RCYP+fcIX/lyMh6MLbOxqS22TwSLhCVjTyJeeH7K\naA7vqk+QSsF4TGbYzQDDpg7+6aAcNzg6InNePaywA6hbT0JXbxnDWsB+2/LLSF2G\nmnhJlJrWB1WGjkz23ONIWk85W4S0XB/ewDefd4Ly/zyIciastA7Zqnh7p3Ody6Q0\nsS2MJzo7p3os1smGjUF158s6m/JbVh4DN6YIsxwl2OjDOz9R0OycfJSDaBVIGZzg\ncQIDAQAB
    95| 524d27bb:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAr8s1q88XpuJWLCZALdKj\nlN8wg2ePB2T9aIcaxryYE/Jkmtu+ZQ5zKq6BT3y/udt5jAsMrhHTwroOjIsF9DeG\ne8Y3vjz+Hh4L8a7hZDaw8jy3CPag47L7nsZFwQOIo2Cl1SnzUc6/owoyjRU7ab0p\niWG5HK8IfiybRbZxnEbNAfT4R53hyI6z5FhyXGS2Ld8zCoU/R4E1P0CUuXKEN4p0\n64dyeUoOLXEWHjgKiU1mElIQj3k/IF02W89gDj285YgwqA49deLUM7QOd53QLnx+\nxrIrPv3A+eyXMFgexNwCKQU9ZdmWa00MjjHlegSGK8Y2NPnRoXhzqSP9T9i2HiXL\nVQIDAQAB
    96| 5261cecb:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwlzMkl7b5PBdfMzGdCT0\ncGloRr5xGgVmsdq5EtJvFkFAiN8Ac9MCFy/vAFmS8/7ZaGOXoCDWbYVLTLOO2qtX\nyHRl+7fJVh2N6qrDDFPmdgCi8NaE+3rITWXGrrQ1spJ0B6HIzTDNEjRKnD4xyg4j\ng01FMcJTU6E+V2JBY45CKN9dWr1JDM/nei/Pf0byBJlMp/mSSfjodykmz4Oe13xB\nCa1WTwgFykKYthoLGYrmo+LKIGpMoeEbY1kuUe04UiDe47l6Oggwnl+8XD1MeRWY\nsWgj8sF4dTcSfCMavK4zHRFFQbGp/YFJ/Ww6U9lA3Vq0wyEI6MCMQnoSMFwrbgZw\nwwIDAQAB
    97| 58199dcc:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA3v8/ye/V/t5xf4JiXLXa\nhWFRozsnmn3hobON20GdmkrzKzO/eUqPOKTpg2GtvBhK30fu5oY5uN2ORiv2Y2ht\neLiZ9HVz3XP8Fm9frha60B7KNu66FO5P2o3i+E+DWTPqqPcCG6t4Znk2BypILcit\nwiPKTsgbBQR2qo/cO01eLLdt6oOzAaF94NH0656kvRewdo6HG4urbO46tCAizvCR\nCA7KGFMyad8WdKkTjxh8YLDLoOCtoZmXmQAiwfRe9pKXRH/XXGop8SYptLqyVVQ+\ntegOD9wRs2tOlgcLx4F/uMzHN7uoho6okBPiifRX+Pf38Vx+ozXh056tjmdZkCaV\naQIDAQAB
    98| 58cbb476:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoSPnuAGKtRIS5fEgYPXD\n8pSGvKAmIv3A08LBViDUe+YwhilSHbYXUEAcSH1KZvOo1WT1x2FNEPBEFEFU1Eyc\n+qGzbA03UFgBNvArurHQ5Z/GngGqE7IarSQFSoqewYRtFSfp+TL9CUNBvM0rT7vz\n2eMu3/wWG+CBmb92lkmyWwC1WSWFKO3x8w+Br2IFWvAZqHRt8oiG5QtYvcZL6jym\nY8T6sgdDlj+Y+wWaLHs9Fc+7vBuyK9C4O1ORdMPW15qVSl4Lc2Wu1QVwRiKnmA+c\nDsH/m7kDNRHM7TjWnuj+nrBOKAHzYquiu5iB3Qmx+0gwnrSVf27Arc3ozUmmJbLj\nzQIDAQAB
    99| 58e4f17d:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAvBxJN9ErBgdRcPr5g4hV\nqyUSGZEKuvQliq2Z9SRHLh2J43+EdB6A+yzVvLnzcHVpBJ+BZ9RV30EM9guck9sh\nr+bryZcRHyjG2wiIEoduxF2a8KeWeQH7QlpwGhuobo1+gA8L0AGImiA6UP3LOirl\nI0G2+iaKZowME8/tydww4jx5vG132JCOScMjTalRsYZYJcjFbebQQolpqRaGB4iG\nWqhytWQGWuKiB1A22wjmIYf3t96l1Mp+FmM2URPxD1gk/BIBnX7ew+2gWppXOK9j\n1BJpo0/HaX5XoZ/uMqISAAtgHZAqq+g3IUPouxTphgYQRTRYpz2COw3NF43VYQrR\nbQIDAQAB
   100| 60ac2099:MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwR4uJVtJOnOFGchnMW5Y\nj5/waBdG1u5BTMlH+iQMcV5+VgWhmpZHJCBz3ocD+0IGk2I68S5TDOHec/GSC0lv\n6R9o6F7h429GmgPgVKQsc8mPTPtbjJMuLLs4xKc+viCplXc0Nc0ZoHmCH4da6fCV\ntdpHQjVe6F9zjdquZ4RjV6R6JTiN9v924dGMAkbW/xXmamtz51FzondKC52Gh8Mo\n/oA0/T0KsCMCi7tb4QNQUYrf+Xcha9uus4ww1kWNZyfXJB87a2kORLiWMfs2IBBJ\nTmZ2Fnk0JnHDb8Oknxd9PvJPT0mvyT8DA+KIAPqNvOjUXP4bnjEHJcoCP9S5HkGC\nIQIDAQAB
   101| 6165ee59:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAutQkua2CAig4VFSJ7v54\nALyu/J1WB3oni7qwCZD3veURw7HxpNAj9hR+S5N/pNeZgubQvJWyaPuQDm7PTs1+\ntFGiYNfAsiibX6Rv0wci3M+z2XEVAeR9Vzg6v4qoofDyoTbovn2LztaNEjTkB+oK\ntlvpNhg1zhou0jDVYFniEXvzjckxswHVb8cT0OMTKHALyLPrPOJzVtM9C1ew2Nnc\n3848xLiApMu3NBk0JqfcS3Bo5Y2b1FRVBvdt+2gFoKZix1MnZdAEZ8xQzL/a0YS5\nHd0wj5+EEKHfOd3A75uPa/WQmA+o0cBFfrzm69QDcSJSwGpzWrD1ScH3AK8nWvoj\nv7e9gukK/9yl1b4fQQ00vttwJPSgm9EnfPHLAtgXkRloI27H6/PuLoNvSAMQwuCD\nhQRlyGLPBETKkHeodfLoULjhDi1K2gKJTMhtbnUcAA7nEphkMhPWkBpgFdrH+5z4\nLxy+3ek0cqcI7K68EtrffU8jtUj9LFTUC8dERaIBs7NgQ/LfDbDfGh9g6qVj1hZl\nk9aaIPTm/xsi8v3u+0qaq7KzIBc9s59JOoA8TlpOaYdVgSQhHHLBaahOuAigH+VI\nisbC9vmqsThF2QdDtQt37keuqoda2E6sL7PUvIyVXDRfwX7uMDjlzTxHTymvq2Ck\nhtBqojBnThmjJQFgZXocHG8CAwEAAQ==
   102| 61666e3f:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAlEyxkHggKCXC2Wf5Mzx4\nnZLFZvU2bgcA3exfNPO/g1YunKfQY+Jg4fr6tJUUTZ3XZUrhmLNWvpvSwDS19ZmC\nIXOu0+V94aNgnhMsk9rr59I8qcbsQGIBoHzuAl8NzZCgdbEXkiY90w1skUw8J57z\nqCsMBydAueMXuWqF5nGtYbi5vHwK42PffpiZ7G5Kjwn8nYMW5IZdL6ZnMEVJUWC9\nI4waeKg0yskczYDmZUEAtrn3laX9677ToCpiKrvmZYjlGl0BaGp3cxggP2xaDbUq\nqfFxWNgvUAb3pXD09JM6Mt6HSIJaFc9vQbrKB9KT515y763j5CC2KUsilszKi3mB\nHYe5PoebdjS7D1Oh+tRqfegU2IImzSwW3iwA7PJvefFuc/kNIijfS/gH/cAqAK6z\nbhdOtE/zc7TtqW2Wn5Y03jIZdtm12CxSxwgtCF1NPyEWyIxAQUX9ACb3M0FAZ61n\nfpPrvwTaIIxxZ01L3IzPLpbc44x/DhJIEU+iDt6IMTrHOphD9MCG4631eIdB0H1b\n6zbNX1CXTsafqHRFV9XmYYIeOMggmd90s3xIbEujA6HKNP/gwzO6CDJ+nHFDEqoF\nSkxRdTkEqjTjVKieURW7Swv7zpfu5PrsrrkyGnsRrBJJzXlm2FOOxnbI2iSL1B5F\nrO5kbUxFeZUIDq+7Yv4kLWcCAwEAAQ==
   103| 616a9724:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAnC+bR4bHf/L6QdU4puhQ\ngl1MHePszRC38bzvVFDUJsmCaMCL2suCs2A2yxAgGb9pu9AJYLAmxQC4mM3jNqhg\n/E7yuaBbek3O02zN/ctvflJ250wZCy+z0ZGIp1ak6pu1j14IwHokl9j36zNfGtfv\nADVOcdpWITFFlPqwq1qt/H3UsKVmtiF3BNWWTeUEQwKvlU8ymxgS99yn0+4OPyNT\nL3EUeS+NQJtDS01unau0t7LnjUXn+XIneWny8bIYOQCuVR6s/gpIGuhBaUqwaJOw\n7jkJZYF2Ij7uPb4b5/R3vX2FfxxqEHqssFSg8FFUNTZz3qNZs0CRVyfA972g9WkJ\nhPfn31pQYil4QGRibCMIeU27YAEjXoqfJKEPh4UWMQsQLrEfdGfb8VgwrPbniGfU\nL3jKJR3VAafL9330iawzVQDlIlwGl6u77gEXMl9K0pfazunYhAp+BMP+9ot5ckK+\nosmrqj11qMESsAj083GeFdfV3pXEIwUytaB0AKEht9DbqUfiE/oeZ/LAXgySMtVC\nsbC4ESmgVeY2xSBIJdDyUap7FR49GGrw0W49NUv9gRgQtGGaNVQQO9oGL2PBC41P\niWF9GLoX30HIz1P8PF/cZvicSSPkQf2Z6TV+t0ebdGNS5DjapdnCrq8m9Z0pyKsQ\nuxAL2a7zX8l5i1CZh1ycUGsCAwEAAQ==
   104| 616abc23:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA0MfCDrhODRCIxR9Dep1s\neXafh5CE5BrF4WbCgCsevyPIdvTeyIaW4vmO3bbG4VzhogDZju+R3IQYFuhoXP5v\nY+zYJGnwrgz3r5wYAvPnLEs1+dtDKYOgJXQj+wLJBW1mzRDL8FoRXOe5iRmn1EFS\nwZ1DoUvyu7/J5r0itKicZp3QKED6YoilXed+1vnS4Sk0mzN4smuMR9eO1mMCqNp9\n9KTfRDHTbakIHwasECCXCp50uXdoW6ig/xUAFanpm9LtK6jctNDbXDhQmgvAaLXZ\nLvFqoaYJ/CvWkyYCgL6qxvMvVmPoRv7OPcyni4xR/WgWa0MSaEWjgPx3+yj9fiMA\n1S02pFWFDOr5OUF/O4YhFJvUCOtVsUPPfA/Lj6faL0h5QI9mQhy5Zb9TTaS9jB6p\nLw7u0dJlrjFedk8KTJdFCcaGYHP6kNPnOxMylcB/5WcztXZVQD5WpCicGNBxCGMm\nW64SgrV7M07gQfL/32QLsdqPUf0i8hoVD8wfQ3EpbQzv6Fk1Cn90bZqZafg8XWGY\nwddhkXk7egrr23Djv37V2okjzdqoyLBYBxMz63qQzFoAVv5VoY2NDTbXYUYytOvG\nGJ1afYDRVWrExCech1mX5ZVUB1br6WM+psFLJFoBFl6mDmiYt0vMYBddKISsvwLl\nIJQkzDwtXzT2cSjoj3T5QekCAwEAAQ==
   105| 616ac3bc:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAvaaoSLab+IluixwKV5Od\n0gib2YurjPatGIbn5Ov2DLUFYiebj2oJINXJSwUOO+4WcuHFEqiL/1rya+k5hLZt\nhnPL1tn6QD4rESznvGSasRCQNT2vS/oyZbTYJRyAtFkEYLlq0t3S3xBxxHWuvIf0\nqVxVNYpQWyM3N9RIeYBR/euXKJXileSHk/uq1I5wTC0XBIHWcthczGN0m9wBEiWS\n0m3cnPk4q0Ea8mUJ91Rqob19qETz6VbSPYYpZk3qOycjKosuwcuzoMpwU8KRiMFd\n5LHtX0Hx85ghGsWDVtS0c0+aJa4lOMGvJCAOvDfqvODv7gKlCXUpgumGpLdTmaZ8\n1RwqspAe3IqBcdKTqRD4m2mSg23nVx2FAY3cjFvZQtfooT7q1ItRV5RgH6FhQSl7\n+6YIMJ1Bf8AAlLdRLpg+doOUGcEn+pkDiHFgI8ylH1LKyFKw+eXaAml/7DaWZk1d\ndqggwhXOhc/UUZFQuQQ8A8zpA13PcbC05XxN2hyP93tCEtyynMLVPtrRwDnHxFKa\nqKzs3rMDXPSXRn3ZZTdKH3069ApkEjQdpcwUh+EmJ1Ve/5cdtzT6kKWCjKBFZP/s\n91MlRrX2BTRdHaU5QJkUheUtakwxuHrdah2F94lRmsnQlpPr2YseJu6sIE+Dnx4M\nCfhdVbQL2w54R645nlnohu8CAwEAAQ==
   106| 616adfeb:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAq0BFD1D4lIxQcsqEpQzU\npNCYM3aP1V/fxxVdT4DWvSI53JHTwHQamKdMWtEXetWVbP5zSROniYKFXd/xrD9X\n0jiGHey3lEtylXRIPxe5s+wXoCmNLcJVnvTcDtwx/ne2NLHxp76lyc25At+6RgE6\nADjLVuoD7M4IFDkAsd8UQ8zM0Dww9SylIk/wgV3ZkifecvgUQRagrNUdUjR56EBZ\nraQrev4hhzOgwelT0kXCu3snbUuNY/lU53CoTzfBJ5UfEJ5pMw1ij6X0r5S9IVsy\nKLWH1hiO0NzU2c8ViUYCly4Fe9xMTFc6u2dy/dxf6FwERfGzETQxqZvSfrRX+GLj\n/QZAXiPg5178hT/m0Y3z5IGenIC/80Z9NCi+byF1WuJlzKjDcF/TU72zk0+PNM/H\nKuppf3JT4DyjiVzNC5YoWJT2QRMS9KLP5iKCSThwVceEEg5HfhQBRT9M6KIcFLSs\nmFjx9kNEEmc1E8hl5IR3+3Ry8G5/bTIIruz14jgeY9u5jhL8Vyyvo41jgt9sLHR1\n/J1TxKfkgksYev7PoX6/ZzJ1ksWKZY5NFoDXTNYUgzFUTOoEaOg3BAQKadb3Qbbq\nXIrxmPBdgrn9QI7NCgfnAY3Tb4EEjs3ON/BNyEhUENcXOH6I1NbcuBQ7g9P73kE4\nVORdoc8MdJ5eoKBpO8Ww8HECAwEAAQ==
   107| 616ae350:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAyduVzi1mWm+lYo2Tqt/0\nXkCIWrDNP1QBMVPrE0/ZlU2bCGSoo2Z9FHQKz/mTyMRlhNqTfhJ5qU3U9XlyGOPJ\npiM+b91g26pnpXJ2Q2kOypSgOMOPA4cQ42PkHBEqhuzssfj9t7x47ppS94bboh46\nxLSDRff/NAbtwTpvhStV3URYkxFG++cKGGa5MPXBrxIp+iZf9GnuxVdST5PGiVGP\nODL/b69sPJQNbJHVquqUTOh5Ry8uuD2WZuXfKf7/C0jC/ie9m2+0CttNu9tMciGM\nEyKG1/Xhk5iIWO43m4SrrT2WkFlcZ1z2JSf9Pjm4C2+HovYpihwwdM/OdP8Xmsnr\nDzVB4YvQiW+IHBjStHVuyiZWc+JsgEPJzisNY0Wyc/kNyNtqVKpX6dRhMLanLmy+\nf53cCSI05KPQAcGj6tdL+D60uKDkt+FsDa0BTAobZ31OsFVid0vCXtsbplNhW1IF\nHwsGXBTVcfXg44RLyL8Lk/2dQxDHNHzAUslJXzPxaHBLmt++2COa2EI1iWlvtznk\nOk9WP8SOAIj+xdqoiHcC4j72BOVVgiITIJNHrbppZCq6qPR+fgXmXa+sDcGh30m6\n9Wpbr28kLMSHiENCWTdsFij+NQTd5S47H7XTROHnalYDuF1RpS+DpQidT5tUimaT\nJZDr++FjKrnnijbyNF8b98UCAwEAAQ==
   108| 616db30d:MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAnpUpyWDWjlUk3smlWeA0\nlIMW+oJ38t92CRLHH3IqRhyECBRW0d0aRGtq7TY8PmxjjvBZrxTNDpJT6KUk4LRm\na6A6IuAI7QnNK8SJqM0DLzlpygd7GJf8ZL9SoHSH+gFsYF67Cpooz/YDqWrlN7Vw\ntO00s0B+eXy+PCXYU7VSfuWFGK8TGEv6HfGMALLjhqMManyvfp8hz3ubN1rK3c8C\nUS/ilRh1qckdbtPvoDPhSbTDmfU1g/EfRSIEXBrIMLg9ka/XB9PvWRrekrppnQzP\nhP9YE3x/wbFc5QqQWiRCYyQl/rgIMOXvIxhkfe8H5n1Et4VAorkpEAXdsfN8KSVv\nLSMazVlLp9GYq5SUpqYX3KnxdWBgN7BJoZ4sltsTpHQ/34SXWfu3UmyUveWj7wp0\nx9hwsPirVI00EEea9AbP7NM2rAyu6ukcm4m6ATd2DZJIViq2es6m60AE6SMCmrQF\nwmk4H/kdQgeAELVfGOm2VyJ3z69fQuywz7xu27S6zTKi05Qlnohxol4wVb6OB7qG\nLPRtK9ObgzRo/OPumyXqlzAi/Yvyd1ZQk8labZps3e16bQp8+pVPiumWioMFJDWV\nGZjCmyMSU8V6MB6njbgLHoyg2LCukCAeSjbPGGGYhnKLm1AKSoJh3IpZuqcKCk5C\n8CM1S15HxV78s9dFntEqIokCAwEAAQ==
   109| '
   110| __Keyring=
   111| __KeyringFile="/usr/share/keyrings/ubuntu-archive-keyring.gpg"
   112| __SkipSigCheck=0
   113| __UseMirror=0
   114| __UnprocessedBuildArgs=
   115| while :; do
   116|     if [[ "$#" -le 0 ]]; then
   117|         break
   118|     fi
   119|     lowerI="$(echo "$1" | tr "[:upper:]" "[:lower:]")"
   120|     case $lowerI in
   121|         -\?|-h|--help)
   122|             usage
   123|             ;;
   124|         arm)
   125|             __BuildArch=arm
   126|             __UbuntuArch=armhf
   127|             __AlpineArch=armv7
   128|             __QEMUArch=arm
   129|             ;;
   130|         arm64)
   131|             __BuildArch=arm64
   132|             __UbuntuArch=arm64
   133|             __AlpineArch=aarch64
   134|             __QEMUArch=aarch64
   135|             __FreeBSDArch=arm64
   136|             __FreeBSDMachineArch=aarch64
   137|             ;;
   138|         armel)
   139|             __BuildArch=armel
   140|             __UbuntuArch=armel
   141|             __UbuntuRepo="http://ftp.debian.org/debian/"
   142|             __CodeName=jessie
   143|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   144|             ;;
   145|         armv6)
   146|             __BuildArch=armv6
   147|             __UbuntuArch=armhf
   148|             __QEMUArch=arm
   149|             __UbuntuRepo="http://raspbian.raspberrypi.org/raspbian/"
   150|             __CodeName=buster
   151|             __KeyringFile="/usr/share/keyrings/raspbian-archive-keyring.gpg"
   152|             __LLDB_Package="liblldb-6.0-dev"
   153|             __UbuntuSuites=
   154|             if [[ -e "$__KeyringFile" ]]; then
   155|                 __Keyring="--keyring $__KeyringFile"
   156|             fi
   157|             ;;
   158|         riscv64)
   159|             __BuildArch=riscv64
   160|             __AlpineArch=riscv64
   161|             __AlpinePackages="${__AlpinePackages// lldb-dev/}"
   162|             __QEMUArch=riscv64
   163|             __UbuntuArch=riscv64
   164|             __UbuntuPackages="${__UbuntuPackages// libunwind8-dev/}"
   165|             unset __LLDB_Package
   166|             ;;
   167|         ppc64le)
   168|             __BuildArch=ppc64le
   169|             __AlpineArch=ppc64le
   170|             __QEMUArch=ppc64le
   171|             __UbuntuArch=ppc64el
   172|             __UbuntuRepo="http://ports.ubuntu.com/ubuntu-ports/"
   173|             __UbuntuPackages="${__UbuntuPackages// libunwind8-dev/}"
   174|             __UbuntuPackages="${__UbuntuPackages// libomp-dev/}"
   175|             __UbuntuPackages="${__UbuntuPackages// libomp5/}"
   176|             unset __LLDB_Package
   177|             ;;
   178|         s390x)
   179|             __BuildArch=s390x
   180|             __AlpineArch=s390x
   181|             __QEMUArch=s390x
   182|             __UbuntuArch=s390x
   183|             __UbuntuRepo="http://ports.ubuntu.com/ubuntu-ports/"
   184|             __UbuntuPackages="${__UbuntuPackages// libunwind8-dev/}"
   185|             __UbuntuPackages="${__UbuntuPackages// libomp-dev/}"
   186|             __UbuntuPackages="${__UbuntuPackages// libomp5/}"
   187|             unset __LLDB_Package
   188|             ;;
   189|         x64)
   190|             __BuildArch=x64
   191|             __AlpineArch=x86_64
   192|             __UbuntuArch=amd64
   193|             __FreeBSDArch=amd64
   194|             __FreeBSDMachineArch=amd64
   195|             __illumosArch=x86_64
   196|             __HaikuArch=x86_64
   197|             __UbuntuRepo="http://archive.ubuntu.com/ubuntu/"
   198|             ;;
   199|         x86)
   200|             __BuildArch=x86
   201|             __UbuntuArch=i386
   202|             __AlpineArch=x86
   203|             __UbuntuRepo="http://archive.ubuntu.com/ubuntu/"
   204|             ;;
   205|         lldb*)
   206|             version="$(echo "$lowerI" | tr -d '[:alpha:]-=')"
   207|             majorVersion="${version%%.*}"
   208|             [ -z "${version##*.*}" ] && minorVersion="${version#*.}"
   209|             if [ -z "$minorVersion" ]; then
   210|                 minorVersion=0
   211|             fi
   212|             if [ "$majorVersion" -le 6 ]; then
   213|                 version="$majorVersion.$minorVersion"
   214|             else
   215|                 version="$majorVersion"
   216|             fi
   217|             __LLDB_Package="liblldb-${version}-dev"
   218|             ;;
   219|         no-lldb)
   220|             unset __LLDB_Package
   221|             ;;
   222|         llvm*)
   223|             version="$(echo "$lowerI" | tr -d '[:alpha:]-=')"
   224|             __LLVM_MajorVersion="${version%%.*}"
   225|             [ -z "${version##*.*}" ] && __LLVM_MinorVersion="${version#*.}"
   226|             if [ -z "$__LLVM_MinorVersion" ]; then
   227|                 __LLVM_MinorVersion=0
   228|             fi
   229|             if [ "$__LLVM_MajorVersion" -gt 6 ]; then
   230|                 __LLVM_MinorVersion=
   231|             fi
   232|             ;;
   233|         xenial) # Ubuntu 16.04
   234|             if [[ "$__CodeName" != "jessie" ]]; then
   235|                 __CodeName=xenial
   236|             fi
   237|             ;;
   238|         zesty) # Ubuntu 17.04
   239|             if [[ "$__CodeName" != "jessie" ]]; then
   240|                 __CodeName=zesty
   241|             fi
   242|             ;;
   243|         bionic) # Ubuntu 18.04
   244|             if [[ "$__CodeName" != "jessie" ]]; then
   245|                 __CodeName=bionic
   246|             fi
   247|             ;;
   248|         focal) # Ubuntu 20.04
   249|             if [[ "$__CodeName" != "jessie" ]]; then
   250|                 __CodeName=focal
   251|             fi
   252|             ;;
   253|         jammy) # Ubuntu 22.04
   254|             if [[ "$__CodeName" != "jessie" ]]; then
   255|                 __CodeName=jammy
   256|             fi
   257|             ;;
   258|         noble) # Ubuntu 24.04
   259|             if [[ "$__CodeName" != "jessie" ]]; then
   260|                 __CodeName=noble
   261|             fi
   262|             if [[ -n "$__LLDB_Package" ]]; then
   263|                 __LLDB_Package="liblldb-18-dev"
   264|             fi
   265|             ;;
   266|         jessie) # Debian 8
   267|             __CodeName=jessie
   268|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   269|             if [[ -z "$__UbuntuRepo" ]]; then
   270|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   271|             fi
   272|             ;;
   273|         stretch) # Debian 9
   274|             __CodeName=stretch
   275|             __LLDB_Package="liblldb-6.0-dev"
   276|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   277|             if [[ -z "$__UbuntuRepo" ]]; then
   278|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   279|             fi
   280|             ;;
   281|         buster) # Debian 10
   282|             __CodeName=buster
   283|             __LLDB_Package="liblldb-6.0-dev"
   284|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   285|             if [[ -z "$__UbuntuRepo" ]]; then
   286|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   287|             fi
   288|             ;;
   289|         bullseye) # Debian 11
   290|             __CodeName=bullseye
   291|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   292|             if [[ -z "$__UbuntuRepo" ]]; then
   293|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   294|             fi
   295|             ;;
   296|         bookworm) # Debian 12
   297|             __CodeName=bookworm
   298|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   299|             if [[ -z "$__UbuntuRepo" ]]; then
   300|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   301|             fi
   302|             ;;
   303|         sid) # Debian sid
   304|             __CodeName=sid
   305|             __KeyringFile="/usr/share/keyrings/debian-archive-keyring.gpg"
   306|             if [[ -z "$__UbuntuRepo" ]]; then
   307|                 __UbuntuRepo="http://ftp.debian.org/debian/"
   308|             fi
   309|             ;;
   310|         tizen)
   311|             __CodeName=
   312|             __UbuntuRepo=
   313|             __Tizen=tizen
   314|             ;;
   315|         alpine*)
   316|             __CodeName=alpine
   317|             __UbuntuRepo=
   318|             if [[ "$lowerI" == "alpineedge" ]]; then
   319|                 __AlpineVersion=edge
   320|             else
   321|                 version="$(echo "$lowerI" | tr -d '[:alpha:]-=')"
   322|                 __AlpineMajorVersion="${version%%.*}"
   323|                 __AlpineMinorVersion="${version#*.}"
   324|                 __AlpineVersion="$__AlpineMajorVersion.$__AlpineMinorVersion"
   325|             fi
   326|             ;;
   327|         freebsd13)
   328|             __CodeName=freebsd
   329|             __SkipUnmount=1
   330|             ;;
   331|         freebsd14)
   332|             __CodeName=freebsd
   333|             __FreeBSDBase="14.0-RELEASE"
   334|             __FreeBSDABI="14"
   335|             __SkipUnmount=1
   336|             ;;
   337|         illumos)
   338|             __CodeName=illumos
   339|             __SkipUnmount=1
   340|             ;;
   341|         haiku)
   342|             __CodeName=haiku
   343|             __SkipUnmount=1
   344|             ;;
   345|         --skipunmount)
   346|             __SkipUnmount=1
   347|             ;;
   348|         --skipsigcheck)
   349|             __SkipSigCheck=1
   350|             ;;
   351|         --rootfsdir|-rootfsdir)
   352|             shift
   353|             __RootfsDir="$1"
   354|             ;;
   355|         --use-mirror)
   356|             __UseMirror=1
   357|             ;;
   358|         --use-jobs)
   359|             shift
   360|             MAXJOBS=$1
   361|             ;;
   362|         *)
   363|             __UnprocessedBuildArgs="$__UnprocessedBuildArgs $1"
   364|             ;;
   365|     esac
   366|     shift
   367| done
   368| case "$__AlpineVersion" in
   369|     3.14) __AlpinePackages+=" llvm11-libs" ;;
   370|     3.15) __AlpinePackages+=" llvm12-libs" ;;
   371|     3.16) __AlpinePackages+=" llvm13-libs" ;;
   372|     3.17) __AlpinePackages+=" llvm15-libs" ;;
   373|     edge) __AlpineLlvmLibsLookup=1 ;;
   374|     *)
   375|         if [[ "$__AlpineArch" =~ s390x|ppc64le ]]; then
   376|             __AlpineVersion=3.15 # minimum version that supports lldb-dev
   377|             __AlpinePackages+=" llvm12-libs"
   378|         elif [[ "$__AlpineArch" == "x86" ]]; then
   379|             __AlpineVersion=3.17 # minimum version that supports lldb-dev
   380|             __AlpinePackages+=" llvm15-libs"
   381|         elif [[ "$__AlpineArch" == "riscv64" ]]; then
   382|             __AlpineLlvmLibsLookup=1
   383|             __AlpineVersion=edge # minimum version with APKINDEX.tar.gz (packages archive)
   384|         else
   385|             __AlpineVersion=3.13 # 3.13 to maximize compatibility
   386|             __AlpinePackages+=" llvm10-libs"
   387|             if [[ "$__AlpineArch" == "armv7" ]]; then
   388|                 __AlpinePackages="${__AlpinePackages//numactl-dev/}"
   389|             fi
   390|         fi
   391| esac
   392| if [[ "$__AlpineVersion" =~ 3\.1[345] ]]; then
   393|     __AlpinePackages="${__AlpinePackages/compiler-rt/compiler-rt-static}"
   394| fi
   395| if [[ "$__BuildArch" == "armel" ]]; then
   396|     __LLDB_Package="lldb-3.5-dev"
   397| fi
   398| if [[ "$__CodeName" == "xenial" && "$__UbuntuArch" == "armhf" ]]; then
   399|     __UbuntuPackages="${__UbuntuPackages//libnuma-dev/}"
   400| fi
   401| __UbuntuPackages+=" ${__LLDB_Package:-}"
   402| if [[ -z "$__UbuntuRepo" ]]; then
   403|     __UbuntuRepo="http://ports.ubuntu.com/"
   404| fi
   405| if [[ -n "$__LLVM_MajorVersion" ]]; then
   406|     __UbuntuPackages+=" libclang-common-${__LLVM_MajorVersion}${__LLVM_MinorVersion:+.$__LLVM_MinorVersion}-dev"
   407| fi
   408| if [[ -z "$__RootfsDir" && -n "$ROOTFS_DIR" ]]; then
   409|     __RootfsDir="$ROOTFS_DIR"
   410| fi
   411| if [[ -z "$__RootfsDir" ]]; then
   412|     __RootfsDir="$__CrossDir/../../../.tools/rootfs/$__BuildArch"
   413| fi
   414| if [[ -d "$__RootfsDir" ]]; then
   415|     if [[ "$__SkipUnmount" == "0" ]]; then
   416|         umount "$__RootfsDir"/* || true
   417|     fi
   418|     rm -rf "$__RootfsDir"
   419| fi
   420| mkdir -p "$__RootfsDir"
   421| __RootfsDir="$( cd "$__RootfsDir" && pwd )"
   422| __hasWget=
   423| ensureDownloadTool()
   424| {
   425|     if command -v wget &> /dev/null; then
   426|         __hasWget=1
   427|     elif command -v curl &> /dev/null; then
   428|         __hasWget=0
   429|     else
   430|         >&2 echo "ERROR: either wget or curl is required by this script."
   431|         exit 1
   432|     fi
   433| }
   434| if [[ "$__CodeName" == "alpine" ]]; then
   435|     __ApkToolsVersion=2.12.11
   436|     __ApkToolsDir="$(mktemp -d)"
   437|     __ApkKeysDir="$(mktemp -d)"
   438|     arch="$(uname -m)"
   439|     ensureDownloadTool
   440|     if [[ "$__hasWget" == 1 ]]; then
   441|         wget -P "$__ApkToolsDir" "https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v$__ApkToolsVersion/$arch/apk.static"
   442|     else
   443|         curl -SLO --create-dirs --output-dir "$__ApkToolsDir" "https://gitlab.alpinelinux.org/api/v4/projects/5/packages/generic/v$__ApkToolsVersion/$arch/apk.static"
   444|     fi
   445|     if [[ "$arch" == "x86_64" ]]; then
   446|       __ApkToolsSHA512SUM="53e57b49230da07ef44ee0765b9592580308c407a8d4da7125550957bb72cb59638e04f8892a18b584451c8d841d1c7cb0f0ab680cc323a3015776affaa3be33"
   447|     elif [[ "$arch" == "aarch64" ]]; then
   448|       __ApkToolsSHA512SUM="9e2b37ecb2b56c05dad23d379be84fd494c14bd730b620d0d576bda760588e1f2f59a7fcb2f2080577e0085f23a0ca8eadd993b4e61c2ab29549fdb71969afd0"
   449|     else
   450|       echo "WARNING: add missing hash for your host architecture. To find the value, use: 'find /tmp -name apk.static -exec sha512sum {} \;'"
   451|     fi
   452|     echo "$__ApkToolsSHA512SUM $__ApkToolsDir/apk.static" | sha512sum -c
   453|     chmod +x "$__ApkToolsDir/apk.static"
   454|     if [[ -f "/usr/bin/qemu-$__QEMUArch-static" ]]; then
   455|         mkdir -p "$__RootfsDir"/usr/bin
   456|         cp -v "/usr/bin/qemu-$__QEMUArch-static" "$__RootfsDir/usr/bin"
   457|     fi
   458|     if [[ "$__AlpineVersion" == "edge" ]]; then
   459|         version=edge
   460|     else
   461|         version="v$__AlpineVersion"
   462|     fi
   463|     for line in $__AlpineKeys; do
   464|         id="${line%%:*}"
   465|         content="${line#*:}"
   466|         echo -e "-----BEGIN PUBLIC KEY-----\n$content\n-----END PUBLIC KEY-----" > "$__ApkKeysDir/alpine-devel@lists.alpinelinux.org-$id.rsa.pub"
   467|     done
   468|     if [[ "$__SkipSigCheck" == "1" ]]; then
   469|         __ApkSignatureArg="--allow-untrusted"
   470|     else
   471|         __ApkSignatureArg="--keys-dir $__ApkKeysDir"
   472|     fi
   473|     "$__ApkToolsDir/apk.static" \
   474|         -X "http://dl-cdn.alpinelinux.org/alpine/$version/main" \
   475|         -X "http://dl-cdn.alpinelinux.org/alpine/$version/community" \
   476|         -U $__ApkSignatureArg --root "$__RootfsDir" --arch "$__AlpineArch" --initdb add
   477|     if [[ "$__AlpineLlvmLibsLookup" == 1 ]]; then
   478|         __AlpinePackages+=" $("$__ApkToolsDir/apk.static" \
   479|             -X "http://dl-cdn.alpinelinux.org/alpine/$version/main" \
   480|             -X "http://dl-cdn.alpinelinux.org/alpine/$version/community" \
   481|             -U $__ApkSignatureArg --root "$__RootfsDir" --arch "$__AlpineArch" \
   482|             search 'llvm*-libs' | grep -E '^llvm' | sort | tail -1 | sed 's/-[^-]*//2g')"
   483|     fi
   484|     "$__ApkToolsDir/apk.static" \
   485|         -X "http://dl-cdn.alpinelinux.org/alpine/$version/main" \
   486|         -X "http://dl-cdn.alpinelinux.org/alpine/$version/community" \
   487|         -U $__ApkSignatureArg --root "$__RootfsDir" --arch "$__AlpineArch" \
   488|         add $__AlpinePackages
   489|     rm -r "$__ApkToolsDir"
   490| elif [[ "$__CodeName" == "freebsd" ]]; then
   491|     mkdir -p "$__RootfsDir"/usr/local/etc
   492|     JOBS=${MAXJOBS:="$(getconf _NPROCESSORS_ONLN)"}
   493|     ensureDownloadTool
   494|     if [[ "$__hasWget" == 1 ]]; then
   495|         wget -O- "https://download.freebsd.org/ftp/releases/${__FreeBSDArch}/${__FreeBSDMachineArch}/${__FreeBSDBase}/base.txz" | tar -C "$__RootfsDir" -Jxf - ./lib ./usr/lib ./usr/libdata ./usr/include ./usr/share/keys ./etc ./bin/freebsd-version
   496|     else
   497|         curl -SL "https://download.freebsd.org/ftp/releases/${__FreeBSDArch}/${__FreeBSDMachineArch}/${__FreeBSDBase}/base.txz" | tar -C "$__RootfsDir" -Jxf - ./lib ./usr/lib ./usr/libdata ./usr/include ./usr/share/keys ./etc ./bin/freebsd-version
   498|     fi
   499|     echo "ABI = \"FreeBSD:${__FreeBSDABI}:${__FreeBSDMachineArch}\"; FINGERPRINTS = \"${__RootfsDir}/usr/share/keys\"; REPOS_DIR = [\"${__RootfsDir}/etc/pkg\"]; REPO_AUTOUPDATE = NO; RUN_SCRIPTS = NO;" > "${__RootfsDir}"/usr/local/etc/pkg.conf
   500|     echo "FreeBSD: { url: \"pkg+http://pkg.FreeBSD.org/\${ABI}/quarterly\", mirror_type: \"srv\", signature_type: \"fingerprints\", fingerprints: \"${__RootfsDir}/usr/share/keys/pkg\", enabled: yes }" > "${__RootfsDir}"/etc/pkg/FreeBSD.conf
   501|     mkdir -p "$__RootfsDir"/tmp
   502|     if [[ "$__hasWget" == 1 ]]; then
   503|         wget -O- "https://github.com/freebsd/pkg/archive/${__FreeBSDPkg}.tar.gz" | tar -C "$__RootfsDir"/tmp -zxf -
   504|     else
   505|         curl -SL "https://github.com/freebsd/pkg/archive/${__FreeBSDPkg}.tar.gz" | tar -C "$__RootfsDir"/tmp -zxf -
   506|     fi
   507|     cd "$__RootfsDir/tmp/pkg-${__FreeBSDPkg}"
   508|     mkdir -p "$__RootfsDir"/host/etc
   509|     ./autogen.sh && ./configure --prefix="$__RootfsDir"/host && make -j "$JOBS" && make install
   510|     rm -rf "$__RootfsDir/tmp/pkg-${__FreeBSDPkg}"
   511|     INSTALL_AS_USER=$(whoami) "$__RootfsDir"/host/sbin/pkg -r "$__RootfsDir" -C "$__RootfsDir"/usr/local/etc/pkg.conf update
   512|     INSTALL_AS_USER=$(whoami) "$__RootfsDir"/host/sbin/pkg -r "$__RootfsDir" -C "$__RootfsDir"/usr/local/etc/pkg.conf install --yes $__FreeBSDPackages
   513| elif [[ "$__CodeName" == "illumos" ]]; then
   514|     mkdir "$__RootfsDir/tmp"
   515|     pushd "$__RootfsDir/tmp"
   516|     JOBS=${MAXJOBS:="$(getconf _NPROCESSORS_ONLN)"}
   517|     ensureDownloadTool
   518|     echo "Downloading sysroot."
   519|     if [[ "$__hasWget" == 1 ]]; then
   520|         wget -O- https://github.com/illumos/sysroot/releases/download/20181213-de6af22ae73b-v1/illumos-sysroot-i386-20181213-de6af22ae73b-v1.tar.gz | tar -C "$__RootfsDir" -xzf -
   521|     else
   522|         curl -SL https://github.com/illumos/sysroot/releases/download/20181213-de6af22ae73b-v1/illumos-sysroot-i386-20181213-de6af22ae73b-v1.tar.gz | tar -C "$__RootfsDir" -xzf -
   523|     fi
   524|     echo "Building binutils. Please wait.."
   525|     if [[ "$__hasWget" == 1 ]]; then
   526|         wget -O- https://ftp.gnu.org/gnu/binutils/binutils-2.42.tar.xz | tar -xJf -
   527|     else
   528|         curl -SL https://ftp.gnu.org/gnu/binutils/binutils-2.42.tar.xz | tar -xJf -
   529|     fi
   530|     mkdir build-binutils && cd build-binutils
   531|     ../binutils-2.42/configure --prefix="$__RootfsDir" --target="${__illumosArch}-sun-solaris2.11" --program-prefix="${__illumosArch}-illumos-" --with-sysroot="$__RootfsDir"
   532|     make -j "$JOBS" && make install && cd ..
   533|     echo "Building gcc. Please wait.."
   534|     if [[ "$__hasWget" == 1 ]]; then
   535|         wget -O- https://ftp.gnu.org/gnu/gcc/gcc-13.3.0/gcc-13.3.0.tar.xz | tar -xJf -
   536|     else
   537|         curl -SL https://ftp.gnu.org/gnu/gcc/gcc-13.3.0/gcc-13.3.0.tar.xz | tar -xJf -
   538|     fi
   539|     CFLAGS="-fPIC"
   540|     CXXFLAGS="-fPIC"
   541|     CXXFLAGS_FOR_TARGET="-fPIC"
   542|     CFLAGS_FOR_TARGET="-fPIC"
   543|     export CFLAGS CXXFLAGS CXXFLAGS_FOR_TARGET CFLAGS_FOR_TARGET
   544|     mkdir build-gcc && cd build-gcc
   545|     ../gcc-13.3.0/configure --prefix="$__RootfsDir" --target="${__illumosArch}-sun-solaris2.11" --program-prefix="${__illumosArch}-illumos-" --with-sysroot="$__RootfsDir" --with-gnu-as       \
   546|         --with-gnu-ld --disable-nls --disable-libgomp --disable-libquadmath --disable-libssp --disable-libvtv --disable-libcilkrts --disable-libada --disable-libsanitizer \
   547|         --disable-libquadmath-support --disable-shared --enable-tls
   548|     make -j "$JOBS" && make install && cd ..
   549|     BaseUrl=https://pkgsrc.smartos.org
   550|     if [[ "$__UseMirror" == 1 ]]; then
   551|         BaseUrl=https://pkgsrc.smartos.skylime.net
   552|     fi
   553|     BaseUrl="$BaseUrl/packages/SmartOS/2019Q4/${__illumosArch}/All"
   554|     echo "Downloading manifest"
   555|     if [[ "$__hasWget" == 1 ]]; then
   556|         wget "$BaseUrl"
   557|     else
   558|         curl -SLO "$BaseUrl"
   559|     fi
   560|     echo "Downloading dependencies."
   561|     read -ra array <<<"$__IllumosPackages"
   562|     for package in "${array[@]}"; do
   563|         echo "Installing '$package'"
   564|         package="$(sed -En '/.*href="('"$package"'-[0-9].*).tgz".*/h;$!d;g;s//\1/p' All)"
   565|         echo "Resolved name '$package'"
   566|         if [[ "$__hasWget" == 1 ]]; then
   567|             wget "$BaseUrl"/"$package".tgz
   568|         else
   569|             curl -SLO "$BaseUrl"/"$package".tgz
   570|         fi
   571|         ar -x "$package".tgz
   572|         tar --skip-old-files -xzf "$package".tmp.tg* -C "$__RootfsDir" 2>/dev/null
   573|     done
   574|     echo "Cleaning up temporary files."
   575|     popd
   576|     rm -rf "$__RootfsDir"/{tmp,+*}
   577|     mkdir -p "$__RootfsDir"/usr/include/net
   578|     mkdir -p "$__RootfsDir"/usr/include/netpacket
   579|     if [[ "$__hasWget" == 1 ]]; then
   580|         wget -P "$__RootfsDir"/usr/include/net https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/io/bpf/net/bpf.h
   581|         wget -P "$__RootfsDir"/usr/include/net https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/io/bpf/net/dlt.h
   582|         wget -P "$__RootfsDir"/usr/include/netpacket https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/inet/sockmods/netpacket/packet.h
   583|         wget -P "$__RootfsDir"/usr/include/sys https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/sys/sdt.h
   584|     else
   585|         curl -SLO --create-dirs --output-dir "$__RootfsDir"/usr/include/net https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/io/bpf/net/bpf.h
   586|         curl -SLO --create-dirs --output-dir "$__RootfsDir"/usr/include/net https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/io/bpf/net/dlt.h
   587|         curl -SLO --create-dirs --output-dir "$__RootfsDir"/usr/include/netpacket https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/inet/sockmods/netpacket/packet.h
   588|         curl -SLO --create-dirs --output-dir "$__RootfsDir"/usr/include/sys https://raw.githubusercontent.com/illumos/illumos-gate/master/usr/src/uts/common/sys/sdt.h
   589|     fi
   590| elif [[ "$__CodeName" == "haiku" ]]; then
   591|     JOBS=${MAXJOBS:="$(getconf _NPROCESSORS_ONLN)"}
   592|     echo "Building Haiku sysroot for $__HaikuArch"
   593|     mkdir -p "$__RootfsDir/tmp"
   594|     pushd "$__RootfsDir/tmp"
   595|     mkdir "$__RootfsDir/tmp/download"
   596|     ensureDownloadTool
   597|     echo "Downloading Haiku package tool"
   598|     git clone https://github.com/haiku/haiku-toolchains-ubuntu --depth 1 "$__RootfsDir/tmp/script"
   599|     if [[ "$__hasWget" == 1 ]]; then
   600|         wget -O "$__RootfsDir/tmp/download/hosttools.zip" "$("$__RootfsDir/tmp/script/fetch.sh" --hosttools)"
   601|     else
   602|         curl -SLo "$__RootfsDir/tmp/download/hosttools.zip" "$("$__RootfsDir/tmp/script/fetch.sh" --hosttools)"
   603|     fi
   604|     unzip -o "$__RootfsDir/tmp/download/hosttools.zip" -d "$__RootfsDir/tmp/bin"
   605|     DepotBaseUrl="https://depot.haiku-os.org/__api/v2/pkg/get-pkg"
   606|     HpkgBaseUrl="https://eu.hpkg.haiku-os.org/haiku/master/$__HaikuArch/current"
   607|     echo "Downloading Haiku packages"
   608|     read -ra array <<<"$__HaikuPackages"
   609|     for package in "${array[@]}"; do
   610|         echo "Downloading $package..."
   611|         if [[ "$__hasWget" == 1 ]]; then
   612|             hpkgDownloadUrl="$(wget -qO- --post-data '{"name":"'"$package"'","repositorySourceCode":"haikuports_'$__HaikuArch'","versionType":"LATEST","naturalLanguageCode":"en"}' \
   613|                 --header 'Content-Type:application/json' "$DepotBaseUrl" | jq -r '.result.versions[].hpkgDownloadURL')"
   614|             wget -P "$__RootfsDir/tmp/download" "$hpkgDownloadUrl"
   615|         else
   616|             hpkgDownloadUrl="$(curl -sSL -XPOST --data '{"name":"'"$package"'","repositorySourceCode":"haikuports_'$__HaikuArch'","versionType":"LATEST","naturalLanguageCode":"en"}' \
   617|                 --header 'Content-Type:application/json' "$DepotBaseUrl" | jq -r '.result.versions[].hpkgDownloadURL')"
   618|             curl -SLO --create-dirs --output-dir "$__RootfsDir/tmp/download" "$hpkgDownloadUrl"
   619|         fi
   620|     done
   621|     for package in haiku haiku_devel; do
   622|         echo "Downloading $package..."
   623|         if [[ "$__hasWget" == 1 ]]; then
   624|             hpkgVersion="$(wget -qO- "$HpkgBaseUrl" | sed -n 's/^.*version: "\([^"]*\)".*$/\1/p')"
   625|             wget -P "$__RootfsDir/tmp/download" "$HpkgBaseUrl/packages/$package-$hpkgVersion-1-$__HaikuArch.hpkg"
   626|         else
   627|             hpkgVersion="$(curl -sSL "$HpkgBaseUrl" | sed -n 's/^.*version: "\([^"]*\)".*$/\1/p')"
   628|             curl -SLO --create-dirs --output-dir "$__RootfsDir/tmp/download" "$HpkgBaseUrl/packages/$package-$hpkgVersion-1-$__HaikuArch.hpkg"
   629|         fi
   630|     done
   631|     echo "Setting up sysroot and extracting required packages"
   632|     mkdir -p "$__RootfsDir/boot/system"
   633|     for file in "$__RootfsDir/tmp/download/"*.hpkg; do
   634|         echo "Extracting $file..."
   635|         LD_LIBRARY_PATH="$__RootfsDir/tmp/bin" "$__RootfsDir/tmp/bin/package" extract -C "$__RootfsDir/boot/system" "$file"
   636|     done
   637|     echo "Downloading Haiku buildtools"
   638|     if [[ "$__hasWget" == 1 ]]; then
   639|         wget -O "$__RootfsDir/tmp/download/buildtools.zip" "$("$__RootfsDir/tmp/script/fetch.sh" --buildtools --arch=$__HaikuArch)"
   640|     else
   641|         curl -SLo "$__RootfsDir/tmp/download/buildtools.zip" "$("$__RootfsDir/tmp/script/fetch.sh" --buildtools --arch=$__HaikuArch)"
   642|     fi
   643|     unzip -o "$__RootfsDir/tmp/download/buildtools.zip" -d "$__RootfsDir"
   644|     echo "Cleaning up temporary files"
   645|     popd
   646|     rm -rf "$__RootfsDir/tmp"
   647| elif [[ -n "$__CodeName" ]]; then
   648|     if [[ "$__SkipSigCheck" == "0" ]]; then
   649|         __Keyring="$__Keyring --force-check-gpg"
   650|     fi
   651|     echo running debootstrap "--variant=minbase" $__Keyring --arch "$__UbuntuArch" "$__CodeName" "$__RootfsDir" "$__UbuntuRepo"
   652|     debootstrap "--variant=minbase" $__Keyring --arch "$__UbuntuArch" "$__CodeName" "$__RootfsDir" "$__UbuntuRepo"
   653|     mkdir -p "$__RootfsDir/etc/apt/sources.list.d/"
   654|     cat > "$__RootfsDir/etc/apt/sources.list.d/$__CodeName.sources" <<EOF
   655| Types: deb
   656| URIs: $__UbuntuRepo
   657| Suites: $__CodeName $(echo $__UbuntuSuites | xargs -n 1 | xargs -I {} echo -n "$__CodeName-{} ")
   658| Components: main universe
   659| Signed-By: $__KeyringFile
   660| EOF
   661|     chroot "$__RootfsDir" apt-get update
   662|     chroot "$__RootfsDir" apt-get -f -y install
   663|     chroot "$__RootfsDir" apt-get -y install $__UbuntuPackages
   664|     chroot "$__RootfsDir" symlinks -cr /usr
   665|     chroot "$__RootfsDir" apt-get clean
   666|     if [[ "$__SkipUnmount" == "0" ]]; then
   667|         umount "$__RootfsDir"/* || true
   668|     fi
   669|     if [[ "$__BuildArch" == "armel" && "$__CodeName" == "jessie" ]]; then
   670|         pushd "$__RootfsDir"
   671|         patch -p1 < "$__CrossDir/$__BuildArch/armel.jessie.patch"
   672|         popd
   673|     fi
   674| elif [[ "$__Tizen" == "tizen" ]]; then
   675|     ROOTFS_DIR="$__RootfsDir" "$__CrossDir/tizen-build-rootfs.sh" "$__BuildArch"
   676| else
   677|     echo "Unsupported target platform."
   678|     usage
   679| fi


# ====================================================================
# FILE: eng/common/cross/tizen-build-rootfs.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-69 ---
     1| set -e
     2| ARCH=$1
     3| LINK_ARCH=$ARCH
     4| case "$ARCH" in
     5|     arm)
     6|         TIZEN_ARCH="armv7hl"
     7|         ;;
     8|     armel)
     9|         TIZEN_ARCH="armv7l"
    10|         LINK_ARCH="arm"
    11|         ;;
    12|     arm64)
    13|         TIZEN_ARCH="aarch64"
    14|         ;;
    15|     x86)
    16|         TIZEN_ARCH="i686"
    17|         ;;
    18|     x64)
    19|         TIZEN_ARCH="x86_64"
    20|         LINK_ARCH="x86"
    21|         ;;
    22|     riscv64)
    23|         TIZEN_ARCH="riscv64"
    24|         LINK_ARCH="riscv"
    25|         ;;
    26|     *)
    27|         echo "Unsupported architecture for tizen: $ARCH"
    28|         exit 1
    29| esac
    30| __CrossDir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
    31| __TIZEN_CROSSDIR="$__CrossDir/${ARCH}/tizen"
    32| if [[ -z "$ROOTFS_DIR" ]]; then
    33|     echo "ROOTFS_DIR is not defined."
    34|     exit 1;
    35| fi
    36| TIZEN_TMP_DIR=$ROOTFS_DIR/tizen_tmp
    37| mkdir -p $TIZEN_TMP_DIR
    38| echo ">>Start downloading files"
    39| VERBOSE=1 $__CrossDir/tizen-fetch.sh $TIZEN_TMP_DIR $TIZEN_ARCH
    40| echo "<<Finish downloading files"
    41| echo ">>Start constructing Tizen rootfs"
    42| TIZEN_RPM_FILES=`ls $TIZEN_TMP_DIR/*.rpm`
    43| cd $ROOTFS_DIR
    44| for f in $TIZEN_RPM_FILES; do
    45|     rpm2cpio $f  | cpio -idm --quiet
    46| done
    47| echo "<<Finish constructing Tizen rootfs"
    48| rm -rf $TIZEN_TMP_DIR
    49| echo ">>Start configuring Tizen rootfs"
    50| ln -sfn asm-${LINK_ARCH} ./usr/include/asm
    51| patch -p1 < $__TIZEN_CROSSDIR/tizen.patch
    52| if [[ "$TIZEN_ARCH" == "riscv64" ]]; then
    53|     echo "Fixing broken symlinks in $PWD"
    54|     rm ./usr/lib64/libresolv.so
    55|     ln -s ../../lib64/libresolv.so.2 ./usr/lib64/libresolv.so
    56|     rm ./usr/lib64/libpthread.so
    57|     ln -s ../../lib64/libpthread.so.0 ./usr/lib64/libpthread.so
    58|     rm ./usr/lib64/libdl.so
    59|     ln -s ../../lib64/libdl.so.2 ./usr/lib64/libdl.so
    60|     rm ./usr/lib64/libutil.so
    61|     ln -s ../../lib64/libutil.so.1 ./usr/lib64/libutil.so
    62|     rm ./usr/lib64/libm.so
    63|     ln -s ../../lib64/libm.so.6 ./usr/lib64/libm.so
    64|     rm ./usr/lib64/librt.so
    65|     ln -s ../../lib64/librt.so.1 ./usr/lib64/librt.so
    66|     rm ./lib/ld-linux-riscv64-lp64d.so.1
    67|     ln -s ../lib64/ld-linux-riscv64-lp64d.so.1 ./lib/ld-linux-riscv64-lp64d.so.1
    68| fi
    69| echo "<<Finish configuring Tizen rootfs"


# ====================================================================
# FILE: eng/common/cross/tizen-fetch.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-145 ---
     1| set -e
     2| if [[ -z "${VERBOSE// }" ]] || [ "$VERBOSE" -ne "$VERBOSE" ] 2>/dev/null; then
     3|     VERBOSE=0
     4| fi
     5| Log()
     6| {
     7|     if [ $VERBOSE -ge 1 ]; then
     8|         echo ${@:2}
     9|     fi
    10| }
    11| Inform()
    12| {
    13|     Log 1 -e "\x1B[0;34m$@\x1B[m"
    14| }
    15| Debug()
    16| {
    17|     Log 2 -e "\x1B[0;32m$@\x1B[m"
    18| }
    19| Error()
    20| {
    21|     >&2 Log 0 -e "\x1B[0;31m$@\x1B[m"
    22| }
    23| Fetch()
    24| {
    25|     URL=$1
    26|     FILE=$2
    27|     PROGRESS=$3
    28|     if [ $VERBOSE -ge 1 ] && [ $PROGRESS ]; then
    29|         CURL_OPT="--progress-bar"
    30|     else
    31|         CURL_OPT="--silent"
    32|     fi
    33|     curl $CURL_OPT $URL > $FILE
    34| }
    35| hash curl 2> /dev/null || { Error "Require 'curl' Aborting."; exit 1; }
    36| hash xmllint 2> /dev/null || { Error "Require 'xmllint' Aborting."; exit 1; }
    37| hash sha256sum 2> /dev/null || { Error "Require 'sha256sum' Aborting."; exit 1; }
    38| TMPDIR=$1
    39| if [ ! -d $TMPDIR ]; then
    40|     TMPDIR=./tizen_tmp
    41|     Debug "Create temporary directory : $TMPDIR"
    42|     mkdir -p $TMPDIR
    43| fi
    44| TIZEN_ARCH=$2
    45| TIZEN_URL=http://download.tizen.org/snapshots/TIZEN/Tizen
    46| BUILD_XML=build.xml
    47| REPOMD_XML=repomd.xml
    48| PRIMARY_XML=primary.xml
    49| TARGET_URL="http://__not_initialized"
    50| Xpath_get()
    51| {
    52|     XPATH_RESULT=''
    53|     XPATH=$1
    54|     XML_FILE=$2
    55|     RESULT=$(xmllint --xpath $XPATH $XML_FILE)
    56|     if [[ -z ${RESULT// } ]]; then
    57|         Error "Can not find target from $XML_FILE"
    58|         Debug "Xpath = $XPATH"
    59|         exit 1
    60|     fi
    61|     XPATH_RESULT=$RESULT
    62| }
    63| fetch_tizen_pkgs_init()
    64| {
    65|     TARGET=$1
    66|     PROFILE=$2
    67|     Debug "Initialize TARGET=$TARGET, PROFILE=$PROFILE"
    68|     TMP_PKG_DIR=$TMPDIR/tizen_${PROFILE}_pkgs
    69|     if [ -d $TMP_PKG_DIR ]; then rm -rf $TMP_PKG_DIR; fi
    70|     mkdir -p $TMP_PKG_DIR
    71|     PKG_URL=$TIZEN_URL/$PROFILE/latest
    72|     BUILD_XML_URL=$PKG_URL/$BUILD_XML
    73|     TMP_BUILD=$TMP_PKG_DIR/$BUILD_XML
    74|     TMP_REPOMD=$TMP_PKG_DIR/$REPOMD_XML
    75|     TMP_PRIMARY=$TMP_PKG_DIR/$PRIMARY_XML
    76|     TMP_PRIMARYGZ=${TMP_PRIMARY}.gz
    77|     Fetch $BUILD_XML_URL $TMP_BUILD
    78|     Debug "fetch $BUILD_XML_URL to $TMP_BUILD"
    79|     TARGET_XPATH="//build/buildtargets/buildtarget[@name=\"$TARGET\"]/repo[@type=\"binary\"]/text()"
    80|     Xpath_get $TARGET_XPATH $TMP_BUILD
    81|     TARGET_PATH=$XPATH_RESULT
    82|     TARGET_URL=$PKG_URL/$TARGET_PATH
    83|     REPOMD_URL=$TARGET_URL/repodata/repomd.xml
    84|     PRIMARY_XPATH='string(//*[local-name()="data"][@type="primary"]/*[local-name()="location"]/@href)'
    85|     Fetch $REPOMD_URL $TMP_REPOMD
    86|     Debug "fetch $REPOMD_URL to $TMP_REPOMD"
    87|     Xpath_get $PRIMARY_XPATH $TMP_REPOMD
    88|     PRIMARY_XML_PATH=$XPATH_RESULT
    89|     PRIMARY_URL=$TARGET_URL/$PRIMARY_XML_PATH
    90|     Fetch $PRIMARY_URL $TMP_PRIMARYGZ
    91|     Debug "fetch $PRIMARY_URL to $TMP_PRIMARYGZ"
    92|     gunzip $TMP_PRIMARYGZ
    93|     Debug "unzip $TMP_PRIMARYGZ to $TMP_PRIMARY"
    94| }
    95| fetch_tizen_pkgs()
    96| {
    97|     ARCH=$1
    98|     PACKAGE_XPATH_TPL='string(//*[local-name()="metadata"]/*[local-name()="package"][*[local-name()="name"][text()="_PKG_"]][*[local-name()="arch"][text()="_ARCH_"]]/*[local-name()="location"]/@href)'
    99|     PACKAGE_CHECKSUM_XPATH_TPL='string(//*[local-name()="metadata"]/*[local-name()="package"][*[local-name()="name"][text()="_PKG_"]][*[local-name()="arch"][text()="_ARCH_"]]/*[local-name()="checksum"]/text())'
   100|     for pkg in ${@:2}
   101|     do
   102|         Inform "Fetching... $pkg"
   103|         XPATH=${PACKAGE_XPATH_TPL/_PKG_/$pkg}
   104|         XPATH=${XPATH/_ARCH_/$ARCH}
   105|         Xpath_get $XPATH $TMP_PRIMARY
   106|         PKG_PATH=$XPATH_RESULT
   107|         XPATH=${PACKAGE_CHECKSUM_XPATH_TPL/_PKG_/$pkg}
   108|         XPATH=${XPATH/_ARCH_/$ARCH}
   109|         Xpath_get $XPATH $TMP_PRIMARY
   110|         CHECKSUM=$XPATH_RESULT
   111|         PKG_URL=$TARGET_URL/$PKG_PATH
   112|         PKG_FILE=$(basename $PKG_PATH)
   113|         PKG_PATH=$TMPDIR/$PKG_FILE
   114|         Debug "Download $PKG_URL to $PKG_PATH"
   115|         Fetch $PKG_URL $PKG_PATH true
   116|         echo "$CHECKSUM $PKG_PATH" | sha256sum -c - > /dev/null
   117|         if [ $? -ne 0 ]; then
   118|             Error "Fail to fetch $PKG_URL to $PKG_PATH"
   119|             Debug "Checksum = $CHECKSUM"
   120|             exit 1
   121|         fi
   122|     done
   123| }
   124| if [ "$TIZEN_ARCH" == "riscv64" ]; then
   125|     BASE="Tizen-Base-RISCV"
   126|     UNIFIED="Tizen-Unified-RISCV"
   127| else
   128|     BASE="Tizen-Base"
   129|     UNIFIED="Tizen-Unified"
   130| fi
   131| Inform "Initialize ${TIZEN_ARCH} base"
   132| fetch_tizen_pkgs_init standard $BASE
   133| Inform "fetch common packages"
   134| fetch_tizen_pkgs ${TIZEN_ARCH} gcc gcc-devel-static glibc glibc-devel libicu libicu-devel libatomic linux-glibc-devel keyutils keyutils-devel libkeyutils
   135| Inform "fetch coreclr packages"
   136| fetch_tizen_pkgs ${TIZEN_ARCH} libgcc libstdc++ libstdc++-devel libunwind libunwind-devel lttng-ust-devel lttng-ust userspace-rcu-devel userspace-rcu
   137| if [ "$TIZEN_ARCH" != "riscv64" ]; then
   138|     fetch_tizen_pkgs ${TIZEN_ARCH} lldb lldb-devel
   139| fi
   140| Inform "fetch corefx packages"
   141| fetch_tizen_pkgs ${TIZEN_ARCH} libcom_err libcom_err-devel zlib zlib-devel libopenssl11 libopenssl1.1-devel krb5 krb5-devel
   142| Inform "Initialize standard unified"
   143| fetch_tizen_pkgs_init standard $UNIFIED
   144| Inform "fetch corefx packages"
   145| fetch_tizen_pkgs ${TIZEN_ARCH} gssdp gssdp-devel tizen-release


# ====================================================================
# FILE: eng/common/darc-init.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-66 ---
     1| source="${BASH_SOURCE[0]}"
     2| darcVersion=''
     3| versionEndpoint='https://maestro.dot.net/api/assets/darc-version?api-version=2020-02-20'
     4| verbosity='minimal'
     5| while [[ $# > 0 ]]; do
     6|   opt="$(echo "$1" | tr "[:upper:]" "[:lower:]")"
     7|   case "$opt" in
     8|     --darcversion)
     9|       darcVersion=$2
    10|       shift
    11|       ;;
    12|     --versionendpoint)
    13|       versionEndpoint=$2
    14|       shift
    15|       ;;
    16|     --verbosity)
    17|       verbosity=$2
    18|       shift
    19|       ;;
    20|     --toolpath)
    21|       toolpath=$2
    22|       shift
    23|       ;;
    24|     *)
    25|       echo "Invalid argument: $1"
    26|       usage
    27|       exit 1
    28|       ;;
    29|   esac
    30|   shift
    31| done
    32| while [[ -h "$source" ]]; do
    33|   scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
    34|   source="$(readlink "$source")"
    35|   [[ $source != /* ]] && source="$scriptroot/$source"
    36| done
    37| scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
    38| . "$scriptroot/tools.sh"
    39| if [ -z "$darcVersion" ]; then
    40|   darcVersion=$(curl -X GET "$versionEndpoint" -H "accept: text/plain")
    41| fi
    42| function InstallDarcCli {
    43|   local darc_cli_package_name="microsoft.dotnet.darc"
    44|   InitializeDotNetCli true
    45|   local dotnet_root=$_InitializeDotNetCli
    46|   if [ -z "$toolpath" ]; then
    47|     local tool_list=$($dotnet_root/dotnet tool list -g)
    48|     if [[ $tool_list = *$darc_cli_package_name* ]]; then
    49|       echo $($dotnet_root/dotnet tool uninstall $darc_cli_package_name -g)
    50|     fi
    51|   else
    52|     local tool_list=$($dotnet_root/dotnet tool list --tool-path "$toolpath")
    53|     if [[ $tool_list = *$darc_cli_package_name* ]]; then
    54|       echo $($dotnet_root/dotnet tool uninstall $darc_cli_package_name --tool-path "$toolpath")
    55|     fi
    56|   fi
    57|   local arcadeServicesSource="https://pkgs.dev.azure.com/dnceng/public/_packaging/dotnet-tools/nuget/v3/index.json"
    58|   echo "Installing Darc CLI version $darcVersion..."
    59|   echo "You may need to restart your command shell if this is the first dotnet tool you have installed."
    60|   if [ -z "$toolpath" ]; then
    61|     echo $($dotnet_root/dotnet tool install $darc_cli_package_name --version $darcVersion --add-source "$arcadeServicesSource" -v $verbosity -g)
    62|   else
    63|     echo $($dotnet_root/dotnet tool install $darc_cli_package_name --version $darcVersion --add-source "$arcadeServicesSource" -v $verbosity --tool-path "$toolpath")
    64|   fi
    65| }
    66| InstallDarcCli


# ====================================================================
# FILE: eng/common/dotnet-install.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-81 ---
     1| source="${BASH_SOURCE[0]}"
     2| while [[ -h "$source" ]]; do
     3|   scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
     4|   source="$(readlink "$source")"
     5|   [[ $source != /* ]] && source="$scriptroot/$source"
     6| done
     7| scriptroot="$( cd -P "$( dirname "$source" )" && pwd )"
     8| . "$scriptroot/tools.sh"
     9| version='Latest'
    10| architecture=''
    11| runtime='dotnet'
    12| runtimeSourceFeed=''
    13| runtimeSourceFeedKey=''
    14| while [[ $# > 0 ]]; do
    15|   opt="$(echo "$1" | tr "[:upper:]" "[:lower:]")"
    16|   case "$opt" in
    17|     -version|-v)
    18|       shift
    19|       version="$1"
    20|       ;;
    21|     -architecture|-a)
    22|       shift
    23|       architecture="$1"
    24|       ;;
    25|     -runtime|-r)
    26|       shift
    27|       runtime="$1"
    28|       ;;
    29|     -runtimesourcefeed)
    30|       shift
    31|       runtimeSourceFeed="$1"
    32|       ;;
    33|     -runtimesourcefeedkey)
    34|       shift
    35|       runtimeSourceFeedKey="$1"
    36|       ;;
    37|     *)
    38|       Write-PipelineTelemetryError -Category 'Build' -Message "Invalid argument: $1"
    39|       exit 1
    40|       ;;
    41|   esac
    42|   shift
    43| done
    44| cpuname=$(uname -m)
    45| case $cpuname in
    46|   arm64|aarch64)
    47|     buildarch=arm64
    48|     if [ "$(getconf LONG_BIT)" -lt 64 ]; then
    49|         buildarch=arm
    50|     fi
    51|     ;;
    52|   loongarch64)
    53|     buildarch=loongarch64
    54|     ;;
    55|   amd64|x86_64)
    56|     buildarch=x64
    57|     ;;
    58|   armv*l)
    59|     buildarch=arm
    60|     ;;
    61|   i[3-6]86)
    62|     buildarch=x86
    63|     ;;
    64|   riscv64)
    65|     buildarch=riscv64
    66|     ;;
    67|   *)
    68|     echo "Unknown CPU $cpuname detected, treating it as x64"
    69|     buildarch=x64
    70|     ;;
    71| esac
    72| dotnetRoot="${repo_root}.dotnet"
    73| if [[ $architecture != "" ]] && [[ $architecture != $buildarch ]]; then
    74|   dotnetRoot="$dotnetRoot/$architecture"
    75| fi
    76| InstallDotNet "$dotnetRoot" $version "$architecture" $runtime true $runtimeSourceFeed $runtimeSourceFeedKey || {
    77|   local exit_code=$?
    78|   Write-PipelineTelemetryError -Category 'InitializeToolset' -Message "dotnet-install.sh failed (exit code '$exit_code')." >&2
    79|   ExitWithExitCode $exit_code
    80| }
    81| ExitWithExitCode 0

