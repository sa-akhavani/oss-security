--- a/app/bundles/AssetBundle/Form/Type/AssetType.php
+++ b/app/bundles/AssetBundle/Form/Type/AssetType.php
@@ -11,39 +11,38 @@
 use Symfony\Component\Form\AbstractType;
 use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
 use Symfony\Component\Form\Extension\Core\Type\HiddenType;
 use Symfony\Component\Form\Extension\Core\Type\LocaleType;
 use Symfony\Component\Form\Extension\Core\Type\TextareaType;
 use Symfony\Component\Form\Extension\Core\Type\TextType;
 use Symfony\Component\Form\FormBuilderInterface;
 use Symfony\Component\OptionsResolver\OptionsResolver;
 use Symfony\Component\Translation\TranslatorInterface;
 use Symfony\Component\Validator\Constraints\NotBlank;
-use Symfony\Component\Validator\Constraints\Url;
 class AssetType extends AbstractType
 {
     /**
      * @var TranslatorInterface
      */
     private $translator;
     /**
      * @var AssetModel
      */
     private $assetModel;
     public function __construct(TranslatorInterface $translator, AssetModel $assetModel)
     {
         $this->translator = $translator;
         $this->assetModel = $assetModel;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('asset.asset', $options));
         $builder->add('storageLocation', ButtonGroupType::class, [
             'label'   => 'mautic.asset.asset.form.storageLocation',
             'choices' => [
                 'mautic.asset.asset.form.storageLocation.local'  => 'local',
                 'mautic.asset.asset.form.storageLocation.remote' => 'remote',
             ],
             'attr'              => [
                 'onchange' => 'Mautic.changeAssetStorageLocation();',
             ],
@@ -74,31 +73,24 @@
                     'tooltip'      => 'mautic.asset.asset.form.disallow.crawlers.descr',
                     'data-show-on' => '{"asset_storageLocation_0":"checked"}',
                 ],
                 'data'=> empty($options['data']->getDisallow()) ? false : true,
             ]
         );
         $builder->add(
             'remotePath',
             TextType::class,
             [
-                'label'       => 'mautic.asset.asset.form.remotePath',
-                'label_attr'  => ['class' => 'control-label'],
-                'attr'        => ['class' => 'form-control'],
-                'required'    => false,
-                'constraints' => [
-                    new Url(
-                        [
-                            'message' => 'mautic.asset.validation.error.url',
-                        ]
-                    ),
-                ],
+                'label'      => 'mautic.asset.asset.form.remotePath',
+                'label_attr' => ['class' => 'control-label'],
+                'attr'       => ['class' => 'form-control'],
+                'required'   => false,
             ]
         );
         $builder->add(
             'title',
             TextType::class,
             [
                 'label'      => 'mautic.core.title',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]

--- a/app/bundles/CampaignBundle/Form/Type/CampaignType.php
+++ b/app/bundles/CampaignBundle/Form/Type/CampaignType.php
@@ -27,21 +27,21 @@
      * @var TranslatorInterface
      */
     private $translator;
     public function __construct(CorePermissions $security, TranslatorInterface $translator)
     {
         $this->security   = $security;
         $this->translator = $translator;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('campaign', $options));
         $builder->add('name', TextType::class, [
             'label'      => 'mautic.core.name',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control'],
         ]);
         $builder->add('description', TextareaType::class, [
             'label'      => 'mautic.core.description',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control editor'],

--- a/app/bundles/CategoryBundle/Form/Type/CategoryType.php
+++ b/app/bundles/CategoryBundle/Form/Type/CategoryType.php
@@ -16,21 +16,21 @@
     /**
      * @var Session
      */
     private $session;
     public function __construct(Session $session)
     {
         $this->session = $session;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber([]));
         $builder->addEventSubscriber(new FormExitSubscriber('category.category', $options));
         if (!$options['data']->getId()) {
             if (true == $options['show_bundle_select']) {
                 $selected = $this->session->get('mautic.category.type', 'category');
                 $builder->add(
                     'bundle',
                     CategoryBundlesType::class,
                     [
                         'label'      => 'mautic.core.type',
                         'label_attr' => ['class' => 'control-label'],

--- a/app/bundles/DashboardBundle/Controller/DashboardController.php
+++ b/app/bundles/DashboardBundle/Controller/DashboardController.php
@@ -467,14 +467,13 @@
             ]
         );
     }
     /**
      * Gets name from request and defaults it to the timestamp if not provided.
      *
      * @return string
      */
     private function getNameFromRequest()
     {
-        $name = $this->request->get('name', (new \DateTime())->format('Y-m-dTH:i:s'));
-        return InputHelper::clean($name);
+        return $this->request->get('name', (new \DateTime())->format('Y-m-dTH:i:s'));
     }
 }

--- a/app/bundles/DynamicContentBundle/Form/Type/DynamicContentType.php
+++ b/app/bundles/DynamicContentBundle/Form/Type/DynamicContentType.php
@@ -72,21 +72,21 @@
         }
         $this->deviceTypesChoices  = array_combine(DeviceParser::getAvailableDeviceTypeNames(), DeviceParser::getAvailableDeviceTypeNames());
         $this->deviceBrandsChoices = DeviceParser::$deviceBrands;
         $this->deviceOsChoices     = array_combine(
             array_keys(OperatingSystem::getAvailableOperatingSystemFamilies()),
             array_keys(OperatingSystem::getAvailableOperatingSystemFamilies())
         );
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('dynamicContent.dynamicContent', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.dynamicContent.form.internal.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/EmailBundle/Form/Type/ConfigType.php
+++ b/app/bundles/EmailBundle/Form/Type/ConfigType.php
@@ -30,25 +30,25 @@
         $this->translator    = $translator;
         $this->transportType = $transportType;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
         $builder->addEventSubscriber(
             new CleanFormSubscriber(
                 [
                     'mailer_from_email'      => 'email',
                     'mailer_return_path'     => 'email',
-                    'default_signature_text' => 'strict_html',
-                    'unsubscribe_text'       => 'strict_html',
-                    'unsubscribe_message'    => 'strict_html',
-                    'resubscribe_message'    => 'strict_html',
-                    'webview_text'           => 'strict_html',
+                    'default_signature_text' => 'html',
+                    'unsubscribe_text'       => 'html',
+                    'unsubscribe_message'    => 'html',
+                    'resubscribe_message'    => 'html',
+                    'webview_text'           => 'html',
                     'mailer_custom_headers'  => 'clean',
                 ]
             )
         );
         $builder->add(
             'unsubscribe_text',
             TextareaType::class,
             [
                 'label'      => 'mautic.email.config.unsubscribe_text',
                 'label_attr' => ['class' => 'control-label'],

--- a/app/bundles/FormBundle/Form/Type/ActionType.php
+++ b/app/bundles/FormBundle/Form/Type/ActionType.php
@@ -11,21 +11,21 @@
 /**
  * Class ActionType.
  */
 class ActionType extends AbstractType
 {
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $masks = ['description' => 'strict_html'];
+        $masks = ['description' => 'html'];
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
                 'required'   => false,
             ]
         );

--- a/app/bundles/FormBundle/Form/Type/FormType.php
+++ b/app/bundles/FormBundle/Form/Type/FormType.php
@@ -24,21 +24,21 @@
     private $security;
     public function __construct(CorePermissions $security)
     {
         $this->security = $security;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('form.form', $options));
         $builder->add('name', TextType::class, [
             'label'      => 'mautic.core.name',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control'],
         ]);
         $builder->add('formAttributes', TextType::class, [
             'label'      => 'mautic.form.field.form.form_attr',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => [

--- a/app/bundles/LeadBundle/Controller/CompanyController.php
+++ b/app/bundles/LeadBundle/Controller/CompanyController.php
@@ -682,31 +682,27 @@
      * Company Merge function.
      *
      * @param $objectId
      *
      * @return array|JsonResponse|\Symfony\Component\HttpFoundation\RedirectResponse|\Symfony\Component\HttpFoundation\Response
      */
     public function mergeAction($objectId)
     {
         $permissions = $this->get('mautic.security')->isGranted(
             [
-                'lead:leads:viewown',
                 'lead:leads:viewother',
                 'lead:leads:create',
                 'lead:leads:editother',
                 'lead:leads:deleteother',
             ],
             'RETURN_ARRAY'
         );
-        if (!$permissions['lead:leads:viewown'] && !$permissions['lead:leads:viewother']) {
-            return $this->accessDenied();
-        }
         /** @var CompanyModel $model */
         $model            = $this->getModel('lead.company');
         $secondaryCompany = $model->getEntity($objectId);
         $page             = $this->get('session')->get('mautic.lead.page', 1);
         $returnUrl = $this->generateUrl('mautic_company_index', ['page' => $page]);
         $postActionVars = [
             'returnUrl'       => $returnUrl,
             'viewParameters'  => ['page' => $page],
             'contentTemplate' => 'MauticLeadBundle:Company:index',
             'passthroughVars' => [

--- a/app/bundles/LeadBundle/Controller/LeadController.php
+++ b/app/bundles/LeadBundle/Controller/LeadController.php
@@ -164,39 +164,20 @@
                     'route'         => $this->generateUrl('mautic_contact_index', ['page' => $page]),
                 ],
             ]
         );
     }
     /**
      * @return JsonResponse|Response
      */
     public function quickAddAction()
     {
-        $permissions = $this->get('mautic.security')->isGranted(
-            [
-                'lead:leads:viewown',
-                'lead:leads:viewother',
-                'lead:leads:create',
-                'lead:leads:editown',
-                'lead:leads:editother',
-            ],
-            'RETURN_ARRAY'
-        );
-        if (
-            !$permissions['lead:leads:viewown']
-            && !$permissions['lead:leads:viewother']
-            && !$permissions['lead:leads:create']
-            && !$permissions['lead:leads:editown']
-            && !$permissions['lead:leads:editother']
-        ) {
-            return $this->accessDenied();
-        }
         /** @var \Mautic\LeadBundle\Model\LeadModel $model */
         $model = $this->getModel('lead.lead');
         $action = $this->generateUrl('mautic_contact_action', ['objectAction' => 'new', 'qf' => 1]);
         $fields = $this->getModel('lead.field')->getEntities(
             [
                 'filter' => [
                     'force' => [
                         [
                             'column' => 'f.isPublished',
                             'expr'   => 'eq',
@@ -1584,23 +1565,20 @@
     }
     /**
      * Bulk edit lead owner.
      *
      * @param int $objectId
      *
      * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
      */
     public function batchOwnersAction($objectId = 0)
     {
-        if (!$this->get('mautic.security')->isGranted('user:users:view')) {
-            return $this->accessDenied();
-        }
         if ('POST' == $this->request->getMethod()) {
             /** @var \Mautic\LeadBundle\Model\LeadModel $model */
             $model = $this->getModel('lead');
             $data  = $this->request->request->get('lead_batch_owner', [], true);
             $ids   = json_decode($data['ids'], true);
             $entities = [];
             if (is_array($ids)) {
                 $entities = $model->getEntities(
                     [
                         'filter' => [

--- a/app/bundles/LeadBundle/Form/Type/ListType.php
+++ b/app/bundles/LeadBundle/Form/Type/ListType.php
@@ -25,21 +25,21 @@
      * @var ListModel
      */
     private $listModel;
     public function __construct(TranslatorInterface $translator, ListModel $listModel)
     {
         $this->translator = $translator;
         $this->listModel  = $listModel;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('lead.list', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/LeadBundle/Form/Type/NoteType.php
+++ b/app/bundles/LeadBundle/Form/Type/NoteType.php
@@ -16,21 +16,21 @@
     /**
      * @var DateTimeHelper
      */
     private $dateHelper;
     public function __construct()
     {
         $this->dateHelper = new DateTimeHelper();
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['text' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['text' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('lead.note', $options));
         $builder->add(
             'text',
             TextareaType::class,
             [
                 'label'      => 'mautic.lead.note.form.text',
                 'label_attr' => ['class' => 'control-label sr-only'],
                 'attr'       => ['class' => 'mousetrap form-control editor', 'rows' => 10, 'autofocus' => 'autofocus'],
             ]
         );

--- a/app/bundles/NotificationBundle/Form/Type/MobileNotificationType.php
+++ b/app/bundles/NotificationBundle/Form/Type/MobileNotificationType.php
@@ -15,21 +15,21 @@
 use Symfony\Component\Form\Extension\Core\Type\UrlType;
 use Symfony\Component\Form\FormBuilderInterface;
 use Symfony\Component\OptionsResolver\OptionsResolver;
 /**
  * Class NotificationType.
  */
 class MobileNotificationType extends AbstractType
 {
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html', 'description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('notification.notification', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.notification.form.internal.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/NotificationBundle/Form/Type/NotificationType.php
+++ b/app/bundles/NotificationBundle/Form/Type/NotificationType.php
@@ -15,21 +15,21 @@
 use Symfony\Component\Form\Extension\Core\Type\UrlType;
 use Symfony\Component\Form\FormBuilderInterface;
 use Symfony\Component\OptionsResolver\OptionsResolver;
 /**
  * Class NotificationType.
  */
 class NotificationType extends AbstractType
 {
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html', 'description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('notification.notification', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.notification.form.internal.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/PointBundle/Form/Type/PointType.php
+++ b/app/bundles/PointBundle/Form/Type/PointType.php
@@ -23,21 +23,21 @@
     private $security;
     public function __construct(CorePermissions $security)
     {
         $this->security = $security;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('point', $options));
         $builder->add(
             'name',
             TextType::class, [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );
         $builder->add(

--- a/app/bundles/PointBundle/Form/Type/TriggerType.php
+++ b/app/bundles/PointBundle/Form/Type/TriggerType.php
@@ -23,21 +23,21 @@
     private $security;
     public function __construct(CorePermissions $security)
     {
         $this->security = $security;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('point', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/ReportBundle/Form/Type/ReportType.php
+++ b/app/bundles/ReportBundle/Form/Type/ReportType.php
@@ -26,21 +26,21 @@
     private $reportModel;
     public function __construct(ReportModel $reportModel)
     {
         $this->reportModel = $reportModel;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('report', $options));
         if (!($options['attr']['readonly'] ?? false)) {
             $builder->add(
                 'name',
                 TextType::class,
                 [
                     'label'      => 'mautic.core.name',
                     'label_attr' => ['class' => 'control-label'],
                     'attr'       => ['class' => 'form-control'],
                     'required'   => true,

--- a/app/bundles/ReportBundle/Model/ReportModel.php
+++ b/app/bundles/ReportBundle/Model/ReportModel.php
@@ -486,25 +486,21 @@
                             'type'    => $availableGraphs[$g]['type'],
                         ];
                     }
                 }
                 $event = new ReportGraphEvent($entity, $eventGraphs, $query);
                 $this->dispatcher->dispatch(ReportEvents::REPORT_ON_GRAPH_GENERATE, $event);
                 $graphs = $event->getGraphs();
                 unset($defaultGraphOptions);
             }
         }
-        $columnsAllowed = $this->getColumnList($entity->getSource());
-        $order          = $this->getOrderBySanitized($order, $columnsAllowed);
-        if ($order['hasOrderBy']) {
-            $query->add('orderBy', $order['orderBy']);
-        }
+        $query->add('orderBy', $order);
         $event = new ReportQueryEvent($entity, $query, $totalResults, $dataOptions);
         $this->dispatcher->dispatch(ReportEvents::REPORT_QUERY_PRE_EXECUTE, $event);
         $query = $event->getQuery();
         if (empty($options['ignoreTableData']) && !empty($selectedColumns)) {
             if ($paginate) {
                 $limit = $this->session->get('mautic.report.'.$entity->getId().'.limit', $this->defaultPageLimit);
                 if (!empty($options['limit'])) {
                     $limit      = $options['limit'];
                     $reportPage = $options['page'];
                 }
@@ -561,62 +557,20 @@
             'graphs'            => $graphs,
             'contentTemplate'   => $contentTemplate,
             'columns'           => $tableDetails['columns'],
             'limit'             => ($paginate) ? $limit : 0,
             'page'              => ($paginate) ? $reportPage : 1,
             'dateFrom'          => $dataOptions['dateFrom'],
             'dateTo'            => $dataOptions['dateTo'],
             'debug'             => $debugData,
             'aggregatorColumns' => $dataAggregatorColumns,
         ];
-    }
-    /**
-     * Sanitize order by array comparing it to the allowed columns.
-     *
-     * @param iterable<mixed> $orderBys
-     *
-     * @return iterable<mixed>
-     */
-    private function getOrderBySanitized(iterable $orderBys, \stdClass $allowedColumns): iterable
-    {
-        $hasOrderBy = false;
-        foreach ($orderBys as $key => $orderBy) {
-            if ($this->orderByIsValid($orderBy, $allowedColumns)) {
-                $hasOrderBy = true;
-                continue;
-            }
-            $orderBys[$key] = '';
-        }
-        return [
-            'orderBy'    => $orderBys,
-            'hasOrderBy' => $hasOrderBy,
-        ];
-    }
-    /**
-     * Check if order by is valid.
-     */
-    private function orderByIsValid(string $order, \stdClass $allowedColumns): bool
-    {
-        if (empty($order)) {
-            return false;
-        }
-        $orderBy         = $order;
-        $oderByDirection = '';
-        if (str_contains($order, ' ')) {
-            $orderTemp       = explode(' ', $order);
-            $orderBy         = $orderTemp[0];
-            $oderByDirection = $orderTemp[1];
-        }
-        if (!array_key_exists($orderBy, $allowedColumns->choices) || !in_array($oderByDirection, ['ASC', 'DESC', ''])) {
-            return false;
-        }
-        return true;
     }
     /**
      * @return mixed
      */
     public function getReportsWithGraphs()
     {
         $ownedBy = $this->security->isGranted('report:reports:viewother') ? null : $this->userHelper->getUser()->getId();
         return $this->getRepository()->findReportsWithGraphs($ownedBy);
     }
     /**

--- a/app/bundles/ReportBundle/Views/Report/details_data.html.php
+++ b/app/bundles/ReportBundle/Views/Report/details_data.html.php
@@ -12,35 +12,36 @@
 }
 $showGraphsAboveTable = (true === !empty($report->getSettings()['showGraphsAboveTable']));
 $dataCount            = count($data);
 $columnOrder          = $report->getColumns();
 $graphOrder           = $report->getGraphs();
 $aggregatorOrder      = $report->getAggregators();
 $aggregatorCount      = count($aggregatorOrder);
 $groupBy              = $report->getGroupBy();
 $groupByCount         = count($groupBy);
 $startCount           = ($totalResults > $limit) ? ($reportPage * $limit) - $limit + 1 : 1;
-$getTotal             = function ($a, $f, $t, $allrows, $ac) {
+function getTotal($a, $f, $t, $allrows, $ac)
+{
     switch ($f) {
         case 'COUNT':
         case 'SUM':
             return (int) $t + (int) $a;
         case 'AVG':
             return ($ac == $allrows) ? round(((int) $t + (int) $a) / (int) $allrows, 2) : (int) $t + (int) $a;
         case 'MAX':
             return ((int) $a >= (int) $t) ? (int) $a : (int) $t;
         case 'MIN':
             return ((int) $a <= (int) $t) ? (int) $a : (int) $t;
         default:
             return (int) $t;
     }
-};
+}
 $graphContent = $view->render(
     'MauticReportBundle:Report:details_data_graphs.html.php',
     [
         'graphOrder' => $graphOrder,
         'graphs'     => $graphs,
         'report'     => $report,
     ]
 );
 ?>
 <?php if (!empty($showGraphsAboveTable)): echo $graphContent; endif; ?>
@@ -137,21 +138,21 @@
                                 <?php endforeach; ?>
                                 <?php
                                 if ($aggregatorCount) :
                                     $index = 0;
                                     ++$avgCounter;
                                     foreach ($aggregatorOrder as $aggregator): ?>
                                         <td>
                                             <?php
                                             if (isset($row[$aggregator['function'].' '.$aggregator['column']])) {
                                                 echo $view['formatter']->_($row[$aggregator['function'].' '.$aggregator['column']], 'text');
-                                                $total[$index] = $getTotal($row[$aggregator['function'].' '.$aggregator['column']], $aggregator['function'], (isset($total[$index])) ? $total[$index] : 0, $dataCount, $avgCounter);
+                                                $total[$index] = getTotal($row[$aggregator['function'].' '.$aggregator['column']], $aggregator['function'], (isset($total[$index])) ? $total[$index] : 0, $dataCount, $avgCounter);
                                             }
                                             ?>
                                         </td>
                                         <?php
                                         ++$index;
                                     endforeach;
                                 endif;
                                 ?>
                             </tr>
                             <?php ++$startCount; ?>

--- a/app/bundles/SmsBundle/Form/Type/SmsType.php
+++ b/app/bundles/SmsBundle/Form/Type/SmsType.php
@@ -25,21 +25,21 @@
     /**
      * @var EntityManager
      */
     private $em;
     public function __construct(EntityManager $em)
     {
         $this->em = $em;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html', 'description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('sms.sms', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.sms.form.internal.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/StageBundle/Form/Type/StageType.php
+++ b/app/bundles/StageBundle/Form/Type/StageType.php
@@ -22,21 +22,21 @@
     private $security;
     public function __construct(CorePermissions $security)
     {
         $this->security = $security;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('stage', $options));
         $builder->add('description', TextareaType::class, [
             'label'      => 'mautic.core.description',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control editor'],
             'required'   => false,
         ]);
         $builder->add('name', TextType::class, [
             'label'      => 'mautic.core.name',
             'label_attr' => [

--- a/app/bundles/UserBundle/Form/Type/RoleType.php
+++ b/app/bundles/UserBundle/Form/Type/RoleType.php
@@ -11,21 +11,21 @@
 use Symfony\Component\Form\FormBuilderInterface;
 use Symfony\Component\OptionsResolver\OptionsResolver;
 use Symfony\Component\Validator\Constraints\Valid;
 class RoleType extends AbstractType
 {
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('user.role', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/app/bundles/UserBundle/Form/Type/UserType.php
+++ b/app/bundles/UserBundle/Form/Type/UserType.php
@@ -42,21 +42,21 @@
     ) {
         $this->translator       = $translator;
         $this->model            = $model;
         $this->languageHelper   = $languageHelper;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['signature' => 'strict_html', 'email' => 'email']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['signature' => 'html', 'email' => 'email']));
         $builder->addEventSubscriber(new FormExitSubscriber('user.user', $options));
         $builder->add(
             'username',
             TextType::class,
             [
                 'label'      => 'mautic.core.username',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => [
                     'class'        => 'form-control',
                     'preaddon'     => 'fa fa-user',

--- a/media/js/app.js
+++ b/media/js/app.js
@@ -770,35 +770,35 @@
 if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','sms');}
 if(mQuery('table.sms-list').length){var ids=[];mQuery('td.col-stats').each(function(){var id=mQuery(this).attr('data-stats');ids.push(id);});while(ids.length>0){let batchIds=ids.splice(0,10);Mautic.ajaxActionRequest('sms:getSmsCountStats',{ids:batchIds},function(response){if(response.success&&response.stats){for(var i=0;i<response.stats.length;i++){var stat=response.stats[i];if(mQuery('#pending-'+stat.id).length){if(stat.pending){mQuery('#pending-'+stat.id+' > a').html(stat.pending);mQuery('#pending-'+stat.id).removeClass('hide');}}}}},false,true);}}};Mautic.setSmsCharactersCount=function(smsMessage){mQuery('#sms_nb_char').text((smsMessage.val().length))};Mautic.selectSmsType=function(smsType){if(smsType=='list'){mQuery('#leadList').removeClass('hide');mQuery('#publishStatus').addClass('hide');mQuery('.page-header h3').text(mauticLang.newListSms);}else{mQuery('#publishStatus').removeClass('hide');mQuery('#leadList').addClass('hide');mQuery('.page-header h3').text(mauticLang.newTemplateSms);}
 mQuery('#sms_smsType').val(smsType);mQuery('body').removeClass('noscroll');mQuery('.sms-type-modal').remove();mQuery('.sms-type-modal-backdrop').remove();};Mautic.standardSmsUrl=function(options){if(!options){return;}
 var url=options.windowUrl;if(url){var editEmailKey='/sms/edit/smsId';if(url.indexOf(editEmailKey)>-1){options.windowUrl=url.replace('smsId',mQuery('#campaignevent_properties_sms').val());}}
 return options;};Mautic.disabledSmsAction=function(opener){if(typeof opener=='undefined'){opener=window;}
 var sms=opener.mQuery('#campaignevent_properties_sms').val();var disabled=sms===''||sms===null;opener.mQuery('#campaignevent_properties_editSmsButton').prop('disabled',disabled);};;Mautic.getStageActionPropertiesForm=function(actionType){Mautic.activateLabelLoadingIndicator('stage_type');var query="action=stage:getActionForm&actionType="+actionType;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#stageActionProperties').html(response.html);Mautic.onPageLoad('#stageActionProperties',response);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};;Mautic.userOnLoad=function(container){if(mQuery(container+' form[name="user"]').length){if(mQuery('#user_position').length){Mautic.activateTypeahead('#user_position',{displayKey:'position'});}}else{if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.user');}}};Mautic.roleOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.role');}
 if(response&&response.permissionList){MauticVars.permissionList=response.permissionList;}};Mautic.togglePermissionVisibility=function(){setTimeout(function(){if(mQuery('#role_isAdmin_0').prop('checked')){mQuery('#rolePermissions').removeClass('hide');mQuery('#isAdminMessage').addClass('hide');}else{mQuery('#rolePermissions').addClass('hide');mQuery('#isAdminMessage').removeClass('hide');}},10);};Mautic.onPermissionChange=function(changedPermission,bundle){var granted=0;if(mQuery(changedPermission).prop('checked')){if(mQuery(changedPermission).val()=='full'){mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()!='full'){mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}else{mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()=='full'){granted=granted-1;mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}}
 if(mQuery('.'+bundle+'_granted').length){var granted=0;var levelPerms=MauticVars.permissionList[bundle];mQuery.each(levelPerms,function(level,perms){mQuery.each(perms,function(index,perm){var isChecked=mQuery('input[data-permission="'+bundle+':'+level+':'+perm+'"]').prop('checked');if(perm=='full'){if(isChecked){if(perms.length===1){granted++;}else{granted+=perms.length-1;}}}else if(isChecked){granted++;}});});mQuery('.'+bundle+'_granted').html(granted);}};;Mautic.sendHookTest=function(){var url=mQuery('#webhook_webhookUrl').val();var secret=mQuery('#webhook_secret').val();var eventTypes=mQuery("#event-types input[type='checkbox']");var selectedTypes=[];eventTypes.each(function(){var item=mQuery(this);if(item.is(':checked')){selectedTypes.push(item.val());}});var data={action:'webhook:sendHookTest',url:url,secret:secret,types:selectedTypes};var spinner=mQuery('#spinner');spinner.removeClass('hide');mQuery.ajax({url:mauticAjaxUrl,data:data,type:'POST',dataType:"json",success:function(response){if(response.success){mQuery('#tester').html(response.html);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(response){spinner.addClass('hide');}})};;Mautic.testFullContactApi=function(btn){mQuery(btn).prop('disabled',true);var apikey=mQuery('#integration_details_apiKeys_apikey').val();var d=new Date();var month=d.getMonth()+1;var period=d.getFullYear()+'-'+((month<10)?'0'+month:month);var months=new Array();months[0]="January";months[1]="February";months[2]="March";months[3]="April";months[4]="May";months[5]="June";months[6]="July";months[7]="August";months[8]="September";months[9]="October";months[10]="November";months[11]="December";var dateString=months[month-1]+' '+d.getFullYear();var EOL=String.fromCharCode(13);mQuery.get('https://api.fullcontact.com/v2/stats.json?apiKey='+apikey+'&period='+period,function(stats){var person=null;var company=null;var free=null;mQuery.each(stats.metrics,function(i,m){if('200'===m.metricId){person=m;}else if('company_200'===m.metricId){company=m;}else if('200_free'===m.metricId){free=m;}});var result='Plan Details: '+stats.plan+EOL+EOL+'Quick Usage Stats for '+dateString+':'+EOL;if(person){result+=' - Person API: '+person.usage+' matches used from '+person.planLevel+' ('+person.remaining+' remaining)'+EOL;}
 if(company){result+=' - Company API: '+company.usage+' matches used from '+company.planLevel+' ('+company.remaining+' remaining)'+EOL;}
 if(free){result+=' - Name/Location/Stats: '+free.usage+' matches used from '+free.planLevel+' ('+free.remaining+' remaining)'+EOL;}
-mQuery('#integration_details_apiKeys_stats').val(result);}).fail(function(error){mQuery('#integration_details_apiKeys_stats').val((error.responseJSON&&error.responseJSON.message)?error.responseJSON.message:'Error: '+JSON.stringify(error));});mQuery(btn).prop('disabled',false);};;Mautic.getNetworkFormAction=function(networkType){if(networkType&&mQuery(networkType).val()&&mQuery(networkType).closest('.form-group').hasClass('has-error')){mQuery(networkType).closest('.form-group').removeClass('has-error');if(mQuery(networkType).next().hasClass('help-block')){mQuery(networkType).next().remove();}}
-Mautic.activateLabelLoadingIndicator('monitoring_networkType');var query="action=plugin:mauticSocial:getNetworkForm&networkType="+mQuery(networkType).val();mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#properties-container').html(response.html);if(response.html!=''){Mautic.onPageLoad('#properties-container',response);}}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};Mautic.composeSocialWatcher=function(){var input=mQuery('textarea.tweet-message');Mautic.updateCharacterCount();input.on('keyup',function(){Mautic.updateCharacterCount();});var pageId=mQuery('select.tweet-insert-page');var assetId=mQuery('select.tweet-insert-asset');var handle=mQuery('button.tweet-insert-handle');pageId.on('change',function(){Mautic.insertSocialLink(pageId.val(),'pagelink',false);});assetId.on('change',function(){Mautic.insertSocialLink(assetId.val(),'assetlink',false);});handle.on('click',function(){Mautic.insertSocialLink(false,'twitter_handle',true);});};Mautic.getCharacterCount=function(){var tweetLenght=280;var currentLength=mQuery('textarea#twitter_tweet_text');return(tweetLenght-currentLength.val().length);};Mautic.updateCharacterCount=function(){var tweetCount=Mautic.getCharacterCount();var countContainer=mQuery('#character-count span');countContainer.text(tweetCount);};Mautic.insertSocialLink=function(id,type,skipId){if(!id&&!skipId){return;}
-if(skipId){var link='{'+type+'}';}
-else{var link='{'+type+'='+id+'}';}
-var textarea=mQuery('textarea.tweet-message');var currentVal=textarea.val();var newVal=(currentVal)?currentVal+' '+link:link;textarea.val(newVal);Mautic.updateCharacterCount();};;Mautic.disabledFocusActions=function(opener){if(typeof opener=='undefined'){opener=window;}
+mQuery('#integration_details_apiKeys_stats').val(result);}).fail(function(error){mQuery('#integration_details_apiKeys_stats').val((error.responseJSON&&error.responseJSON.message)?error.responseJSON.message:'Error: '+JSON.stringify(error));});mQuery(btn).prop('disabled',false);};;Mautic.disabledFocusActions=function(opener){if(typeof opener=='undefined'){opener=window;}
 var email=opener.mQuery('#campaignevent_properties_focus').val();var disabled=email===''||email===null;opener.mQuery('#campaignevent_properties_editFocusButton').prop('disabled',disabled);opener.mQuery('#campaignevent_properties_previewFocusButton').prop('disabled',disabled);};Mautic.focusOnLoad=function(){if(mQuery('.builder').length){mQuery('.btn-dropper').each(function(){mQuery(this).click(function(){if(mQuery(this).hasClass('active')){mQuery(this).removeClass('active btn-primary').addClass('btn-default');mQuery('#websiteCanvas').css('cursor','inherit');}else{mQuery('.btn-dropper').removeClass('active btn-primary').addClass('btn-default');mQuery(this).removeClass('btn-default').addClass('active btn-primary');mQuery('#websiteCanvas').css('cursor','crosshair');}});});var activateType=function(el,thisType){mQuery('[data-focus-type]').removeClass('focus-active');mQuery(el).addClass('focus-active');mQuery('#focusFormContent').removeClass(function(index,css){return(css.match(/(^|\s)focus-type\S+/g)||[]).join(' ');}).addClass('focus-type-'+thisType);mQuery('.focus-type-header').removeClass('text-danger');mQuery('#focus_type').val(thisType);var props='.focus-'+thisType+'-properties';mQuery('#focusTypeProperties').appendTo(mQuery(props)).removeClass('hide');mQuery('#focusType .focus-properties').each(function(){if(!mQuery(this).is(':hidden')&&mQuery(this).data('focus-type')!=thisType){mQuery(this).slideUp('fast',function(){mQuery(this).hide();});}});if(mQuery(props).length){if(mQuery(props).is(':hidden')){mQuery(props).slideDown('fast');}}}
 mQuery('[data-focus-type]').on({click:function(){var thisType=mQuery(this).data('focus-type');if(mQuery('#focus_type').val()==thisType){return;}
 activateType(this,thisType);Mautic.focusUpdatePreview();},mouseenter:function(){mQuery(this).addClass('focus-hover');},mouseleave:function(){mQuery(this).removeClass('focus-hover');}});var activateStyle=function(el,thisStyle){mQuery('[data-focus-style]').removeClass('focus-active');mQuery(el).addClass('focus-active');if(!mQuery('#focusType').hasClass('hidden-focus-style-all')){mQuery('#focusType').addClass('hidden-focus-style-all');}
 mQuery('#focusFormContent').removeClass(function(index,css){return(css.match(/(^|\s)focus-style\S+/g)||[]).join(' ');}).addClass('focus-style-'+thisStyle);mQuery('.focus-style-header').removeClass('text-danger');mQuery('#focus_style').val(thisStyle);var props='.focus-'+thisStyle+'-properties';mQuery('#focusStyleProperties').appendTo(mQuery(props)).removeClass('hide');mQuery('#focusStyle .focus-properties').each(function(){if(!mQuery(this).is(':hidden')){mQuery(this).slideUp('fast',function(){mQuery(this).hide();});}});if(mQuery(props).length){if(mQuery(props).is(':hidden')){mQuery(props).slideDown('fast');}}};mQuery('[data-focus-style]').on({click:function(){var thisStyle=mQuery(this).data('focus-style');if(mQuery('#focus_style').val()==thisStyle){return;}
 activateStyle(this,thisStyle);Mautic.focusUpdatePreview();},mouseenter:function(){mQuery(this).addClass('focus-hover');},mouseleave:function(){mQuery(this).removeClass('focus-hover');}});var currentType=mQuery('#focus_type').val();if(currentType){activateType(mQuery('[data-focus-type="'+currentType+'"]'),currentType);}
 var currentStyle=mQuery('#focus_style').val();if(currentStyle){activateStyle(mQuery('[data-focus-style="'+currentStyle+'"]'),currentStyle);}
 mQuery('#focus_properties_content_font').on('chosen:showing_dropdown',function(){var arrayIndex=1;mQuery('#focus_properties_content_font option').each(function(){mQuery('#focus_properties_content_font_chosen li[data-option-array-index="'+arrayIndex+'"]').css('fontFamily',mQuery(this).attr('value'));arrayIndex++;});});mQuery('.btn-fetch').on('click',function(){var url=mQuery('#websiteUrlPlaceholderInput').val();if(url){mQuery('#focus_website').val(url);Mautic.launchFocusBuilder();}else{return;}});Mautic.focusInitViewportSwitcher();mQuery('#focus_editor').on('froalaEditor.contentChanged',function(e,editor){var content=editor.html.get();if(content.indexOf('{focus_form}')!==-1){Mautic.focusUpdatePreview();}else{mQuery('.mf-content').html(content);}});}else{Mautic.initDateRangePicker();}};Mautic.launchFocusBuilder=function(forceFetch){mQuery('.website-placeholder').addClass('hide');mQuery('body').css('overflow-y','hidden');Mautic.ignoreMauticFocusPreviewUpdate=true;if(!mQuery('#builder-overlay').length){var builderCss={margin:"0",padding:"0",border:"none",width:"100%",height:"100%"};var spinnerLeft=(mQuery(document).width()-300)/2;var overlay=mQuery('<div id="builder-overlay" class="modal-backdrop fade in"><div style="position: absolute; top:50%; left:'+spinnerLeft+'px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>').css(builderCss).appendTo('.builder-content');}
 mQuery('.btn-close-builder').prop('disabled',true);mQuery('.builder').addClass('builder-active').removeClass('hide');var url=mQuery('#focus_website').val();if(!url){if(!mQuery('#focus_unlockId').val()){Mautic.setFocusDefaultColors();}
 mQuery('.website-placeholder').removeClass('hide');mQuery('#builder-overlay').addClass('hide');mQuery('.btn-close-builder').prop('disabled',false);mQuery('#websiteUrlPlaceholderInput').prop('disabled',false);mQuery('#websiteCanvas').html('');mQuery('.website-placeholder').show();mQuery('#websiteUrlPlaceholderInput').val('');Mautic.focusUpdatePreview();}else{mQuery('#websiteUrlPlaceholderInput').val(url).prop('disabled',false);let iframe=mQuery('#websiteCanvas iframe');if(!forceFetch&&iframe.length&&url===iframe.attr('src')){return;}
 mQuery('#builder-overlay').removeClass('hide');Mautic.loadedPreviewImage=url;var data={id:mQuery('#focus_unlockId').val(),website:url}
 mQuery('.preview-body').html('');Mautic.ajaxActionRequest('plugin:focus:checkIframeAvailability',data,function(response){if(response.errorMessage.length){mQuery('.website-placeholder').addClass('has-error').find('.help-block').html(response.errorMessage).removeClass('hide');mQuery('#builder-overlay').hide();mQuery('.website-placeholder').removeClass('hide').show();mQuery('#websiteCanvas').html('');mQuery('.builder-panel-top p button').prop('disabled',false);return;}
 mQuery('#builder-overlay').addClass('hide');mQuery('.btn-close-builder').prop('disabled',false);mQuery('.website-placeholder').removeClass('hide');mQuery('#websiteUrlPlaceholderInput').prop('disabled',false);mQuery('.btn-dropper').addClass('disabled');Mautic.focusCreateIframe(url);Mautic.ignoreMauticFocusPreviewUpdate=false;},false,false,"GET");}};Mautic.focusUpdatePreview=function(){var data=mQuery('form[name=focus]').formToArray();Mautic.ajaxActionRequest('plugin:focus:generatePreview',data,function(response){var container=mQuery('<div />');var innerContainer=mQuery('<div />').html(response.html);if(mQuery('.btn-viewport').data('viewport')=='mobile'){innerContainer.addClass('mf-responsive');}else{innerContainer.removeClass('mf-responsive');}
 container.append(innerContainer);mQuery('.preview-body').html(container);if(!mQuery('.mf-bar').length&&mQuery('.builder-content').length){mQuery('.builder-content').on('click',function(){Mautic.closeFocusModal(mQuery('#focus_style').val());});mQuery('.mautic-focus').on('click',function(e){e.stopPropagation();});}});};Mautic.setFocusDefaultColors=function(){mQuery('#focus_properties_colors_primary').minicolors('value','4e5d9d');mQuery('#focus_properties_colors_text').minicolors('value',(mQuery('#focus_style').val()=='bar')?'ffffff':'000000');mQuery('#focus_properties_colors_button').minicolors('value','fdb933');mQuery('#focus_properties_colors_button_text').minicolors('value','ffffff');};Mautic.toggleBarCollapse=function(){var svg='.mf-bar-collapser-icon svg';var currentSize=mQuery(svg).data('transform-size');var currentDirection=mQuery(svg).data('transform-direction');var currentScale=mQuery(svg).data('transform-scale');var newDirection=(parseInt(currentDirection)*-1);setTimeout(function(){mQuery(svg).find('g').first().attr('transform','scale('+currentScale+') rotate('+newDirection+' '+currentSize+' '+currentSize+')');mQuery(svg).data('transform-direction',newDirection);},500);if(mQuery('.mf-bar-collapser').hasClass('mf-bar-collapsed')){if(mQuery('.mf-bar').hasClass('mf-bar-top')){mQuery('.mf-bar').css('margin-top',0);}else{mQuery('.mf-bar').css('margin-bottom',0);}
 mQuery('.mf-bar-collapser').removeClass('mf-bar-collapsed');}else{if(mQuery('.mf-bar').hasClass('mf-bar-top')){mQuery('.mf-bar').css('margin-top',-60);}else{mQuery('.mf-bar').css('margin-bottom',-60);}
 mQuery('.mf-bar-collapser').addClass('mf-bar-collapsed');}}
 Mautic.closeFocusModal=function(style){mQuery('.mf-'+style).remove();if(mQuery('.mf-'+style+'-overlay').length){mQuery('.mf-'+style+'-overlay').remove();}}
 Mautic.closeFocusBuilder=function(el){if(typeof Mautic.ajaxActionXhr!='undefined'&&typeof Mautic.ajaxActionXhr['plugin:focus:generatePreview']!='undefined'){Mautic.ajaxActionXhr['plugin:focus:generatePreview'].abort();delete Mautic.ajaxActionXhr['plugin:focus:generatePreview'];}
 Mautic.stopIconSpinPostEvent();mQuery('.builder').removeClass('builder-active').addClass('hide');mQuery('body').css('overflow-y','');};Mautic.focusInitViewportSwitcher=function(){mQuery('.btn-viewport').on('click',function(){if(mQuery(this).data('viewport')=='mobile'){mQuery('.btn-viewport i').removeClass('fa-desktop fa-2x').addClass('fa-mobile-phone fa-3x');mQuery(this).data('viewport','desktop');Mautic.launchFocusBuilder(true);}else{mQuery('.btn-viewport i').removeClass('fa-mobile-phone fa-3x').addClass('fa-desktop fa-2x');mQuery(this).data('viewport','mobile');Mautic.launchFocusBuilder(true);}});}
 Mautic.focusCreateIframe=function(url){let builderCss={"pointer-events":"none",};if(mQuery('.btn-viewport').data('viewport')==='mobile'){mQuery('#websiteScreenshot').addClass('mobile');}else{builderCss.width="100%";builderCss.height=mQuery('#websiteScreenshot').height();mQuery('#websiteScreenshot').removeClass('mobile');}
-try{mQuery('#websiteCanvas').html('<iframe src="'+url+'" scrolling="no" frameBorder="0"></iframe>');mQuery('#websiteCanvas iframe').css(builderCss);}catch(err){alert(err.toString());}finally{mQuery('.website-placeholder').hide();Mautic.focusUpdatePreview();}}
+try{mQuery('#websiteCanvas').html('<iframe src="'+url+'" scrolling="no" frameBorder="0"></iframe>');mQuery('#websiteCanvas iframe').css(builderCss);}catch(err){alert(err.toString());}finally{mQuery('.website-placeholder').hide();Mautic.focusUpdatePreview();}};Mautic.getNetworkFormAction=function(networkType){if(networkType&&mQuery(networkType).val()&&mQuery(networkType).closest('.form-group').hasClass('has-error')){mQuery(networkType).closest('.form-group').removeClass('has-error');if(mQuery(networkType).next().hasClass('help-block')){mQuery(networkType).next().remove();}}
+Mautic.activateLabelLoadingIndicator('monitoring_networkType');var query="action=plugin:mauticSocial:getNetworkForm&networkType="+mQuery(networkType).val();mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#properties-container').html(response.html);if(response.html!=''){Mautic.onPageLoad('#properties-container',response);}}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};Mautic.composeSocialWatcher=function(){var input=mQuery('textarea.tweet-message');Mautic.updateCharacterCount();input.on('keyup',function(){Mautic.updateCharacterCount();});var pageId=mQuery('select.tweet-insert-page');var assetId=mQuery('select.tweet-insert-asset');var handle=mQuery('button.tweet-insert-handle');pageId.on('change',function(){Mautic.insertSocialLink(pageId.val(),'pagelink',false);});assetId.on('change',function(){Mautic.insertSocialLink(assetId.val(),'assetlink',false);});handle.on('click',function(){Mautic.insertSocialLink(false,'twitter_handle',true);});};Mautic.getCharacterCount=function(){var tweetLenght=280;var currentLength=mQuery('textarea#twitter_tweet_text');return(tweetLenght-currentLength.val().length);};Mautic.updateCharacterCount=function(){var tweetCount=Mautic.getCharacterCount();var countContainer=mQuery('#character-count span');countContainer.text(tweetCount);};Mautic.insertSocialLink=function(id,type,skipId){if(!id&&!skipId){return;}
+if(skipId){var link='{'+type+'}';}
+else{var link='{'+type+'='+id+'}';}
+var textarea=mQuery('textarea.tweet-message');var currentVal=textarea.val();var newVal=(currentVal)?currentVal+' '+link:link;textarea.val(newVal);Mautic.updateCharacterCount();};

--- a/plugins/GrapesJsBuilderBundle/Controller/FileManagerController.php
+++ b/plugins/GrapesJsBuilderBundle/Controller/FileManagerController.php
@@ -17,18 +17,15 @@
     }
     /**
      * @param string $fileName
      *
      * @return JsonResponse
      */
     public function deleteAction()
     {
         /** @var FileManager $fileManager */
         $fileManager = $this->get('grapesjsbuilder.helper.filemanager');
-        $fileName = basename($this->request->get('filename'));
-        if (!exif_imagetype($fileManager->getCompleteFilePath($fileName))) {
-            return $this->sendJsonResponse(['success'=> false]);
-        }
+        $fileName = $this->request->get('filename');
         $fileManager->deleteFile($fileName);
         return $this->sendJsonResponse(['success'=> true]);
     }
 }

--- a/plugins/MauticFocusBundle/Form/Type/FocusType.php
+++ b/plugins/MauticFocusBundle/Form/Type/FocusType.php
@@ -25,21 +25,21 @@
     private $security;
     /**
      * FocusType constructor.
      */
     public function __construct(CorePermissions $security)
     {
         $this->security = $security;
     }
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['website' => 'url', 'html' => 'html', 'editor' => 'html', 'description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['website' => 'url', 'html' => 'html', 'editor' => 'html']));
         $builder->addEventSubscriber(new FormExitSubscriber('focus', $options));
         $builder->add(
             'name',
             TextType::class,
             [
                 'label'      => 'mautic.core.name',
                 'label_attr' => ['class' => 'control-label'],
                 'attr'       => ['class' => 'form-control'],
             ]
         );

--- a/plugins/MauticSocialBundle/Controller/MonitoringController.php
+++ b/plugins/MauticSocialBundle/Controller/MonitoringController.php
@@ -6,23 +6,20 @@
 use Mautic\LeadBundle\Controller\EntityContactsTrait;
 use MauticPlugin\MauticSocialBundle\Entity\Monitoring;
 class MonitoringController extends FormController
 {
     use EntityContactsTrait;
     /*
      * @param int $page
      */
     public function indexAction($page = 1)
     {
-        if (!$this->get('mautic.security')->isGranted('mauticSocial:monitoring:view')) {
-            return $this->accessDenied();
-        }
         $session = $this->get('session');
         $this->setListFilters();
         /** @var \MauticPlugin\MauticSocialBundle\Model\MonitoringModel $model */
         $model = $this->getModel('social.monitoring');
         $limit = $session->get('mautic.social.monitoring.limit', $this->container->getParameter('mautic.default_pagelimit'));
         $start = (1 === $page) ? 0 : (($page - 1) * $limit);
         if ($start < 0) {
             $start = 0;
         }
         $search = $this->request->get('search', $session->get('mautic.social.monitoring.filter', ''));

--- a/plugins/MauticSocialBundle/Form/Type/MonitoringType.php
+++ b/plugins/MauticSocialBundle/Form/Type/MonitoringType.php
@@ -19,21 +19,21 @@
     private $monitoringModel;
     public function __construct(MonitoringModel $monitoringModel)
     {
         $this->monitoringModel = $monitoringModel;
     }
     /**
      * {@inheritdoc}
      */
     public function buildForm(FormBuilderInterface $builder, array $options)
     {
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $builder->add('title', TextType::class, [
             'label'      => 'mautic.core.name',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control'],
         ]);
         $builder->add('description', TextareaType::class, [
             'label'      => 'mautic.core.description',
             'label_attr' => ['class' => 'control-label'],
             'attr'       => ['class' => 'form-control editor'],
             'required'   => false,

--- a/plugins/MauticTagManagerBundle/Controller/TagController.php
+++ b/plugins/MauticTagManagerBundle/Controller/TagController.php
@@ -184,23 +184,20 @@
     /**
      * Generate's edit form and processes post data.
      *
      * @param int  $objectId
      * @param bool $ignorePost
      *
      * @return Response
      */
     public function editAction($objectId, $ignorePost = false)
     {
-        if (!$this->get('mautic.security')->isGranted('tagManager:tagManager:edit')) {
-            return $this->accessDenied();
-        }
         $postActionVars = $this->getPostActionVars($objectId);
         try {
             $tag = $this->getTag($objectId);
             return $this->createTagModifyResponse(
                 $tag,
                 $postActionVars,
                 $this->generateUrl('mautic_tagmanager_action', ['objectAction' => 'edit', 'objectId' => $objectId]),
                 $ignorePost
             );
         } catch (AccessDeniedException $exception) {

--- a/plugins/MauticTagManagerBundle/Form/Type/TagEntityType.php
+++ b/plugins/MauticTagManagerBundle/Form/Type/TagEntityType.php
@@ -5,21 +5,21 @@
 use Symfony\Component\Form\AbstractType;
 use Symfony\Component\Form\Extension\Core\Type\TextareaType;
 use Symfony\Component\Form\Extension\Core\Type\TextType;
 use Symfony\Component\Form\FormBuilderInterface;
 use Symfony\Component\Validator\Constraints\NotBlank;
 class TagEntityType extends AbstractType
 {
     public function buildForm(FormBuilderInterface $builder, array $options): void
     {
         $builder->add('buttons', FormButtonsType::class);
-        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'strict_html']));
+        $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
         $tagReadOnly = !empty($options['data']) && $options['data']->getId() ? true : false;
         $builder->add(
             'tag',
             TextType::class,
             [
                 'label'       => 'mautic.core.name',
                 'label_attr'  => ['class' => 'control-label'],
                 'attr'        => ['class' => 'form-control', 'readonly' => $tagReadOnly],
                 'constraints' => [
                     new NotBlank(
