# ====================================================================
# FILE: app/bundles/AssetBundle/Form/Type/AssetType.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-58 ---
     1| <?php
     2| namespace Mautic\AssetBundle\Form\Type;
     3| use Mautic\AssetBundle\Entity\Asset;
     4| use Mautic\AssetBundle\Model\AssetModel;
     5| use Mautic\CategoryBundle\Form\Type\CategoryListType;
     6| use Mautic\CoreBundle\Form\EventListener\CleanFormSubscriber;
     7| use Mautic\CoreBundle\Form\EventListener\FormExitSubscriber;
     8| use Mautic\CoreBundle\Form\Type\ButtonGroupType;
     9| use Mautic\CoreBundle\Form\Type\FormButtonsType;
    10| use Mautic\CoreBundle\Form\Type\YesNoButtonGroupType;
    11| use Symfony\Component\Form\AbstractType;
    12| use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
    13| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
    14| use Symfony\Component\Form\Extension\Core\Type\LocaleType;
    15| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    16| use Symfony\Component\Form\Extension\Core\Type\TextType;
    17| use Symfony\Component\Form\FormBuilderInterface;
    18| use Symfony\Component\OptionsResolver\OptionsResolver;
    19| use Symfony\Component\Translation\TranslatorInterface;
    20| use Symfony\Component\Validator\Constraints\NotBlank;
    21| class AssetType extends AbstractType
    22| {
    23|     /**
    24|      * @var TranslatorInterface
    25|      */
    26|     private $translator;
    27|     /**
    28|      * @var AssetModel
    29|      */
    30|     private $assetModel;
    31|     public function __construct(TranslatorInterface $translator, AssetModel $assetModel)
    32|     {
    33|         $this->translator = $translator;
    34|         $this->assetModel = $assetModel;
    35|     }
    36|     public function buildForm(FormBuilderInterface $builder, array $options)
    37|     {
    38|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    39|         $builder->addEventSubscriber(new FormExitSubscriber('asset.asset', $options));
    40|         $builder->add('storageLocation', ButtonGroupType::class, [
    41|             'label'   => 'mautic.asset.asset.form.storageLocation',
    42|             'choices' => [
    43|                 'mautic.asset.asset.form.storageLocation.local'  => 'local',
    44|                 'mautic.asset.asset.form.storageLocation.remote' => 'remote',
    45|             ],
    46|             'attr'              => [
    47|                 'onchange' => 'Mautic.changeAssetStorageLocation();',
    48|             ],
    49|         ]);
    50|         $maxUploadSize = $this->assetModel->getMaxUploadSize('', true);
    51|         $builder->add(
    52|             'tempName',
    53|             HiddenType::class,
    54|             [
    55|                 'label'      => $this->translator->trans('mautic.asset.asset.form.file.upload', ['%max%' => $maxUploadSize]),
    56|                 'label_attr' => ['class' => 'control-label'],
    57|                 'required'   => false,
    58|             ]

# --- HUNK 2: Lines 63-106 ---
    63|             [
    64|                 'required' => false,
    65|             ]
    66|         );
    67|         $builder->add(
    68|             'disallow',
    69|             YesNoButtonGroupType::class,
    70|             [
    71|                 'label' => 'mautic.asset.asset.form.disallow.crawlers',
    72|                 'attr'  => [
    73|                     'tooltip'      => 'mautic.asset.asset.form.disallow.crawlers.descr',
    74|                     'data-show-on' => '{"asset_storageLocation_0":"checked"}',
    75|                 ],
    76|                 'data'=> empty($options['data']->getDisallow()) ? false : true,
    77|             ]
    78|         );
    79|         $builder->add(
    80|             'remotePath',
    81|             TextType::class,
    82|             [
    83|                 'label'      => 'mautic.asset.asset.form.remotePath',
    84|                 'label_attr' => ['class' => 'control-label'],
    85|                 'attr'       => ['class' => 'form-control'],
    86|                 'required'   => false,
    87|             ]
    88|         );
    89|         $builder->add(
    90|             'title',
    91|             TextType::class,
    92|             [
    93|                 'label'      => 'mautic.core.title',
    94|                 'label_attr' => ['class' => 'control-label'],
    95|                 'attr'       => ['class' => 'form-control'],
    96|             ]
    97|         );
    98|         $builder->add(
    99|             'alias',
   100|             TextType::class,
   101|             [
   102|                 'label'      => 'mautic.core.alias',
   103|                 'label_attr' => ['class' => 'control-label'],
   104|                 'attr'       => [
   105|                     'class'   => 'form-control',
   106|                     'tooltip' => 'mautic.asset.asset.help.alias',


# ====================================================================
# FILE: app/bundles/CampaignBundle/Form/Type/CampaignType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 17-57 ---
    17| /**
    18|  * Class CampaignType.
    19|  */
    20| class CampaignType extends AbstractType
    21| {
    22|     /**
    23|      * @var CorePermissions
    24|      */
    25|     private $security;
    26|     /**
    27|      * @var TranslatorInterface
    28|      */
    29|     private $translator;
    30|     public function __construct(CorePermissions $security, TranslatorInterface $translator)
    31|     {
    32|         $this->security   = $security;
    33|         $this->translator = $translator;
    34|     }
    35|     public function buildForm(FormBuilderInterface $builder, array $options)
    36|     {
    37|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    38|         $builder->addEventSubscriber(new FormExitSubscriber('campaign', $options));
    39|         $builder->add('name', TextType::class, [
    40|             'label'      => 'mautic.core.name',
    41|             'label_attr' => ['class' => 'control-label'],
    42|             'attr'       => ['class' => 'form-control'],
    43|         ]);
    44|         $builder->add('description', TextareaType::class, [
    45|             'label'      => 'mautic.core.description',
    46|             'label_attr' => ['class' => 'control-label'],
    47|             'attr'       => ['class' => 'form-control editor'],
    48|             'required'   => false,
    49|         ]);
    50|         $builder->add('allowRestart',
    51|             YesNoButtonGroupType::class,
    52|             [
    53|                 'label' => 'mautic.campaign.allow_restart',
    54|                 'attr'  => [
    55|                     'tooltip' => 'mautic.campaign.allow_restart.tooltip',
    56|                 ],
    57|             ]


# ====================================================================
# FILE: app/bundles/CategoryBundle/Form/Type/CategoryType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 6-46 ---
     6| use Mautic\CoreBundle\Form\Type\YesNoButtonGroupType;
     7| use Symfony\Component\Form\AbstractType;
     8| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
     9| use Symfony\Component\Form\Extension\Core\Type\TextType;
    10| use Symfony\Component\Form\FormBuilderInterface;
    11| use Symfony\Component\HttpFoundation\Session\Session;
    12| use Symfony\Component\OptionsResolver\Options;
    13| use Symfony\Component\OptionsResolver\OptionsResolver;
    14| class CategoryType extends AbstractType
    15| {
    16|     /**
    17|      * @var Session
    18|      */
    19|     private $session;
    20|     public function __construct(Session $session)
    21|     {
    22|         $this->session = $session;
    23|     }
    24|     public function buildForm(FormBuilderInterface $builder, array $options)
    25|     {
    26|         $builder->addEventSubscriber(new CleanFormSubscriber([]));
    27|         $builder->addEventSubscriber(new FormExitSubscriber('category.category', $options));
    28|         if (!$options['data']->getId()) {
    29|             if (true == $options['show_bundle_select']) {
    30|                 $selected = $this->session->get('mautic.category.type', 'category');
    31|                 $builder->add(
    32|                     'bundle',
    33|                     CategoryBundlesType::class,
    34|                     [
    35|                         'label'      => 'mautic.core.type',
    36|                         'label_attr' => ['class' => 'control-label'],
    37|                         'attr'       => ['class' => 'form-control'],
    38|                         'required'   => true,
    39|                         'data'       => $selected,
    40|                     ]
    41|                 );
    42|             } else {
    43|                 $builder->add(
    44|                     'bundle',
    45|                     HiddenType::class,
    46|                     [


# ====================================================================
# FILE: app/bundles/DashboardBundle/Controller/DashboardController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 457-479 ---
   457|                 'passthroughVars' => [
   458|                     'activeLink'    => '#mautic_dashboard_index',
   459|                     'mauticContent' => 'dashboardImport',
   460|                     'route'         => $this->generateUrl(
   461|                         'mautic_dashboard_action',
   462|                         [
   463|                             'objectAction' => 'import',
   464|                         ]
   465|                     ),
   466|                 ],
   467|             ]
   468|         );
   469|     }
   470|     /**
   471|      * Gets name from request and defaults it to the timestamp if not provided.
   472|      *
   473|      * @return string
   474|      */
   475|     private function getNameFromRequest()
   476|     {
   477|         return $this->request->get('name', (new \DateTime())->format('Y-m-dTH:i:s'));
   478|     }
   479| }


# ====================================================================
# FILE: app/bundles/DynamicContentBundle/Form/Type/DynamicContentType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 62-102 ---
    62|         $this->leadModel       = $leadModel;
    63|         $this->fieldChoices    = $listModel->getChoiceFields();
    64|         $this->timezoneChoices = FormFieldHelper::getTimezonesChoices();
    65|         $this->countryChoices  = FormFieldHelper::getCountryChoices();
    66|         $this->regionChoices   = FormFieldHelper::getRegionChoices();
    67|         $this->localeChoices   = FormFieldHelper::getLocaleChoices();
    68|         $this->filterFieldChoices();
    69|         $tags = $leadModel->getTagList();
    70|         foreach ($tags as $tag) {
    71|             $this->tagChoices[$tag['value']] = $tag['label'];
    72|         }
    73|         $this->deviceTypesChoices  = array_combine(DeviceParser::getAvailableDeviceTypeNames(), DeviceParser::getAvailableDeviceTypeNames());
    74|         $this->deviceBrandsChoices = DeviceParser::$deviceBrands;
    75|         $this->deviceOsChoices     = array_combine(
    76|             array_keys(OperatingSystem::getAvailableOperatingSystemFamilies()),
    77|             array_keys(OperatingSystem::getAvailableOperatingSystemFamilies())
    78|         );
    79|     }
    80|     public function buildForm(FormBuilderInterface $builder, array $options)
    81|     {
    82|         $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html']));
    83|         $builder->addEventSubscriber(new FormExitSubscriber('dynamicContent.dynamicContent', $options));
    84|         $builder->add(
    85|             'name',
    86|             TextType::class,
    87|             [
    88|                 'label'      => 'mautic.dynamicContent.form.internal.name',
    89|                 'label_attr' => ['class' => 'control-label'],
    90|                 'attr'       => ['class' => 'form-control'],
    91|             ]
    92|         );
    93|         $builder->add(
    94|             'slotName',
    95|             TextType::class,
    96|             [
    97|                 'label'      => 'mautic.dynamicContent.send.slot_name',
    98|                 'label_attr' => ['class' => 'control-label'],
    99|                 'attr'       => [
   100|                     'class'   => 'form-control',
   101|                     'tooltip' => 'mautic.dynamicContent.send.slot_name.tooltip',
   102|                 ],


# ====================================================================
# FILE: app/bundles/EmailBundle/Form/Type/ConfigType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 20-64 ---
    20|     /**
    21|      * @var TranslatorInterface
    22|      */
    23|     private $translator;
    24|     /**
    25|      * @var TransportType
    26|      */
    27|     private $transportType;
    28|     public function __construct(TranslatorInterface $translator, TransportType $transportType)
    29|     {
    30|         $this->translator    = $translator;
    31|         $this->transportType = $transportType;
    32|     }
    33|     public function buildForm(FormBuilderInterface $builder, array $options)
    34|     {
    35|         $builder->addEventSubscriber(
    36|             new CleanFormSubscriber(
    37|                 [
    38|                     'mailer_from_email'      => 'email',
    39|                     'mailer_return_path'     => 'email',
    40|                     'default_signature_text' => 'html',
    41|                     'unsubscribe_text'       => 'html',
    42|                     'unsubscribe_message'    => 'html',
    43|                     'resubscribe_message'    => 'html',
    44|                     'webview_text'           => 'html',
    45|                     'mailer_custom_headers'  => 'clean',
    46|                 ]
    47|             )
    48|         );
    49|         $builder->add(
    50|             'unsubscribe_text',
    51|             TextareaType::class,
    52|             [
    53|                 'label'      => 'mautic.email.config.unsubscribe_text',
    54|                 'label_attr' => ['class' => 'control-label'],
    55|                 'attr'       => [
    56|                     'class'   => 'form-control',
    57|                     'tooltip' => 'mautic.email.config.unsubscribe_text.tooltip',
    58|                 ],
    59|                 'required'   => false,
    60|                 'data'       => (array_key_exists('unsubscribe_text', $options['data']) && !empty($options['data']['unsubscribe_text']))
    61|                     ? $options['data']['unsubscribe_text']
    62|                     : $this->translator->trans(
    63|                         'mautic.email.unsubscribe.text',
    64|                         ['%link%' => '|URL|']


# ====================================================================
# FILE: app/bundles/FormBundle/Form/Type/ActionType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-41 ---
     1| <?php
     2| namespace Mautic\FormBundle\Form\Type;
     3| use Mautic\CoreBundle\Form\EventListener\CleanFormSubscriber;
     4| use Mautic\CoreBundle\Form\Type\FormButtonsType;
     5| use Symfony\Component\Form\AbstractType;
     6| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
     7| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
     8| use Symfony\Component\Form\Extension\Core\Type\TextType;
     9| use Symfony\Component\Form\FormBuilderInterface;
    10| use Symfony\Component\OptionsResolver\OptionsResolver;
    11| /**
    12|  * Class ActionType.
    13|  */
    14| class ActionType extends AbstractType
    15| {
    16|     /**
    17|      * {@inheritdoc}
    18|      */
    19|     public function buildForm(FormBuilderInterface $builder, array $options)
    20|     {
    21|         $masks = ['description' => 'html'];
    22|         $builder->add(
    23|             'name',
    24|             TextType::class,
    25|             [
    26|                 'label'      => 'mautic.core.name',
    27|                 'label_attr' => ['class' => 'control-label'],
    28|                 'attr'       => ['class' => 'form-control'],
    29|                 'required'   => false,
    30|             ]
    31|         );
    32|         $builder->add(
    33|             'description',
    34|             TextareaType::class,
    35|             [
    36|                 'label'      => 'mautic.core.description',
    37|                 'label_attr' => ['class' => 'control-label'],
    38|                 'attr'       => ['class' => 'form-control editor'],
    39|                 'required'   => false,
    40|             ]
    41|         );


# ====================================================================
# FILE: app/bundles/FormBundle/Form/Type/FormType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 14-54 ---
    14| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
    15| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    16| use Symfony\Component\Form\Extension\Core\Type\TextType;
    17| use Symfony\Component\Form\FormBuilderInterface;
    18| use Symfony\Component\OptionsResolver\OptionsResolver;
    19| class FormType extends AbstractType
    20| {
    21|     /**
    22|      * @var CorePermissions
    23|      */
    24|     private $security;
    25|     public function __construct(CorePermissions $security)
    26|     {
    27|         $this->security = $security;
    28|     }
    29|     /**
    30|      * {@inheritdoc}
    31|      */
    32|     public function buildForm(FormBuilderInterface $builder, array $options)
    33|     {
    34|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    35|         $builder->addEventSubscriber(new FormExitSubscriber('form.form', $options));
    36|         $builder->add('name', TextType::class, [
    37|             'label'      => 'mautic.core.name',
    38|             'label_attr' => ['class' => 'control-label'],
    39|             'attr'       => ['class' => 'form-control'],
    40|         ]);
    41|         $builder->add('formAttributes', TextType::class, [
    42|             'label'      => 'mautic.form.field.form.form_attr',
    43|             'label_attr' => ['class' => 'control-label'],
    44|             'attr'       => [
    45|                 'class'   => 'form-control',
    46|                 'tooltip' => 'mautic.form.field.form.form_attr.tooltip',
    47|             ],
    48|             'required'   => false,
    49|         ]);
    50|         $builder->add('description', TextareaType::class, [
    51|             'label'      => 'mautic.core.description',
    52|             'label_attr' => ['class' => 'control-label'],
    53|             'attr'       => ['class' => 'form-control editor'],
    54|             'required'   => false,


# ====================================================================
# FILE: app/bundles/LeadBundle/Controller/CompanyController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 672-718 ---
   672|         return $this->postActionRedirect(
   673|             array_merge(
   674|                 $postActionVars,
   675|                 [
   676|                     'flashes' => $flashes,
   677|                 ]
   678|             )
   679|         );
   680|     }
   681|     /**
   682|      * Company Merge function.
   683|      *
   684|      * @param $objectId
   685|      *
   686|      * @return array|JsonResponse|\Symfony\Component\HttpFoundation\RedirectResponse|\Symfony\Component\HttpFoundation\Response
   687|      */
   688|     public function mergeAction($objectId)
   689|     {
   690|         $permissions = $this->get('mautic.security')->isGranted(
   691|             [
   692|                 'lead:leads:viewother',
   693|                 'lead:leads:create',
   694|                 'lead:leads:editother',
   695|                 'lead:leads:deleteother',
   696|             ],
   697|             'RETURN_ARRAY'
   698|         );
   699|         /** @var CompanyModel $model */
   700|         $model            = $this->getModel('lead.company');
   701|         $secondaryCompany = $model->getEntity($objectId);
   702|         $page             = $this->get('session')->get('mautic.lead.page', 1);
   703|         $returnUrl = $this->generateUrl('mautic_company_index', ['page' => $page]);
   704|         $postActionVars = [
   705|             'returnUrl'       => $returnUrl,
   706|             'viewParameters'  => ['page' => $page],
   707|             'contentTemplate' => 'MauticLeadBundle:Company:index',
   708|             'passthroughVars' => [
   709|                 'activeLink'    => '#mautic_company_index',
   710|                 'mauticContent' => 'company',
   711|             ],
   712|         ];
   713|         if (null === $secondaryCompany) {
   714|             return $this->postActionRedirect(
   715|                 array_merge(
   716|                     $postActionVars,
   717|                     [
   718|                         'flashes' => [


# ====================================================================
# FILE: app/bundles/LeadBundle/Controller/LeadController.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 154-193 ---
   154|                     'security'         => $this->get('mautic.security'),
   155|                     'inSingleList'     => $inSingleList,
   156|                     'noContactList'    => $dncRepository->getChannelList(null, array_keys($leads)),
   157|                     'maxLeadId'        => $maxLeadId,
   158|                     'anonymousShowing' => $anonymousShowing,
   159|                 ],
   160|                 'contentTemplate' => "MauticLeadBundle:Lead:{$indexMode}.html.php",
   161|                 'passthroughVars' => [
   162|                     'activeLink'    => '#mautic_contact_index',
   163|                     'mauticContent' => 'lead',
   164|                     'route'         => $this->generateUrl('mautic_contact_index', ['page' => $page]),
   165|                 ],
   166|             ]
   167|         );
   168|     }
   169|     /**
   170|      * @return JsonResponse|Response
   171|      */
   172|     public function quickAddAction()
   173|     {
   174|         /** @var \Mautic\LeadBundle\Model\LeadModel $model */
   175|         $model = $this->getModel('lead.lead');
   176|         $action = $this->generateUrl('mautic_contact_action', ['objectAction' => 'new', 'qf' => 1]);
   177|         $fields = $this->getModel('lead.field')->getEntities(
   178|             [
   179|                 'filter' => [
   180|                     'force' => [
   181|                         [
   182|                             'column' => 'f.isPublished',
   183|                             'expr'   => 'eq',
   184|                             'value'  => true,
   185|                         ],
   186|                         [
   187|                             'column' => 'f.isShortVisible',
   188|                             'expr'   => 'eq',
   189|                             'value'  => true,
   190|                         ],
   191|                         [
   192|                             'column' => 'f.object',
   193|                             'expr'   => 'like',

# --- HUNK 2: Lines 1555-1594 ---
  1555|                     ],
  1556|                     'contentTemplate' => 'MauticLeadBundle:Batch:form.html.php',
  1557|                     'passthroughVars' => [
  1558|                         'activeLink'    => '#mautic_contact_index',
  1559|                         'mauticContent' => 'leadBatch',
  1560|                         'route'         => $route,
  1561|                     ],
  1562|                 ]
  1563|             );
  1564|         }
  1565|     }
  1566|     /**
  1567|      * Bulk edit lead owner.
  1568|      *
  1569|      * @param int $objectId
  1570|      *
  1571|      * @return JsonResponse|\Symfony\Component\HttpFoundation\Response
  1572|      */
  1573|     public function batchOwnersAction($objectId = 0)
  1574|     {
  1575|         if ('POST' == $this->request->getMethod()) {
  1576|             /** @var \Mautic\LeadBundle\Model\LeadModel $model */
  1577|             $model = $this->getModel('lead');
  1578|             $data  = $this->request->request->get('lead_batch_owner', [], true);
  1579|             $ids   = json_decode($data['ids'], true);
  1580|             $entities = [];
  1581|             if (is_array($ids)) {
  1582|                 $entities = $model->getEntities(
  1583|                     [
  1584|                         'filter' => [
  1585|                             'force' => [
  1586|                                 [
  1587|                                     'column' => 'l.id',
  1588|                                     'expr'   => 'in',
  1589|                                     'value'  => $ids,
  1590|                                 ],
  1591|                             ],
  1592|                         ],
  1593|                         'ignore_paginator' => true,
  1594|                     ]


# ====================================================================
# FILE: app/bundles/LeadBundle/Form/Type/ListType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 15-55 ---
    15| use Symfony\Component\Form\Extension\Core\Type\TextType;
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\Form\FormInterface;
    18| use Symfony\Component\Form\FormView;
    19| use Symfony\Component\OptionsResolver\OptionsResolver;
    20| use Symfony\Component\Translation\TranslatorInterface;
    21| class ListType extends AbstractType
    22| {
    23|     private $translator;
    24|     /**
    25|      * @var ListModel
    26|      */
    27|     private $listModel;
    28|     public function __construct(TranslatorInterface $translator, ListModel $listModel)
    29|     {
    30|         $this->translator = $translator;
    31|         $this->listModel  = $listModel;
    32|     }
    33|     public function buildForm(FormBuilderInterface $builder, array $options)
    34|     {
    35|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    36|         $builder->addEventSubscriber(new FormExitSubscriber('lead.list', $options));
    37|         $builder->add(
    38|             'name',
    39|             TextType::class,
    40|             [
    41|                 'label'      => 'mautic.core.name',
    42|                 'label_attr' => ['class' => 'control-label'],
    43|                 'attr'       => ['class' => 'form-control'],
    44|             ]
    45|         );
    46|         $builder->add(
    47|             'publicName',
    48|             TextType::class,
    49|             [
    50|                 'label'      => 'mautic.lead.list.form.publicname',
    51|                 'label_attr' => ['class' => 'control-label'],
    52|                 'attr'       => [
    53|                     'class'   => 'form-control',
    54|                     'tooltip' => 'mautic.lead.list.form.publicname.tooltip',
    55|                 ],


# ====================================================================
# FILE: app/bundles/LeadBundle/Form/Type/NoteType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 6-46 ---
     6| use Mautic\CoreBundle\Helper\DateTimeHelper;
     7| use Mautic\LeadBundle\Entity\LeadNote;
     8| use Symfony\Component\Form\AbstractType;
     9| use Symfony\Component\Form\Extension\Core\Type\ChoiceType;
    10| use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
    11| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    12| use Symfony\Component\Form\FormBuilderInterface;
    13| use Symfony\Component\OptionsResolver\OptionsResolver;
    14| class NoteType extends AbstractType
    15| {
    16|     /**
    17|      * @var DateTimeHelper
    18|      */
    19|     private $dateHelper;
    20|     public function __construct()
    21|     {
    22|         $this->dateHelper = new DateTimeHelper();
    23|     }
    24|     public function buildForm(FormBuilderInterface $builder, array $options)
    25|     {
    26|         $builder->addEventSubscriber(new CleanFormSubscriber(['text' => 'html']));
    27|         $builder->addEventSubscriber(new FormExitSubscriber('lead.note', $options));
    28|         $builder->add(
    29|             'text',
    30|             TextareaType::class,
    31|             [
    32|                 'label'      => 'mautic.lead.note.form.text',
    33|                 'label_attr' => ['class' => 'control-label sr-only'],
    34|                 'attr'       => ['class' => 'mousetrap form-control editor', 'rows' => 10, 'autofocus' => 'autofocus'],
    35|             ]
    36|         );
    37|         $builder->add(
    38|             'type',
    39|             ChoiceType::class,
    40|             [
    41|                 'label'             => 'mautic.lead.note.form.type',
    42|                 'choices'           => [
    43|                     'mautic.lead.note.type.general' => 'general',
    44|                     'mautic.lead.note.type.email'   => 'email',
    45|                     'mautic.lead.note.type.call'    => 'call',
    46|                     'mautic.lead.note.type.meeting' => 'meeting',


# ====================================================================
# FILE: app/bundles/NotificationBundle/Form/Type/MobileNotificationType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 5-45 ---
     5| use Mautic\CoreBundle\Form\EventListener\FormExitSubscriber;
     6| use Mautic\CoreBundle\Form\Type\FormButtonsType;
     7| use Mautic\CoreBundle\Form\Type\YesNoButtonGroupType;
     8| use Mautic\EmailBundle\Form\Type\EmailUtmTagsType;
     9| use Symfony\Component\Form\AbstractType;
    10| use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
    11| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
    12| use Symfony\Component\Form\Extension\Core\Type\LocaleType;
    13| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    14| use Symfony\Component\Form\Extension\Core\Type\TextType;
    15| use Symfony\Component\Form\Extension\Core\Type\UrlType;
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\OptionsResolver\OptionsResolver;
    18| /**
    19|  * Class NotificationType.
    20|  */
    21| class MobileNotificationType extends AbstractType
    22| {
    23|     public function buildForm(FormBuilderInterface $builder, array $options)
    24|     {
    25|         $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
    26|         $builder->addEventSubscriber(new FormExitSubscriber('notification.notification', $options));
    27|         $builder->add(
    28|             'name',
    29|             TextType::class,
    30|             [
    31|                 'label'      => 'mautic.notification.form.internal.name',
    32|                 'label_attr' => ['class' => 'control-label'],
    33|                 'attr'       => ['class' => 'form-control'],
    34|             ]
    35|         );
    36|         $builder->add(
    37|             'description',
    38|             TextareaType::class,
    39|             [
    40|                 'label'      => 'mautic.notification.form.internal.description',
    41|                 'label_attr' => ['class' => 'control-label'],
    42|                 'attr'       => ['class' => 'form-control'],
    43|                 'required'   => false,
    44|             ]
    45|         );


# ====================================================================
# FILE: app/bundles/NotificationBundle/Form/Type/NotificationType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 5-45 ---
     5| use Mautic\CoreBundle\Form\EventListener\FormExitSubscriber;
     6| use Mautic\CoreBundle\Form\Type\FormButtonsType;
     7| use Mautic\CoreBundle\Form\Type\YesNoButtonGroupType;
     8| use Mautic\EmailBundle\Form\Type\EmailUtmTagsType;
     9| use Symfony\Component\Form\AbstractType;
    10| use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
    11| use Symfony\Component\Form\Extension\Core\Type\HiddenType;
    12| use Symfony\Component\Form\Extension\Core\Type\LocaleType;
    13| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    14| use Symfony\Component\Form\Extension\Core\Type\TextType;
    15| use Symfony\Component\Form\Extension\Core\Type\UrlType;
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\OptionsResolver\OptionsResolver;
    18| /**
    19|  * Class NotificationType.
    20|  */
    21| class NotificationType extends AbstractType
    22| {
    23|     public function buildForm(FormBuilderInterface $builder, array $options)
    24|     {
    25|         $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
    26|         $builder->addEventSubscriber(new FormExitSubscriber('notification.notification', $options));
    27|         $builder->add(
    28|             'name',
    29|             TextType::class,
    30|             [
    31|                 'label'      => 'mautic.notification.form.internal.name',
    32|                 'label_attr' => ['class' => 'control-label'],
    33|                 'attr'       => ['class' => 'form-control'],
    34|             ]
    35|         );
    36|         $builder->add(
    37|             'description',
    38|             TextareaType::class,
    39|             [
    40|                 'label'      => 'mautic.notification.form.internal.description',
    41|                 'label_attr' => ['class' => 'control-label'],
    42|                 'attr'       => ['class' => 'form-control'],
    43|                 'required'   => false,
    44|             ]
    45|         );


# ====================================================================
# FILE: app/bundles/PointBundle/Form/Type/PointType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 13-53 ---
    13| use Symfony\Component\Form\Extension\Core\Type\NumberType;
    14| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    15| use Symfony\Component\Form\Extension\Core\Type\TextType;
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\OptionsResolver\OptionsResolver;
    18| class PointType extends AbstractType
    19| {
    20|     /**
    21|      * @var CorePermissions
    22|      */
    23|     private $security;
    24|     public function __construct(CorePermissions $security)
    25|     {
    26|         $this->security = $security;
    27|     }
    28|     /**
    29|      * {@inheritdoc}
    30|      */
    31|     public function buildForm(FormBuilderInterface $builder, array $options)
    32|     {
    33|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    34|         $builder->addEventSubscriber(new FormExitSubscriber('point', $options));
    35|         $builder->add(
    36|             'name',
    37|             TextType::class, [
    38|                 'label'      => 'mautic.core.name',
    39|                 'label_attr' => ['class' => 'control-label'],
    40|                 'attr'       => ['class' => 'form-control'],
    41|             ]
    42|         );
    43|         $builder->add(
    44|             'description',
    45|             TextareaType::class, [
    46|                 'label'      => 'mautic.core.description',
    47|                 'label_attr' => ['class' => 'control-label'],
    48|                 'attr'       => ['class' => 'form-control editor'],
    49|                 'required'   => false,
    50|             ]
    51|         );
    52|         $builder->add(
    53|             'type',


# ====================================================================
# FILE: app/bundles/PointBundle/Form/Type/TriggerType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 13-53 ---
    13| use Symfony\Component\Form\Extension\Core\Type\NumberType;
    14| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    15| use Symfony\Component\Form\Extension\Core\Type\TextType;
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\OptionsResolver\OptionsResolver;
    18| class TriggerType extends AbstractType
    19| {
    20|     /**
    21|      * @var CorePermissions
    22|      */
    23|     private $security;
    24|     public function __construct(CorePermissions $security)
    25|     {
    26|         $this->security = $security;
    27|     }
    28|     /**
    29|      * {@inheritdoc}
    30|      */
    31|     public function buildForm(FormBuilderInterface $builder, array $options)
    32|     {
    33|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    34|         $builder->addEventSubscriber(new FormExitSubscriber('point', $options));
    35|         $builder->add(
    36|             'name',
    37|             TextType::class,
    38|             [
    39|                 'label'      => 'mautic.core.name',
    40|                 'label_attr' => ['class' => 'control-label'],
    41|                 'attr'       => ['class' => 'form-control'],
    42|             ]
    43|         );
    44|         $builder->add(
    45|             'description',
    46|             TextareaType::class,
    47|             [
    48|                 'label'      => 'mautic.core.description',
    49|                 'label_attr' => ['class' => 'control-label'],
    50|                 'attr'       => ['class' => 'form-control editor'],
    51|                 'required'   => false,
    52|             ]
    53|         );


# ====================================================================
# FILE: app/bundles/ReportBundle/Form/Type/ReportType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 16-56 ---
    16| use Symfony\Component\Form\FormBuilderInterface;
    17| use Symfony\Component\Form\FormEvent;
    18| use Symfony\Component\Form\FormEvents;
    19| use Symfony\Component\Form\FormInterface;
    20| use Symfony\Component\OptionsResolver\OptionsResolver;
    21| class ReportType extends AbstractType
    22| {
    23|     /**
    24|      * @var ReportModel
    25|      */
    26|     private $reportModel;
    27|     public function __construct(ReportModel $reportModel)
    28|     {
    29|         $this->reportModel = $reportModel;
    30|     }
    31|     /**
    32|      * {@inheritdoc}
    33|      */
    34|     public function buildForm(FormBuilderInterface $builder, array $options)
    35|     {
    36|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    37|         $builder->addEventSubscriber(new FormExitSubscriber('report', $options));
    38|         if (!($options['attr']['readonly'] ?? false)) {
    39|             $builder->add(
    40|                 'name',
    41|                 TextType::class,
    42|                 [
    43|                     'label'      => 'mautic.core.name',
    44|                     'label_attr' => ['class' => 'control-label'],
    45|                     'attr'       => ['class' => 'form-control'],
    46|                     'required'   => true,
    47|                 ]
    48|             );
    49|             $builder->add(
    50|                 'description',
    51|                 TextareaType::class,
    52|                 [
    53|                     'label'      => 'mautic.core.description',
    54|                     'label_attr' => ['class' => 'control-label'],
    55|                     'attr'       => ['class' => 'form-control editor'],
    56|                     'required'   => false,


# ====================================================================
# FILE: app/bundles/ReportBundle/Model/ReportModel.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 476-516 ---
   476|                 $eventGraphs                     = [];
   477|                 $defaultGraphOptions             = $options;
   478|                 $defaultGraphOptions['dateFrom'] = $chartDateFrom;
   479|                 $defaultGraphOptions['dateTo']   = $chartDateTo;
   480|                 foreach ($selectedGraphs as $g) {
   481|                     if (isset($availableGraphs[$g])) {
   482|                         $graphOptions    = isset($availableGraphs[$g]['options']) ? $availableGraphs[$g]['options'] : [];
   483|                         $graphOptions    = array_merge($defaultGraphOptions, $graphOptions);
   484|                         $eventGraphs[$g] = [
   485|                             'options' => $graphOptions,
   486|                             'type'    => $availableGraphs[$g]['type'],
   487|                         ];
   488|                     }
   489|                 }
   490|                 $event = new ReportGraphEvent($entity, $eventGraphs, $query);
   491|                 $this->dispatcher->dispatch(ReportEvents::REPORT_ON_GRAPH_GENERATE, $event);
   492|                 $graphs = $event->getGraphs();
   493|                 unset($defaultGraphOptions);
   494|             }
   495|         }
   496|         $query->add('orderBy', $order);
   497|         $event = new ReportQueryEvent($entity, $query, $totalResults, $dataOptions);
   498|         $this->dispatcher->dispatch(ReportEvents::REPORT_QUERY_PRE_EXECUTE, $event);
   499|         $query = $event->getQuery();
   500|         if (empty($options['ignoreTableData']) && !empty($selectedColumns)) {
   501|             if ($paginate) {
   502|                 $limit = $this->session->get('mautic.report.'.$entity->getId().'.limit', $this->defaultPageLimit);
   503|                 if (!empty($options['limit'])) {
   504|                     $limit      = $options['limit'];
   505|                     $reportPage = $options['page'];
   506|                 }
   507|                 $start = (1 === $reportPage) ? 0 : (($reportPage - 1) * $limit);
   508|                 if ($start < 0) {
   509|                     $start = 0;
   510|                 }
   511|                 if (empty($options['totalResults'])) {
   512|                     $options['totalResults'] = $totalResults = $this->getTotalCount($query, $debugData);
   513|                 } else {
   514|                     $totalResults = $options['totalResults'];
   515|                 }
   516|                 if ($limit > 0) {

# --- HUNK 2: Lines 547-586 ---
   547|         }
   548|         foreach ($data as $keys => $lead) {
   549|             foreach ($lead as $key => $field) {
   550|                 $data[$keys][$key] = html_entity_decode($field, ENT_QUOTES);
   551|             }
   552|         }
   553|         return [
   554|             'totalResults'      => $totalResults,
   555|             'data'              => $data,
   556|             'dataColumns'       => $dataColumns,
   557|             'graphs'            => $graphs,
   558|             'contentTemplate'   => $contentTemplate,
   559|             'columns'           => $tableDetails['columns'],
   560|             'limit'             => ($paginate) ? $limit : 0,
   561|             'page'              => ($paginate) ? $reportPage : 1,
   562|             'dateFrom'          => $dataOptions['dateFrom'],
   563|             'dateTo'            => $dataOptions['dateTo'],
   564|             'debug'             => $debugData,
   565|             'aggregatorColumns' => $dataAggregatorColumns,
   566|         ];
   567|     }
   568|     /**
   569|      * @return mixed
   570|      */
   571|     public function getReportsWithGraphs()
   572|     {
   573|         $ownedBy = $this->security->isGranted('report:reports:viewother') ? null : $this->userHelper->getUser()->getId();
   574|         return $this->getRepository()->findReportsWithGraphs($ownedBy);
   575|     }
   576|     /**
   577|      * Determine what operators should be used for the filter type.
   578|      *
   579|      * @return mixed|string
   580|      */
   581|     private function getOperatorOptions(array $data)
   582|     {
   583|         if (isset($data['operators'])) {
   584|             $options = $data['operators'];
   585|         } else {
   586|             $operator = (isset($data['operatorGroup'])) ? $data['operatorGroup'] : $data['type'];


# ====================================================================
# FILE: app/bundles/ReportBundle/Views/Report/details_data.html.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 2-57 ---
     2| /*
     3|  * @copyright   2014 Mautic Contributors. All rights reserved
     4|  * @author      Mautic
     5|  *
     6|  * @link        http://mautic.org
     7|  *
     8|  * @license     GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
     9|  */
    10| if ('index' == $tmpl) {
    11|     $view->extend('MauticReportBundle:Report:details.html.php');
    12| }
    13| $showGraphsAboveTable = (true === !empty($report->getSettings()['showGraphsAboveTable']));
    14| $dataCount            = count($data);
    15| $columnOrder          = $report->getColumns();
    16| $graphOrder           = $report->getGraphs();
    17| $aggregatorOrder      = $report->getAggregators();
    18| $aggregatorCount      = count($aggregatorOrder);
    19| $groupBy              = $report->getGroupBy();
    20| $groupByCount         = count($groupBy);
    21| $startCount           = ($totalResults > $limit) ? ($reportPage * $limit) - $limit + 1 : 1;
    22| function getTotal($a, $f, $t, $allrows, $ac)
    23| {
    24|     switch ($f) {
    25|         case 'COUNT':
    26|         case 'SUM':
    27|             return (int) $t + (int) $a;
    28|         case 'AVG':
    29|             return ($ac == $allrows) ? round(((int) $t + (int) $a) / (int) $allrows, 2) : (int) $t + (int) $a;
    30|         case 'MAX':
    31|             return ((int) $a >= (int) $t) ? (int) $a : (int) $t;
    32|         case 'MIN':
    33|             return ((int) $a <= (int) $t) ? (int) $a : (int) $t;
    34|         default:
    35|             return (int) $t;
    36|     }
    37| }
    38| $graphContent = $view->render(
    39|     'MauticReportBundle:Report:details_data_graphs.html.php',
    40|     [
    41|         'graphOrder' => $graphOrder,
    42|         'graphs'     => $graphs,
    43|         'report'     => $report,
    44|     ]
    45| );
    46| ?>
    47| <?php if (!empty($showGraphsAboveTable)): echo $graphContent; endif; ?>
    48| <?php if (!empty($columnOrder) || !empty($aggregatorOrder)): ?>
    49|     <!-- table section -->
    50|     <div class="col-xs-12">
    51|         <div class="panel panel-default bdr-t-wdh-0 mb-0">
    52|             <div class="page-list">
    53|                 <div class="table-responsive table-responsive-force">
    54|                     <table class="table table-hover table-striped table-bordered report-list" id="reportTable">
    55|                         <thead>
    56|                         <tr>
    57|                             <th class="col-report-count"></th>

# --- HUNK 2: Lines 128-168 ---
   128|                                                             break;
   129|                                                         default:
   130|                                                             echo $view['formatter']->_($cellVal, $cellType);
   131|                                                             break;
   132|                                                     }
   133|                                                 }
   134|                                                 ?>
   135|                                                 <?php if ($closeLink): ?></a><?php endif; ?>
   136|                                         </td>
   137|                                     <?php endif; ?>
   138|                                 <?php endforeach; ?>
   139|                                 <?php
   140|                                 if ($aggregatorCount) :
   141|                                     $index = 0;
   142|                                     ++$avgCounter;
   143|                                     foreach ($aggregatorOrder as $aggregator): ?>
   144|                                         <td>
   145|                                             <?php
   146|                                             if (isset($row[$aggregator['function'].' '.$aggregator['column']])) {
   147|                                                 echo $view['formatter']->_($row[$aggregator['function'].' '.$aggregator['column']], 'text');
   148|                                                 $total[$index] = getTotal($row[$aggregator['function'].' '.$aggregator['column']], $aggregator['function'], (isset($total[$index])) ? $total[$index] : 0, $dataCount, $avgCounter);
   149|                                             }
   150|                                             ?>
   151|                                         </td>
   152|                                         <?php
   153|                                         ++$index;
   154|                                     endforeach;
   155|                                 endif;
   156|                                 ?>
   157|                             </tr>
   158|                             <?php ++$startCount; ?>
   159|                         <?php endforeach; ?>
   160|                         <?php else: ?>
   161|                             <tr>
   162|                                 <td>&nbsp;</td>
   163|                                 <?php foreach ($columnOrder as $key): ?>
   164|                                     <td>&nbsp;</td>
   165|                                 <?php endforeach; ?>
   166|                             </tr>
   167|                         <?php endif; ?>
   168|                         <tr class="cm-strong">


# ====================================================================
# FILE: app/bundles/SmsBundle/Form/Type/SmsType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 15-55 ---
    15| use Symfony\Component\Form\Extension\Core\Type\LocaleType;
    16| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    17| use Symfony\Component\Form\Extension\Core\Type\TextType;
    18| use Symfony\Component\Form\FormBuilderInterface;
    19| use Symfony\Component\OptionsResolver\OptionsResolver;
    20| /**
    21|  * Class SmsType.
    22|  */
    23| class SmsType extends AbstractType
    24| {
    25|     /**
    26|      * @var EntityManager
    27|      */
    28|     private $em;
    29|     public function __construct(EntityManager $em)
    30|     {
    31|         $this->em = $em;
    32|     }
    33|     public function buildForm(FormBuilderInterface $builder, array $options)
    34|     {
    35|         $builder->addEventSubscriber(new CleanFormSubscriber(['content' => 'html', 'customHtml' => 'html']));
    36|         $builder->addEventSubscriber(new FormExitSubscriber('sms.sms', $options));
    37|         $builder->add(
    38|             'name',
    39|             TextType::class,
    40|             [
    41|                 'label'      => 'mautic.sms.form.internal.name',
    42|                 'label_attr' => ['class' => 'control-label'],
    43|                 'attr'       => ['class' => 'form-control'],
    44|             ]
    45|         );
    46|         $builder->add(
    47|             'description',
    48|             TextareaType::class,
    49|             [
    50|                 'label'      => 'mautic.sms.form.internal.description',
    51|                 'label_attr' => ['class' => 'control-label'],
    52|                 'attr'       => ['class' => 'form-control'],
    53|                 'required'   => false,
    54|             ]
    55|         );


# ====================================================================
# FILE: app/bundles/StageBundle/Form/Type/StageType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 12-52 ---
    12| use Symfony\Component\Form\Extension\Core\Type\NumberType;
    13| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    14| use Symfony\Component\Form\Extension\Core\Type\TextType;
    15| use Symfony\Component\Form\FormBuilderInterface;
    16| use Symfony\Component\OptionsResolver\OptionsResolver;
    17| class StageType extends AbstractType
    18| {
    19|     /**
    20|      * @var CorePermissions
    21|      */
    22|     private $security;
    23|     public function __construct(CorePermissions $security)
    24|     {
    25|         $this->security = $security;
    26|     }
    27|     /**
    28|      * {@inheritdoc}
    29|      */
    30|     public function buildForm(FormBuilderInterface $builder, array $options)
    31|     {
    32|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    33|         $builder->addEventSubscriber(new FormExitSubscriber('stage', $options));
    34|         $builder->add('description', TextareaType::class, [
    35|             'label'      => 'mautic.core.description',
    36|             'label_attr' => ['class' => 'control-label'],
    37|             'attr'       => ['class' => 'form-control editor'],
    38|             'required'   => false,
    39|         ]);
    40|         $builder->add('name', TextType::class, [
    41|             'label'      => 'mautic.core.name',
    42|             'label_attr' => [
    43|                 'class' => 'control-label',
    44|             ], 'attr' => [
    45|                 'class' => 'form-control',
    46|             ], ]);
    47|         $builder->add('weight', NumberType::class, [
    48|             'label'      => 'mautic.stage.action.weight',
    49|             'label_attr' => ['class' => 'control-label'],
    50|             'attr'       => [
    51|                     'class'   => 'form-control',
    52|                     'tooltip' => 'mautic.stage.action.weight.help',


# ====================================================================
# FILE: app/bundles/UserBundle/Form/Type/RoleType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-41 ---
     1| <?php
     2| namespace Mautic\UserBundle\Form\Type;
     3| use Mautic\CoreBundle\Form\EventListener\CleanFormSubscriber;
     4| use Mautic\CoreBundle\Form\EventListener\FormExitSubscriber;
     5| use Mautic\CoreBundle\Form\Type\FormButtonsType;
     6| use Mautic\CoreBundle\Form\Type\YesNoButtonGroupType;
     7| use Mautic\UserBundle\Entity\Role;
     8| use Symfony\Component\Form\AbstractType;
     9| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    10| use Symfony\Component\Form\Extension\Core\Type\TextType;
    11| use Symfony\Component\Form\FormBuilderInterface;
    12| use Symfony\Component\OptionsResolver\OptionsResolver;
    13| use Symfony\Component\Validator\Constraints\Valid;
    14| class RoleType extends AbstractType
    15| {
    16|     /**
    17|      * {@inheritdoc}
    18|      */
    19|     public function buildForm(FormBuilderInterface $builder, array $options)
    20|     {
    21|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    22|         $builder->addEventSubscriber(new FormExitSubscriber('user.role', $options));
    23|         $builder->add(
    24|             'name',
    25|             TextType::class,
    26|             [
    27|                 'label'      => 'mautic.core.name',
    28|                 'label_attr' => ['class' => 'control-label'],
    29|                 'attr'       => ['class' => 'form-control'],
    30|             ]
    31|         );
    32|         $builder->add(
    33|             'description',
    34|             TextareaType::class,
    35|             [
    36|                 'label'      => 'mautic.core.description',
    37|                 'label_attr' => ['class' => 'control-label'],
    38|                 'attr'       => ['class' => 'form-control editor'],
    39|                 'required'   => false,
    40|             ]
    41|         );


# ====================================================================
# FILE: app/bundles/UserBundle/Form/Type/UserType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 32-72 ---
    32|      */
    33|     private $model;
    34|     /**
    35|      * @var LanguageHelper
    36|      */
    37|     private $languageHelper;
    38|     public function __construct(
    39|         TranslatorInterface $translator,
    40|         UserModel $model,
    41|         LanguageHelper $languageHelper
    42|     ) {
    43|         $this->translator       = $translator;
    44|         $this->model            = $model;
    45|         $this->languageHelper   = $languageHelper;
    46|     }
    47|     /**
    48|      * {@inheritdoc}
    49|      */
    50|     public function buildForm(FormBuilderInterface $builder, array $options)
    51|     {
    52|         $builder->addEventSubscriber(new CleanFormSubscriber(['signature' => 'html', 'email' => 'email']));
    53|         $builder->addEventSubscriber(new FormExitSubscriber('user.user', $options));
    54|         $builder->add(
    55|             'username',
    56|             TextType::class,
    57|             [
    58|                 'label'      => 'mautic.core.username',
    59|                 'label_attr' => ['class' => 'control-label'],
    60|                 'attr'       => [
    61|                     'class'        => 'form-control',
    62|                     'preaddon'     => 'fa fa-user',
    63|                     'autocomplete' => 'off',
    64|                 ],
    65|             ]
    66|         );
    67|         $builder->add(
    68|             'firstName',
    69|             TextType::class,
    70|             [
    71|                 'label'      => 'mautic.core.firstname',
    72|                 'label_attr' => ['class' => 'control-label'],


# ====================================================================
# FILE: media/js/app.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 760-804 ---
   760| index++;var prototype=prototypeHolder.data('prototype');var output=prototype.replace(/__name__/g,index);prototypeHolder.attr('data-index',index);prototypeHolder.append(output);var newColumnId='#'+elId+'_'+index+'_column';if(elId=='report_filters'){if(typeof Mautic.reportPrototypeFilterOptions!='undefined'){mQuery(newColumnId).html(Mautic.reportPrototypeFilterOptions);}
   761| mQuery('#report_filters_'+index+'_container').addClass('in-group');mQuery(newColumnId).on('change',function(){Mautic.updateReportFilterValueInput(this);});Mautic.updateReportFilterValueInput(newColumnId);Mautic.updateReportGlueTriggers();}else if(typeof Mautic.reportPrototypeColumnOptions!='undefined'){mQuery(newColumnId).html(Mautic.reportPrototypeColumnOptions);}
   762| Mautic.activateChosenSelect(mQuery('#'+elId+'_'+index+'_column'));mQuery("#"+elId+" *[data-toggle='tooltip']").tooltip({html:true,container:'body'});};Mautic.updateReportGlueTriggers=function(){var filterContainer=mQuery('#report_filters');var glueEl=filterContainer.find('.filter-glue');glueEl.off('change');glueEl.on('change',function(){var $this=mQuery(this);if($this.val()==='and'){$this.parents('.panel').addClass('in-group');}else{$this.parents('.panel').removeClass('in-group');}});};Mautic.updateReportFilterValueInput=function(filterColumn,setup){var definitions=(typeof Mautic.reportPrototypeFilterDefinitions!='undefined')?Mautic.reportPrototypeFilterDefinitions:mQuery('#report_filters').data('filter-definitions');var operators=(typeof Mautic.reportPrototypeFilterOperators!='undefined')?Mautic.reportPrototypeFilterOperators:mQuery('#report_filters').data('filter-operators');var newValue=mQuery(filterColumn).val();if(!newValue){return;}
   763| var filterId=mQuery(filterColumn).attr('id');var filterType=definitions[newValue].type;var valueEl=mQuery(filterColumn).parent().parent().find('.filter-value');var valueVal=valueEl.val();var idParts=filterId.split("_");var valueId='report_filters_'+idParts[2]+'_value';var valueName='report[filters]['+idParts[2]+'][value]';var currentOperator=mQuery('#report_filters_'+idParts[2]+'_condition').val();mQuery('#report_filters_'+idParts[2]+'_condition').html(operators[newValue]);if(mQuery('#report_filters_'+idParts[2]+'_condition option[value="'+currentOperator+'"]').length>0){mQuery('#report_filters_'+idParts[2]+'_condition').val(currentOperator);}
   764| Mautic.destroyChosen(mQuery('#'+valueId));if(filterType=='bool'||filterType=='boolean'){if(mQuery(valueEl).attr('type')!='radio'){var template=mQuery('#filterValueYesNoTemplate .btn-group').clone(true);mQuery(template).find('input[type="radio"]').each(function(){mQuery(this).attr('name',valueName);var radioVal=mQuery(this).val();mQuery(this).attr('id',valueId+'_'+radioVal);});mQuery(valueEl).replaceWith(template);}
   765| if(setup){mQuery('#'+valueId+'_'+valueVal).click();}}else if(mQuery(valueEl).attr('type')!='text'){var newValueEl=mQuery('<input type="text" />').attr({id:valueId,name:valueName,'class':"form-control filter-value"});var replaceMe=(mQuery(valueEl).attr('type')=='radio')?mQuery(valueEl).parent().parent():mQuery(valueEl);replaceMe.replaceWith(newValueEl);}
   766| if((filterType=='multiselect'||filterType=='select')&&typeof definitions[newValue].list!='undefined'){var currentValue=mQuery(valueEl).val();var attr={id:valueId,name:valueName,"class":'form-control filter-value',};if(filterType=='multiselect'){attr.multiple=true;}
   767| var newSelect=mQuery('<select />',attr);mQuery.each(definitions[newValue].list,function(value,label){var newOption=mQuery('<option />').val(value).html(label);if(value==currentValue){newOption.prop('selected',true);}
   768| newOption.appendTo(newSelect);});mQuery(valueEl).replaceWith(newSelect);Mautic.activateChosenSelect(newSelect);}
   769| if(filterType=='datetime'||filterType=='date'||filterType=='time'){Mautic.activateDateTimeInputs('#'+valueId,filterType);}else if(mQuery('#'+valueId).hasClass('calendar-activated')){mQuery('#'+valueId).datetimepicker('destroy');}};Mautic.removeReportRow=function(container){mQuery("#"+container+" *[data-toggle='tooltip']").tooltip('destroy');mQuery('#'+container).remove();};Mautic.updateReportSourceData=function(context){Mautic.activateLabelLoadingIndicator('report_source');mQuery.ajax({url:mauticAjaxUrl,type:'post',data:"action=report:getSourceData&context="+context,success:function(response){mQuery('#report_columns').html(response.columns);mQuery('#report_columns').multiSelect('refresh');mQuery('#report_groupBy').html(response.columns);mQuery('#report_groupBy').multiSelect('refresh');mQuery('#report_filters').find('div').remove().end();mQuery('#report_filters').data('index',0);Mautic.reportPrototypeColumnOptions=mQuery(response.columns);mQuery('#report_tableOrder').find('div').remove().end();mQuery('#report_tableOrder').data('index',0);mQuery('#report_aggregators').find('div').remove().end();mQuery('#report_aggregators').data('index',0);Mautic.reportPrototypeFilterDefinitions=response.filterDefinitions;Mautic.reportPrototypeFilterOptions=response.filters;Mautic.reportPrototypeFilterOperators=response.filterOperators;mQuery('#report_graphs').html(response.graphs);mQuery('#report_graphs').multiSelect('refresh');if(!response.graphs){mQuery('#graphs-container').addClass('hide');mQuery('#graphs-tab').addClass('hide');}else{mQuery('#graphs-container').removeClass('hide');mQuery('#graphs-tab').removeClass('hide');}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};Mautic.checkReportCondition=function(selector){var option=mQuery('#'+selector+' option:selected').val();var valueInput=selector.replace('condition','value');if(option=='empty'||option=='notEmpty'){mQuery('#'+valueInput).prop('disabled',true);}else{mQuery('#'+valueInput).prop('disabled',false);}};Mautic.checkSelectedGroupBy=function(){var selectedOption=mQuery("select[name='report[groupBy][]'] option:selected").length;var existingAggregators=mQuery("select[name*='report[aggregators]']");if(selectedOption>0){mQuery('#aggregators-button').prop('disabled',false);}else{existingAggregators.each(function(){var containerId=mQuery(this).attr('id').replace('_column','');Mautic.removeReportRow(containerId+'_container');});mQuery('#aggregators-button').prop('disabled',true);}};Mautic.getHighestIndex=function(selector){var highestIndex=1;var selectorChildren=mQuery('#'+selector+' > div');selectorChildren.each(function(){var index=parseInt(mQuery(this).attr('id').split('_')[2]);highestIndex=(index>highestIndex)?index:highestIndex;});return parseInt(highestIndex);};;Mautic.smsOnLoad=function(container,response){const smsMessage=mQuery('#sms_message');if(smsMessage.length){Mautic.setSmsCharactersCount(smsMessage);smsMessage.on('input',()=>{Mautic.setSmsCharactersCount(smsMessage);});}
   770| if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','sms');}
   771| if(mQuery('table.sms-list').length){var ids=[];mQuery('td.col-stats').each(function(){var id=mQuery(this).attr('data-stats');ids.push(id);});while(ids.length>0){let batchIds=ids.splice(0,10);Mautic.ajaxActionRequest('sms:getSmsCountStats',{ids:batchIds},function(response){if(response.success&&response.stats){for(var i=0;i<response.stats.length;i++){var stat=response.stats[i];if(mQuery('#pending-'+stat.id).length){if(stat.pending){mQuery('#pending-'+stat.id+' > a').html(stat.pending);mQuery('#pending-'+stat.id).removeClass('hide');}}}}},false,true);}}};Mautic.setSmsCharactersCount=function(smsMessage){mQuery('#sms_nb_char').text((smsMessage.val().length))};Mautic.selectSmsType=function(smsType){if(smsType=='list'){mQuery('#leadList').removeClass('hide');mQuery('#publishStatus').addClass('hide');mQuery('.page-header h3').text(mauticLang.newListSms);}else{mQuery('#publishStatus').removeClass('hide');mQuery('#leadList').addClass('hide');mQuery('.page-header h3').text(mauticLang.newTemplateSms);}
   772| mQuery('#sms_smsType').val(smsType);mQuery('body').removeClass('noscroll');mQuery('.sms-type-modal').remove();mQuery('.sms-type-modal-backdrop').remove();};Mautic.standardSmsUrl=function(options){if(!options){return;}
   773| var url=options.windowUrl;if(url){var editEmailKey='/sms/edit/smsId';if(url.indexOf(editEmailKey)>-1){options.windowUrl=url.replace('smsId',mQuery('#campaignevent_properties_sms').val());}}
   774| return options;};Mautic.disabledSmsAction=function(opener){if(typeof opener=='undefined'){opener=window;}
   775| var sms=opener.mQuery('#campaignevent_properties_sms').val();var disabled=sms===''||sms===null;opener.mQuery('#campaignevent_properties_editSmsButton').prop('disabled',disabled);};;Mautic.getStageActionPropertiesForm=function(actionType){Mautic.activateLabelLoadingIndicator('stage_type');var query="action=stage:getActionForm&actionType="+actionType;mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#stageActionProperties').html(response.html);Mautic.onPageLoad('#stageActionProperties',response);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};;Mautic.userOnLoad=function(container){if(mQuery(container+' form[name="user"]').length){if(mQuery('#user_position').length){Mautic.activateTypeahead('#user_position',{displayKey:'position'});}}else{if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.user');}}};Mautic.roleOnLoad=function(container,response){if(mQuery(container+' #list-search').length){Mautic.activateSearchAutocomplete('list-search','user.role');}
   776| if(response&&response.permissionList){MauticVars.permissionList=response.permissionList;}};Mautic.togglePermissionVisibility=function(){setTimeout(function(){if(mQuery('#role_isAdmin_0').prop('checked')){mQuery('#rolePermissions').removeClass('hide');mQuery('#isAdminMessage').addClass('hide');}else{mQuery('#rolePermissions').addClass('hide');mQuery('#isAdminMessage').removeClass('hide');}},10);};Mautic.onPermissionChange=function(changedPermission,bundle){var granted=0;if(mQuery(changedPermission).prop('checked')){if(mQuery(changedPermission).val()=='full'){mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()!='full'){mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}else{mQuery(changedPermission).closest('.choice-wrapper').find("label input:checkbox:checked").map(function(){if(mQuery(this).val()=='full'){granted=granted-1;mQuery(this).prop('checked',false);mQuery(this).parent().toggleClass('active');}})}}
   777| if(mQuery('.'+bundle+'_granted').length){var granted=0;var levelPerms=MauticVars.permissionList[bundle];mQuery.each(levelPerms,function(level,perms){mQuery.each(perms,function(index,perm){var isChecked=mQuery('input[data-permission="'+bundle+':'+level+':'+perm+'"]').prop('checked');if(perm=='full'){if(isChecked){if(perms.length===1){granted++;}else{granted+=perms.length-1;}}}else if(isChecked){granted++;}});});mQuery('.'+bundle+'_granted').html(granted);}};;Mautic.sendHookTest=function(){var url=mQuery('#webhook_webhookUrl').val();var secret=mQuery('#webhook_secret').val();var eventTypes=mQuery("#event-types input[type='checkbox']");var selectedTypes=[];eventTypes.each(function(){var item=mQuery(this);if(item.is(':checked')){selectedTypes.push(item.val());}});var data={action:'webhook:sendHookTest',url:url,secret:secret,types:selectedTypes};var spinner=mQuery('#spinner');spinner.removeClass('hide');mQuery.ajax({url:mauticAjaxUrl,data:data,type:'POST',dataType:"json",success:function(response){if(response.success){mQuery('#tester').html(response.html);}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(response){spinner.addClass('hide');}})};;Mautic.testFullContactApi=function(btn){mQuery(btn).prop('disabled',true);var apikey=mQuery('#integration_details_apiKeys_apikey').val();var d=new Date();var month=d.getMonth()+1;var period=d.getFullYear()+'-'+((month<10)?'0'+month:month);var months=new Array();months[0]="January";months[1]="February";months[2]="March";months[3]="April";months[4]="May";months[5]="June";months[6]="July";months[7]="August";months[8]="September";months[9]="October";months[10]="November";months[11]="December";var dateString=months[month-1]+' '+d.getFullYear();var EOL=String.fromCharCode(13);mQuery.get('https://api.fullcontact.com/v2/stats.json?apiKey='+apikey+'&period='+period,function(stats){var person=null;var company=null;var free=null;mQuery.each(stats.metrics,function(i,m){if('200'===m.metricId){person=m;}else if('company_200'===m.metricId){company=m;}else if('200_free'===m.metricId){free=m;}});var result='Plan Details: '+stats.plan+EOL+EOL+'Quick Usage Stats for '+dateString+':'+EOL;if(person){result+=' - Person API: '+person.usage+' matches used from '+person.planLevel+' ('+person.remaining+' remaining)'+EOL;}
   778| if(company){result+=' - Company API: '+company.usage+' matches used from '+company.planLevel+' ('+company.remaining+' remaining)'+EOL;}
   779| if(free){result+=' - Name/Location/Stats: '+free.usage+' matches used from '+free.planLevel+' ('+free.remaining+' remaining)'+EOL;}
   780| mQuery('#integration_details_apiKeys_stats').val(result);}).fail(function(error){mQuery('#integration_details_apiKeys_stats').val((error.responseJSON&&error.responseJSON.message)?error.responseJSON.message:'Error: '+JSON.stringify(error));});mQuery(btn).prop('disabled',false);};;Mautic.disabledFocusActions=function(opener){if(typeof opener=='undefined'){opener=window;}
   781| var email=opener.mQuery('#campaignevent_properties_focus').val();var disabled=email===''||email===null;opener.mQuery('#campaignevent_properties_editFocusButton').prop('disabled',disabled);opener.mQuery('#campaignevent_properties_previewFocusButton').prop('disabled',disabled);};Mautic.focusOnLoad=function(){if(mQuery('.builder').length){mQuery('.btn-dropper').each(function(){mQuery(this).click(function(){if(mQuery(this).hasClass('active')){mQuery(this).removeClass('active btn-primary').addClass('btn-default');mQuery('#websiteCanvas').css('cursor','inherit');}else{mQuery('.btn-dropper').removeClass('active btn-primary').addClass('btn-default');mQuery(this).removeClass('btn-default').addClass('active btn-primary');mQuery('#websiteCanvas').css('cursor','crosshair');}});});var activateType=function(el,thisType){mQuery('[data-focus-type]').removeClass('focus-active');mQuery(el).addClass('focus-active');mQuery('#focusFormContent').removeClass(function(index,css){return(css.match(/(^|\s)focus-type\S+/g)||[]).join(' ');}).addClass('focus-type-'+thisType);mQuery('.focus-type-header').removeClass('text-danger');mQuery('#focus_type').val(thisType);var props='.focus-'+thisType+'-properties';mQuery('#focusTypeProperties').appendTo(mQuery(props)).removeClass('hide');mQuery('#focusType .focus-properties').each(function(){if(!mQuery(this).is(':hidden')&&mQuery(this).data('focus-type')!=thisType){mQuery(this).slideUp('fast',function(){mQuery(this).hide();});}});if(mQuery(props).length){if(mQuery(props).is(':hidden')){mQuery(props).slideDown('fast');}}}
   782| mQuery('[data-focus-type]').on({click:function(){var thisType=mQuery(this).data('focus-type');if(mQuery('#focus_type').val()==thisType){return;}
   783| activateType(this,thisType);Mautic.focusUpdatePreview();},mouseenter:function(){mQuery(this).addClass('focus-hover');},mouseleave:function(){mQuery(this).removeClass('focus-hover');}});var activateStyle=function(el,thisStyle){mQuery('[data-focus-style]').removeClass('focus-active');mQuery(el).addClass('focus-active');if(!mQuery('#focusType').hasClass('hidden-focus-style-all')){mQuery('#focusType').addClass('hidden-focus-style-all');}
   784| mQuery('#focusFormContent').removeClass(function(index,css){return(css.match(/(^|\s)focus-style\S+/g)||[]).join(' ');}).addClass('focus-style-'+thisStyle);mQuery('.focus-style-header').removeClass('text-danger');mQuery('#focus_style').val(thisStyle);var props='.focus-'+thisStyle+'-properties';mQuery('#focusStyleProperties').appendTo(mQuery(props)).removeClass('hide');mQuery('#focusStyle .focus-properties').each(function(){if(!mQuery(this).is(':hidden')){mQuery(this).slideUp('fast',function(){mQuery(this).hide();});}});if(mQuery(props).length){if(mQuery(props).is(':hidden')){mQuery(props).slideDown('fast');}}};mQuery('[data-focus-style]').on({click:function(){var thisStyle=mQuery(this).data('focus-style');if(mQuery('#focus_style').val()==thisStyle){return;}
   785| activateStyle(this,thisStyle);Mautic.focusUpdatePreview();},mouseenter:function(){mQuery(this).addClass('focus-hover');},mouseleave:function(){mQuery(this).removeClass('focus-hover');}});var currentType=mQuery('#focus_type').val();if(currentType){activateType(mQuery('[data-focus-type="'+currentType+'"]'),currentType);}
   786| var currentStyle=mQuery('#focus_style').val();if(currentStyle){activateStyle(mQuery('[data-focus-style="'+currentStyle+'"]'),currentStyle);}
   787| mQuery('#focus_properties_content_font').on('chosen:showing_dropdown',function(){var arrayIndex=1;mQuery('#focus_properties_content_font option').each(function(){mQuery('#focus_properties_content_font_chosen li[data-option-array-index="'+arrayIndex+'"]').css('fontFamily',mQuery(this).attr('value'));arrayIndex++;});});mQuery('.btn-fetch').on('click',function(){var url=mQuery('#websiteUrlPlaceholderInput').val();if(url){mQuery('#focus_website').val(url);Mautic.launchFocusBuilder();}else{return;}});Mautic.focusInitViewportSwitcher();mQuery('#focus_editor').on('froalaEditor.contentChanged',function(e,editor){var content=editor.html.get();if(content.indexOf('{focus_form}')!==-1){Mautic.focusUpdatePreview();}else{mQuery('.mf-content').html(content);}});}else{Mautic.initDateRangePicker();}};Mautic.launchFocusBuilder=function(forceFetch){mQuery('.website-placeholder').addClass('hide');mQuery('body').css('overflow-y','hidden');Mautic.ignoreMauticFocusPreviewUpdate=true;if(!mQuery('#builder-overlay').length){var builderCss={margin:"0",padding:"0",border:"none",width:"100%",height:"100%"};var spinnerLeft=(mQuery(document).width()-300)/2;var overlay=mQuery('<div id="builder-overlay" class="modal-backdrop fade in"><div style="position: absolute; top:50%; left:'+spinnerLeft+'px"><i class="fa fa-spinner fa-spin fa-5x"></i></div></div>').css(builderCss).appendTo('.builder-content');}
   788| mQuery('.btn-close-builder').prop('disabled',true);mQuery('.builder').addClass('builder-active').removeClass('hide');var url=mQuery('#focus_website').val();if(!url){if(!mQuery('#focus_unlockId').val()){Mautic.setFocusDefaultColors();}
   789| mQuery('.website-placeholder').removeClass('hide');mQuery('#builder-overlay').addClass('hide');mQuery('.btn-close-builder').prop('disabled',false);mQuery('#websiteUrlPlaceholderInput').prop('disabled',false);mQuery('#websiteCanvas').html('');mQuery('.website-placeholder').show();mQuery('#websiteUrlPlaceholderInput').val('');Mautic.focusUpdatePreview();}else{mQuery('#websiteUrlPlaceholderInput').val(url).prop('disabled',false);let iframe=mQuery('#websiteCanvas iframe');if(!forceFetch&&iframe.length&&url===iframe.attr('src')){return;}
   790| mQuery('#builder-overlay').removeClass('hide');Mautic.loadedPreviewImage=url;var data={id:mQuery('#focus_unlockId').val(),website:url}
   791| mQuery('.preview-body').html('');Mautic.ajaxActionRequest('plugin:focus:checkIframeAvailability',data,function(response){if(response.errorMessage.length){mQuery('.website-placeholder').addClass('has-error').find('.help-block').html(response.errorMessage).removeClass('hide');mQuery('#builder-overlay').hide();mQuery('.website-placeholder').removeClass('hide').show();mQuery('#websiteCanvas').html('');mQuery('.builder-panel-top p button').prop('disabled',false);return;}
   792| mQuery('#builder-overlay').addClass('hide');mQuery('.btn-close-builder').prop('disabled',false);mQuery('.website-placeholder').removeClass('hide');mQuery('#websiteUrlPlaceholderInput').prop('disabled',false);mQuery('.btn-dropper').addClass('disabled');Mautic.focusCreateIframe(url);Mautic.ignoreMauticFocusPreviewUpdate=false;},false,false,"GET");}};Mautic.focusUpdatePreview=function(){var data=mQuery('form[name=focus]').formToArray();Mautic.ajaxActionRequest('plugin:focus:generatePreview',data,function(response){var container=mQuery('<div />');var innerContainer=mQuery('<div />').html(response.html);if(mQuery('.btn-viewport').data('viewport')=='mobile'){innerContainer.addClass('mf-responsive');}else{innerContainer.removeClass('mf-responsive');}
   793| container.append(innerContainer);mQuery('.preview-body').html(container);if(!mQuery('.mf-bar').length&&mQuery('.builder-content').length){mQuery('.builder-content').on('click',function(){Mautic.closeFocusModal(mQuery('#focus_style').val());});mQuery('.mautic-focus').on('click',function(e){e.stopPropagation();});}});};Mautic.setFocusDefaultColors=function(){mQuery('#focus_properties_colors_primary').minicolors('value','4e5d9d');mQuery('#focus_properties_colors_text').minicolors('value',(mQuery('#focus_style').val()=='bar')?'ffffff':'000000');mQuery('#focus_properties_colors_button').minicolors('value','fdb933');mQuery('#focus_properties_colors_button_text').minicolors('value','ffffff');};Mautic.toggleBarCollapse=function(){var svg='.mf-bar-collapser-icon svg';var currentSize=mQuery(svg).data('transform-size');var currentDirection=mQuery(svg).data('transform-direction');var currentScale=mQuery(svg).data('transform-scale');var newDirection=(parseInt(currentDirection)*-1);setTimeout(function(){mQuery(svg).find('g').first().attr('transform','scale('+currentScale+') rotate('+newDirection+' '+currentSize+' '+currentSize+')');mQuery(svg).data('transform-direction',newDirection);},500);if(mQuery('.mf-bar-collapser').hasClass('mf-bar-collapsed')){if(mQuery('.mf-bar').hasClass('mf-bar-top')){mQuery('.mf-bar').css('margin-top',0);}else{mQuery('.mf-bar').css('margin-bottom',0);}
   794| mQuery('.mf-bar-collapser').removeClass('mf-bar-collapsed');}else{if(mQuery('.mf-bar').hasClass('mf-bar-top')){mQuery('.mf-bar').css('margin-top',-60);}else{mQuery('.mf-bar').css('margin-bottom',-60);}
   795| mQuery('.mf-bar-collapser').addClass('mf-bar-collapsed');}}
   796| Mautic.closeFocusModal=function(style){mQuery('.mf-'+style).remove();if(mQuery('.mf-'+style+'-overlay').length){mQuery('.mf-'+style+'-overlay').remove();}}
   797| Mautic.closeFocusBuilder=function(el){if(typeof Mautic.ajaxActionXhr!='undefined'&&typeof Mautic.ajaxActionXhr['plugin:focus:generatePreview']!='undefined'){Mautic.ajaxActionXhr['plugin:focus:generatePreview'].abort();delete Mautic.ajaxActionXhr['plugin:focus:generatePreview'];}
   798| Mautic.stopIconSpinPostEvent();mQuery('.builder').removeClass('builder-active').addClass('hide');mQuery('body').css('overflow-y','');};Mautic.focusInitViewportSwitcher=function(){mQuery('.btn-viewport').on('click',function(){if(mQuery(this).data('viewport')=='mobile'){mQuery('.btn-viewport i').removeClass('fa-desktop fa-2x').addClass('fa-mobile-phone fa-3x');mQuery(this).data('viewport','desktop');Mautic.launchFocusBuilder(true);}else{mQuery('.btn-viewport i').removeClass('fa-mobile-phone fa-3x').addClass('fa-desktop fa-2x');mQuery(this).data('viewport','mobile');Mautic.launchFocusBuilder(true);}});}
   799| Mautic.focusCreateIframe=function(url){let builderCss={"pointer-events":"none",};if(mQuery('.btn-viewport').data('viewport')==='mobile'){mQuery('#websiteScreenshot').addClass('mobile');}else{builderCss.width="100%";builderCss.height=mQuery('#websiteScreenshot').height();mQuery('#websiteScreenshot').removeClass('mobile');}
   800| try{mQuery('#websiteCanvas').html('<iframe src="'+url+'" scrolling="no" frameBorder="0"></iframe>');mQuery('#websiteCanvas iframe').css(builderCss);}catch(err){alert(err.toString());}finally{mQuery('.website-placeholder').hide();Mautic.focusUpdatePreview();}};Mautic.getNetworkFormAction=function(networkType){if(networkType&&mQuery(networkType).val()&&mQuery(networkType).closest('.form-group').hasClass('has-error')){mQuery(networkType).closest('.form-group').removeClass('has-error');if(mQuery(networkType).next().hasClass('help-block')){mQuery(networkType).next().remove();}}
   801| Mautic.activateLabelLoadingIndicator('monitoring_networkType');var query="action=plugin:mauticSocial:getNetworkForm&networkType="+mQuery(networkType).val();mQuery.ajax({url:mauticAjaxUrl,type:"POST",data:query,dataType:"json",success:function(response){if(typeof response.html!='undefined'){mQuery('#properties-container').html(response.html);if(response.html!=''){Mautic.onPageLoad('#properties-container',response);}}},error:function(request,textStatus,errorThrown){Mautic.processAjaxError(request,textStatus,errorThrown);},complete:function(){Mautic.removeLabelLoadingIndicator();}});};Mautic.composeSocialWatcher=function(){var input=mQuery('textarea.tweet-message');Mautic.updateCharacterCount();input.on('keyup',function(){Mautic.updateCharacterCount();});var pageId=mQuery('select.tweet-insert-page');var assetId=mQuery('select.tweet-insert-asset');var handle=mQuery('button.tweet-insert-handle');pageId.on('change',function(){Mautic.insertSocialLink(pageId.val(),'pagelink',false);});assetId.on('change',function(){Mautic.insertSocialLink(assetId.val(),'assetlink',false);});handle.on('click',function(){Mautic.insertSocialLink(false,'twitter_handle',true);});};Mautic.getCharacterCount=function(){var tweetLenght=280;var currentLength=mQuery('textarea#twitter_tweet_text');return(tweetLenght-currentLength.val().length);};Mautic.updateCharacterCount=function(){var tweetCount=Mautic.getCharacterCount();var countContainer=mQuery('#character-count span');countContainer.text(tweetCount);};Mautic.insertSocialLink=function(id,type,skipId){if(!id&&!skipId){return;}
   802| if(skipId){var link='{'+type+'}';}
   803| else{var link='{'+type+'='+id+'}';}
   804| var textarea=mQuery('textarea.tweet-message');var currentVal=textarea.val();var newVal=(currentVal)?currentVal+' '+link:link;textarea.val(newVal);Mautic.updateCharacterCount();};


# ====================================================================
# FILE: plugins/GrapesJsBuilderBundle/Controller/FileManagerController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 7-31 ---
     7| class FileManagerController extends AjaxController
     8| {
     9|     /**
    10|      * @return JsonResponse
    11|      */
    12|     public function uploadAction()
    13|     {
    14|         /** @var FileManager $fileManager */
    15|         $fileManager = $this->get('grapesjsbuilder.helper.filemanager');
    16|         return $this->sendJsonResponse(['data'=> $fileManager->uploadFiles($this->request)]);
    17|     }
    18|     /**
    19|      * @param string $fileName
    20|      *
    21|      * @return JsonResponse
    22|      */
    23|     public function deleteAction()
    24|     {
    25|         /** @var FileManager $fileManager */
    26|         $fileManager = $this->get('grapesjsbuilder.helper.filemanager');
    27|         $fileName = $this->request->get('filename');
    28|         $fileManager->deleteFile($fileName);
    29|         return $this->sendJsonResponse(['success'=> true]);
    30|     }
    31| }


# ====================================================================
# FILE: plugins/MauticFocusBundle/Form/Type/FocusType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 15-55 ---
    15| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    16| use Symfony\Component\Form\Extension\Core\Type\TextType;
    17| use Symfony\Component\Form\Extension\Core\Type\UrlType;
    18| use Symfony\Component\Form\FormBuilderInterface;
    19| use Symfony\Component\OptionsResolver\OptionsResolver;
    20| class FocusType extends AbstractType
    21| {
    22|     /**
    23|      * @var CorePermissions
    24|      */
    25|     private $security;
    26|     /**
    27|      * FocusType constructor.
    28|      */
    29|     public function __construct(CorePermissions $security)
    30|     {
    31|         $this->security = $security;
    32|     }
    33|     public function buildForm(FormBuilderInterface $builder, array $options)
    34|     {
    35|         $builder->addEventSubscriber(new CleanFormSubscriber(['website' => 'url', 'html' => 'html', 'editor' => 'html']));
    36|         $builder->addEventSubscriber(new FormExitSubscriber('focus', $options));
    37|         $builder->add(
    38|             'name',
    39|             TextType::class,
    40|             [
    41|                 'label'      => 'mautic.core.name',
    42|                 'label_attr' => ['class' => 'control-label'],
    43|                 'attr'       => ['class' => 'form-control'],
    44|             ]
    45|         );
    46|         $builder->add(
    47|             'description',
    48|             TextareaType::class,
    49|             [
    50|                 'label'      => 'mautic.core.description',
    51|                 'label_attr' => ['class' => 'control-label'],
    52|                 'attr'       => ['class' => 'form-control editor'],
    53|                 'required'   => false,
    54|             ]
    55|         );


# ====================================================================
# FILE: plugins/MauticSocialBundle/Controller/MonitoringController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-35 ---
     1| <?php
     2| namespace MauticPlugin\MauticSocialBundle\Controller;
     3| use Mautic\CoreBundle\Controller\FormController;
     4| use Mautic\CoreBundle\Form\Type\DateRangeType;
     5| use Mautic\CoreBundle\Helper\Chart\LineChart;
     6| use Mautic\LeadBundle\Controller\EntityContactsTrait;
     7| use MauticPlugin\MauticSocialBundle\Entity\Monitoring;
     8| class MonitoringController extends FormController
     9| {
    10|     use EntityContactsTrait;
    11|     /*
    12|      * @param int $page
    13|      */
    14|     public function indexAction($page = 1)
    15|     {
    16|         $session = $this->get('session');
    17|         $this->setListFilters();
    18|         /** @var \MauticPlugin\MauticSocialBundle\Model\MonitoringModel $model */
    19|         $model = $this->getModel('social.monitoring');
    20|         $limit = $session->get('mautic.social.monitoring.limit', $this->container->getParameter('mautic.default_pagelimit'));
    21|         $start = (1 === $page) ? 0 : (($page - 1) * $limit);
    22|         if ($start < 0) {
    23|             $start = 0;
    24|         }
    25|         $search = $this->request->get('search', $session->get('mautic.social.monitoring.filter', ''));
    26|         $session->set('mautic.social.monitoring.filter', $search);
    27|         $filter = ['string' => $search, 'force' => []];
    28|         $orderBy    = $session->get('mautic.social.monitoring.orderby', 'e.title');
    29|         $orderByDir = $session->get('mautic.social.monitoring.orderbydir', 'DESC');
    30|         $monitoringList = $model->getEntities(
    31|             [
    32|                 'start'      => $start,
    33|                 'limit'      => $limit,
    34|                 'filter'     => $filter,
    35|                 'orderBy'    => $orderBy,


# ====================================================================
# FILE: plugins/MauticSocialBundle/Form/Type/MonitoringType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 9-49 ---
     9| use Symfony\Component\Form\AbstractType;
    10| use Symfony\Component\Form\Extension\Core\Type\ChoiceType;
    11| use Symfony\Component\Form\Extension\Core\Type\DateTimeType;
    12| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
    13| use Symfony\Component\Form\Extension\Core\Type\TextType;
    14| use Symfony\Component\Form\FormBuilderInterface;
    15| use Symfony\Component\OptionsResolver\OptionsResolver;
    16| class MonitoringType extends AbstractType
    17| {
    18|     /** @var MonitoringModel */
    19|     private $monitoringModel;
    20|     public function __construct(MonitoringModel $monitoringModel)
    21|     {
    22|         $this->monitoringModel = $monitoringModel;
    23|     }
    24|     /**
    25|      * {@inheritdoc}
    26|      */
    27|     public function buildForm(FormBuilderInterface $builder, array $options)
    28|     {
    29|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    30|         $builder->add('title', TextType::class, [
    31|             'label'      => 'mautic.core.name',
    32|             'label_attr' => ['class' => 'control-label'],
    33|             'attr'       => ['class' => 'form-control'],
    34|         ]);
    35|         $builder->add('description', TextareaType::class, [
    36|             'label'      => 'mautic.core.description',
    37|             'label_attr' => ['class' => 'control-label'],
    38|             'attr'       => ['class' => 'form-control editor'],
    39|             'required'   => false,
    40|         ]);
    41|         $builder->add('isPublished', YesNoButtonGroupType::class);
    42|         $builder->add('publishUp', DateTimeType::class, [
    43|             'widget'     => 'single_text',
    44|             'label'      => 'mautic.core.form.publishup',
    45|             'label_attr' => ['class' => 'control-label'],
    46|             'attr'       => [
    47|                 'class'       => 'form-control',
    48|                 'data-toggle' => 'datetime',
    49|             ],


# ====================================================================
# FILE: plugins/MauticTagManagerBundle/Controller/TagController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 174-213 ---
   174|                 'entity' => $tag,
   175|             ],
   176|             'contentTemplate' => 'MauticTagManagerBundle:Tag:form.html.php',
   177|             'passthroughVars' => [
   178|                 'activeLink'    => '#mautic_tagmanager_index',
   179|                 'route'         => $this->generateUrl('mautic_tagmanager_action', ['objectAction' => 'new']),
   180|                 'mauticContent' => 'tagmanager',
   181|             ],
   182|         ]);
   183|     }
   184|     /**
   185|      * Generate's edit form and processes post data.
   186|      *
   187|      * @param int  $objectId
   188|      * @param bool $ignorePost
   189|      *
   190|      * @return Response
   191|      */
   192|     public function editAction($objectId, $ignorePost = false)
   193|     {
   194|         $postActionVars = $this->getPostActionVars($objectId);
   195|         try {
   196|             $tag = $this->getTag($objectId);
   197|             return $this->createTagModifyResponse(
   198|                 $tag,
   199|                 $postActionVars,
   200|                 $this->generateUrl('mautic_tagmanager_action', ['objectAction' => 'edit', 'objectId' => $objectId]),
   201|                 $ignorePost
   202|             );
   203|         } catch (AccessDeniedException $exception) {
   204|             return $this->accessDenied();
   205|         } catch (EntityNotFoundException $exception) {
   206|             return $this->postActionRedirect(
   207|                 array_merge($postActionVars, [
   208|                     'flashes' => [
   209|                         [
   210|                             'type'    => 'error',
   211|                             'msg'     => 'mautic.tagmanager.tag.error.notfound',
   212|                             'msgVars' => ['%id%' => $objectId],
   213|                         ],


# ====================================================================
# FILE: plugins/MauticTagManagerBundle/Form/Type/TagEntityType.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-35 ---
     1| <?php
     2| namespace MauticPlugin\MauticTagManagerBundle\Form\Type;
     3| use Mautic\CoreBundle\Form\EventListener\CleanFormSubscriber;
     4| use Mautic\CoreBundle\Form\Type\FormButtonsType;
     5| use Symfony\Component\Form\AbstractType;
     6| use Symfony\Component\Form\Extension\Core\Type\TextareaType;
     7| use Symfony\Component\Form\Extension\Core\Type\TextType;
     8| use Symfony\Component\Form\FormBuilderInterface;
     9| use Symfony\Component\Validator\Constraints\NotBlank;
    10| class TagEntityType extends AbstractType
    11| {
    12|     public function buildForm(FormBuilderInterface $builder, array $options): void
    13|     {
    14|         $builder->add('buttons', FormButtonsType::class);
    15|         $builder->addEventSubscriber(new CleanFormSubscriber(['description' => 'html']));
    16|         $tagReadOnly = !empty($options['data']) && $options['data']->getId() ? true : false;
    17|         $builder->add(
    18|             'tag',
    19|             TextType::class,
    20|             [
    21|                 'label'       => 'mautic.core.name',
    22|                 'label_attr'  => ['class' => 'control-label'],
    23|                 'attr'        => ['class' => 'form-control', 'readonly' => $tagReadOnly],
    24|                 'constraints' => [
    25|                     new NotBlank(
    26|                         [
    27|                             'message' => 'mautic.core.value.required',
    28|                         ]
    29|                     ),
    30|                 ],
    31|             ]
    32|         );
    33|         $builder->add(
    34|             'description',
    35|             TextareaType::class,

