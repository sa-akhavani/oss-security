# ====================================================================
# FILE: apps/advanced/backend/assets/AppAsset.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace backend\assets;
     8| use yii\web\AssetBundle;
     9| /**
    10|  * @author Qiang Xue <qiang.xue@gmail.com>
    11|  * @since 2.0
    12|  */
    13| class AppAsset extends AssetBundle
    14| {
    15|     public $basePath = '@webroot';
    16|     public $baseUrl = '@web';
    17|     public $css = [
    18|         'css/site.css',
    19|     ];
    20|     public $js = [
    21|     ];
    22|     public $depends = [
    23|         'yii\web\YiiAsset',
    24|         'yii\bootstrap\BootstrapAsset',
    25|     ];
    26| }


# ====================================================================
# FILE: apps/advanced/backend/config/bootstrap.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1 ---
     1| <?php


# ====================================================================
# FILE: apps/advanced/backend/config/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-33 ---
     1| <?php
     2| $params = array_merge(
     3|     require(__DIR__ . '/../../common/config/params.php'),
     4|     require(__DIR__ . '/../../common/config/params-local.php'),
     5|     require(__DIR__ . '/params.php'),
     6|     require(__DIR__ . '/params-local.php')
     7| );
     8| return [
     9|     'id' => 'app-backend',
    10|     'basePath' => dirname(__DIR__),
    11|     'controllerNamespace' => 'backend\controllers',
    12|     'bootstrap' => ['log'],
    13|     'modules' => [],
    14|     'components' => [
    15|         'user' => [
    16|             'identityClass' => 'common\models\User',
    17|             'enableAutoLogin' => true,
    18|         ],
    19|         'log' => [
    20|             'traceLevel' => YII_DEBUG ? 3 : 0,
    21|             'targets' => [
    22|                 [
    23|                     'class' => 'yii\log\FileTarget',
    24|                     'levels' => ['error', 'warning'],
    25|                 ],
    26|             ],
    27|         ],
    28|         'errorHandler' => [
    29|             'errorAction' => 'site/error',
    30|         ],
    31|     ],
    32|     'params' => $params,
    33| ];


# ====================================================================
# FILE: apps/advanced/backend/config/params.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| <?php
     2| return [
     3|     'adminEmail' => 'admin@example.com',
     4| ];


# ====================================================================
# FILE: apps/advanced/backend/controllers/SiteController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-75 ---
     1| <?php
     2| namespace backend\controllers;
     3| use Yii;
     4| use yii\filters\AccessControl;
     5| use yii\web\Controller;
     6| use common\models\LoginForm;
     7| use yii\filters\VerbFilter;
     8| /**
     9|  * Site controller
    10|  */
    11| class SiteController extends Controller
    12| {
    13|     /**
    14|      * @inheritdoc
    15|      */
    16|     public function behaviors()
    17|     {
    18|         return [
    19|             'access' => [
    20|                 'class' => AccessControl::className(),
    21|                 'rules' => [
    22|                     [
    23|                         'actions' => ['login', 'error'],
    24|                         'allow' => true,
    25|                     ],
    26|                     [
    27|                         'actions' => ['logout', 'index'],
    28|                         'allow' => true,
    29|                         'roles' => ['@'],
    30|                     ],
    31|                 ],
    32|             ],
    33|             'verbs' => [
    34|                 'class' => VerbFilter::className(),
    35|                 'actions' => [
    36|                     'logout' => ['post'],
    37|                 ],
    38|             ],
    39|         ];
    40|     }
    41|     /**
    42|      * @inheritdoc
    43|      */
    44|     public function actions()
    45|     {
    46|         return [
    47|             'error' => [
    48|                 'class' => 'yii\web\ErrorAction',
    49|             ],
    50|         ];
    51|     }
    52|     public function actionIndex()
    53|     {
    54|         return $this->render('index');
    55|     }
    56|     public function actionLogin()
    57|     {
    58|         if (!\Yii::$app->user->isGuest) {
    59|             return $this->goHome();
    60|         }
    61|         $model = new LoginForm();
    62|         if ($model->load(Yii::$app->request->post()) && $model->login()) {
    63|             return $this->goBack();
    64|         } else {
    65|             return $this->render('login', [
    66|                 'model' => $model,
    67|             ]);
    68|         }
    69|     }
    70|     public function actionLogout()
    71|     {
    72|         Yii::$app->user->logout();
    73|         return $this->goHome();
    74|     }
    75| }


# ====================================================================
# FILE: apps/advanced/backend/views/layouts/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-66 ---
     1| <?php
     2| use backend\assets\AppAsset;
     3| use yii\helpers\Html;
     4| use yii\bootstrap\Nav;
     5| use yii\bootstrap\NavBar;
     6| use yii\widgets\Breadcrumbs;
     7| /* @var $this \yii\web\View */
     8| /* @var $content string */
     9| AppAsset::register($this);
    10| ?>
    11| <?php $this->beginPage() ?>
    12| <!DOCTYPE html>
    13| <html lang="<?= Yii::$app->language ?>">
    14| <head>
    15|     <meta charset="<?= Yii::$app->charset ?>">
    16|     <meta name="viewport" content="width=device-width, initial-scale=1">
    17|     <?= Html::csrfMetaTags() ?>
    18|     <title><?= Html::encode($this->title) ?></title>
    19|     <?php $this->head() ?>
    20| </head>
    21| <body>
    22|     <?php $this->beginBody() ?>
    23|     <div class="wrap">
    24|         <?php
    25|             NavBar::begin([
    26|                 'brandLabel' => 'My Company',
    27|                 'brandUrl' => Yii::$app->homeUrl,
    28|                 'options' => [
    29|                     'class' => 'navbar-inverse navbar-fixed-top',
    30|                 ],
    31|             ]);
    32|             $menuItems = [
    33|                 ['label' => 'Home', 'url' => ['/site/index']],
    34|             ];
    35|             if (Yii::$app->user->isGuest) {
    36|                 $menuItems[] = ['label' => 'Login', 'url' => ['/site/login']];
    37|             } else {
    38|                 $menuItems[] = [
    39|                     'label' => 'Logout (' . Yii::$app->user->identity->username . ')',
    40|                     'url' => ['/site/logout'],
    41|                     'linkOptions' => ['data-method' => 'post']
    42|                 ];
    43|             }
    44|             echo Nav::widget([
    45|                 'options' => ['class' => 'navbar-nav navbar-right'],
    46|                 'items' => $menuItems,
    47|             ]);
    48|             NavBar::end();
    49|         ?>
    50|         <div class="container">
    51|         <?= Breadcrumbs::widget([
    52|             'links' => isset($this->params['breadcrumbs']) ? $this->params['breadcrumbs'] : [],
    53|         ]) ?>
    54|         <?= $content ?>
    55|         </div>
    56|     </div>
    57|     <footer class="footer">
    58|         <div class="container">
    59|         <p class="pull-left">&copy; My Company <?= date('Y') ?></p>
    60|         <p class="pull-right"><?= Yii::powered() ?></p>
    61|         </div>
    62|     </footer>
    63|     <?php $this->endBody() ?>
    64| </body>
    65| </html>
    66| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/advanced/backend/views/site/error.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-20 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| /* @var $name string */
     5| /* @var $message string */
     6| /* @var $exception Exception */
     7| $this->title = $name;
     8| ?>
     9| <div class="site-error">
    10|     <h1><?= Html::encode($this->title) ?></h1>
    11|     <div class="alert alert-danger">
    12|         <?= nl2br(Html::encode($message)) ?>
    13|     </div>
    14|     <p>
    15|         The above error occurred while the Web server was processing your request.
    16|     </p>
    17|     <p>
    18|         Please contact us if you think this is a server error. Thank you.
    19|     </p>
    20| </div>


# ====================================================================
# FILE: apps/advanced/backend/views/site/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-39 ---
     1| <?php
     2| /* @var $this yii\web\View */
     3| $this->title = 'My Yii Application';
     4| ?>
     5| <div class="site-index">
     6|     <div class="jumbotron">
     7|         <h1>Congratulations!</h1>
     8|         <p class="lead">You have successfully created your Yii-powered application.</p>
     9|         <p><a class="btn btn-lg btn-success" href="http://www.yiiframework.com">Get started with Yii</a></p>
    10|     </div>
    11|     <div class="body-content">
    12|         <div class="row">
    13|             <div class="col-lg-4">
    14|                 <h2>Heading</h2>
    15|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    16|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    17|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    18|                     fugiat nulla pariatur.</p>
    19|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/doc/">Yii Documentation &raquo;</a></p>
    20|             </div>
    21|             <div class="col-lg-4">
    22|                 <h2>Heading</h2>
    23|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    24|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    25|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    26|                     fugiat nulla pariatur.</p>
    27|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/forum/">Yii Forum &raquo;</a></p>
    28|             </div>
    29|             <div class="col-lg-4">
    30|                 <h2>Heading</h2>
    31|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    32|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    33|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    34|                     fugiat nulla pariatur.</p>
    35|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/extensions/">Yii Extensions &raquo;</a></p>
    36|             </div>
    37|         </div>
    38|     </div>
    39| </div>


# ====================================================================
# FILE: apps/advanced/backend/views/site/login.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model \common\models\LoginForm */
     7| $this->title = 'Login';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-login">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please fill out the following fields to login:</p>
    13|     <div class="row">
    14|         <div class="col-lg-5">
    15|             <?php $form = ActiveForm::begin(['id' => 'login-form']); ?>
    16|                 <?= $form->field($model, 'username') ?>
    17|                 <?= $form->field($model, 'password')->passwordInput() ?>
    18|                 <?= $form->field($model, 'rememberMe')->checkbox() ?>
    19|                 <div class="form-group">
    20|                     <?= Html::submitButton('Login', ['class' => 'btn btn-primary', 'name' => 'login-button']) ?>
    21|                 </div>
    22|             <?php ActiveForm::end(); ?>
    23|         </div>
    24|     </div>
    25| </div>


# ====================================================================
# FILE: apps/advanced/common/config/bootstrap.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-5 ---
     1| <?php
     2| Yii::setAlias('common', dirname(__DIR__));
     3| Yii::setAlias('frontend', dirname(dirname(__DIR__)) . '/frontend');
     4| Yii::setAlias('backend', dirname(dirname(__DIR__)) . '/backend');
     5| Yii::setAlias('console', dirname(dirname(__DIR__)) . '/console');


# ====================================================================
# FILE: apps/advanced/common/config/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-9 ---
     1| <?php
     2| return [
     3|     'vendorPath' => dirname(dirname(__DIR__)) . '/vendor',
     4|     'components' => [
     5|         'cache' => [
     6|             'class' => 'yii\caching\FileCache',
     7|         ],
     8|     ],
     9| ];


# ====================================================================
# FILE: apps/advanced/common/config/params.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-6 ---
     1| <?php
     2| return [
     3|     'adminEmail' => 'admin@example.com',
     4|     'supportEmail' => 'support@example.com',
     5|     'user.passwordResetTokenExpire' => 3600,
     6| ];


# ====================================================================
# FILE: apps/advanced/common/mail/layouts/html.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this \yii\web\View view component instance */
     4| /* @var $message \yii\mail\MessageInterface the message being composed */
     5| /* @var $content string main view render result */
     6| ?>
     7| <?php $this->beginPage() ?>
     8| <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
     9| <html xmlns="http://www.w3.org/1999/xhtml">
    10| <head>
    11|     <meta http-equiv="Content-Type" content="text/html; charset=<?= Yii::$app->charset ?>" />
    12|     <title><?= Html::encode($this->title) ?></title>
    13|     <?php $this->head() ?>
    14| </head>
    15| <body>
    16|     <?php $this->beginBody() ?>
    17|     <?= $content ?>
    18|     <?php $this->endBody() ?>
    19| </body>
    20| </html>
    21| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/advanced/common/mail/layouts/text.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this \yii\web\View view component instance */
     4| /* @var $message \yii\mail\MessageInterface the message being composed */
     5| /* @var $content string main view render result */
     6| ?>
     7| <?php $this->beginPage() ?>
     8| <?php $this->beginBody() ?>
     9| <?= $content ?>
    10| <?php $this->endBody() ?>
    11| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/advanced/common/mail/passwordResetToken-html.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| /* @var $user common\models\User */
     5| $resetLink = Yii::$app->urlManager->createAbsoluteUrl(['site/reset-password', 'token' => $user->password_reset_token]);
     6| ?>
     7| <div class="password-reset">
     8|     <p>Hello <?= Html::encode($user->username) ?>,</p>
     9|     <p>Follow the link below to reset your password:</p>
    10|     <p><?= Html::a(Html::encode($resetLink), $resetLink) ?></p>
    11| </div>


# ====================================================================
# FILE: apps/advanced/common/mail/passwordResetToken-text.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-8 ---
     1| <?php
     2| /* @var $this yii\web\View */
     3| /* @var $user common\models\User */
     4| $resetLink = Yii::$app->urlManager->createAbsoluteUrl(['site/reset-password', 'token' => $user->password_reset_token]);
     5| ?>
     6| Hello <?= $user->username ?>,
     7| Follow the link below to reset your password:
     8| <?= $resetLink ?>


# ====================================================================
# FILE: apps/advanced/common/models/LoginForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-66 ---
     1| <?php
     2| namespace common\models;
     3| use Yii;
     4| use yii\base\Model;
     5| /**
     6|  * Login form
     7|  */
     8| class LoginForm extends Model
     9| {
    10|     public $username;
    11|     public $password;
    12|     public $rememberMe = true;
    13|     private $_user = false;
    14|     /**
    15|      * @inheritdoc
    16|      */
    17|     public function rules()
    18|     {
    19|         return [
    20|             [['username', 'password'], 'required'],
    21|             ['rememberMe', 'boolean'],
    22|             ['password', 'validatePassword'],
    23|         ];
    24|     }
    25|     /**
    26|      * Validates the password.
    27|      * This method serves as the inline validation for password.
    28|      *
    29|      * @param string $attribute the attribute currently being validated
    30|      * @param array $params the additional name-value pairs given in the rule
    31|      */
    32|     public function validatePassword($attribute, $params)
    33|     {
    34|         if (!$this->hasErrors()) {
    35|             $user = $this->getUser();
    36|             if (!$user || !$user->validatePassword($this->password)) {
    37|                 $this->addError($attribute, 'Incorrect username or password.');
    38|             }
    39|         }
    40|     }
    41|     /**
    42|      * Logs in a user using the provided username and password.
    43|      *
    44|      * @return boolean whether the user is logged in successfully
    45|      */
    46|     public function login()
    47|     {
    48|         if ($this->validate()) {
    49|             return Yii::$app->user->login($this->getUser(), $this->rememberMe ? 3600 * 24 * 30 : 0);
    50|         } else {
    51|             return false;
    52|         }
    53|     }
    54|     /**
    55|      * Finds user by [[username]]
    56|      *
    57|      * @return User|null
    58|      */
    59|     public function getUser()
    60|     {
    61|         if ($this->_user === false) {
    62|             $this->_user = User::findByUsername($this->username);
    63|         }
    64|         return $this->_user;
    65|     }
    66| }


# ====================================================================
# FILE: apps/advanced/common/models/User.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-169 ---
     1| <?php
     2| namespace common\models;
     3| use Yii;
     4| use yii\base\NotSupportedException;
     5| use yii\behaviors\TimestampBehavior;
     6| use yii\db\ActiveRecord;
     7| use yii\web\IdentityInterface;
     8| /**
     9|  * User model
    10|  *
    11|  * @property integer $id
    12|  * @property string $username
    13|  * @property string $password_hash
    14|  * @property string $password_reset_token
    15|  * @property string $email
    16|  * @property string $auth_key
    17|  * @property integer $status
    18|  * @property integer $created_at
    19|  * @property integer $updated_at
    20|  * @property string $password write-only password
    21|  */
    22| class User extends ActiveRecord implements IdentityInterface
    23| {
    24|     const STATUS_DELETED = 0;
    25|     const STATUS_ACTIVE = 10;
    26|     /**
    27|      * @inheritdoc
    28|      */
    29|     public static function tableName()
    30|     {
    31|         return '{{%user}}';
    32|     }
    33|     /**
    34|      * @inheritdoc
    35|      */
    36|     public function behaviors()
    37|     {
    38|         return [
    39|             TimestampBehavior::className(),
    40|         ];
    41|     }
    42|     /**
    43|      * @inheritdoc
    44|      */
    45|     public function rules()
    46|     {
    47|         return [
    48|             ['status', 'default', 'value' => self::STATUS_ACTIVE],
    49|             ['status', 'in', 'range' => [self::STATUS_ACTIVE, self::STATUS_DELETED]],
    50|         ];
    51|     }
    52|     /**
    53|      * @inheritdoc
    54|      */
    55|     public static function findIdentity($id)
    56|     {
    57|         return static::findOne(['id' => $id, 'status' => self::STATUS_ACTIVE]);
    58|     }
    59|     /**
    60|      * @inheritdoc
    61|      */
    62|     public static function findIdentityByAccessToken($token, $type = null)
    63|     {
    64|         throw new NotSupportedException('"findIdentityByAccessToken" is not implemented.');
    65|     }
    66|     /**
    67|      * Finds user by username
    68|      *
    69|      * @param string $username
    70|      * @return static|null
    71|      */
    72|     public static function findByUsername($username)
    73|     {
    74|         return static::findOne(['username' => $username, 'status' => self::STATUS_ACTIVE]);
    75|     }
    76|     /**
    77|      * Finds user by password reset token
    78|      *
    79|      * @param string $token password reset token
    80|      * @return static|null
    81|      */
    82|     public static function findByPasswordResetToken($token)
    83|     {
    84|         if (!static::isPasswordResetTokenValid($token)) {
    85|             return null;
    86|         }
    87|         return static::findOne([
    88|             'password_reset_token' => $token,
    89|             'status' => self::STATUS_ACTIVE,
    90|         ]);
    91|     }
    92|     /**
    93|      * Finds out if password reset token is valid
    94|      *
    95|      * @param string $token password reset token
    96|      * @return boolean
    97|      */
    98|     public static function isPasswordResetTokenValid($token)
    99|     {
   100|         if (empty($token)) {
   101|             return false;
   102|         }
   103|         $expire = Yii::$app->params['user.passwordResetTokenExpire'];
   104|         $parts = explode('_', $token);
   105|         $timestamp = (int) end($parts);
   106|         return $timestamp + $expire >= time();
   107|     }
   108|     /**
   109|      * @inheritdoc
   110|      */
   111|     public function getId()
   112|     {
   113|         return $this->getPrimaryKey();
   114|     }
   115|     /**
   116|      * @inheritdoc
   117|      */
   118|     public function getAuthKey()
   119|     {
   120|         return $this->auth_key;
   121|     }
   122|     /**
   123|      * @inheritdoc
   124|      */
   125|     public function validateAuthKey($authKey)
   126|     {
   127|         return $this->getAuthKey() === $authKey;
   128|     }
   129|     /**
   130|      * Validates password
   131|      *
   132|      * @param string $password password to validate
   133|      * @return boolean if password provided is valid for current user
   134|      */
   135|     public function validatePassword($password)
   136|     {
   137|         return Yii::$app->security->validatePassword($password, $this->password_hash);
   138|     }
   139|     /**
   140|      * Generates password hash from password and sets it to the model
   141|      *
   142|      * @param string $password
   143|      */
   144|     public function setPassword($password)
   145|     {
   146|         $this->password_hash = Yii::$app->security->generatePasswordHash($password);
   147|     }
   148|     /**
   149|      * Generates "remember me" authentication key
   150|      */
   151|     public function generateAuthKey()
   152|     {
   153|         $this->auth_key = Yii::$app->security->generateRandomString();
   154|     }
   155|     /**
   156|      * Generates new password reset token
   157|      */
   158|     public function generatePasswordResetToken()
   159|     {
   160|         $this->password_reset_token = Yii::$app->security->generateRandomString() . '_' . time();
   161|     }
   162|     /**
   163|      * Removes password reset token
   164|      */
   165|     public function removePasswordResetToken()
   166|     {
   167|         $this->password_reset_token = null;
   168|     }
   169| }


# ====================================================================
# FILE: apps/advanced/console/config/bootstrap.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1 ---
     1| <?php


# ====================================================================
# FILE: apps/advanced/console/config/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| $params = array_merge(
     3|     require(__DIR__ . '/../../common/config/params.php'),
     4|     require(__DIR__ . '/../../common/config/params-local.php'),
     5|     require(__DIR__ . '/params.php'),
     6|     require(__DIR__ . '/params-local.php')
     7| );
     8| return [
     9|     'id' => 'app-console',
    10|     'basePath' => dirname(__DIR__),
    11|     'bootstrap' => ['log'],
    12|     'controllerNamespace' => 'console\controllers',
    13|     'components' => [
    14|         'log' => [
    15|             'targets' => [
    16|                 [
    17|                     'class' => 'yii\log\FileTarget',
    18|                     'levels' => ['error', 'warning'],
    19|                 ],
    20|             ],
    21|         ],
    22|     ],
    23|     'params' => $params,
    24| ];


# ====================================================================
# FILE: apps/advanced/console/config/params.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| <?php
     2| return [
     3|     'adminEmail' => 'admin@example.com',
     4| ];


# ====================================================================
# FILE: apps/advanced/console/migrations/m130524_201442_init.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| <?php
     2| use yii\db\Schema;
     3| use yii\db\Migration;
     4| class m130524_201442_init extends Migration
     5| {
     6|     public function up()
     7|     {
     8|         $tableOptions = null;
     9|         if ($this->db->driverName === 'mysql') {
    10|             $tableOptions = 'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB';
    11|         }
    12|         $this->createTable('{{%user}}', [
    13|             'id' => Schema::TYPE_PK,
    14|             'username' => Schema::TYPE_STRING . ' NOT NULL',
    15|             'auth_key' => Schema::TYPE_STRING . '(32) NOT NULL',
    16|             'password_hash' => Schema::TYPE_STRING . ' NOT NULL',
    17|             'password_reset_token' => Schema::TYPE_STRING,
    18|             'email' => Schema::TYPE_STRING . ' NOT NULL',
    19|             'status' => Schema::TYPE_SMALLINT . ' NOT NULL DEFAULT 10',
    20|             'created_at' => Schema::TYPE_INTEGER . ' NOT NULL',
    21|             'updated_at' => Schema::TYPE_INTEGER . ' NOT NULL',
    22|         ], $tableOptions);
    23|     }
    24|     public function down()
    25|     {
    26|         $this->dropTable('{{%user}}');
    27|     }
    28| }


# ====================================================================
# FILE: apps/advanced/environments/dev/backend/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| $config = [
     3|     'components' => [
     4|         'request' => [
     5|             'cookieValidationKey' => '',
     6|         ],
     7|     ],
     8| ];
     9| if (!YII_ENV_TEST) {
    10|     $config['bootstrap'][] = 'debug';
    11|     $config['modules']['debug'] = 'yii\debug\Module';
    12|     $config['bootstrap'][] = 'gii';
    13|     $config['modules']['gii'] = 'yii\gii\Module';
    14| }
    15| return $config;


# ====================================================================
# FILE: apps/advanced/environments/dev/backend/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/backend/web/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', true);
     3| defined('YII_ENV') or define('YII_ENV', 'dev');
     4| require(__DIR__ . '/../../vendor/autoload.php');
     5| require(__DIR__ . '/../../vendor/yiisoft/yii2/Yii.php');
     6| require(__DIR__ . '/../../common/config/bootstrap.php');
     7| require(__DIR__ . '/../config/bootstrap.php');
     8| $config = yii\helpers\ArrayHelper::merge(
     9|     require(__DIR__ . '/../../common/config/main.php'),
    10|     require(__DIR__ . '/../../common/config/main-local.php'),
    11|     require(__DIR__ . '/../config/main.php'),
    12|     require(__DIR__ . '/../config/main-local.php')
    13| );
    14| $application = new yii\web\Application($config);
    15| $application->run();


# ====================================================================
# FILE: apps/advanced/environments/dev/common/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-17 ---
     1| <?php
     2| return [
     3|     'components' => [
     4|         'db' => [
     5|             'class' => 'yii\db\Connection',
     6|             'dsn' => 'mysql:host=localhost;dbname=yii2advanced',
     7|             'username' => 'root',
     8|             'password' => '',
     9|             'charset' => 'utf8',
    10|         ],
    11|         'mailer' => [
    12|             'class' => 'yii\swiftmailer\Mailer',
    13|             'viewPath' => '@common/mail',
    14|             'useFileTransport' => true,
    15|         ],
    16|     ],
    17| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/common/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/console/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-7 ---
     1| <?php
     2| return [
     3|     'bootstrap' => ['gii'],
     4|     'modules' => [
     5|         'gii' => 'yii\gii\Module',
     6|     ],
     7| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/console/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/frontend/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| $config = [
     3|     'components' => [
     4|         'request' => [
     5|             'cookieValidationKey' => '',
     6|         ],
     7|     ],
     8| ];
     9| if (!YII_ENV_TEST) {
    10|     $config['bootstrap'][] = 'debug';
    11|     $config['modules']['debug'] = 'yii\debug\Module';
    12|     $config['bootstrap'][] = 'gii';
    13|     $config['modules']['gii'] = 'yii\gii\Module';
    14| }
    15| return $config;


# ====================================================================
# FILE: apps/advanced/environments/dev/frontend/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/dev/frontend/web/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', true);
     3| defined('YII_ENV') or define('YII_ENV', 'dev');
     4| require(__DIR__ . '/../../vendor/autoload.php');
     5| require(__DIR__ . '/../../vendor/yiisoft/yii2/Yii.php');
     6| require(__DIR__ . '/../../common/config/bootstrap.php');
     7| require(__DIR__ . '/../config/bootstrap.php');
     8| $config = yii\helpers\ArrayHelper::merge(
     9|     require(__DIR__ . '/../../common/config/main.php'),
    10|     require(__DIR__ . '/../../common/config/main-local.php'),
    11|     require(__DIR__ . '/../config/main.php'),
    12|     require(__DIR__ . '/../config/main-local.php')
    13| );
    14| $application = new yii\web\Application($config);
    15| $application->run();


# ====================================================================
# FILE: apps/advanced/environments/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-61 ---
     1| <?php
     2| /**
     3|  * The manifest of files that are local to specific environment.
     4|  * This file returns a list of environments that the application
     5|  * may be installed under. The returned data must be in the following
     6|  * format:
     7|  *
     8|  * ```php
     9|  * return [
    10|  *     'environment name' => [
    11|  *         'path' => 'directory storing the local files',
    12|  *         'setWritable' => [
    13|  *             // list of directories that should be set writable
    14|  *         ],
    15|  *         'setExecutable' => [
    16|  *             // list of files that should be set executable
    17|  *         ],
    18|  *         'setCookieValidationKey' => [
    19|  *             // list of config files that need to be inserted with automatically generated cookie validation keys
    20|  *         ],
    21|  *         'createSymlink' => [
    22|  *             // list of symlinks to be created. Keys are symlinks, and values are the targets.
    23|  *         ],
    24|  *     ],
    25|  * ];
    26|  * ```
    27|  */
    28| return [
    29|     'Development' => [
    30|         'path' => 'dev',
    31|         'setWritable' => [
    32|             'backend/runtime',
    33|             'backend/web/assets',
    34|             'frontend/runtime',
    35|             'frontend/web/assets',
    36|         ],
    37|         'setExecutable' => [
    38|             'yii',
    39|         ],
    40|         'setCookieValidationKey' => [
    41|             'backend/config/main-local.php',
    42|             'frontend/config/main-local.php',
    43|         ],
    44|     ],
    45|     'Production' => [
    46|         'path' => 'prod',
    47|         'setWritable' => [
    48|             'backend/runtime',
    49|             'backend/web/assets',
    50|             'frontend/runtime',
    51|             'frontend/web/assets',
    52|         ],
    53|         'setExecutable' => [
    54|             'yii',
    55|         ],
    56|         'setCookieValidationKey' => [
    57|             'backend/config/main-local.php',
    58|             'frontend/config/main-local.php',
    59|         ],
    60|     ],
    61| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/backend/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-8 ---
     1| <?php
     2| return [
     3|     'components' => [
     4|         'request' => [
     5|             'cookieValidationKey' => '',
     6|         ],
     7|     ],
     8| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/backend/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/backend/web/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', false);
     3| defined('YII_ENV') or define('YII_ENV', 'prod');
     4| require(__DIR__ . '/../../vendor/autoload.php');
     5| require(__DIR__ . '/../../vendor/yiisoft/yii2/Yii.php');
     6| require(__DIR__ . '/../../common/config/bootstrap.php');
     7| require(__DIR__ . '/../config/bootstrap.php');
     8| $config = yii\helpers\ArrayHelper::merge(
     9|     require(__DIR__ . '/../../common/config/main.php'),
    10|     require(__DIR__ . '/../../common/config/main-local.php'),
    11|     require(__DIR__ . '/../config/main.php'),
    12|     require(__DIR__ . '/../config/main-local.php')
    13| );
    14| $application = new yii\web\Application($config);
    15| $application->run();


# ====================================================================
# FILE: apps/advanced/environments/prod/common/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| <?php
     2| return [
     3|     'components' => [
     4|         'db' => [
     5|             'class' => 'yii\db\Connection',
     6|             'dsn' => 'mysql:host=localhost;dbname=yii2advanced',
     7|             'username' => 'root',
     8|             'password' => '',
     9|             'charset' => 'utf8',
    10|         ],
    11|         'mailer' => [
    12|             'class' => 'yii\swiftmailer\Mailer',
    13|             'viewPath' => '@common/mail',
    14|         ],
    15|     ],
    16| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/common/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/console/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/console/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/frontend/config/main-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-8 ---
     1| <?php
     2| return [
     3|     'components' => [
     4|         'request' => [
     5|             'cookieValidationKey' => '',
     6|         ],
     7|     ],
     8| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/frontend/config/params-local.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| <?php
     2| return [
     3| ];


# ====================================================================
# FILE: apps/advanced/environments/prod/frontend/web/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', false);
     3| defined('YII_ENV') or define('YII_ENV', 'prod');
     4| require(__DIR__ . '/../../vendor/autoload.php');
     5| require(__DIR__ . '/../../vendor/yiisoft/yii2/Yii.php');
     6| require(__DIR__ . '/../../common/config/bootstrap.php');
     7| require(__DIR__ . '/../config/bootstrap.php');
     8| $config = yii\helpers\ArrayHelper::merge(
     9|     require(__DIR__ . '/../../common/config/main.php'),
    10|     require(__DIR__ . '/../../common/config/main-local.php'),
    11|     require(__DIR__ . '/../config/main.php'),
    12|     require(__DIR__ . '/../config/main-local.php')
    13| );
    14| $application = new yii\web\Application($config);
    15| $application->run();


# ====================================================================
# FILE: apps/advanced/frontend/assets/AppAsset.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace frontend\assets;
     8| use yii\web\AssetBundle;
     9| /**
    10|  * @author Qiang Xue <qiang.xue@gmail.com>
    11|  * @since 2.0
    12|  */
    13| class AppAsset extends AssetBundle
    14| {
    15|     public $basePath = '@webroot';
    16|     public $baseUrl = '@web';
    17|     public $css = [
    18|         'css/site.css',
    19|     ];
    20|     public $js = [
    21|     ];
    22|     public $depends = [
    23|         'yii\web\YiiAsset',
    24|         'yii\bootstrap\BootstrapAsset',
    25|     ];
    26| }


# ====================================================================
# FILE: apps/advanced/frontend/config/bootstrap.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1 ---
     1| <?php


# ====================================================================
# FILE: apps/advanced/frontend/config/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| <?php
     2| $params = array_merge(
     3|     require(__DIR__ . '/../../common/config/params.php'),
     4|     require(__DIR__ . '/../../common/config/params-local.php'),
     5|     require(__DIR__ . '/params.php'),
     6|     require(__DIR__ . '/params-local.php')
     7| );
     8| return [
     9|     'id' => 'app-frontend',
    10|     'basePath' => dirname(__DIR__),
    11|     'bootstrap' => ['log'],
    12|     'controllerNamespace' => 'frontend\controllers',
    13|     'components' => [
    14|         'user' => [
    15|             'identityClass' => 'common\models\User',
    16|             'enableAutoLogin' => true,
    17|         ],
    18|         'log' => [
    19|             'traceLevel' => YII_DEBUG ? 3 : 0,
    20|             'targets' => [
    21|                 [
    22|                     'class' => 'yii\log\FileTarget',
    23|                     'levels' => ['error', 'warning'],
    24|                 ],
    25|             ],
    26|         ],
    27|         'errorHandler' => [
    28|             'errorAction' => 'site/error',
    29|         ],
    30|     ],
    31|     'params' => $params,
    32| ];


# ====================================================================
# FILE: apps/advanced/frontend/config/params.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| <?php
     2| return [
     3|     'adminEmail' => 'admin@example.com',
     4| ];


# ====================================================================
# FILE: apps/advanced/frontend/controllers/SiteController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-151 ---
     1| <?php
     2| namespace frontend\controllers;
     3| use Yii;
     4| use common\models\LoginForm;
     5| use frontend\models\PasswordResetRequestForm;
     6| use frontend\models\ResetPasswordForm;
     7| use frontend\models\SignupForm;
     8| use frontend\models\ContactForm;
     9| use yii\base\InvalidParamException;
    10| use yii\web\BadRequestHttpException;
    11| use yii\web\Controller;
    12| use yii\filters\VerbFilter;
    13| use yii\filters\AccessControl;
    14| /**
    15|  * Site controller
    16|  */
    17| class SiteController extends Controller
    18| {
    19|     /**
    20|      * @inheritdoc
    21|      */
    22|     public function behaviors()
    23|     {
    24|         return [
    25|             'access' => [
    26|                 'class' => AccessControl::className(),
    27|                 'only' => ['logout', 'signup'],
    28|                 'rules' => [
    29|                     [
    30|                         'actions' => ['signup'],
    31|                         'allow' => true,
    32|                         'roles' => ['?'],
    33|                     ],
    34|                     [
    35|                         'actions' => ['logout'],
    36|                         'allow' => true,
    37|                         'roles' => ['@'],
    38|                     ],
    39|                 ],
    40|             ],
    41|             'verbs' => [
    42|                 'class' => VerbFilter::className(),
    43|                 'actions' => [
    44|                     'logout' => ['post'],
    45|                 ],
    46|             ],
    47|         ];
    48|     }
    49|     /**
    50|      * @inheritdoc
    51|      */
    52|     public function actions()
    53|     {
    54|         return [
    55|             'error' => [
    56|                 'class' => 'yii\web\ErrorAction',
    57|             ],
    58|             'captcha' => [
    59|                 'class' => 'yii\captcha\CaptchaAction',
    60|                 'fixedVerifyCode' => YII_ENV_TEST ? 'testme' : null,
    61|             ],
    62|         ];
    63|     }
    64|     public function actionIndex()
    65|     {
    66|         return $this->render('index');
    67|     }
    68|     public function actionLogin()
    69|     {
    70|         if (!\Yii::$app->user->isGuest) {
    71|             return $this->goHome();
    72|         }
    73|         $model = new LoginForm();
    74|         if ($model->load(Yii::$app->request->post()) && $model->login()) {
    75|             return $this->goBack();
    76|         } else {
    77|             return $this->render('login', [
    78|                 'model' => $model,
    79|             ]);
    80|         }
    81|     }
    82|     public function actionLogout()
    83|     {
    84|         Yii::$app->user->logout();
    85|         return $this->goHome();
    86|     }
    87|     public function actionContact()
    88|     {
    89|         $model = new ContactForm();
    90|         if ($model->load(Yii::$app->request->post()) && $model->validate()) {
    91|             if ($model->sendEmail(Yii::$app->params['adminEmail'])) {
    92|                 Yii::$app->session->setFlash('success', 'Thank you for contacting us. We will respond to you as soon as possible.');
    93|             } else {
    94|                 Yii::$app->session->setFlash('error', 'There was an error sending email.');
    95|             }
    96|             return $this->refresh();
    97|         } else {
    98|             return $this->render('contact', [
    99|                 'model' => $model,
   100|             ]);
   101|         }
   102|     }
   103|     public function actionAbout()
   104|     {
   105|         return $this->render('about');
   106|     }
   107|     public function actionSignup()
   108|     {
   109|         $model = new SignupForm();
   110|         if ($model->load(Yii::$app->request->post())) {
   111|             if ($user = $model->signup()) {
   112|                 if (Yii::$app->getUser()->login($user)) {
   113|                     return $this->goHome();
   114|                 }
   115|             }
   116|         }
   117|         return $this->render('signup', [
   118|             'model' => $model,
   119|         ]);
   120|     }
   121|     public function actionRequestPasswordReset()
   122|     {
   123|         $model = new PasswordResetRequestForm();
   124|         if ($model->load(Yii::$app->request->post()) && $model->validate()) {
   125|             if ($model->sendEmail()) {
   126|                 Yii::$app->getSession()->setFlash('success', 'Check your email for further instructions.');
   127|                 return $this->goHome();
   128|             } else {
   129|                 Yii::$app->getSession()->setFlash('error', 'Sorry, we are unable to reset password for email provided.');
   130|             }
   131|         }
   132|         return $this->render('requestPasswordResetToken', [
   133|             'model' => $model,
   134|         ]);
   135|     }
   136|     public function actionResetPassword($token)
   137|     {
   138|         try {
   139|             $model = new ResetPasswordForm($token);
   140|         } catch (InvalidParamException $e) {
   141|             throw new BadRequestHttpException($e->getMessage());
   142|         }
   143|         if ($model->load(Yii::$app->request->post()) && $model->validate() && $model->resetPassword()) {
   144|             Yii::$app->getSession()->setFlash('success', 'New password was saved.');
   145|             return $this->goHome();
   146|         }
   147|         return $this->render('resetPassword', [
   148|             'model' => $model,
   149|         ]);
   150|     }
   151| }


# ====================================================================
# FILE: apps/advanced/frontend/models/ContactForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-50 ---
     1| <?php
     2| namespace frontend\models;
     3| use Yii;
     4| use yii\base\Model;
     5| /**
     6|  * ContactForm is the model behind the contact form.
     7|  */
     8| class ContactForm extends Model
     9| {
    10|     public $name;
    11|     public $email;
    12|     public $subject;
    13|     public $body;
    14|     public $verifyCode;
    15|     /**
    16|      * @inheritdoc
    17|      */
    18|     public function rules()
    19|     {
    20|         return [
    21|             [['name', 'email', 'subject', 'body'], 'required'],
    22|             ['email', 'email'],
    23|             ['verifyCode', 'captcha'],
    24|         ];
    25|     }
    26|     /**
    27|      * @inheritdoc
    28|      */
    29|     public function attributeLabels()
    30|     {
    31|         return [
    32|             'verifyCode' => 'Verification Code',
    33|         ];
    34|     }
    35|     /**
    36|      * Sends an email to the specified email address using the information collected by this model.
    37|      *
    38|      * @param  string  $email the target email address
    39|      * @return boolean whether the email was sent
    40|      */
    41|     public function sendEmail($email)
    42|     {
    43|         return Yii::$app->mailer->compose()
    44|             ->setTo($email)
    45|             ->setFrom([$this->email => $this->name])
    46|             ->setSubject($this->subject)
    47|             ->setTextBody($this->body)
    48|             ->send();
    49|     }
    50| }


# ====================================================================
# FILE: apps/advanced/frontend/models/PasswordResetRequestForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-53 ---
     1| <?php
     2| namespace frontend\models;
     3| use common\models\User;
     4| use yii\base\Model;
     5| /**
     6|  * Password reset request form
     7|  */
     8| class PasswordResetRequestForm extends Model
     9| {
    10|     public $email;
    11|     /**
    12|      * @inheritdoc
    13|      */
    14|     public function rules()
    15|     {
    16|         return [
    17|             ['email', 'filter', 'filter' => 'trim'],
    18|             ['email', 'required'],
    19|             ['email', 'email'],
    20|             ['email', 'exist',
    21|                 'targetClass' => '\common\models\User',
    22|                 'filter' => ['status' => User::STATUS_ACTIVE],
    23|                 'message' => 'There is no user with such email.'
    24|             ],
    25|         ];
    26|     }
    27|     /**
    28|      * Sends an email with a link, for resetting the password.
    29|      *
    30|      * @return boolean whether the email was send
    31|      */
    32|     public function sendEmail()
    33|     {
    34|         /* @var $user User */
    35|         $user = User::findOne([
    36|             'status' => User::STATUS_ACTIVE,
    37|             'email' => $this->email,
    38|         ]);
    39|         if ($user) {
    40|             if (!User::isPasswordResetTokenValid($user->password_reset_token)) {
    41|                 $user->generatePasswordResetToken();
    42|             }
    43|             if ($user->save()) {
    44|                 return \Yii::$app->mailer->compose(['html' => 'passwordResetToken-html', 'text' => 'passwordResetToken-text'], ['user' => $user])
    45|                     ->setFrom([\Yii::$app->params['supportEmail'] => \Yii::$app->name . ' robot'])
    46|                     ->setTo($this->email)
    47|                     ->setSubject('Password reset for ' . \Yii::$app->name)
    48|                     ->send();
    49|             }
    50|         }
    51|         return false;
    52|     }
    53| }


# ====================================================================
# FILE: apps/advanced/frontend/models/ResetPasswordForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-57 ---
     1| <?php
     2| namespace frontend\models;
     3| use common\models\User;
     4| use yii\base\InvalidParamException;
     5| use yii\base\Model;
     6| use Yii;
     7| /**
     8|  * Password reset form
     9|  */
    10| class ResetPasswordForm extends Model
    11| {
    12|     public $password;
    13|     /**
    14|      * @var \common\models\User
    15|      */
    16|     private $_user;
    17|     /**
    18|      * Creates a form model given a token.
    19|      *
    20|      * @param  string                          $token
    21|      * @param  array                           $config name-value pairs that will be used to initialize the object properties
    22|      * @throws \yii\base\InvalidParamException if token is empty or not valid
    23|      */
    24|     public function __construct($token, $config = [])
    25|     {
    26|         if (empty($token) || !is_string($token)) {
    27|             throw new InvalidParamException('Password reset token cannot be blank.');
    28|         }
    29|         $this->_user = User::findByPasswordResetToken($token);
    30|         if (!$this->_user) {
    31|             throw new InvalidParamException('Wrong password reset token.');
    32|         }
    33|         parent::__construct($config);
    34|     }
    35|     /**
    36|      * @inheritdoc
    37|      */
    38|     public function rules()
    39|     {
    40|         return [
    41|             ['password', 'required'],
    42|             ['password', 'string', 'min' => 6],
    43|         ];
    44|     }
    45|     /**
    46|      * Resets password.
    47|      *
    48|      * @return boolean if password was reset.
    49|      */
    50|     public function resetPassword()
    51|     {
    52|         $user = $this->_user;
    53|         $user->setPassword($this->password);
    54|         $user->removePasswordResetToken();
    55|         return $user->save();
    56|     }
    57| }


# ====================================================================
# FILE: apps/advanced/frontend/models/SignupForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-51 ---
     1| <?php
     2| namespace frontend\models;
     3| use common\models\User;
     4| use yii\base\Model;
     5| use Yii;
     6| /**
     7|  * Signup form
     8|  */
     9| class SignupForm extends Model
    10| {
    11|     public $username;
    12|     public $email;
    13|     public $password;
    14|     /**
    15|      * @inheritdoc
    16|      */
    17|     public function rules()
    18|     {
    19|         return [
    20|             ['username', 'filter', 'filter' => 'trim'],
    21|             ['username', 'required'],
    22|             ['username', 'unique', 'targetClass' => '\common\models\User', 'message' => 'This username has already been taken.'],
    23|             ['username', 'string', 'min' => 2, 'max' => 255],
    24|             ['email', 'filter', 'filter' => 'trim'],
    25|             ['email', 'required'],
    26|             ['email', 'email'],
    27|             ['email', 'unique', 'targetClass' => '\common\models\User', 'message' => 'This email address has already been taken.'],
    28|             ['password', 'required'],
    29|             ['password', 'string', 'min' => 6],
    30|         ];
    31|     }
    32|     /**
    33|      * Signs user up.
    34|      *
    35|      * @return User|null the saved model or null if saving fails
    36|      */
    37|     public function signup()
    38|     {
    39|         if ($this->validate()) {
    40|             $user = new User();
    41|             $user->username = $this->username;
    42|             $user->email = $this->email;
    43|             $user->setPassword($this->password);
    44|             $user->generateAuthKey();
    45|             if ($user->save()) {
    46|                 return $user;
    47|             }
    48|         }
    49|         return null;
    50|     }
    51| }


# ====================================================================
# FILE: apps/advanced/frontend/views/layouts/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-71 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\Nav;
     4| use yii\bootstrap\NavBar;
     5| use yii\widgets\Breadcrumbs;
     6| use frontend\assets\AppAsset;
     7| use frontend\widgets\Alert;
     8| /* @var $this \yii\web\View */
     9| /* @var $content string */
    10| AppAsset::register($this);
    11| ?>
    12| <?php $this->beginPage() ?>
    13| <!DOCTYPE html>
    14| <html lang="<?= Yii::$app->language ?>">
    15| <head>
    16|     <meta charset="<?= Yii::$app->charset ?>">
    17|     <meta name="viewport" content="width=device-width, initial-scale=1">
    18|     <?= Html::csrfMetaTags() ?>
    19|     <title><?= Html::encode($this->title) ?></title>
    20|     <?php $this->head() ?>
    21| </head>
    22| <body>
    23|     <?php $this->beginBody() ?>
    24|     <div class="wrap">
    25|         <?php
    26|             NavBar::begin([
    27|                 'brandLabel' => 'My Company',
    28|                 'brandUrl' => Yii::$app->homeUrl,
    29|                 'options' => [
    30|                     'class' => 'navbar-inverse navbar-fixed-top',
    31|                 ],
    32|             ]);
    33|             $menuItems = [
    34|                 ['label' => 'Home', 'url' => ['/site/index']],
    35|                 ['label' => 'About', 'url' => ['/site/about']],
    36|                 ['label' => 'Contact', 'url' => ['/site/contact']],
    37|             ];
    38|             if (Yii::$app->user->isGuest) {
    39|                 $menuItems[] = ['label' => 'Signup', 'url' => ['/site/signup']];
    40|                 $menuItems[] = ['label' => 'Login', 'url' => ['/site/login']];
    41|             } else {
    42|                 $menuItems[] = [
    43|                     'label' => 'Logout (' . Yii::$app->user->identity->username . ')',
    44|                     'url' => ['/site/logout'],
    45|                     'linkOptions' => ['data-method' => 'post']
    46|                 ];
    47|             }
    48|             echo Nav::widget([
    49|                 'options' => ['class' => 'navbar-nav navbar-right'],
    50|                 'items' => $menuItems,
    51|             ]);
    52|             NavBar::end();
    53|         ?>
    54|         <div class="container">
    55|         <?= Breadcrumbs::widget([
    56|             'links' => isset($this->params['breadcrumbs']) ? $this->params['breadcrumbs'] : [],
    57|         ]) ?>
    58|         <?= Alert::widget() ?>
    59|         <?= $content ?>
    60|         </div>
    61|     </div>
    62|     <footer class="footer">
    63|         <div class="container">
    64|         <p class="pull-left">&copy; My Company <?= date('Y') ?></p>
    65|         <p class="pull-right"><?= Yii::powered() ?></p>
    66|         </div>
    67|     </footer>
    68|     <?php $this->endBody() ?>
    69| </body>
    70| </html>
    71| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/about.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| $this->title = 'About';
     5| $this->params['breadcrumbs'][] = $this->title;
     6| ?>
     7| <div class="site-about">
     8|     <h1><?= Html::encode($this->title) ?></h1>
     9|     <p>This is the About page. You may modify the following file to customize its content:</p>
    10|     <code><?= __FILE__ ?></code>
    11| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/contact.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| use yii\captcha\Captcha;
     5| /* @var $this yii\web\View */
     6| /* @var $form yii\bootstrap\ActiveForm */
     7| /* @var $model \frontend\models\ContactForm */
     8| $this->title = 'Contact';
     9| $this->params['breadcrumbs'][] = $this->title;
    10| ?>
    11| <div class="site-contact">
    12|     <h1><?= Html::encode($this->title) ?></h1>
    13|     <p>
    14|         If you have business inquiries or other questions, please fill out the following form to contact us. Thank you.
    15|     </p>
    16|     <div class="row">
    17|         <div class="col-lg-5">
    18|             <?php $form = ActiveForm::begin(['id' => 'contact-form']); ?>
    19|                 <?= $form->field($model, 'name') ?>
    20|                 <?= $form->field($model, 'email') ?>
    21|                 <?= $form->field($model, 'subject') ?>
    22|                 <?= $form->field($model, 'body')->textArea(['rows' => 6]) ?>
    23|                 <?= $form->field($model, 'verifyCode')->widget(Captcha::className(), [
    24|                     'template' => '<div class="row"><div class="col-lg-3">{image}</div><div class="col-lg-6">{input}</div></div>',
    25|                 ]) ?>
    26|                 <div class="form-group">
    27|                     <?= Html::submitButton('Submit', ['class' => 'btn btn-primary', 'name' => 'contact-button']) ?>
    28|                 </div>
    29|             <?php ActiveForm::end(); ?>
    30|         </div>
    31|     </div>
    32| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/error.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-20 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| /* @var $name string */
     5| /* @var $message string */
     6| /* @var $exception Exception */
     7| $this->title = $name;
     8| ?>
     9| <div class="site-error">
    10|     <h1><?= Html::encode($this->title) ?></h1>
    11|     <div class="alert alert-danger">
    12|         <?= nl2br(Html::encode($message)) ?>
    13|     </div>
    14|     <p>
    15|         The above error occurred while the Web server was processing your request.
    16|     </p>
    17|     <p>
    18|         Please contact us if you think this is a server error. Thank you.
    19|     </p>
    20| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-39 ---
     1| <?php
     2| /* @var $this yii\web\View */
     3| $this->title = 'My Yii Application';
     4| ?>
     5| <div class="site-index">
     6|     <div class="jumbotron">
     7|         <h1>Congratulations!</h1>
     8|         <p class="lead">You have successfully created your Yii-powered application.</p>
     9|         <p><a class="btn btn-lg btn-success" href="http://www.yiiframework.com">Get started with Yii</a></p>
    10|     </div>
    11|     <div class="body-content">
    12|         <div class="row">
    13|             <div class="col-lg-4">
    14|                 <h2>Heading</h2>
    15|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    16|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    17|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    18|                     fugiat nulla pariatur.</p>
    19|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/doc/">Yii Documentation &raquo;</a></p>
    20|             </div>
    21|             <div class="col-lg-4">
    22|                 <h2>Heading</h2>
    23|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    24|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    25|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    26|                     fugiat nulla pariatur.</p>
    27|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/forum/">Yii Forum &raquo;</a></p>
    28|             </div>
    29|             <div class="col-lg-4">
    30|                 <h2>Heading</h2>
    31|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    32|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    33|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    34|                     fugiat nulla pariatur.</p>
    35|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/extensions/">Yii Extensions &raquo;</a></p>
    36|             </div>
    37|         </div>
    38|     </div>
    39| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/login.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model \common\models\LoginForm */
     7| $this->title = 'Login';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-login">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please fill out the following fields to login:</p>
    13|     <div class="row">
    14|         <div class="col-lg-5">
    15|             <?php $form = ActiveForm::begin(['id' => 'login-form']); ?>
    16|                 <?= $form->field($model, 'username') ?>
    17|                 <?= $form->field($model, 'password')->passwordInput() ?>
    18|                 <?= $form->field($model, 'rememberMe')->checkbox() ?>
    19|                 <div style="color:#999;margin:1em 0">
    20|                     If you forgot your password you can <?= Html::a('reset it', ['site/request-password-reset']) ?>.
    21|                 </div>
    22|                 <div class="form-group">
    23|                     <?= Html::submitButton('Login', ['class' => 'btn btn-primary', 'name' => 'login-button']) ?>
    24|                 </div>
    25|             <?php ActiveForm::end(); ?>
    26|         </div>
    27|     </div>
    28| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/requestPasswordResetToken.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model \frontend\models\PasswordResetRequestForm */
     7| $this->title = 'Request password reset';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-request-password-reset">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please fill out your email. A link to reset password will be sent there.</p>
    13|     <div class="row">
    14|         <div class="col-lg-5">
    15|             <?php $form = ActiveForm::begin(['id' => 'request-password-reset-form']); ?>
    16|                 <?= $form->field($model, 'email') ?>
    17|                 <div class="form-group">
    18|                     <?= Html::submitButton('Send', ['class' => 'btn btn-primary']) ?>
    19|                 </div>
    20|             <?php ActiveForm::end(); ?>
    21|         </div>
    22|     </div>
    23| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/resetPassword.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model \frontend\models\ResetPasswordForm */
     7| $this->title = 'Reset password';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-reset-password">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please choose your new password:</p>
    13|     <div class="row">
    14|         <div class="col-lg-5">
    15|             <?php $form = ActiveForm::begin(['id' => 'reset-password-form']); ?>
    16|                 <?= $form->field($model, 'password')->passwordInput() ?>
    17|                 <div class="form-group">
    18|                     <?= Html::submitButton('Save', ['class' => 'btn btn-primary']) ?>
    19|                 </div>
    20|             <?php ActiveForm::end(); ?>
    21|         </div>
    22|     </div>
    23| </div>


# ====================================================================
# FILE: apps/advanced/frontend/views/site/signup.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model \frontend\models\SignupForm */
     7| $this->title = 'Signup';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-signup">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please fill out the following fields to signup:</p>
    13|     <div class="row">
    14|         <div class="col-lg-5">
    15|             <?php $form = ActiveForm::begin(['id' => 'form-signup']); ?>
    16|                 <?= $form->field($model, 'username') ?>
    17|                 <?= $form->field($model, 'email') ?>
    18|                 <?= $form->field($model, 'password')->passwordInput() ?>
    19|                 <div class="form-group">
    20|                     <?= Html::submitButton('Signup', ['class' => 'btn btn-primary', 'name' => 'signup-button']) ?>
    21|                 </div>
    22|             <?php ActiveForm::end(); ?>
    23|         </div>
    24|     </div>
    25| </div>


# ====================================================================
# FILE: apps/advanced/frontend/widgets/Alert.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-70 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace frontend\widgets;
     8| /**
     9|  * Alert widget renders a message from session flash. All flash messages are displayed
    10|  * in the sequence they were assigned using setFlash. You can set message as following:
    11|  *
    12|  * ```php
    13|  * \Yii::$app->getSession()->setFlash('error', 'This is the message');
    14|  * \Yii::$app->getSession()->setFlash('success', 'This is the message');
    15|  * \Yii::$app->getSession()->setFlash('info', 'This is the message');
    16|  * ```
    17|  *
    18|  * Multiple messages could be set as follows:
    19|  *
    20|  * ```php
    21|  * \Yii::$app->getSession()->setFlash('error', ['Error 1', 'Error 2']);
    22|  * ```
    23|  *
    24|  * @author Kartik Visweswaran <kartikv2@gmail.com>
    25|  * @author Alexander Makarov <sam@rmcreative.ru>
    26|  */
    27| class Alert extends \yii\bootstrap\Widget
    28| {
    29|     /**
    30|      * @var array the alert types configuration for the flash messages.
    31|      * This array is setup as $key => $value, where:
    32|      * - $key is the name of the session flash variable
    33|      * - $value is the bootstrap alert type (i.e. danger, success, info, warning)
    34|      */
    35|     public $alertTypes = [
    36|         'error'   => 'alert-danger',
    37|         'danger'  => 'alert-danger',
    38|         'success' => 'alert-success',
    39|         'info'    => 'alert-info',
    40|         'warning' => 'alert-warning'
    41|     ];
    42|     /**
    43|      * @var array the options for rendering the close button tag.
    44|      */
    45|     public $closeButton = [];
    46|     public function init()
    47|     {
    48|         parent::init();
    49|         $session = \Yii::$app->getSession();
    50|         $flashes = $session->getAllFlashes();
    51|         $appendCss = isset($this->options['class']) ? ' ' . $this->options['class'] : '';
    52|         foreach ($flashes as $type => $data) {
    53|             if (isset($this->alertTypes[$type])) {
    54|                 $data = (array) $data;
    55|                 foreach ($data as $i => $message) {
    56|                     /* initialize css class for each alert box */
    57|                     $this->options['class'] = $this->alertTypes[$type] . $appendCss;
    58|                     /* assign unique id to each alert box */
    59|                     $this->options['id'] = $this->getId() . '-' . $type . '-' . $i;
    60|                     echo \yii\bootstrap\Alert::widget([
    61|                         'body' => $message,
    62|                         'closeButton' => $this->closeButton,
    63|                         'options' => $this->options,
    64|                     ]);
    65|                 }
    66|                 $session->removeFlash($type);
    67|             }
    68|         }
    69|     }
    70| }


# ====================================================================
# FILE: apps/advanced/requirements.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-120 ---
     1| <?php
     2| /**
     3|  * Application requirement checker script.
     4|  *
     5|  * In order to run this script use the following console command:
     6|  * php requirements.php
     7|  *
     8|  * In order to run this script from the web, you should copy it to the web root.
     9|  * If you are using Linux you can create a hard link instead, using the following command:
    10|  * ln requirements.php ../requirements.php
    11|  */
    12| $frameworkPath = dirname(__FILE__) . '/vendor/yiisoft/yii2';
    13| if (!is_dir($frameworkPath)) {
    14|     echo '<h1>Error</h1>';
    15|     echo '<p><strong>The path to yii framework seems to be incorrect.</strong></p>';
    16|     echo '<p>You need to install Yii framework via composer or adjust the framework path in file <abbr title="' . __FILE__ . '">' . basename(__FILE__) . '</abbr>.</p>';
    17|     echo '<p>Please refer to the <abbr title="' . dirname(__FILE__) . '/README.md">README</abbr> on how to install Yii.</p>';
    18| }
    19| require_once($frameworkPath . '/requirements/YiiRequirementChecker.php');
    20| $requirementsChecker = new YiiRequirementChecker();
    21| $gdMemo = $imagickMemo = 'Either GD PHP extension with FreeType support or ImageMagick PHP extension with PNG support is required for image CAPTCHA.';
    22| $gdOK = $imagickOK = false;
    23| if (extension_loaded('imagick')) {
    24|     $imagick = new Imagick();
    25|     $imagickFormats = $imagick->queryFormats('PNG');
    26|     if (in_array('PNG', $imagickFormats)) {
    27|         $imagickOK = true;
    28|     } else {
    29|         $imagickMemo = 'Imagick extension should be installed with PNG support in order to be used for image CAPTCHA.';
    30|     }
    31| }
    32| if (extension_loaded('gd')) {
    33|     $gdInfo = gd_info();
    34|     if (!empty($gdInfo['FreeType Support'])) {
    35|         $gdOK = true;
    36|     } else {
    37|         $gdMemo = 'GD extension should be installed with FreeType support in order to be used for image CAPTCHA.';
    38|     }
    39| }
    40| /**
    41|  * Adjust requirements according to your application specifics.
    42|  */
    43| $requirements = array(
    44|     array(
    45|         'name' => 'PDO extension',
    46|         'mandatory' => true,
    47|         'condition' => extension_loaded('pdo'),
    48|         'by' => 'All DB-related classes',
    49|     ),
    50|     array(
    51|         'name' => 'PDO SQLite extension',
    52|         'mandatory' => false,
    53|         'condition' => extension_loaded('pdo_sqlite'),
    54|         'by' => 'All DB-related classes',
    55|         'memo' => 'Required for SQLite database.',
    56|     ),
    57|     array(
    58|         'name' => 'PDO MySQL extension',
    59|         'mandatory' => false,
    60|         'condition' => extension_loaded('pdo_mysql'),
    61|         'by' => 'All DB-related classes',
    62|         'memo' => 'Required for MySQL database.',
    63|     ),
    64|     array(
    65|         'name' => 'PDO PostgreSQL extension',
    66|         'mandatory' => false,
    67|         'condition' => extension_loaded('pdo_pgsql'),
    68|         'by' => 'All DB-related classes',
    69|         'memo' => 'Required for PostgreSQL database.',
    70|     ),
    71|     array(
    72|         'name' => 'Memcache extension',
    73|         'mandatory' => false,
    74|         'condition' => extension_loaded('memcache') || extension_loaded('memcached'),
    75|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-caching-memcache.html">MemCache</a>',
    76|         'memo' => extension_loaded('memcached') ? 'To use memcached set <a href="http://www.yiiframework.com/doc-2.0/yii-caching-memcache.html#$useMemcached-detail">MemCache::useMemcached</a> to <code>true</code>.' : ''
    77|     ),
    78|     array(
    79|         'name' => 'APC extension',
    80|         'mandatory' => false,
    81|         'condition' => extension_loaded('apc'),
    82|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-caching-apccache.html">ApcCache</a>',
    83|     ),
    84|     array(
    85|         'name' => 'GD PHP extension with FreeType support',
    86|         'mandatory' => false,
    87|         'condition' => $gdOK,
    88|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-captcha-captcha.html">Captcha</a>',
    89|         'memo' => $gdMemo,
    90|     ),
    91|     array(
    92|         'name' => 'ImageMagick PHP extension with PNG support',
    93|         'mandatory' => false,
    94|         'condition' => $imagickOK,
    95|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-captcha-captcha.html">Captcha</a>',
    96|         'memo' => $imagickMemo,
    97|     ),
    98|     'phpExposePhp' => array(
    99|         'name' => 'Expose PHP',
   100|         'mandatory' => false,
   101|         'condition' => $requirementsChecker->checkPhpIniOff("expose_php"),
   102|         'by' => 'Security reasons',
   103|         'memo' => '"expose_php" should be disabled at php.ini',
   104|     ),
   105|     'phpAllowUrlInclude' => array(
   106|         'name' => 'PHP allow url include',
   107|         'mandatory' => false,
   108|         'condition' => $requirementsChecker->checkPhpIniOff("allow_url_include"),
   109|         'by' => 'Security reasons',
   110|         'memo' => '"allow_url_include" should be disabled at php.ini',
   111|     ),
   112|     'phpSmtp' => array(
   113|         'name' => 'PHP mail SMTP',
   114|         'mandatory' => false,
   115|         'condition' => strlen(ini_get('SMTP')) > 0,
   116|         'by' => 'Email sending',
   117|         'memo' => 'PHP mail SMTP server required',
   118|     ),
   119| );
   120| $requirementsChecker->checkYii()->check($requirements)->render();


# ====================================================================
# FILE: apps/basic/assets/AppAsset.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace app\assets;
     8| use yii\web\AssetBundle;
     9| /**
    10|  * @author Qiang Xue <qiang.xue@gmail.com>
    11|  * @since 2.0
    12|  */
    13| class AppAsset extends AssetBundle
    14| {
    15|     public $basePath = '@webroot';
    16|     public $baseUrl = '@web';
    17|     public $css = [
    18|         'css/site.css',
    19|     ];
    20|     public $js = [
    21|     ];
    22|     public $depends = [
    23|         'yii\web\YiiAsset',
    24|         'yii\bootstrap\BootstrapAsset',
    25|     ];
    26| }


# ====================================================================
# FILE: apps/basic/commands/HelloController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-27 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace app\commands;
     8| use yii\console\Controller;
     9| /**
    10|  * This command echoes the first argument that you have entered.
    11|  *
    12|  * This command is provided as an example for you to learn how to create console commands.
    13|  *
    14|  * @author Qiang Xue <qiang.xue@gmail.com>
    15|  * @since 2.0
    16|  */
    17| class HelloController extends Controller
    18| {
    19|     /**
    20|      * This command echoes what you have entered as the message.
    21|      * @param string $message the message to be echoed.
    22|      */
    23|     public function actionIndex($message = 'hello world')
    24|     {
    25|         echo $message . "\n";
    26|     }
    27| }


# ====================================================================
# FILE: apps/basic/config/console.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| <?php
     2| Yii::setAlias('@tests', dirname(__DIR__) . '/tests');
     3| $params = require(__DIR__ . '/params.php');
     4| $db = require(__DIR__ . '/db.php');
     5| return [
     6|     'id' => 'basic-console',
     7|     'basePath' => dirname(__DIR__),
     8|     'bootstrap' => ['log', 'gii'],
     9|     'controllerNamespace' => 'app\commands',
    10|     'modules' => [
    11|         'gii' => 'yii\gii\Module',
    12|     ],
    13|     'components' => [
    14|         'cache' => [
    15|             'class' => 'yii\caching\FileCache',
    16|         ],
    17|         'log' => [
    18|             'targets' => [
    19|                 [
    20|                     'class' => 'yii\log\FileTarget',
    21|                     'levels' => ['error', 'warning'],
    22|                 ],
    23|             ],
    24|         ],
    25|         'db' => $db,
    26|     ],
    27|     'params' => $params,
    28| ];


# ====================================================================
# FILE: apps/basic/config/db.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-8 ---
     1| <?php
     2| return [
     3|     'class' => 'yii\db\Connection',
     4|     'dsn' => 'mysql:host=localhost;dbname=yii2basic',
     5|     'username' => 'root',
     6|     'password' => '',
     7|     'charset' => 'utf8',
     8| ];


# ====================================================================
# FILE: apps/basic/config/params.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| <?php
     2| return [
     3|     'adminEmail' => 'admin@example.com',
     4| ];


# ====================================================================
# FILE: apps/basic/config/web.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-44 ---
     1| <?php
     2| $params = require(__DIR__ . '/params.php');
     3| $config = [
     4|     'id' => 'basic',
     5|     'basePath' => dirname(__DIR__),
     6|     'bootstrap' => ['log'],
     7|     'components' => [
     8|         'request' => [
     9|             'cookieValidationKey' => '',
    10|         ],
    11|         'cache' => [
    12|             'class' => 'yii\caching\FileCache',
    13|         ],
    14|         'user' => [
    15|             'identityClass' => 'app\models\User',
    16|             'enableAutoLogin' => true,
    17|         ],
    18|         'errorHandler' => [
    19|             'errorAction' => 'site/error',
    20|         ],
    21|         'mailer' => [
    22|             'class' => 'yii\swiftmailer\Mailer',
    23|             'useFileTransport' => true,
    24|         ],
    25|         'log' => [
    26|             'traceLevel' => YII_DEBUG ? 3 : 0,
    27|             'targets' => [
    28|                 [
    29|                     'class' => 'yii\log\FileTarget',
    30|                     'levels' => ['error', 'warning'],
    31|                 ],
    32|             ],
    33|         ],
    34|         'db' => require(__DIR__ . '/db.php'),
    35|     ],
    36|     'params' => $params,
    37| ];
    38| if (YII_ENV_DEV) {
    39|     $config['bootstrap'][] = 'debug';
    40|     $config['modules']['debug'] = 'yii\debug\Module';
    41|     $config['bootstrap'][] = 'gii';
    42|     $config['modules']['gii'] = 'yii\gii\Module';
    43| }
    44| return $config;


# ====================================================================
# FILE: apps/basic/controllers/SiteController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-84 ---
     1| <?php
     2| namespace app\controllers;
     3| use Yii;
     4| use yii\filters\AccessControl;
     5| use yii\web\Controller;
     6| use yii\filters\VerbFilter;
     7| use app\models\LoginForm;
     8| use app\models\ContactForm;
     9| class SiteController extends Controller
    10| {
    11|     public function behaviors()
    12|     {
    13|         return [
    14|             'access' => [
    15|                 'class' => AccessControl::className(),
    16|                 'only' => ['logout'],
    17|                 'rules' => [
    18|                     [
    19|                         'actions' => ['logout'],
    20|                         'allow' => true,
    21|                         'roles' => ['@'],
    22|                     ],
    23|                 ],
    24|             ],
    25|             'verbs' => [
    26|                 'class' => VerbFilter::className(),
    27|                 'actions' => [
    28|                     'logout' => ['post'],
    29|                 ],
    30|             ],
    31|         ];
    32|     }
    33|     public function actions()
    34|     {
    35|         return [
    36|             'error' => [
    37|                 'class' => 'yii\web\ErrorAction',
    38|             ],
    39|             'captcha' => [
    40|                 'class' => 'yii\captcha\CaptchaAction',
    41|                 'fixedVerifyCode' => YII_ENV_TEST ? 'testme' : null,
    42|             ],
    43|         ];
    44|     }
    45|     public function actionIndex()
    46|     {
    47|         return $this->render('index');
    48|     }
    49|     public function actionLogin()
    50|     {
    51|         if (!\Yii::$app->user->isGuest) {
    52|             return $this->goHome();
    53|         }
    54|         $model = new LoginForm();
    55|         if ($model->load(Yii::$app->request->post()) && $model->login()) {
    56|             return $this->goBack();
    57|         } else {
    58|             return $this->render('login', [
    59|                 'model' => $model,
    60|             ]);
    61|         }
    62|     }
    63|     public function actionLogout()
    64|     {
    65|         Yii::$app->user->logout();
    66|         return $this->goHome();
    67|     }
    68|     public function actionContact()
    69|     {
    70|         $model = new ContactForm();
    71|         if ($model->load(Yii::$app->request->post()) && $model->contact(Yii::$app->params['adminEmail'])) {
    72|             Yii::$app->session->setFlash('contactFormSubmitted');
    73|             return $this->refresh();
    74|         } else {
    75|             return $this->render('contact', [
    76|                 'model' => $model,
    77|             ]);
    78|         }
    79|     }
    80|     public function actionAbout()
    81|     {
    82|         return $this->render('about');
    83|     }
    84| }


# ====================================================================
# FILE: apps/basic/mail/layouts/html.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this \yii\web\View view component instance */
     4| /* @var $message \yii\mail\MessageInterface the message being composed */
     5| /* @var $content string main view render result */
     6| ?>
     7| <?php $this->beginPage() ?>
     8| <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
     9| <html xmlns="http://www.w3.org/1999/xhtml">
    10| <head>
    11|     <meta http-equiv="Content-Type" content="text/html; charset=<?= Yii::$app->charset ?>" />
    12|     <title><?= Html::encode($this->title) ?></title>
    13|     <?php $this->head() ?>
    14| </head>
    15| <body>
    16|     <?php $this->beginBody() ?>
    17|     <?= $content ?>
    18|     <?php $this->endBody() ?>
    19| </body>
    20| </html>
    21| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/basic/models/ContactForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-54 ---
     1| <?php
     2| namespace app\models;
     3| use Yii;
     4| use yii\base\Model;
     5| /**
     6|  * ContactForm is the model behind the contact form.
     7|  */
     8| class ContactForm extends Model
     9| {
    10|     public $name;
    11|     public $email;
    12|     public $subject;
    13|     public $body;
    14|     public $verifyCode;
    15|     /**
    16|      * @return array the validation rules.
    17|      */
    18|     public function rules()
    19|     {
    20|         return [
    21|             [['name', 'email', 'subject', 'body'], 'required'],
    22|             ['email', 'email'],
    23|             ['verifyCode', 'captcha'],
    24|         ];
    25|     }
    26|     /**
    27|      * @return array customized attribute labels
    28|      */
    29|     public function attributeLabels()
    30|     {
    31|         return [
    32|             'verifyCode' => 'Verification Code',
    33|         ];
    34|     }
    35|     /**
    36|      * Sends an email to the specified email address using the information collected by this model.
    37|      * @param  string  $email the target email address
    38|      * @return boolean whether the model passes validation
    39|      */
    40|     public function contact($email)
    41|     {
    42|         if ($this->validate()) {
    43|             Yii::$app->mailer->compose()
    44|                 ->setTo($email)
    45|                 ->setFrom([$this->email => $this->name])
    46|                 ->setSubject($this->subject)
    47|                 ->setTextBody($this->body)
    48|                 ->send();
    49|             return true;
    50|         } else {
    51|             return false;
    52|         }
    53|     }
    54| }


# ====================================================================
# FILE: apps/basic/models/LoginForm.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-65 ---
     1| <?php
     2| namespace app\models;
     3| use Yii;
     4| use yii\base\Model;
     5| /**
     6|  * LoginForm is the model behind the login form.
     7|  */
     8| class LoginForm extends Model
     9| {
    10|     public $username;
    11|     public $password;
    12|     public $rememberMe = true;
    13|     private $_user = false;
    14|     /**
    15|      * @return array the validation rules.
    16|      */
    17|     public function rules()
    18|     {
    19|         return [
    20|             [['username', 'password'], 'required'],
    21|             ['rememberMe', 'boolean'],
    22|             ['password', 'validatePassword'],
    23|         ];
    24|     }
    25|     /**
    26|      * Validates the password.
    27|      * This method serves as the inline validation for password.
    28|      *
    29|      * @param string $attribute the attribute currently being validated
    30|      * @param array $params the additional name-value pairs given in the rule
    31|      */
    32|     public function validatePassword($attribute, $params)
    33|     {
    34|         if (!$this->hasErrors()) {
    35|             $user = $this->getUser();
    36|             if (!$user || !$user->validatePassword($this->password)) {
    37|                 $this->addError($attribute, 'Incorrect username or password.');
    38|             }
    39|         }
    40|     }
    41|     /**
    42|      * Logs in a user using the provided username and password.
    43|      * @return boolean whether the user is logged in successfully
    44|      */
    45|     public function login()
    46|     {
    47|         if ($this->validate()) {
    48|             return Yii::$app->user->login($this->getUser(), $this->rememberMe ? 3600*24*30 : 0);
    49|         } else {
    50|             return false;
    51|         }
    52|     }
    53|     /**
    54|      * Finds user by [[username]]
    55|      *
    56|      * @return User|null
    57|      */
    58|     public function getUser()
    59|     {
    60|         if ($this->_user === false) {
    61|             $this->_user = User::findByUsername($this->username);
    62|         }
    63|         return $this->_user;
    64|     }
    65| }


# ====================================================================
# FILE: apps/basic/models/User.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-91 ---
     1| <?php
     2| namespace app\models;
     3| class User extends \yii\base\Object implements \yii\web\IdentityInterface
     4| {
     5|     public $id;
     6|     public $username;
     7|     public $password;
     8|     public $authKey;
     9|     public $accessToken;
    10|     private static $users = [
    11|         '100' => [
    12|             'id' => '100',
    13|             'username' => 'admin',
    14|             'password' => 'admin',
    15|             'authKey' => 'test100key',
    16|             'accessToken' => '100-token',
    17|         ],
    18|         '101' => [
    19|             'id' => '101',
    20|             'username' => 'demo',
    21|             'password' => 'demo',
    22|             'authKey' => 'test101key',
    23|             'accessToken' => '101-token',
    24|         ],
    25|     ];
    26|     /**
    27|      * @inheritdoc
    28|      */
    29|     public static function findIdentity($id)
    30|     {
    31|         return isset(self::$users[$id]) ? new static(self::$users[$id]) : null;
    32|     }
    33|     /**
    34|      * @inheritdoc
    35|      */
    36|     public static function findIdentityByAccessToken($token, $type = null)
    37|     {
    38|         foreach (self::$users as $user) {
    39|             if ($user['accessToken'] === $token) {
    40|                 return new static($user);
    41|             }
    42|         }
    43|         return null;
    44|     }
    45|     /**
    46|      * Finds user by username
    47|      *
    48|      * @param  string      $username
    49|      * @return static|null
    50|      */
    51|     public static function findByUsername($username)
    52|     {
    53|         foreach (self::$users as $user) {
    54|             if (strcasecmp($user['username'], $username) === 0) {
    55|                 return new static($user);
    56|             }
    57|         }
    58|         return null;
    59|     }
    60|     /**
    61|      * @inheritdoc
    62|      */
    63|     public function getId()
    64|     {
    65|         return $this->id;
    66|     }
    67|     /**
    68|      * @inheritdoc
    69|      */
    70|     public function getAuthKey()
    71|     {
    72|         return $this->authKey;
    73|     }
    74|     /**
    75|      * @inheritdoc
    76|      */
    77|     public function validateAuthKey($authKey)
    78|     {
    79|         return $this->authKey === $authKey;
    80|     }
    81|     /**
    82|      * Validates password
    83|      *
    84|      * @param  string  $password password to validate
    85|      * @return boolean if password provided is valid for current user
    86|      */
    87|     public function validatePassword($password)
    88|     {
    89|         return $this->password === $password;
    90|     }
    91| }


# ====================================================================
# FILE: apps/basic/requirements.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-120 ---
     1| <?php
     2| /**
     3|  * Application requirement checker script.
     4|  *
     5|  * In order to run this script use the following console command:
     6|  * php requirements.php
     7|  *
     8|  * In order to run this script from the web, you should copy it to the web root.
     9|  * If you are using Linux you can create a hard link instead, using the following command:
    10|  * ln requirements.php ../requirements.php
    11|  */
    12| $frameworkPath = dirname(__FILE__) . '/vendor/yiisoft/yii2';
    13| if (!is_dir($frameworkPath)) {
    14|     echo '<h1>Error</h1>';
    15|     echo '<p><strong>The path to yii framework seems to be incorrect.</strong></p>';
    16|     echo '<p>You need to install Yii framework via composer or adjust the framework path in file <abbr title="' . __FILE__ . '">' . basename(__FILE__) . '</abbr>.</p>';
    17|     echo '<p>Please refer to the <abbr title="' . dirname(__FILE__) . '/README.md">README</abbr> on how to install Yii.</p>';
    18| }
    19| require_once($frameworkPath . '/requirements/YiiRequirementChecker.php');
    20| $requirementsChecker = new YiiRequirementChecker();
    21| $gdMemo = $imagickMemo = 'Either GD PHP extension with FreeType support or ImageMagick PHP extension with PNG support is required for image CAPTCHA.';
    22| $gdOK = $imagickOK = false;
    23| if (extension_loaded('imagick')) {
    24|     $imagick = new Imagick();
    25|     $imagickFormats = $imagick->queryFormats('PNG');
    26|     if (in_array('PNG', $imagickFormats)) {
    27|         $imagickOK = true;
    28|     } else {
    29|         $imagickMemo = 'Imagick extension should be installed with PNG support in order to be used for image CAPTCHA.';
    30|     }
    31| }
    32| if (extension_loaded('gd')) {
    33|     $gdInfo = gd_info();
    34|     if (!empty($gdInfo['FreeType Support'])) {
    35|         $gdOK = true;
    36|     } else {
    37|         $gdMemo = 'GD extension should be installed with FreeType support in order to be used for image CAPTCHA.';
    38|     }
    39| }
    40| /**
    41|  * Adjust requirements according to your application specifics.
    42|  */
    43| $requirements = array(
    44|     array(
    45|         'name' => 'PDO extension',
    46|         'mandatory' => true,
    47|         'condition' => extension_loaded('pdo'),
    48|         'by' => 'All DB-related classes',
    49|     ),
    50|     array(
    51|         'name' => 'PDO SQLite extension',
    52|         'mandatory' => false,
    53|         'condition' => extension_loaded('pdo_sqlite'),
    54|         'by' => 'All DB-related classes',
    55|         'memo' => 'Required for SQLite database.',
    56|     ),
    57|     array(
    58|         'name' => 'PDO MySQL extension',
    59|         'mandatory' => false,
    60|         'condition' => extension_loaded('pdo_mysql'),
    61|         'by' => 'All DB-related classes',
    62|         'memo' => 'Required for MySQL database.',
    63|     ),
    64|     array(
    65|         'name' => 'PDO PostgreSQL extension',
    66|         'mandatory' => false,
    67|         'condition' => extension_loaded('pdo_pgsql'),
    68|         'by' => 'All DB-related classes',
    69|         'memo' => 'Required for PostgreSQL database.',
    70|     ),
    71|     array(
    72|         'name' => 'Memcache extension',
    73|         'mandatory' => false,
    74|         'condition' => extension_loaded('memcache') || extension_loaded('memcached'),
    75|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-caching-memcache.html">MemCache</a>',
    76|         'memo' => extension_loaded('memcached') ? 'To use memcached set <a href="http://www.yiiframework.com/doc-2.0/yii-caching-memcache.html#$useMemcached-detail">MemCache::useMemcached</a> to <code>true</code>.' : ''
    77|     ),
    78|     array(
    79|         'name' => 'APC extension',
    80|         'mandatory' => false,
    81|         'condition' => extension_loaded('apc'),
    82|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-caching-apccache.html">ApcCache</a>',
    83|     ),
    84|     array(
    85|         'name' => 'GD PHP extension with FreeType support',
    86|         'mandatory' => false,
    87|         'condition' => $gdOK,
    88|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-captcha-captcha.html">Captcha</a>',
    89|         'memo' => $gdMemo,
    90|     ),
    91|     array(
    92|         'name' => 'ImageMagick PHP extension with PNG support',
    93|         'mandatory' => false,
    94|         'condition' => $imagickOK,
    95|         'by' => '<a href="http://www.yiiframework.com/doc-2.0/yii-captcha-captcha.html">Captcha</a>',
    96|         'memo' => $imagickMemo,
    97|     ),
    98|     'phpExposePhp' => array(
    99|         'name' => 'Expose PHP',
   100|         'mandatory' => false,
   101|         'condition' => $requirementsChecker->checkPhpIniOff("expose_php"),
   102|         'by' => 'Security reasons',
   103|         'memo' => '"expose_php" should be disabled at php.ini',
   104|     ),
   105|     'phpAllowUrlInclude' => array(
   106|         'name' => 'PHP allow url include',
   107|         'mandatory' => false,
   108|         'condition' => $requirementsChecker->checkPhpIniOff("allow_url_include"),
   109|         'by' => 'Security reasons',
   110|         'memo' => '"allow_url_include" should be disabled at php.ini',
   111|     ),
   112|     'phpSmtp' => array(
   113|         'name' => 'PHP mail SMTP',
   114|         'mandatory' => false,
   115|         'condition' => strlen(ini_get('SMTP'))>0,
   116|         'by' => 'Email sending',
   117|         'memo' => 'PHP mail SMTP server required',
   118|     ),
   119| );
   120| $requirementsChecker->checkYii()->check($requirements)->render();


# ====================================================================
# FILE: apps/basic/views/layouts/main.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-63 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\Nav;
     4| use yii\bootstrap\NavBar;
     5| use yii\widgets\Breadcrumbs;
     6| use app\assets\AppAsset;
     7| /* @var $this \yii\web\View */
     8| /* @var $content string */
     9| AppAsset::register($this);
    10| ?>
    11| <?php $this->beginPage() ?>
    12| <!DOCTYPE html>
    13| <html lang="<?= Yii::$app->language ?>">
    14| <head>
    15|     <meta charset="<?= Yii::$app->charset ?>">
    16|     <meta name="viewport" content="width=device-width, initial-scale=1">
    17|     <?= Html::csrfMetaTags() ?>
    18|     <title><?= Html::encode($this->title) ?></title>
    19|     <?php $this->head() ?>
    20| </head>
    21| <body>
    22| <?php $this->beginBody() ?>
    23|     <div class="wrap">
    24|         <?php
    25|             NavBar::begin([
    26|                 'brandLabel' => 'My Company',
    27|                 'brandUrl' => Yii::$app->homeUrl,
    28|                 'options' => [
    29|                     'class' => 'navbar-inverse navbar-fixed-top',
    30|                 ],
    31|             ]);
    32|             echo Nav::widget([
    33|                 'options' => ['class' => 'navbar-nav navbar-right'],
    34|                 'items' => [
    35|                     ['label' => 'Home', 'url' => ['/site/index']],
    36|                     ['label' => 'About', 'url' => ['/site/about']],
    37|                     ['label' => 'Contact', 'url' => ['/site/contact']],
    38|                     Yii::$app->user->isGuest ?
    39|                         ['label' => 'Login', 'url' => ['/site/login']] :
    40|                         ['label' => 'Logout (' . Yii::$app->user->identity->username . ')',
    41|                             'url' => ['/site/logout'],
    42|                             'linkOptions' => ['data-method' => 'post']],
    43|                 ],
    44|             ]);
    45|             NavBar::end();
    46|         ?>
    47|         <div class="container">
    48|             <?= Breadcrumbs::widget([
    49|                 'links' => isset($this->params['breadcrumbs']) ? $this->params['breadcrumbs'] : [],
    50|             ]) ?>
    51|             <?= $content ?>
    52|         </div>
    53|     </div>
    54|     <footer class="footer">
    55|         <div class="container">
    56|             <p class="pull-left">&copy; My Company <?= date('Y') ?></p>
    57|             <p class="pull-right"><?= Yii::powered() ?></p>
    58|         </div>
    59|     </footer>
    60| <?php $this->endBody() ?>
    61| </body>
    62| </html>
    63| <?php $this->endPage() ?>


# ====================================================================
# FILE: apps/basic/views/site/about.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-13 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| $this->title = 'About';
     5| $this->params['breadcrumbs'][] = $this->title;
     6| ?>
     7| <div class="site-about">
     8|     <h1><?= Html::encode($this->title) ?></h1>
     9|     <p>
    10|         This is the About page. You may modify the following file to customize its content:
    11|     </p>
    12|     <code><?= __FILE__ ?></code>
    13| </div>


# ====================================================================
# FILE: apps/basic/views/site/contact.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-48 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| use yii\captcha\Captcha;
     5| /* @var $this yii\web\View */
     6| /* @var $form yii\bootstrap\ActiveForm */
     7| /* @var $model app\models\ContactForm */
     8| $this->title = 'Contact';
     9| $this->params['breadcrumbs'][] = $this->title;
    10| ?>
    11| <div class="site-contact">
    12|     <h1><?= Html::encode($this->title) ?></h1>
    13|     <?php if (Yii::$app->session->hasFlash('contactFormSubmitted')): ?>
    14|     <div class="alert alert-success">
    15|         Thank you for contacting us. We will respond to you as soon as possible.
    16|     </div>
    17|     <p>
    18|         Note that if you turn on the Yii debugger, you should be able
    19|         to view the mail message on the mail panel of the debugger.
    20|         <?php if (Yii::$app->mailer->useFileTransport): ?>
    21|         Because the application is in development mode, the email is not sent but saved as
    22|         a file under <code><?= Yii::getAlias(Yii::$app->mailer->fileTransportPath) ?></code>.
    23|         Please configure the <code>useFileTransport</code> property of the <code>mail</code>
    24|         application component to be false to enable email sending.
    25|         <?php endif; ?>
    26|     </p>
    27|     <?php else: ?>
    28|     <p>
    29|         If you have business inquiries or other questions, please fill out the following form to contact us. Thank you.
    30|     </p>
    31|     <div class="row">
    32|         <div class="col-lg-5">
    33|             <?php $form = ActiveForm::begin(['id' => 'contact-form']); ?>
    34|                 <?= $form->field($model, 'name') ?>
    35|                 <?= $form->field($model, 'email') ?>
    36|                 <?= $form->field($model, 'subject') ?>
    37|                 <?= $form->field($model, 'body')->textArea(['rows' => 6]) ?>
    38|                 <?= $form->field($model, 'verifyCode')->widget(Captcha::className(), [
    39|                     'template' => '<div class="row"><div class="col-lg-3">{image}</div><div class="col-lg-6">{input}</div></div>',
    40|                 ]) ?>
    41|                 <div class="form-group">
    42|                     <?= Html::submitButton('Submit', ['class' => 'btn btn-primary', 'name' => 'contact-button']) ?>
    43|                 </div>
    44|             <?php ActiveForm::end(); ?>
    45|         </div>
    46|     </div>
    47|     <?php endif; ?>
    48| </div>


# ====================================================================
# FILE: apps/basic/views/site/error.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-20 ---
     1| <?php
     2| use yii\helpers\Html;
     3| /* @var $this yii\web\View */
     4| /* @var $name string */
     5| /* @var $message string */
     6| /* @var $exception Exception */
     7| $this->title = $name;
     8| ?>
     9| <div class="site-error">
    10|     <h1><?= Html::encode($this->title) ?></h1>
    11|     <div class="alert alert-danger">
    12|         <?= nl2br(Html::encode($message)) ?>
    13|     </div>
    14|     <p>
    15|         The above error occurred while the Web server was processing your request.
    16|     </p>
    17|     <p>
    18|         Please contact us if you think this is a server error. Thank you.
    19|     </p>
    20| </div>


# ====================================================================
# FILE: apps/basic/views/site/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-39 ---
     1| <?php
     2| /* @var $this yii\web\View */
     3| $this->title = 'My Yii Application';
     4| ?>
     5| <div class="site-index">
     6|     <div class="jumbotron">
     7|         <h1>Congratulations!</h1>
     8|         <p class="lead">You have successfully created your Yii-powered application.</p>
     9|         <p><a class="btn btn-lg btn-success" href="http://www.yiiframework.com">Get started with Yii</a></p>
    10|     </div>
    11|     <div class="body-content">
    12|         <div class="row">
    13|             <div class="col-lg-4">
    14|                 <h2>Heading</h2>
    15|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    16|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    17|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    18|                     fugiat nulla pariatur.</p>
    19|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/doc/">Yii Documentation &raquo;</a></p>
    20|             </div>
    21|             <div class="col-lg-4">
    22|                 <h2>Heading</h2>
    23|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    24|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    25|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    26|                     fugiat nulla pariatur.</p>
    27|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/forum/">Yii Forum &raquo;</a></p>
    28|             </div>
    29|             <div class="col-lg-4">
    30|                 <h2>Heading</h2>
    31|                 <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
    32|                     dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
    33|                     ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
    34|                     fugiat nulla pariatur.</p>
    35|                 <p><a class="btn btn-default" href="http://www.yiiframework.com/extensions/">Yii Extensions &raquo;</a></p>
    36|             </div>
    37|         </div>
    38|     </div>
    39| </div>


# ====================================================================
# FILE: apps/basic/views/site/login.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-36 ---
     1| <?php
     2| use yii\helpers\Html;
     3| use yii\bootstrap\ActiveForm;
     4| /* @var $this yii\web\View */
     5| /* @var $form yii\bootstrap\ActiveForm */
     6| /* @var $model app\models\LoginForm */
     7| $this->title = 'Login';
     8| $this->params['breadcrumbs'][] = $this->title;
     9| ?>
    10| <div class="site-login">
    11|     <h1><?= Html::encode($this->title) ?></h1>
    12|     <p>Please fill out the following fields to login:</p>
    13|     <?php $form = ActiveForm::begin([
    14|         'id' => 'login-form',
    15|         'options' => ['class' => 'form-horizontal'],
    16|         'fieldConfig' => [
    17|             'template' => "{label}\n<div class=\"col-lg-3\">{input}</div>\n<div class=\"col-lg-8\">{error}</div>",
    18|             'labelOptions' => ['class' => 'col-lg-1 control-label'],
    19|         ],
    20|     ]); ?>
    21|     <?= $form->field($model, 'username') ?>
    22|     <?= $form->field($model, 'password')->passwordInput() ?>
    23|     <?= $form->field($model, 'rememberMe', [
    24|         'template' => "<div class=\"col-lg-offset-1 col-lg-3\">{input}</div>\n<div class=\"col-lg-8\">{error}</div>",
    25|     ])->checkbox() ?>
    26|     <div class="form-group">
    27|         <div class="col-lg-offset-1 col-lg-11">
    28|             <?= Html::submitButton('Login', ['class' => 'btn btn-primary', 'name' => 'login-button']) ?>
    29|         </div>
    30|     </div>
    31|     <?php ActiveForm::end(); ?>
    32|     <div class="col-lg-offset-1" style="color:#999;">
    33|         You may login with <strong>admin/admin</strong> or <strong>demo/demo</strong>.<br>
    34|         To modify the username/password, please check out the code <code>app\models\User::$users</code>.
    35|     </div>
    36| </div>


# ====================================================================
# FILE: apps/basic/web/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-7 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', true);
     3| defined('YII_ENV') or define('YII_ENV', 'dev');
     4| require(__DIR__ . '/../vendor/autoload.php');
     5| require(__DIR__ . '/../vendor/yiisoft/yii2/Yii.php');
     6| $config = require(__DIR__ . '/../config/web.php');
     7| (new yii\web\Application($config))->run();


# ====================================================================
# FILE: apps/benchmark/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-14 ---
     1| <?php
     2| defined('YII_DEBUG') or define('YII_DEBUG', false);
     3| require(__DIR__ . '/protected/vendor/yiisoft/yii2/Yii.php');
     4| $config = [
     5|     'id' => 'benchmark',
     6|     'basePath' => __DIR__ . '/protected',
     7|     'components' => [
     8|         'urlManager' => [
     9|             'enablePrettyUrl' => true,
    10|         ],
    11|     ],
    12| ];
    13| $application = new yii\web\Application($config);
    14| $application->run();


# ====================================================================
# FILE: apps/benchmark/protected/controllers/SiteController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| <?php
     2| namespace app\controllers;
     3| use yii\web\Controller;
     4| class SiteController extends Controller
     5| {
     6|     public $defaultAction = 'hello';
     7|     public function actionHello()
     8|     {
     9|         return 'hello world';
    10|     }
    11| }


# ====================================================================
# FILE: build/controllers/AppController.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-108 ---
     1| <?php
     2| /**
     3|  * @link http://www.yiiframework.com/
     4|  * @copyright Copyright (c) 2008 Yii Software LLC
     5|  * @license http://www.yiiframework.com/license/
     6|  */
     7| namespace yii\build\controllers;
     8| use Yii;
     9| use yii\console\Controller;
    10| use yii\helpers\FileHelper;
    11| /**
    12|  * AppController will link the yii2 dev installation to the containted applications vendor dirs
    13|  * to help working on yii using the application to test it.
    14|  *
    15|  * @author Carsten Brandt <mail@cebe.cc>
    16|  * @since 2.0
    17|  */
    18| class AppController extends Controller
    19| {
    20|     public $defaultAction = 'link';
    21|     /**
    22|      * Properly removes symlinked directory under Windows, MacOS and Linux
    23|      *
    24|      * @param string $file path to symlink
    25|      */
    26|     protected function unlink($file)
    27|     {
    28|         if (is_dir($file) && DIRECTORY_SEPARATOR === '\\') {
    29|             rmdir($file);
    30|         } else {
    31|             unlink($file);
    32|         }
    33|     }
    34|     /**
    35|      * This command runs the following shell commands in the dev repo root:
    36|      *
    37|      * - Run `composer update`
    38|      * - `rm -rf apps/basic/vendor/yiisoft/yii2`
    39|      * - `rm -rf apps/basic/vendor/yiisoft/yii2-*`
    40|      *
    41|      * And replaces them with symbolic links to the extensions and framework path in the dev repo.
    42|      * @param string $app the application name `basic` or `advanced`.
    43|      */
    44|     public function actionLink($app)
    45|     {
    46|         $base = dirname(dirname(__DIR__));
    47|         $appDir = "$base/apps/$app";
    48|         if (is_link($link = "$appDir/vendor/yiisoft/yii2")) {
    49|             $this->stdout("Removing symlink $link.\n");
    50|             $this->unlink($link);
    51|         }
    52|         $extensions = $this->findDirs("$appDir/vendor/yiisoft");
    53|         foreach($extensions as $ext) {
    54|             if (is_link($link = "$appDir/vendor/yiisoft/yii2-$ext")) {
    55|                 $this->stdout("Removing symlink $link.\n");
    56|                 $this->unlink($link);
    57|             }
    58|         }
    59|         chdir($appDir);
    60|         passthru('composer update --prefer-dist');
    61|         if (is_dir($link = "$appDir/vendor/yiisoft/yii2")) {
    62|             $this->stdout("Removing dir $link.\n");
    63|             FileHelper::removeDirectory($link);
    64|             $this->stdout("Creating symlink for $link.\n");
    65|             symlink("$base/framework", $link);
    66|         }
    67|         $extensions = $this->findDirs("$appDir/vendor/yiisoft");
    68|         foreach($extensions as $ext) {
    69|             if (is_dir($link = "$appDir/vendor/yiisoft/yii2-$ext")) {
    70|                 $this->stdout("Removing dir $link.\n");
    71|                 FileHelper::removeDirectory($link);
    72|                 $this->stdout("Creating symlink for $link.\n");
    73|                 symlink("$base/extensions/$ext", $link);
    74|             }
    75|         }
    76|         $this->stdout("done.\n");
    77|     }
    78|     /**
    79|      * Finds linkable applications
    80|      *
    81|      * @param string $dir directory to search in
    82|      * @return array list of applications command can link
    83|      */
    84|     protected function findDirs($dir)
    85|     {
    86|         $list = [];
    87|         $handle = @opendir($dir);
    88|         if ($handle === false) {
    89|             return [];
    90|         }
    91|         while (($file = readdir($handle)) !== false) {
    92|             if ($file === '.' || $file === '..') {
    93|                 continue;
    94|             }
    95|             $path = $dir . DIRECTORY_SEPARATOR . $file;
    96|             if (is_dir($path) && preg_match('/^yii2-(.*)$/', $file, $matches)) {
    97|                 $list[] = $matches[1];
    98|             }
    99|         }
   100|         closedir($handle);
   101|         foreach($list as $i => $e) {
   102|             if ($e == 'composer') { // skip composer to not break composer update
   103|                 unset($list[$i]);
   104|             }
   105|         }
   106|         return $list;
   107|     }
   108| }

