--- a/debugger/action.php
+++ b/debugger/action.php
@@ -2,32 +2,34 @@
 /**
  * @author Gaetano Giunta
  * @copyright (C) 2005-2021 G. Giunta
  * @license code licensed under the BSD License: see file license.txt
  *
  * @todo switch params for http compression from 0,1,2 to values to be used directly
  * @todo use ob_start to catch debug info and echo it AFTER method call results?
  * @todo be smarter in creating client stub for proxy/auth cases: only set appropriate property of client obj
  **/
 header('Content-Type: text/html; charset=utf-8');
-?><!DOCTYPE html>
-<html lang="en">
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head>
     <link rel="icon" type="image/vnd.microsoft.icon" href="favicon.ico">
     <title><?php if (defined('DEFAULT_WSTYPE') && DEFAULT_WSTYPE == 1) echo 'JSONRPC'; else echo 'XMLRPC'; ?> Debugger</title>
     <meta name="robots" content="index,nofollow"/>
     <style type="text/css">
         <!--
         body {
             border-top: 1px solid gray;
             padding: 1em;
-            font-family: Verdana, Arial, Helvetica, sans-serif;
+            font-family: Verdana, Arial, Helvetica;
             font-size: 8pt;
         }
         h3 {
             font-size: 9.5pt;
         }
         h2 {
             font-size: 12pt;
         }
         .dbginfo {
             padding: 1em;
@@ -462,21 +464,20 @@
     <h3>Example</h3>
     <p>
         Server Address: gggeek.altervista.org<br/>
         Path: /sw/xmlrpc/demo/server/server.php
     </p>
     <h3>Notice</h3>
     <p>all usernames and passwords entered on the above form will be written to the web server logs of this server. Use
         with care.</p>
     <h3>Changelog</h3>
     <ul>
-        <li>2022-12-18: fix XSS vulnerability in the debugger; load jsxmlrpc from CDN; minor improvements</li>
         <li>2022-11-28: allow to use http/2 protocol; two security issues fixed in the underlying library</li>
         <li>2020-12-11: fix problems with running the debugger on php 8</li>
         <li>2015-05-30: fix problems with generating method payloads for NIL and Undefined parameters</li>
         <li>2015-04-19: fix problems with LATIN-1 characters in payload</li>
         <li>2007-02-20: add visual editor for method payload; allow strings, bools as jsonrpc msg id</li>
         <li>2006-06-26: support building php code stub for calling remote methods</li>
         <li>2006-05-25: better support for long running queries; check for no-curl installs</li>
         <li>2006-05-02: added support for JSON-RPC. Note that many interesting json-rpc features are not implemented
             yet, such as notifications or multicall.
         </li>

--- a/debugger/controller.php
+++ b/debugger/controller.php
@@ -12,54 +12,45 @@
  * @todo add http no-cache headers
  * @todo if jsonrpc php classes are not available, gray out or hide altogether the JSONRPC option & title
  * @todo if js libs are not available, do not try to load them
  **/
 header('Content-Type: text/html; charset=utf-8');
 include __DIR__ . '/common.php';
 if ($action == '') {
     $action = 'list';
 }
 $editorpath = (defined('JSXMLRPC_PATH') ? JSXMLRPC_PATH : '../..') . '/jsxmlrpc/debugger/';
-$editorurlpath = defined('JSXMLRPC_BASEURL') ? JSXMLRPC_BASEURL : $editorpath;
-if (defined('JSXMLRPC_BASEURL')) {
-    $haseditor = true;
-} else {
-    if ($editorpath[0] !== '/') {
-        $haseditor = is_file(realpath(__DIR__ . '/' . $editorpath . 'visualeditor.html'));
-    } else {
-        $haseditor = is_file(realpath($editorpath . 'visualeditor.html'));;
-    }
-}
-?><!DOCTYPE html>
-<html lang="en">
+$editorlibs = (defined('JSXMLRPC_PATH') ? JSXMLRPC_PATH : '../..') . '/jsxmlrpc/lib/';
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
+    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
+<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head>
     <link rel="icon" type="image/vnd.microsoft.icon" href="favicon.ico">
     <title><?php if (defined('DEFAULT_WSTYPE') && DEFAULT_WSTYPE == 1) echo 'JSONRPC'; else echo 'XMLRPC'; ?> Debugger</title>
     <meta name="robots" content="index,nofollow"/>
     <script type="text/javascript" language="Javascript">
         if (window.name != 'frmcontroller')
             top.location.replace('index.php?run=' + escape(self.location));
     </script>
     <!-- xmlrpc/jsonrpc base library -->
-    <script type="module">
-        import {base64_decode} from 'https://cdn.jsdelivr.net/npm/@jsxmlrpc/jsxmlrpc@0.6/lib/index.js';
-        window.base64_decode = base64_decode;
-    </script>
-    <style>
+    <script type="text/javascript" src="<?php echo $editorlibs; ?>xmlrpc_lib.js"></script>
+    <script type="text/javascript" src="<?php echo $editorlibs; ?>jsonrpc_lib.js"></script>
+    <style type="text/css">
         <!--
         html {
             overflow: -moz-scrollbars-vertical;
         }
         body {
             padding: 0.5em;
             background-color: #EEEEEE;
-            font-family: Verdana, Arial, Helvetica, sans-serif;
+            font-family: Verdana, Arial, Helvetica;
             font-size: 8pt;
         }
         h1 {
             font-size: 12pt;
             margin: 0.5em;
         }
         h2 {
             font-size: 10pt;
             display: inline;
             vertical-align: top;
@@ -67,29 +58,30 @@
         table {
             border: 1px solid gray;
             margin-bottom: 0.5em;
             padding: 0.25em;
             width: 100%;
         }
             display: inline;
         }
         td {
             vertical-align: top;
-            font-family: Verdana, Arial, Helvetica, sans-serif;
+            font-family: Verdana, Arial, Helvetica;
             font-size: 8pt;
         }
         .labelcell {
             text-align: right;
         }
         -->
     </style>
-    <script type="text/javascript">
+    <script language="JavaScript" type="text/javascript">
+        <!--
         function verifyserver() {
             if (document.frmaction.host.value == '') {
                 alert('Please insert a server name or address');
                 return false;
             }
             if (document.frmaction.path.value == '')
                 document.frmaction.path.value = '/';
             var action = '';
             for (counter = 0; counter < document.frmaction.action.length; counter++)
                 if (document.frmaction.action[counter].checked) {
@@ -168,29 +160,29 @@
                 document.frmaction.wstype.value = "0";
             }
             else {
                 document.getElementById("idcell").style.visibility = 'visible';
                 document.frmjsonrpc.yes.checked = true;
                 document.frmxmlrpc.yes.checked = false;
                 document.frmaction.wstype.value = "1";
             }
         }
         function displaydialogeditorbtn(show) {
-            if (show && <?php echo $haseditor ? 'true' : 'false'; ?>) {
+            if (show && ((typeof base64_decode) == 'function')) {
                 document.getElementById('methodpayloadbtn').innerHTML = '[<a href="#" onclick="activateeditor(); return false;">Edit</a>]';
             }
             else {
                 document.getElementById('methodpayloadbtn').innerHTML = '';
             }
         }
         function activateeditor() {
-            var url = '<?php echo $editorurlpath; ?>visualeditor.html?params=<?php echo str_replace(array("\\", "'"), array( "\\\\","\\'"), $alt_payload); ?>';
+            var url = '<?php echo $editorpath; ?>visualeditor.php?params=<?php echo $alt_payload; ?>';
             if (document.frmaction.wstype.value == "1")
                 url += '&type=jsonrpc';
             var wnd = window.open(url, '_blank', 'width=750, height=400, location=0, resizable=1, menubar=0, scrollbars=1');
         }
         function buildparams(base64data) {
             if (typeof base64_decode == 'function') {
                 if (base64data == '0') // workaround for bug in base64_encode...
                     document.getElementById('methodpayload').value = '';
                 else
                     document.getElementById('methodpayload').value = base64_decode(base64data);
@@ -211,28 +203,20 @@
 <h1>XMLRPC
     <form name="frmxmlrpc" style="display: inline;" action="."><input name="yes" type="radio" onclick="switchtransport(0);" <?php if (!class_exists('\PhpXmlRpc\Client')) { echo 'disabled="disabled"';} ?>/></form>
     /
     <form name="frmjsonrpc" style="display: inline;" action="."><input name="yes" type="radio" onclick="switchtransport(1);" <?php if (!class_exists('\PhpXmlRpc\JsonRpc\Client')) { echo 'disabled="disabled"';} ?>/></form>
     JSONRPC Debugger (based on the <a href="https://gggeek.github.io/phpxmlrpc/">PHP-XMLRPC</a> library)
 </h1>
 <form name="frmaction" method="get" action="action.php" target="frmaction" onSubmit="switchFormMethod();">
     <table id="serverblock">
         <tr>
             <td><h2>Target server</h2></td>
-            <td class="labelcell">Protocol:</td>
-            <td><select name="protocol" onchange="switchssl(); switchauth(); swicthcainfo();">
-                <option value="0"<?php if ($protocol == 0) { echo ' selected="selected"'; } ?>>HTTP 1.0</option>
-                <option value="1"<?php if ($protocol == 1) { echo ' selected="selected"'; } ?>>HTTP 1.1</option>
-                <option value="2"<?php if ($protocol == 2) { echo ' selected="selected"'; } ?>>HTTPS</option>
-                <option value="3"<?php if ($protocol == 3) { echo ' selected="selected"'; } ?>>HTTP2</option>
-                <option value="4"<?php if ($protocol == 3) { echo ' selected="selected"'; } ?>>HTTP2 no TLS</option>
-            </select></td>
             <td class="labelcell">Address:</td>
             <td><input type="text" name="host" value="<?php echo htmlspecialchars($host, ENT_COMPAT, $inputcharset); ?>"/></td>
             <td class="labelcell">Port:</td>
             <td><input type="text" name="port" value="<?php echo htmlspecialchars($port, ENT_COMPAT, $inputcharset); ?>" size="5" maxlength="5"/>
             </td>
             <td class="labelcell">Path:</td>
             <td><input type="text" name="path" value="<?php echo htmlspecialchars($path, ENT_COMPAT, $inputcharset); ?>"/></td>
         </tr>
     </table>
     <table id="actionblock">
@@ -264,22 +248,28 @@
             <td><h2>Client options</h2></td>
             <td class="labelcell">Show debug info:</td>
             <td><select name="debug">
                     <option value="0"<?php if ($debug == 0) { echo ' selected="selected"'; } ?>>No</option>
                     <option value="1"<?php if ($debug == 1) { echo ' selected="selected"'; } ?>>Yes</option>
                     <option value="2"<?php if ($debug == 2) { echo ' selected="selected"'; } ?>>More</option>
                 </select>
             </td>
             <td class="labelcell">Timeout:</td>
             <td><input type="text" name="timeout" size="3" value="<?php if ($timeout > 0) { echo $timeout; } ?>"/></td>
-            <td</td>
-            <td></td>
+            <td class="labelcell">Protocol:</td>
+            <td><select name="protocol" onchange="switchssl(); switchauth(); swicthcainfo();">
+                    <option value="0"<?php if ($protocol == 0) { echo ' selected="selected"'; } ?>>HTTP 1.0</option>
+                    <option value="1"<?php if ($protocol == 1) { echo ' selected="selected"'; } ?>>HTTP 1.1</option>
+                    <option value="2"<?php if ($protocol == 2) { echo ' selected="selected"'; } ?>>HTTPS</option>
+                    <option value="3"<?php if ($protocol == 3) { echo ' selected="selected"'; } ?>>HTTP2</option>
+                    <option value="4"<?php if ($protocol == 3) { echo ' selected="selected"'; } ?>>HTTP2 no TLS</option>
+                </select></td>
         </tr>
         <tr>
             <td class="labelcell">AUTH:</td>
             <td class="labelcell">Username:</td>
             <td><input type="text" name="username" value="<?php echo htmlspecialchars($username, ENT_COMPAT, $inputcharset); ?>"/></td>
             <td class="labelcell">Pwd:</td>
             <td><input type="password" name="password" value="<?php echo htmlspecialchars($password, ENT_COMPAT, $inputcharset); ?>"/></td>
             <td class="labelcell">Type</td>
             <td><select name="authtype">
                     <option value="1"<?php if ($authtype == 1) { echo ' selected="selected"'; } ?>>Basic</option>

--- a/debugger/index.php
+++ b/debugger/index.php
@@ -1,19 +1,20 @@
 <?php
 $query = '';
 if (isset($_GET['run'])) {
     $path = parse_url($_GET['run']);
     if (isset($path['query'])) {
         $query = '?' . $path['query'];
     }
 }
-?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
+?>
+<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
 <html lang="en">
 <head>
     <link rel="icon" type="image/vnd.microsoft.icon" href="favicon.ico">
     <title><?php if (defined('DEFAULT_WSTYPE') && DEFAULT_WSTYPE == 1) echo 'JSONRPC'; else echo 'XMLRPC'; ?> Debugger</title>
 </head>
 <frameset rows="360,*">
     <frame name="frmcontroller" src="controller.php<?php echo htmlspecialchars($query); ?>" marginwidth="0"
            marginheight="0" frameborder="0"/>
     <frame name="frmaction" src="action.php" marginwidth="0" marginheight="0" frameborder="0"/>

--- a/pakefile.php
+++ b/pakefile.php
@@ -90,29 +90,24 @@
      * @throws \Exception
      */
     public static function applyXslt($inFile, $xssFile, $outFileOrDir)
     {
         if (!file_exists($inFile)) {
             throw new \Exception("File $inFile cannot be found");
         }
         if (!file_exists($xssFile)) {
             throw new \Exception("File $xssFile cannot be found");
         }
-        $docbookFoXslPath = realpath(Builder::buildDir().'/tools/vendor/docbook/docbook-xsl/fo/docbook.xsl');
-        $docbookChunkXslPath = realpath(Builder::buildDir().'/tools/vendor/docbook/docbook-xsl/xhtml/chunk.xsl');
+        $docbookXslPath = realpath(Builder::buildDir().'/tools/vendor/docbook/docbook-xsl/fo/docbook.xsl');
         file_put_contents(
             $xssFile,
-            str_replace(
-                array('%fo-docbook.xsl%', '%docbook-chunk.xsl%'),
-                array($docbookFoXslPath, $docbookChunkXslPath),
-                file_get_contents($xssFile)
-            )
+            str_replace('%docbook.xsl%', $docbookXslPath, file_get_contents($xssFile))
         );
         $xml = new \DOMDocument();
         $xml->load($inFile);
         $xsl = new \DOMDocument();
         $xsl->load($xssFile);
         $processor = new \XSLTProcessor();
         if (version_compare(PHP_VERSION, '5.4', "<")) {
             if (defined('XSL_SECPREF_WRITE_FILE')) {
                 ini_set("xsl.security_prefs", XSL_SECPREF_CREATE_DIRECTORY | XSL_SECPREF_WRITE_FILE);
             }

--- a/src/PhpXmlRpc.php
+++ b/src/PhpXmlRpc.php
@@ -60,21 +60,21 @@
         'cannot_decompress' => 'Received from server compressed HTTP and cannot decompress',
         'decompress_fail' => 'Received from server invalid compressed HTTP',
         'dechunk_fail' => 'Received from server invalid chunked HTTP',
         'server_cannot_decompress' => 'Received from client compressed HTTP request and cannot decompress',
         'server_decompress_fail' => 'Received from client invalid compressed HTTP request',
     );
     public static $xmlrpc_defencoding = "UTF-8";
     public static $xmlrpc_detectencodings = array();
     public static $xmlrpc_internalencoding = "UTF-8";
     public static $xmlrpcName = "XML-RPC for PHP";
-    public static $xmlrpcVersion = "4.9.2";
+    public static $xmlrpcVersion = "4.9.1";
     public static $xmlrpcerruser = 800;
     public static $xmlrpcerrxml = 100;
     public static $xmlrpc_null_extension = false;
     public static $xmlrpc_null_apache_encoding = false;
     public static $xmlrpc_null_apache_encoding_ns = "http://ws.apache.org/xmlrpc/namespaces/extensions";
     public static $xmlpc_double_precision = 128;
     /**
      * A function to be used for compatibility with legacy code: it creates all global variables which used to be declared,
      * such as library version etc...
      */

--- a/src/Wrapper.php
+++ b/src/Wrapper.php
@@ -845,21 +845,21 @@
                 }
             }
             $innerCode .= "\$req->addparam(\$p$i);\n";
             $mDesc .= '* @param ' . $this->xmlrpc2PhpType($pType) . " \$p$i\n";
         }
         if ($clientCopyMode < 2) {
             $plist[] = '$debug=0';
             $mDesc .= "* @param int \$debug when 1 (or 2) will enable debugging of the underlying {$prefix} call (defaults to 0)\n";
         }
         $plist = implode(', ', $plist);
-        $mDesc .= "* @return {$namespace}Response|" . $this->xmlrpc2PhpType($mSig[0]) . " (an {$namespace}Response obj instance if call fails)\n*/\n";
+        $mDesc .= '* @return {$namespace}Response|' . $this->xmlrpc2PhpType($mSig[0]) . " (an {$namespace}Response obj instance if call fails)\n*/\n";
         $innerCode .= "\$res = \${$this_}client->send(\$req, $timeout, '$protocol');\n";
         if ($decodeFault) {
             if (is_string($faultResponse) && ((strpos($faultResponse, '%faultCode%') !== false) || (strpos($faultResponse, '%faultString%') !== false))) {
                 $respCode = "str_replace(array('%faultCode%', '%faultString%'), array(\$res->faultCode(), \$res->faultString()), '" . str_replace("'", "''", $faultResponse) . "')";
             } else {
                 $respCode = var_export($faultResponse, true);
             }
         } else {
             $respCode = '$res';
         }
