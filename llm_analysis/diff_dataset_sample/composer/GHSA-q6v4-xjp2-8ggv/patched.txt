# ====================================================================
# FILE: example_form.ajax.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 116-151 ---
   116|                 $errors['message_error'] = 'Please enter a message';
   117|             }
   118|         }
   119|         if (sizeof($errors) == 0) {
   120|             require_once dirname(__FILE__) . '/securimage.php';
   121|             $securimage = new Securimage();
   122|             if ($securimage->check($captcha) == false) {
   123|                 $errors['captcha_error'] = 'Incorrect security code entered';
   124|             }
   125|         }
   126|         if (sizeof($errors) == 0) {
   127|             $time       = date('r');
   128|             $message = "A message was submitted from the contact form.  The following information was provided.<br /><br />"
   129|                      . "Name: $name<br />"
   130|                      . "Email: $email<br />"
   131|                      . "URL: $URL<br />"
   132|                      . "Message:<br />"
   133|                      . "<pre>$message</pre>"
   134|                      . "<br /><br />IP Address: {$_SERVER['REMOTE_ADDR']}<br />"
   135|                      . "Time: $time<br />"
   136|                      . "Browser: " . htmlspecialchars($_SERVER['HTTP_USER_AGENT']) . "<br />";
   137|             if (isset($GLOBALS['DEBUG_MODE']) && $GLOBALS['DEBUG_MODE'] == false) {
   138|                 mail($GLOBALS['ct_recipient'], $GLOBALS['ct_msg_subject'], $message, "From: {$GLOBALS['ct_recipient']}\r\nReply-To: {$email}\r\nContent-type: text/html; charset=ISO-8859-1\r\nMIME-Version: 1.0");
   139|             }
   140|             $return = array('error' => 0, 'message' => 'OK');
   141|             die(json_encode($return));
   142|         } else {
   143|             $errmsg = '';
   144|             foreach($errors as $key => $error) {
   145|                 $errmsg .= " - {$error}\n";
   146|             }
   147|             $return = array('error' => 1, 'message' => $errmsg);
   148|             die(json_encode($return));
   149|         }
   150|     } // POST
   151| } // function process_si_contact_form()


# ====================================================================
# FILE: example_form.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 128-168 ---
   128|         $errors['message_error'] = 'Your message must be longer than 20 characters';
   129|       }
   130|     }
   131|     if (sizeof($errors) == 0) {
   132|       require_once dirname(__FILE__) . '/securimage.php';
   133|       $securimage = new Securimage();
   134|       if ($securimage->check($captcha) == false) {
   135|         $errors['captcha_error'] = 'Incorrect security code entered<br />';
   136|       }
   137|     }
   138|     if (sizeof($errors) == 0) {
   139|       $time       = date('r');
   140|       $message = "A message was submitted from the contact form.  The following information was provided.<br /><br />"
   141|                     . "<em>Name: $name</em><br />"
   142|                     . "<em>Email: $email</em><br />"
   143|                     . "<em>URL: $URL</em><br />"
   144|                     . "<em>Message:</em><br />"
   145|                     . "<pre>$message</pre>"
   146|                     . "<br /><br /><em>IP Address:</em> {$_SERVER['REMOTE_ADDR']}<br />"
   147|                     . "<em>Time:</em> $time<br />"
   148|                     . "<em>Browser:</em> " . htmlspecialchars($_SERVER['HTTP_USER_AGENT']) . "<br />";
   149|       $message = wordwrap($message, 70);
   150|       if (isset($GLOBALS['DEBUG_MODE']) && $GLOBALS['DEBUG_MODE'] == false) {
   151|         mail($GLOBALS['ct_recipient'], $GLOBALS['ct_msg_subject'], $message, "From: {$GLOBALS['ct_recipient']}\r\nReply-To: {$email}\r\nContent-type: text/html; charset=UTF-8\r\nMIME-Version: 1.0");
   152|       }
   153|       $_SESSION['ctform']['timetosolve'] = $securimage->getTimeToSolve();
   154|       $_SESSION['ctform']['error'] = false;  // no error with form
   155|       $_SESSION['ctform']['success'] = true; // message sent
   156|     } else {
   157|       $_SESSION['ctform']['ct_name'] = $name;       // save name from the form submission
   158|       $_SESSION['ctform']['ct_email'] = $email;     // save email
   159|       $_SESSION['ctform']['ct_URL'] = $URL;         // save URL
   160|       $_SESSION['ctform']['ct_message'] = $message; // save message
   161|       foreach($errors as $key => $error) {
   162|         $_SESSION['ctform'][$key] = "<span class=\"error\">$error</span>";
   163|       }
   164|       $_SESSION['ctform']['error'] = true; // set error floag
   165|     }
   166|   } // POST
   167| }
   168| $_SESSION['ctform']['success'] = false; // clear success value after running


# ====================================================================
# FILE: securimage.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-72 ---
     1| <?php
     2| /**
     3|  * Project:  Securimage: A PHP class dealing with CAPTCHA images, audio, and validation
     4|  * File:     securimage.php
     5|  *
     6|  * Copyright (c) 2017, Drew Phillips
     7|  * All rights reserved.
     8|  *
     9|  * Redistribution and use in source and binary forms, with or without modification,
    10|  * are permitted provided that the following conditions are met:
    11|  *
    12|  *  - Redistributions of source code must retain the above copyright notice,
    13|  *    this list of conditions and the following disclaimer.
    14|  *  - Redistributions in binary form must reproduce the above copyright notice,
    15|  *    this list of conditions and the following disclaimer in the documentation
    16|  *    and/or other materials provided with the distribution.
    17|  *
    18|  * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
    19|  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
    20|  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
    21|  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
    22|  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
    23|  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
    24|  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
    25|  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
    26|  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
    27|  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    28|  * POSSIBILITY OF SUCH DAMAGE.
    29|  *
    30|  * Any modifications to the library should be indicated clearly in the source code
    31|  * to inform users that the changes are not a part of the original software.
    32|  *
    33|  * If you found this script useful, please take a quick moment to rate it.
    34|  * http://www.hotscripts.com/rate/49400.html  Thanks.
    35|  *
    36|  * @link http://www.phpcaptcha.org Securimage PHP CAPTCHA
    37|  * @link http://www.phpcaptcha.org/latest.zip Download Latest Version
    38|  * @link http://www.phpcaptcha.org/Securimage_Docs/ Online Documentation
    39|  * @copyright 2017 Drew Phillips
    40|  * @author Drew Phillips <drew@drew-phillips.com>
    41|  * @version 3.6.6 (Nov 20 2017)
    42|  * @package Securimage
    43|  *
    44|  */
    45| /**
    46|  ChangeLog
    47|  3.6.6
    48|  - Not critical: Fix potential HTML injection in example form via HTTP_USER_AGENT (CVE-2017-14077)
    49|  3.6.5
    50|  - Fix regex in replaceElements in securimage.js
    51|  - Update examples
    52|  - Exclude certain examples from Git autogenerated archives
    53|  3.6.4
    54|  - Fix XSS vulnerability in example_form.ajax.php (Discovered by RedTeam. advisory rt-sa-2016-002)
    55|  - Update example_form.ajax.php to use Securimage::getCaptchaHtml()
    56|  3.6.3
    57|  - Add support for multibyte wordlist files
    58|  - Fix code generation issues with UTF-8 charsets
    59|  - Add parameter to getCaptchaHtml() method to control display components of captcha HTML
    60|  - Fix database audio storage issue with multiple namespaces
    61|  3.6.2
    62|  - Support HTTP range requests with audio playback (iOS requirement)
    63|  - Add optional config.inc.php for storing global configuration settings
    64|  3.6.1
    65|  - Fix copyElement bug in securimage.js for IE Flash fallback
    66|  3.6
    67|  - Implement CAPTCHA audio using HTML5 <audio> with optional Flash fallback
    68|  - Support MP3 audio using LAME MP3 Encoder (Internet Explorer 9+ does not support WAV format in <audio> tags)
    69|  - Add getCaptchaHtml() options to support full framework integration (ruifil)
    70|  3.5.4
    71|  - Fix email validation code in example form files
    72|  - Fix backslashes in getCaptchaHtml for img attribute on Windows systems


# ====================================================================
# FILE: securimage_play.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 11-45 ---
    11|  * This library is distributed in the hope that it will be useful,
    12|  * but WITHOUT ANY WARRANTY; without even the implied warranty of
    13|  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    14|  * Lesser General Public License for more details.<br /><br />
    15|  *
    16|  * You should have received a copy of the GNU Lesser General Public
    17|  * License along with this library; if not, write to the Free Software
    18|  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA<br /><br />
    19|  *
    20|  * Any modifications to the library should be indicated clearly in the source code
    21|  * to inform users that the changes are not a part of the original software.<br /><br />
    22|  *
    23|  * If you found this script useful, please take a quick moment to rate it.<br />
    24|  * http://www.hotscripts.com/rate/49400.html  Thanks.
    25|  *
    26|  * @link http://www.phpcaptcha.org Securimage PHP CAPTCHA
    27|  * @link http://www.phpcaptcha.org/latest.zip Download Latest Version
    28|  * @link http://www.phpcaptcha.org/Securimage_Docs/ Online Documentation
    29|  * @copyright 2012 Drew Phillips
    30|  * @author Drew Phillips <drew@drew-phillips.com>
    31|  * @version 3.6.6 (Nov 20 2017)
    32|  * @package Securimage
    33|  *
    34|  */
    35| require_once dirname(__FILE__) . '/securimage.php';
    36| $options = array(
    37|     'use_database'    => true,
    38|     'database_name'   => '',
    39|     'database_user'   => '',
    40|     'database_driver' => Securimage::SI_DRIVER_MYSQL
    41| );
    42| $img = new Securimage();
    43| if (!empty($_GET['namespace'])) $img->setNamespace($_GET['namespace']);
    44| $format = (isset($_GET['format']) && strtolower($_GET['format']) == 'mp3') ? 'mp3' : null;
    45| $img->outputAudioFile($format);


# ====================================================================
# FILE: securimage_show.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 21-48 ---
    21|  * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
    22|  * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
    23|  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
    24|  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
    25|  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
    26|  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
    27|  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
    28|  * POSSIBILITY OF SUCH DAMAGE.
    29|  *
    30|  * Any modifications to the library should be indicated clearly in the source code
    31|  * to inform users that the changes are not a part of the original software.<br /><br />
    32|  *
    33|  * If you found this script useful, please take a quick moment to rate it.<br />
    34|  * http://www.hotscripts.com/rate/49400.html  Thanks.
    35|  *
    36|  * @link http://www.phpcaptcha.org Securimage PHP CAPTCHA
    37|  * @link http://www.phpcaptcha.org/latest.zip Download Latest Version
    38|  * @link http://www.phpcaptcha.org/Securimage_Docs/ Online Documentation
    39|  * @copyright 2013 Drew Phillips
    40|  * @author Drew Phillips <drew@drew-phillips.com>
    41|  * @version 3.6.6 (Nov 20 2017)
    42|  * @package Securimage
    43|  *
    44|  */
    45| require_once dirname(__FILE__) . '/securimage.php';
    46| $img = new Securimage();
    47| if (!empty($_GET['namespace'])) $img->setNamespace($_GET['namespace']);
    48| $img->show();  // outputs the image and content headers to the browser

