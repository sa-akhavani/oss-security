# ====================================================================
# FILE: ajax/adblock/update_blocklist.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| if (isset($_POST['blocklist_id'])) {
     7|     $blocklist_id = escapeshellcmd($_POST['blocklist_id']);
     8|     switch ($blocklist_id) {
     9|     case "StevenBlack/hosts \(default\)":
    10|         $list_url = "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts";
    11|         $dest_file = "hostnames.txt";
    12|         break;
    13|     case "badmojr/1Hosts \(Mini\)":
    14|         $list_url = "https://badmojr.github.io/1Hosts/mini/hosts.txt";
    15|         $dest_file = "hostnames.txt";
    16|         break;
    17|     case "badmojr/1Hosts \(Lite\)":
    18|         $list_url = "https://badmojr.github.io/1Hosts/Lite/hosts.txt";
    19|         $dest_file = "hostnames.txt";
    20|         break;
    21|     case "badmojr/1Hosts \(Pro\)":
    22|         $list_url = "https://badmojr.github.io/1Hosts/Pro/hosts.txt";
    23|         $dest_file = "hostnames.txt";
    24|         break;
    25|     case "badmojr/1Hosts \(Xtra\)":


# ====================================================================
# FILE: ajax/bandwidth/get_bandwidth.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-34 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| $interface = filter_input(INPUT_GET, 'inet', FILTER_SANITIZE_SPECIAL_CHARS);
     7| if (empty($interface)) {
     8|     exec("ip -o link show | awk -F ': ' '{print $2}' | grep -v lo ", $interfacesWlo);
     9|     if (count($interfacesWlo) > 0) {
    10|         $interface = $interfacesWlo[0];
    11|     } else {
    12|         exit('No network interfaces found.');
    13|     }
    14| }
    15| define('IFNAMSIZ', 16);
    16| if (strlen($interface) > IFNAMSIZ) {
    17|     exit('Interface name too long.');
    18| } elseif(!preg_match('/^[a-zA-Z0-9]+$/', $interface)) {
    19|     exit('Invalid interface name.');
    20| }
    21| require_once './get_bandwidth_hourly.php';
    22| exec(
    23|     sprintf('vnstat -i %s --json ', escapeshellarg($interface)), $jsonstdoutvnstat,
    24|     $exitcodedaily
    25| );
    26| if ($exitcodedaily !== 0) {
    27|     exit('vnstat error');
    28| }
    29| $jsonobj = json_decode($jsonstdoutvnstat[0], true);
    30| $timeunits = filter_input(INPUT_GET, 'tu');
    31| if ($timeunits === 'm') {
    32|     $jsonData = $jsonobj['interfaces'][0]['traffic']['month'];
    33| } else {
    34|     $jsonData = $jsonobj['interfaces'][0]['traffic']['day'];

# --- HUNK 2: Lines 43-70 ---
    43|     if ($timeunits === 'm') {
    44|         $dt = DateTime::createFromFormat(
    45|             'Y n', $jsonData[$i]['date']['year'].' '.
    46|             $jsonData[$i]['date']['month']
    47|         );
    48|     } else {
    49|         $dt = DateTime::createFromFormat(
    50|             'Y n j', $jsonData[$i]['date']['year'].' '.
    51|                                                       $jsonData[$i]['date']['month'].' '.
    52|             $jsonData[$i]['date']['day']
    53|         );
    54|     }
    55|     if ($firstelm) {
    56|         $firstelm = false;
    57|     } else {
    58|         echo ',';
    59|     }
    60|     $datasend = round($jsonData[$i]['tx'] / $dsu_factor, 0);
    61|     $datareceived = round($jsonData[$i]['rx'] / $dsu_factor, 0);
    62|     if ($timeunits === 'm') {
    63|         echo '{ "date": "' , $dt->format('Y-m') , '", "rx": "' , $datareceived ,
    64|         '", "tx": "' , $datasend , '" }';
    65|     } else {
    66|         echo '{ "date": "' , $dt->format('Y-m-d') , '", "rx": "' , $datareceived ,
    67|         '", "tx": "' , $datasend , '" }';
    68|     }
    69| }
    70| echo ' ]';


# ====================================================================
# FILE: ajax/bandwidth/get_bandwidth_hourly.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| if (filter_input(INPUT_GET, 'tu') == 'h') {
     7|     header('X-Content-Type-Options: nosniff');
     8|     header('Content-Type: application/json');
     9|     $data_template = array(
    10|     0     => array('date' => '00:00', 'rx' => 0, 'tx' => 0),
    11|     1     => array('date' => '01:00', 'rx' => 0, 'tx' => 0),
    12|     2     => array('date' => '02:00', 'rx' => 0, 'tx' => 0),
    13|     3     => array('date' => '03:00', 'rx' => 0, 'tx' => 0),
    14|     4     => array('date' => '04:00', 'rx' => 0, 'tx' => 0),
    15|     5     => array('date' => '05:00', 'rx' => 0, 'tx' => 0),
    16|     6     => array('date' => '06:00', 'rx' => 0, 'tx' => 0),
    17|     7     => array('date' => '07:00', 'rx' => 0, 'tx' => 0),
    18|     8     => array('date' => '08:00', 'rx' => 0, 'tx' => 0),
    19|     9     => array('date' => '09:00', 'rx' => 0, 'tx' => 0),
    20|     10     => array('date' => '10:00', 'rx' => 0, 'tx' => 0),
    21|     11     => array('date' => '11:00', 'rx' => 0, 'tx' => 0),
    22|     12     => array('date' => '12:00', 'rx' => 0, 'tx' => 0),
    23|     13     => array('date' => '13:00', 'rx' => 0, 'tx' => 0),
    24|     14     => array('date' => '14:00', 'rx' => 0, 'tx' => 0),
    25|     15     => array('date' => '15:00', 'rx' => 0, 'tx' => 0),


# ====================================================================
# FILE: ajax/logging/clearlog.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| require_once '../../includes/functions.php';
     7| if (isset($_POST['logfile'])) {
     8|     $logfile = escapeshellarg($_POST['logfile']);
     9|     $valid = '/(\/var\/log|\/tmp)/';
    10|     if (preg_match($valid, $logfile)) {
    11|         exec("sudo truncate -s 0 $logfile", $return);
    12|     } else {
    13|         $return = 1;
    14|     }
    15|     echo json_encode($return);
    16| }


# ====================================================================
# FILE: ajax/networking/do_sys_reset.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| require_once '../../includes/config.php';
     3| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     4| require_once '../../includes/authenticate.php';
     5| require_once '../../includes/session.php';
     6| require_once '../../includes/functions.php';
     7| if (isset($_POST['csrf_token'])) {
     8|     if (csrfValidateRequest() && !CSRFValidate()) {
     9|         handleInvalidCSRFToken();
    10|     }
    11|     $return = 0;
    12|     $path = "../../config";
    13|     $configs = array(
    14|         array("src" => $path .'/hostapd.conf', "tmp" => "/tmp/hostapddata", "dest" => RASPI_HOSTAPD_CONFIG),
    15|         array("src" => $path .'/dhcpcd.conf', "tmp" => "/tmp/dhcpddata", "dest" => RASPI_DHCPCD_CONFIG),
    16|         array("src" => $path .'/090_wlan0.conf', "tmp" => "/tmp/dnsmasqdata", "dest" => RASPI_DNSMASQ_PREFIX.'wlan0.conf'),
    17|         array("src" => $path .'/090_raspap.conf', "tmp" => "/tmp/dnsmasqdata", "dest" => RASPI_DNSMASQ_PREFIX.'raspap.conf'),
    18|     );
    19|     foreach ($configs as $config) {
    20|         try {
    21|             $tmp = file_get_contents($config["src"]);
    22|             file_put_contents($config["tmp"], $tmp);
    23|             system("sudo cp ".$config["tmp"]. " ".$config["dest"]);
    24|         } catch (Exception $e) {


# ====================================================================
# FILE: ajax/networking/get_all_interfaces.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-7 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| exec("ls /sys/class/net | grep -v lo", $interfaces);
     7| echo json_encode($interfaces);


# ====================================================================
# FILE: ajax/networking/get_channel.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| exec('cat '. RASPI_HOSTAPD_CONFIG, $hostapdconfig);
     7| $arrConfig = array();
     8| foreach ($hostapdconfig as $hostapdconfigline) {
     9|     if (strlen($hostapdconfigline) === 0) {
    10|         continue;
    11|     }
    12|     $arrLine = explode("=", $hostapdconfigline);
    13|     $arrConfig[$arrLine[0]]=$arrLine[1];
    14| };
    15| $channel = intval($arrConfig['channel']);
    16| echo json_encode($channel);


# ====================================================================
# FILE: ajax/networking/get_frequencies.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-12 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../src/RaspAP/Parsers/IwParser.php';
     6| require_once '../../includes/authenticate.php';
     7| if (isset($_POST['interface'])) {
     8|     $iface = escapeshellcmd($_POST['interface']);
     9|     $parser = new \RaspAP\Parsers\IwParser($iface);
    10|     $supportedFrequencies = $parser->parseIwInfo($iface);
    11|     echo json_encode($supportedFrequencies);
    12| }


# ====================================================================
# FILE: ajax/networking/get_ip_summary.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/functions.php';
     4| require_once '../../includes/config.php';
     5| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     6| require_once '../../includes/authenticate.php';
     7| if (isset($_POST['interface'])) {
     8|     $int = preg_replace('/[^a-z0-9]/', '', $_POST['interface']);
     9|     exec('ip a s '.$int, $intOutput, $intResult);
    10|     $intOutput = array_map('htmlentities', $intOutput);
    11|     $jsonData = ['return'=>$intResult,'output'=>$intOutput];
    12|     echo json_encode($jsonData);
    13| } else {
    14|     $jsonData = ['return'=>2,'output'=>['Error getting data']];
    15|     echo json_encode($jsonData);
    16| }


# ====================================================================
# FILE: ajax/networking/get_netcfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| $interface = $_POST['iface'];
     7| if (isset($interface)) {
     8|     exec('cat '. escapeshellarg(RASPI_DNSMASQ_PREFIX.$interface.'.conf'), $return);
     9|     $conf = ParseConfig($return);
    10|     $dhcpdata['DHCPEnabled'] = empty($conf) ? false : true;
    11|     if (is_string($conf['dhcp-range'])) {
    12|         $arrRange = explode(",", $conf['dhcp-range']);
    13|     } else {
    14|         $arrRange = explode(",", $conf['dhcp-range'][0]);
    15|     }
    16|     $dhcpdata['RangeStart'] = $arrRange[0];
    17|     $dhcpdata['RangeEnd'] = $arrRange[1];
    18|     $dhcpdata['RangeMask'] = $arrRange[2];
    19|     $dhcpdata['leaseTime'] = $arrRange[3];
    20|     $dhcpHost = $conf["dhcp-host"];
    21|     $dhcpHost = empty($dhcpHost) ? [] : $dhcpHost;
    22|     $dhcpdata['dhcpHost'] = is_array($dhcpHost) ? $dhcpHost : [ $dhcpHost ];
    23|     $upstreamServers = is_array($conf['server']) ? $conf['server'] : [ $conf['server'] ];
    24|     $dhcpdata['upstreamServersEnabled'] = empty($conf['server']) ? false: true;
    25|     $dhcpdata['upstreamServers'] = array_filter($upstreamServers);
    26|     preg_match('/([0-9]*)([a-z])/i', $dhcpdata['leaseTime'], $arrRangeLeaseTime);


# ====================================================================
# FILE: ajax/networking/get_nl80211_band.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| require_once '../../includes/locale.php';
     7| if (isset($_POST['interface'])) {
     8|     define( 'NL80211_BAND_24GHZ', 0x1 );
     9|     define( 'NL80211_BAND_5GHZ', 0x2 );
    10|     if(!preg_match('/^[a-zA-Z0-9]+$/', $_POST['interface'])) {
    11|       exit('Invalid interface name.');
    12|     }
    13|     $iface = escapeshellcmd($_POST['interface']);
    14|     $flags = 0;
    15|     exec("iw dev | awk -v iface=".$iface." '/^phy#/ { phy = $0 } $1 == \"Interface\" { interface = $2 } interface == iface { print phy }'", $return);
    16|     $phy = $return[0];
    17|     exec('iw '.$phy.' info | sed -rn "s/^.*\*\s([0-9]{4})\sMHz.*/\1/p"', $frequencies);
    18|     if (count(preg_grep('/^24[0-9]{2}/i', $frequencies)) >0) {
    19|         $flags += NL80211_BAND_24GHZ;
    20|     }
    21|     if (count(preg_grep('/^5[0-9]{3}/i', $frequencies)) >0) {
    22|         $flags += NL80211_BAND_5GHZ;
    23|     }
    24|     switch ($flags) {
    25|     case NL80211_BAND_24GHZ:
    26|         $msg = sprintf(_("The selected interface (%s) has support for the 2.4 GHz wireless band only."), $iface);
    27|         break;
    28|     case NL80211_BAND_5GHZ:
    29|         $msg = sprintf(_("The selected interface (%s) has support for the 5 GHz wireless band only."), $iface);
    30|         break;
    31|     case NL80211_BAND_24GHZ | NL80211_BAND_5GHZ:
    32|         $msg = sprintf(_("The selected interface (%s) has support for both the 2.4 and 5 GHz wireless bands."), $iface);


# ====================================================================
# FILE: ajax/networking/get_wgcfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-7 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| exec('sudo cat '. RASPI_WIREGUARD_PATH.'client.conf', $return);
     7| echo implode(PHP_EOL,$return);


# ====================================================================
# FILE: ajax/networking/get_wgkey.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-17 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| $entity = escapeshellcmd($_POST['entity']);
     7| if (isset($entity)) {
     8|     $pubkey = RASPI_WIREGUARD_PATH.$entity.'-public.key';
     9|     $privkey = RASPI_WIREGUARD_PATH.$entity.'-private.key';
    10|     $pubkey_tmp = '/tmp/'.$entity.'-public.key';
    11|     $privkey_tmp = '/tmp/'.$entity.'-private.key';
    12|     exec("sudo wg genkey | tee $privkey_tmp | wg pubkey > $pubkey_tmp", $return);
    13|     $wgdata['pubkey'] = str_replace("\n",'',file_get_contents($pubkey_tmp));
    14|     exec("sudo mv $privkey_tmp $privkey", $return);
    15|     exec("sudo mv $pubkey_tmp $pubkey", $return);
    16|     echo json_encode($wgdata);
    17| }


# ====================================================================
# FILE: ajax/networking/wifi_stations.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-20 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| require_once '../../includes/defaults.php';
     7| require_once '../../includes/functions.php';
     8| require_once '../../includes/wifi_functions.php';
     9| $networks = [];
    10| $network  = null;
    11| $ssid     = null;
    12| knownWifiStations($networks);
    13| nearbyWifiStations($networks, !isset($_REQUEST["refresh"]));
    14| connectedWifiStations($networks);
    15| sortNetworksByRSSI($networks);
    16| foreach ($networks as $ssid => $network) $networks[$ssid]["ssidutf8"] = ssid2utf8( $ssid );
    17| $connected = array_filter($networks, function($n) { return $n['connected']; } );
    18| $known     = array_filter($networks, function($n) { return !$n['connected'] && $n['configured']; } );
    19| $nearby    = array_filter($networks, function($n) { return !$n['configured']; } );
    20| echo renderTemplate('wifi_stations', compact('networks', 'connected', 'known', 'nearby'), true);


# ====================================================================
# FILE: ajax/openvpn/activate_ovpncfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| require_once '../../includes/functions.php';
     7| if (isset($_POST['cfg_id'])) {
     8|     $ovpncfg_id = escapeshellcmd($_POST['cfg_id']);
     9|     $ovpncfg_client = RASPI_OPENVPN_CLIENT_PATH.$ovpncfg_id.'_client.conf';
    10|     $ovpncfg_login = RASPI_OPENVPN_CLIENT_PATH.$ovpncfg_id.'_login.conf';
    11|     system("sudo rm ".RASPI_OPENVPN_CLIENT_CONFIG, $return);
    12|     system("sudo ln -s $ovpncfg_client ".RASPI_OPENVPN_CLIENT_CONFIG, $return);
    13|     system("sudo rm ".RASPI_OPENVPN_CLIENT_LOGIN, $return);
    14|     system("sudo ln -s $ovpncfg_login ".RASPI_OPENVPN_CLIENT_LOGIN, $return);
    15|     exec("sudo /bin/systemctl stop openvpn-client@client", $return);
    16|     sleep(1);
    17|     exec("sudo /bin/systemctl enable openvpn-client@client", $return);
    18|     sleep(1);
    19|     exec("sudo /bin/systemctl start openvpn-client@client", $return);
    20|     echo json_encode($return);
    21| }


# ====================================================================
# FILE: ajax/openvpn/del_ovpncfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-13 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| require_once '../../includes/functions.php';
     7| if (isset($_POST['cfg_id'])) {
     8|     $ovpncfg_id = escapeshellcmd($_POST['cfg_id']);
     9|     $ovpncfg_files = pathinfo(RASPI_OPENVPN_CLIENT_LOGIN, PATHINFO_DIRNAME).'/'.$ovpncfg_id.'_*.conf';
    10|     exec("sudo rm $ovpncfg_files", $return);
    11|     $jsonData = ['return'=>$return];
    12|     echo json_encode($jsonData);
    13| }


# ====================================================================
# FILE: ajax/system/sys_actions.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-19 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| $action = escapeshellcmd($_POST['a']);
     7| if (isset($action)) {
     8|     switch($action) {
     9|     case "reboot":
    10|         $response = shell_exec("sudo /sbin/reboot");
    11|         break;
    12|     case "shutdown":
    13|         $response = shell_exec("sudo /sbin/shutdown -h now");
    14|         break;
    15|     default:
    16|         $response = 'Unknown action: '.$action;
    17|     }
    18|     echo json_encode($response);
    19| }


# ====================================================================
# FILE: ajax/system/sys_debug.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| if (isset($_POST['csrf_token'])) {
     7|     if (csrfValidateRequest() && !CSRFValidate()) {
     8|         handleInvalidCSRFToken();
     9|     }
    10|     $root = getenv("DOCUMENT_ROOT");
    11|     exec('sudo '.RASPI_CONFIG.'/system/debuglog.sh -i '.$root, $return);
    12|     $logOutput = implode(PHP_EOL, $return);
    13|     $tempDir = sys_get_temp_dir();
    14|     $filePath = $tempDir . DIRECTORY_SEPARATOR . RASPI_DEBUG_LOG;
    15|     $handle = fopen($filePath, "w");
    16|     fwrite($handle, $logOutput);
    17|     fclose($handle);
    18|     echo json_encode($filePath);
    19| } else {
    20|     handleInvalidCSRFToken();
    21| }


# ====================================================================
# FILE: ajax/system/sys_get_logfile.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-20 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| $tempDir = sys_get_temp_dir();
     7| $filePath = $tempDir . DIRECTORY_SEPARATOR . RASPI_DEBUG_LOG;
     8| if (isset($filePath)) {
     9|     header('Content-Type: application/octet-stream');
    10|     header('Content-Disposition: attachment; filename='.basename($filePath));
    11|     header('Expires: 0');
    12|     header('Cache-Control: must-revalidate');
    13|     header('Pragma: public');
    14|     header('Content-Length: '.filesize($filePath));
    15|     readfile($filePath);
    16|     exit();
    17| } else {
    18|     header('Location: '.'/system_info');
    19|     exit();
    20| }


# ====================================================================
# FILE: ajax/system/sys_perform_update.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-18 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     5| require_once '../../includes/authenticate.php';
     6| if (isset($_POST['csrf_token'])) {
     7|     if (csrfValidateRequest() && !CSRFValidate()) {
     8|         handleInvalidCSRFToken();
     9|     }
    10|     $path = getenv("DOCUMENT_ROOT");
    11|     $opts = " --update --yes --path $path";
    12|     $installer = "sudo /etc/raspap/system/raspbian.sh";
    13|     $execUpdate = $installer.$opts;
    14|     $response = shell_exec($execUpdate);
    15|     echo json_encode($response);
    16| } else {
    17|     handleInvalidCSRFToken();
    18| }


# ====================================================================
# FILE: ajax/system/sys_read_logfile.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| require_once '../../includes/config.php';
     3| require_once '../../src/RaspAP/Auth/HTTPAuth.php';
     4| require_once '../../includes/authenticate.php';
     5| $logFile = '/tmp/raspap_install.log';
     6| $searchStrings = [
     7|     'Configure update' => 1,
     8|     'Updating sources' => 2,
     9|     'Installing required packages' => 3,
    10|     'Cloning latest files' => 4,
    11|     'Installing application' => 5,
    12|     'Installation completed' => 6,
    13|     'error' => 7
    14| ];
    15| usleep(500);
    16| if (file_exists($logFile)) {
    17|     $handle = fopen($logFile, 'r');
    18|     if ($handle) {
    19|         while (($line = fgets($handle)) !== false) {
    20|             foreach ($searchStrings as $searchString => $value) {
    21|                 if (strpos($line, $searchString) !== false) {
    22|                     echo $value .PHP_EOL;
    23|                     flush();
    24|                     ob_flush();


# ====================================================================
# FILE: api/auth.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-18 ---
     1| import os
     2| from fastapi.security.api_key import APIKeyHeader
     3| from fastapi import Security, HTTPException
     4| from starlette.status import HTTP_403_FORBIDDEN
     5| from dotenv import load_dotenv
     6| load_dotenv()
     7| apikey=os.getenv('RASPAP_API_KEY')
     8| if apikey == None:
     9|     apikey = "insecure"
    10| print(apikey)
    11| api_key_header = APIKeyHeader(name="access_token", auto_error=False)
    12| async def get_api_key(api_key_header: str = Security(api_key_header)):
    13|     if api_key_header ==apikey:
    14|         return api_key_header   
    15|     else:
    16|         raise HTTPException(
    17|             status_code=HTTP_403_FORBIDDEN, detail="403: Unauthorized"
    18|         )


# ====================================================================
# FILE: api/main.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-136 ---
     1| from fastapi import FastAPI, Depends
     2| from fastapi.security.api_key import APIKey
     3| import auth
     4| import json
     5| import modules.system as system
     6| import modules.ap as ap
     7| import modules.client as client
     8| import modules.dns as dns
     9| import modules.dhcp as dhcp
    10| import modules.ddns as ddns
    11| import modules.firewall as firewall
    12| import modules.networking as networking
    13| import modules.openvpn as openvpn
    14| import modules.wireguard as wireguard
    15| tags_metadata = [
    16| ]
    17| app = FastAPI(
    18|     title="API for RaspAP",
    19|     openapi_tags=tags_metadata,
    20|     version="0.0.1",
    21|     license_info={
    22|     "name": "Apache 2.0",
    23|     "url": "https://www.apache.org/licenses/LICENSE-2.0.html",
    24|     }
    25| )
    26| @app.get("/system", tags=["system"])
    27| async def get_system(api_key: APIKey = Depends(auth.get_api_key)):
    28|     return{
    29| 'hostname': system.hostname(),
    30| 'uptime': system.uptime(),
    31| 'systime': system.systime(),
    32| 'usedMemory': system.usedMemory(),
    33| 'processorCount': system.processorCount(),
    34| 'LoadAvg1Min': system.LoadAvg1Min(),
    35| 'systemLoadPercentage': system.systemLoadPercentage(),
    36| 'systemTemperature': system.systemTemperature(),
    37| 'hostapdStatus': system.hostapdStatus(),
    38| 'operatingSystem': system.operatingSystem(),
    39| 'kernelVersion': system.kernelVersion(),
    40| 'rpiRevision': system.rpiRevision()
    41| }
    42| @app.get("/ap", tags=["accesspoint/hotspot"])
    43| async def get_ap(api_key: APIKey = Depends(auth.get_api_key)):
    44|     return{
    45| 'driver': ap.driver(),
    46| 'ctrl_interface': ap.ctrl_interface(),
    47| 'ctrl_interface_group': ap.ctrl_interface_group(),
    48| 'auth_algs': ap.auth_algs(),
    49| 'wpa_key_mgmt': ap.wpa_key_mgmt(),
    50| 'beacon_int': ap.beacon_int(),
    51| 'ssid': ap.ssid(),
    52| 'channel': ap.channel(),
    53| 'hw_mode': ap.hw_mode(),
    54| 'ieee80211n': ap.ieee80211n(),
    55| 'wpa_passphrase': ap.wpa_passphrase(),
    56| 'interface': ap.interface(),
    57| 'wpa': ap.wpa(),
    58| 'wpa_pairwise': ap.wpa_pairwise(),
    59| 'country_code': ap.country_code(),
    60| 'ignore_broadcast_ssid': ap.ignore_broadcast_ssid()
    61| }
    62| @app.get("/clients/{wireless_interface}", tags=["Clients"]) 
    63| async def get_clients(wireless_interface, api_key: APIKey = Depends(auth.get_api_key)):
    64|     return{
    65| 'active_clients_amount': client.get_active_clients_amount(wireless_interface),
    66| 'active_clients': json.loads(client.get_active_clients(wireless_interface))
    67| }
    68| @app.get("/dhcp", tags=["DHCP"])
    69| async def get_dhcp(api_key: APIKey = Depends(auth.get_api_key)):
    70|     return{
    71| 'range_start': dhcp.range_start(),
    72| 'range_end': dhcp.range_end(),
    73| 'range_subnet_mask': dhcp.range_subnet_mask(),
    74| 'range_lease_time': dhcp.range_lease_time(),
    75| 'range_gateway': dhcp.range_gateway(),
    76| 'range_nameservers': dhcp.range_nameservers()
    77| }
    78| @app.get("/dns/domains", tags=["DNS"])
    79| async def get_domains(api_key: APIKey = Depends(auth.get_api_key)):
    80|     return{
    81| 'domains': json.loads(dns.adblockdomains())
    82| }
    83| @app.get("/dns/hostnames", tags=["DNS"])
    84| async def get_hostnames(api_key: APIKey = Depends(auth.get_api_key)):
    85|     return{
    86| 'hostnames': json.loads(dns.adblockhostnames())
    87| }
    88| @app.get("/dns/upstream", tags=["DNS"]) 
    89| async def get_upstream(api_key: APIKey = Depends(auth.get_api_key)):
    90|     return{
    91| 'upstream_nameserver': dns.upstream_nameserver()
    92| }
    93| @app.get("/dns/logs", tags=["DNS"]) 
    94| async def get_dnsmasq_logs(api_key: APIKey = Depends(auth.get_api_key)):
    95|     return(dns.dnsmasq_logs())
    96| @app.get("/ddns", tags=["DDNS"]) 
    97| async def get_ddns(api_key: APIKey = Depends(auth.get_api_key)):
    98|     return{
    99| 'use': ddns.use(),
   100| 'method': ddns.method(),
   101| 'protocol': ddns.protocol(),
   102| 'server': ddns.server(),
   103| 'login': ddns.login(),
   104| 'password': ddns.password(),
   105| 'domain': ddns.domain()
   106| }
   107| @app.get("/firewall", tags=["Firewall"]) 
   108| async def get_firewall(api_key: APIKey = Depends(auth.get_api_key)):
   109|     return json.loads(firewall.firewall_rules())
   110| @app.get("/networking", tags=["Networking"]) 
   111| async def get_networking(api_key: APIKey = Depends(auth.get_api_key)):
   112|     return{
   113| 'interfaces': json.loads(networking.interfaces()),
   114| 'throughput': json.loads(networking.throughput())
   115| }
   116| @app.get("/openvpn", tags=["OpenVPN"]) 
   117| async def get_openvpn(api_key: APIKey = Depends(auth.get_api_key)):
   118|     return{
   119| 'client_configs': openvpn.client_configs(),
   120| 'client_config_names': openvpn.client_config_names(),
   121| 'client_config_active': openvpn.client_config_active(),
   122| 'client_login_names': openvpn.client_login_names(),
   123| 'client_login_active': openvpn.client_login_active()
   124| }
   125| @app.get("/openvpn/{config}", tags=["OpenVPN"]) 
   126| async def client_config_list(config, api_key: APIKey = Depends(auth.get_api_key)):
   127|     return{
   128| 'client_config': openvpn.client_config_list(config)
   129| }
   130| @app.get("/wireguard", tags=["WireGuard"]) 
   131| async def get_wireguard(api_key: APIKey = Depends(auth.get_api_key)):
   132|     return{
   133| 'client_configs': wireguard.configs(),
   134| 'client_config_names': wireguard.client_config_names(),
   135| 'client_config_active': wireguard.client_config_active()
   136| }


# ====================================================================
# FILE: api/modules/ap.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-45 ---
     1| import subprocess
     2| import json
     3| def driver():
     4|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep driver= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     5| def ctrl_interface():
     6|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep ctrl_interface= | cut -d'=' -f2 | head -1", shell=True, capture_output=True, text=True).stdout.strip()
     7| def ctrl_interface_group():
     8|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep ctrl_interface_group= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     9| def auth_algs():
    10|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep auth_algs= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    11| def wpa_key_mgmt():
    12|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep wpa_key_mgmt= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    13| def beacon_int():
    14|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep beacon_int= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    15| def ssid():
    16|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep ssid= | cut -d'=' -f2 | head -1", shell=True, capture_output=True, text=True).stdout.strip()
    17| def channel():
    18|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep channel= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    19| def hw_mode():
    20|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep hw_mode= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    21| def ieee80211n():
    22|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep ieee80211n= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    23| def wpa_passphrase():
    24|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep wpa_passphrase= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    25| def interface():
    26|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep interface= | cut -d'=' -f2 | head -1", shell=True, capture_output=True, text=True).stdout.strip()
    27| def wpa():
    28|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep wpa= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    29| def wpa_pairwise():
    30|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep wpa_pairwise= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    31| def country_code():
    32|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep country_code= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    33| def ignore_broadcast_ssid():
    34|     return subprocess.run("cat /etc/hostapd/hostapd.conf | grep ignore_broadcast_ssid= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    35| def logging():
    36|     log_output = subprocess.run(f"cat /tmp/hostapd.log", shell=True, capture_output=True, text=True).stdout.strip()
    37|     logs = {}
    38|     for line in log_output.split('\n'):
    39|         parts = line.split(': ')
    40|         if len(parts) >= 2:
    41|             interface, message = parts[0], parts[1]
    42|             if interface not in logs:
    43|                 logs[interface] = []
    44|             logs[interface].append(message)
    45|     return json.dumps(logs, indent=2)


# ====================================================================
# FILE: api/modules/client.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-30 ---
     1| import subprocess
     2| import json
     3| def get_active_clients_amount(interface):
     4|     arp_output = subprocess.run(['arp', '-i', interface], capture_output=True, text=True)
     5|     mac_addresses = arp_output.stdout.splitlines()
     6|     if mac_addresses:
     7|         grep_pattern = '|'.join(mac_addresses)
     8|         output = subprocess.run(['grep', '-iwE', grep_pattern, '/var/lib/misc/dnsmasq.leases'], capture_output=True, text=True)
     9|         return len(output.stdout.splitlines())
    10|     else:
    11|         return 0
    12| def get_active_clients(interface):
    13|     arp_output = subprocess.run(['arp', '-i', interface], capture_output=True, text=True)
    14|     arp_mac_addresses = set(line.split()[2] for line in arp_output.stdout.splitlines()[1:])
    15|     dnsmasq_output = subprocess.run(['cat', '/var/lib/misc/dnsmasq.leases'], capture_output=True, text=True)
    16|     active_clients = []
    17|     for line in dnsmasq_output.stdout.splitlines():
    18|         fields = line.split()
    19|         mac_address = fields[1]
    20|         if mac_address in arp_mac_addresses:
    21|             client_data = {
    22|                 "timestamp": int(fields[0]),
    23|                 "mac_address": fields[1],
    24|                 "ip_address": fields[2],
    25|                 "hostname": fields[3],
    26|                 "client_id": fields[4],
    27|             }
    28|             active_clients.append(client_data)
    29|     json_output = json.dumps(active_clients, indent=2)
    30|     return json_output


# ====================================================================
# FILE: api/modules/ddns.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| import subprocess
     2| def use():
     3|     return subprocess.run("cat /etc/ddclient.conf | grep use= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     4| def method():
     5|     return subprocess.run("awk '/^use=/ {getline; print}' /etc/ddclient.conf | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     6| def protocol():
     7|     return subprocess.run("cat /etc/ddclient.conf | grep protocol= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     8| def server():
     9|     return subprocess.run("cat /etc/ddclient.conf | grep server= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    10| def login():
    11|     return subprocess.run("cat /etc/ddclient.conf | grep login= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    12| def password():
    13|     return subprocess.run("cat /etc/ddclient.conf | grep password= | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    14| def domain():
    15|     return subprocess.run("awk '/^password=/ {getline; print}' /etc/ddclient.conf", shell=True, capture_output=True, text=True).stdout.strip()


# ====================================================================
# FILE: api/modules/dhcp.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| import subprocess
     2| import json
     3| def range_start():
     4|     return subprocess.run("cat /etc/dnsmasq.d/090_wlan0.conf |grep dhcp-range= |cut -d'=' -f2| cut -d',' -f1", shell=True, capture_output=True, text=True).stdout.strip()
     5| def range_end():
     6|     return subprocess.run("cat /etc/dnsmasq.d/090_wlan0.conf |grep dhcp-range= |cut -d'=' -f2| cut -d',' -f2", shell=True, capture_output=True, text=True).stdout.strip()
     7| def range_subnet_mask():
     8|     return subprocess.run("cat /etc/dnsmasq.d/090_wlan0.conf |grep dhcp-range= |cut -d'=' -f2| cut -d',' -f3", shell=True, capture_output=True, text=True).stdout.strip()
     9| def range_lease_time():
    10|     return subprocess.run("cat /etc/dnsmasq.d/090_wlan0.conf |grep dhcp-range= |cut -d'=' -f2| cut -d',' -f4", shell=True, capture_output=True, text=True).stdout.strip()
    11| def range_gateway():
    12|     return subprocess.run("cat /etc/dhcpcd.conf | grep routers | cut -d'=' -f2", shell=True, capture_output=True, text=True).stdout.strip()
    13| def range_nameservers():
    14|     output = subprocess.run("cat /etc/dhcpcd.conf", shell=True, capture_output=True, text=True).stdout.strip()
    15|     nameservers = []
    16|     lines = output.split('\n')
    17|     for line in lines:
    18|         if "static domain_name_server" in line:
    19|             servers = line.split('=')[1].strip().split()
    20|             nameservers.extend(servers)
    21|     return nameservers


# ====================================================================
# FILE: api/modules/dns.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-34 ---
     1| import subprocess
     2| import json
     3| def adblockdomains():
     4|     output = subprocess.run("cat /etc/raspap/adblock/domains.txt", shell=True, capture_output=True, text=True).stdout.strip()
     5|     domains =output.split('\n')
     6|     domainlist=[]
     7|     for domain in domains:
     8|         if domain.startswith('#') or domain=="":
     9|             continue
    10|         domainlist.append(domain.split('=/')[1])
    11|     return domainlist
    12| def adblockhostnames():
    13|     output = subprocess.run("cat /etc/raspap/adblock/hostnames.txt", shell=True, capture_output=True, text=True).stdout.strip()
    14|     hostnames = output.split('\n')
    15|     hostnamelist=[]
    16|     for hostname in hostnames:
    17|         if hostname.startswith('#') or hostname=="":
    18|             continue
    19|         hostnamelist.append(hostname.replace('0.0.0.0 ',''))
    20|     return hostnamelist
    21| def upstream_nameserver():
    22|     return subprocess.run("awk '/nameserver/ {print $2}' /run/dnsmasq/resolv.conf", shell=True, capture_output=True, text=True).stdout.strip()
    23| def dnsmasq_logs():
    24|     output = subprocess.run("cat /var/log/dnsmasq.log", shell=True, capture_output=True, text=True).stdout.strip()
    25|     log_entries = []
    26|     for line in output.split("\n"):
    27|         fields = line.split(" ")
    28|         log_dict = {
    29|                 'timestamp': ' '.join(fields[:3]),
    30|                 'process': fields[3][:-1],  # Remove the trailing colon
    31|                 'message': ' '.join(fields[4:]),
    32|             }
    33|         log_entries.append(log_dict)
    34|     return log_entries


# ====================================================================
# FILE: api/modules/firewall.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-3 ---
     1| import subprocess
     2| def firewall_rules():
     3|     return subprocess.run("cat /etc/raspap/networking/firewall/iptables_rules.json", shell=True, capture_output=True, text=True).stdout.strip()


# ====================================================================
# FILE: api/modules/networking.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-45 ---
     1| import psutil
     2| import json
     3| def throughput():
     4|     interface_info = {}
     5|     interfaces = psutil.net_if_stats()
     6|     for interface, stats in interfaces.items():
     7|         if interface.startswith("lo") or interface.startswith("docker"):
     8|             continue
     9|         try:
    10|             traffic_stats = psutil.net_io_counters(pernic=True)[interface]
    11|             rx_packets = traffic_stats[1]
    12|             rx_bytes = traffic_stats[0]
    13|             tx_packets = traffic_stats[3]
    14|             tx_bytes = traffic_stats[4]
    15|             interface_info[interface] = {
    16|                 "RX_packets": rx_packets,
    17|                 "RX_bytes": rx_bytes,
    18|                 "TX_packets": tx_packets,
    19|                 "TX_bytes": tx_bytes
    20|             }
    21|         except KeyError:
    22|             pass
    23|     return json.dumps(interface_info, indent=2)
    24| def interfaces():
    25|     interface_info = {}
    26|     interfaces = psutil.net_if_addrs()
    27|     for interface, addrs in interfaces.items():
    28|         if interface.startswith("lo") or interface.startswith("docker"):
    29|             continue
    30|         ip_address = None
    31|         netmask = None
    32|         mac_address = None
    33|         for addr in addrs:
    34|             if addr.family == 2:  # AF_INET corresponds to the integer value 2
    35|                 ip_address = addr.address
    36|                 netmask = addr.netmask
    37|         for addr in psutil.net_if_addrs().get(interface, []):
    38|             if addr.family == psutil.AF_LINK:
    39|                 mac_address = addr.address
    40|         interface_info[interface] = {
    41|             "IP_address": ip_address,
    42|             "Netmask": netmask,
    43|             "MAC_address": mac_address
    44|         }
    45|     return json.dumps(interface_info, indent=2)


# ====================================================================
# FILE: api/modules/openvpn.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| import subprocess
     2| def client_configs():
     3|     return subprocess.run("find /etc/openvpn/client/ -type f | wc -l", shell=True, capture_output=True, text=True).stdout.strip()
     4| def client_config_names():
     5|     config_names_list = []
     6|     output = subprocess.run('''ls /etc/openvpn/client/ | grep -v "^client.conf$"''', shell=True, capture_output=True, text=True).stdout.strip()
     7|     lines = output.split("\n")
     8|     for client in lines:
     9|         if "_client" in client:
    10|             config_names_dict ={'config':client}
    11|             config_names_list.append(config_names_dict)
    12|     return config_names_list
    13| def client_login_names():
    14|     config_names_list = []
    15|     output = subprocess.run('''ls /etc/openvpn/client/ | grep -v "^client.conf$"''', shell=True, capture_output=True, text=True).stdout.strip()
    16|     lines = output.split("\n")
    17|     for client in lines:
    18|         if "_login" in client:
    19|             config_names_dict ={'login':client}
    20|             config_names_list.append(config_names_dict)
    21|     return config_names_list
    22| def client_config_active():
    23|     output = subprocess.run('''ls -al  /etc/openvpn/client/ | grep "client.conf -"''', shell=True, capture_output=True, text=True).stdout.strip()
    24|     active_config = output.split("/etc/openvpn/client/")
    25|     return(active_config[1])
    26| def client_login_active():
    27|     output = subprocess.run('''ls -al  /etc/openvpn/client/ | grep "login.conf -"''', shell=True, capture_output=True, text=True).stdout.strip()
    28|     active_config = output.split("/etc/openvpn/client/")
    29|     return(active_config[1])
    30| def client_config_list(client_config):
    31|     output = subprocess.run(["cat", f"/etc/openvpn/client/{client_config}"], capture_output=True, text=True).stdout.strip()
    32|     return output.split('\n')


# ====================================================================
# FILE: api/modules/system.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-73 ---
     1| import subprocess
     2| revisions = {
     3|     '0002': 'Model B Revision 1.0',
     4|     '0003': 'Model B Revision 1.0 + ECN0001',
     5|     '0004': 'Model B Revision 2.0 (256 MB)',
     6|     '0005': 'Model B Revision 2.0 (256 MB)',
     7|     '0006': 'Model B Revision 2.0 (256 MB)',
     8|     '0007': 'Model A',
     9|     '0008': 'Model A',
    10|     '0009': 'Model A',
    11|     '000d': 'Model B Revision 2.0 (512 MB)',
    12|     '000e': 'Model B Revision 2.0 (512 MB)',
    13|     '000f': 'Model B Revision 2.0 (512 MB)',
    14|     '0010': 'Model B+',
    15|     '0013': 'Model B+',
    16|     '0011': 'Compute Module',
    17|     '0012': 'Model A+',
    18|     'a01041': 'a01041',
    19|     'a21041': 'a21041',
    20|     '900092': 'PiZero 1.2',
    21|     '900093': 'PiZero 1.3',
    22|     '9000c1': 'PiZero W',
    23|     'a02082': 'Pi 3 Model B',
    24|     'a22082': 'Pi 3 Model B',
    25|     'a32082': 'Pi 3 Model B',
    26|     'a52082': 'Pi 3 Model B',
    27|     'a020d3': 'Pi 3 Model B+',
    28|     'a220a0': 'Compute Module 3',
    29|     'a020a0': 'Compute Module 3',
    30|     'a02100': 'Compute Module 3+',
    31|     'a03111': 'Model 4B Revision 1.1 (1 GB)',
    32|     'b03111': 'Model 4B Revision 1.1 (2 GB)',
    33|     'c03111': 'Model 4B Revision 1.1 (4 GB)',
    34|     'c03111': 'Model 4B Revision 1.1 (4 GB)',
    35|     'a03140': 'Compute Module 4 (1 GB)',
    36|     'b03140': 'Compute Module 4 (2 GB)',
    37|     'c03140': 'Compute Module 4 (4 GB)',
    38|     'd03140': 'Compute Module 4 (8 GB)',
    39|     'c04170': 'Pi 5 (4 GB)',
    40|     'd04170': 'Pi 5 (8 GB)'
    41| }
    42| def hostname():
    43|     return subprocess.run("hostname", shell=True, capture_output=True, text=True).stdout.strip()
    44| def uptime():
    45|     return subprocess.run("uptime -p", shell=True, capture_output=True, text=True).stdout.strip()
    46| def systime():
    47|     return subprocess.run("date", shell=True, capture_output=True, text=True).stdout.strip()
    48| def usedMemory():
    49|     return round(float(subprocess.run("free -m | awk 'NR==2{total=$2 ; used=$3 } END { print used/total*100}'", shell=True, capture_output=True, text=True).stdout.strip()),2)
    50| def processorCount():
    51|     return int(subprocess.run("nproc --all", shell=True, capture_output=True, text=True).stdout.strip())
    52| def LoadAvg1Min():
    53|     return round(float(subprocess.run("awk '{print $1}' /proc/loadavg", shell=True, capture_output=True, text=True).stdout.strip()),2)
    54| def systemLoadPercentage():
    55|     return round((float(LoadAvg1Min())*100)/float(processorCount()),2)
    56| def systemTemperature():
    57|     try:
    58|         output = subprocess.run("cat /sys/class/thermal/thermal_zone0/temp", shell=True, capture_output=True, text=True).stdout.strip()
    59|         return round(float(output)/1000,2)
    60|     except ValueError:
    61|         return 0
    62| def hostapdStatus():
    63|     return int(subprocess.run("pidof hostapd | wc -l", shell=True, capture_output=True, text=True).stdout.strip())
    64| def operatingSystem():
    65|     return subprocess.run('''grep PRETTY_NAME /etc/os-release | cut -d= -f2- | sed 's/"//g' ''', shell=True, capture_output=True, text=True).stdout.strip()
    66| def kernelVersion():
    67|     return subprocess.run("uname -r", shell=True, capture_output=True, text=True).stdout.strip()
    68| def rpiRevision():
    69|     output = subprocess.run("grep Revision /proc/cpuinfo | awk '{print $3}'", shell=True, capture_output=True, text=True).stdout.strip()
    70|     try:
    71|         return revisions[output]
    72|     except KeyError:
    73|         return 'Unknown Device'


# ====================================================================
# FILE: api/modules/wireguard.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| import subprocess
     2| import re
     3| def configs():
     4|     return subprocess.run("find /etc/wireguard/ -type f | wc -l", shell=True, capture_output=True, text=True).stdout.strip()
     5| def client_config_names():
     6|     config_names_list = []
     7|     output = subprocess.run('''ls /etc/wireguard/ | grep -v "^wg0.conf$"''', shell=True, capture_output=True, text=True).stdout.strip()
     8|     lines = output.split("\n")
     9|     for client in lines:
    10|         config_names_dict ={'config':client}
    11|         config_names_list.append(config_names_dict)
    12|     return config_names_list
    13| def client_config_active():
    14|     output = subprocess.run('''ls -al  /etc/wireguard/ | grep "wg0.conf -"''', shell=True, capture_output=True, text=True).stdout.strip()
    15|     active_config = output.split("/etc/wireguard/")
    16|     return(active_config[1])


# ====================================================================
# FILE: app/js/custom.js
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 85-127 ---
    85| });
    86| /**
    87|  * mark a form field, e.g. a select box, with the class `.js-field-preset`
    88|  * and give it an attribute `data-field-preset-target` with a text field's
    89|  * css selector.
    90|  *
    91|  * now, if the element marked `.js-field-preset` receives a `change` event,
    92|  * its value will be copied to all elements matching the selector in
    93|  * data-field-preset-target.
    94|  */
    95| $(document).on("change", ".js-field-preset", function(e) {
    96|     var selector = this.getAttribute("data-field-preset-target")
    97|     var value = "" + this.value
    98|     var syncValue = function(el) { el.value = value }
    99|     if (value.trim() === "") { return }
   100|     document.querySelectorAll(selector).forEach(syncValue)
   101| });
   102| $(document).on("click", "#gen_wpa_passphrase", function(e) {
   103|     $('#txtwpapassphrase').val(genPassword(63));
   104| });
   105| $(document).on("click", "#gen_apikey", function(e) {
   106|     $('#txtapikey').val(genPassword(32).toLowerCase());
   107| });
   108| $(document).on("click", "#js-clearhostapd-log", function(e) {
   109|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   110|     $.post('ajax/logging/clearlog.php?',{'logfile':'/tmp/hostapd.log', 'csrf_token': csrfToken},function(data){
   111|         jsonData = JSON.parse(data);
   112|         $("#hostapd-log").val("");
   113|     });
   114| });
   115| $(document).on("click", "#js-cleardnsmasq-log", function(e) {
   116|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   117|     $.post('ajax/logging/clearlog.php?',{'logfile':'/var/log/dnsmasq.log', 'csrf_token': csrfToken},function(data){
   118|         jsonData = JSON.parse(data);
   119|         $("#dnsmasq-log").val("");
   120|     });
   121| });
   122| $(document).on("click", "#js-clearopenvpn-log", function(e) {
   123|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   124|     $.post('ajax/logging/clearlog.php?',{'logfile':'/tmp/openvpn.log', 'csrf_token': csrfToken},function(data){
   125|         jsonData = JSON.parse(data);
   126|         $("#openvpn-log").val("");
   127|     });

# --- HUNK 2: Lines 167-208 ---
   167|         break;
   168|     }
   169| }
   170| function loadWifiStations(refresh) {
   171|     return function() {
   172|         var complete = function() { $(this).removeClass('loading-spinner'); }
   173|         var qs = refresh === true ? '?refresh' : '';
   174|         $('.js-wifi-stations')
   175|             .addClass('loading-spinner')
   176|             .empty()
   177|             .load('ajax/networking/wifi_stations.php'+qs, complete);
   178|     };
   179| }
   180| $(".js-reload-wifi-stations").on("click", loadWifiStations(true));
   181| /*
   182| Populates the DHCP server form fields
   183| Option toggles are set dynamically depending on the loaded configuration
   184| */
   185| function loadInterfaceDHCPSelect() {
   186|     var strInterface = $('#cbxdhcpiface').val();
   187|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   188|     $.post('ajax/networking/get_netcfg.php', {'iface' : strInterface, 'csrf_token': csrfToken}, function(data){
   189|         jsonData = JSON.parse(data);
   190|         $('#dhcp-iface')[0].checked = jsonData.DHCPEnabled;
   191|         $('#txtipaddress').val(jsonData.StaticIP);
   192|         $('#txtsubnetmask').val(jsonData.SubnetMask);
   193|         $('#txtgateway').val(jsonData.StaticRouters);
   194|         $('#chkfallback')[0].checked = jsonData.FallbackEnabled;
   195|         $('#default-route').prop('checked', jsonData.DefaultRoute);
   196|         if (strInterface.startsWith("wl")) {
   197|             $('#nohook-wpa-supplicant').parent().parent().parent().show()
   198|             $('#nohook-wpa-supplicant').prop('checked', jsonData.NoHookWPASupplicant);
   199|         } else {
   200|             $('#nohook-wpa-supplicant').parent().parent().parent().hide()
   201|         }
   202|         $('#txtrangestart').val(jsonData.RangeStart);
   203|         $('#txtrangeend').val(jsonData.RangeEnd);
   204|         $('#txtrangeleasetime').val(jsonData.leaseTime);
   205|         $('#txtdns1').val(jsonData.DNS1);
   206|         $('#txtdns2').val(jsonData.DNS2);
   207|         $('#cbxrangeleasetimeunits').val(jsonData.leaseTimeInterval);
   208|         $('#no-resolv')[0].checked = jsonData.upstreamServersEnabled;


# ====================================================================
# FILE: config/config.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| define('RASPI_BRAND_TEXT', 'RaspAP');
     3| define('RASPI_CONFIG', '/etc/raspap');
     4| define('RASPI_CONFIG_NETWORK', RASPI_CONFIG.'/networking/defaults.json');
     5| define('RASPI_CONFIG_PROVIDERS', 'config/vpn-providers.json');
     6| define('RASPI_CONFIG_API', RASPI_CONFIG.'/api');
     7| define('RASPI_ADMIN_DETAILS', RASPI_CONFIG.'/raspap.auth');
     8| define('RASPI_WIFI_AP_INTERFACE', 'wlan0');
     9| define('RASPI_CACHE_PATH', sys_get_temp_dir() . '/raspap');
    10| define('RASPI_ERROR_LOG', sys_get_temp_dir() . '/raspap_error.log');
    11| define('RASPI_DEBUG_LOG', 'raspap_debug.log');
    12| define('RASPI_LOG_SIZE_LIMIT', 64);
    13| define('RASPI_DNSMASQ_LEASES', '/var/lib/misc/dnsmasq.leases');
    14| define('RASPI_DNSMASQ_PREFIX', '/etc/dnsmasq.d/090_');
    15| define('RASPI_ADBLOCK_LISTPATH', '/etc/raspap/adblock/');
    16| define('RASPI_ADBLOCK_CONFIG', RASPI_DNSMASQ_PREFIX.'adblock.conf');
    17| define('RASPI_HOSTAPD_CONFIG', '/etc/hostapd/hostapd.conf');
    18| define('RASPI_DHCPCD_CONFIG', '/etc/dhcpcd.conf');
    19| define('RASPI_DHCPCD_LOG', '/var/log/dnsmasq.log');
    20| define('RASPI_HOSTAPD_LOG', '/tmp/hostapd.log');
    21| define('RASPI_WPA_SUPPLICANT_CONFIG', '/etc/wpa_supplicant/wpa_supplicant.conf');
    22| define('RASPI_HOSTAPD_CTRL_INTERFACE', '/var/run/hostapd');
    23| define('RASPI_WPA_CTRL_INTERFACE', '/var/run/wpa_supplicant');
    24| define('RASPI_OPENVPN_CLIENT_PATH', '/etc/openvpn/client/');
    25| define('RASPI_OPENVPN_CLIENT_CONFIG', '/etc/openvpn/client/client.conf');
    26| define('RASPI_OPENVPN_CLIENT_LOGIN', '/etc/openvpn/client/login.conf');

# --- HUNK 2: Lines 31-53 ---
    31| define('RASPI_ACCESS_CHECK_IP', '1.1.1.1');
    32| define('RASPI_ACCESS_CHECK_DNS', 'one.one.one.one');
    33| define('RASPI_API_ENDPOINT', 'https://api.github.com/repos/RaspAP/raspap-webgui/releases/latest');
    34| define("RASPI_5GHZ_CHANNEL_MIN", 100);
    35| define("RASPI_5GHZ_CHANNEL_MAX", 192);
    36| define('RASPI_AUTH_ENABLED', true);
    37| define('RASPI_WIFICLIENT_ENABLED', true);
    38| define('RASPI_HOTSPOT_ENABLED', true);
    39| define('RASPI_NETWORK_ENABLED', true);
    40| define('RASPI_DHCP_ENABLED', true);
    41| define('RASPI_ADBLOCK_ENABLED', false);
    42| define('RASPI_OPENVPN_ENABLED', false);
    43| define('RASPI_VPN_PROVIDER_ENABLED', false);
    44| define('RASPI_WIREGUARD_ENABLED', false);
    45| define('RASPI_TORPROXY_ENABLED', false);
    46| define('RASPI_CONFAUTH_ENABLED', true);
    47| define('RASPI_CHANGETHEME_ENABLED', true);
    48| define('RASPI_VNSTAT_ENABLED', true);
    49| define('RASPI_SYSTEM_ENABLED', true);
    50| define('RASPI_MONITOR_ENABLED', false);
    51| define('RASPI_RESTAPI_ENABLED', false);
    52| define('LOCALE_ROOT', 'locale');
    53| define('LOCALE_DOMAIN', 'messages');


# ====================================================================
# FILE: includes/defaults.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-30 ---
     1| <?php
     2| if (!defined('RASPI_CONFIG')) {
     3|     define('RASPI_CONFIG', '/etc/raspap');
     4| }
     5| $defaults = [
     6|   'RASPI_BRAND_TEXT' => 'RaspAP',
     7|   'RASPI_VERSION' => '3.1.0',
     8|   'RASPI_CONFIG_NETWORK' => RASPI_CONFIG.'/networking/defaults.json',
     9|   'RASPI_CONFIG_PROVIDERS' => 'config/vpn-providers.json',
    10|   'RASPI_CONFIG_API' => RASPI_CONFIG.'/api',
    11|   'RASPI_ADMIN_DETAILS' => RASPI_CONFIG.'/raspap.auth',
    12|   'RASPI_WIFI_AP_INTERFACE' => 'wlan0',
    13|   'RASPI_CACHE_PATH' => sys_get_temp_dir() . '/raspap',
    14|   'RASPI_ERROR_LOG' => sys_get_temp_dir() . '/raspap_error.log',
    15|   'RASPI_DEBUG_LOG' => 'raspap_debug.log',
    16|   'RASPI_LOG_SIZE_LIMIT' =>  64,
    17|   'RASPI_DNSMASQ_LEASES' => '/var/lib/misc/dnsmasq.leases',
    18|   'RASPI_DNSMASQ_PREFIX' => '/etc/dnsmasq.d/090_',
    19|   'RASPI_ADBLOCK_LISTPATH' => '/etc/raspap/adblock/',
    20|   'RASPI_ADBLOCK_CONFIG' =>  RASPI_DNSMASQ_PREFIX.'adblock.conf',
    21|   'RASPI_HOSTAPD_CONFIG' => '/etc/hostapd/hostapd.conf',
    22|   'RASPI_DHCPCD_CONFIG' => '/etc/dhcpcd.conf',
    23|   'RASPI_DHCPCD_LOG' => '/var/log/dnsmasq.log',
    24|   'RASPI_HOSTAPD_LOG' => '/tmp/hostapd.log',
    25|   'RASPI_WPA_SUPPLICANT_CONFIG' => '/etc/wpa_supplicant/wpa_supplicant.conf',
    26|   'RASPI_HOSTAPD_CTRL_INTERFACE' => '/var/run/hostapd',
    27|   'RASPI_WPA_CTRL_INTERFACE' => '/var/run/wpa_supplicant',
    28|   'RASPI_OPENVPN_CLIENT_PATH' => '/etc/openvpn/client/',
    29|   'RASPI_OPENVPN_CLIENT_CONFIG' => '/etc/openvpn/client/client.conf',
    30|   'RASPI_OPENVPN_CLIENT_LOGIN' => '/etc/openvpn/client/login.conf',


# ====================================================================
# FILE: includes/page_actions.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 27-56 ---
    27|             DisplayWireGuardConfig();
    28|             break;
    29|         case "/provider_conf":
    30|             DisplayProviderConfig();
    31|             break;
    32|         case "/torproxy_conf":
    33|             DisplayTorProxyConfig();
    34|             break;
    35|         case "/auth_conf":
    36|             DisplayAuthConfig($_SESSION['user_id']);
    37|             break;
    38|         case "/save_hostapd_conf":
    39|             SaveTORAndVPNConfig();
    40|             break;
    41|         case "/data_use":
    42|             DisplayDataUsage($extraFooterScripts);
    43|             break;
    44|         case "/system_info":
    45|             DisplaySystem($extraFooterScripts);
    46|             break;
    47|         case "/restapi_conf":
    48|             DisplayRestAPI();
    49|             break;
    50|         case "/about":
    51|             DisplayAbout();
    52|             break;
    53|         default:
    54|             DisplayDashboard($extraFooterScripts);
    55|         }
    56|       ?>


# ====================================================================
# FILE: includes/provider.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 19-59 ---
    19|         $status->addMessage(sprintf(_('Expected %s binary not found at: %s'), $providerName, $binPath), 'warning');
    20|         $status->addMessage(sprintf(_('Visit the <a href="%s" target="_blank">installation instructions</a> for %s\'s Linux CLI.'), $installPage, $providerName), 'warning');
    21|         $ctlState = 'disabled';
    22|         $providerVersion = 'not found';
    23|     } elseif (empty($providerVersion)) {
    24|         $status->addMessage(sprintf(_('Unable to execute %s binary found at: %s'), $providerName, $binPath), 'warning');
    25|         $status->addMessage(_('Check that binary is executable and permissions exist in raspap.sudoers'), 'warning');
    26|         $ctlState = 'disabled';
    27|         $providerVersion = 'not found';
    28|     } else {
    29|         $serviceStatus = getProviderStatus($id, $binPath);
    30|         $statusDisplay = $serviceStatus == "down" ? "inactive" : "active";
    31|         $providerLog = getProviderLog($id, $binPath, $country);
    32|         $accountInfo = getAccountInfo($id, $binPath, $providerName);
    33|         $accountLink = getProviderValue($id, "account_page");
    34|         $countries = getCountries($id, $binPath);
    35|     }
    36|     if (!RASPI_MONITOR_ENABLED) {
    37|         if (isset($_POST['SaveProviderSettings'])) {
    38|             if (isset($_POST['country'])) {
    39|                 $country = escapeshellarg(trim($_POST['country']));
    40|                 if (strlen($country) == 0) {
    41|                     $status->addMessage('Select a country from the server location list', 'danger');
    42|                 } else {
    43|                     $return = saveProviderConfig($status, $binPath, $country, $id);
    44|                 }
    45|             }
    46|         } elseif (isset($_POST['StartProviderVPN'])) {
    47|             $status->addMessage('Attempting to connect VPN provider', 'info');
    48|             $cmd = getCliOverride($id, 'cmd_overrides', 'connect');
    49|             exec("sudo $binPath $cmd", $return);
    50|             $return = stripArtifacts($return);
    51|             foreach ($return as $line) {
    52|                 if (strlen(trim($line)) > 0) {
    53|                     $line = preg_replace('/\e\[\?[0-9]*l\s(.*)\e.*$/', '$1', $line);
    54|                     $line = preg_replace('/\e\[0m\e\[[0-9;]*m(.*)/', '$1', $line);
    55|                     $status->addMessage($line, 'info');
    56|                 }
    57|             }
    58|         } elseif (isset($_POST['StopProviderVPN'])) {
    59|             $status->addMessage('Attempting to disconnect VPN provider', 'info');


# ====================================================================
# FILE: includes/restapi.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-79 ---
     1| <?php
     2| require_once 'includes/functions.php';
     3| require_once 'config.php';
     4| /**
     5|  * Handler for RestAPI settings
     6|  */
     7| function DisplayRestAPI()
     8| {
     9|     $status = new \RaspAP\Messages\StatusMessage;
    10|     $dotenv = new \RaspAP\DotEnv\DotEnv;
    11|     $dotenv->load();
    12|     $apiKey = $_ENV['RASPAP_API_KEY'];
    13|     if (!RASPI_MONITOR_ENABLED) {
    14|         if (isset($_POST['SaveAPIsettings'])) {
    15|             if (isset($_POST['txtapikey'])) {
    16|                 $apiKey = trim($_POST['txtapikey']);
    17|                 if (strlen($apiKey) == 0) {
    18|                     $status->addMessage('Please enter a valid API key', 'danger');
    19|                 } else {
    20|                     $return = saveAPISettings($status, $apiKey, $dotenv);
    21|                     $status->addMessage('Restarting restapi.service', 'info');
    22|                     exec('sudo /bin/systemctl stop restapi.service', $return);
    23|                     sleep(1);
    24|                     exec('sudo /bin/systemctl start restapi.service', $return);
    25|                 }
    26|             }
    27|         } elseif (isset($_POST['StartRestAPIservice'])) {
    28|             $status->addMessage('Attempting to start restapi.service', 'info');
    29|             exec('sudo /bin/systemctl start restapi.service', $return);
    30|             foreach ($return as $line) {
    31|                 $status->addMessage($line, 'info');
    32|             }
    33|         } elseif (isset($_POST['StopRestAPIservice'])) {
    34|             $status->addMessage('Attempting to stop restapi.service', 'info');
    35|             exec('sudo /bin/systemctl stop restapi.service', $return);
    36|             foreach ($return as $line) {
    37|                 $status->addMessage($line, 'info');
    38|             }
    39|         }
    40|     }
    41|     exec("ps aux | grep -v grep | grep uvicorn", $output, $return);
    42|     $serviceStatus = !empty($output) ? "up" : "down";
    43|     exec("sudo systemctl status restapi.service", $output, $return);
    44|     array_shift($output);
    45|     $serviceLog = implode("\n", $output);
    46|     if ($serviceStatus == "up") {
    47|         $docUrl = getDocUrl();
    48|         $faicon = "<i class=\"text-gray-500 fas fa-external-link-alt ml-1\"></i>"; 
    49|         $docMsg = sprintf(_("RestAPI docs are accessible <a href=\"%s\" target=\"_blank\">here%s</a>"),$docUrl, $faicon);
    50|     }
    51|     echo renderTemplate("restapi", compact(
    52|         "status",
    53|         "apiKey",
    54|         "serviceStatus",
    55|         "serviceLog",
    56|         "docMsg"
    57|     ));
    58| }
    59| /**
    60|  * Saves RestAPI settings
    61|  *
    62|  * @param object status
    63|  * @param object dotenv
    64|  * @param string $apiKey
    65|  */
    66| function saveAPISettings($status, $apiKey, $dotenv)
    67| {
    68|     $status->addMessage('Saving API key', 'info');
    69|     $dotenv->set('RASPAP_API_KEY', $apiKey);
    70|     return $status;
    71| }
    72| function getDocUrl()
    73| {
    74|     $protocol = isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? 'https://' : 'http://';
    75|     $server_name = $_SERVER['SERVER_NAME'];
    76|     $port = 8081;
    77|     $url = $protocol . $server_name .':'. $port . '/docs';
    78|     return $url;
    79| }


# ====================================================================
# FILE: includes/sidebar.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 63-102 ---
    63|         <?php if (RASPI_VPN_PROVIDER_ENABLED) : ?>
    64|         <li class="nav-item">
    65|           <a class="nav-link" href="provider_conf"><i class="fas fa-shield-alt fa-fw mr-2"></i><span class="nav-label"><?php echo _(getProviderValue($_SESSION["providerID"], "name")); ?></a>
    66|         </li>
    67|         <?php endif; ?>
    68|         <?php if (RASPI_TORPROXY_ENABLED) : ?>
    69|         <li class="nav-item">
    70|            <a class="nav-link" href="torproxy_conf"><i class="fas fa-eye-slash fa-fw mr-2"></i><span class="nav-label"><?php echo _("TOR proxy"); ?></a>
    71|         </li>
    72|         <?php endif; ?>
    73|         <?php if (RASPI_CONFAUTH_ENABLED) : ?>
    74|         <li class="nav-item">
    75|           <a class="nav-link" href="auth_conf"><i class="fas fa-user-lock fa-fw mr-2"></i><span class="nav-label"><?php echo _("Authentication"); ?></a>
    76|         </li>
    77|         <?php endif; ?>
    78|         <?php if (RASPI_VNSTAT_ENABLED) : ?>
    79|         <li class="nav-item">
    80|           <a class="nav-link" href="data_use"><i class="fas fa-chart-bar fa-fw mr-2"></i><span class="nav-label"><?php echo _("Data usage"); ?></a>
    81|         </li>
    82|         <?php endif; ?>
    83|         <?php if (RASPI_RESTAPI_ENABLED) : ?>
    84|         <li class="nav-item">
    85|           <a class="nav-link" href="restapi_conf"><i class="fas fa-puzzle-piece mr-2"></i><span class="nav-label"><?php echo _("RestAPI"); ?></a>
    86|         </li>
    87|         <?php endif; ?>
    88|         <?php if (RASPI_SYSTEM_ENABLED) : ?>
    89|         <li class="nav-item">
    90|           <a class="nav-link" href="system_info"><i class="fas fa-cube fa-fw mr-2"></i><span class="nav-label"><?php echo _("System"); ?></a>
    91|         </li>
    92|         <?php endif; ?>
    93|         <li class="nav-item">
    94|           <a class="nav-link" href="about"><i class="fas fa-info-circle fa-fw mr-2"></i><span class="nav-label"><?php echo _("About RaspAP"); ?></a>
    95|         </li>
    96|         <!-- Divider -->
    97|         <hr class="sidebar-divider d-none d-md-block">
    98|         <!-- Sidebar Toggler (Sidebar) -->
    99|         <div class="text-center d-none d-md-block">
   100|           <button class="rounded-circle border-0" id="sidebarToggle"></button>
   101|         </div>
   102|     </ul>


# ====================================================================
# FILE: index.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-67 ---
     1| <?php
     2| /**
     3|  * Raspbian WiFi Configuration Portal (RaspAP)
     4|  *
     5|  * Simple AP setup & WiFi management for Debian-based devices.
     6|  * Enables use of simple web interface rather than SSH to control WiFi and related services on the Raspberry Pi.
     7|  * Recommended distribution is Raspberry Pi OS (64-bit) Lite. Specific instructions to install the supported software are
     8|  * in the README and original post by @SirLagz. For a quick run through, the packages required for the WebGUI are:
     9|  * lighttpd (version 1.4.69 installed via apt)
    10|  * php-cgi (version 8.2.7 installed via apt)
    11|  * along with their supporting packages, php7.4 will also need to be enabled.
    12|  *
    13|  * @author  Lawrence Yau <sirlagz@gmail.com>
    14|  * @author  Bill Zimmerman <billzimmerman@gmail.com>
    15|  * @license GNU General Public License, version 3 (GPL-3.0)
    16|  * @version 3.1.0
    17|  * @link    https://github.com/RaspAP/raspap-webgui/
    18|  * @link    https://raspap.com/
    19|  * @see     http://sirlagz.net/2013/02/08/raspap-webgui/
    20|  *
    21|  * You are not obligated to bundle the LICENSE file with your RaspAP projects as long
    22|  * as you leave these references intact in the header comments of your source files.
    23|  */
    24| require 'includes/csrf.php';
    25| ensureCSRFSessionToken();
    26| require_once 'includes/exceptions.php';
    27| require_once 'includes/config.php';
    28| require_once 'includes/autoload.php';
    29| require_once 'includes/defaults.php';
    30| require_once 'includes/locale.php';
    31| require_once 'includes/functions.php';
    32| require_once 'includes/dashboard.php';
    33| require_once 'includes/authenticate.php';
    34| require_once 'includes/admin.php';
    35| require_once 'includes/dhcp.php';
    36| require_once 'includes/hostapd.php';
    37| require_once 'includes/adblock.php';
    38| require_once 'includes/system.php';
    39| require_once 'includes/sysstats.php';
    40| require_once 'includes/configure_client.php';
    41| require_once 'includes/networking.php';
    42| require_once 'includes/data_usage.php';
    43| require_once 'includes/about.php';
    44| require_once 'includes/openvpn.php';
    45| require_once 'includes/wireguard.php';
    46| require_once 'includes/provider.php';
    47| require_once 'includes/restapi.php';
    48| require_once 'includes/torproxy.php';
    49| initializeApp();
    50| ?>
    51| <!DOCTYPE html>
    52| <html lang="en">
    53|   <head>
    54|     <meta charset="utf-8">
    55|     <?php echo CSRFMetaTag() ?>
    56|     <meta http-equiv="X-UA-Compatible" content="IE=edge">
    57|     <meta name="viewport" content="width=device-width, initial-scale=1">
    58|     <meta name="description" content="">
    59|     <meta name="author" content="">
    60|     <title><?php echo _("RaspAP WiFi Configuration Portal"); ?></title>
    61|     <!-- Bootstrap Core CSS -->
    62|     <link href="dist/bootstrap/css/bootstrap.css" rel="stylesheet">
    63|     <!-- SB-Admin-2 CSS -->
    64|     <link href="dist/sb-admin-2/css/sb-admin-2.min.css" rel="stylesheet">
    65|     <!-- DataTables CSS -->
    66|     <link href="dist/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    67|     <!-- Huebee CSS -->


# ====================================================================
# FILE: installers/common.sh
# Total hunks: 3
# ====================================================================
# --- HUNK 1: Lines 20-60 ---
    20| git_source_url="https://github.com/$repo"
    21| function _install_raspap() {
    22|     _display_welcome
    23|     _config_installation
    24|     _update_system_packages
    25|     _manage_systemd_services
    26|     _install_dependencies
    27|     _enable_php_lighttpd
    28|     _create_raspap_directories
    29|     _check_for_old_configs
    30|     _optimize_php
    31|     _download_latest_files
    32|     _change_file_ownership
    33|     _create_hostapd_scripts
    34|     _create_lighttpd_scripts
    35|     _install_lighttpd_configs
    36|     _default_configuration
    37|     _configure_networking
    38|     _prompt_install_adblock
    39|     _prompt_install_openvpn
    40|     _prompt_install_restapi
    41|     _install_extra_features
    42|     _prompt_install_wireguard
    43|     _prompt_install_vpn_providers
    44|     _patch_system_files
    45|     _install_complete
    46| }
    47| function _update_raspap() {
    48|     _display_welcome
    49|     _config_installation
    50|     _update_system_packages
    51|     _install_dependencies
    52|     _check_for_old_configs
    53|     _download_latest_files
    54|     _change_file_ownership
    55|     _patch_system_files
    56|     _install_complete
    57| }
    58| function _config_installation() {
    59|     if [ "$upgrade" == 1 ]; then
    60|         opt=(Upgrade Upgrading upgrade)

# --- HUNK 2: Lines 379-434 ---
   379|         echo "providerID = $answer" | sudo tee "$raspap_dir/provider.ini" > /dev/null || _install_status 1 "Unable to write to $raspap_dir/provider.ini"
   380|     fi
   381|     _install_status 0
   382| }
   383| function _prompt_install_openvpn() {
   384|     _install_log "Configure OpenVPN support"
   385|     echo -n "Install OpenVPN and enable client configuration? [Y/n]: "
   386|     if [ "$assume_yes" == 0 ]; then
   387|         read answer < /dev/tty
   388|         if [ "$answer" != "${answer#[Nn]}" ]; then
   389|             _install_status 0 "(Skipped)"
   390|         else
   391|             _install_openvpn
   392|         fi
   393|     elif [ "$ovpn_option" == 1 ]; then
   394|         _install_openvpn
   395|     else
   396|         echo "(Skipped)"
   397|     fi
   398| }
   399| function _prompt_install_restapi() {
   400|     _install_log "Configure RestAPI"
   401|     echo -n "Install and enable RestAPI? [Y/n]: "
   402|     if [ "$assume_yes" == 0 ]; then
   403|         read answer < /dev/tty
   404|         if [ "$answer" != "${answer#[Nn]}" ]; then
   405|             _install_status 0 "(Skipped)"
   406|         else
   407|             _install_restapi
   408|         fi
   409|     elif [ "$restapi_option" == 1 ]; then
   410|         _install_restapi
   411|     else
   412|         echo "(Skipped)"
   413|     fi
   414| }
   415| function _prompt_install_wireguard() {
   416|     _install_log "Configure WireGuard support"
   417|     echo -n "Install WireGuard and enable VPN tunnel configuration? [Y/n]: "
   418|     if [ "$assume_yes" == 0 ]; then
   419|         read answer < /dev/tty
   420|         if [ "$answer" != "${answer#[Nn]}" ]; then
   421|             _install_status 0 "(Skipped)"
   422|         else
   423|             _install_wireguard
   424|         fi
   425|     elif [ "$wg_option" == 1 ]; then
   426|         _install_wireguard
   427|     else
   428|         echo "(Skipped)"
   429|     fi
   430| }
   431| function _install_wireguard() {
   432|     _install_log "Configure WireGuard support"
   433|     if { [ "$OS" == "Debian" ] && [ "$RELEASE" == 12 ]; } ||
   434|        { [ "$OS" == "Ubuntu" ] && [ "$RELEASE" == "22.04" ]; }; then

# --- HUNK 3: Lines 441-501 ---
   441|     echo "Enabling WireGuard management option"
   442|     sudo sed -i "s/\('RASPI_WIREGUARD_ENABLED', \)false/\1true/g" "$webroot_dir/includes/config.php" || _install_status 1 "Unable to modify config.php"
   443|     _install_status 0
   444| }
   445| function _install_openvpn() {
   446|     _install_log "Installing OpenVPN and enabling client configuration"
   447|     echo "Adding packages via apt-get"
   448|     sudo apt-get install -y openvpn || _install_status 1 "Unable to install openvpn"
   449|     sudo sed -i "s/\('RASPI_OPENVPN_ENABLED', \)false/\1true/g" "$webroot_dir/includes/config.php" || _install_status 1 "Unable to modify config.php"
   450|     echo "Enabling openvpn-client service on boot"
   451|     sudo systemctl enable openvpn-client@client || _install_status 1 "Unable to enable openvpn-client daemon"
   452|     _create_openvpn_scripts || _install_status 1 "Unable to create openvpn control scripts"
   453| }
   454| function _create_openvpn_scripts() {
   455|     _install_log "Creating OpenVPN control scripts"
   456|     sudo mkdir $raspap_dir/openvpn || _install_status 1 "Unable to create directory '$raspap_dir/openvpn'"
   457|     sudo cp "$webroot_dir/installers/"configauth.sh "$raspap_dir/openvpn" || _install_status 1 "Unable to move auth control script"
   458|     sudo cp "$webroot_dir/installers/"openvpnlog.sh "$raspap_dir/openvpn" || _install_status 1 "Unable to move logging script"
   459|     sudo chown -c root:root "$raspap_dir/openvpn/"*.sh || _install_status 1 "Unable change owner and/or group"
   460|     sudo chmod 750 "$raspap_dir/openvpn/"*.sh || _install_status 1 "Unable to change file permissions"
   461|     _install_status 0
   462| }
   463| function _install_restapi() {
   464|     _install_log "Installing and enabling RestAPI"
   465|     sudo mv "$webroot_dir/api" "$raspap_dir/api"  || _install_status 1 "Unable to move api folder"
   466|     if ! command -v python3 &> /dev/null; then
   467|         echo "Python is not installed. Installing Python..."
   468|         sudo apt update
   469|         sudo apt install -y python3 python3-pip
   470|         echo "Python installed successfully."
   471|     else
   472|         echo "Python is already installed."
   473|         sudo apt install python3-pip -y
   474|     fi
   475|     python3 -m pip install -r "$raspap_dir/api/requirements.txt" --break-system-packages || _install_status 1 " Unable to install pip modules"
   476|     echo "Moving restapi systemd unit control file to /lib/systemd/system/"
   477|     sudo mv $webroot_dir/installers/restapi.service /lib/systemd/system/ || _install_status 1 "Unable to move restapi.service file"
   478|     sudo systemctl daemon-reload
   479|     sudo systemctl enable restapi.service || _install_status 1 "Failed to enable restapi.service"
   480|     echo "Enabling RestAPI management option"
   481|     sudo sed -i "s/\('RASPI_RESTAPI_ENABLED', \)false/\1true/g" "$webroot_dir/includes/config.php" || _install_status 1 "Unable to modify config.php"
   482|     _install_status 0
   483| }
   484| function _download_latest_files() {
   485|     _install_log "Cloning latest files from GitHub"
   486|     source_dir="/tmp/raspap-webgui"
   487|     if [ -d "$source_dir" ]; then
   488|         echo "Temporary download destination $source_dir exists. Removing..."
   489|         rm -r "$source_dir"
   490|     fi
   491|     if [ "$repo" == "RaspAP/raspap-insiders" ]; then
   492|         if [ -n "$username" ] && [ -n "$acctoken" ]; then
   493|             insiders_source_url="https://${username}:${acctoken}@github.com/$repo"
   494|             git clone --branch $branch --depth 1 -c advice.detachedHead=false $insiders_source_url $source_dir || clone=false
   495|         else
   496|             _install_status 3
   497|             echo "Insiders please read this: https://docs.raspap.com/insiders/#authentication"
   498|         fi
   499|     fi
   500|     if [ -z "$insiders_source_url" ]; then
   501|         git clone --branch $branch --depth 1 -c advice.detachedHead=false $git_source_url $source_dir || clone=false


# ====================================================================
# FILE: installers/raspbian.sh
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-29 ---
     1| function _usage() {
     2|     cat << EOF
     3| Usage: raspbian.sh [options]
     4| Installs an instance of RaspAP or a helper component.
     5| OPTIONS:
     6| -y, --yes, --assume-yes             Assumes "yes" as an answer to all prompts
     7| -c, --cert, --certificate           Installs an SSL certificate for lighttpd
     8| -o, --openvpn <flag>                Used with -y, --yes, sets OpenVPN install option (0=no install)
     9| -s, --rest, --restapi <flag>        Used with -y, --yes, sets RestAPI install option (0=no install)
    10| -a, --adblock <flag>                Used with -y, --yes, sets Adblock install option (0=no install)
    11| -w, --wireguard <flag>              Used with -y, --yes, sets WireGuard install option (0=no install)
    12| -e, --provider <value>              Used with -y, --yes, sets the VPN provider install option
    13| -r, --repo, --repository <name>     Overrides the default GitHub repo (RaspAP/raspap-webgui)
    14| -b, --branch <name>                 Overrides the default git branch (latest release)
    15| -t, --token <accesstoken>           Specify a GitHub token to access a private repository
    16| -n, --name <username>               Specify a GitHub username to access a private repository
    17| -u, --upgrade                       Upgrades an existing installation to the latest release version
    18| -d, --update                        Updates an existing installation to the latest release version
    19| -p, --path <path>                   Used with -d, --update, sets the existing install path
    20| -i, --insiders                      Installs from the Insiders Edition (RaspAP/raspap-insiders)
    21| -m, --minwrite                      Configures a microSD card for minimum write operation
    22| -v, --version                       Outputs release info and exits
    23| -n, --uninstall                     Loads and executes the uninstaller
    24| -h, --help                          Outputs usage notes and exits
    25| Examples:
    26|     Run locally specifying GitHub repo and branch:
    27|     raspbian.sh --repo foo/bar --branch my/branch
    28|     Run locally requesting release info:
    29|     raspbian.sh --version

# --- HUNK 2: Lines 33-91 ---
    33|     curl -sL https://install.raspap.com | bash -s -- --upgrade --insiders --name <name> --token <token>
    34|     Invoke remotely, perform an unattended update to the latest release version:
    35|     curl -sL https://install.raspap.com | bash -s -- --yes --update --path /var/www/html
    36| EOF
    37|     exit
    38| }
    39| set -eo pipefail
    40| function _main() {
    41|     repo="RaspAP/raspap-webgui" # override with -r, --repo option
    42|     repo_common="$repo"
    43|     _parse_params "$@"
    44|     _setup_colors
    45|     _log_output
    46|     _load_installer
    47| }
    48| function _parse_params() {
    49|     assume_yes=0
    50|     upgrade=0
    51|     update=0
    52|     ovpn_option=1
    53|     restapi_option=1
    54|     adblock_option=1
    55|     wg_option=1
    56|     insiders=0
    57|     minwrite=0
    58|     acctoken=""
    59|     path=""
    60|     while :; do
    61|         case "${1-}" in
    62|             -y|--yes|--assume-yes)
    63|             assume_yes=1
    64|             apt_option="-y"
    65|             ;;
    66|             -o|--openvpn)
    67|             ovpn_option="$2"
    68|             shift
    69|             ;;
    70|             -s|--rest|--restapi)
    71|             restapi_option="$2"
    72|             shift
    73|             ;;
    74|             -a|--adblock)
    75|             adblock_option="$2"
    76|             shift
    77|             ;;
    78|             -w|--wireguard)
    79|             wg_option="$2"
    80|             shift
    81|             ;;
    82|             -e|--provider)
    83|             pv_option="$2"
    84|             shift
    85|             ;;
    86|             -c|--cert|--certificate)
    87|             install_cert=1
    88|             ;;
    89|             -r|--repo|--repository)
    90|             repo="$2"
    91|             repo_common="$repo"


# ====================================================================
# FILE: src/RaspAP/DotEnv/DotEnv.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-75 ---
     1| <?php
     2| /**
     3|  * DotEnv parser/writer class
     4|  *
     5|  * @description Reads and sets key/value pairs to .env
     6|  * @author      Bill Zimmerman <billzimmerman@gmail.com>
     7|  * @license     https://github.com/raspap/raspap-webgui/blob/master/LICENSE
     8|  */
     9| declare(strict_types=1);
    10| namespace RaspAP\DotEnv;
    11| class DotEnv
    12| {
    13|     protected $envFile;
    14|     protected $data = [];
    15|     public function __construct($envFile = RASPI_CONFIG_API. '/.env')
    16|     {
    17|         $this->envFile = $envFile;
    18|     }
    19|     public function load()
    20|     {
    21|         if (!file_exists($this->envFile)) {
    22|             $this->createEnv();
    23|         }
    24|         if (file_exists($this->envFile)) {
    25|             $this->data = parse_ini_file($this->envFile);
    26|             foreach ($this->data as $key => $value) {
    27|                 if (!getenv($key)) {
    28|                     putenv("$key=$value");
    29|                     $_ENV[$key] = $value;
    30|                 }
    31|             }
    32|         } else {
    33|             throw new Exception(".env file '{$this->envFile}' not found.");
    34|         }
    35|     }
    36|     public function set($key, $value)
    37|     {
    38|         $this->data[$key] = $value;
    39|         putenv("$key=$value");
    40|         $this->store($key, $value);
    41|     }
    42|     public function get($key)
    43|     {
    44|         return getenv($key);
    45|     }
    46|     public function getAll()
    47|     {
    48|         return $this->data;
    49|     }
    50|     public function unset($key)
    51|     {
    52|         unset($_ENV[$key]);
    53|         return $this;
    54|     }
    55|     private function store($key, $value)
    56|     {
    57|         $content = file_get_contents($this->envFile);
    58|         $content = preg_replace("/^$key=.*/m", "$key=$value", $content, 1, $count);
    59|         if ($count === 0) {
    60|             $content .= "$key=$value\n";
    61|         }
    62|         file_put_contents("/tmp/.env", $content);
    63|         system('sudo mv /tmp/.env '.$this->envFile, $result);
    64|         if ($result !== 0) {
    65|             throw new Exception("Unable to move .env file: ". $this->envFile);
    66|         }
    67|     }
    68|     protected function createEnv()
    69|     {
    70|         exec('sudo touch '. escapeshellarg($this->envFile), $output, $result);
    71|         if ($result !== 0) {
    72|             throw new Exception("Unable to create .env file: ". $this->envFile);
    73|         }
    74|     }
    75| }


# ====================================================================
# FILE: templates/restapi.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-47 ---
     1|   <?php ob_start() ?>
     2|     <?php if (!RASPI_MONITOR_ENABLED) : ?>
     3|     <input type="submit" class="btn btn-outline btn-primary" name="SaveAPIsettings" value="<?php echo _("Save settings"); ?>" />
     4|         <?php if ($serviceStatus == 'down') : ?>
     5|         <input type="submit" class="btn btn-success" name="StartRestAPIservice" value="<?php echo _("Start RestAPI service"); ?>" />
     6|         <?php else : ?>
     7|         <input type="submit" class="btn btn-warning" name="StopRestAPIservice" value="<?php echo _("Stop RestAPI service"); ?>" />
     8|         <?php endif; ?>
     9|     <?php endif ?>
    10|   <?php $buttons = ob_get_clean(); ob_end_clean() ?>
    11|   <div class="row">
    12|     <div class="col-lg-12">
    13|       <div class="card">
    14|         <div class="card-header">
    15|           <div class="row">
    16|             <div class="col">
    17|               <i class="fas fa-puzzle-piece mr-2"></i><?php echo _("RestAPI"); ?>
    18|             </div>
    19|             <div class="col">
    20|               <button class="btn btn-light btn-icon-split btn-sm service-status float-right">
    21|                 <span class="icon text-gray-600"><i class="fas fa-circle service-status-<?php echo $serviceStatus ?>"></i></span>
    22|                 <span class="text service-status">restapi.service <?php echo _($serviceStatus) ?></span>
    23|               </button>
    24|             </div>
    25|           </div><!-- /.row -->
    26|         </div><!-- /.card-header -->
    27|         <div class="card-body">
    28|         <?php $status->showMessages(); ?>
    29|           <form role="form" action="restapi_conf" method="POST" class="needs-validation" novalidate>
    30|             <?php echo CSRFTokenFieldTag() ?>
    31|             <!-- Nav tabs -->
    32|             <ul class="nav nav-tabs">
    33|                 <li class="nav-item"><a class="nav-link active" id="restapisettingstab" href="#restapisettings" data-toggle="tab"><?php echo _("Settings"); ?></a></li>
    34|                 <li class="nav-item"><a class="nav-link" id="restapistatustab" href="#restapistatus" data-toggle="tab"><?php echo _("Status"); ?></a></li>
    35|             </ul>
    36|             <!-- Tab panes -->
    37|             <div class="tab-content">
    38|               <?php echo renderTemplate("restapi/general", $__template_data) ?>
    39|               <?php echo renderTemplate("restapi/status", $__template_data) ?>
    40|             </div><!-- /.tab-content -->
    41|             <?php echo $buttons ?>
    42|           </form>
    43|         </div><!-- /.card-body -->
    44|       <div class="card-footer"></div>
    45|     </div><!-- /.card -->
    46|   </div><!-- /.col-lg-12 -->
    47| </div><!-- /.row -->


# ====================================================================
# FILE: templates/restapi/general.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <div class="tab-pane active" id="restapisettings">
     2|   <h4 class="mt-3"><?php echo ("RestAPI settings") ;?></h4>
     3|   <div class="row">
     4|     <div class="form-group col-lg-12 mt-2">
     5|       <div class="row">
     6|         <div class="col-md-6">
     7|           <?php echo $docMsg; ?>
     8|         </div>
     9|       </div>
    10|       <div class="row mt-3">
    11|         <div class="form-group col-md-6" required>
    12|           <label for="txtapikey"><?php echo _("API Key"); ?></label>
    13|           <div class="input-group">
    14|               <input type="text" class="form-control" id="txtapikey" name="txtapikey" value="<?php echo htmlspecialchars($apiKey, ENT_QUOTES); ?>" required />
    15|               <div class="input-group-append">
    16|                 <button class="btn btn-outline-secondary" type="button" id="gen_apikey"><i class="fas fa-magic"></i></button>
    17|               </div>
    18|               <div class="invalid-feedback">
    19|                 <?php echo _("Please provide a valid API key."); ?>
    20|               </div>
    21|           </div>
    22|         </div>
    23|       </div>
    24|     </div>
    25|   </div>
    26| </div><!-- /.tab-pane | general tab -->


# ====================================================================
# FILE: templates/restapi/status.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-10 ---
     1| <!-- status tab -->
     2| <div class="tab-pane fade" id="restapistatus">
     3|   <h4 class="mt-3 mb-3"><?php echo _("RestAPI status") ;?></h4>
     4|   <p><?php echo _("Current <code>restapi.service</code> status is displayed below."); ?></p>
     5|   <div class="row">
     6|     <div class="form-group col-md-8 mt-2">
     7|       <textarea class="logoutput"><?php echo htmlspecialchars($serviceLog, ENT_QUOTES); ?></textarea>
     8|     </div>
     9|   </div>
    10| </div><!-- /.tab-pane -->

