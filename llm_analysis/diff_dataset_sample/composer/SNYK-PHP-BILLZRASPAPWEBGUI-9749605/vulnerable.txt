# ====================================================================
# FILE: ajax/adblock/update_blocklist.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| if (isset($_POST['blocklist_id'])) {
     5|     $blocklist_id = escapeshellcmd($_POST['blocklist_id']);
     6|     switch ($blocklist_id) {
     7|     case "StevenBlack/hosts \(default\)":
     8|         $list_url = "https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts";
     9|         $dest_file = "hostnames.txt";
    10|         break;
    11|     case "badmojr/1Hosts \(Mini\)":
    12|         $list_url = "https://badmojr.github.io/1Hosts/mini/hosts.txt";
    13|         $dest_file = "hostnames.txt";
    14|         break;
    15|     case "badmojr/1Hosts \(Lite\)":
    16|         $list_url = "https://badmojr.github.io/1Hosts/Lite/hosts.txt";
    17|         $dest_file = "hostnames.txt";
    18|         break;
    19|     case "badmojr/1Hosts \(Pro\)":
    20|         $list_url = "https://badmojr.github.io/1Hosts/Pro/hosts.txt";
    21|         $dest_file = "hostnames.txt";
    22|         break;
    23|     case "badmojr/1Hosts \(Xtra\)":


# ====================================================================
# FILE: ajax/bandwidth/get_bandwidth.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| $interface = filter_input(INPUT_GET, 'inet', FILTER_SANITIZE_SPECIAL_CHARS);
     5| if (empty($interface)) {
     6|     exec("ip -o link show | awk -F ': ' '{print $2}' | grep -v lo ", $interfacesWlo);
     7|     if (count($interfacesWlo) > 0) {
     8|         $interface = $interfacesWlo[0];
     9|     } else {
    10|         exit('No network interfaces found.');
    11|     }
    12| } 
    13| define('IFNAMSIZ', 16);
    14| if (strlen($interface) > IFNAMSIZ) {
    15|     exit('Interface name too long.');
    16| } elseif(!preg_match('/^[a-zA-Z0-9]+$/', $interface)) {
    17|     exit('Invalid interface name.');
    18| }
    19| require_once './get_bandwidth_hourly.php';
    20| exec(
    21|     sprintf('vnstat -i %s --json ', escapeshellarg($interface)), $jsonstdoutvnstat,
    22|     $exitcodedaily
    23| );
    24| if ($exitcodedaily !== 0) {
    25|     exit('vnstat error');
    26| }
    27| $jsonobj = json_decode($jsonstdoutvnstat[0], true);
    28| $timeunits = filter_input(INPUT_GET, 'tu');
    29| if ($timeunits === 'm') {
    30|     $jsonData = $jsonobj['interfaces'][0]['traffic']['month'];
    31| } else {
    32|     $jsonData = $jsonobj['interfaces'][0]['traffic']['day'];

# --- HUNK 2: Lines 41-68 ---
    41|     if ($timeunits === 'm') {
    42|         $dt = DateTime::createFromFormat(
    43|             'Y n', $jsonData[$i]['date']['year'].' '.
    44|             $jsonData[$i]['date']['month']
    45|         );
    46|     } else {
    47|         $dt = DateTime::createFromFormat(
    48|             'Y n j', $jsonData[$i]['date']['year'].' '.
    49|                                                       $jsonData[$i]['date']['month'].' '.
    50|             $jsonData[$i]['date']['day']
    51|         );
    52|     }
    53|     if ($firstelm) {
    54|         $firstelm = false;
    55|     } else {
    56|         echo ',';
    57|     }
    58|     $datasend = round($jsonData[$i]['tx'] / $dsu_factor, 0);
    59|     $datareceived = round($jsonData[$i]['rx'] / $dsu_factor, 0);
    60|     if ($timeunits === 'm') {
    61|         echo '{ "date": "' , $dt->format('Y-m') , '", "rx": "' , $datareceived , 
    62|         '", "tx": "' , $datasend , '" }';
    63|     } else {
    64|         echo '{ "date": "' , $dt->format('Y-m-d') , '", "rx": "' , $datareceived , 
    65|         '", "tx": "' , $datasend , '" }';
    66|     }
    67| }
    68| echo ' ]';


# ====================================================================
# FILE: ajax/bandwidth/get_bandwidth_hourly.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-22 ---
     1| <?php 
     2| require '../../includes/csrf.php';
     3| if (filter_input(INPUT_GET, 'tu') == 'h') {
     4|     header('X-Content-Type-Options: nosniff');
     5|     header('Content-Type: application/json');
     6|     $data_template = array(
     7|     0     => array('date' => '00:00', 'rx' => 0, 'tx' => 0),
     8|     1     => array('date' => '01:00', 'rx' => 0, 'tx' => 0),
     9|     2     => array('date' => '02:00', 'rx' => 0, 'tx' => 0),
    10|     3     => array('date' => '03:00', 'rx' => 0, 'tx' => 0),
    11|     4     => array('date' => '04:00', 'rx' => 0, 'tx' => 0),
    12|     5     => array('date' => '05:00', 'rx' => 0, 'tx' => 0),
    13|     6     => array('date' => '06:00', 'rx' => 0, 'tx' => 0),
    14|     7     => array('date' => '07:00', 'rx' => 0, 'tx' => 0),
    15|     8     => array('date' => '08:00', 'rx' => 0, 'tx' => 0),
    16|     9     => array('date' => '09:00', 'rx' => 0, 'tx' => 0),
    17|     10     => array('date' => '10:00', 'rx' => 0, 'tx' => 0),
    18|     11     => array('date' => '11:00', 'rx' => 0, 'tx' => 0),
    19|     12     => array('date' => '12:00', 'rx' => 0, 'tx' => 0),
    20|     13     => array('date' => '13:00', 'rx' => 0, 'tx' => 0),
    21|     14     => array('date' => '14:00', 'rx' => 0, 'tx' => 0),
    22|     15     => array('date' => '15:00', 'rx' => 0, 'tx' => 0),


# ====================================================================
# FILE: ajax/logging/clearlog.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-9 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../includes/functions.php';
     5| if (isset($_POST['logfile'])) {
     6|     $logfile = escapeshellcmd($_POST['logfile']);
     7|     exec("sudo truncate -s 0 $logfile", $return);
     8|     echo json_encode($return);
     9| }


# ====================================================================
# FILE: ajax/networking/do_sys_reset.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-22 ---
     1| <?php
     2| require_once '../../includes/config.php';
     3| require_once '../../includes/session.php';
     4| require_once '../../includes/functions.php';
     5| if (isset($_POST['csrf_token'])) {
     6|     if (csrfValidateRequest() && !CSRFValidate()) {
     7|         handleInvalidCSRFToken();
     8|     }
     9|     $return = 0;
    10|     $path = "../../config";
    11|     $configs = array(
    12|         array("src" => $path .'/hostapd.conf', "tmp" => "/tmp/hostapddata", "dest" => RASPI_HOSTAPD_CONFIG),
    13|         array("src" => $path .'/dhcpcd.conf', "tmp" => "/tmp/dhcpddata", "dest" => RASPI_DHCPCD_CONFIG),
    14|         array("src" => $path .'/090_wlan0.conf', "tmp" => "/tmp/dnsmasqdata", "dest" => RASPI_DNSMASQ_PREFIX.'wlan0.conf'),
    15|         array("src" => $path .'/090_raspap.conf', "tmp" => "/tmp/dnsmasqdata", "dest" => RASPI_DNSMASQ_PREFIX.'raspap.conf'),
    16|     );
    17|     foreach ($configs as $config) {
    18|         try {
    19|             $tmp = file_get_contents($config["src"]);
    20|             file_put_contents($config["tmp"], $tmp);
    21|             system("sudo cp ".$config["tmp"]. " ".$config["dest"]);
    22|         } catch (Exception $e) {


# ====================================================================
# FILE: ajax/networking/get_all_interfaces.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| exec("ls /sys/class/net | grep -v lo", $interfaces);
     4| echo json_encode($interfaces);


# ====================================================================
# FILE: ajax/networking/get_channel.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-14 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| exec('cat '. RASPI_HOSTAPD_CONFIG, $hostapdconfig);
     5| $arrConfig = array();
     6| foreach ($hostapdconfig as $hostapdconfigline) {
     7|     if (strlen($hostapdconfigline) === 0) {
     8|         continue;
     9|     }
    10|     $arrLine = explode("=", $hostapdconfigline);
    11|     $arrConfig[$arrLine[0]]=$arrLine[1];
    12| };
    13| $channel = intval($arrConfig['channel']);
    14| echo json_encode($channel);


# ====================================================================
# FILE: ajax/networking/get_frequencies.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-9 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require '../../src/RaspAP/Parsers/IwParser.php';
     4| if (isset($_POST['interface'])) {
     5|     $iface = escapeshellcmd($_POST['interface']);
     6|     $parser = new \RaspAP\Parsers\IwParser($iface);
     7|     $supportedFrequencies = $parser->parseIwInfo($iface);
     8|     echo json_encode($supportedFrequencies);
     9| }


# ====================================================================
# FILE: ajax/networking/get_ip_summary.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-13 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/functions.php';
     4| if (isset($_POST['interface'])) {
     5|     $int = preg_replace('/[^a-z0-9]/', '', $_POST['interface']);
     6|     exec('ip a s '.$int, $intOutput, $intResult);
     7|     $intOutput = array_map('htmlentities', $intOutput);
     8|     $jsonData = ['return'=>$intResult,'output'=>$intOutput];
     9|     echo json_encode($jsonData);
    10| } else {
    11|     $jsonData = ['return'=>2,'output'=>['Error getting data']];
    12|     echo json_encode($jsonData);
    13| }


# ====================================================================
# FILE: ajax/networking/get_netcfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| $interface = $_GET['iface'];
     5| if (isset($interface)) {
     6|     exec('cat '. escapeshellarg(RASPI_DNSMASQ_PREFIX.$interface.'.conf'), $return);
     7|     $conf = ParseConfig($return);
     8|     $dhcpdata['DHCPEnabled'] = empty($conf) ? false : true;
     9|     if (is_string($conf['dhcp-range'])) {
    10|         $arrRange = explode(",", $conf['dhcp-range']);
    11|     } else {
    12|         $arrRange = explode(",", $conf['dhcp-range'][0]);
    13|     }
    14|     $dhcpdata['RangeStart'] = $arrRange[0];
    15|     $dhcpdata['RangeEnd'] = $arrRange[1];
    16|     $dhcpdata['RangeMask'] = $arrRange[2];
    17|     $dhcpdata['leaseTime'] = $arrRange[3];
    18|     $dhcpHost = $conf["dhcp-host"];
    19|     $dhcpHost = empty($dhcpHost) ? [] : $dhcpHost;
    20|     $dhcpdata['dhcpHost'] = is_array($dhcpHost) ? $dhcpHost : [ $dhcpHost ];
    21|     $upstreamServers = is_array($conf['server']) ? $conf['server'] : [ $conf['server'] ];
    22|     $dhcpdata['upstreamServersEnabled'] = empty($conf['server']) ? false: true;
    23|     $dhcpdata['upstreamServers'] = array_filter($upstreamServers);
    24|     preg_match('/([0-9]*)([a-z])/i', $dhcpdata['leaseTime'], $arrRangeLeaseTime);


# ====================================================================
# FILE: ajax/networking/get_nl80211_band.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-27 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../includes/locale.php';
     5| if (isset($_POST['interface'])) {
     6|     define( 'NL80211_BAND_24GHZ', 0x1 );
     7|     define( 'NL80211_BAND_5GHZ', 0x2 );
     8|     $iface = escapeshellcmd($_POST['interface']);
     9|     $flags = 0;
    10|     exec("iw dev | awk -v iface=".$iface." '/^phy#/ { phy = $0 } $1 == \"Interface\" { interface = $2 } interface == iface { print phy }'", $return);
    11|     $phy = $return[0];
    12|     exec('iw '.$phy.' info | sed -rn "s/^.*\*\s([0-9]{4})\sMHz.*/\1/p"', $frequencies);
    13|     if (count(preg_grep('/^24[0-9]{2}/i', $frequencies)) >0) {
    14|         $flags += NL80211_BAND_24GHZ;
    15|     }
    16|     if (count(preg_grep('/^5[0-9]{3}/i', $frequencies)) >0) {
    17|         $flags += NL80211_BAND_5GHZ;
    18|     }
    19|     switch ($flags) {
    20|     case NL80211_BAND_24GHZ:
    21|         $msg = sprintf(_("The selected interface (%s) has support for the 2.4 GHz wireless band only."), $iface);
    22|         break;
    23|     case NL80211_BAND_5GHZ:
    24|         $msg = sprintf(_("The selected interface (%s) has support for the 5 GHz wireless band only."), $iface);
    25|         break;
    26|     case NL80211_BAND_24GHZ | NL80211_BAND_5GHZ:
    27|         $msg = sprintf(_("The selected interface (%s) has support for both the 2.4 and 5 GHz wireless bands."), $iface);


# ====================================================================
# FILE: ajax/networking/get_wgcfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-5 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| exec('sudo cat '. RASPI_WIREGUARD_PATH.'client.conf', $return);
     5| echo implode(PHP_EOL,$return);


# ====================================================================
# FILE: ajax/networking/get_wgkey.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| $entity = escapeshellcmd($_POST['entity']);
     5| if (isset($entity)) {
     6|     $pubkey = RASPI_WIREGUARD_PATH.$entity.'-public.key';
     7|     $privkey = RASPI_WIREGUARD_PATH.$entity.'-private.key';
     8|     $pubkey_tmp = '/tmp/'.$entity.'-public.key';
     9|     $privkey_tmp = '/tmp/'.$entity.'-private.key';
    10|     exec("sudo wg genkey | tee $privkey_tmp | wg pubkey > $pubkey_tmp", $return);
    11|     $wgdata['pubkey'] = str_replace("\n",'',file_get_contents($pubkey_tmp));
    12|     exec("sudo mv $privkey_tmp $privkey", $return);
    13|     exec("sudo mv $pubkey_tmp $pubkey", $return);
    14|     echo json_encode($wgdata);
    15| }


# ====================================================================
# FILE: ajax/networking/wifi_stations.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-18 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../includes/defaults.php';
     5| require_once '../../includes/functions.php';
     6| require_once '../../includes/wifi_functions.php';
     7| $networks = [];
     8| $network  = null;
     9| $ssid     = null;
    10| knownWifiStations($networks);
    11| nearbyWifiStations($networks, !isset($_REQUEST["refresh"]));
    12| connectedWifiStations($networks);
    13| sortNetworksByRSSI($networks);
    14| foreach ($networks as $ssid => $network) $networks[$ssid]["ssidutf8"] = ssid2utf8( $ssid ); 
    15| $connected = array_filter($networks, function($n) { return $n['connected']; } );
    16| $known     = array_filter($networks, function($n) { return !$n['connected'] && $n['configured']; } );
    17| $nearby    = array_filter($networks, function($n) { return !$n['configured']; } );
    18| echo renderTemplate('wifi_stations', compact('networks', 'connected', 'known', 'nearby'), true);


# ====================================================================
# FILE: ajax/openvpn/activate_ovpncfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-19 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../includes/functions.php';
     5| if (isset($_POST['cfg_id'])) {
     6|     $ovpncfg_id = escapeshellcmd($_POST['cfg_id']);
     7|     $ovpncfg_client = RASPI_OPENVPN_CLIENT_PATH.$ovpncfg_id.'_client.conf';
     8|     $ovpncfg_login = RASPI_OPENVPN_CLIENT_PATH.$ovpncfg_id.'_login.conf';
     9|     system("sudo rm ".RASPI_OPENVPN_CLIENT_CONFIG, $return);
    10|     system("sudo ln -s $ovpncfg_client ".RASPI_OPENVPN_CLIENT_CONFIG, $return);
    11|     system("sudo rm ".RASPI_OPENVPN_CLIENT_LOGIN, $return);
    12|     system("sudo ln -s $ovpncfg_login ".RASPI_OPENVPN_CLIENT_LOGIN, $return);
    13|     exec("sudo /bin/systemctl stop openvpn-client@client", $return);
    14|     sleep(1);
    15|     exec("sudo /bin/systemctl enable openvpn-client@client", $return);
    16|     sleep(1);
    17|     exec("sudo /bin/systemctl start openvpn-client@client", $return);
    18|     echo json_encode($return);
    19| }


# ====================================================================
# FILE: ajax/openvpn/del_ovpncfg.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| require_once '../../includes/functions.php';
     5| if (isset($_POST['cfg_id'])) {
     6|     $ovpncfg_id = escapeshellcmd($_POST['cfg_id']);
     7|     $ovpncfg_files = pathinfo(RASPI_OPENVPN_CLIENT_LOGIN, PATHINFO_DIRNAME).'/'.$ovpncfg_id.'_*.conf';
     8|     exec("sudo rm $ovpncfg_files", $return);
     9|     $jsonData = ['return'=>$return];
    10|     echo json_encode($jsonData);
    11| }


# ====================================================================
# FILE: ajax/system/sys_actions.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-16 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| $action = escapeshellcmd($_POST['a']);
     4| if (isset($action)) {
     5|     switch($action) {
     6|     case "reboot":
     7|         $response = shell_exec("sudo /sbin/reboot");
     8|         break;
     9|     case "shutdown":
    10|         $response = shell_exec("sudo /sbin/shutdown -h now");
    11|         break;
    12|     default:
    13|         $response = 'Unknown action: '.$action;
    14|     }
    15|     echo json_encode($response);
    16| }


# ====================================================================
# FILE: ajax/system/sys_debug.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-19 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| if (isset($_POST['csrf_token'])) {
     5|     if (csrfValidateRequest() && !CSRFValidate()) {
     6|         handleInvalidCSRFToken();
     7|     }
     8|     $root = getenv("DOCUMENT_ROOT");
     9|     exec('sudo '.RASPI_CONFIG.'/system/debuglog.sh -i '.$root, $return);
    10|     $logOutput = implode(PHP_EOL, $return);
    11|     $tempDir = sys_get_temp_dir();
    12|     $filePath = $tempDir . DIRECTORY_SEPARATOR . RASPI_DEBUG_LOG;
    13|     $handle = fopen($filePath, "w");
    14|     fwrite($handle, $logOutput);
    15|     fclose($handle);
    16|     echo json_encode($filePath);
    17| } else {
    18|     handleInvalidCSRFToken();
    19| }


# ====================================================================
# FILE: ajax/system/sys_get_logfile.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-18 ---
     1| <?php 
     2| require '../../includes/csrf.php';
     3| require_once '../../includes/config.php';
     4| $tempDir = sys_get_temp_dir();
     5| $filePath = $tempDir . DIRECTORY_SEPARATOR . RASPI_DEBUG_LOG;
     6| if (isset($filePath)) {
     7|     header('Content-Type: application/octet-stream');
     8|     header('Content-Disposition: attachment; filename='.basename($filePath));
     9|     header('Expires: 0');
    10|     header('Cache-Control: must-revalidate');
    11|     header('Pragma: public');
    12|     header('Content-Length: '.filesize($filePath));
    13|     readfile($filePath);
    14|     exit();
    15| } else {
    16|     header('Location: '.'/system_info');
    17|     exit();
    18| }


# ====================================================================
# FILE: ajax/system/sys_perform_update.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-15 ---
     1| <?php
     2| require '../../includes/csrf.php';
     3| if (isset($_POST['csrf_token'])) {
     4|     if (csrfValidateRequest() && !CSRFValidate()) {
     5|         handleInvalidCSRFToken();
     6|     }
     7|     $path = getenv("DOCUMENT_ROOT");
     8|     $opts = " --update --yes --path $path";
     9|     $installer = "sudo /etc/raspap/system/raspbian.sh";
    10|     $execUpdate = $installer.$opts;
    11|     $response = shell_exec($execUpdate);
    12|     echo json_encode($response);
    13| } else {
    14|     handleInvalidCSRFToken();
    15| }


# ====================================================================
# FILE: ajax/system/sys_read_logfile.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-21 ---
     1| <?php
     2| $logFile = '/tmp/raspap_install.log';
     3| $searchStrings = [
     4|     'Configure update' => 1,
     5|     'Updating sources' => 2,
     6|     'Installing required packages' => 3,
     7|     'Cloning latest files' => 4,
     8|     'Installing application' => 5,
     9|     'Installation completed' => 6,
    10|     'error' => 7
    11| ];
    12| usleep(500);
    13| if (file_exists($logFile)) {
    14|     $handle = fopen($logFile, 'r');
    15|     if ($handle) {
    16|         while (($line = fgets($handle)) !== false) {
    17|             foreach ($searchStrings as $searchString => $value) {
    18|                 if (strpos($line, $searchString) !== false) {
    19|                     echo $value .PHP_EOL;
    20|                     flush();
    21|                     ob_flush();


# ====================================================================
# FILE: app/js/custom.js
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 85-124 ---
    85| });
    86| /**
    87|  * mark a form field, e.g. a select box, with the class `.js-field-preset`
    88|  * and give it an attribute `data-field-preset-target` with a text field's
    89|  * css selector.
    90|  *
    91|  * now, if the element marked `.js-field-preset` receives a `change` event,
    92|  * its value will be copied to all elements matching the selector in
    93|  * data-field-preset-target.
    94|  */
    95| $(document).on("change", ".js-field-preset", function(e) {
    96|     var selector = this.getAttribute("data-field-preset-target")
    97|     var value = "" + this.value
    98|     var syncValue = function(el) { el.value = value }
    99|     if (value.trim() === "") { return }
   100|     document.querySelectorAll(selector).forEach(syncValue)
   101| });
   102| $(document).on("click", "#gen_wpa_passphrase", function(e) {
   103|     $('#txtwpapassphrase').val(genPassword(63));
   104| });
   105| $(document).on("click", "#js-clearhostapd-log", function(e) {
   106|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   107|     $.post('ajax/logging/clearlog.php?',{'logfile':'/tmp/hostapd.log', 'csrf_token': csrfToken},function(data){
   108|         jsonData = JSON.parse(data);
   109|         $("#hostapd-log").val("");
   110|     });
   111| });
   112| $(document).on("click", "#js-cleardnsmasq-log", function(e) {
   113|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   114|     $.post('ajax/logging/clearlog.php?',{'logfile':'/var/log/dnsmasq.log', 'csrf_token': csrfToken},function(data){
   115|         jsonData = JSON.parse(data);
   116|         $("#dnsmasq-log").val("");
   117|     });
   118| });
   119| $(document).on("click", "#js-clearopenvpn-log", function(e) {
   120|     var csrfToken = $('meta[name=csrf_token]').attr('content');
   121|     $.post('ajax/logging/clearlog.php?',{'logfile':'/tmp/openvpn.log', 'csrf_token': csrfToken},function(data){
   122|         jsonData = JSON.parse(data);
   123|         $("#openvpn-log").val("");
   124|     });

# --- HUNK 2: Lines 164-204 ---
   164|         break;
   165|     }
   166| }
   167| function loadWifiStations(refresh) {
   168|     return function() {
   169|         var complete = function() { $(this).removeClass('loading-spinner'); }
   170|         var qs = refresh === true ? '?refresh' : '';
   171|         $('.js-wifi-stations')
   172|             .addClass('loading-spinner')
   173|             .empty()
   174|             .load('ajax/networking/wifi_stations.php'+qs, complete);
   175|     };
   176| }
   177| $(".js-reload-wifi-stations").on("click", loadWifiStations(true));
   178| /*
   179| Populates the DHCP server form fields
   180| Option toggles are set dynamically depending on the loaded configuration
   181| */
   182| function loadInterfaceDHCPSelect() {
   183|     var strInterface = $('#cbxdhcpiface').val();
   184|     $.get('ajax/networking/get_netcfg.php?iface='+strInterface,function(data){
   185|         jsonData = JSON.parse(data);
   186|         $('#dhcp-iface')[0].checked = jsonData.DHCPEnabled;
   187|         $('#txtipaddress').val(jsonData.StaticIP);
   188|         $('#txtsubnetmask').val(jsonData.SubnetMask);
   189|         $('#txtgateway').val(jsonData.StaticRouters);
   190|         $('#chkfallback')[0].checked = jsonData.FallbackEnabled;
   191|         $('#default-route').prop('checked', jsonData.DefaultRoute);
   192|         if (strInterface.startsWith("wl")) {
   193|             $('#nohook-wpa-supplicant').parent().parent().parent().show()
   194|             $('#nohook-wpa-supplicant').prop('checked', jsonData.NoHookWPASupplicant);
   195|         } else {
   196|             $('#nohook-wpa-supplicant').parent().parent().parent().hide()
   197|         }
   198|         $('#txtrangestart').val(jsonData.RangeStart);
   199|         $('#txtrangeend').val(jsonData.RangeEnd);
   200|         $('#txtrangeleasetime').val(jsonData.leaseTime);
   201|         $('#txtdns1').val(jsonData.DNS1);
   202|         $('#txtdns2').val(jsonData.DNS2);
   203|         $('#cbxrangeleasetimeunits').val(jsonData.leaseTimeInterval);
   204|         $('#no-resolv')[0].checked = jsonData.upstreamServersEnabled;


# ====================================================================
# FILE: config/config.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| define('RASPI_BRAND_TEXT', 'RaspAP');
     3| define('RASPI_CONFIG', '/etc/raspap');
     4| define('RASPI_CONFIG_NETWORK', RASPI_CONFIG.'/networking/defaults.json');
     5| define('RASPI_CONFIG_PROVIDERS', 'config/vpn-providers.json');
     6| define('RASPI_ADMIN_DETAILS', RASPI_CONFIG.'/raspap.auth');
     7| define('RASPI_WIFI_AP_INTERFACE', 'wlan0');
     8| define('RASPI_CACHE_PATH', sys_get_temp_dir() . '/raspap');
     9| define('RASPI_ERROR_LOG', sys_get_temp_dir() . '/raspap_error.log');
    10| define('RASPI_DEBUG_LOG', 'raspap_debug.log');
    11| define('RASPI_LOG_SIZE_LIMIT', 64);
    12| define('RASPI_DNSMASQ_LEASES', '/var/lib/misc/dnsmasq.leases');
    13| define('RASPI_DNSMASQ_PREFIX', '/etc/dnsmasq.d/090_');
    14| define('RASPI_ADBLOCK_LISTPATH', '/etc/raspap/adblock/');
    15| define('RASPI_ADBLOCK_CONFIG', RASPI_DNSMASQ_PREFIX.'adblock.conf');
    16| define('RASPI_HOSTAPD_CONFIG', '/etc/hostapd/hostapd.conf');
    17| define('RASPI_DHCPCD_CONFIG', '/etc/dhcpcd.conf');
    18| define('RASPI_DHCPCD_LOG', '/var/log/dnsmasq.log');
    19| define('RASPI_HOSTAPD_LOG', '/tmp/hostapd.log');
    20| define('RASPI_WPA_SUPPLICANT_CONFIG', '/etc/wpa_supplicant/wpa_supplicant.conf');
    21| define('RASPI_HOSTAPD_CTRL_INTERFACE', '/var/run/hostapd');
    22| define('RASPI_WPA_CTRL_INTERFACE', '/var/run/wpa_supplicant');
    23| define('RASPI_OPENVPN_CLIENT_PATH', '/etc/openvpn/client/');
    24| define('RASPI_OPENVPN_CLIENT_CONFIG', '/etc/openvpn/client/client.conf');
    25| define('RASPI_OPENVPN_CLIENT_LOGIN', '/etc/openvpn/client/login.conf');

# --- HUNK 2: Lines 30-51 ---
    30| define('RASPI_ACCESS_CHECK_IP', '1.1.1.1');
    31| define('RASPI_ACCESS_CHECK_DNS', 'one.one.one.one');
    32| define('RASPI_API_ENDPOINT', 'https://api.github.com/repos/RaspAP/raspap-webgui/releases/latest');
    33| define("RASPI_5GHZ_CHANNEL_MIN", 100);
    34| define("RASPI_5GHZ_CHANNEL_MAX", 192);
    35| define('RASPI_AUTH_ENABLED', true);
    36| define('RASPI_WIFICLIENT_ENABLED', true);
    37| define('RASPI_HOTSPOT_ENABLED', true);
    38| define('RASPI_NETWORK_ENABLED', true);
    39| define('RASPI_DHCP_ENABLED', true);
    40| define('RASPI_ADBLOCK_ENABLED', false);
    41| define('RASPI_OPENVPN_ENABLED', false);
    42| define('RASPI_VPN_PROVIDER_ENABLED', false);
    43| define('RASPI_WIREGUARD_ENABLED', false);
    44| define('RASPI_TORPROXY_ENABLED', false);
    45| define('RASPI_CONFAUTH_ENABLED', true);
    46| define('RASPI_CHANGETHEME_ENABLED', true);
    47| define('RASPI_VNSTAT_ENABLED', true);
    48| define('RASPI_SYSTEM_ENABLED', true);
    49| define('RASPI_MONITOR_ENABLED', false);
    50| define('LOCALE_ROOT', 'locale');
    51| define('LOCALE_DOMAIN', 'messages');


# ====================================================================
# FILE: includes/defaults.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-29 ---
     1| <?php
     2| if (!defined('RASPI_CONFIG')) {
     3|     define('RASPI_CONFIG', '/etc/raspap');
     4| }
     5| $defaults = [
     6|   'RASPI_BRAND_TEXT' => 'RaspAP',
     7|   'RASPI_VERSION' => '3.0.9',
     8|   'RASPI_CONFIG_NETWORK' => RASPI_CONFIG.'/networking/defaults.json',
     9|   'RASPI_CONFIG_PROVIDERS' => 'config/vpn-providers.json',
    10|   'RASPI_ADMIN_DETAILS' => RASPI_CONFIG.'/raspap.auth',
    11|   'RASPI_WIFI_AP_INTERFACE' => 'wlan0',
    12|   'RASPI_CACHE_PATH' => sys_get_temp_dir() . '/raspap',
    13|   'RASPI_ERROR_LOG' => sys_get_temp_dir() . '/raspap_error.log',
    14|   'RASPI_DEBUG_LOG' => 'raspap_debug.log',
    15|   'RASPI_LOG_SIZE_LIMIT' =>  64,
    16|   'RASPI_DNSMASQ_LEASES' => '/var/lib/misc/dnsmasq.leases',
    17|   'RASPI_DNSMASQ_PREFIX' => '/etc/dnsmasq.d/090_',
    18|   'RASPI_ADBLOCK_LISTPATH' => '/etc/raspap/adblock/',
    19|   'RASPI_ADBLOCK_CONFIG' =>  RASPI_DNSMASQ_PREFIX.'adblock.conf',
    20|   'RASPI_HOSTAPD_CONFIG' => '/etc/hostapd/hostapd.conf',
    21|   'RASPI_DHCPCD_CONFIG' => '/etc/dhcpcd.conf',
    22|   'RASPI_DHCPCD_LOG' => '/var/log/dnsmasq.log',
    23|   'RASPI_HOSTAPD_LOG' => '/tmp/hostapd.log',
    24|   'RASPI_WPA_SUPPLICANT_CONFIG' => '/etc/wpa_supplicant/wpa_supplicant.conf',
    25|   'RASPI_HOSTAPD_CTRL_INTERFACE' => '/var/run/hostapd',
    26|   'RASPI_WPA_CTRL_INTERFACE' => '/var/run/wpa_supplicant',
    27|   'RASPI_OPENVPN_CLIENT_PATH' => '/etc/openvpn/client/',
    28|   'RASPI_OPENVPN_CLIENT_CONFIG' => '/etc/openvpn/client/client.conf',
    29|   'RASPI_OPENVPN_CLIENT_LOGIN' => '/etc/openvpn/client/login.conf',


# ====================================================================
# FILE: includes/page_actions.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 27-53 ---
    27|             DisplayWireGuardConfig();
    28|             break;
    29|         case "/provider_conf":
    30|             DisplayProviderConfig();
    31|             break;
    32|         case "/torproxy_conf":
    33|             DisplayTorProxyConfig();
    34|             break;
    35|         case "/auth_conf":
    36|             DisplayAuthConfig($_SESSION['user_id']);
    37|             break;
    38|         case "/save_hostapd_conf":
    39|             SaveTORAndVPNConfig();
    40|             break;
    41|         case "/data_use":
    42|             DisplayDataUsage($extraFooterScripts);
    43|             break;
    44|         case "/system_info":
    45|             DisplaySystem($extraFooterScripts);
    46|             break;
    47|         case "/about":
    48|             DisplayAbout();
    49|             break;
    50|         default:
    51|             DisplayDashboard($extraFooterScripts);
    52|         }
    53|       ?>


# ====================================================================
# FILE: includes/provider.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 19-59 ---
    19|         $status->addMessage(sprintf(_('Expected %s binary not found at: %s'), $providerName, $binPath), 'warning');
    20|         $status->addMessage(sprintf(_('Visit the <a href="%s" target="_blank">installation instructions</a> for %s\'s Linux CLI.'), $installPage, $providerName), 'warning');
    21|         $ctlState = 'disabled';
    22|         $providerVersion = 'not found';
    23|     } elseif (empty($providerVersion)) {
    24|         $status->addMessage(sprintf(_('Unable to execute %s binary found at: %s'), $providerName, $binPath), 'warning');
    25|         $status->addMessage(_('Check that binary is executable and permissions exist in raspap.sudoers'), 'warning');
    26|         $ctlState = 'disabled';
    27|         $providerVersion = 'not found';
    28|     } else {
    29|         $serviceStatus = getProviderStatus($id, $binPath);
    30|         $statusDisplay = $serviceStatus == "down" ? "inactive" : "active";
    31|         $providerLog = getProviderLog($id, $binPath, $country);
    32|         $accountInfo = getAccountInfo($id, $binPath, $providerName);
    33|         $accountLink = getProviderValue($id, "account_page");
    34|         $countries = getCountries($id, $binPath);
    35|     }
    36|     if (!RASPI_MONITOR_ENABLED) {
    37|         if (isset($_POST['SaveProviderSettings'])) {
    38|             if (isset($_POST['country'])) {
    39|                 $country = trim($_POST['country']);
    40|                 if (strlen($country) == 0) {
    41|                     $status->addMessage('Select a country from the server location list', 'danger');
    42|                 } else {
    43|                     $return = saveProviderConfig($status, $binPath, $country, $id);
    44|                 }
    45|             }
    46|         } elseif (isset($_POST['StartProviderVPN'])) {
    47|             $status->addMessage('Attempting to connect VPN provider', 'info');
    48|             $cmd = getCliOverride($id, 'cmd_overrides', 'connect');
    49|             exec("sudo $binPath $cmd", $return);
    50|             $return = stripArtifacts($return);
    51|             foreach ($return as $line) {
    52|                 if (strlen(trim($line)) > 0) {
    53|                     $line = preg_replace('/\e\[\?[0-9]*l\s(.*)\e.*$/', '$1', $line);
    54|                     $line = preg_replace('/\e\[0m\e\[[0-9;]*m(.*)/', '$1', $line);
    55|                     $status->addMessage($line, 'info');
    56|                 }
    57|             }
    58|         } elseif (isset($_POST['StopProviderVPN'])) {
    59|             $status->addMessage('Attempting to disconnect VPN provider', 'info');


# ====================================================================
# FILE: includes/sidebar.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 63-97 ---
    63|         <?php if (RASPI_VPN_PROVIDER_ENABLED) : ?>
    64|         <li class="nav-item">
    65|           <a class="nav-link" href="provider_conf"><i class="fas fa-shield-alt fa-fw mr-2"></i><span class="nav-label"><?php echo _(getProviderValue($_SESSION["providerID"], "name")); ?></a>
    66|         </li>
    67|         <?php endif; ?>
    68|         <?php if (RASPI_TORPROXY_ENABLED) : ?>
    69|         <li class="nav-item">
    70|            <a class="nav-link" href="torproxy_conf"><i class="fas fa-eye-slash fa-fw mr-2"></i><span class="nav-label"><?php echo _("TOR proxy"); ?></a>
    71|         </li>
    72|         <?php endif; ?>
    73|         <?php if (RASPI_CONFAUTH_ENABLED) : ?>
    74|         <li class="nav-item">
    75|           <a class="nav-link" href="auth_conf"><i class="fas fa-user-lock fa-fw mr-2"></i><span class="nav-label"><?php echo _("Authentication"); ?></a>
    76|         </li>
    77|         <?php endif; ?>
    78|         <?php if (RASPI_VNSTAT_ENABLED) : ?>
    79|         <li class="nav-item">
    80|           <a class="nav-link" href="data_use"><i class="fas fa-chart-bar fa-fw mr-2"></i><span class="nav-label"><?php echo _("Data usage"); ?></a>
    81|         </li>
    82|         <?php endif; ?>
    83|         <?php if (RASPI_SYSTEM_ENABLED) : ?>
    84|         <li class="nav-item">
    85|           <a class="nav-link" href="system_info"><i class="fas fa-cube fa-fw mr-2"></i><span class="nav-label"><?php echo _("System"); ?></a>
    86|         </li>
    87|         <?php endif; ?>
    88|          <li class="nav-item">
    89|           <a class="nav-link" href="about"><i class="fas fa-info-circle fa-fw mr-2"></i><span class="nav-label"><?php echo _("About RaspAP"); ?></a>
    90|         </li>
    91|         <!-- Divider -->
    92|         <hr class="sidebar-divider d-none d-md-block">
    93|         <!-- Sidebar Toggler (Sidebar) -->
    94|         <div class="text-center d-none d-md-block">
    95|           <button class="rounded-circle border-0" id="sidebarToggle"></button>
    96|         </div>
    97|     </ul>


# ====================================================================
# FILE: index.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-66 ---
     1| <?php
     2| /**
     3|  * Raspbian WiFi Configuration Portal (RaspAP)
     4|  *
     5|  * Simple AP setup & WiFi management for Debian-based devices.
     6|  * Enables use of simple web interface rather than SSH to control WiFi and related services on the Raspberry Pi.
     7|  * Recommended distribution is Raspberry Pi OS (64-bit) Lite. Specific instructions to install the supported software are
     8|  * in the README and original post by @SirLagz. For a quick run through, the packages required for the WebGUI are:
     9|  * lighttpd (version 1.4.69 installed via apt)
    10|  * php-cgi (version 8.2.7 installed via apt)
    11|  * along with their supporting packages, php7.4 will also need to be enabled.
    12|  *
    13|  * @author  Lawrence Yau <sirlagz@gmail.com>
    14|  * @author  Bill Zimmerman <billzimmerman@gmail.com>
    15|  * @license GNU General Public License, version 3 (GPL-3.0)
    16|  * @version 3.0.9
    17|  * @link    https://github.com/RaspAP/raspap-webgui/
    18|  * @link    https://raspap.com/
    19|  * @see     http://sirlagz.net/2013/02/08/raspap-webgui/
    20|  *
    21|  * You are not obligated to bundle the LICENSE file with your RaspAP projects as long
    22|  * as you leave these references intact in the header comments of your source files.
    23|  */
    24| require 'includes/csrf.php';
    25| ensureCSRFSessionToken();
    26| require_once 'includes/exceptions.php';
    27| require_once 'includes/config.php';
    28| require_once 'includes/autoload.php';
    29| require_once 'includes/defaults.php';
    30| require_once 'includes/locale.php';
    31| require_once 'includes/functions.php';
    32| require_once 'includes/dashboard.php';
    33| require_once 'includes/authenticate.php';
    34| require_once 'includes/admin.php';
    35| require_once 'includes/dhcp.php';
    36| require_once 'includes/hostapd.php';
    37| require_once 'includes/adblock.php';
    38| require_once 'includes/system.php';
    39| require_once 'includes/sysstats.php';
    40| require_once 'includes/configure_client.php';
    41| require_once 'includes/networking.php';
    42| require_once 'includes/data_usage.php';
    43| require_once 'includes/about.php';
    44| require_once 'includes/openvpn.php';
    45| require_once 'includes/wireguard.php';
    46| require_once 'includes/provider.php';
    47| require_once 'includes/torproxy.php';
    48| initializeApp();
    49| ?>
    50| <!DOCTYPE html>
    51| <html lang="en">
    52|   <head>
    53|     <meta charset="utf-8">
    54|     <?php echo CSRFMetaTag() ?>
    55|     <meta http-equiv="X-UA-Compatible" content="IE=edge">
    56|     <meta name="viewport" content="width=device-width, initial-scale=1">
    57|     <meta name="description" content="">
    58|     <meta name="author" content="">
    59|     <title><?php echo _("RaspAP WiFi Configuration Portal"); ?></title>
    60|     <!-- Bootstrap Core CSS -->
    61|     <link href="dist/bootstrap/css/bootstrap.css" rel="stylesheet">
    62|     <!-- SB-Admin-2 CSS -->
    63|     <link href="dist/sb-admin-2/css/sb-admin-2.min.css" rel="stylesheet">
    64|     <!-- DataTables CSS -->
    65|     <link href="dist/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">
    66|     <!-- Huebee CSS -->


# ====================================================================
# FILE: installers/common.sh
# Total hunks: 3
# ====================================================================
# --- HUNK 1: Lines 20-59 ---
    20| git_source_url="https://github.com/$repo"
    21| function _install_raspap() {
    22|     _display_welcome
    23|     _config_installation
    24|     _update_system_packages
    25|     _manage_systemd_services
    26|     _install_dependencies
    27|     _enable_php_lighttpd
    28|     _create_raspap_directories
    29|     _check_for_old_configs
    30|     _optimize_php
    31|     _download_latest_files
    32|     _change_file_ownership
    33|     _create_hostapd_scripts
    34|     _create_lighttpd_scripts
    35|     _install_lighttpd_configs
    36|     _default_configuration
    37|     _configure_networking
    38|     _prompt_install_adblock
    39|     _prompt_install_openvpn
    40|     _install_extra_features
    41|     _prompt_install_wireguard
    42|     _prompt_install_vpn_providers
    43|     _patch_system_files
    44|     _install_complete
    45| }
    46| function _update_raspap() {
    47|     _display_welcome
    48|     _config_installation
    49|     _update_system_packages
    50|     _install_dependencies
    51|     _check_for_old_configs
    52|     _download_latest_files
    53|     _change_file_ownership
    54|     _patch_system_files
    55|     _install_complete
    56| }
    57| function _config_installation() {
    58|     if [ "$upgrade" == 1 ]; then
    59|         opt=(Upgrade Upgrading upgrade)

# --- HUNK 2: Lines 378-417 ---
   378|         echo "providerID = $answer" | sudo tee "$raspap_dir/provider.ini" > /dev/null || _install_status 1 "Unable to write to $raspap_dir/provider.ini"
   379|     fi
   380|     _install_status 0
   381| }
   382| function _prompt_install_openvpn() {
   383|     _install_log "Configure OpenVPN support"
   384|     echo -n "Install OpenVPN and enable client configuration? [Y/n]: "
   385|     if [ "$assume_yes" == 0 ]; then
   386|         read answer < /dev/tty
   387|         if [ "$answer" != "${answer#[Nn]}" ]; then
   388|             _install_status 0 "(Skipped)"
   389|         else
   390|             _install_openvpn
   391|         fi
   392|     elif [ "$ovpn_option" == 1 ]; then
   393|         _install_openvpn
   394|     else
   395|         echo "(Skipped)"
   396|     fi
   397| }
   398| function _prompt_install_wireguard() {
   399|     _install_log "Configure WireGuard support"
   400|     echo -n "Install WireGuard and enable VPN tunnel configuration? [Y/n]: "
   401|     if [ "$assume_yes" == 0 ]; then
   402|         read answer < /dev/tty
   403|         if [ "$answer" != "${answer#[Nn]}" ]; then
   404|             _install_status 0 "(Skipped)"
   405|         else
   406|             _install_wireguard
   407|         fi
   408|     elif [ "$wg_option" == 1 ]; then
   409|         _install_wireguard
   410|     else
   411|         echo "(Skipped)"
   412|     fi
   413| }
   414| function _install_wireguard() {
   415|     _install_log "Configure WireGuard support"
   416|     if { [ "$OS" == "Debian" ] && [ "$RELEASE" == 12 ]; } ||
   417|        { [ "$OS" == "Ubuntu" ] && [ "$RELEASE" == "22.04" ]; }; then

# --- HUNK 3: Lines 424-463 ---
   424|     echo "Enabling WireGuard management option"
   425|     sudo sed -i "s/\('RASPI_WIREGUARD_ENABLED', \)false/\1true/g" "$webroot_dir/includes/config.php" || _install_status 1 "Unable to modify config.php"
   426|     _install_status 0
   427| }
   428| function _install_openvpn() {
   429|     _install_log "Installing OpenVPN and enabling client configuration"
   430|     echo "Adding packages via apt-get"
   431|     sudo apt-get install -y openvpn || _install_status 1 "Unable to install openvpn"
   432|     sudo sed -i "s/\('RASPI_OPENVPN_ENABLED', \)false/\1true/g" "$webroot_dir/includes/config.php" || _install_status 1 "Unable to modify config.php"
   433|     echo "Enabling openvpn-client service on boot"
   434|     sudo systemctl enable openvpn-client@client || _install_status 1 "Unable to enable openvpn-client daemon"
   435|     _create_openvpn_scripts || _install_status 1 "Unable to create openvpn control scripts"
   436| }
   437| function _create_openvpn_scripts() {
   438|     _install_log "Creating OpenVPN control scripts"
   439|     sudo mkdir $raspap_dir/openvpn || _install_status 1 "Unable to create directory '$raspap_dir/openvpn'"
   440|     sudo cp "$webroot_dir/installers/"configauth.sh "$raspap_dir/openvpn" || _install_status 1 "Unable to move auth control script"
   441|     sudo cp "$webroot_dir/installers/"openvpnlog.sh "$raspap_dir/openvpn" || _install_status 1 "Unable to move logging script"
   442|     sudo chown -c root:root "$raspap_dir/openvpn/"*.sh || _install_status 1 "Unable change owner and/or group"
   443|     sudo chmod 750 "$raspap_dir/openvpn/"*.sh || _install_status 1 "Unable to change file permissions"
   444|     _install_status 0
   445| }
   446| function _download_latest_files() {
   447|     _install_log "Cloning latest files from GitHub"
   448|     source_dir="/tmp/raspap-webgui"
   449|     if [ -d "$source_dir" ]; then
   450|         echo "Temporary download destination $source_dir exists. Removing..."
   451|         rm -r "$source_dir"
   452|     fi
   453|     if [ "$repo" == "RaspAP/raspap-insiders" ]; then
   454|         if [ -n "$username" ] && [ -n "$acctoken" ]; then
   455|             insiders_source_url="https://${username}:${acctoken}@github.com/$repo"
   456|             git clone --branch $branch --depth 1 -c advice.detachedHead=false $insiders_source_url $source_dir || clone=false
   457|         else
   458|             _install_status 3
   459|             echo "Insiders please read this: https://docs.raspap.com/insiders/#authentication"
   460|         fi
   461|     fi
   462|     if [ -z "$insiders_source_url" ]; then
   463|         git clone --branch $branch --depth 1 -c advice.detachedHead=false $git_source_url $source_dir || clone=false


# ====================================================================
# FILE: installers/raspbian.sh
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| function _usage() {
     2|     cat << EOF
     3| Usage: raspbian.sh [options]
     4| Installs an instance of RaspAP or a helper component.
     5| OPTIONS:
     6| -y, --yes, --assume-yes             Assumes "yes" as an answer to all prompts
     7| -c, --cert, --certificate           Installs an SSL certificate for lighttpd
     8| -o, --openvpn <flag>                Used with -y, --yes, sets OpenVPN install option (0=no install)
     9| -a, --adblock <flag>                Used with -y, --yes, sets Adblock install option (0=no install)
    10| -w, --wireguard <flag>              Used with -y, --yes, sets WireGuard install option (0=no install)
    11| -e, --provider <value>              Used with -y, --yes, sets the VPN provider install option
    12| -r, --repo, --repository <name>     Overrides the default GitHub repo (RaspAP/raspap-webgui)
    13| -b, --branch <name>                 Overrides the default git branch (latest release)
    14| -t, --token <accesstoken>           Specify a GitHub token to access a private repository
    15| -n, --name <username>               Specify a GitHub username to access a private repository
    16| -u, --upgrade                       Upgrades an existing installation to the latest release version
    17| -d, --update                        Updates an existing installation to the latest release version
    18| -p, --path <path>                   Used with -d, --update, sets the existing install path
    19| -i, --insiders                      Installs from the Insiders Edition (RaspAP/raspap-insiders)
    20| -m, --minwrite                      Configures a microSD card for minimum write operation
    21| -v, --version                       Outputs release info and exits
    22| -n, --uninstall                     Loads and executes the uninstaller
    23| -h, --help                          Outputs usage notes and exits
    24| Examples:
    25|     Run locally specifying GitHub repo and branch:
    26|     raspbian.sh --repo foo/bar --branch my/branch
    27|     Run locally requesting release info:
    28|     raspbian.sh --version

# --- HUNK 2: Lines 32-85 ---
    32|     curl -sL https://install.raspap.com | bash -s -- --upgrade --insiders --name <name> --token <token>
    33|     Invoke remotely, perform an unattended update to the latest release version:
    34|     curl -sL https://install.raspap.com | bash -s -- --yes --update --path /var/www/html
    35| EOF
    36|     exit
    37| }
    38| set -eo pipefail
    39| function _main() {
    40|     repo="RaspAP/raspap-webgui" # override with -r, --repo option
    41|     repo_common="$repo"
    42|     _parse_params "$@"
    43|     _setup_colors
    44|     _log_output
    45|     _load_installer
    46| }
    47| function _parse_params() {
    48|     assume_yes=0
    49|     upgrade=0
    50|     update=0
    51|     ovpn_option=1
    52|     adblock_option=1
    53|     wg_option=1
    54|     insiders=0
    55|     minwrite=0
    56|     acctoken=""
    57|     path=""
    58|     while :; do
    59|         case "${1-}" in
    60|             -y|--yes|--assume-yes)
    61|             assume_yes=1
    62|             apt_option="-y"
    63|             ;;
    64|             -o|--openvpn)
    65|             ovpn_option="$2"
    66|             shift
    67|             ;;
    68|             -a|--adblock)
    69|             adblock_option="$2"
    70|             shift
    71|             ;;
    72|             -w|--wireguard)
    73|             wg_option="$2"
    74|             shift
    75|             ;;
    76|             -e|--provider)
    77|             pv_option="$2"
    78|             shift
    79|             ;;
    80|             -c|--cert|--certificate)
    81|             install_cert=1
    82|             ;;
    83|             -r|--repo|--repository)
    84|             repo="$2"
    85|             repo_common="$repo"

