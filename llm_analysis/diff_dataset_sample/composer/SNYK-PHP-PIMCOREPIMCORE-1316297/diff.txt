--- a//dev/null
+++ b/.travis/setup-fpm.sh
@@ -0,0 +1,6 @@
+echo "Setting up FPM ..."
+phpenv config-add .travis/php.ini
+sudo cp -f .travis/php-fpm.conf ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
+echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
+~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
+sudo cp -f .travis/apache-fpm.conf /etc/apache2/sites-available/pimcore-test.dev.conf

--- a/bundles/AdminBundle/Controller/Admin/Asset/AssetController.php
+++ b//dev/null
@@ -1,2248 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Asset;
-use Pimcore\Bundle\AdminBundle\Controller\Admin\ElementControllerBase;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\AdminStyleTrait;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\ApplySchedulerDataTrait;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Bundle\AdminBundle\Security\CsrfProtectionHandler;
-use Pimcore\Config;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Event\AssetEvents;
-use Pimcore\File;
-use Pimcore\Loader\ImplementationLoader\Exception\UnsupportedException;
-use Pimcore\Logger;
-use Pimcore\Model;
-use Pimcore\Model\Asset;
-use Pimcore\Model\Element;
-use Pimcore\Tool;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpFoundation\StreamedResponse;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Mime\MimeTypes;
-use Symfony\Component\Process\Process;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/asset")
- *
- * @internal
- */
-class AssetController extends ElementControllerBase implements KernelControllerEventInterface
-{
-    use AdminStyleTrait;
-    use ElementEditLockHelperTrait;
-    use ApplySchedulerDataTrait;
-    /**
-     * @var Asset\Service
-     */
-    protected $_assetService;
-    /**
-     * @Route("/tree-get-root", name="pimcore_admin_asset_treegetroot", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetRootAction(Request $request)
-    {
-        return parent::treeGetRootAction($request);
-    }
-    /**
-     * @Route("/delete-info", name="pimcore_admin_asset_deleteinfo", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function deleteInfoAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        return parent::deleteInfoAction($request, $eventDispatcher);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_asset_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $asset = Asset::getById((int)$request->get('id'));
-        if (!$asset instanceof Asset) {
-            return $this->adminJson(['success' => false, 'message' => "asset doesn't exist"]);
-        }
-        if ($asset->isAllowed('publish') || $asset->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'asset')) {
-                return $this->getEditLockResponse($request->get('id'), 'asset');
-            }
-            Element\Editlock::lock($request->get('id'), 'asset');
-        }
-        $asset = clone $asset;
-        $asset->getScheduledTasks();
-        $asset->setLocked($asset->isLocked());
-        $asset->setParent(null);
-        $asset->setStream(null);
-        $data = $asset->getObjectVars();
-        if ($asset instanceof Asset\Text) {
-            if ($asset->getFileSize() < 2000000) {
-                $data['data'] = \ForceUTF8\Encoding::toUTF8($asset->getData());
-            } else {
-                $data['data'] = false;
-            }
-        } elseif ($asset instanceof Asset\Document) {
-            $data['pdfPreviewAvailable'] = (bool)$this->getDocumentPreviewPdf($asset);
-        } elseif ($asset instanceof Asset\Video) {
-            $videoInfo = [];
-            if (\Pimcore\Video::isAvailable()) {
-                $config = Asset\Video\Thumbnail\Config::getPreviewConfig();
-                $thumbnail = $asset->getThumbnail($config, ['mp4']);
-                if ($thumbnail) {
-                    if ($thumbnail['status'] == 'finished') {
-                        $videoInfo['previewUrl'] = $thumbnail['formats']['mp4'];
-                        $videoInfo['width'] = $asset->getWidth();
-                        $videoInfo['height'] = $asset->getHeight();
-                        $metaData = $asset->getSphericalMetaData();
-                        if (isset($metaData['ProjectionType']) && strtolower($metaData['ProjectionType']) == 'equirectangular') {
-                            $videoInfo['isVrVideo'] = true;
-                        }
-                    }
-                }
-            }
-            $data['videoInfo'] = $videoInfo;
-        } elseif ($asset instanceof Asset\Image) {
-            $imageInfo = [];
-            $previewUrl = $this->generateUrl('pimcore_admin_asset_getimagethumbnail', [
-                'id' => $asset->getId(),
-                'treepreview' => true,
-                'hdpi' => true,
-                '_dc' => time(),
-            ]);
-            if ($asset->isAnimated()) {
-                $previewUrl = $this->generateUrl('pimcore_admin_asset_getasset', [
-                    'id' => $asset->getId(),
-                    '_dc' => time(),
-                ]);
-            }
-            $imageInfo['previewUrl'] = $previewUrl;
-            if ($asset->getWidth() && $asset->getHeight()) {
-                $imageInfo['dimensions'] = [];
-                $imageInfo['dimensions']['width'] = $asset->getWidth();
-                $imageInfo['dimensions']['height'] = $asset->getHeight();
-            }
-            $imageInfo['exiftoolAvailable'] = (bool)\Pimcore\Tool\Console::getExecutable('exiftool');
-            if (!$asset->getEmbeddedMetaData(false)) {
-                $asset->getEmbeddedMetaData(true, false); // read Exif, IPTC and XPM like in the old days ...
-            }
-            $data['imageInfo'] = $imageInfo;
-        }
-        $data['properties'] = Element\Service::minimizePropertiesForEditmode($asset->getProperties());
-        $data['metadata'] = Asset\Service::expandMetadataForEditmode($asset->getMetadata());
-        $data['versionDate'] = $asset->getModificationDate();
-        $data['filesizeFormatted'] = $asset->getFileSize(true);
-        $data['filesize'] = $asset->getFileSize();
-        $data['fileExtension'] = File::getFileExtension($asset->getFilename());
-        $data['idPath'] = Element\Service::getIdPath($asset);
-        $data['userPermissions'] = $asset->getUserPermissions();
-        $frontendPath = $asset->getFrontendFullPath();
-        $data['url'] = preg_match('/^http(s)?:\\/\\/.+/', $frontendPath) ?
-            $frontendPath :
-            $request->getSchemeAndHttpHost() . $frontendPath;
-        $this->addAdminStyle($asset, ElementAdminStyleEvent::CONTEXT_EDITOR, $data);
-        $data['php'] = [
-            'classes' => array_merge([get_class($asset)], array_values(class_parents($asset))),
-            'interfaces' => array_values(class_implements($asset)),
-        ];
-        $event = new GenericEvent($this, [
-            'data' => $data,
-            'asset' => $asset,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::ASSET_GET_PRE_SEND_DATA);
-        $data = $event->getArgument('data');
-        if ($asset->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/tree-get-childs-by-id", name="pimcore_admin_asset_treegetchildsbyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetChildsByIdAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $assets = [];
-        $cv = false;
-        $asset = Asset::getById($allParams['node']);
-        $filter = $request->get('filter');
-        $limit = (int)$allParams['limit'];
-        if (!is_null($filter)) {
-            if (substr($filter, -1) != '*') {
-                $filter .= '*';
-            }
-            $filter = str_replace('*', '%', $filter);
-            $limit = 100;
-            $offset = 0;
-        } elseif (!$allParams['limit']) {
-            $limit = 100000000;
-        }
-        $offset = isset($allParams['start']) ? (int)$allParams['start'] : 0;
-        $filteredTotalCount = 0;
-        if ($asset->hasChildren()) {
-            if ($allParams['view']) {
-                $cv = \Pimcore\Model\Element\Service::getCustomViewById($allParams['view']);
-            }
-            $childsList = new Asset\Listing();
-            $childsList->addConditionParam('parentId = ?', [$asset->getId()]);
-            $childsList->filterAccessibleByUser($this->getAdminUser());
-            if (!is_null($filter)) {
-                $childsList->addConditionParam('CAST(assets.filename AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci LIKE ?', [$filter]);
-            }
-            $childsList->setLimit($limit);
-            $childsList->setOffset($offset);
-            $childsList->setOrderKey("FIELD(assets.type, 'folder') DESC, CAST(assets.filename AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci ASC", false);
-            \Pimcore\Model\Element\Service::addTreeFilterJoins($cv, $childsList);
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $childsList,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::ASSET_LIST_BEFORE_LIST_LOAD);
-            /** @var Asset\Listing $childsList */
-            $childsList = $beforeListLoadEvent->getArgument('list');
-            $childs = $childsList->load();
-            $filteredTotalCount = $childsList->getTotalCount();
-            foreach ($childs as $childAsset) {
-                if ($childAsset->isAllowed('list')) {
-                    $assets[] = $this->getTreeNodeConfig($childAsset);
-                }
-            }
-        }
-        $event = new GenericEvent($this, [
-            'assets' => $assets,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::ASSET_TREE_GET_CHILDREN_BY_ID_PRE_SEND_DATA);
-        $assets = $event->getArgument('assets');
-        if ($allParams['limit']) {
-            return $this->adminJson([
-                'offset' => $offset,
-                'limit' => $limit,
-                'total' => $asset->getChildAmount($this->getAdminUser()),
-                'overflow' => !is_null($filter) && ($filteredTotalCount > $limit),
-                'nodes' => $assets,
-                'filter' => $request->get('filter') ? $request->get('filter') : '',
-                'inSearch' => (int)$request->get('inSearch'),
-            ]);
-        } else {
-            return $this->adminJson($assets);
-        }
-    }
-    /**
-     * @Route("/add-asset", name="pimcore_admin_asset_addasset", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function addAssetAction(Request $request, Config $config)
-    {
-        try {
-            $res = $this->addAsset($request, $config);
-            $response = [
-                'success' => $res['success'],
-            ];
-            if ($res['success']) {
-                $response['asset'] = [
-                    'id' => $res['asset']->getId(),
-                    'path' => $res['asset']->getFullPath(),
-                    'type' => $res['asset']->getType(),
-                ];
-            }
-            return $this->adminJson($response);
-        } catch (\Exception $e) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $e->getMessage(),
-            ]);
-        }
-    }
-    /**
-     * @Route("/add-asset-compatibility", name="pimcore_admin_asset_addassetcompatibility", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function addAssetCompatibilityAction(Request $request, Config $config)
-    {
-        try {
-            $res = $this->addAsset($request, $config);
-            $response = $this->adminJson([
-                'success' => $res['success'],
-                'msg' => $res['success'] ? 'Success' : 'Error',
-                'id' => $res['asset'] ? $res['asset']->getId() : null,
-                'fullpath' => $res['asset'] ? $res['asset']->getRealFullPath() : null,
-                'type' => $res['asset'] ? $res['asset']->getType() : null,
-            ]);
-            $response->headers->set('Content-Type', 'text/html');
-            return $response;
-        } catch (\Exception $e) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $e->getMessage(),
-            ]);
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return array
-     *
-     * @throws \Exception
-     */
-    protected function addAsset(Request $request, Config $config)
-    {
-        $defaultUploadPath = $config['assets']['default_upload_path'] ?? '/';
-        if (array_key_exists('Filedata', $_FILES)) {
-            $filename = $_FILES['Filedata']['name'];
-            $sourcePath = $_FILES['Filedata']['tmp_name'];
-        } elseif ($request->get('type') == 'base64') {
-            $filename = $request->get('filename');
-            $sourcePath = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/upload-base64' . uniqid() . '.tmp';
-            $data = preg_replace('@^data:[^,]+;base64,@', '', $request->get('data'));
-            File::put($sourcePath, base64_decode($data));
-        } else {
-            throw new \Exception('The filename of the asset is empty');
-        }
-        $parentId = $request->get('parentId');
-        $parentPath = $request->get('parentPath');
-        if ($request->get('dir') && $request->get('parentId')) {
-            $parent = Asset::getById($request->get('parentId'));
-            $dir = $request->get('dir');
-            if (strpos($dir, '..') !== false) {
-                throw new \Exception('not allowed');
-            }
-            $newPath = $parent->getRealFullPath() . '/' . trim($dir, '/ ');
-            $maxRetries = 5;
-            $newParent = null;
-            for ($retries = 0; $retries < $maxRetries; $retries++) {
-                try {
-                    $newParent = Asset\Service::createFolderByPath($newPath);
-                    break;
-                } catch (\Exception $e) {
-                    if ($retries < ($maxRetries - 1)) {
-                        $waitTime = rand(100000, 900000); // microseconds
-                        usleep($waitTime); // wait specified time until we restart the transaction
-                    } else {
-                        throw $e;
-                    }
-                }
-            }
-            if ($newParent) {
-                $parentId = $newParent->getId();
-            }
-        } elseif (!$request->get('parentId') && $parentPath) {
-            $parent = Asset::getByPath($parentPath);
-            if ($parent instanceof Asset\Folder) {
-                $parentId = $parent->getId();
-            }
-        }
-        $filename = Element\Service::getValidKey($filename, 'asset');
-        if (empty($filename)) {
-            throw new \Exception('The filename of the asset is empty');
-        }
-        $context = $request->get('context');
-        if ($context) {
-            $context = json_decode($context, true);
-            $context = $context ? $context : [];
-            $event = new \Pimcore\Event\Model\Asset\ResolveUploadTargetEvent($parentId, $filename, $context);
-            \Pimcore::getEventDispatcher()->dispatch($event, AssetEvents::RESOLVE_UPLOAD_TARGET);
-            $filename = Element\Service::getValidKey($event->getFilename(), 'asset');
-            $parentId = $event->getParentId();
-        }
-        if (!$parentId) {
-            $parentId = Asset\Service::createFolderByPath($defaultUploadPath)->getId();
-        }
-        $parentAsset = Asset::getById((int)$parentId);
-        $filename = $this->getSafeFilename($parentAsset->getRealFullPath(), $filename);
-        $asset = null;
-        if (!$parentAsset->isAllowed('create')) {
-            throw $this->createAccessDeniedHttpException(
-                'Missing the permission to create new assets in the folder: ' . $parentAsset->getRealFullPath()
-            );
-        }
-        if (is_file($sourcePath) && filesize($sourcePath) < 1) {
-            throw new \Exception('File is empty!');
-        } elseif (!is_file($sourcePath)) {
-            throw new \Exception('Something went wrong, please check upload_max_filesize and post_max_size in your php.ini as well as the write permissions of your temporary directories.');
-        }
-        $asset = Asset::create($parentId, [
-            'filename' => $filename,
-            'sourcePath' => $sourcePath,
-            'userOwner' => $this->getAdminUser()->getId(),
-            'userModification' => $this->getAdminUser()->getId(),
-        ]);
-        @unlink($sourcePath);
-        return [
-            'success' => true,
-            'asset' => $asset,
-        ];
-    }
-    /**
-     * @param string $targetPath
-     * @param string $filename
-     *
-     * @return string
-     */
-    protected function getSafeFilename($targetPath, $filename)
-    {
-        $pathinfo = pathinfo($filename);
-        $originalFilename = $pathinfo['filename'];
-        $originalFileextension = empty($pathinfo['extension']) ? '' : '.' . $pathinfo['extension'];
-        $count = 1;
-        if ($targetPath == '/') {
-            $targetPath = '';
-        }
-        while (true) {
-            if (Asset\Service::pathExists($targetPath . '/' . $filename)) {
-                $filename = $originalFilename . '_' . $count . $originalFileextension;
-                $count++;
-            } else {
-                return $filename;
-            }
-        }
-    }
-    /**
-     * @Route("/replace-asset", name="pimcore_admin_asset_replaceasset", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function replaceAssetAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        $newFilename = Element\Service::getValidKey($_FILES['Filedata']['name'], 'asset');
-        $mimetype = MimeTypes::getDefault()->guessMimeType($_FILES['Filedata']['tmp_name']);
-        $newType = Asset::getTypeFromMimeMapping($mimetype, $newFilename);
-        if ($newType != $asset->getType()) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => sprintf($this->trans('asset_type_change_not_allowed', [], 'admin'), $asset->getType(), $newType),
-            ]);
-        }
-        $stream = fopen($_FILES['Filedata']['tmp_name'], 'r+');
-        $asset->setStream($stream);
-        $asset->setCustomSetting('thumbnails', null);
-        $asset->setUserModification($this->getAdminUser()->getId());
-        $newFileExt = File::getFileExtension($newFilename);
-        $currentFileExt = File::getFileExtension($asset->getFilename());
-        if ($newFileExt != $currentFileExt) {
-            $newFilename = preg_replace('/\.' . $currentFileExt . '$/i', '.' . $newFileExt, $asset->getFilename());
-            $newFilename = Element\Service::getSafeCopyName($newFilename, $asset->getParent());
-            $asset->setFilename($newFilename);
-        }
-        if ($asset->isAllowed('publish')) {
-            $asset->save();
-            $response = $this->adminJson([
-                'id' => $asset->getId(),
-                'path' => $asset->getRealFullPath(),
-                'success' => true,
-            ]);
-            $response->headers->set('Content-Type', 'text/html');
-            return $response;
-        } else {
-            throw new \Exception('missing permission');
-        }
-    }
-    /**
-     * @Route("/add-folder", name="pimcore_admin_asset_addfolder", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addFolderAction(Request $request)
-    {
-        $success = false;
-        $parentAsset = Asset::getById((int)$request->get('parentId'));
-        $equalAsset = Asset::getByPath($parentAsset->getRealFullPath() . '/' . $request->get('name'));
-        if ($parentAsset->isAllowed('create')) {
-            if (!$equalAsset) {
-                $asset = Asset::create($request->get('parentId'), [
-                    'filename' => $request->get('name'),
-                    'type' => 'folder',
-                    'userOwner' => $this->getAdminUser()->getId(),
-                    'userModification' => $this->getAdminUser()->getId(),
-                ]);
-                $success = true;
-            }
-        } else {
-            Logger::debug('prevented creating asset because of missing permissions');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_asset_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteAction(Request $request)
-    {
-        if ($request->get('type') == 'childs') {
-            $parentAsset = Asset::getById($request->get('id'));
-            $list = new Asset\Listing();
-            $list->setCondition('path LIKE ?', [$list->escapeLike($parentAsset->getRealFullPath()) . '/%']);
-            $list->setLimit((int)$request->get('amount'));
-            $list->setOrderKey('LENGTH(path)', false);
-            $list->setOrder('DESC');
-            $deletedItems = [];
-            foreach ($list as $asset) {
-                $deletedItems[$asset->getId()] = $asset->getRealFullPath();
-                if ($asset->isAllowed('delete') && !$asset->isLocked()) {
-                    $asset->delete();
-                }
-            }
-            return $this->adminJson(['success' => true, 'deleted' => $deletedItems]);
-        } elseif ($request->get('id')) {
-            $asset = Asset::getById($request->get('id'));
-            if ($asset && $asset->isAllowed('delete')) {
-                if ($asset->isLocked()) {
-                    return $this->adminJson([
-                        'success' => false,
-                        'message' => 'prevented deleting asset, because it is locked: ID: ' . $asset->getId(),
-                    ]);
-                } else {
-                    $asset->delete();
-                    return $this->adminJson(['success' => true]);
-                }
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param Asset $element
-     *
-     * @return array
-     */
-    protected function getTreeNodeConfig($element)
-    {
-        $asset = $element;
-        $tmpAsset = [
-            'id' => $asset->getId(),
-            'text' => htmlspecialchars($asset->getFilename()),
-            'type' => $asset->getType(),
-            'path' => $asset->getRealFullPath(),
-            'basePath' => $asset->getRealPath(),
-            'locked' => $asset->isLocked(),
-            'lockOwner' => $asset->getLocked() ? true : false,
-            'elementType' => 'asset',
-            'permissions' => [
-                'remove' => $asset->isAllowed('delete'),
-                'settings' => $asset->isAllowed('settings'),
-                'rename' => $asset->isAllowed('rename'),
-                'publish' => $asset->isAllowed('publish'),
-                'view' => $asset->isAllowed('view'),
-            ],
-        ];
-        if ($asset instanceof Asset\Folder) {
-            $tmpAsset['leaf'] = false;
-            $tmpAsset['expanded'] = !$asset->hasChildren();
-            $tmpAsset['loaded'] = !$asset->hasChildren();
-            $tmpAsset['permissions']['create'] = $asset->isAllowed('create');
-            $tmpAsset['thumbnail'] = $this->getThumbnailUrl($asset);
-        } else {
-            $tmpAsset['leaf'] = true;
-            $tmpAsset['expandable'] = false;
-            $tmpAsset['expanded'] = false;
-        }
-        $this->addAdminStyle($asset, ElementAdminStyleEvent::CONTEXT_TREE, $tmpAsset);
-        if ($asset->getType() == 'image') {
-            try {
-                $tmpAsset['thumbnail'] = $this->getThumbnailUrl($asset);
-                $tmpAsset['thumbnailHdpi'] = $this->getThumbnailUrl($asset, true);
-                if ($asset->getCustomSetting('imageWidth') && $asset->getCustomSetting('imageHeight')) {
-                    $tmpAsset['imageWidth'] = $asset->getCustomSetting('imageWidth');
-                    $tmpAsset['imageHeight'] = $asset->getCustomSetting('imageHeight');
-                }
-            } catch (\Exception $e) {
-                Logger::debug('Cannot get dimensions of image, seems to be broken.');
-            }
-        } elseif ($asset->getType() == 'video') {
-            try {
-                if (\Pimcore\Video::isAvailable()) {
-                    $tmpAsset['thumbnail'] = $this->getThumbnailUrl($asset);
-                    $tmpAsset['thumbnailHdpi'] = $this->getThumbnailUrl($asset, true);
-                }
-            } catch (\Exception $e) {
-                Logger::debug('Cannot get dimensions of video, seems to be broken.');
-            }
-        } elseif ($asset->getType() == 'document') {
-            try {
-                if (\Pimcore\Document::isAvailable() && \Pimcore\Document::isFileTypeSupported($asset->getFilename())) {
-                    $tmpAsset['thumbnail'] = $this->getThumbnailUrl($asset);
-                    $tmpAsset['thumbnailHdpi'] = $this->getThumbnailUrl($asset, true);
-                }
-            } catch (\Exception $e) {
-                Logger::debug('Cannot get dimensions of video, seems to be broken.');
-            }
-        }
-        $tmpAsset['cls'] = '';
-        if ($asset->isLocked()) {
-            $tmpAsset['cls'] .= 'pimcore_treenode_locked ';
-        }
-        if ($asset->getLocked()) {
-            $tmpAsset['cls'] .= 'pimcore_treenode_lockOwner ';
-        }
-        return $tmpAsset;
-    }
-    /**
-     * @param Asset $asset
-     * @param bool $hdpi
-     * @param bool $grid
-     *
-     * @return null|string
-     */
-    protected function getThumbnailUrl(Asset $asset, $hdpi = false, $grid = false)
-    {
-        $params = [
-            'id' => $asset->getId(),
-            'treepreview' => true,
-        ];
-        if ($hdpi) {
-            $params['hdpi'] = true;
-        }
-        if ($grid) {
-            $params['grid'] = true;
-        }
-        if ($asset instanceof Asset\Image) {
-            return $this->generateUrl('pimcore_admin_asset_getimagethumbnail', $params);
-        }
-        if ($asset instanceof Asset\Folder) {
-            return $this->generateUrl('pimcore_admin_asset_getfolderthumbnail', $params);
-        }
-        if ($asset instanceof Asset\Video && \Pimcore\Video::isAvailable()) {
-            return $this->generateUrl('pimcore_admin_asset_getvideothumbnail', $params);
-        }
-        if ($asset instanceof Asset\Document && \Pimcore\Document::isAvailable() && $asset->getPageCount()) {
-            return $this->generateUrl('pimcore_admin_asset_getdocumentthumbnail', $params);
-        }
-        return null;
-    }
-    /**
-     * @Route("/update", name="pimcore_admin_asset_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function updateAction(Request $request)
-    {
-        $success = false;
-        $allowUpdate = true;
-        $updateData = array_merge($request->request->all(), $request->query->all());
-        $asset = Asset::getById($request->get('id'));
-        if ($asset->isAllowed('settings')) {
-            $asset->setUserModification($this->getAdminUser()->getId());
-            if ($request->get('parentId')) {
-                $parentAsset = Asset::getById($request->get('parentId'));
-                if ($asset->getParentId() != $parentAsset->getId()) {
-                    if (!$parentAsset->isAllowed('create')) {
-                        throw new \Exception('Prevented moving asset - no create permission on new parent ');
-                    }
-                    $intendedPath = $parentAsset->getRealPath();
-                    $pKey = $parentAsset->getKey();
-                    if (!empty($pKey)) {
-                        $intendedPath .= $parentAsset->getKey() . '/';
-                    }
-                    $assetWithSamePath = Asset::getByPath($intendedPath . $asset->getKey());
-                    if ($assetWithSamePath != null) {
-                        $allowUpdate = false;
-                    }
-                    if ($asset->isLocked()) {
-                        $allowUpdate = false;
-                    }
-                }
-            }
-            if ($allowUpdate) {
-                if ($request->get('filename') != $asset->getFilename() and !$asset->isAllowed('rename')) {
-                    unset($updateData['filename']);
-                    Logger::debug('prevented renaming asset because of missing permissions ');
-                }
-                $asset->setValues($updateData);
-                try {
-                    $asset->save();
-                    $success = true;
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            } else {
-                $msg = 'prevented moving asset, asset with same path+key already exists at target location or the asset is locked. ID: ' . $asset->getId();
-                Logger::debug($msg);
-                return $this->adminJson(['success' => $success, 'message' => $msg]);
-            }
-        } elseif ($asset->isAllowed('rename') && $request->get('filename')) {
-            try {
-                $asset->setFilename($request->get('filename'));
-                $asset->save();
-                $success = true;
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        } else {
-            Logger::debug('prevented update asset because of missing permissions ');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/webdav{path}", name="pimcore_admin_webdav", requirements={"path"=".*"})
-     *
-     * @param Request $request
-     */
-    public function webdavAction(Request $request)
-    {
-        $homeDir = Asset::getById(1);
-        try {
-            $publicDir = new Asset\WebDAV\Folder($homeDir);
-            $objectTree = new Asset\WebDAV\Tree($publicDir);
-            $server = new \Sabre\DAV\Server($objectTree);
-            $server->setBaseUri($this->generateUrl('pimcore_admin_webdav', ['path' => '/']));
-            $lockBackend = new \Sabre\DAV\Locks\Backend\PDO(\Pimcore\Db::get()->getWrappedConnection());
-            $lockBackend->tableName = 'webdav_locks';
-            $lockPlugin = new \Sabre\DAV\Locks\Plugin($lockBackend);
-            $server->addPlugin($lockPlugin);
-            $server->addPlugin(new \Sabre\DAV\Browser\Plugin());
-            $server->exec();
-        } catch (\Exception $e) {
-            Logger::error($e);
-        }
-        exit;
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_asset_save", methods={"PUT","POST"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if ($asset->isAllowed('publish')) {
-            if ($request->get('metadata')) {
-                $metadata = $this->decodeJson($request->get('metadata'));
-                $metadataEvent = new GenericEvent($this, [
-                    'id' => $asset->getId(),
-                    'metadata' => $metadata,
-                ]);
-                $eventDispatcher->dispatch($metadataEvent, AdminEvents::ASSET_METADATA_PRE_SET);
-                $metadata = $metadataEvent->getArgument('metadata');
-                $metadataValues = $metadata['values'];
-                $metadataValues = Asset\Service::minimizeMetadata($metadataValues, 'editor');
-                $asset->setMetadataRaw($metadataValues);
-            }
-            if ($request->get('properties')) {
-                $properties = [];
-                $propertiesData = $this->decodeJson($request->get('properties'));
-                if (is_array($propertiesData)) {
-                    foreach ($propertiesData as $propertyName => $propertyData) {
-                        $value = $propertyData['data'];
-                        try {
-                            $property = new Model\Property();
-                            $property->setType($propertyData['type']);
-                            $property->setName($propertyName);
-                            $property->setCtype('asset');
-                            $property->setDataFromEditmode($value);
-                            $property->setInheritable($propertyData['inheritable']);
-                            $properties[$propertyName] = $property;
-                        } catch (\Exception $e) {
-                            Logger::err("Can't add " . $propertyName . ' to asset ' . $asset->getRealFullPath());
-                        }
-                    }
-                    $asset->setProperties($properties);
-                }
-            }
-            $this->applySchedulerDataToElement($request, $asset);
-            if ($request->get('data')) {
-                $asset->setData($request->get('data'));
-            }
-            if ($asset instanceof Asset\Image) {
-                if ($request->get('image')) {
-                    $imageData = $this->decodeJson($request->get('image'));
-                    if (isset($imageData['focalPoint'])) {
-                        $asset->setCustomSetting('focalPointX', $imageData['focalPoint']['x']);
-                        $asset->setCustomSetting('focalPointY', $imageData['focalPoint']['y']);
-                        $asset->removeCustomSetting('disableFocalPointDetection');
-                    }
-                } else {
-                    $asset->removeCustomSetting('focalPointX');
-                    $asset->removeCustomSetting('focalPointY');
-                    $asset->setCustomSetting('disableFocalPointDetection', true);
-                }
-            }
-            $asset->setUserModification($this->getAdminUser()->getId());
-            if ($request->get('task') === 'session') {
-                Asset\Service::saveElementToSession($asset);
-            } else {
-                $asset->save();
-            }
-            $treeData = $this->getTreeNodeConfig($asset);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $asset->getModificationDate(),
-                    'versionCount' => $asset->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @Route("/publish-version", name="pimcore_admin_asset_publishversion", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function publishVersionAction(Request $request)
-    {
-        $version = Model\Version::getById($request->get('id'));
-        $asset = $version->loadData();
-        $currentAsset = Asset::getById($asset->getId());
-        if ($currentAsset->isAllowed('publish')) {
-            try {
-                $asset->setUserModification($this->getAdminUser()->getId());
-                $asset->save();
-                $treeData = $this->getTreeNodeConfig($asset);
-                return $this->adminJson(['success' => true, 'treeData' => $treeData]);
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/show-version", name="pimcore_admin_asset_showversion", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function showVersionAction(Request $request)
-    {
-        $id = (int)$request->get('id');
-        $version = Model\Version::getById($id);
-        if (!$version) {
-            throw $this->createNotFoundException('Version not found');
-        }
-        $asset = $version->loadData();
-        if (!$asset->isAllowed('versions')) {
-            throw $this->createAccessDeniedHttpException('Permission denied, version id [' . $id . ']');
-        }
-        $loader = \Pimcore::getContainer()->get('pimcore.implementation_loader.asset.metadata.data');
-        return $this->render(
-            '@PimcoreAdmin/Admin/Asset/showVersion' . ucfirst($asset->getType()) . '.html.twig',
-            [
-                'asset' => $asset,
-                'loader' => $loader,
-            ]
-        );
-    }
-    /**
-     * @Route("/download", name="pimcore_admin_asset_download", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function downloadAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$asset->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view asset');
-        }
-        $stream = $asset->getStream();
-        return new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, [
-            'Content-Type' => $asset->getMimetype(),
-            'Content-Disposition' => sprintf('attachment; filename="%s"', $asset->getFilename()),
-            'Content-Length' => $asset->getFileSize(),
-        ]);
-    }
-    /**
-     * @Route("/download-image-thumbnail", name="pimcore_admin_asset_downloadimagethumbnail", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadImageThumbnailAction(Request $request)
-    {
-        $image = Asset\Image::getById($request->get('id'));
-        if (!$image) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$image->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view thumbnail');
-        }
-        $config = null;
-        $thumbnail = null;
-        $thumbnailName = $request->get('thumbnail');
-        $thumbnailFile = null;
-        $deleteThumbnail = true;
-        if ($request->get('config')) {
-            $config = $this->decodeJson($request->get('config'));
-        } elseif ($request->get('type')) {
-            $predefined = [
-                'web' => [
-                    'resize_mode' => 'scaleByWidth',
-                    'width' => 3500,
-                    'dpi' => 72,
-                    'format' => 'JPEG',
-                    'quality' => 85,
-                ],
-                'print' => [
-                    'resize_mode' => 'scaleByWidth',
-                    'width' => 6000,
-                    'dpi' => 300,
-                    'format' => 'JPEG',
-                    'quality' => 95,
-                ],
-                'office' => [
-                    'resize_mode' => 'scaleByWidth',
-                    'width' => 1190,
-                    'dpi' => 144,
-                    'format' => 'JPEG',
-                    'quality' => 90,
-                ],
-            ];
-            $config = $predefined[$request->get('type')];
-        } elseif ($thumbnailName) {
-            $thumbnail = $image->getThumbnail($thumbnailName);
-            $deleteThumbnail = false;
-        }
-        if ($config) {
-            $thumbnailConfig = new Asset\Image\Thumbnail\Config();
-            $thumbnailConfig->setName('pimcore-download-' . $image->getId() . '-' . md5($request->get('config')));
-            if ($config['resize_mode'] == 'scaleByWidth') {
-                $thumbnailConfig->addItem('scaleByWidth', [
-                    'width' => $config['width'],
-                ]);
-            } elseif ($config['resize_mode'] == 'scaleByHeight') {
-                $thumbnailConfig->addItem('scaleByHeight', [
-                    'height' => $config['height'],
-                ]);
-            } else {
-                $thumbnailConfig->addItem('resize', [
-                    'width' => $config['width'],
-                    'height' => $config['height'],
-                ]);
-            }
-            $thumbnailConfig->setQuality($config['quality']);
-            $thumbnailConfig->setFormat($config['format']);
-            $thumbnailConfig->setRasterizeSVG(true);
-            if ($thumbnailConfig->getFormat() == 'JPEG') {
-                $thumbnailConfig->setPreserveMetaData(true);
-                if (empty($config['quality'])) {
-                    $thumbnailConfig->setPreserveColor(true);
-                }
-            }
-            $thumbnail = $image->getThumbnail($thumbnailConfig);
-            $thumbnailFile = $thumbnail->getLocalFile();
-            $exiftool = \Pimcore\Tool\Console::getExecutable('exiftool');
-            if ($thumbnailConfig->getFormat() == 'JPEG' && $exiftool && isset($config['dpi']) && $config['dpi']) {
-                $process = new Process([$exiftool, '-overwrite_original', '-xresolution=' . (int)$config['dpi'], '-yresolution=' . (int)$config['dpi'], '-resolutionunit=inches', $thumbnailFile]);
-                $process->run();
-            }
-        }
-        if ($thumbnail) {
-            $thumbnailFile = $thumbnailFile ?: $thumbnail->getLocalFile();
-            $downloadFilename = preg_replace(
-                '/\.' . preg_quote(File::getFileExtension($image->getFilename())) . '$/i',
-                '.' . $thumbnail->getFileExtension(),
-                $image->getFilename()
-            );
-            $downloadFilename = strtolower($downloadFilename);
-            clearstatcache();
-            $response = new BinaryFileResponse($thumbnailFile);
-            $response->headers->set('Content-Type', $thumbnail->getMimeType());
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, $downloadFilename);
-            $this->addThumbnailCacheHeaders($response);
-            $response->deleteFileAfterSend($deleteThumbnail);
-            return $response;
-        }
-        throw $this->createNotFoundException('Thumbnail not found');
-    }
-    /**
-     * @Route("/get-asset", name="pimcore_admin_asset_getasset", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function getAssetAction(Request $request)
-    {
-        $image = Asset::getById((int)$request->get('id'));
-        if (!$image) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$image->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view asset');
-        }
-        $stream = $image->getStream();
-        $response = new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, [
-            'Content-Type' => $image->getMimetype(),
-            'Access-Control-Allow-Origin' => '*',
-        ]);
-        $this->addThumbnailCacheHeaders($response);
-        return $response;
-    }
-    /**
-     * @Route("/get-image-thumbnail", name="pimcore_admin_asset_getimagethumbnail", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse|JsonResponse
-     */
-    public function getImageThumbnailAction(Request $request)
-    {
-        $fileinfo = $request->get('fileinfo');
-        $image = Asset\Image::getById((int)$request->get('id'));
-        if (!$image) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$image->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view thumbnail');
-        }
-        $thumbnailConfig = null;
-        if ($request->get('thumbnail')) {
-            $thumbnailConfig = $image->getThumbnailConfig($request->get('thumbnail'));
-        }
-        if (!$thumbnailConfig) {
-            if ($request->get('config')) {
-                $thumbnailConfig = $image->getThumbnailConfig($this->decodeJson($request->get('config')));
-            } else {
-                $thumbnailConfig = $image->getThumbnailConfig(array_merge($request->request->all(), $request->query->all()));
-            }
-        } else {
-            $thumbnailConfig->setHighResolution(1);
-        }
-        $format = strtolower($thumbnailConfig->getFormat());
-        if ($format == 'source' || $format == 'print') {
-            $thumbnailConfig->setFormat('PNG');
-            $thumbnailConfig->setRasterizeSVG(true);
-        }
-        if ($request->get('treepreview')) {
-            $thumbnailConfig = Asset\Image\Thumbnail\Config::getPreviewConfig((bool)$request->get('hdpi'));
-        }
-        $cropPercent = $request->get('cropPercent');
-        if ($cropPercent && filter_var($cropPercent, FILTER_VALIDATE_BOOLEAN)) {
-            $thumbnailConfig->addItemAt(0, 'cropPercent', [
-                'width' => $request->get('cropWidth'),
-                'height' => $request->get('cropHeight'),
-                'y' => $request->get('cropTop'),
-                'x' => $request->get('cropLeft'),
-            ]);
-            $hash = md5(Tool\Serialize::serialize(array_merge($request->request->all(), $request->query->all())));
-            $thumbnailConfig->setName($thumbnailConfig->getName() . '_auto_' . $hash);
-        }
-        $thumbnail = $image->getThumbnail($thumbnailConfig);
-        if ($fileinfo) {
-            return $this->adminJson([
-                'width' => $thumbnail->getWidth(),
-                'height' => $thumbnail->getHeight(), ]);
-        }
-        $stream = $thumbnail->getStream();
-        $response = new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, [
-            'Content-Type' => $thumbnail->getMimeType(),
-            'Access-Control-Allow-Origin', '*',
-        ]);
-        $this->addThumbnailCacheHeaders($response);
-        return $response;
-    }
-    /**
-     * @Route("/get-folder-thumbnail", name="pimcore_admin_asset_getfolderthumbnail", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse|StreamedResponse
-     */
-    public function getFolderThumbnailAction(Request $request)
-    {
-        $folder = null;
-        if ($request->get('id')) {
-            $folder = Asset\Folder::getById((int)$request->get('id'));
-            if ($folder instanceof  Asset\Folder) {
-                if (!$folder->isAllowed('view')) {
-                    throw $this->createAccessDeniedException('not allowed to view thumbnail');
-                }
-                $stream = $folder->getPreviewImage((bool)$request->get('hdpi'));
-                if (!$stream) {
-                    $response = new BinaryFileResponse(PIMCORE_PATH . '/bundles/AdminBundle/Resources/public/img/blank.png');
-                } else {
-                    $response = new StreamedResponse(function () use ($stream) {
-                        fpassthru($stream);
-                    }, 200, [
-                        'Content-Type' => 'image/jpg',
-                    ]);
-                }
-                $this->addThumbnailCacheHeaders($response);
-                return $response;
-            }
-        }
-        throw $this->createNotFoundException('could not load asset folder');
-    }
-    /**
-     * @Route("/get-video-thumbnail", name="pimcore_admin_asset_getvideothumbnail", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function getVideoThumbnailAction(Request $request)
-    {
-        $video = null;
-        if ($request->get('id')) {
-            $video = Asset\Video::getById((int)$request->get('id'));
-        } elseif ($request->get('path')) {
-            $video = Asset\Video::getByPath($request->get('path'));
-        }
-        if (!$video) {
-            throw $this->createNotFoundException('could not load video asset');
-        }
-        if (!$video->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view thumbnail');
-        }
-        $thumbnail = array_merge($request->request->all(), $request->query->all());
-        if ($request->get('treepreview')) {
-            $thumbnail = Asset\Image\Thumbnail\Config::getPreviewConfig((bool)$request->get('hdpi'));
-        }
-        $time = null;
-        if ($request->get('time')) {
-            $time = (int)$request->get('time');
-        }
-        if ($request->get('settime')) {
-            $video->removeCustomSetting('image_thumbnail_asset');
-            $video->setCustomSetting('image_thumbnail_time', $time);
-            $video->save();
-        }
-        $image = null;
-        if ($request->get('image')) {
-            $image = Asset\Image::getById((int)$request->get('image'));
-        }
-        if ($request->get('setimage') && $image) {
-            $video->removeCustomSetting('image_thumbnail_time');
-            $video->setCustomSetting('image_thumbnail_asset', $image->getId());
-            $video->save();
-        }
-        $thumb = $video->getImageThumbnail($thumbnail, $time, $image);
-        $stream = $thumb->getStream();
-        $response = new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, [
-            'Content-Type' => 'image/' . $thumb->getFileExtension(),
-        ]);
-        $this->addThumbnailCacheHeaders($response);
-        return $response;
-    }
-    /**
-     * @Route("/get-document-thumbnail", name="pimcore_admin_asset_getdocumentthumbnail", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse|BinaryFileResponse
-     */
-    public function getDocumentThumbnailAction(Request $request)
-    {
-        $document = Asset\Document::getById((int)$request->get('id'));
-        if (!$document) {
-            throw $this->createNotFoundException('could not load document asset');
-        }
-        if (!$document->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view thumbnail');
-        }
-        $thumbnail = Asset\Image\Thumbnail\Config::getByAutoDetect(array_merge($request->request->all(), $request->query->all()));
-        $format = strtolower($thumbnail->getFormat());
-        if ($format == 'source') {
-            $thumbnail->setFormat('jpeg'); // default format for documents is JPEG not PNG (=too big)
-        }
-        if ($request->get('treepreview')) {
-            $thumbnail = Asset\Image\Thumbnail\Config::getPreviewConfig((bool)$request->get('hdpi'));
-        }
-        $page = 1;
-        if (is_numeric($request->get('page'))) {
-            $page = (int)$request->get('page');
-        }
-        $thumb = $document->getImageThumbnail($thumbnail, $page);
-        $stream = $thumb->getStream();
-        if ($stream) {
-            $response = new StreamedResponse(function () use ($stream) {
-                fpassthru($stream);
-            }, 200, [
-                'Content-Type' => 'image/' . $thumb->getFileExtension(),
-            ]);
-        } else {
-            $response = new BinaryFileResponse(PIMCORE_PATH . '/bundles/AdminBundle/Resources/public/img/filetype-not-supported.svg');
-        }
-        $this->addThumbnailCacheHeaders($response);
-        return $response;
-    }
-    /**
-     * @param Response $response
-     */
-    protected function addThumbnailCacheHeaders(Response $response)
-    {
-        $lifetime = 300;
-        $date = new \DateTime('now');
-        $date->add(new \DateInterval('PT' . $lifetime . 'S'));
-        $response->setMaxAge($lifetime);
-        $response->setPublic();
-        $response->setExpires($date);
-        $response->headers->set('Pragma', '');
-    }
-    /**
-     * @Route("/get-preview-document", name="pimcore_admin_asset_getpreviewdocument", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function getPreviewDocumentAction(Request $request)
-    {
-        $asset = Asset\Document::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('could not load document asset');
-        }
-        if ($asset->isAllowed('view')) {
-            $stream = $this->getDocumentPreviewPdf($asset);
-            if ($stream) {
-                return new StreamedResponse(function () use ($stream) {
-                    fpassthru($stream);
-                }, 200, [
-                    'Content-Type' => 'application/pdf',
-                ]);
-            } else {
-                throw $this->createNotFoundException('Unable to get preview for asset ' . $asset->getId());
-            }
-        } else {
-            throw $this->createAccessDeniedException('Access to asset ' . $asset->getId() . ' denied');
-        }
-    }
-    /**
-     * @param Asset\Document $asset
-     *
-     * @return resource|null
-     */
-    protected function getDocumentPreviewPdf(Asset\Document $asset)
-    {
-        $stream = null;
-        if ($asset->getMimetype() == 'application/pdf') {
-            $stream = $asset->getStream();
-        }
-        if (!$stream && $asset->getPageCount() && \Pimcore\Document::isAvailable() && \Pimcore\Document::isFileTypeSupported($asset->getFilename())) {
-            try {
-                $document = \Pimcore\Document::getInstance();
-                $stream = $document->getPdf($asset);
-            } catch (\Exception $e) {
-            }
-        }
-        return $stream;
-    }
-    /**
-     * @Route("/get-preview-video", name="pimcore_admin_asset_getpreviewvideo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function getPreviewVideoAction(Request $request)
-    {
-        $asset = Asset\Video::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('could not load video asset');
-        }
-        if (!$asset->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to preview');
-        }
-        $previewData = ['asset' => $asset];
-        $config = Asset\Video\Thumbnail\Config::getPreviewConfig();
-        $thumbnail = $asset->getThumbnail($config, ['mp4']);
-        if ($thumbnail) {
-            $previewData['asset'] = $asset;
-            $previewData['thumbnail'] = $thumbnail;
-            if ($thumbnail['status'] == 'finished') {
-                return $this->render(
-                    '@PimcoreAdmin/Admin/Asset/getPreviewVideoDisplay.html.twig',
-                    $previewData
-                );
-            } else {
-                return $this->render(
-                    '@PimcoreAdmin/Admin/Asset/getPreviewVideoError.html.twig',
-                    $previewData
-                );
-            }
-        } else {
-            return $this->render(
-                '@PimcoreAdmin/Admin/Asset/getPreviewVideoError.html.twig',
-                $previewData
-            );
-        }
-    }
-    /**
-     * @Route("/serve-video-preview", name="pimcore_admin_asset_servevideopreview", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function serveVideoPreviewAction(Request $request)
-    {
-        $asset = Asset\Video::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('could not load video asset');
-        }
-        if (!$asset->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to preview');
-        }
-        $config = Asset\Video\Thumbnail\Config::getPreviewConfig();
-        $thumbnail = $asset->getThumbnail($config, ['mp4']);
-        $storagePath = $asset->getRealPath() . '/' . preg_replace('@^' . preg_quote($asset->getPath(), '@') . '@', '', urldecode($thumbnail['formats']['mp4']));
-        $storage = Tool\Storage::get('thumbnail');
-        if ($storage->fileExists($storagePath)) {
-            $stream = $storage->readStream($storagePath);
-            return new StreamedResponse(function () use ($stream) {
-                fpassthru($stream);
-            }, 200, [
-                'Content-Type' => 'video/mp4',
-            ]);
-        } else {
-            throw $this->createNotFoundException('Video thumbnail not found');
-        }
-    }
-    /**
-     * @Route("/image-editor", name="pimcore_admin_asset_imageeditor", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function imageEditorAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset->isAllowed('view')) {
-            throw new \Exception('not allowed to preview');
-        }
-        return $this->render(
-            '@PimcoreAdmin/Admin/Asset/imageEditor.html.twig',
-            ['asset' => $asset]
-        );
-    }
-    /**
-     * @Route("/image-editor-save", name="pimcore_admin_asset_imageeditorsave", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function imageEditorSaveAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$asset->isAllowed('publish')) {
-            throw $this->createAccessDeniedException('not allowed to publish');
-        }
-        $data = $request->get('dataUri');
-        $data = substr($data, strpos($data, ','));
-        $data = base64_decode($data);
-        $asset->setData($data);
-        $asset->setUserModification($this->getAdminUser()->getId());
-        $asset->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/get-folder-content-preview", name="pimcore_admin_asset_getfoldercontentpreview", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getFolderContentPreviewAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $filterPrepareEvent = new GenericEvent($this, [
-            'requestParams' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($filterPrepareEvent, AdminEvents::ASSET_LIST_BEFORE_FILTER_PREPARE);
-        $allParams = $filterPrepareEvent->getArgument('requestParams');
-        $folder = Asset::getById($allParams['id']);
-        $start = 0;
-        $limit = 10;
-        if ($allParams['limit']) {
-            $limit = $allParams['limit'];
-        }
-        if ($allParams['start']) {
-            $start = $allParams['start'];
-        }
-        $conditionFilters = [];
-        $list = new Asset\Listing();
-        $conditionFilters[] = 'path LIKE ' . ($folder->getRealFullPath() == '/' ? "'/%'" : $list->quote($list->escapeLike($folder->getRealFullPath()) . '/%')) . " AND type != 'folder'";
-        if (!$this->getAdminUser()->isAdmin()) {
-            $userIds = $this->getAdminUser()->getRoles();
-            $userIds[] = $this->getAdminUser()->getId();
-            $conditionFilters[] = ' (
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                    OR
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                 )';
-        }
-        $condition = implode(' AND ', $conditionFilters);
-        $list->setCondition($condition);
-        $list->setLimit($limit);
-        $list->setOffset($start);
-        $list->setOrderKey('CAST(filename AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci ASC', false);
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $list,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::ASSET_LIST_BEFORE_LIST_LOAD);
-        /** @var Asset\Listing $list */
-        $list = $beforeListLoadEvent->getArgument('list');
-        $list->load();
-        $assets = [];
-        foreach ($list as $asset) {
-            $thumbnailMethod = Asset\Service::getPreviewThumbnail($asset, [], true);
-            if (!empty($thumbnailMethod)) {
-                $filenameDisplay = $asset->getFilename();
-                if (strlen($filenameDisplay) > 32) {
-                    $filenameDisplay = substr($filenameDisplay, 0, 25) . '...' . \Pimcore\File::getFileExtension($filenameDisplay);
-                }
-                if ($asset->isAllowed('list')) {
-                    $assets[] = [
-                        'id' => $asset->getId(),
-                        'type' => $asset->getType(),
-                        'filename' => $asset->getFilename(),
-                        'filenameDisplay' => htmlspecialchars($filenameDisplay),
-                        'url' => $this->getThumbnailUrl($asset, true, true),
-                        'idPath' => $data['idPath'] = Element\Service::getIdPath($asset),
-                    ];
-                }
-            }
-        }
-        $result = ['data' => $assets, 'success' => true, 'total' => $list->getTotalCount()];
-        $afterListLoadEvent = new GenericEvent($this, [
-            'list' => $result,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::ASSET_LIST_AFTER_LIST_LOAD);
-        $result = $afterListLoadEvent->getArgument('list');
-        return $this->adminJson(['assets' => $result['data'], 'success' => $result['success'], 'total' => $result['total']]);
-    }
-    /**
-     * @Route("/copy-info", name="pimcore_admin_asset_copyinfo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyInfoAction(Request $request)
-    {
-        $transactionId = time();
-        $pasteJobs = [];
-        Tool\Session::useSession(function (AttributeBagInterface $session) use ($transactionId) {
-            $session->set($transactionId, []);
-        }, 'pimcore_copy');
-        if ($request->get('type') == 'recursive') {
-            $asset = Asset::getById($request->get('sourceId'));
-            if (!$asset) {
-                throw $this->createNotFoundException('Source not found');
-            }
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_asset_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => 'child',
-                    'transactionId' => $transactionId,
-                    'saveParentId' => true,
-                ],
-            ]];
-            if ($asset->hasChildren()) {
-                $list = new Asset\Listing();
-                $list->setCondition('path LIKE ?', [$list->escapeLike($asset->getRealFullPath()) . '/%']);
-                $list->setOrderKey('LENGTH(path)', false);
-                $list->setOrder('ASC');
-                $childIds = $list->loadIdList();
-                if (count($childIds) > 0) {
-                    foreach ($childIds as $id) {
-                        $pasteJobs[] = [[
-                            'url' => $this->generateUrl('pimcore_admin_asset_copy'),
-                            'method' => 'POST',
-                            'params' => [
-                                'sourceId' => $id,
-                                'targetParentId' => $request->get('targetId'),
-                                'sourceParentId' => $request->get('sourceId'),
-                                'type' => 'child',
-                                'transactionId' => $transactionId,
-                            ],
-                        ]];
-                    }
-                }
-            }
-        } elseif ($request->get('type') == 'child' || $request->get('type') == 'replace') {
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_asset_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => $request->get('type'),
-                    'transactionId' => $transactionId,
-                ],
-            ]];
-        }
-        return $this->adminJson([
-            'pastejobs' => $pasteJobs,
-        ]);
-    }
-    /**
-     * @Route("/copy", name="pimcore_admin_asset_copy", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyAction(Request $request)
-    {
-        $success = false;
-        $sourceId = (int)$request->get('sourceId');
-        $source = Asset::getById($sourceId);
-        $session = Tool\Session::get('pimcore_copy');
-        $sessionBag = $session->get($request->get('transactionId'));
-        $targetId = (int)$request->get('targetId');
-        if ($request->get('targetParentId')) {
-            $sourceParent = Asset::getById($request->get('sourceParentId'));
-            if ($sessionBag['parentId']) {
-                $targetParent = Asset::getById($sessionBag['parentId']);
-            } else {
-                $targetParent = Asset::getById($request->get('targetParentId'));
-            }
-            $targetPath = preg_replace('@^' . $sourceParent->getRealFullPath() . '@', $targetParent . '/', $source->getRealPath());
-            $target = Asset::getByPath($targetPath);
-        } else {
-            $target = Asset::getById($targetId);
-        }
-        if (!$target) {
-            throw $this->createNotFoundException('Target not found');
-        }
-        if ($target->isAllowed('create')) {
-            $source = Asset::getById($sourceId);
-            if ($source != null) {
-                if ($request->get('type') == 'child') {
-                    $newAsset = $this->_assetService->copyAsChild($target, $source);
-                    if ($request->get('saveParentId')) {
-                        $sessionBag['parentId'] = $newAsset->getId();
-                    }
-                } elseif ($request->get('type') == 'replace') {
-                    $this->_assetService->copyContents($target, $source);
-                }
-                $session->set($request->get('transactionId'), $sessionBag);
-                Tool\Session::writeClose();
-                $success = true;
-            } else {
-                Logger::debug('prevended copy/paste because asset with same path+key already exists in this location');
-            }
-        } else {
-            Logger::error('could not execute copy/paste because of missing permissions on target [ ' . $targetId . ' ]');
-            throw $this->createAccessDeniedHttpException();
-        }
-        Tool\Session::writeClose();
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/download-as-zip-jobs", name="pimcore_admin_asset_downloadaszipjobs", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function downloadAsZipJobsAction(Request $request)
-    {
-        $jobId = uniqid();
-        $filesPerJob = 5;
-        $jobs = [];
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if ($asset->isAllowed('view')) {
-            $parentPath = $asset->getRealFullPath();
-            if ($asset->getId() == 1) {
-                $parentPath = '';
-            }
-            $db = \Pimcore\Db::get();
-            $conditionFilters = [];
-            $selectedIds = explode(',', $request->get('selectedIds', ''));
-            $quotedSelectedIds = [];
-            foreach ($selectedIds as $selectedId) {
-                if ($selectedId) {
-                    $quotedSelectedIds[] = $db->quote($selectedId);
-                }
-            }
-            if (!empty($quotedSelectedIds)) {
-                $conditionFilters[] = 'id IN (' . implode(',', $quotedSelectedIds) . ')';
-            }
-            $conditionFilters[] = 'path LIKE ' . $db->quote($db->escapeLike($parentPath) . '/%') . ' AND type != ' . $db->quote('folder');
-            if (!$this->getAdminUser()->isAdmin()) {
-                $userIds = $this->getAdminUser()->getRoles();
-                $userIds[] = $this->getAdminUser()->getId();
-                $conditionFilters[] = ' (
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                    OR
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                 )';
-            }
-            $condition = implode(' AND ', $conditionFilters);
-            $assetList = new Asset\Listing();
-            $assetList->setCondition($condition);
-            $assetList->setOrderKey('LENGTH(path)', false);
-            $assetList->setOrder('ASC');
-            for ($i = 0; $i < ceil($assetList->getTotalCount() / $filesPerJob); $i++) {
-                $jobs[] = [[
-                    'url' => $this->generateUrl('pimcore_admin_asset_downloadaszipaddfiles'),
-                    'method' => 'GET',
-                    'params' => [
-                        'id' => $asset->getId(),
-                        'selectedIds' => implode(',', $selectedIds),
-                        'offset' => $i * $filesPerJob,
-                        'limit' => $filesPerJob,
-                        'jobId' => $jobId,
-                    ],
-                ]];
-            }
-        }
-        return $this->adminJson([
-            'success' => true,
-            'jobs' => $jobs,
-            'jobId' => $jobId,
-        ]);
-    }
-    /**
-     * @Route("/download-as-zip-add-files", name="pimcore_admin_asset_downloadaszipaddfiles", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function downloadAsZipAddFilesAction(Request $request)
-    {
-        $zipFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/download-zip-' . $request->get('jobId') . '.zip';
-        $asset = Asset::getById($request->get('id'));
-        $success = false;
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if ($asset->isAllowed('view')) {
-            $zip = new \ZipArchive();
-            if (!is_file($zipFile)) {
-                $zipState = $zip->open($zipFile, \ZipArchive::CREATE);
-            } else {
-                $zipState = $zip->open($zipFile);
-            }
-            if ($zipState === true) {
-                $parentPath = $asset->getRealFullPath();
-                if ($asset->getId() == 1) {
-                    $parentPath = '';
-                }
-                $db = \Pimcore\Db::get();
-                $conditionFilters = [];
-                $selectedIds = $request->get('selectedIds', []);
-                if (!empty($selectedIds)) {
-                    $selectedIds = explode(',', $selectedIds);
-                    $conditionFilters[] = 'id IN (' . implode(',', $selectedIds) . ')';
-                }
-                $conditionFilters[] = "type != 'folder' AND path LIKE " . $db->quote($db->escapeLike($parentPath) . '/%');
-                if (!$this->getAdminUser()->isAdmin()) {
-                    $userIds = $this->getAdminUser()->getRoles();
-                    $userIds[] = $this->getAdminUser()->getId();
-                    $conditionFilters[] = ' (
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                    OR
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                 )';
-                }
-                $condition = implode(' AND ', $conditionFilters);
-                $assetList = new Asset\Listing();
-                $assetList->setCondition($condition);
-                $assetList->setOrderKey('LENGTH(path) ASC, id ASC', false);
-                $assetList->setOffset((int)$request->get('offset'));
-                $assetList->setLimit((int)$request->get('limit'));
-                foreach ($assetList as $a) {
-                    if ($a->isAllowed('view')) {
-                        if (!$a instanceof Asset\Folder) {
-                            $zip->addFile($a->getLocalFile(), preg_replace('@^' . preg_quote($asset->getRealPath(), '@') . '@i', '', $a->getRealFullPath()));
-                        }
-                    }
-                }
-                $zip->close();
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/download-as-zip", name="pimcore_admin_asset_downloadaszip", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     * Download all assets contained in the folder with parameter id as ZIP file.
-     * The suggested filename is either [folder name].zip or assets.zip for the root folder.
-     */
-    public function downloadAsZipAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        $zipFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/download-zip-' . $request->get('jobId') . '.zip';
-        $suggestedFilename = $asset->getFilename();
-        if (empty($suggestedFilename)) {
-            $suggestedFilename = 'assets';
-        }
-        $response = new BinaryFileResponse($zipFile);
-        $response->headers->set('Content-Type', 'application/zip');
-        $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, $suggestedFilename . '.zip');
-        $response->deleteFileAfterSend(true);
-        return $response;
-    }
-    /**
-     * @Route("/import-zip", name="pimcore_admin_asset_importzip", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function importZipAction(Request $request)
-    {
-        $jobId = uniqid();
-        $filesPerJob = 5;
-        $jobs = [];
-        $asset = Asset::getById($request->get('parentId'));
-        if (!is_file($_FILES['Filedata']['tmp_name'])) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => 'Something went wrong, please check upload_max_filesize and post_max_size in your php.ini as well as the write permissions on the file system',
-            ]);
-        }
-        if (!$asset) {
-            throw $this->createNotFoundException('Parent asset not found');
-        }
-        if (!$asset->isAllowed('create')) {
-            throw $this->createAccessDeniedException('not allowed to create');
-        }
-        $zipFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $jobId . '.zip';
-        copy($_FILES['Filedata']['tmp_name'], $zipFile);
-        $zip = new \ZipArchive;
-        if ($zip->open($zipFile) === true) {
-            $jobAmount = ceil($zip->numFiles / $filesPerJob);
-            for ($i = 0; $i < $jobAmount; $i++) {
-                $jobs[] = [[
-                    'url' => $this->generateUrl('pimcore_admin_asset_importzipfiles'),
-                    'method' => 'POST',
-                    'params' => [
-                        'parentId' => $asset->getId(),
-                        'offset' => $i * $filesPerJob,
-                        'limit' => $filesPerJob,
-                        'jobId' => $jobId,
-                        'last' => (($i + 1) >= $jobAmount) ? 'true' : '',
-                    ],
-                ]];
-            }
-            $zip->close();
-        }
-        $responseJson = $this->encodeJson([
-            'success' => true,
-            'jobs' => $jobs,
-            'jobId' => $jobId,
-        ]);
-        return new Response($responseJson);
-    }
-    /**
-     * @Route("/import-zip-files", name="pimcore_admin_asset_importzipfiles", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function importZipFilesAction(Request $request)
-    {
-        $jobId = $request->get('jobId');
-        $limit = (int)$request->get('limit');
-        $offset = (int)$request->get('offset');
-        $importAsset = Asset::getById($request->get('parentId'));
-        $zipFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $jobId . '.zip';
-        $tmpDir = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/zip-import';
-        if (!is_dir($tmpDir)) {
-            File::mkdir($tmpDir, 0777, true);
-        }
-        $zip = new \ZipArchive;
-        if ($zip->open($zipFile) === true) {
-            for ($i = $offset; $i < ($offset + $limit); $i++) {
-                $path = $zip->getNameIndex($i);
-                if ($path !== false) {
-                    if ($zip->extractTo($tmpDir . '/', $path)) {
-                        $tmpFile = $tmpDir . '/' . preg_replace('@^/@', '', $path);
-                        $filename = Element\Service::getValidKey(basename($path), 'asset');
-                        $relativePath = '';
-                        if (dirname($path) != '.') {
-                            $relativePath = dirname($path);
-                        }
-                        $parentPath = $importAsset->getRealFullPath() . '/' . preg_replace('@^/@', '', $relativePath);
-                        $parent = Asset\Service::createFolderByPath($parentPath);
-                        $filename = $this->getSafeFilename($parent->getRealFullPath(), $filename);
-                        if ($parent->isAllowed('create')) {
-                            $asset = Asset::create($parent->getId(), [
-                                'filename' => $filename,
-                                'sourcePath' => $tmpFile,
-                                'userOwner' => $this->getAdminUser()->getId(),
-                                'userModification' => $this->getAdminUser()->getId(),
-                            ]);
-                            @unlink($tmpFile);
-                        } else {
-                            Logger::debug('prevented creating asset because of missing permissions');
-                        }
-                    }
-                }
-            }
-            $zip->close();
-        }
-        if ($request->get('last')) {
-            unlink($zipFile);
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/import-server", name="pimcore_admin_asset_importserver", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function importServerAction(Request $request)
-    {
-        $success = true;
-        $filesPerJob = 5;
-        $jobs = [];
-        $importDirectory = str_replace('/fileexplorer', PIMCORE_PROJECT_ROOT, $request->get('serverPath'));
-        if (preg_match('@^' . preg_quote(PIMCORE_PROJECT_ROOT, '@') . '@', $importDirectory) && is_dir($importDirectory)) {
-            $this->checkForPharStreamWrapper($importDirectory);
-            $files = rscandir($importDirectory . '/');
-            $count = count($files);
-            $jobFiles = [];
-            for ($i = 0; $i < $count; $i++) {
-                if (is_dir($files[$i])) {
-                    continue;
-                }
-                $jobFiles[] = preg_replace('@^' . preg_quote($importDirectory, '@') . '@', '', $files[$i]);
-                if (count($jobFiles) >= $filesPerJob || $i >= ($count - 1)) {
-                    $relativeImportDirectory = preg_replace('@^' . preg_quote(PIMCORE_PROJECT_ROOT, '@') . '@', '', $importDirectory);
-                    $jobs[] = [[
-                        'url' => $this->generateUrl('pimcore_admin_asset_importserverfiles'),
-                        'method' => 'POST',
-                        'params' => [
-                            'parentId' => $request->get('parentId'),
-                            'serverPath' => $relativeImportDirectory,
-                            'files' => implode('::', $jobFiles),
-                        ],
-                    ]];
-                    $jobFiles = [];
-                }
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'jobs' => $jobs,
-        ]);
-    }
-    /**
-     * @Route("/import-server-files", name="pimcore_admin_asset_importserverfiles", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function importServerFilesAction(Request $request)
-    {
-        $assetFolder = Asset::getById($request->get('parentId'));
-        if (!$assetFolder) {
-            throw $this->createNotFoundException('Parent asset not found');
-        }
-        $serverPath = PIMCORE_PROJECT_ROOT . $request->get('serverPath');
-        $files = explode('::', $request->get('files'));
-        foreach ($files as $file) {
-            $absolutePath = $serverPath . $file;
-            $this->checkForPharStreamWrapper($absolutePath);
-            if (is_file($absolutePath)) {
-                $relFolderPath = str_replace('\\', '/', dirname($file));
-                $folder = Asset\Service::createFolderByPath($assetFolder->getRealFullPath() . $relFolderPath);
-                $filename = basename($file);
-                $filename = Element\Service::getValidKey($filename, 'asset');
-                $filename = $this->getSafeFilename($folder->getRealFullPath(), $filename);
-                if ($assetFolder->isAllowed('create')) {
-                    $asset = Asset::create($folder->getId(), [
-                        'filename' => $filename,
-                        'sourcePath' => $absolutePath,
-                        'userOwner' => $this->getAdminUser()->getId(),
-                        'userModification' => $this->getAdminUser()->getId(),
-                    ]);
-                } else {
-                    Logger::debug('prevented creating asset because of missing permissions ');
-                }
-            }
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    protected function checkForPharStreamWrapper($path)
-    {
-        if (stripos($path, 'phar://') !== false) {
-            throw $this->createAccessDeniedException('Using PHAR files is not allowed!');
-        }
-    }
-    /**
-     * @Route("/import-url", name="pimcore_admin_asset_importurl", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function importUrlAction(Request $request)
-    {
-        $success = true;
-        $data = Tool::getHttpData($request->get('url'));
-        $filename = basename($request->get('url'));
-        $parentId = $request->get('id');
-        $parentAsset = Asset::getById((int)$parentId);
-        if (!$parentAsset) {
-            throw $this->createNotFoundException('Parent asset not found');
-        }
-        $filename = Element\Service::getValidKey($filename, 'asset');
-        $filename = $this->getSafeFilename($parentAsset->getRealFullPath(), $filename);
-        if (empty($filename)) {
-            throw new \Exception('The filename of the asset is empty');
-        }
-        $filename = $this->getSafeFilename($parentAsset->getRealFullPath(), $filename);
-        if ($parentAsset->isAllowed('create')) {
-            $asset = Asset::create($parentId, [
-                'filename' => $filename,
-                'data' => $data,
-                'userOwner' => $this->getAdminUser()->getId(),
-                'userModification' => $this->getAdminUser()->getId(),
-            ]);
-            $success = true;
-        } else {
-            Logger::debug('prevented creating asset because of missing permissions');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/clear-thumbnail", name="pimcore_admin_asset_clearthumbnail", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function clearThumbnailAction(Request $request)
-    {
-        $success = false;
-        if ($asset = Asset::getById($request->get('id'))) {
-            if (method_exists($asset, 'clearThumbnails')) {
-                if (!$asset->isAllowed('publish')) {
-                    throw $this->createAccessDeniedException('not allowed to publish');
-                }
-                $asset->clearThumbnails(true); // force clear
-                $asset->save();
-                $success = true;
-            }
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/grid-proxy", name="pimcore_admin_asset_gridproxy", methods={"GET", "POST", "PUT"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     * @param GridHelperService $gridHelperService
-     * @param CsrfProtectionHandler $csrfProtection
-     *
-     * @return JsonResponse
-     */
-    public function gridProxyAction(Request $request, EventDispatcherInterface $eventDispatcher, GridHelperService $gridHelperService, CsrfProtectionHandler $csrfProtection)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $filterPrepareEvent = new GenericEvent($this, [
-            'requestParams' => $allParams,
-        ]);
-        $language = $request->get('language') != 'default' ? $request->get('language') : null;
-        $eventDispatcher->dispatch($filterPrepareEvent, AdminEvents::ASSET_LIST_BEFORE_FILTER_PREPARE);
-        $allParams = $filterPrepareEvent->getArgument('requestParams');
-        $loader = \Pimcore::getContainer()->get('pimcore.implementation_loader.asset.metadata.data');
-        if (isset($allParams['data']) && $allParams['data']) {
-            $csrfProtection->checkCsrfToken($request);
-            if ($allParams['xaction'] == 'update') {
-                try {
-                    $data = $this->decodeJson($allParams['data']);
-                    $updateEvent = new GenericEvent($this, [
-                        'data' => $data,
-                        'processed' => false,
-                    ]);
-                    $eventDispatcher->dispatch($updateEvent, AdminEvents::ASSET_LIST_BEFORE_UPDATE);
-                    $processed = $updateEvent->getArgument('processed');
-                    if ($processed) {
-                        return $this->adminJson(['success' => true]);
-                    }
-                    $data = $updateEvent->getArgument('data');
-                    $asset = Asset::getById($data['id']);
-                    if (!$asset) {
-                        throw $this->createNotFoundException('Asset not found');
-                    }
-                    if (!$asset->isAllowed('publish')) {
-                        throw $this->createAccessDeniedException("Permission denied. You don't have the rights to save this asset.");
-                    }
-                    $metadata = $asset->getMetadata(null, null, false, true);
-                    $dirty = false;
-                    unset($data['id']);
-                    foreach ($data as $key => $value) {
-                        $fieldDef = explode('~', $key);
-                        $key = $fieldDef[0];
-                        if (isset($fieldDef[1])) {
-                            $language = ($fieldDef[1] == 'none' ? '' : $fieldDef[1]);
-                        }
-                        foreach ($metadata as $idx => &$em) {
-                            if ($em['name'] == $key && $em['language'] == $language) {
-                                try {
-                                    $dataImpl = $loader->build($em['type']);
-                                    $value = $dataImpl->getDataFromListfolderGrid($value, $em);
-                                } catch (UnsupportedException $le) {
-                                    Logger::error('could not resolve metadata implementation for ' . $em['type']);
-                                }
-                                $em['data'] = $value;
-                                $dirty = true;
-                                break;
-                            }
-                        }
-                        if (!$dirty) {
-                            $defaulMetadata = ['title', 'alt', 'copyright'];
-                            if (in_array($key, $defaulMetadata)) {
-                                $newEm = [
-                                    'name' => $key,
-                                    'language' => $language,
-                                    'type' => 'input',
-                                    'data' => $value,
-                                ];
-                                try {
-                                    $dataImpl = $loader->build($newEm['type']);
-                                    $newEm['data'] = $dataImpl->getDataFromListfolderGrid($value, $newEm);
-                                } catch (UnsupportedException $le) {
-                                    Logger::error('could not resolve metadata implementation for ' . $newEm['type']);
-                                }
-                                $metadata[] = $newEm;
-                                $dirty = true;
-                            } else {
-                                $predefined = Model\Metadata\Predefined::getByName($key);
-                                if ($predefined && (empty($predefined->getTargetSubtype())
-                                        || $predefined->getTargetSubtype() == $asset->getType())) {
-                                    $newEm = [
-                                        'name' => $key,
-                                        'language' => $language,
-                                        'type' => $predefined->getType(),
-                                        'data' => $value,
-                                    ];
-                                    try {
-                                        $dataImpl = $loader->build($newEm['type']);
-                                        $newEm['data'] = $dataImpl->getDataFromListfolderGrid($value, $newEm);
-                                    } catch (UnsupportedException $le) {
-                                        Logger::error('could not resolve metadata implementation for ' . $newEm['type']);
-                                    }
-                                    $metadata[] = $newEm;
-                                    $dirty = true;
-                                }
-                            }
-                        }
-                    }
-                    if ($dirty) {
-                        $asset->setMetadataRaw($metadata);
-                        $asset->save();
-                        return $this->adminJson(['success' => true]);
-                    }
-                    return $this->adminJson(['success' => false, 'message' => 'something went wrong.']);
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            }
-        } else {
-            $list = $gridHelperService->prepareAssetListingForGrid($allParams, $this->getAdminUser());
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $list,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::ASSET_LIST_BEFORE_LIST_LOAD);
-            /** @var Asset\Listing $list */
-            $list = $beforeListLoadEvent->getArgument('list');
-            $list->load();
-            $assets = [];
-            foreach ($list->getAssets() as $index => $asset) {
-                if ($asset->isAllowed('list')) {
-                    $a = Asset\Service::gridAssetData($asset, $allParams['fields'], $allParams['language'] ?? '');
-                    $assets[] = $a;
-                }
-            }
-            $result = ['data' => $assets, 'success' => true, 'total' => $list->getTotalCount()];
-            $afterListLoadEvent = new GenericEvent($this, [
-                'list' => $result,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::ASSET_LIST_AFTER_LIST_LOAD);
-            $result = $afterListLoadEvent->getArgument('list');
-            return $this->adminJson($result);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-text", name="pimcore_admin_asset_gettext", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getTextAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if (!$asset) {
-            throw $this->createNotFoundException('Asset not found');
-        }
-        if (!$asset->isAllowed('view')) {
-            throw $this->createAccessDeniedException('not allowed to view');
-        }
-        $page = $request->get('page');
-        $text = null;
-        if ($asset instanceof Asset\Document) {
-            $text = $asset->getText($page);
-        }
-        return $this->adminJson(['success' => 'true', 'text' => $text]);
-    }
-    /**
-     * @Route("/detect-image-features", name="pimcore_admin_asset_detectimagefeatures", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function detectImageFeaturesAction(Request $request)
-    {
-        $asset = Asset\Image::getById((int)$request->get('id'));
-        if (!$asset instanceof Asset) {
-            return $this->adminJson(['success' => false, 'message' => "asset doesn't exist"]);
-        }
-        if ($asset->isAllowed('publish')) {
-            $asset->detectFaces();
-            $asset->removeCustomSetting('disableImageFeatureAutoDetection');
-            $asset->save();
-            return $this->adminJson(['success' => true]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/delete-image-features", name="pimcore_admin_asset_deleteimagefeatures", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteImageFeaturesAction(Request $request)
-    {
-        $asset = Asset::getById((int)$request->get('id'));
-        if (!$asset instanceof Asset) {
-            return $this->adminJson(['success' => false, 'message' => "asset doesn't exist"]);
-        }
-        if ($asset->isAllowed('publish')) {
-            $asset->removeCustomSetting('faceCoordinates');
-            $asset->setCustomSetting('disableImageFeatureAutoDetection', true);
-            $asset->save();
-            return $this->adminJson(['success' => true]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'assets', [
-            'getImageThumbnailAction', 'getVideoThumbnailAction', 'getDocumentThumbnailAction',
-        ]);
-        $this->_assetService = new Asset\Service($this->getAdminUser());
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Asset/AssetHelperController.php
+++ b//dev/null
@@ -1,899 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Asset;
-use PhpOffice\PhpSpreadsheet\Reader\Csv;
-use PhpOffice\PhpSpreadsheet\Writer\Xlsx;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Db;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Loader\ImplementationLoader\Exception\UnsupportedException;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Logger;
-use Pimcore\Model\Asset;
-use Pimcore\Model\Element;
-use Pimcore\Model\GridConfig;
-use Pimcore\Model\GridConfigFavourite;
-use Pimcore\Model\GridConfigShare;
-use Pimcore\Model\Metadata;
-use Pimcore\Model\User;
-use Pimcore\Tool;
-use Pimcore\Version;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/asset-helper")
- *
- * @internal
- */
-class AssetHelperController extends AdminController
-{
-    /**
-     * @param int $userId
-     * @param string $classId
-     * @param string $searchType
-     *
-     * @return GridConfig[]
-     */
-    public function getMyOwnGridColumnConfigs($userId, $classId, $searchType)
-    {
-        $db = Db::get();
-        $configListingConditionParts = [];
-        $configListingConditionParts[] = 'ownerId = ' . $userId;
-        $configListingConditionParts[] = 'classId = ' . $db->quote($classId);
-        if ($searchType) {
-            $configListingConditionParts[] = 'searchType = ' . $db->quote($searchType);
-        }
-        $configCondition = implode(' AND ', $configListingConditionParts);
-        $configListing = new GridConfig\Listing();
-        $configListing->setOrderKey('name');
-        $configListing->setOrder('ASC');
-        $configListing->setCondition($configCondition);
-        $configListing = $configListing->load();
-        return $configListing;
-    }
-    /**
-     * @param User $user
-     * @param string $classId
-     * @param string $searchType
-     *
-     * @return GridConfig[]
-     */
-    public function getSharedGridColumnConfigs($user, $classId, $searchType = null)
-    {
-        $db = Db::get();
-        $configListing = [];
-        $userIds = [$user->getId()];
-        $userIds = array_merge($userIds, $user->getRoles());
-        $userIds = implode(',', $userIds);
-        $query = 'select distinct c1.id from gridconfigs c1, gridconfig_shares s
-                    where (c1.searchType = ' . $db->quote($searchType) . ' and ((c1.id = s.gridConfigId and s.sharedWithUserId IN (' . $userIds . '))) and c1.classId = ' . $db->quote($classId) . ')
-                            UNION distinct select c2.id from gridconfigs c2 where shareGlobally = 1 and c2.classId = '. $db->quote($classId) . '  and c2.ownerId != ' . $db->quote($user->getId());
-        $ids = $db->fetchCol($query);
-        if ($ids) {
-            $ids = implode(',', $ids);
-            $configListing = new GridConfig\Listing();
-            $configListing->setOrderKey('name');
-            $configListing->setOrder('ASC');
-            $configListing->setCondition('id in (' . $ids . ')');
-            $configListing = $configListing->load();
-        }
-        return $configListing;
-    }
-    /**
-     * @Route("/grid-delete-column-config", name="pimcore_admin_asset_assethelper_griddeletecolumnconfig", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridDeleteColumnConfigAction(Request $request)
-    {
-        $gridConfigId = $request->get('gridConfigId');
-        $gridConfig = null;
-        try {
-            $gridConfig = GridConfig::getById($gridConfigId);
-        } catch (\Exception $e) {
-        }
-        $success = false;
-        if ($gridConfig) {
-            if ($gridConfig->getOwnerId() != $this->getAdminUser()->getId()) {
-                throw new \Exception("don't mess with someone elses grid config");
-            }
-            $gridConfig->delete();
-            $success = true;
-        }
-        $newGridConfig = $this->doGetGridColumnConfig($request, true);
-        $newGridConfig['deleteSuccess'] = $success;
-        return $this->adminJson($newGridConfig);
-    }
-    /**
-     * @Route("/grid-get-column-config", name="pimcore_admin_asset_assethelper_gridgetcolumnconfig", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridGetColumnConfigAction(Request $request)
-    {
-        $result = $this->doGetGridColumnConfig($request);
-        return $this->adminJson($result);
-    }
-    /**
-     * @param Request $request
-     * @param bool $isDelete
-     *
-     * @return array
-     */
-    public function doGetGridColumnConfig(Request $request, $isDelete = false)
-    {
-        $gridConfigId = null;
-        $classId = $request->get('id');
-        $type = $request->get('type');
-        $context = ['purpose' => 'gridconfig'];
-        $types = [];
-        if ($request->get('types')) {
-            $types = explode(',', $request->get('types'));
-        }
-        $userId = $this->getAdminUser()->getId();
-        $requestedGridConfigId = $isDelete ? null : $request->get('gridConfigId');
-        $gridConfig = [];
-        $searchType = $request->get('searchType');
-        if (strlen($requestedGridConfigId) == 0) {
-            $favourite = null;
-            try {
-                try {
-                    $favourite = GridConfigFavourite::getByOwnerAndClassAndObjectId($userId, $classId, 0, $searchType);
-                } catch (\Exception $e) {
-                }
-                if ($favourite) {
-                    $requestedGridConfigId = $favourite->getGridConfigId();
-                }
-            } catch (\Exception $e) {
-            }
-        }
-        if (is_numeric($requestedGridConfigId) && $requestedGridConfigId > 0) {
-            $db = Db::get();
-            $configListingConditionParts = [];
-            $configListingConditionParts[] = 'ownerId = ' . $userId;
-            $configListingConditionParts[] = 'classId = ' . $db->quote($classId);
-            $configListingConditionParts[] = 'type = ' . $db->quote($type);
-            if ($searchType) {
-                $configListingConditionParts[] = 'searchType = ' . $db->quote($searchType);
-            }
-            $savedGridConfig = null;
-            try {
-                $savedGridConfig = GridConfig::getById($requestedGridConfigId);
-            } catch (\Exception $e) {
-            }
-            if ($savedGridConfig) {
-                $shared = null;
-                try {
-                    $userIds = [$this->getAdminUser()->getId()];
-                    if ($this->getAdminUser()->getRoles()) {
-                        $userIds = array_merge($userIds, $this->getAdminUser()->getRoles());
-                    }
-                    $userIds = implode(',', $userIds);
-                    $shared = ($savedGridConfig->getOwnerId() != $userId && $savedGridConfig->isShareGlobally()) || $db->fetchOne('select * from gridconfig_shares where sharedWithUserId IN (' . $userIds . ') and gridConfigId = ' . $savedGridConfig->getId());
-                } catch (\Exception $e) {
-                }
-                if (!$shared && $savedGridConfig->getOwnerId() != $this->getAdminUser()->getId()) {
-                    throw new \Exception('you are neither the onwner of this config nor it is shared with you');
-                }
-                $gridConfigId = $savedGridConfig->getId();
-                $gridConfig = $savedGridConfig->getConfig();
-                $gridConfig = json_decode($gridConfig, true);
-                $gridConfigName = $savedGridConfig->getName();
-                $gridConfigDescription = $savedGridConfig->getDescription();
-                $sharedGlobally = $savedGridConfig->isShareGlobally();
-            }
-        }
-        $availableFields = [];
-        $language = '';
-        if (empty($gridConfig)) {
-            $availableFields = $this->getDefaultGridFields(
-                $request->get('no_system_columns'),
-                null, //maybe required for types other than metadata
-                $context,
-                $types);
-        } else {
-            $savedColumns = $gridConfig['columns'];
-            foreach ($savedColumns as $key => $sc) {
-                if (!$sc['hidden']) {
-                    $colConfig = $this->getFieldGridConfig($sc, $language, null);
-                    if ($colConfig) {
-                        $availableFields[] = $colConfig;
-                    }
-                }
-            }
-        }
-        usort($availableFields, function ($a, $b) {
-            if ($a['position'] == $b['position']) {
-                return 0;
-            }
-            return ($a['position'] < $b['position']) ? -1 : 1;
-        });
-        $availableConfigs = $classId ? $this->getMyOwnGridColumnConfigs($userId, $classId, $searchType) : [];
-        $sharedConfigs = $classId ? $this->getSharedGridColumnConfigs($this->getAdminUser(), $classId, $searchType) : [];
-        $settings = $this->getShareSettings((int)$gridConfigId);
-        $settings['gridConfigId'] = (int)$gridConfigId;
-        $settings['gridConfigName'] = $gridConfigName ?? null;
-        $settings['gridConfigDescription'] = $gridConfigDescription ?? null;
-        $settings['shareGlobally'] = $sharedGlobally ?? null;
-        $settings['isShared'] = !$gridConfigId || ($shared ?? null);
-        $context = $gridConfig['context'] ?? null;
-        if ($context) {
-            $context = json_decode($context, true);
-        }
-        return [
-            'sortinfo' => isset($gridConfig['sortinfo']) ? $gridConfig['sortinfo'] : false,
-            'availableFields' => $availableFields,
-            'settings' => $settings,
-            'onlyDirectChildren' => isset($gridConfig['onlyDirectChildren']) ? $gridConfig['onlyDirectChildren'] : false,
-            'onlyUnreferenced' => isset($gridConfig['onlyUnreferenced']) ? $gridConfig['onlyUnreferenced'] : false,
-            'pageSize' => isset($gridConfig['pageSize']) ? $gridConfig['pageSize'] : false,
-            'availableConfigs' => $availableConfigs,
-            'sharedConfigs' => $sharedConfigs,
-            'context' => $context,
-        ];
-    }
-    /**
-     * @param array $field
-     * @param string $language
-     * @param string|null $keyPrefix
-     *
-     * @return array|null
-     */
-    protected function getFieldGridConfig($field, $language = '', $keyPrefix = null)
-    {
-        $defaulMetadataFields = ['copyright', 'alt', 'title'];
-        $predefined = null;
-        if (isset($field['fieldConfig']['layout']['name'])) {
-            $predefined = Metadata\Predefined::getByName($field['fieldConfig']['layout']['name']);
-        }
-        $key = $field['name'];
-        if ($keyPrefix) {
-            $key = $keyPrefix . $key;
-        }
-        $fieldDef = explode('~', $field['name']);
-        $field['name'] = $fieldDef[0];
-        if (isset($fieldDef[1]) && $fieldDef[1] === 'system') {
-            $type = 'system';
-        } elseif (in_array($fieldDef[0], $defaulMetadataFields)) {
-            $type = 'input';
-        } else {
-            $type = $field['fieldConfig']['type'];
-            if (isset($fieldDef[1])) {
-                $field['fieldConfig']['label'] = $field['fieldConfig']['layout']['title'] = $fieldDef[0] . ' (' . $fieldDef[1] . ')';
-                $field['fieldConfig']['layout']['icon'] = Tool::getLanguageFlagFile($fieldDef[1], true);
-            }
-        }
-        $result = [
-            'key' => $key,
-            'type' => $type,
-            'label' => $field['fieldConfig']['label'] ?? $key,
-            'width' => $field['width'],
-            'position' => $field['position'],
-            'language' => $field['fieldConfig']['language'] ?? null,
-            'layout' => $field['fieldConfig']['layout'] ?? null,
-        ];
-        if (isset($field['locked'])) {
-            $result['locked'] = $field['locked'];
-        }
-        if ($type === 'select' && $predefined) {
-            $field['fieldConfig']['layout']['config'] = $predefined->getConfig();
-            $result['layout'] = $field['fieldConfig']['layout'];
-        } elseif ($type === 'document' || $type === 'asset' || $type === 'object') {
-            $result['layout']['fieldtype'] = 'manyToOneRelation';
-            $result['layout']['subtype'] = $type;
-        }
-        return $result;
-    }
-    /**
-     * @param bool $noSystemColumns
-     * @param array $fields
-     * @param array $context
-     * @param array $types
-     *
-     * @return array
-     */
-    public function getDefaultGridFields($noSystemColumns, $fields, $context, $types = [])
-    {
-        $count = 0;
-        $availableFields = [];
-        if (!$noSystemColumns) {
-            foreach (Asset\Service::GRID_SYSTEM_COLUMNS as $sc) {
-                if (empty($types)) {
-                    $availableFields[] = [
-                        'key' => $sc . '~system',
-                        'type' => 'system',
-                        'label' => $sc,
-                        'position' => $count, ];
-                    $count++;
-                }
-            }
-        }
-        return $availableFields;
-    }
-    /**
-     * @Route("/prepare-helper-column-configs", name="pimcore_admin_asset_assethelper_preparehelpercolumnconfigs", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function prepareHelperColumnConfigs(Request $request)
-    {
-        $helperColumns = [];
-        $newData = [];
-        $data = json_decode($request->get('columns'));
-        /** @var \stdClass $item */
-        foreach ($data as $item) {
-            if (!empty($item->isOperator)) {
-                $itemKey = '#' . uniqid();
-                $item->key = $itemKey;
-                $newData[] = $item;
-                $helperColumns[$itemKey] = $item;
-            } else {
-                $newData[] = $item;
-            }
-        }
-        Tool\Session::useSession(function (AttributeBagInterface $session) use ($helperColumns) {
-            $existingColumns = $session->get('helpercolumns', []);
-            $helperColumns = array_merge($helperColumns, $existingColumns);
-            $session->set('helpercolumns', $helperColumns);
-        }, 'pimcore_gridconfig');
-        return $this->adminJson(['success' => true, 'columns' => $newData]);
-    }
-    /**
-     * @Route("/grid-mark-favourite-column-config", name="pimcore_admin_asset_assethelper_gridmarkfavouritecolumnconfig", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridMarkFavouriteColumnConfigAction(Request $request)
-    {
-        $classId = $request->get('classId');
-        $asset = Asset::getById($classId);
-        if ($asset->isAllowed('list')) {
-            $gridConfigId = $request->get('gridConfigId');
-            $searchType = $request->get('searchType');
-            $type = $request->get('type');
-            $user = $this->getAdminUser();
-            $favourite = new GridConfigFavourite();
-            $favourite->setOwnerId($user->getId());
-            $favourite->setClassId($classId);
-            $favourite->setSearchType($searchType);
-            $favourite->setType($type);
-            $specializedConfigs = false;
-            try {
-                if ($gridConfigId != 0) {
-                    $gridConfig = GridConfig::getById($gridConfigId);
-                    $favourite->setGridConfigId($gridConfig->getId());
-                }
-                $favourite->setObjectId(0);
-                $favourite->save();
-            } catch (\Exception $e) {
-                $favourite->delete();
-            }
-            return $this->adminJson(['success' => true, 'spezializedConfigs' => $specializedConfigs]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param int $gridConfigId
-     *
-     * @return array
-     */
-    protected function getShareSettings($gridConfigId)
-    {
-        $result = [
-            'sharedUserIds' => [],
-            'sharedRoleIds' => [],
-        ];
-        $db = Db::get();
-        $allShares = $db->fetchAll('select s.sharedWithUserId, u.type from gridconfig_shares s, users u
-                      where s.sharedWithUserId = u.id and s.gridConfigId = ' . $gridConfigId);
-        if ($allShares) {
-            foreach ($allShares as $share) {
-                $type = $share['type'];
-                $key = 'shared' . ucfirst($type) . 'Ids';
-                $result[$key][] = $share['sharedWithUserId'];
-            }
-        }
-        foreach ($result as $idx => $value) {
-            $value = $value ? implode(',', $value) : '';
-            $result[$idx] = $value;
-        }
-        return $result;
-    }
-    /**
-     * @Route("/grid-save-column-config", name="pimcore_admin_asset_assethelper_gridsavecolumnconfig", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridSaveColumnConfigAction(Request $request)
-    {
-        $asset = Asset::getById($request->get('id'));
-        if ($asset->isAllowed('list')) {
-            try {
-                $classId = $request->get('class_id');
-                $context = $request->get('context');
-                $searchType = $request->get('searchType');
-                $type = $request->get('type');
-                $gridConfigData = $this->decodeJson($request->get('gridconfig'));
-                $gridConfigData['pimcore_version'] = Version::getVersion();
-                $gridConfigData['pimcore_revision'] = Version::getRevision();
-                $gridConfigData['context'] = $context;
-                unset($gridConfigData['settings']['isShared']);
-                $metadata = $request->get('settings');
-                $metadata = json_decode($metadata, true);
-                $gridConfigId = $metadata['gridConfigId'];
-                $gridConfig = null;
-                if ($gridConfigId) {
-                    try {
-                        $gridConfig = GridConfig::getById($gridConfigId);
-                    } catch (\Exception $e) {
-                    }
-                }
-                if ($gridConfig && $gridConfig->getOwnerId() != $this->getAdminUser()->getId()) {
-                    throw new \Exception("don't mess around with somebody else's configuration");
-                }
-                $this->updateGridConfigShares($gridConfig, $metadata);
-                if (!$gridConfig) {
-                    $gridConfig = new GridConfig();
-                    $gridConfig->setName(date('c'));
-                    $gridConfig->setClassId($classId);
-                    $gridConfig->setSearchType($searchType);
-                    $gridConfig->setType($type);
-                    $gridConfig->setOwnerId($this->getAdminUser()->getId());
-                }
-                if ($metadata) {
-                    $gridConfig->setName($metadata['gridConfigName']);
-                    $gridConfig->setDescription($metadata['gridConfigDescription']);
-                    $gridConfig->setShareGlobally($metadata['shareGlobally'] && $this->getAdminUser()->isAdmin());
-                }
-                $gridConfigData = json_encode($gridConfigData);
-                $gridConfig->setConfig($gridConfigData);
-                $gridConfig->save();
-                $userId = $this->getAdminUser()->getId();
-                $availableConfigs = $this->getMyOwnGridColumnConfigs($userId, $classId, $searchType);
-                $sharedConfigs = $this->getSharedGridColumnConfigs($this->getAdminUser(), $classId, $searchType);
-                $settings = $this->getShareSettings($gridConfig->getId());
-                $settings['gridConfigId'] = (int)$gridConfig->getId();
-                $settings['gridConfigName'] = $gridConfig->getName();
-                $settings['gridConfigDescription'] = $gridConfig->getDescription();
-                $settings['shareGlobally'] = $gridConfig->isShareGlobally();
-                $settings['isShared'] = $gridConfig->getOwnerId() != $this->getAdminUser()->getId();
-                return $this->adminJson([
-                    'success' => true,
-                    'settings' => $settings,
-                    'availableConfigs' => $availableConfigs,
-                    'sharedConfigs' => $sharedConfigs,
-                ]);
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param GridConfig|null $gridConfig
-     * @param array $metadata
-     *
-     * @throws \Exception
-     */
-    protected function updateGridConfigShares($gridConfig, $metadata)
-    {
-        $user = $this->getAdminUser();
-        if (!$gridConfig || !$user->isAllowed('share_configurations')) {
-            return;
-        }
-        if ($gridConfig->getOwnerId() != $this->getAdminUser()->getId()) {
-            throw new \Exception("don't mess with someone elses grid config");
-        }
-        $combinedShares = [];
-        $sharedUserIds = $metadata['sharedUserIds'];
-        $sharedRoleIds = $metadata['sharedRoleIds'];
-        if ($sharedUserIds) {
-            $combinedShares = explode(',', $sharedUserIds);
-        }
-        if ($sharedRoleIds) {
-            $sharedRoleIds = explode(',', $sharedRoleIds);
-            $combinedShares = array_merge($combinedShares, $sharedRoleIds);
-        }
-        $db = Db::get();
-        $db->delete('gridconfig_shares', ['gridConfigId' => $gridConfig->getId()]);
-        foreach ($combinedShares as $id) {
-            $share = new GridConfigShare();
-            $share->setGridConfigId($gridConfig->getId());
-            $share->setSharedWithUserId($id);
-            $share->save();
-        }
-    }
-    /**
-     * @Route("/get-export-jobs", name="pimcore_admin_asset_assethelper_getexportjobs", methods={"GET"})
-     *
-     * @param Request $request
-     * @param GridHelperService $gridHelperService
-     *
-     * @return JsonResponse
-     */
-    public function getExportJobsAction(Request $request, GridHelperService $gridHelperService)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $list = $gridHelperService->prepareAssetListingForGrid($allParams, $this->getAdminUser());
-        if (empty($ids = $allParams['ids'] ?? '')) {
-            $ids = $list->loadIdList();
-        }
-        $jobs = array_chunk($ids, 20);
-        $fileHandle = uniqid('asset-export-');
-        file_put_contents($this->getCsvFile($fileHandle), '');
-        return $this->adminJson(['success' => true, 'jobs' => $jobs, 'fileHandle' => $fileHandle]);
-    }
-    /**
-     * @Route("/do-export", name="pimcore_admin_asset_assethelper_doexport", methods={"POST"})
-     *
-     * @param Request $request
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return JsonResponse
-     */
-    public function doExportAction(Request $request, LocaleServiceInterface $localeService)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $ids = $request->get('ids');
-        $settings = $request->get('settings');
-        $settings = json_decode($settings, true);
-        $delimiter = $settings['delimiter'] ? $settings['delimiter'] : ';';
-        $language = str_replace('default', '', $request->get('language'));
-        $list = new Asset\Listing();
-        $quotedIds = [];
-        foreach ($ids as $id) {
-            $quotedIds[] = $list->quote($id);
-        }
-        $list->setCondition('id IN (' . implode(',', $quotedIds) . ')');
-        $list->setOrderKey(' FIELD(id, ' . implode(',', $quotedIds) . ')', false);
-        $fields = $request->get('fields');
-        $addTitles = $request->get('initial');
-        $csv = $this->getCsvData($request, $language, $list, $fields, $addTitles);
-        $fp = fopen($this->getCsvFile($fileHandle), 'a');
-        $firstLine = true;
-        foreach ($csv as $line) {
-            if ($addTitles && $firstLine) {
-                $firstLine = false;
-                $line = implode($delimiter, $line) . "\r\n";
-                fwrite($fp, $line);
-            } else {
-                fwrite($fp, implode($delimiter, array_map([$this, 'encodeFunc'], $line)) . "\r\n");
-            }
-        }
-        fclose($fp);
-        return $this->adminJson(['success' => true]);
-    }
-    public function encodeFunc($value)
-    {
-        $value = str_replace('"', '""', $value);
-        return '"' . $value . '"';
-    }
-    /**
-     * @param Request $request
-     * @param string $language
-     * @param Asset\Listing $list
-     * @param array $fields
-     * @param bool $addTitles
-     *
-     * @return array
-     */
-    protected function getCsvData(Request $request, $language, $list, $fields, $addTitles = true)
-    {
-        $csv = [];
-        $unsupportedFields = ['preview~system', 'size~system'];
-        $fields = array_diff($fields, $unsupportedFields);
-        if ($addTitles) {
-            $columns = $fields;
-            foreach ($columns as $columnIdx => $columnKey) {
-                $columns[$columnIdx] = '"' . $columnKey . '"';
-            }
-            $csv[] = $columns;
-        }
-        foreach ($list->load() as $asset) {
-            if ($fields) {
-                $dataRows = [];
-                foreach ($fields as $field) {
-                    $fieldDef = explode('~', $field);
-                    $getter = 'get' . ucfirst($fieldDef[0]);
-                    if (isset($fieldDef[1])) {
-                        if ($fieldDef[1] == 'system' && method_exists($asset, $getter)) {
-                            $data = $asset->$getter($language);
-                        } else {
-                            $fieldDef[1] = str_replace('none', '', $fieldDef[1]);
-                            $data = $asset->getMetadata($fieldDef[0], $fieldDef[1], true);
-                        }
-                    } else {
-                        $data = $asset->getMetadata($field, $language, true);
-                    }
-                    if ($data instanceof Element\ElementInterface) {
-                        $data = $data->getRealFullPath();
-                    }
-                    $dataRows[] = $data;
-                }
-                $csv[] = $dataRows;
-            }
-        }
-        return $csv;
-    }
-    /**
-     * @param Request $request
-     *
-     * @return mixed|string
-     */
-    protected function extractLanguage(Request $request)
-    {
-        $requestedLanguage = $request->get('language');
-        if ($requestedLanguage) {
-            if ($requestedLanguage != 'default') {
-                $request->setLocale($requestedLanguage);
-            }
-        } else {
-            $requestedLanguage = $request->getLocale();
-        }
-        return $requestedLanguage;
-    }
-    /**
-     * @param string $fileHandle
-     *
-     * @return string
-     */
-    protected function getCsvFile($fileHandle)
-    {
-        return PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $fileHandle . '.csv';
-    }
-    /**
-     * @Route("/download-csv-file", name="pimcore_admin_asset_assethelper_downloadcsvfile", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadCsvFileAction(Request $request)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $csvFile = $this->getCsvFile($fileHandle);
-        if (file_exists($csvFile)) {
-            $response = new BinaryFileResponse($csvFile);
-            $response->headers->set('Content-Type', 'application/csv');
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, 'export.csv');
-            $response->deleteFileAfterSend(true);
-            return $response;
-        }
-        throw $this->createNotFoundException('CSV file not found');
-    }
-    /**
-     * @Route("/download-xlsx-file", name="pimcore_admin_asset_assethelper_downloadxlsxfile", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadXlsxFileAction(Request $request)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $csvFile = $this->getCsvFile($fileHandle);
-        if (file_exists($csvFile)) {
-            $csvReader = new Csv();
-            $csvReader->setDelimiter(';');
-            $csvReader->setSheetIndex(0);
-            $spreadsheet = $csvReader->load($csvFile);
-            $writer = new Xlsx($spreadsheet);
-            $xlsxFilename = PIMCORE_SYSTEM_TEMP_DIRECTORY. '/' .$fileHandle. '.xlsx';
-            $writer->save($xlsxFilename);
-            $response = new BinaryFileResponse($xlsxFilename);
-            $response->headers->set('Content-Type', 'application/xlsx');
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, 'export.xlsx');
-            $response->deleteFileAfterSend(true);
-            return $response;
-        }
-        throw $this->createNotFoundException('XLSX file not found');
-    }
-    /**
-     * @Route("/get-metadata-for-column-config", name="pimcore_admin_asset_assethelper_getmetadataforcolumnconfig", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getMetadataForColumnConfigAction(Request $request)
-    {
-        $result = [];
-        $defaultMetadataNames = ['copyright', 'alt', 'title'];
-        foreach ($defaultMetadataNames as $defaultMetadata) {
-            $defaultColumns[] = ['title' => $defaultMetadata, 'name' => $defaultMetadata, 'datatype' => 'data', 'fieldtype' => 'input'];
-        }
-        $result['defaultColumns']['nodeLabel'] = 'default_metadata';
-        $result['defaultColumns']['nodeType'] = 'image';
-        $result['defaultColumns']['childs'] = $defaultColumns;
-        $list = Metadata\Predefined\Listing::getByTargetType('asset', null);
-        $metadataItems = [];
-        $tmp = [];
-        foreach ($list as $item) {
-            $uniqueKey = $item->getName().'_'.$item->getTargetSubtype();
-            if (!in_array($uniqueKey, $tmp) && !in_array($item->getName(), $defaultMetadataNames)) {
-                $tmp[] = $uniqueKey;
-                $item->expand();
-                $metadataItems[] = [
-                    'title' => $item->getName(),
-                    'name' => $item->getName(),
-                    'subtype' => $item->getTargetSubtype(),
-                    'datatype' => 'data',
-                    'fieldtype' => $item->getType(),
-                    'config' => $item->getConfig(),
-                ];
-            }
-        }
-        $result['metadataColumns']['childs'] = $metadataItems;
-        $result['metadataColumns']['nodeLabel'] = 'predefined_metadata';
-        $result['metadataColumns']['nodeType'] = 'metadata';
-        $systemColumnNames = Asset\Service::GRID_SYSTEM_COLUMNS;
-        $systemColumns = [];
-        foreach ($systemColumnNames as $systemColumn) {
-            $systemColumns[] = ['title' => $systemColumn, 'name' => $systemColumn, 'datatype' => 'data', 'fieldtype' => 'system'];
-        }
-        $result['systemColumns']['nodeLabel'] = 'system_columns';
-        $result['systemColumns']['nodeType'] = 'system';
-        $result['systemColumns']['childs'] = $systemColumns;
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/get-batch-jobs", name="pimcore_admin_asset_assethelper_getbatchjobs", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getBatchJobsAction(Request $request, GridHelperService $gridHelperService)
-    {
-        if ($request->get('language')) {
-            $request->setLocale($request->get('language'));
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $list = $gridHelperService->prepareAssetListingForGrid($allParams, $this->getAdminUser());
-        $jobs = $list->loadIdList();
-        return $this->adminJson(['success' => true, 'jobs' => $jobs]);
-    }
-    /**
-     * @Route("/batch", name="pimcore_admin_asset_assethelper_batch", methods={"PUT"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function batchAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        try {
-            if ($request->get('data')) {
-                $loader = \Pimcore::getContainer()->get('pimcore.implementation_loader.asset.metadata.data');
-                $data = $this->decodeJson($request->get('data'), true);
-                $updateEvent = new GenericEvent($this, [
-                    'data' => $data,
-                    'processed' => false,
-                ]);
-                $eventDispatcher->dispatch($updateEvent, AdminEvents::ASSET_LIST_BEFORE_BATCH_UPDATE);
-                $processed = $updateEvent->getArgument('processed');
-                if ($processed) {
-                    return $this->adminJson(['success' => true]);
-                }
-                $language = null;
-                if (isset($data['language'])) {
-                    $language = $data['language'] != 'default' ? $data['language'] : null;
-                }
-                $asset = Asset::getById($data['job']);
-                if ($asset) {
-                    if (!$asset->isAllowed('publish')) {
-                        throw new \Exception("Permission denied. You don't have the rights to save this asset.");
-                    }
-                    $metadata = $asset->getMetadata(null, null, false, true);
-                    $dirty = false;
-                    $name = $data['name'];
-                    $value = $data['value'];
-                    if ($data['valueType'] == 'object') {
-                        $value = $this->decodeJson($value);
-                    }
-                    $fieldDef = explode('~', $name);
-                    $name = $fieldDef[0];
-                    if (count($fieldDef) > 1) {
-                        $language = ($fieldDef[1] == 'none' ? '' : $fieldDef[1]);
-                    }
-                    foreach ($metadata as $idx => &$em) {
-                        if ($em['name'] == $name && $em['language'] == $language) {
-                            try {
-                                $dataImpl = $loader->build($em['type']);
-                                $value = $dataImpl->getDataFromListfolderGrid($value, $em);
-                            } catch (UnsupportedException $le) {
-                                Logger::error('could not resolve metadata implementation for ' . $em['type']);
-                            }
-                            $em['data'] = $value;
-                            $dirty = true;
-                            break;
-                        }
-                    }
-                    if (!$dirty) {
-                        $defaulMetadata = ['title', 'alt', 'copyright'];
-                        if (in_array($name, $defaulMetadata)) {
-                            $newEm = [
-                                'name' => $name,
-                                'language' => $language,
-                                'type' => 'input',
-                                'data' => $value,
-                            ];
-                            try {
-                                $dataImpl = $loader->build($newEm['type']);
-                                $newEm['data'] = $dataImpl->getDataFromListfolderGrid($value, $newEm);
-                            } catch (UnsupportedException $le) {
-                                Logger::error('could not resolve metadata implementation for ' . $newEm['type']);
-                            }
-                            $metadata[] = $newEm;
-                            $dirty = true;
-                        } else {
-                            $predefined = Metadata\Predefined::getByName($name);
-                            if ($predefined && (empty($predefined->getTargetSubtype())
-                                    || $predefined->getTargetSubtype() == $asset->getType())) {
-                                $newEm = [
-                                    'name' => $name,
-                                    'language' => $language,
-                                    'type' => $predefined->getType(),
-                                    'data' => $value,
-                                ];
-                                try {
-                                    $dataImpl = $loader->build($newEm['type']);
-                                    $newEm['data'] = $dataImpl->getDataFromListfolderGrid($value, $newEm);
-                                } catch (UnsupportedException $le) {
-                                    Logger::error('could not resolve metadata implementation for ' . $newEm['type']);
-                                }
-                                $metadata[] = $newEm;
-                                $dirty = true;
-                            }
-                        }
-                    }
-                    try {
-                        if ($dirty) {
-                            $asset->setMetadataRaw($metadata);
-                            $asset->save();
-                            return $this->adminJson(['success' => true]);
-                        }
-                    } catch (\Exception $e) {
-                        return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                    }
-                } else {
-                    Logger::debug('AssetHelperController::batchAction => There is no asset left to update.');
-                    return $this->adminJson(['success' => false, 'message' => 'AssetHelperController::batchAction => There is no asset left to update.']);
-                }
-            }
-        } catch (\Exception $e) {
-            Logger::err($e);
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-        return $this->adminJson(['success' => false, 'message' => 'something went wrong.']);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/ClassController.php
+++ b//dev/null
@@ -1,1567 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Db;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Logger;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Translation;
-use Pimcore\Tool\Session;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/class")
- *
- * @internal
- */
-class ClassController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/get-document-types", name="pimcore_admin_dataobject_class_getdocumenttypes", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDocumentTypesAction(Request $request)
-    {
-        $documentTypes = Document::getTypes();
-        $typeItems = [];
-        foreach ($documentTypes as $documentType) {
-            $typeItems[] = [
-                'text' => $documentType,
-            ];
-        }
-        return $this->adminJson($typeItems);
-    }
-    /**
-     * @Route("/get-asset-types", name="pimcore_admin_dataobject_class_getassettypes", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAssetTypesAction(Request $request)
-    {
-        $assetTypes = Asset::getTypes();
-        $typeItems = [];
-        foreach ($assetTypes as $assetType) {
-            $typeItems[] = [
-                'text' => $assetType,
-            ];
-        }
-        return $this->adminJson($typeItems);
-    }
-    /**
-     * @Route("/get-tree", name="pimcore_admin_dataobject_class_gettree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getTreeAction(Request $request)
-    {
-        $defaultIcon = '/bundles/pimcoreadmin/img/flat-color-icons/class.svg';
-        $classesList = new DataObject\ClassDefinition\Listing();
-        $classesList->setOrderKey('name');
-        $classesList->setOrder('asc');
-        $classes = $classesList->load();
-        if ($request->get('createAllowed')) {
-            $tmpClasses = [];
-            foreach ($classes as $class) {
-                if ($this->getAdminUser()->isAllowed($class->getId(), 'class')) {
-                    $tmpClasses[] = $class;
-                }
-            }
-            $classes = $tmpClasses;
-        }
-        $withId = $request->get('withId');
-        $getClassConfig = function ($class) use ($defaultIcon, $withId) {
-            $text = $class->getname();
-            if ($withId) {
-                $text .= ' (' . $class->getId() . ')';
-            }
-            return [
-                'id' => $class->getId(),
-                'text' => $text,
-                'leaf' => true,
-                'icon' => $class->getIcon() ? $class->getIcon() : $defaultIcon,
-                'cls' => 'pimcore_class_icon',
-                'propertyVisibility' => $class->getPropertyVisibility(),
-                'enableGridLocking' => $class->isEnableGridLocking(),
-            ];
-        };
-        $groups = [];
-        foreach ($classes as $class) {
-            $groupName = null;
-            if ($class->getGroup()) {
-                $type = 'manual';
-                $groupName = $class->getGroup();
-            } else {
-                $type = 'auto';
-                if (preg_match('@^([A-Za-z])([^A-Z]+)@', $class->getName(), $matches)) {
-                    $groupName = $matches[0];
-                }
-                if (!$groupName) {
-                    $groupName = $class->getName();
-                }
-            }
-            $groupName = Translation::getByKeyLocalized($groupName, Translation::DOMAIN_ADMIN, true, true);
-            if (!isset($groups[$groupName])) {
-                $groups[$groupName] = [
-                    'classes' => [],
-                    'type' => $type,
-                ];
-            }
-            $groups[$groupName]['classes'][] = $class;
-        }
-        $treeNodes = [];
-        if (!empty($groups)) {
-            $types = array_column($groups, 'type');
-            array_multisort($types, SORT_ASC, array_keys($groups), SORT_ASC, $groups);
-        }
-        if (!$request->get('grouped')) {
-            foreach ($groups as $groupName => $groupData) {
-                foreach ($groupData['classes'] as $class) {
-                    $node = $getClassConfig($class);
-                    if (count($groupData['classes']) > 1 || $groupData['type'] == 'manual') {
-                        $node['group'] = $groupName;
-                    }
-                    $treeNodes[] = $node;
-                }
-            }
-        } else {
-            foreach ($groups as $groupName => $groupData) {
-                if (count($groupData['classes']) === 1 && $groupData['type'] == 'auto') {
-                    $node = $getClassConfig($groupData['classes'][0]);
-                } else {
-                    $node = [
-                        'id' => 'folder_' . $groupName,
-                        'text' => $groupName,
-                        'leaf' => false,
-                        'expandable' => true,
-                        'allowChildren' => true,
-                        'iconCls' => 'pimcore_icon_folder',
-                        'children' => [],
-                    ];
-                    foreach ($groupData['classes'] as $class) {
-                        $node['children'][] = $getClassConfig($class);
-                    }
-                }
-                $treeNodes[] = $node;
-            }
-        }
-        return $this->adminJson($treeNodes);
-    }
-    /**
-     * @Route("/get", name="pimcore_admin_dataobject_class_get", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAction(Request $request)
-    {
-        $class = DataObject\ClassDefinition::getById($request->get('id'));
-        $class->setFieldDefinitions([]);
-        $isWriteable = $class->isWritable();
-        $class = $class->getObjectVars();
-        $class['isWriteable'] = $isWriteable;
-        return $this->adminJson($class);
-    }
-    /**
-     * @Route("/get-custom-layout", name="pimcore_admin_dataobject_class_getcustomlayout", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getCustomLayoutAction(Request $request)
-    {
-        $customLayout = DataObject\ClassDefinition\CustomLayout::getById($request->get('id'));
-        $isWriteable = $customLayout->isWritable();
-        $customLayout = $customLayout->getObjectVars();
-        $customLayout['isWriteable'] = $isWriteable;
-        return $this->adminJson(['success' => true, 'data' => $customLayout]);
-    }
-    /**
-     * @Route("/add", name="pimcore_admin_dataobject_class_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        $className = $request->get('className');
-        $className = $this->correctClassname($className);
-        $classId = $request->get('classIdentifier');
-        $existingClass = DataObject\ClassDefinition::getById($classId);
-        if ($existingClass) {
-            throw new \Exception('Class identifier already exists');
-        }
-        $class = DataObject\ClassDefinition::create(
-            ['name' => $className,
-                'userOwner' => $this->getAdminUser()->getId(), ]
-        );
-        $class->setId($classId);
-        $class->save(true);
-        return $this->adminJson(['success' => true, 'id' => $class->getId()]);
-    }
-    /**
-     * @Route("/add-custom-layout", name="pimcore_admin_dataobject_class_addcustomlayout", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addCustomLayoutAction(Request $request)
-    {
-        $layoutId = $request->get('layoutIdentifier');
-        $existingLayout = DataObject\ClassDefinition\CustomLayout::getById($layoutId);
-        if ($existingLayout) {
-            throw new \Exception('Custom Layout identifier already exists');
-        }
-        $customLayout = DataObject\ClassDefinition\CustomLayout::create(
-            [
-                'name' => $request->get('layoutName'),
-                'userOwner' => $this->getAdminUser()->getId(),
-                'classId' => $request->get('classId'),
-            ]
-        );
-        $customLayout->setId($layoutId);
-        $customLayout->save();
-        $isWriteable = $customLayout->isWritable();
-        $data = $customLayout->getObjectVars();
-        $data['isWriteable'] = $isWriteable;
-        return $this->adminJson(['success' => true, 'id' => $customLayout->getId(), 'name' => $customLayout->getName(),
-                                 'data' => $data, ]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_dataobject_class_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function deleteAction(Request $request)
-    {
-        $class = DataObject\ClassDefinition::getById($request->get('id'));
-        $class->delete();
-        return new Response();
-    }
-    /**
-     * @Route("/delete-custom-layout", name="pimcore_admin_dataobject_class_deletecustomlayout", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteCustomLayoutAction(Request $request)
-    {
-        $customLayout = DataObject\ClassDefinition\CustomLayout::getById($request->get('id'));
-        if ($customLayout) {
-            $customLayout->delete();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/save-custom-layout", name="pimcore_admin_dataobject_class_savecustomlayout", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function saveCustomLayoutAction(Request $request)
-    {
-        $customLayout = DataObject\ClassDefinition\CustomLayout::getById($request->get('id'));
-        $class = DataObject\ClassDefinition::getById($customLayout->getClassId());
-        $configuration = $this->decodeJson($request->get('configuration'));
-        $values = $this->decodeJson($request->get('values'));
-        $modificationDate = (int)$values['modificationDate'];
-        if ($modificationDate < $customLayout->getModificationDate()) {
-            return $this->adminJson(['success' => false, 'msg' => 'custom_layout_changed']);
-        }
-        $configuration['datatype'] = 'layout';
-        $configuration['fieldtype'] = 'panel';
-        $configuration['name'] = 'pimcore_root';
-        try {
-            $layout = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($configuration, true);
-            $customLayout->setLayoutDefinitions($layout);
-            $customLayout->setName($values['name']);
-            $customLayout->setDescription($values['description']);
-            $customLayout->setDefault($values['default']);
-            $customLayout->save();
-            return $this->adminJson(['success' => true, 'id' => $customLayout->getId(), 'data' => $customLayout->getObjectVars()]);
-        } catch (\Exception $e) {
-            Logger::error($e->getMessage());
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_dataobject_class_save", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $class = DataObject\ClassDefinition::getById($request->get('id'));
-        $configuration = $this->decodeJson($request->get('configuration'));
-        $values = $this->decodeJson($request->get('values'));
-        if ($class->getModificationDate() != $values['modificationDate']) {
-            throw new \Exception('The class was modified during editing, please reload the class and make your changes again');
-        }
-        if ($values['name'] != $class->getName()) {
-            $classByName = DataObject\ClassDefinition::getByName($values['name']);
-            if ($classByName && $classByName->getId() != $class->getId()) {
-                throw new \Exception('Class name already exists');
-            }
-            $values['name'] = $this->correctClassname($values['name']);
-            $class->rename($values['name']);
-        }
-        unset($values['creationDate']);
-        unset($values['userOwner']);
-        unset($values['layoutDefinitions']);
-        unset($values['fieldDefinitions']);
-        $configuration['datatype'] = 'layout';
-        $configuration['fieldtype'] = 'panel';
-        $configuration['name'] = 'pimcore_root';
-        $class->setValues($values);
-        try {
-            $layout = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($configuration, true);
-            $class->setLayoutDefinitions($layout);
-            $class->setUserModification($this->getAdminUser()->getId());
-            $class->setModificationDate(time());
-            $propertyVisibility = [];
-            foreach ($values as $key => $value) {
-                if (preg_match('/propertyVisibility/i', $key)) {
-                    if (preg_match("/\.grid\./i", $key)) {
-                        $propertyVisibility['grid'][preg_replace("/propertyVisibility\.grid\./i", '', $key)] = (bool) $value;
-                    } elseif (preg_match("/\.search\./i", $key)) {
-                        $propertyVisibility['search'][preg_replace("/propertyVisibility\.search\./i", '', $key)] = (bool) $value;
-                    }
-                }
-            }
-            if (!empty($propertyVisibility)) {
-                $class->setPropertyVisibility($propertyVisibility);
-            }
-            $class->save();
-            $class->setFieldDefinitions([]);
-            return $this->adminJson(['success' => true, 'class' => $class]);
-        } catch (\Exception $e) {
-            Logger::error($e->getMessage());
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @param string $name
-     *
-     * @return string
-     */
-    protected function correctClassname($name)
-    {
-        $name = preg_replace('/[^a-zA-Z0-9_]+/', '', $name);
-        $name = preg_replace('/^[0-9]+/', '', $name);
-        return $name;
-    }
-    /**
-     * @Route("/import-class", name="pimcore_admin_dataobject_class_importclass", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function importClassAction(Request $request)
-    {
-        $class = DataObject\ClassDefinition::getById($request->get('id'));
-        $json = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $success = DataObject\ClassDefinition\Service::importClassDefinitionFromJson($class, $json, false, true);
-        $response = $this->adminJson([
-            'success' => $success,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/import-custom-layout-definition", name="pimcore_admin_dataobject_class_importcustomlayoutdefinition", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function importCustomLayoutDefinitionAction(Request $request)
-    {
-        $success = false;
-        $json = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $importData = $this->decodeJson($json);
-        $customLayoutId = $request->get('id');
-        $customLayout = DataObject\ClassDefinition\CustomLayout::getById($customLayoutId);
-        if ($customLayout) {
-            try {
-                $layout = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($importData['layoutDefinitions'], true);
-                $customLayout->setLayoutDefinitions($layout);
-                $customLayout->setDescription($importData['description']);
-                $customLayout->save();
-                $success = true;
-            } catch (\Exception $e) {
-                Logger::error($e->getMessage());
-            }
-        }
-        $response = $this->adminJson([
-            'success' => $success,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/get-custom-layout-definitions", name="pimcore_admin_dataobject_class_getcustomlayoutdefinitions", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getCustomLayoutDefinitionsAction(Request $request)
-    {
-        $classId = $request->get('classId');
-        $list = new DataObject\ClassDefinition\CustomLayout\Listing();
-        $list->setCondition('classId = ' . $list->quote($classId));
-        $list = $list->load();
-        $result = [];
-        foreach ($list as $item) {
-            $result[] = [
-                'id' => $item->getId(),
-                'name' => $item->getName() . ' (ID: ' . $item->getId() . ')',
-                'default' => $item->getDefault() ?: 0,
-            ];
-        }
-        return $this->adminJson(['success' => true, 'data' => $result]);
-    }
-    /**
-     * @Route("/get-all-layouts", name="pimcore_admin_dataobject_class_getalllayouts", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAllLayoutsAction(Request $request)
-    {
-        $resultList = [];
-        $mapping = [];
-        $customLayouts = new DataObject\ClassDefinition\CustomLayout\Listing();
-        $customLayouts->setOrder('ASC');
-        $customLayouts->setOrderKey('name');
-        $customLayouts = $customLayouts->load();
-        foreach ($customLayouts as $layout) {
-            $mapping[$layout->getClassId()][] = $layout;
-        }
-        $classList = new DataObject\ClassDefinition\Listing();
-        $classList->setOrder('ASC');
-        $classList->setOrderKey('name');
-        $classList = $classList->load();
-        foreach ($classList as $class) {
-            if (isset($mapping[$class->getId()])) {
-                $classMapping = $mapping[$class->getId()];
-                $resultList[] = [
-                    'type' => 'master',
-                    'id' => $class->getId() . '_' . 0,
-                    'name' => $class->getName(),
-                ];
-                foreach ($classMapping as $layout) {
-                    $resultList[] = [
-                        'type' => 'custom',
-                        'id' => $class->getId() . '_' . $layout->getId(),
-                        'name' => $class->getName() . ' - ' . $layout->getName(),
-                    ];
-                }
-            }
-        }
-        return $this->adminJson(['data' => $resultList]);
-    }
-    /**
-     * @Route("/export-class", name="pimcore_admin_dataobject_class_exportclass", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function exportClassAction(Request $request)
-    {
-        $id = $request->get('id');
-        $class = DataObject\ClassDefinition::getById($id);
-        if (!$class instanceof DataObject\ClassDefinition) {
-            $errorMessage = ': Class with id [ ' . $id . ' not found. ]';
-            Logger::error($errorMessage);
-            throw $this->createNotFoundException($errorMessage);
-        }
-        $json = DataObject\ClassDefinition\Service::generateClassDefinitionJson($class);
-        $response = new Response($json);
-        $response->headers->set('Content-type', 'application/json');
-        $response->headers->set('Content-Disposition', 'attachment; filename="class_' . $class->getName() . '_export.json"');
-        return $response;
-    }
-    /**
-     * @Route("/export-custom-layout-definition", name="pimcore_admin_dataobject_class_exportcustomlayoutdefinition", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function exportCustomLayoutDefinitionAction(Request $request)
-    {
-        $id = $request->get('id');
-        if ($id) {
-            $customLayout = DataObject\ClassDefinition\CustomLayout::getById($id);
-            if ($customLayout) {
-                $name = $customLayout->getName();
-                $customLayoutData = [
-                    'description' => $customLayout->getDescription(),
-                    'layoutDefinitions' => $customLayout->getLayoutDefinitions(),
-                    'default' => $customLayout->getDefault() ?? 0,
-                ];
-                $json = json_encode($customLayoutData, JSON_PRETTY_PRINT);
-                $response = new Response($json);
-                $response->headers->set('Content-type', 'application/json');
-                $response->headers->set('Content-Disposition', 'attachment; filename="custom_definition_' . $name . '_export.json"');
-                return $response;
-            }
-        }
-        $errorMessage = ': Custom Layout with id [ ' . $id . ' not found. ]';
-        Logger::error($errorMessage);
-        throw $this->createNotFoundException($errorMessage);
-    }
-    /**
-     * FIELDCOLLECTIONS
-     */
-    /**
-     * @Route("/fieldcollection-get", name="pimcore_admin_dataobject_class_fieldcollectionget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fieldcollectionGetAction(Request $request)
-    {
-        $fc = DataObject\Fieldcollection\Definition::getByKey($request->get('id'));
-        $isWriteable = $fc->isWritable();
-        $fc = $fc->getObjectVars();
-        $fc['isWriteable'] = $isWriteable;
-        return $this->adminJson($fc);
-    }
-    /**
-     * @Route("/fieldcollection-update", name="pimcore_admin_dataobject_class_fieldcollectionupdate", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fieldcollectionUpdateAction(Request $request)
-    {
-        try {
-            $key = $request->get('key');
-            $title = $request->get('title');
-            $group = $request->get('group');
-            if ($request->get('task') == 'add') {
-                $list = new DataObject\Fieldcollection\Definition\Listing();
-                $list = $list->load();
-                foreach ($list as $item) {
-                    if (strtolower($key) === strtolower($item->getKey())) {
-                        throw new \Exception('FieldCollection with the same name already exists (lower/upper cases may be different)');
-                    }
-                }
-            }
-            $fcDef = new DataObject\Fieldcollection\Definition();
-            $fcDef->setKey($key);
-            $fcDef->setTitle($title);
-            $fcDef->setGroup($group);
-            if ($request->get('values')) {
-                $values = $this->decodeJson($request->get('values'));
-                $fcDef->setParentClass($values['parentClass']);
-                $fcDef->setImplementsInterfaces($values['implementsInterfaces']);
-                $fcDef->setGenerateTypeDeclarations($values['generateTypeDeclarations']);
-            }
-            if ($request->get('configuration')) {
-                $configuration = $this->decodeJson($request->get('configuration'));
-                $configuration['datatype'] = 'layout';
-                $configuration['fieldtype'] = 'panel';
-                $layout = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($configuration, true);
-                $fcDef->setLayoutDefinitions($layout);
-            }
-            $fcDef->save();
-            return $this->adminJson(['success' => true, 'id' => $fcDef->getKey()]);
-        } catch (\Exception $e) {
-            Logger::error($e->getMessage());
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @Route("/import-fieldcollection", name="pimcore_admin_dataobject_class_importfieldcollection", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function importFieldcollectionAction(Request $request)
-    {
-        $fieldCollection = DataObject\Fieldcollection\Definition::getByKey($request->get('id'));
-        $data = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $success = DataObject\ClassDefinition\Service::importFieldCollectionFromJson($fieldCollection, $data);
-        $response = $this->adminJson([
-            'success' => $success,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/export-fieldcollection", name="pimcore_admin_dataobject_class_exportfieldcollection", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function exportFieldcollectionAction(Request $request)
-    {
-        $fieldCollection = DataObject\Fieldcollection\Definition::getByKey($request->get('id'));
-        if (!$fieldCollection instanceof DataObject\Fieldcollection\Definition) {
-            $errorMessage = ': Field-Collection with id [ ' . $request->get('id') . ' not found. ]';
-            Logger::error($errorMessage);
-            throw $this->createNotFoundException($errorMessage);
-        }
-        $json = DataObject\ClassDefinition\Service::generateFieldCollectionJson($fieldCollection);
-        $response = new Response($json);
-        $response->headers->set('Content-type', 'application/json');
-        $response->headers->set('Content-Disposition', 'attachment; filename="fieldcollection_' . $fieldCollection->getKey() . '_export.json"');
-        return $response;
-    }
-    /**
-     * @Route("/fieldcollection-delete", name="pimcore_admin_dataobject_class_fieldcollectiondelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fieldcollectionDeleteAction(Request $request)
-    {
-        $fc = DataObject\Fieldcollection\Definition::getByKey($request->get('id'));
-        $fc->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/fieldcollection-tree", name="pimcore_admin_dataobject_class_fieldcollectiontree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function fieldcollectionTreeAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $list = new DataObject\Fieldcollection\Definition\Listing();
-        $list = $list->load();
-        $forObjectEditor = $request->get('forObjectEditor');
-        $layoutDefinitions = [];
-        $definitions = [];
-        $allowedTypes = null;
-        if ($request->query->has('allowedTypes')) {
-            $allowedTypes = explode(',', $request->get('allowedTypes'));
-        }
-        $object = DataObject::getById($request->get('object_id'));
-        $currentLayoutId = $request->get('layoutId', null);
-        $user = \Pimcore\Tool\Admin::getCurrentUser();
-        $groups = [];
-        foreach ($list as $item) {
-            if ($allowedTypes && !in_array($item->getKey(), $allowedTypes)) {
-                continue;
-            }
-            if ($item->getGroup()) {
-                if (!isset($groups[$item->getGroup()])) {
-                    $groups[$item->getGroup()] = [
-                        'id' => 'group_' . $item->getKey(),
-                        'text' => $item->getGroup(),
-                        'expandable' => true,
-                        'leaf' => false,
-                        'allowChildren' => true,
-                        'iconCls' => 'pimcore_icon_folder',
-                        'group' => $item->getGroup(),
-                        'children' => [],
-                    ];
-                }
-                if ($forObjectEditor) {
-                    $itemLayoutDefinitions = $item->getLayoutDefinitions();
-                    DataObject\Service::enrichLayoutDefinition($itemLayoutDefinitions, $object);
-                    if ($currentLayoutId == -1 && $user->isAdmin()) {
-                        DataObject\Service::createSuperLayout($itemLayoutDefinitions);
-                    }
-                    $layoutDefinitions[$item->getKey()] = $itemLayoutDefinitions;
-                }
-                $groups[$item->getGroup()]['children'][] =
-                    [
-                        'id' => $item->getKey(),
-                        'text' => $item->getKey(),
-                        'title' => $item->getTitle(),
-                        'key' => $item->getKey(),
-                        'leaf' => true,
-                        'iconCls' => 'pimcore_icon_fieldcollection',
-                    ];
-            } else {
-                if ($forObjectEditor) {
-                    $itemLayoutDefinitions = $item->getLayoutDefinitions();
-                    DataObject\Service::enrichLayoutDefinition($itemLayoutDefinitions, $object);
-                    if ($currentLayoutId == -1 && $user->isAdmin()) {
-                        DataObject\Service::createSuperLayout($itemLayoutDefinitions);
-                    }
-                    $layoutDefinitions[$item->getKey()] = $itemLayoutDefinitions;
-                }
-                $definitions[] = [
-                    'id' => $item->getKey(),
-                    'text' => $item->getKey(),
-                    'title' => $item->getTitle(),
-                    'key' => $item->getKey(),
-                    'leaf' => true,
-                    'iconCls' => 'pimcore_icon_fieldcollection',
-                ];
-            }
-        }
-        foreach ($groups as $group) {
-            $definitions[] = $group;
-        }
-        $event = new GenericEvent($this, [
-            'list' => $definitions,
-            'objectId' => $request->get('object_id'),
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::CLASS_FIELDCOLLECTION_LIST_PRE_SEND_DATA);
-        $definitions = $event->getArgument('list');
-        if ($forObjectEditor) {
-            return $this->adminJson(['fieldcollections' => $definitions, 'layoutDefinitions' => $layoutDefinitions]);
-        } else {
-            return $this->adminJson($definitions);
-        }
-    }
-    /**
-     * @Route("/fieldcollection-list", name="pimcore_admin_dataobject_class_fieldcollectionlist", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function fieldcollectionListAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $user = \Pimcore\Tool\Admin::getCurrentUser();
-        $currentLayoutId = $request->get('layoutId');
-        $list = new DataObject\Fieldcollection\Definition\Listing();
-        $list = $list->load();
-        if ($request->query->has('allowedTypes')) {
-            $filteredList = [];
-            $allowedTypes = explode(',', $request->get('allowedTypes'));
-            foreach ($list as $type) {
-                if (in_array($type->getKey(), $allowedTypes)) {
-                    $filteredList[] = $type;
-                    $layoutDefinitions = $type->getLayoutDefinitions();
-                    $context = [
-                        'containerType' => 'fieldcollection',
-                        'containerKey' => $type->getKey(),
-                        'outerFieldname' => $request->get('field_name'),
-                    ];
-                    $object = DataObject::getById($request->get('object_id'));
-                    DataObject\Service::enrichLayoutDefinition($layoutDefinitions, $object, $context);
-                    if ($currentLayoutId == -1 && $user->isAdmin()) {
-                        DataObject\Service::createSuperLayout($layoutDefinitions);
-                    }
-                }
-            }
-            $list = $filteredList;
-        }
-        $event = new GenericEvent($this, [
-            'list' => $list,
-            'objectId' => $request->get('object_id'),
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::CLASS_FIELDCOLLECTION_LIST_PRE_SEND_DATA);
-        $list = $event->getArgument('list');
-        return $this->adminJson(['fieldcollections' => $list]);
-    }
-    /**
-     * @Route("/get-class-definition-for-column-config", name="pimcore_admin_dataobject_class_getclassdefinitionforcolumnconfig", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getClassDefinitionForColumnConfigAction(Request $request)
-    {
-        $class = DataObject\ClassDefinition::getById($request->get('id'));
-        $objectId = (int)$request->get('oid');
-        $filteredDefinitions = DataObject\Service::getCustomLayoutDefinitionForGridColumnConfig($class, $objectId);
-        $layoutDefinitions = isset($filteredDefinitions['layoutDefinition']) ? $filteredDefinitions['layoutDefinition'] : false;
-        $filteredFieldDefinition = isset($filteredDefinitions['fieldDefinition']) ? $filteredDefinitions['fieldDefinition'] : false;
-        $class->setFieldDefinitions([]);
-        $result = [];
-        DataObject\Service::enrichLayoutDefinition($layoutDefinitions);
-        $result['objectColumns']['childs'] = $layoutDefinitions->getChilds();
-        $result['objectColumns']['nodeLabel'] = 'object_columns';
-        $result['objectColumns']['nodeType'] = 'object';
-        $systemColumnNames = DataObject\Concrete::SYSTEM_COLUMN_NAMES;
-        $systemColumns = [];
-        foreach ($systemColumnNames as $systemColumn) {
-            $systemColumns[] = ['title' => $systemColumn, 'name' => $systemColumn, 'datatype' => 'data', 'fieldtype' => 'system'];
-        }
-        $result['systemColumns']['nodeLabel'] = 'system_columns';
-        $result['systemColumns']['nodeType'] = 'system';
-        $result['systemColumns']['childs'] = $systemColumns;
-        $list = new DataObject\Objectbrick\Definition\Listing();
-        $list = $list->load();
-        foreach ($list as $brickDefinition) {
-            $classDefs = $brickDefinition->getClassDefinitions();
-            if (!empty($classDefs)) {
-                foreach ($classDefs as $classDef) {
-                    if ($classDef['classname'] == $class->getName()) {
-                        $fieldName = $classDef['fieldname'];
-                        if ($filteredFieldDefinition && !$filteredFieldDefinition[$fieldName]) {
-                            continue;
-                        }
-                        $key = $brickDefinition->getKey();
-                        $brickLayoutDefinitions = $brickDefinition->getLayoutDefinitions();
-                        $context = [
-                            'containerType' => 'objectbrick',
-                            'containerKey' => $key,
-                            'outerFieldname' => $fieldName,
-                        ];
-                        DataObject\Service::enrichLayoutDefinition($brickLayoutDefinitions, null, $context);
-                        $result[$key]['nodeLabel'] = $key;
-                        $result[$key]['brickField'] = $fieldName;
-                        $result[$key]['nodeType'] = 'objectbricks';
-                        $result[$key]['childs'] = $brickLayoutDefinitions->getChildren();
-                        break;
-                    }
-                }
-            }
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * OBJECT BRICKS
-     */
-    /**
-     * @Route("/objectbrick-get", name="pimcore_admin_dataobject_class_objectbrickget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function objectbrickGetAction(Request $request)
-    {
-        $fc = DataObject\Objectbrick\Definition::getByKey($request->get('id'));
-        $isWriteable = $fc->isWritable();
-        $fc = $fc->getObjectVars();
-        $fc['isWriteable'] = $isWriteable;
-        return $this->adminJson($fc);
-    }
-    /**
-     * @Route("/objectbrick-update", name="pimcore_admin_dataobject_class_objectbrickupdate", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function objectbrickUpdateAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        try {
-            $key = $request->get('key');
-            $title = $request->get('title');
-            $group = $request->get('group');
-            if ($request->get('task') == 'add') {
-                $list = new DataObject\Objectbrick\Definition\Listing();
-                $list = $list->load();
-                foreach ($list as $item) {
-                    if (strtolower($key) === strtolower($item->getKey())) {
-                        throw new \Exception('Brick with the same name already exists (lower/upper cases may be different)');
-                    }
-                }
-            }
-            $brickDef = new DataObject\Objectbrick\Definition();
-            $brickDef->setKey($key);
-            $brickDef->setTitle($title);
-            $brickDef->setGroup($group);
-            if ($request->get('values')) {
-                $values = $this->decodeJson($request->get('values'));
-                $brickDef->setParentClass($values['parentClass']);
-                $brickDef->setImplementsInterfaces($values['implementsInterfaces']);
-                $brickDef->setClassDefinitions($values['classDefinitions']);
-                $brickDef->setGenerateTypeDeclarations($values['generateTypeDeclarations']);
-            }
-            if ($request->get('configuration')) {
-                $configuration = $this->decodeJson($request->get('configuration'));
-                $configuration['datatype'] = 'layout';
-                $configuration['fieldtype'] = 'panel';
-                $layout = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($configuration, true);
-                $brickDef->setLayoutDefinitions($layout);
-            }
-            $event = new GenericEvent($this, [
-                'brickDefinition' => $brickDef,
-            ]);
-            $eventDispatcher->dispatch($event, AdminEvents::CLASS_OBJECTBRICK_UPDATE_DEFINITION);
-            $brickDef = $event->getArgument('brickDefinition');
-            $brickDef->save();
-            return $this->adminJson(['success' => true, 'id' => $brickDef->getKey()]);
-        } catch (\Exception $e) {
-            Logger::error($e->getMessage());
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @Route("/import-objectbrick", name="pimcore_admin_dataobject_class_importobjectbrick", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function importObjectbrickAction(Request $request)
-    {
-        $objectBrick = DataObject\Objectbrick\Definition::getByKey($request->get('id'));
-        $data = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $success = DataObject\ClassDefinition\Service::importObjectBrickFromJson($objectBrick, $data);
-        $response = $this->adminJson([
-            'success' => $success,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/export-objectbrick", name="pimcore_admin_dataobject_class_exportobjectbrick", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function exportObjectbrickAction(Request $request)
-    {
-        $objectBrick = DataObject\Objectbrick\Definition::getByKey($request->get('id'));
-        if (!$objectBrick instanceof DataObject\Objectbrick\Definition) {
-            $errorMessage = ': Object-Brick with id [ ' . $request->get('id') . ' not found. ]';
-            Logger::error($errorMessage);
-            throw $this->createNotFoundException($errorMessage);
-        }
-        $xml = DataObject\ClassDefinition\Service::generateObjectBrickJson($objectBrick);
-        $response = new Response($xml);
-        $response->headers->set('Content-type', 'application/json');
-        $response->headers->set('Content-Disposition', 'attachment; filename="objectbrick_' . $objectBrick->getKey() . '_export.json"');
-        return $response;
-    }
-    /**
-     * @Route("/objectbrick-delete", name="pimcore_admin_dataobject_class_objectbrickdelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function objectbrickDeleteAction(Request $request)
-    {
-        $fc = DataObject\Objectbrick\Definition::getByKey($request->get('id'));
-        $fc->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/objectbrick-tree", name="pimcore_admin_dataobject_class_objectbricktree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function objectbrickTreeAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $list = new DataObject\Objectbrick\Definition\Listing();
-        $list = $list->load();
-        $forObjectEditor = $request->get('forObjectEditor');
-        $layoutDefinitions = [];
-        $groups = [];
-        $definitions = [];
-        $fieldname = null;
-        $className = null;
-        $object = DataObject::getById($request->get('object_id'));
-        if ($request->query->has('class_id') && $request->query->has('field_name')) {
-            $classId = $request->get('class_id');
-            $fieldname = $request->get('field_name');
-            $classDefinition = DataObject\ClassDefinition::getById($classId);
-            $className = $classDefinition->getName();
-        }
-        foreach ($list as $item) {
-            if ($request->query->has('class_id') && $request->query->has('field_name')) {
-                $keep = false;
-                $clsDefs = $item->getClassDefinitions();
-                if (!empty($clsDefs)) {
-                    foreach ($clsDefs as $cd) {
-                        if ($cd['classname'] == $className && $cd['fieldname'] == $fieldname) {
-                            $keep = true;
-                            continue;
-                        }
-                    }
-                }
-                if (!$keep) {
-                    continue;
-                }
-            }
-            if ($item->getGroup()) {
-                if (!isset($groups[$item->getGroup()])) {
-                    $groups[$item->getGroup()] = [
-                        'id' => 'group_' . $item->getKey(),
-                        'text' => $item->getGroup(),
-                        'expandable' => true,
-                        'leaf' => false,
-                        'allowChildren' => true,
-                        'iconCls' => 'pimcore_icon_folder',
-                        'group' => $item->getGroup(),
-                        'children' => [],
-                    ];
-                }
-                if ($forObjectEditor) {
-                    $itemLayoutDefinitions = $item->getLayoutDefinitions();
-                    DataObject\Service::enrichLayoutDefinition($itemLayoutDefinitions, $object);
-                    $layoutDefinitions[$item->getKey()] = $itemLayoutDefinitions;
-                }
-                $groups[$item->getGroup()]['children'][] =
-                    [
-                        'id' => $item->getKey(),
-                        'text' => $item->getKey(),
-                        'title' => $item->getTitle(),
-                        'key' => $item->getKey(),
-                        'leaf' => true,
-                        'iconCls' => 'pimcore_icon_objectbricks',
-                    ];
-            } else {
-                if ($forObjectEditor) {
-                    $layout = $item->getLayoutDefinitions();
-                    $currentLayoutId = $request->get('layoutId', null);
-                    $user = $this->getAdminUser();
-                    if ($currentLayoutId == -1 && $user->isAdmin()) {
-                        DataObject\Service::createSuperLayout($layout);
-                        $objectData['layout'] = $layout;
-                    }
-                    $context = [
-                        'containerType' => 'objectbrick',
-                        'containerKey' => $item->getKey(),
-                        'outerFieldname' => $request->get('field_name'),
-                    ];
-                    DataObject\Service::enrichLayoutDefinition($layout, $object, $context);
-                    $layoutDefinitions[$item->getKey()] = $layout;
-                }
-                $definitions[] = [
-                    'id' => $item->getKey(),
-                    'text' => $item->getKey(),
-                    'title' => $item->getTitle(),
-                    'key' => $item->getKey(),
-                    'leaf' => true,
-                    'iconCls' => 'pimcore_icon_objectbricks',
-                ];
-            }
-        }
-        foreach ($groups as $group) {
-            $definitions[] = $group;
-        }
-        $event = new GenericEvent($this, [
-            'list' => $definitions,
-            'objectId' => $request->get('object_id'),
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::CLASS_OBJECTBRICK_LIST_PRE_SEND_DATA);
-        $definitions = $event->getArgument('list');
-        if ($forObjectEditor) {
-            return $this->adminJson(['objectbricks' => $definitions, 'layoutDefinitions' => $layoutDefinitions]);
-        } else {
-            return $this->adminJson($definitions);
-        }
-    }
-    /**
-     * @Route("/objectbrick-list", name="pimcore_admin_dataobject_class_objectbricklist", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function objectbrickListAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $list = new DataObject\Objectbrick\Definition\Listing();
-        $list = $list->load();
-        if ($request->query->has('class_id') && $request->query->has('field_name')) {
-            $filteredList = [];
-            $classId = $request->get('class_id');
-            $fieldname = $request->get('field_name');
-            $classDefinition = DataObject\ClassDefinition::getById($classId);
-            $className = $classDefinition->getName();
-            foreach ($list as $type) {
-                $clsDefs = $type->getClassDefinitions();
-                if (!empty($clsDefs)) {
-                    foreach ($clsDefs as $cd) {
-                        if ($cd['classname'] == $className && $cd['fieldname'] == $fieldname) {
-                            $filteredList[] = $type;
-                            continue;
-                        }
-                    }
-                }
-                $layout = $type->getLayoutDefinitions();
-                $currentLayoutId = $request->get('layoutId', null);
-                $user = $this->getAdminUser();
-                if ($currentLayoutId == -1 && $user->isAdmin()) {
-                    DataObject\Service::createSuperLayout($layout);
-                    $objectData['layout'] = $layout;
-                }
-                $context = [
-                    'containerType' => 'objectbrick',
-                    'containerKey' => $type->getKey(),
-                    'outerFieldname' => $request->get('field_name'),
-                ];
-                $object = DataObject::getById($request->get('object_id'));
-                DataObject\Service::enrichLayoutDefinition($layout, $object, $context);
-                $type->setLayoutDefinitions($layout);
-            }
-            $list = $filteredList;
-        }
-        $event = new GenericEvent($this, [
-            'list' => $list,
-            'objectId' => $request->get('object_id'),
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::CLASS_OBJECTBRICK_LIST_PRE_SEND_DATA);
-        $list = $event->getArgument('list');
-        return $this->adminJson(['objectbricks' => $list]);
-    }
-    /**
-     * See http://www.pimcore.org/issues/browse/PIMCORE-2358
-     * Add option to export/import all class definitions/brick definitions etc. at once
-     */
-    /**
-     * @Route("/bulk-import", name="pimcore_admin_dataobject_class_bulkimport", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function bulkImportAction(Request $request)
-    {
-        $result = [];
-        $tmpName = $_FILES['Filedata']['tmp_name'];
-        $json = file_get_contents($tmpName);
-        $tmpName = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/bulk-import-' . uniqid() . '.tmp';
-        file_put_contents($tmpName, $json);
-        Session::useSession(function (AttributeBagInterface $session) use ($tmpName) {
-            $session->set('class_bulk_import_file', $tmpName);
-        }, 'pimcore_objects');
-        $json = json_decode($json, true);
-        foreach ($json as $groupName => $group) {
-            foreach ($group as $groupItem) {
-                $displayName = null;
-                $icon = null;
-                if ($groupName == 'class') {
-                    $name = $groupItem['name'];
-                    $icon = 'class';
-                } elseif ($groupName == 'customlayout') {
-                    $className = $groupItem['className'];
-                    $layoutData = ['className' => $className, 'name' => $groupItem['name']];
-                    $name = base64_encode(json_encode($layoutData));
-                    $displayName = $className . ' / ' . $groupItem['name'];
-                    $icon = 'custom_views';
-                } else {
-                    if ($groupName == 'objectbrick') {
-                        $icon = 'objectbricks';
-                    } elseif ($groupName == 'fieldcollection') {
-                        $icon = 'fieldcollection';
-                    }
-                    $name = $groupItem['key'];
-                }
-                if (!$displayName) {
-                    $displayName = $name;
-                }
-                $result[] = ['icon' => $icon, 'checked' => true, 'type' => $groupName, 'name' => $name, 'displayName' => $displayName];
-            }
-        }
-        $response = $this->adminJson(['success' => true, 'data' => $result]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * See http://www.pimcore.org/issues/browse/PIMCORE-2358
-     * Add option to export/import all class definitions/brick definitions etc. at once
-     */
-    /**
-     * @Route("/bulk-commit", name="pimcore_admin_dataobject_class_bulkcommit", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function bulkCommitAction(Request $request)
-    {
-        $data = json_decode($request->get('data'), true);
-        $session = Session::get('pimcore_objects');
-        $filename = $session->get('class_bulk_import_file');
-        $json = @file_get_contents($filename);
-        $json = json_decode($json, true);
-        $type = $data['type'];
-        $name = $data['name'];
-        $list = $json[$type];
-        foreach ($list as $item) {
-            unset($item['creationDate']);
-            unset($item['modificationDate']);
-            unset($item['userOwner']);
-            unset($item['userModification']);
-            if ($type == 'class' && $item['name'] == $name) {
-                $class = DataObject\ClassDefinition::getByName($name);
-                if (!$class) {
-                    $class = new DataObject\ClassDefinition();
-                    $class->setName($name);
-                }
-                $success = DataObject\ClassDefinition\Service::importClassDefinitionFromJson($class, json_encode($item), true);
-                return $this->adminJson(['success' => $success !== false]);
-            } elseif ($type == 'objectbrick' && $item['key'] == $name) {
-                if (!$brick = DataObject\Objectbrick\Definition::getByKey($name)) {
-                    $brick = new DataObject\Objectbrick\Definition();
-                    $brick->setKey($name);
-                }
-                $success = DataObject\ClassDefinition\Service::importObjectBrickFromJson($brick, json_encode($item), true);
-                return $this->adminJson(['success' => $success !== false]);
-            } elseif ($type == 'fieldcollection' && $item['key'] == $name) {
-                if (!$fieldCollection = DataObject\Fieldcollection\Definition::getByKey($name)) {
-                    $fieldCollection = new DataObject\Fieldcollection\Definition();
-                    $fieldCollection->setKey($name);
-                }
-                $success = DataObject\ClassDefinition\Service::importFieldCollectionFromJson($fieldCollection, json_encode($item), true);
-                return $this->adminJson(['success' => $success !== false]);
-            } elseif ($type == 'customlayout') {
-                $layoutData = json_decode(base64_decode($data['name']), true);
-                $className = $layoutData['className'];
-                $layoutName = $layoutData['name'];
-                if ($item['name'] == $layoutName && $item['className'] == $className) {
-                    $class = DataObject\ClassDefinition::getByName($className);
-                    if (!$class) {
-                        throw new \Exception('Class does not exist');
-                    }
-                    $classId = $class->getId();
-                    $layoutList = new DataObject\ClassDefinition\CustomLayout\Listing();
-                    $db = \Pimcore\Db::get();
-                    $layoutList->setCondition('name = ' . $db->quote($layoutName) . ' AND classId = ' . $classId);
-                    $layoutList = $layoutList->load();
-                    $layoutDefinition = null;
-                    if ($layoutList) {
-                        $layoutDefinition = $layoutList[0];
-                    }
-                    if (!$layoutDefinition) {
-                        $layoutDefinition = new DataObject\ClassDefinition\CustomLayout();
-                        $layoutDefinition->setName($layoutName);
-                        $layoutDefinition->setClassId($classId);
-                    }
-                    try {
-                        $layoutDefinition->setDescription($item['description']);
-                        $layoutDef = DataObject\ClassDefinition\Service::generateLayoutTreeFromArray($item['layoutDefinitions'], true);
-                        $layoutDefinition->setLayoutDefinitions($layoutDef);
-                        $layoutDefinition->save();
-                    } catch (\Exception $e) {
-                        Logger::error($e->getMessage());
-                        return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                    }
-                }
-            }
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * See http://www.pimcore.org/issues/browse/PIMCORE-2358
-     * Add option to export/import all class definitions/brick definitions etc. at once
-     */
-    /**
-     * @Route("/bulk-export-prepare", name="pimcore_admin_dataobject_class_bulkexportprepare", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function bulkExportPrepareAction(Request $request)
-    {
-        $data = $request->get('data');
-        Session::useSession(function (AttributeBagInterface $session) use ($data) {
-            $session->set('class_bulk_export_settings', $data);
-        }, 'pimcore_objects');
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/bulk-export", name="pimcore_admin_dataobject_class_bulkexport", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function bulkExportAction(Request $request)
-    {
-        $result = [];
-        $fieldCollections = new DataObject\Fieldcollection\Definition\Listing();
-        $fieldCollections = $fieldCollections->load();
-        foreach ($fieldCollections as $fieldCollection) {
-            $result[] = [
-                'icon' => 'fieldcollection',
-                'checked' => true,
-                'type' => 'fieldcollection',
-                'name' => $fieldCollection->getKey(),
-                'displayName' => $fieldCollection->getKey(),
-            ];
-        }
-        $classes = new DataObject\ClassDefinition\Listing();
-        $classes->setOrder('ASC');
-        $classes->setOrderKey('id');
-        $classes = $classes->load();
-        foreach ($classes as $class) {
-            $result[] = [
-                'icon' => 'class',
-                'checked' => true,
-                'type' => 'class',
-                'name' => $class->getName(),
-                'displayName' => $class->getName(),
-            ];
-        }
-        $objectBricks = new DataObject\Objectbrick\Definition\Listing();
-        $objectBricks = $objectBricks->load();
-        foreach ($objectBricks as $objectBrick) {
-            $result[] = [
-                'icon' => 'objectbricks',
-                'checked' => true,
-                'type' => 'objectbrick',
-                'name' => $objectBrick->getKey(),
-                'displayName' => $objectBrick->getKey(),
-            ];
-        }
-        $customLayouts = new DataObject\ClassDefinition\CustomLayout\Listing();
-        $customLayouts = $customLayouts->load();
-        foreach ($customLayouts as $customLayout) {
-            $class = DataObject\ClassDefinition::getById($customLayout->getClassId());
-            $displayName = $class->getName() . ' / ' .  $customLayout->getName();
-            $result[] = [
-                'icon' => 'custom_views',
-                'checked' => true,
-                'type' => 'customlayout',
-                'name' => $customLayout->getId(),
-                'displayName' => $displayName,
-            ];
-        }
-        return new JsonResponse(['success' => true, 'data' => $result]);
-    }
-    /**
-     * @Route("/do-bulk-export", name="pimcore_admin_dataobject_class_dobulkexport", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function doBulkExportAction(Request $request)
-    {
-        $session = Session::get('pimcore_objects');
-        $list = $session->get('class_bulk_export_settings');
-        $list = json_decode($list, true);
-        $result = [];
-        foreach ($list as $item) {
-            if ($item['type'] == 'fieldcollection') {
-                $fieldCollection = DataObject\Fieldcollection\Definition::getByKey($item['name']);
-                $key = $fieldCollection->getKey();
-                $fieldCollectionJson = json_decode(DataObject\ClassDefinition\Service::generateFieldCollectionJson($fieldCollection));
-                $fieldCollectionJson->key = $key;
-                $result['fieldcollection'][] = $fieldCollectionJson;
-            } elseif ($item['type'] == 'class') {
-                $class = DataObject\ClassDefinition::getByName($item['name']);
-                $data = json_decode(json_encode($class));
-                unset($data->fieldDefinitions);
-                $result['class'][] = $data;
-            } elseif ($item['type'] == 'objectbrick') {
-                $objectBrick = DataObject\Objectbrick\Definition::getByKey($item['name']);
-                $key = $objectBrick->getKey();
-                $objectBrickJson = json_decode(DataObject\ClassDefinition\Service::generateObjectBrickJson($objectBrick));
-                $objectBrickJson->key = $key;
-                $result['objectbrick'][] = $objectBrickJson;
-            } elseif ($item['type'] == 'customlayout') {
-                /** @var DataObject\ClassDefinition\CustomLayout $customLayout */
-                $customLayout = DataObject\ClassDefinition\CustomLayout::getById($item['name']);
-                $classId = $customLayout->getClassId();
-                $class = DataObject\ClassDefinition::getById($classId);
-                $customLayout = $customLayout->getObjectVars();
-                $customLayout['className'] = $class->getName();
-                $result['customlayout'][] = $customLayout;
-            }
-        }
-        $result = json_encode($result, JSON_PRETTY_PRINT);
-        $response = new Response($result);
-        $response->headers->set('Content-type', 'application/json');
-        $response->headers->set('Content-Disposition', 'attachment; filename="bulk_export.json"');
-        return $response;
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $unrestrictedActions = [
-            'getTreeAction', 'fieldcollectionListAction', 'fieldcollectionTreeAction', 'fieldcollectionGetAction',
-            'getClassDefinitionForColumnConfigAction', 'objectbrickListAction', 'objectbrickTreeAction', 'objectbrickGetAction',
-        ];
-        $this->checkActionPermission($event, 'classes', $unrestrictedActions);
-    }
-    /**
-     * @Route("/get-fieldcollection-usages", name="pimcore_admin_dataobject_class_getfieldcollectionusages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function getFieldcollectionUsagesAction(Request $request)
-    {
-        $key = $request->get('key');
-        $result = [];
-        $classes = new DataObject\ClassDefinition\Listing();
-        $classes = $classes->load();
-        foreach ($classes as $class) {
-            $fieldDefs = $class->getFieldDefinitions();
-            foreach ($fieldDefs as $fieldDef) {
-                if ($fieldDef instanceof DataObject\ClassDefinition\Data\Fieldcollections) {
-                    $allowedKeys = $fieldDef->getAllowedTypes();
-                    if (is_array($allowedKeys) && in_array($key, $allowedKeys)) {
-                        $result[] = [
-                            'class' => $class->getName(),
-                            'field' => $fieldDef->getName(),
-                        ];
-                    }
-                }
-            }
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/get-bricks-usages", name="pimcore_admin_dataobject_class_getbrickusages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function getBrickUsagesAction(Request $request)
-    {
-        $classId = $request->get('classId');
-        $myclass = DataObject\ClassDefinition::getById($classId);
-        $result = [];
-        $brickDefinitions = new DataObject\Objectbrick\Definition\Listing();
-        $brickDefinitions = $brickDefinitions->load();
-        foreach ($brickDefinitions as $brickDefinition) {
-            $classes = $brickDefinition->getClassDefinitions();
-            foreach ($classes as $class) {
-                if ($myclass->getName() == $class['classname']) {
-                    $result[] = [
-                        'objectbrick' => $brickDefinition->getKey(),
-                        'field' => $class['fieldname'],
-                    ];
-                }
-            }
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/get-icons", name="pimcore_admin_dataobject_class_geticons", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return Response
-     */
-    public function getIconsAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $classId = $request->get('classId');
-        $iconDir = PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin/img';
-        $classIcons = rscandir($iconDir . '/object-icons/');
-        $colorIcons = rscandir($iconDir . '/flat-color-icons/');
-        $twemoji = rscandir($iconDir . '/twemoji/');
-        $icons = array_merge($classIcons, $colorIcons, $twemoji);
-        foreach ($icons as &$icon) {
-            $icon = str_replace(PIMCORE_WEB_ROOT, '', $icon);
-        }
-        $event = new GenericEvent($this, [
-            'icons' => $icons,
-            'classId' => $classId,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::CLASS_OBJECT_ICONS_PRE_SEND_DATA);
-        $icons = $event->getArgument('icons');
-        $result = [];
-        foreach ($icons as $icon) {
-            $result[] = [
-                'text' => "<img src='{$icon}'>",
-                'value' => $icon,
-            ];
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/suggest-class-identifier", name="pimcore_admin_dataobject_class_suggestclassidentifier")
-     *
-     * @return Response
-     */
-    public function suggestClassIdentifierAction()
-    {
-        $db = Db::get();
-        $maxId = $db->fetchOne('SELECT MAX(CAST(id AS SIGNED)) FROM classes;');
-        $existingIds = $db->fetchCol('select LOWER(id) from classes');
-        $result = [
-            'suggestedIdentifier' => $maxId ? $maxId + 1 : 1,
-            'existingIds' => $existingIds,
-            ];
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/suggest-custom-layout-identifier", name="pimcore_admin_dataobject_class_suggestcustomlayoutidentifier")
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function suggestCustomLayoutIdentifierAction(Request $request)
-    {
-        $classId = $request->get('classId');
-        $identifier = DataObject\ClassDefinition\CustomLayout::getIdentifier($classId);
-        $list = new DataObject\ClassDefinition\CustomLayout\Listing();
-        $list = $list->load();
-        $existingIds = [];
-        $existingNames = [];
-        foreach ($list as $item) {
-            $existingIds[] = $item->getId();
-            if ($item->getClassId() == $classId) {
-                $existingNames[] = $item->getName();
-            }
-        }
-        $result = [
-            'suggestedIdentifier' => $identifier,
-            'existingIds' => $existingIds,
-            'existingNames' => $existingNames,
-            ];
-        return $this->adminJson($result);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/ClassificationstoreController.php
+++ b//dev/null
@@ -1,1264 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Db;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\DataObject\Classificationstore;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/classificationstore")
- *
- * @internal
- */
-class ClassificationstoreController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * Delete collection with the group-relations
-     *
-     * @Route("/delete-collection", name="pimcore_admin_dataobject_classificationstore_deletecollection", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteCollectionAction(Request $request)
-    {
-        $id = $request->get('id');
-        $configRelations = new Classificationstore\CollectionGroupRelation\Listing();
-        $configRelations->setCondition('colId = ?', $id);
-        $list = $configRelations->load();
-        foreach ($list as $item) {
-            $item->delete();
-        }
-        $config = Classificationstore\CollectionConfig::getById($id);
-        $config->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/delete-collection-relation", name="pimcore_admin_dataobject_classificationstore_deletecollectionrelation", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteCollectionRelationAction(Request $request)
-    {
-        $colId = $request->get('colId');
-        $groupId = $request->get('groupId');
-        $config = new Classificationstore\CollectionGroupRelation();
-        $config->setColId($colId);
-        $config->setGroupId($groupId);
-        $config->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/delete-relation", name="pimcore_admin_dataobject_classificationstore_deleterelation", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteRelationAction(Request $request)
-    {
-        $keyId = $request->get('keyId');
-        $groupId = $request->get('groupId');
-        $config = new Classificationstore\KeyGroupRelation();
-        $config->setKeyId($keyId);
-        $config->setGroupId($groupId);
-        $config->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/delete-group", name="pimcore_admin_dataobject_classificationstore_deletegroup", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteGroupAction(Request $request)
-    {
-        $id = $request->get('id');
-        $config = Classificationstore\GroupConfig::getById($id);
-        $config->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/create-group", name="pimcore_admin_dataobject_classificationstore_creategroup", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function createGroupAction(Request $request)
-    {
-        $name = $request->get('name');
-        $storeId = $request->get('storeId');
-        $config = Classificationstore\GroupConfig::getByName($name, $storeId);
-        if (!$config) {
-            $config = new Classificationstore\GroupConfig();
-            $config->setStoreId($storeId);
-            $config->setName($name);
-            $config->save();
-            return $this->adminJson(['success' => true, 'id' => $config->getName()]);
-        } else {
-            return $this->adminJson(['success' => false, 'id' => $config->getName(), 'message' => 'classificationstore_error_group_exists_msg']);
-        }
-    }
-    /**
-     * @Route("/create-store", name="pimcore_admin_dataobject_classificationstore_createstore", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function createStoreAction(Request $request)
-    {
-        $name = $request->get('name');
-        $config = Classificationstore\StoreConfig::getByName($name);
-        if (!$config) {
-            $config = new Classificationstore\StoreConfig();
-            $config->setName($name);
-            $config->save();
-        } else {
-            throw new \Exception('Store with the given name exists');
-        }
-        return $this->adminJson(['success' => true, 'storeId' => $config->getId()]);
-    }
-    /**
-     * @Route("/create-collection", name="pimcore_admin_dataobject_classificationstore_createcollection", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function createCollectionAction(Request $request)
-    {
-        $name = $request->get('name');
-        $storeId = $request->get('storeId');
-        $config = Classificationstore\CollectionConfig::getByName($name, $storeId);
-        if (!$config) {
-            $config = new Classificationstore\CollectionConfig();
-            $config->setName($name);
-            $config->setStoreId($storeId);
-            $config->save();
-        }
-        return $this->adminJson(['success' => true, 'id' => $config->getName()]);
-    }
-    /**
-     * @Route("/collections", name="pimcore_admin_dataobject_classificationstore_collectionsactionget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function collectionsActionGet(Request $request)
-    {
-        $this->checkPermission('objects');
-        $start = 0;
-        $limit = $request->get('limit') ? $request->get('limit') : 15;
-        $orderKey = 'name';
-        $order = 'ASC';
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        $storeIdFromDefinition = 0;
-        $allowedCollectionIds = [];
-        if ($request->get('oid')) {
-            $object = DataObject\Concrete::getById($request->get('oid'));
-            $class = $object->getClass();
-            /** @var DataObject\ClassDefinition\Data\Classificationstore $fd */
-            $fd = $class->getFieldDefinition($request->get('fieldname'));
-            $allowedGroupIds = $fd->getAllowedGroupIds();
-            if ($allowedGroupIds) {
-                $db = \Pimcore\Db::get();
-                $query = 'select * from classificationstore_collectionrelations where groupId in (' . implode(',', $allowedGroupIds) .')';
-                $relationList = $db->fetchAll($query);
-                if (is_array($relationList)) {
-                    foreach ($relationList as $item) {
-                        $allowedCollectionIds[] = $item['colId'];
-                    }
-                }
-            }
-            $storeIdFromDefinition = $fd->getStoreId();
-        }
-        $list = new Classificationstore\CollectionConfig\Listing();
-        $list->setLimit($limit);
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $conditionParts = [];
-        $db = Db::get();
-        $searchfilter = $request->get('searchfilter');
-        if ($searchfilter) {
-            $conditionParts[] = '(name LIKE ' . $db->quote('%' . $searchfilter . '%') . ' OR description LIKE ' . $db->quote('%'. $searchfilter . '%') . ')';
-        }
-        $storeId = $request->get('storeId');
-        $storeId = $storeId ? $storeId : $storeIdFromDefinition;
-        $conditionParts[] = ' (storeId = ' . $db->quote($storeId) . ')';
-        if ($request->get('filter')) {
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            foreach ($filters as $f) {
-                $conditionParts[] = $db->quoteIdentifier($f->property) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        if ($allowedCollectionIds) {
-            $conditionParts[] = ' id in (' . implode(',', $allowedCollectionIds) . ')';
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $list->setCondition($condition);
-        $list->load();
-        $configList = $list->getList();
-        $rootElement = [];
-        $data = [];
-        foreach ($configList as $config) {
-            $name = $config->getName();
-            if (!$name) {
-                $name = 'EMPTY';
-            }
-            $item = [
-                'storeId' => $config->getStoreId(),
-                'id' => $config->getId(),
-                'name' => $name,
-                'description' => $config->getDescription(),
-            ];
-            if ($config->getCreationDate()) {
-                $item['creationDate'] = $config->getCreationDate();
-            }
-            if ($config->getModificationDate()) {
-                $item['modificationDate'] = $config->getModificationDate();
-            }
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/collections", name="pimcore_admin_dataobject_classificationstore_collections", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function collectionsAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $dataParam = $request->get('data');
-            $data = $this->decodeJson($dataParam);
-            $id = $data['id'];
-            $config = Classificationstore\CollectionConfig::getById($id);
-            foreach ($data as $key => $value) {
-                if ($key != 'id') {
-                    $setter = 'set' . $key;
-                    $config->$setter($value);
-                }
-            }
-            $config->save();
-            return $this->adminJson(['success' => true, 'data' => $config]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/groups", name="pimcore_admin_dataobject_classificationstore_groupsactionget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function groupsActionGet(Request $request)
-    {
-        $this->checkPermission('objects');
-        $start = 0;
-        $limit = 15;
-        $orderKey = 'name';
-        $order = 'ASC';
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        if ($request->get('sort')) {
-            $orderKey = $request->get('sort');
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        $list = new Classificationstore\GroupConfig\Listing();
-        $list->setLimit($limit);
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $conditionParts = [];
-        $db = Db::get();
-        $searchfilter = $request->get('searchfilter');
-        if ($searchfilter) {
-            $conditionParts[] = '(name LIKE ' . $db->quote('%' . $searchfilter . '%') . ' OR description LIKE ' . $db->quote('%'. $searchfilter . '%') . ')';
-        }
-        if ($request->get('storeId')) {
-            $conditionParts[] = '(storeId = ' . $db->quote($request->get('storeId')) . ')';
-        }
-        if ($request->get('filter')) {
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            foreach ($filters as $f) {
-                $conditionParts[] = $db->quoteIdentifier($f->property) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        if ($request->get('oid')) {
-            $object = DataObject\Concrete::getById($request->get('oid'));
-            $class = $object->getClass();
-            /** @var DataObject\ClassDefinition\Data\Classificationstore $fd */
-            $fd = $class->getFieldDefinition($request->get('fieldname'));
-            $allowedGroupIds = $fd->getAllowedGroupIds();
-            if ($allowedGroupIds) {
-                $conditionParts[] = 'ID in (' . implode(',', $allowedGroupIds) . ')';
-            }
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $list->setCondition($condition);
-        $list->load();
-        $configList = $list->getList();
-        $rootElement = [];
-        $data = [];
-        foreach ($configList as $config) {
-            $name = $config->getName();
-            if (!$name) {
-                $name = 'EMPTY';
-            }
-            $item = [
-                'storeId' => $config->getStoreId(),
-                'id' => $config->getId(),
-                'name' => $name,
-                'description' => $config->getDescription(),
-            ];
-            if ($config->getCreationDate()) {
-                $item['creationDate'] = $config->getCreationDate();
-            }
-            if ($config->getModificationDate()) {
-                $item['modificationDate'] = $config->getModificationDate();
-            }
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/groups", name="pimcore_admin_dataobject_classificationstore_groupsaction", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function groupsAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $dataParam = $request->get('data');
-            $data = $this->decodeJson($dataParam);
-            $id = $data['id'];
-            $config = Classificationstore\GroupConfig::getById($id);
-            foreach ($data as $key => $value) {
-                if ($key != 'id') {
-                    $setter = 'set' . $key;
-                    $config->$setter($value);
-                }
-            }
-            $config->save();
-            return $this->adminJson(['success' => true, 'data' => $config]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/collection-relations", name="pimcore_admin_dataobject_classificationstore_collectionrelationsget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function collectionRelationsGetAction(Request $request)
-    {
-        $mapping = ['groupName' => 'name', 'groupDescription' => 'description'];
-        $start = 0;
-        $limit = 15;
-        $orderKey = 'sorter';
-        $order = 'ASC';
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $list = new Classificationstore\CollectionGroupRelation\Listing();
-        if ($limit > 0) {
-            $list->setLimit($limit);
-        }
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $condition = '';
-        if ($request->get('filter')) {
-            $db = Db::get();
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            $count = 0;
-            foreach ($filters as $f) {
-                if ($count > 0) {
-                    $condition .= ' AND ';
-                }
-                $count++;
-                $fieldname = $mapping[$f->field];
-                $condition .= $db->quoteIdentifier($fieldname) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        $colId = $request->get('colId');
-        if ($condition) {
-            $condition = '( ' . $condition . ' ) AND';
-        }
-        $condition .= ' colId = ' . $list->quote($colId);
-        $list->setCondition($condition);
-        $listItems = $list->load();
-        $rootElement = [];
-        $data = [];
-        foreach ($listItems as $config) {
-            $item = [
-                'colId' => $config->getColId(),
-                'groupId' => $config->getGroupId(),
-                'groupName' => $config->getName(),
-                'groupDescription' => $config->getDescription(),
-                'id' => $config->getColId() . '-' . $config->getGroupId(),
-                'sorter' => (int) $config->getSorter(),
-            ];
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/collection-relations", name="pimcore_admin_dataobject_classificationstore_collectionrelations", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function collectionRelationsAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $dataParam = $request->get('data');
-            $data = $this->decodeJson($dataParam);
-            if (count($data) == count($data, 1)) {
-                $data = [$data];
-            }
-            foreach ($data as &$row) {
-                $colId = $row['colId'];
-                $groupId = $row['groupId'];
-                $sorter = $row['sorter'];
-                $config = new Classificationstore\CollectionGroupRelation();
-                $config->setGroupId($groupId);
-                $config->setColId($colId);
-                $config->setSorter((int) $sorter);
-                $config->save();
-                $row['id'] = $config->getColId() . '-' . $config->getGroupId();
-            }
-            return $this->adminJson(['success' => true, 'data' => $data]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/list-stores", name="pimcore_admin_dataobject_classificationstore_liststores", methods={"GET"})
-     *
-     * @return JsonResponse
-     */
-    public function listStoresAction()
-    {
-        $storeConfigs = [];
-        $storeConfigListing = new Classificationstore\StoreConfig\Listing();
-        $storeConfigListing->load();
-        foreach ($storeConfigListing as $storeConfig) {
-            $storeConfigs[] = $storeConfig->getObjectVars();
-        }
-        return $this->adminJson($storeConfigs);
-    }
-    /**
-     * @Route("/search-relations", name="pimcore_admin_dataobject_classificationstore_searchrelations", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function searchRelationsAction(Request $request)
-    {
-        $db = Db::get();
-        $storeId = $request->get('storeId');
-        $mapping = [
-            'groupName' => DataObject\Classificationstore\GroupConfig\Dao::TABLE_NAME_GROUPS .'.name',
-            'keyName' => DataObject\Classificationstore\KeyConfig\Dao::TABLE_NAME_KEYS .'.name',
-            'keyDescription' => DataObject\Classificationstore\KeyConfig\Dao::TABLE_NAME_KEYS. '.description', ];
-        $start = 0;
-        $limit = 15;
-        $orderKey = 'name';
-        $order = 'ASC';
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            if ($orderKey == 'keyName') {
-                $orderKey = 'name';
-            }
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $list = new Classificationstore\KeyGroupRelation\Listing();
-        if ($limit > 0) {
-            $list->setLimit($limit);
-        }
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $conditionParts = [];
-        if ($request->get('filter')) {
-            $db = Db::get();
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            $count = 0;
-            foreach ($filters as $f) {
-                $count++;
-                $fieldname = $mapping[$f->property];
-                $conditionParts[] = $fieldname . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        $conditionParts[] = '  groupId IN (select id from classificationstore_groups where storeId = ' . $db->quote($storeId) . ')';
-        $searchfilter = $request->get('searchfilter');
-        if ($searchfilter) {
-            $conditionParts[] = '('
-                . Classificationstore\KeyConfig\Dao::TABLE_NAME_KEYS . '.name LIKE ' . $db->quote('%' . $searchfilter . '%')
-                . ' OR ' . Classificationstore\GroupConfig\Dao::TABLE_NAME_GROUPS . '.name LIKE ' . $db->quote('%' . $searchfilter . '%')
-                . ' OR ' . Classificationstore\KeyConfig\Dao::TABLE_NAME_KEYS . '.description LIKE ' . $db->quote('%' . $searchfilter . '%') . ')';
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $list->setCondition($condition);
-        $list->setResolveGroupName(1);
-        $listItems = $list->load();
-        $rootElement = [];
-        $data = [];
-        foreach ($listItems as $config) {
-            $item = [
-                'keyId' => $config->getKeyId(),
-                'groupId' => $config->getGroupId(),
-                'keyName' => $config->getName(),
-                'keyDescription' => $config->getDescription(),
-                'id' => $config->getGroupId() . '-' . $config->getKeyId(),
-                'sorter' => $config->getSorter(),
-            ];
-            $groupConfig = Classificationstore\GroupConfig::getById($config->getGroupId());
-            if ($groupConfig) {
-                $item['groupName'] = $groupConfig->getName();
-            }
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/relations", name="pimcore_admin_dataobject_classificationstore_relationsactionget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function relationsActionGet(Request $request)
-    {
-        $mapping = ['keyName' => 'name', 'keyDescription' => 'description'];
-        $start = 0;
-        $limit = 15;
-        $orderKey = 'name';
-        $order = 'ASC';
-        $relationIds = $request->get('relationIds');
-        if ($relationIds) {
-            $relationIds = json_decode($relationIds, true);
-        }
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        } elseif (is_array($relationIds)) {
-            $limit = count($relationIds);
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $list = new Classificationstore\KeyGroupRelation\Listing();
-        if ($limit > 0) {
-            $list->setLimit($limit);
-        }
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $conditionParts = [];
-        if ($request->get('filter')) {
-            $db = Db::get();
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            foreach ($filters as $f) {
-                $fieldname = $mapping[$f->field];
-                $conditionParts[] = $db->quoteIdentifier($fieldname) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        if (!$request->get('relationIds')) {
-            $groupId = $request->get('groupId');
-            $conditionParts[] = ' groupId = ' . $list->quote($groupId);
-        }
-        if ($relationIds) {
-            $relationParts = [];
-            foreach ($relationIds as $relationId) {
-                $keyId = $relationId['keyId'];
-                $groupId = $relationId['groupId'];
-                $relationParts[] = '(keyId = ' . $list->quote($keyId) . ' AND groupId = ' . $list->quote($groupId) . ')';
-            }
-            $conditionParts[] = '(' . implode(' OR ', $relationParts) . ')';
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $list->setCondition($condition);
-        $listItems = $list->load();
-        $rootElement = [];
-        $data = [];
-        foreach ($listItems as $config) {
-            $type = $config->getType();
-            $definition = json_decode($config->getDefinition());
-            $definition = \Pimcore\Model\DataObject\Classificationstore\Service::getFieldDefinitionFromJson($definition, $type);
-            DataObject\Service::enrichLayoutDefinition($definition);
-            $item = [
-                'keyId' => $config->getKeyId(),
-                'groupId' => $config->getGroupId(),
-                'keyName' => $config->getName(),
-                'keyDescription' => $config->getDescription(),
-                'id' => $config->getGroupId() . '-' . $config->getKeyId(),
-                'sorter' => (int) $config->getSorter(),
-                'layout' => $definition,
-                'mandatory' => $config->isMandatory(),
-            ];
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/relations", name="pimcore_admin_dataobject_classificationstore_relations", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function relationsAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $dataParam = $request->get('data');
-            $data = $this->decodeJson($dataParam);
-            $keyId = $data['keyId'];
-            $groupId = $data['groupId'];
-            $sorter = $data['sorter'];
-            $mandatory = $data['mandatory'];
-            $config = new Classificationstore\KeyGroupRelation();
-            $config->setGroupId($groupId);
-            $config->setKeyId($keyId);
-            $config->setSorter($sorter);
-            $config->setMandatory($mandatory);
-            $config->save();
-            $data['id'] = $config->getGroupId() . '-' . $config->getKeyId();
-            return $this->adminJson(['success' => true, 'data' => $data]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/add-collections", name="pimcore_admin_dataobject_classificationstore_addcollections", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addCollectionsAction(Request $request)
-    {
-        $this->checkPermission('objects');
-        $ids = $this->decodeJson($request->get('collectionIds'));
-        $oid = $request->get('oid');
-        $object = DataObject\Concrete::getById($oid);
-        $fieldname = $request->get('fieldname');
-        $data = [];
-        if ($ids) {
-            $db = \Pimcore\Db::get();
-            $mappedData = [];
-            $groupsData = $db->fetchAll('select * from classificationstore_groups g, classificationstore_collectionrelations c where colId IN (:ids) and g.id = c.groupId', [
-                'ids' => implode(',', array_filter($ids, 'intval')),
-            ]);
-            foreach ($groupsData as $groupData) {
-                $mappedData[$groupData['id']] = $groupData;
-            }
-            $groupIdList = [];
-            $groupId = null;
-            $allowedGroupIds = null;
-            if ($request->get('oid')) {
-                $object = DataObject\Concrete::getById($request->get('oid'));
-                $class = $object->getClass();
-                /** @var DataObject\ClassDefinition\Data\Classificationstore $fd */
-                $fd = $class->getFieldDefinition($request->get('fieldname'));
-                $allowedGroupIds = $fd->getAllowedGroupIds();
-            }
-            foreach ($groupsData as $groupItem) {
-                $groupId = $groupItem['groupId'];
-                if (!$allowedGroupIds || in_array($groupId, $allowedGroupIds)) {
-                    $groupIdList[] = $groupId;
-                }
-            }
-            if ($groupIdList) {
-                $groupList = new Classificationstore\GroupConfig\Listing();
-                $groupCondition = 'id in (' . implode(',', $groupIdList) . ')';
-                $groupList->setCondition($groupCondition);
-                $groupList = $groupList->load();
-                $keyCondition = 'groupId in (' . implode(',', $groupIdList) . ')';
-                $keyList = new Classificationstore\KeyGroupRelation\Listing();
-                $keyList->setCondition($keyCondition);
-                $keyList->setOrderKey(['sorter', 'id']);
-                $keyList->setOrder(['ASC', 'ASC']);
-                $keyList = $keyList->load();
-                foreach ($groupList as $groupData) {
-                    $data[$groupData->getId()] = [
-                        'name' => $groupData->getName(),
-                        'id' => $groupData->getId(),
-                        'description' => $groupData->getDescription(),
-                        'keys' => [],
-                        'collectionId' => $mappedData[$groupId]['colId'],
-                    ];
-                }
-                foreach ($keyList as $keyData) {
-                    $groupId = $keyData->getGroupId();
-                    $keyList = $data[$groupId]['keys'];
-                    $type = $keyData->getType();
-                    $definition = json_decode($keyData->getDefinition());
-                    $definition = \Pimcore\Model\DataObject\Classificationstore\Service::getFieldDefinitionFromJson($definition, $type);
-                    if (method_exists($definition, '__wakeup')) {
-                        $definition->__wakeup();
-                    }
-                    $context['object'] = $object;
-                    $context['class'] = $object ? $object->getClass() : null;
-                    $context['ownerType'] = 'classificationstore';
-                    $context['ownerName'] = $fieldname;
-                    $context['keyId'] = $keyData->getKeyId();
-                    $context['groupId'] = $groupId;
-                    $context['keyDefinition'] = $definition;
-                    if (method_exists($definition, 'enrichLayoutDefinition')) {
-                        $definition = $definition->enrichLayoutDefinition($object, $context);
-                    }
-                    $keyList[] = [
-                        'name' => $keyData->getName(),
-                        'id' => $keyData->getKeyId(),
-                        'description' => $keyData->getDescription(),
-                        'definition' => $definition,
-                    ];
-                    $data[$groupId]['keys'] = $keyList;
-                }
-            }
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/add-groups", name="pimcore_admin_dataobject_classificationstore_addgroups", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addGroupsAction(Request $request)
-    {
-        $this->checkPermission('objects');
-        $ids = $this->decodeJson($request->get('groupIds'));
-        $oid = $request->get('oid');
-        $object = DataObject\Concrete::getById($oid);
-        $fieldname = $request->get('fieldname');
-        $keyCondition = 'groupId in (' . implode(',', array_fill(0, count($ids), '?')) . ')';
-        $keyList = new Classificationstore\KeyGroupRelation\Listing();
-        $keyList->setCondition($keyCondition, $ids);
-        $keyList->setOrderKey(['sorter', 'id']);
-        $keyList->setOrder(['ASC', 'ASC']);
-        $keyList = $keyList->load();
-        $groupCondition = 'id in (' . implode(',', array_fill(0, count($ids), '?')) . ')';
-        $groupList = new Classificationstore\GroupConfig\Listing();
-        $groupList->setCondition($groupCondition, $ids);
-        $groupList->setOrder('ASC');
-        $groupList->setOrderKey('id');
-        $groupList = $groupList->load();
-        $data = [];
-        foreach ($groupList as $groupData) {
-            $data[$groupData->getId()] = [
-                'name' => $groupData->getName(),
-                'id' => $groupData->getId(),
-                'description' => $groupData->getDescription(),
-                'keys' => [],
-            ];
-        }
-        foreach ($keyList as $keyData) {
-            $groupId = $keyData->getGroupId();
-            $keyList = $data[$groupId]['keys'];
-            $type = $keyData->getType();
-            $definition = json_decode($keyData->getDefinition());
-            $definition = \Pimcore\Model\DataObject\Classificationstore\Service::getFieldDefinitionFromJson($definition, $type);
-            if (method_exists($definition, '__wakeup')) {
-                $definition->__wakeup();
-            }
-            $context['object'] = $object;
-            $context['class'] = $object ? $object->getClass() : null;
-            $context['ownerType'] = 'classificationstore';
-            $context['ownerName'] = $fieldname;
-            $context['keyId'] = $keyData->getKeyId();
-            $context['groupId'] = $groupId;
-            $context['keyDefinition'] = $definition;
-            if (method_exists($definition, 'enrichLayoutDefinition')) {
-                $definition = $definition->enrichLayoutDefinition($object, $context);
-            }
-            $keyList[] = [
-                'name' => $keyData->getName(),
-                'id' => $keyData->getKeyId(),
-                'description' => $keyData->getDescription(),
-                'definition' => $definition,
-            ];
-            $data[$groupId]['keys'] = $keyList;
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/properties", name="pimcore_admin_dataobject_classificationstore_propertiesget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function propertiesGetAction(Request $request)
-    {
-        $storeId = $request->get('storeId');
-        $frameName = $request->get('frameName');
-        $db = \Pimcore\Db::get();
-        $conditionParts = [];
-        if ($frameName) {
-            $keyCriteria = ' FALSE ';
-            $frameConfig = Classificationstore\CollectionConfig::getByName($frameName, $storeId);
-            if ($frameConfig) {
-                $frameId = $frameConfig->getId();
-                $groupList = new Classificationstore\CollectionGroupRelation\Listing();
-                $groupList->setCondition('colId = ' . $db->quote($frameId));
-                $groupList = $groupList->load();
-                $groupIdList = [];
-                foreach ($groupList as $groupEntry) {
-                    $groupIdList[] = $groupEntry->getGroupId();
-                }
-                if ($groupIdList) {
-                    $keyIdList = new Classificationstore\KeyGroupRelation\Listing();
-                    $keyIdList->setCondition('groupId in (' . implode(',', $groupIdList) . ')');
-                    $keyIdList = $keyIdList->load();
-                    if ($keyIdList) {
-                        $keyIds = [];
-                        foreach ($keyIdList as $keyEntry) {
-                            $keyIds[] = $keyEntry->getKeyId();
-                        }
-                        $keyCriteria = ' id in (' . implode(',', $keyIds) . ')';
-                    }
-                }
-            }
-            $conditionParts[] = $keyCriteria;
-        }
-        $start = 0;
-        $limit = 15;
-        $orderKey = 'name';
-        $order = 'ASC';
-        if ($request->get('dir')) {
-            $order = $request->get('dir');
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $orderKey = $sortingSettings['orderKey'];
-            $order = $sortingSettings['order'];
-        }
-        if ($request->get('overrideSort') == 'true') {
-            $orderKey = 'id';
-            $order = 'DESC';
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($request->get('start')) {
-            $start = $request->get('start');
-        }
-        $list = new Classificationstore\KeyConfig\Listing();
-        if ($limit > 0 && !$request->get('groupIds') && !$request->get('keyIds')) {
-            $list->setLimit($limit);
-        }
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $searchfilter = $request->get('searchfilter');
-        if ($searchfilter) {
-            $conditionParts[] = '(name LIKE ' . $db->quote('%' . $searchfilter . '%') . ' OR description LIKE ' . $db->quote('%'. $searchfilter . '%') . ')';
-        }
-        if ($storeId) {
-            $conditionParts[] = '(storeId = ' . $storeId . ')';
-        }
-        if ($request->get('filter')) {
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            foreach ($filters as $f) {
-                $conditionParts[] = $db->quoteIdentifier($f->property) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-            }
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $list->setCondition($condition);
-        if ($request->get('groupIds') || $request->get('keyIds')) {
-            $db = Db::get();
-            if ($request->get('groupIds')) {
-                $ids = $this->decodeJson($request->get('groupIds'));
-                $col = 'group';
-            } else {
-                $ids = $this->decodeJson($request->get('keyIds'));
-                $col = 'id';
-            }
-            $condition = $db->quoteIdentifier($col) . ' IN (';
-            $count = 0;
-            foreach ($ids as $theId) {
-                if ($count > 0) {
-                    $condition .= ',';
-                }
-                $condition .= $theId;
-                $count++;
-            }
-            $condition .= ')';
-            $list->setCondition($condition);
-        }
-        $list->load();
-        $configList = $list->getList();
-        $rootElement = [];
-        $data = [];
-        foreach ($configList as $config) {
-            $item = $this->getConfigItem($config);
-            $data[] = $item;
-        }
-        $rootElement['data'] = $data;
-        $rootElement['success'] = true;
-        $rootElement['total'] = $list->getTotalCount();
-        return $this->adminJson($rootElement);
-    }
-    /**
-     * @Route("/properties", name="pimcore_admin_dataobject_classificationstore_properties", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function propertiesAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $dataParam = $request->get('data');
-            $data = $this->decodeJson($dataParam);
-            $id = $data['id'];
-            $config = Classificationstore\KeyConfig::getById($id);
-            foreach ($data as $key => $value) {
-                if ($key != 'id') {
-                    $setter = 'set' . $key;
-                    if (method_exists($config, $setter)) {
-                        $config->$setter($value);
-                    }
-                }
-            }
-            $config->save();
-            $item = $this->getConfigItem($config);
-            return $this->adminJson(['success' => true, 'data' => $item]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param Classificationstore\KeyConfig $config
-     *
-     * @return array
-     */
-    protected function getConfigItem($config)
-    {
-        $name = $config->getName();
-        $groupDescription = null;
-        $item = [
-            'storeId' => $config->getStoreId(),
-            'id' => $config->getId(),
-            'name' => $name,
-            'description' => $config->getDescription(),
-            'type' => $config->getType() ? $config->getType() : 'input',
-            'definition' => $config->getDefinition(),
-        ];
-        if ($config->getDefinition()) {
-            $definition = json_decode($config->getDefinition(), true);
-            if ($definition) {
-                $item['title'] = $definition['title'];
-            }
-        }
-        if ($config->getCreationDate()) {
-            $item['creationDate'] = $config->getCreationDate();
-        }
-        if ($config->getModificationDate()) {
-            $item['modificationDate'] = $config->getModificationDate();
-        }
-        return $item;
-    }
-    /**
-     * @Route("/add-property", name="pimcore_admin_dataobject_classificationstore_addproperty", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addPropertyAction(Request $request)
-    {
-        $name = $request->get('name');
-        $storeId = $request->get('storeId');
-        $definition = [
-            'fieldtype' => 'input',
-            'name' => $name,
-            'title' => $name,
-            'datatype' => 'data',
-        ];
-        $config = new Classificationstore\KeyConfig();
-        $config->setName($name);
-        $config->setTitle($name);
-        $config->setType('input');
-        $config->setStoreId($storeId);
-        $config->setEnabled(1);
-        $config->setDefinition(json_encode($definition));
-        $config->save();
-        return $this->adminJson(['success' => true, 'id' => $config->getName()]);
-    }
-    /**
-     * @Route("/delete-property", name="pimcore_admin_dataobject_classificationstore_deleteproperty", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deletePropertyAction(Request $request)
-    {
-        $id = $request->get('id');
-        $config = Classificationstore\KeyConfig::getById($id);
-        $config->setEnabled(false);
-        $config->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/edit-store", name="pimcore_admin_dataobject_classificationstore_editstore", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function editStoreAction(Request $request)
-    {
-        $id = $request->get('id');
-        $data = json_decode($request->get('data'), true);
-        $name = $data['name'];
-        if (!$name) {
-            throw new \Exception('Name must not be empty');
-        }
-        $description = $data['description'];
-        $config = Classificationstore\StoreConfig::getByName($name);
-        if ($config && $config->getId() != $id) {
-            throw new \Exception('There is already a config with the same name');
-        }
-        $config = Classificationstore\StoreConfig::getById($id);
-        if (!$config) {
-            throw new \Exception('Configuration does not exist');
-        }
-        $config->setName($name);
-        $config->setDescription($description);
-        $config->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/storetree", name="pimcore_admin_dataobject_classificationstore_storetree", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function storetreeAction(Request $request)
-    {
-        $result = [];
-        $list = new Classificationstore\StoreConfig\Listing();
-        $list = $list->load();
-        foreach ($list as $item) {
-            $resultItem = [
-                'id' => $item->getId(),
-                'text' => $item->getName(),
-                'expandable' => false,
-                'leaf' => true,
-                'expanded' => true,
-                'description' => $item->getDescription(),
-                'iconCls' => 'pimcore_icon_classificationstore',
-            ];
-            $resultItem['qtitle'] = 'ID: ' . $item->getId();
-            if ($item->getDescription()) {
-            }
-            $resultItem['qtip'] = $item->getDescription() ? $item->getDescription() : ' ';
-            $result[] = $resultItem;
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/get-page", name="pimcore_admin_dataobject_classificationstore_getpage", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getPageAction(Request $request)
-    {
-        $tableSuffix = $request->get('table');
-        if (!in_arrayi($tableSuffix, ['keys', 'groups'])) {
-            $tableSuffix = 'keys';
-        }
-        $table = 'classificationstore_' . $tableSuffix;
-        $db = \Pimcore\Db::get();
-        $id = (int) $request->get('id');
-        $storeId = (int) $request->get('storeId');
-        $pageSize = (int) $request->get('pageSize');
-        if ($request->get('sortKey')) {
-            $sortKey = $request->get('sortKey');
-            $sortDir = $request->get('sortDir');
-        } else {
-            $sortKey = 'name';
-            $sortDir = 'ASC';
-        }
-        if (!in_arrayi($sortDir, ['DESC', 'ASC'])) {
-            $sortDir = 'DESC';
-        }
-        if (!in_arrayi($sortKey, ['name', 'title', 'description', 'id', 'type', 'creationDate', 'modificationDate', 'enabled', 'parentId', 'storeId'])) {
-            $sortKey = 'name';
-        }
-        $sorter = ' order by `' . $sortKey .  '` ' . $sortDir;
-        if ($table == 'keys') {
-            $query = '
-                select *, (item.pos - 1)/ ' . $pageSize . ' + 1  as page from (
-                    select * from (
-                        select @rownum := @rownum + 1 as pos,  id, name, `type`
-                        from `' . $table . '`
-                        where enabled = 1 and storeId = ' . $storeId . $sorter . '
-                      ) all_rows) item where id = ' . $id . ';';
-        } else {
-            $query = '
-            select *, (item.pos - 1)/ ' . $pageSize . ' + 1  as page from (
-                select * from (
-                    select @rownum := @rownum + 1 as pos,  id, name
-                    from `' . $table . '`
-                    where storeId = ' . $storeId . $sorter . '
-                  ) all_rows) item where id = ' .  $id . ';';
-        }
-        $db->query('select @rownum := 0;');
-        $result = $db->fetchAll($query);
-        $page = (int) $result[0]['page'] ;
-        return $this->adminJson(['success' => true, 'page' => $page]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $unrestrictedActions = ['collectionsActionGet', 'groupsActionGet', 'relationsActionGet', 'addGroupsAction', 'addCollectionsAction', 'searchRelationsAction'];
-        $this->checkActionPermission($event, 'classes', $unrestrictedActions);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/DataObjectController.php
+++ b//dev/null
@@ -1,1922 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use Pimcore\Bundle\AdminBundle\Controller\Admin\ElementControllerBase;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\AdminStyleTrait;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\ApplySchedulerDataTrait;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Bundle\AdminBundle\Security\CsrfProtectionHandler;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Db;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Logger;
-use Pimcore\Model;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\DataObject\ClassDefinition\Data\ManyToManyObjectRelation;
-use Pimcore\Model\DataObject\ClassDefinition\Data\Relations\AbstractRelations;
-use Pimcore\Model\DataObject\ClassDefinition\Data\ReverseObjectRelation;
-use Pimcore\Model\Element;
-use Pimcore\Model\Version;
-use Pimcore\Tool;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/object")
- *
- * @internal
- */
-class DataObjectController extends ElementControllerBase implements KernelControllerEventInterface
-{
-    use AdminStyleTrait;
-    use ElementEditLockHelperTrait;
-    use ApplySchedulerDataTrait;
-    /**
-     * @var DataObject\Service
-     */
-    protected $_objectService;
-    /**
-     * @var array
-     */
-    private $objectData;
-    /**
-     * @var array
-     */
-    private $metaData;
-    /**
-     * @Route("/tree-get-root", name="pimcore_admin_dataobject_dataobject_treegetroot", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetRootAction(Request $request)
-    {
-        return parent::treeGetRootAction($request);
-    }
-    /**
-     * @Route("/delete-info", name="pimcore_admin_dataobject_dataobject_deleteinfo", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function deleteInfoAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        return parent::deleteInfoAction($request, $eventDispatcher);
-    }
-    /**
-     * @Route("/tree-get-childs-by-id", name="pimcore_admin_dataobject_dataobject_treegetchildsbyid", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function treeGetChildsByIdAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $filter = $request->get('filter');
-        $object = DataObject::getById($request->get('node'));
-        $objectTypes = null;
-        $objects = [];
-        $cv = false;
-        $offset = 0;
-        $total = 0;
-        if ($object instanceof DataObject\Concrete) {
-            $class = $object->getClass();
-            if ($class->getShowVariants()) {
-                $objectTypes = DataObject::$types;
-            }
-        }
-        if (!$objectTypes) {
-            $objectTypes = [DataObject::OBJECT_TYPE_OBJECT, DataObject::OBJECT_TYPE_FOLDER];
-        }
-        $filteredTotalCount = 0;
-        $limit = 0;
-        if ($object->hasChildren($objectTypes)) {
-            $limit = (int)$request->get('limit');
-            if (!is_null($filter)) {
-                if (substr($filter, -1) != '*') {
-                    $filter .= '*';
-                }
-                $filter = str_replace('*', '%', $filter);
-                $limit = 100;
-            } elseif (!$request->get('limit')) {
-                $limit = 100000000;
-            }
-            $offset = (int)$request->get('start');
-            $childsList = new DataObject\Listing();
-            $condition = "objects.o_parentId = '" . $object->getId() . "'";
-            if ($request->get('view')) {
-                $cv = Element\Service::getCustomViewById($request->get('view'));
-                if ($cv['classes']) {
-                    $cvConditions = [];
-                    $cvClasses = $cv['classes'];
-                    foreach ($cvClasses as $key => $cvClass) {
-                        $cvConditions[] = "objects.o_classId = '" . $key . "'";
-                    }
-                    $cvConditions[] = "objects.o_type = 'folder'";
-                    $condition .= ' AND (' . implode(' OR ', $cvConditions) . ')';
-                }
-            }
-            if (!$this->getAdminUser()->isAdmin()) {
-                $userIds = $this->getAdminUser()->getRoles();
-                $userIds[] = $this->getAdminUser()->getId();
-                $condition .= ' AND
-                (
-                    (SELECT list FROM users_workspaces_object WHERE userId IN (' . implode(',', $userIds) . ') AND LOCATE(CONCAT(objects.o_path,objects.o_key),cpath)=1 ORDER BY LENGTH(cpath) DESC, FIELD(userId, '. $this->getAdminUser()->getId() .') DESC, list DESC LIMIT 1)=1
-                    OR
-                    (SELECT list FROM users_workspaces_object WHERE userId IN (' . implode(',', $userIds) . ') AND LOCATE(cpath,CONCAT(objects.o_path,objects.o_key))=1 ORDER BY LENGTH(cpath) DESC, FIELD(userId, '. $this->getAdminUser()->getId() .') DESC, list DESC LIMIT 1)=1
-                )';
-            }
-            if (!is_null($filter)) {
-                $db = Db::get();
-                $condition .= ' AND CAST(objects.o_key AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci LIKE ' . $db->quote($filter);
-            }
-            $childsList->setCondition($condition);
-            $childsList->setLimit($limit);
-            $childsList->setOffset($offset);
-            if ($object->getChildrenSortBy() === 'index') {
-                $childsList->setOrderKey('objects.o_index ASC', false);
-            } else {
-                $childsList->setOrderKey(
-                    sprintf(
-                        'CAST(objects.o_%s AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci %s',
-                        $object->getChildrenSortBy(), $object->getChildrenSortOrder() ?? 'ASC'
-                    ),
-                    false
-                );
-            }
-            $childsList->setObjectTypes($objectTypes);
-            Element\Service::addTreeFilterJoins($cv, $childsList);
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $childsList,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::OBJECT_LIST_BEFORE_LIST_LOAD);
-            /** @var DataObject\Listing $childsList */
-            $childsList = $beforeListLoadEvent->getArgument('list');
-            $childs = $childsList->load();
-            $filteredTotalCount = $childsList->getTotalCount();
-            foreach ($childs as $child) {
-                $tmpObject = $this->getTreeNodeConfig($child);
-                if ($child->isAllowed('list')) {
-                    $objects[] = $tmpObject;
-                }
-            }
-            $total = $cv
-                ? $filteredTotalCount
-                : $object->getChildAmount(null, $this->getAdminUser());
-        }
-        $event = new GenericEvent($this, [
-            'objects' => $objects,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::OBJECT_TREE_GET_CHILDREN_BY_ID_PRE_SEND_DATA);
-        $objects = $event->getArgument('objects');
-        if ($limit) {
-            return $this->adminJson([
-                'offset' => $offset,
-                'limit' => $limit,
-                'total' => $total,
-                'overflow' => !is_null($filter) && ($filteredTotalCount > $limit),
-                'nodes' => $objects,
-                'fromPaging' => (int)$request->get('fromPaging'),
-                'filter' => $request->get('filter') ? $request->get('filter') : '',
-                'inSearch' => (int)$request->get('inSearch'),
-            ]);
-        }
-        return $this->adminJson($objects);
-    }
-    /**
-     * @param DataObject\AbstractObject $element
-     *
-     * @return array
-     */
-    protected function getTreeNodeConfig($element): array
-    {
-        $child = $element;
-        $tmpObject = [
-            'id' => $child->getId(),
-            'idx' => (int)$child->getIndex(),
-            'key' => $child->getKey(),
-            'sortBy' => $child->getChildrenSortBy(),
-            'sortOrder' => $child->getChildrenSortOrder(),
-            'text' => htmlspecialchars($child->getKey()),
-            'type' => $child->getType(),
-            'path' => $child->getRealFullPath(),
-            'basePath' => $child->getRealPath(),
-            'elementType' => 'object',
-            'locked' => $child->isLocked(),
-            'lockOwner' => $child->getLocked() ? true : false,
-        ];
-        $allowedTypes = [DataObject::OBJECT_TYPE_OBJECT, DataObject::OBJECT_TYPE_FOLDER];
-        if ($child instanceof DataObject\Concrete && $child->getClass()->getShowVariants()) {
-            $allowedTypes[] = DataObject::OBJECT_TYPE_VARIANT;
-        }
-        $hasChildren = $child->hasChildren($allowedTypes);
-        $tmpObject['isTarget'] = false;
-        $tmpObject['allowDrop'] = false;
-        $tmpObject['allowChildren'] = false;
-        $tmpObject['leaf'] = !$hasChildren;
-        $tmpObject['isTarget'] = true;
-        if ($tmpObject['type'] != DataObject::OBJECT_TYPE_VARIANT) {
-            $tmpObject['allowDrop'] = true;
-        }
-        $tmpObject['allowChildren'] = true;
-        $tmpObject['leaf'] = !$hasChildren;
-        $tmpObject['cls'] = 'pimcore_class_icon ';
-        if ($child instanceof DataObject\Concrete) {
-            $tmpObject['published'] = $child->isPublished();
-            $tmpObject['className'] = $child->getClass()->getName();
-            if (!$child->isPublished()) {
-                $tmpObject['cls'] .= 'pimcore_unpublished ';
-            }
-            $tmpObject['allowVariants'] = $child->getClass()->getAllowVariants();
-        }
-        $this->addAdminStyle($child, ElementAdminStyleEvent::CONTEXT_TREE, $tmpObject);
-        $tmpObject['expanded'] = !$hasChildren;
-        $tmpObject['permissions'] = $child->getUserPermissions();
-        if ($child->isLocked()) {
-            $tmpObject['cls'] .= 'pimcore_treenode_locked ';
-        }
-        if ($child->getLocked()) {
-            $tmpObject['cls'] .= 'pimcore_treenode_lockOwner ';
-        }
-        if ($tmpObject['leaf']) {
-            $tmpObject['expandable'] = false;
-            $tmpObject['expanded'] = true;
-            $tmpObject['leaf'] = false;
-            $tmpObject['loaded'] = true;
-        }
-        return $tmpObject;
-    }
-    /**
-     * @Route("/get-id-path-paging-info", name="pimcore_admin_dataobject_dataobject_getidpathpaginginfo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getIdPathPagingInfoAction(Request $request)
-    {
-        $path = $request->get('path');
-        $pathParts = explode('/', $path);
-        $id = array_pop($pathParts);
-        $limit = $request->get('limit');
-        if (empty($limit)) {
-            $limit = 30;
-        }
-        $data = [];
-        $targetObject = DataObject::getById($id);
-        $object = $targetObject;
-        while ($parent = $object->getParent()) {
-            $list = new DataObject\Listing();
-            $list->setCondition('o_parentId = ?', $parent->getId());
-            $list->setUnpublished(true);
-            $total = $list->getTotalCount();
-            $info = [
-                'total' => $total,
-            ];
-            if ($total > $limit) {
-                $idList = $list->loadIdList();
-                $position = array_search($object->getId(), $idList);
-                $info['position'] = $position + 1;
-                $info['page'] = ceil($info['position'] / $limit);
-                $containsPaging = true;
-            }
-            $data[$parent->getId()] = $info;
-            $object = $parent;
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/get", name="pimcore_admin_dataobject_dataobject_get", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $objectFromDatabase = DataObject\Concrete::getById((int)$request->get('id'));
-        if ($objectFromDatabase === null) {
-            return $this->adminJson(['success' => false, 'message' => 'element_not_found'], JsonResponse::HTTP_NOT_FOUND);
-        }
-        $objectFromDatabase = clone $objectFromDatabase;
-        $draftVersion = null;
-        $object = $this->getLatestVersion($objectFromDatabase, $draftVersion);
-        if ($object->isAllowed('save') || $object->isAllowed('publish') || $object->isAllowed('unpublish') || $object->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'object')) {
-                return $this->getEditLockResponse($request->get('id'), 'object');
-            }
-            Element\Editlock::lock($request->get('id'), 'object');
-        }
-        $objectFromVersion = $object !== $objectFromDatabase;
-        if ($object->isAllowed('view')) {
-            $objectData = [];
-            /** -------------------------------------------------------------
-             *   Load some general data from published object (if existing)
-             *  ------------------------------------------------------------- */
-            $objectData['idPath'] = Element\Service::getIdPath($objectFromDatabase);
-            $previewGenerator = $objectFromDatabase->getClass()->getPreviewGenerator();
-            $linkGeneratorReference = $objectFromDatabase->getClass()->getLinkGeneratorReference();
-            $objectData['hasPreview'] = false;
-            if ($objectFromDatabase->getClass()->getPreviewUrl() || $linkGeneratorReference || $previewGenerator) {
-                $objectData['hasPreview'] = true;
-            }
-            if ($draftVersion && $objectFromDatabase->getModificationDate() < $draftVersion->getDate()) {
-                $objectData['draft'] = [
-                    'id' => $draftVersion->getId(),
-                    'modificationDate' => $draftVersion->getDate(),
-                ];
-            }
-            $objectData['general'] = [];
-            $allowedKeys = ['o_published', 'o_key', 'o_id', 'o_creationDate', 'o_classId', 'o_className', 'o_type', 'o_parentId', 'o_userOwner'];
-            foreach ($objectFromDatabase->getObjectVars() as $key => $value) {
-                if (in_array($key, $allowedKeys)) {
-                    $objectData['general'][$key] = $value;
-                }
-            }
-            $objectData['general']['fullpath'] = $objectFromDatabase->getRealFullPath();
-            $objectData['general']['o_locked'] = $objectFromDatabase->isLocked();
-            $objectData['general']['php'] = [
-                'classes' => array_merge([get_class($objectFromDatabase)], array_values(class_parents($objectFromDatabase))),
-                'interfaces' => array_values(class_implements($objectFromDatabase)),
-            ];
-            $objectData['general']['allowInheritance'] = $objectFromDatabase->getClass()->getAllowInherit();
-            $objectData['general']['allowVariants'] = $objectFromDatabase->getClass()->getAllowVariants();
-            $objectData['general']['showVariants'] = $objectFromDatabase->getClass()->getShowVariants();
-            $objectData['general']['showAppLoggerTab'] = $objectFromDatabase->getClass()->getShowAppLoggerTab();
-            $objectData['general']['showFieldLookup'] = $objectFromDatabase->getClass()->getShowFieldLookup();
-            if ($objectFromDatabase instanceof DataObject\Concrete) {
-                $objectData['general']['linkGeneratorReference'] = $linkGeneratorReference;
-                if ($previewGenerator) {
-                    $objectData['general']['previewConfig'] = $previewGenerator->getPreviewConfig($objectFromDatabase);
-                }
-            }
-            $objectData['layout'] = $objectFromDatabase->getClass()->getLayoutDefinitions();
-            $objectData['userPermissions'] = $objectFromDatabase->getUserPermissions();
-            $objectVersions = Element\Service::getSafeVersionInfo($objectFromDatabase->getVersions());
-            $objectData['versions'] = array_splice($objectVersions, -1, 1);
-            $objectData['scheduledTasks'] = $objectFromDatabase->getScheduledTasks();
-            $objectData['childdata']['id'] = $objectFromDatabase->getId();
-            $objectData['childdata']['data']['classes'] = $this->prepareChildClasses($objectFromDatabase->getDao()->getClasses());
-            $objectData['childdata']['data']['general'] = $objectData['general'];
-            /** -------------------------------------------------------------
-             *   Load remaining general data from latest version
-             *  ------------------------------------------------------------- */
-            $allowedKeys = ['o_modificationDate', 'o_userModification'];
-            foreach ($object->getObjectVars() as $key => $value) {
-                if (in_array($key, $allowedKeys)) {
-                    $objectData['general'][$key] = $value;
-                }
-            }
-            $this->getDataForObject($object, $objectFromVersion);
-            $objectData['data'] = $this->objectData;
-            $objectData['metaData'] = $this->metaData;
-            $objectData['properties'] = Element\Service::minimizePropertiesForEditmode($object->getProperties());
-            $objectData['general']['versionDate'] = $objectFromDatabase->getModificationDate();
-            $objectData['general']['versionCount'] = $objectFromDatabase->getVersionCount();
-            $this->addAdminStyle($object, ElementAdminStyleEvent::CONTEXT_EDITOR, $objectData['general']);
-            $currentLayoutId = $request->get('layoutId', null);
-            $validLayouts = DataObject\Service::getValidLayouts($object);
-            $ok = false;
-            foreach ($validLayouts as $key => $layout) {
-                if ($currentLayoutId == $layout->getId()) {
-                    $ok = true;
-                }
-            }
-            if (!$ok) {
-                if (count($validLayouts) > 0) {
-                    $currentLayoutId = reset($validLayouts)->getId();
-                }
-            }
-            if ((is_null($currentLayoutId) || !strlen($currentLayoutId)) && !empty($validLayouts)) {
-                if (count($validLayouts) == 1) {
-                    $firstLayout = reset($validLayouts);
-                    $currentLayoutId = $firstLayout->getId();
-                } else {
-                    foreach ($validLayouts as $checkDefaultLayout) {
-                        if ($checkDefaultLayout->getDefault()) {
-                            $currentLayoutId = $checkDefaultLayout->getId();
-                        }
-                    }
-                }
-            }
-            if (!empty($validLayouts)) {
-                $objectData['validLayouts'] = [ ];
-                foreach ($validLayouts as $validLayout) {
-                    $objectData['validLayouts'][] = ['id' => $validLayout->getId(), 'name' => $validLayout->getName()];
-                }
-                $user = Tool\Admin::getCurrentUser();
-                if (!is_null($currentLayoutId)) {
-                    if ($currentLayoutId == '0' && !$user->isAdmin()) {
-                        $first = reset($validLayouts);
-                        $currentLayoutId = $first->getId();
-                    }
-                }
-                if ($currentLayoutId == -1 && $user->isAdmin()) {
-                    $layout = DataObject\Service::getSuperLayoutDefinition($object);
-                    $objectData['layout'] = $layout;
-                } elseif (!empty($currentLayoutId)) {
-                    if (is_array($validLayouts) && $validLayouts[$currentLayoutId]) {
-                        $customLayout = DataObject\ClassDefinition\CustomLayout::getById($currentLayoutId);
-                        $customLayoutDefinition = $customLayout->getLayoutDefinitions();
-                        $objectData['layout'] = $customLayoutDefinition;
-                    } else {
-                        $currentLayoutId = 0;
-                    }
-                }
-                $objectData['currentLayoutId'] = $currentLayoutId;
-            }
-            $event = new GenericEvent($this, [
-                'data' => $objectData,
-                'object' => $object,
-            ]);
-            DataObject\Service::enrichLayoutDefinition($objectData['layout'], $object);
-            $eventDispatcher->dispatch($event, AdminEvents::OBJECT_GET_PRE_SEND_DATA);
-            $data = $event->getArgument('data');
-            DataObject\Service::removeElementFromSession('object', $object->getId());
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param DataObject\Concrete $object
-     * @param bool $objectFromVersion
-     */
-    private function getDataForObject(DataObject\Concrete $object, $objectFromVersion = false)
-    {
-        foreach ($object->getClass()->getFieldDefinitions(['object' => $object]) as $key => $def) {
-            $this->getDataForField($object, $key, $def, $objectFromVersion);
-        }
-    }
-    /**
-     * gets recursively attribute data from parent and fills objectData and metaData
-     *
-     * @param DataObject\Concrete $object
-     * @param string $key
-     * @param DataObject\ClassDefinition\Data $fielddefinition
-     * @param bool $objectFromVersion
-     * @param int $level
-     */
-    private function getDataForField($object, $key, $fielddefinition, $objectFromVersion, $level = 0)
-    {
-        $parent = DataObject\Service::hasInheritableParentObject($object);
-        $getter = 'get' . ucfirst($key);
-        if (
-            (!$objectFromVersion && $fielddefinition instanceof AbstractRelations)
-            || $fielddefinition instanceof ReverseObjectRelation
-        ) {
-            $refId = null;
-            if ($fielddefinition instanceof ReverseObjectRelation) {
-                $refKey = $fielddefinition->getOwnerFieldName();
-                $refClass = DataObject\ClassDefinition::getByName($fielddefinition->getOwnerClassName());
-                if ($refClass) {
-                    $refId = $refClass->getId();
-                }
-            } else {
-                $refKey = $key;
-            }
-            $relations = $object->getRelationData($refKey, !$fielddefinition instanceof ReverseObjectRelation, $refId);
-            if (empty($relations) && !empty($parent)) {
-                $this->getDataForField($parent, $key, $fielddefinition, $objectFromVersion, $level + 1);
-            } else {
-                $data = [];
-                if ($fielddefinition instanceof DataObject\ClassDefinition\Data\ManyToOneRelation) {
-                    if (isset($relations[0])) {
-                        $data = $relations[0];
-                        $data['published'] = (bool)$data['published'];
-                    } else {
-                        $data = null;
-                    }
-                } elseif (
-                    ($fielddefinition instanceof DataObject\ClassDefinition\Data\OptimizedAdminLoadingInterface && $fielddefinition->isOptimizedAdminLoading())
-                    || ($fielddefinition instanceof ManyToManyObjectRelation && !$fielddefinition->getVisibleFields() && !$fielddefinition instanceof DataObject\ClassDefinition\Data\AdvancedManyToManyObjectRelation)
-                ) {
-                    foreach ($relations as $rkey => $rel) {
-                        $index = $rkey + 1;
-                        $rel['fullpath'] = $rel['path'];
-                        $rel['classname'] = $rel['subtype'];
-                        $rel['rowId'] = $rel['id'] . AbstractRelations::RELATION_ID_SEPARATOR . $index . AbstractRelations::RELATION_ID_SEPARATOR . $rel['type'];
-                        $rel['published'] = (bool)$rel['published'];
-                        $data[] = $rel;
-                    }
-                } else {
-                    $fieldData = $object->$getter();
-                    $data = $fielddefinition->getDataForEditmode($fieldData, $object, ['objectFromVersion' => $objectFromVersion]);
-                }
-                $this->objectData[$key] = $data;
-                $this->metaData[$key]['objectid'] = $object->getId();
-                $this->metaData[$key]['inherited'] = $level != 0;
-            }
-        } else {
-            $fieldData = $object->$getter();
-            $isInheritedValue = false;
-            if ($fielddefinition instanceof DataObject\ClassDefinition\Data\CalculatedValue) {
-                $fieldData = new DataObject\Data\CalculatedValue($fielddefinition->getName());
-                $fieldData->setContextualData('object', null, null, null, null, null, $fielddefinition);
-                $value = $fielddefinition->getDataForEditmode($fieldData, $object, ['objectFromVersion' => $objectFromVersion]);
-            } else {
-                $value = $fielddefinition->getDataForEditmode($fieldData, $object, ['objectFromVersion' => $objectFromVersion]);
-            }
-            if ($value && ($fieldData instanceof DataObject\Localizedfield || $fieldData instanceof DataObject\Classificationstore)) {
-                $isInheritedValue = $value['inherited'];
-            }
-            if ($fielddefinition instanceof DataObject\ClassDefinition\Data\Objectbricks && is_array($value)) {
-                foreach ($value as $singleBrickData) {
-                    if (!empty($singleBrickData['inherited'])) {
-                        $isInheritedValue = true;
-                    }
-                }
-            }
-            if ($fielddefinition->isEmpty($fieldData) && !empty($parent)) {
-                $this->getDataForField($parent, $key, $fielddefinition, $objectFromVersion, $level + 1);
-                if ($fielddefinition instanceof DataObject\ClassDefinition\Data\Classificationstore && $level == 0) {
-                    $this->objectData[$key]['metaData'] = $value['metaData'] ?? [];
-                    $this->objectData[$key]['inherited'] = true;
-                }
-            } else {
-                $isInheritedValue = $isInheritedValue || ($level != 0);
-                $this->metaData[$key]['objectid'] = $object->getId();
-                $this->objectData[$key] = $value;
-                $this->metaData[$key]['inherited'] = $isInheritedValue;
-                if ($isInheritedValue && !$fielddefinition->isEmpty($fieldData) && !$fielddefinition->supportsInheritance()) {
-                    $this->objectData[$key] = null;
-                    $this->metaData[$key]['inherited'] = false;
-                    $this->metaData[$key]['hasParentValue'] = true;
-                }
-            }
-        }
-    }
-    /**
-     * @Route("/get-folder", name="pimcore_admin_dataobject_dataobject_getfolder", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function getFolderAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        if (Element\Editlock::isLocked($request->get('id'), 'object')) {
-            return $this->getEditLockResponse($request->get('id'), 'object');
-        }
-        Element\Editlock::lock($request->get('id'), 'object');
-        $object = DataObject::getById((int)$request->get('id'));
-        if ($object->isAllowed('view')) {
-            $objectData = [];
-            $objectData['general'] = [];
-            $objectData['idPath'] = Element\Service::getIdPath($object);
-            $allowedKeys = ['o_published', 'o_key', 'o_id', 'o_type', 'o_path', 'o_modificationDate', 'o_creationDate', 'o_userOwner', 'o_userModification'];
-            foreach ($object->getObjectVars() as $key => $value) {
-                if (strstr($key, 'o_') && in_array($key, $allowedKeys)) {
-                    $objectData['general'][$key] = $value;
-                }
-            }
-            $objectData['general']['fullpath'] = $object->getRealFullPath();
-            $objectData['general']['o_locked'] = $object->isLocked();
-            $objectData['properties'] = Element\Service::minimizePropertiesForEditmode($object->getProperties());
-            $objectData['userPermissions'] = $object->getUserPermissions();
-            $objectData['classes'] = $this->prepareChildClasses($object->getDao()->getClasses());
-            $configFile = PIMCORE_CONFIGURATION_DIRECTORY . '/object/grid/' . $object->getId() . '-user_' . $this->getAdminUser()->getId() . '.psf';
-            if (is_file($configFile)) {
-                $gridConfig = Tool\Serialize::unserialize(file_get_contents($configFile));
-                if ($gridConfig) {
-                    $selectedClassId = $gridConfig['classId'];
-                    foreach ($objectData['classes'] as $class) {
-                        if ($class['id'] == $selectedClassId) {
-                            $objectData['selectedClass'] = $selectedClassId;
-                            break;
-                        }
-                    }
-                }
-            }
-            $event = new GenericEvent($this, [
-                'data' => $objectData,
-                'object' => $object,
-            ]);
-            $eventDispatcher->dispatch($event, AdminEvents::OBJECT_GET_PRE_SEND_DATA);
-            $objectData = $event->getArgument('data');
-            return $this->adminJson($objectData);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param DataObject\ClassDefinition[] $classes
-     *
-     * @return array
-     */
-    protected function prepareChildClasses($classes)
-    {
-        $reduced = [];
-        foreach ($classes as $class) {
-            $reduced[] = [
-                'id' => $class->getId(),
-                'name' => $class->getName(),
-                'inheritance' => $class->getAllowInherit(),
-            ];
-        }
-        return $reduced;
-    }
-    /**
-     * @Route("/add", name="pimcore_admin_dataobject_dataobject_add", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Model\FactoryInterface $modelFactory
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request, Model\FactoryInterface $modelFactory)
-    {
-        $success = false;
-        $className = 'Pimcore\\Model\\DataObject\\' . ucfirst($request->get('className'));
-        $parent = DataObject::getById($request->get('parentId'));
-        $message = '';
-        $object = null;
-        if ($parent->isAllowed('create')) {
-            $intendedPath = $parent->getRealFullPath() . '/' . $request->get('key');
-            if (!DataObject\Service::pathExists($intendedPath)) {
-                /** @var DataObject\Concrete $object */
-                $object = $modelFactory->build($className);
-                $object->setOmitMandatoryCheck(true); // allow to save the object although there are mandatory fields
-                if ($request->get('variantViaTree')) {
-                    $parentId = $request->get('parentId');
-                    $parent = DataObject\Concrete::getById($parentId);
-                    $object->setClassId($parent->getClass()->getId());
-                } else {
-                    $object->setClassId($request->get('classId'));
-                }
-                $object->setClassName($request->get('className'));
-                $object->setParentId($request->get('parentId'));
-                $object->setKey($request->get('key'));
-                $object->setCreationDate(time());
-                $object->setUserOwner($this->getAdminUser()->getId());
-                $object->setUserModification($this->getAdminUser()->getId());
-                $object->setPublished(false);
-                if ($request->get('objecttype') == DataObject::OBJECT_TYPE_OBJECT
-                    || $request->get('objecttype') == DataObject::OBJECT_TYPE_VARIANT) {
-                    $object->setType($request->get('objecttype'));
-                }
-                try {
-                    $object->save();
-                    $success = true;
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            } else {
-                $message = 'prevented creating object because object with same path+key already exists';
-                Logger::debug($message);
-            }
-        } else {
-            $message = 'prevented adding object because of missing permissions';
-            Logger::debug($message);
-        }
-        if ($success && $object instanceof DataObject\AbstractObject) {
-            return $this->adminJson([
-                'success' => $success,
-                'id' => $object->getId(),
-                'type' => $object->getType(),
-                'message' => $message,
-            ]);
-        } else {
-            return $this->adminJson([
-                'success' => $success,
-                'message' => $message,
-            ]);
-        }
-    }
-    /**
-     * @Route("/add-folder", name="pimcore_admin_dataobject_dataobject_addfolder", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addFolderAction(Request $request)
-    {
-        $success = false;
-        $parent = DataObject::getById($request->get('parentId'));
-        if ($parent->isAllowed('create')) {
-            if (!DataObject\Service::pathExists($parent->getRealFullPath() . '/' . $request->get('key'))) {
-                $folder = DataObject\Folder::create([
-                    'o_parentId' => $request->get('parentId'),
-                    'o_creationDate' => time(),
-                    'o_userOwner' => $this->getAdminUser()->getId(),
-                    'o_userModification' => $this->getAdminUser()->getId(),
-                    'o_key' => $request->get('key'),
-                    'o_published' => true,
-                ]);
-                $folder->setCreationDate(time());
-                $folder->setUserOwner($this->getAdminUser()->getId());
-                $folder->setUserModification($this->getAdminUser()->getId());
-                try {
-                    $folder->save();
-                    $success = true;
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            }
-        } else {
-            Logger::debug('prevented creating object id because of missing permissions');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_dataobject_dataobject_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function deleteAction(Request $request)
-    {
-        if ($request->get('type') == 'childs') {
-            $parentObject = DataObject::getById($request->get('id'));
-            $list = new DataObject\Listing();
-            $list->setCondition('o_path LIKE ' . $list->quote($list->escapeLike($parentObject->getRealFullPath()) . '/%'));
-            $list->setLimit((int)$request->get('amount'));
-            $list->setOrderKey('LENGTH(o_path)', false);
-            $list->setOrder('DESC');
-            $deletedItems = [];
-            foreach ($list as $object) {
-                $deletedItems[$object->getId()] = $object->getRealFullPath();
-                if ($object->isAllowed('delete') && !$object->isLocked()) {
-                    $object->delete();
-                }
-            }
-            return $this->adminJson(['success' => true, 'deleted' => $deletedItems]);
-        } elseif ($request->get('id')) {
-            $object = DataObject::getById($request->get('id'));
-            if ($object) {
-                if (!$object->isAllowed('delete')) {
-                    throw $this->createAccessDeniedHttpException();
-                } elseif ($object->isLocked()) {
-                    return $this->adminJson(['success' => false, 'message' => 'prevented deleting object, because it is locked: ID: ' . $object->getId()]);
-                } else {
-                    $object->delete();
-                }
-            }
-            return $this->adminJson(['success' => true]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/change-children-sort-by", name="pimcore_admin_dataobject_dataobject_changechildrensortby", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function changeChildrenSortByAction(Request $request)
-    {
-        $object = DataObject::getById($request->get('id'));
-        if ($object) {
-            $sortBy = $request->get('sortBy');
-            $sortOrder = $request->get('childrenSortOrder');
-            $currentSortBy = $object->getChildrenSortBy();
-            $object->setChildrenSortBy($sortBy);
-            $object->setChildrenSortOrder($sortOrder);
-            if ($currentSortBy != $sortBy) {
-                $user = Tool\Admin::getCurrentUser();
-                if (!$user->isAdmin()) {
-                    return $this->json(['success' => false, 'message' => 'Changing the sort method is only allowed for admin users']);
-                }
-                if ($sortBy == 'index') {
-                    $this->reindexBasedOnSortOrder($object, $sortOrder);
-                }
-            }
-            $object->save();
-            return $this->json(['success' => true]);
-        }
-        return $this->json(['success' => false, 'message' => 'Unable to change a sorting way of children items.']);
-    }
-    /**
-     * @Route("/update", name="pimcore_admin_dataobject_dataobject_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function updateAction(Request $request)
-    {
-        $success = false;
-        $object = DataObject::getById($request->get('id'));
-        if ($object instanceof DataObject\Concrete) {
-            $object->setOmitMandatoryCheck(true);
-        }
-        if ($object instanceof DataObject\Concrete) {
-            $latestVersion = $object->getLatestVersion();
-            if ($latestVersion && $latestVersion->getData()->getModificationDate() != $object->getModificationDate()) {
-                return $this->adminJson(['success' => false, 'message' => "You can't rename or relocate if there's a newer not published version"]);
-            }
-        }
-        $values = $this->decodeJson($request->get('values'));
-        if ($object->isAllowed('settings')) {
-            if (isset($values['key']) && $values['key'] && $object->isAllowed('rename')) {
-                $object->setKey($values['key']);
-            } elseif (!isset($values['key']) || $values['key'] != $object->getKey()) {
-                Logger::debug('prevented renaming object because of missing permissions ');
-            }
-            if (!empty($values['parentId'])) {
-                $parent = DataObject::getById($values['parentId']);
-                if ($object->getParentId() != $parent->getId()) {
-                    if (!$parent->isAllowed('create')) {
-                        throw new \Exception('Prevented moving object - no create permission on new parent ');
-                    }
-                    $objectWithSamePath = DataObject::getByPath($parent->getRealFullPath() . '/' . $object->getKey());
-                    if ($objectWithSamePath != null) {
-                        return $this->adminJson(['success' => false, 'message' => 'prevented creating object because object with same path+key already exists']);
-                    }
-                    if ($object->isLocked()) {
-                        return $this->adminJson(['success' => false, 'message' => 'prevented moving object, because it is locked: ID: ' . $object->getId()]);
-                    }
-                    $object->setParentId($values['parentId']);
-                }
-            }
-            if (array_key_exists('locked', $values)) {
-                $object->setLocked($values['locked']);
-            }
-            $object->setModificationDate(time());
-            $object->setUserModification($this->getAdminUser()->getId());
-            try {
-                $isIndexUpdate = isset($values['index']) && is_int($values['index']);
-                if ($isIndexUpdate) {
-                    $object->setIndex($values['index']);
-                }
-                $object->save();
-                if ($isIndexUpdate) {
-                    $this->updateIndexesOfObjectSiblings($object, $values['index']);
-                }
-                $success = true;
-            } catch (\Exception $e) {
-                Logger::error($e);
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        } elseif ($object->isAllowed('rename') && $values['key']) {
-            try {
-                $object->setKey($values['key']);
-                $object->save();
-                $success = true;
-            } catch (\Exception $e) {
-                Logger::error($e);
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        } else {
-            Logger::debug('prevented update object because of missing permissions.');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    private function executeInsideTransaction(callable $fn)
-    {
-        $maxRetries = 5;
-        for ($retries = 0; $retries < $maxRetries; $retries++) {
-            try {
-                Db::get()->beginTransaction();
-                $fn();
-                Db::get()->commit();
-                break;
-            } catch (\Exception $e) {
-                Db::get()->rollBack();
-                if ($retries < ($maxRetries - 1)) {
-                    $run = $retries + 1;
-                    $waitTime = rand(1, 5) * 100000; // microseconds
-                    Logger::warn('Unable to finish transaction (' . $run . ". run) because of the following reason '" . $e->getMessage() . "'. --> Retrying in " . $waitTime . ' microseconds ... (' . ($run + 1) . ' of ' . $maxRetries . ')');
-                    usleep($waitTime); // wait specified time until we restart the transaction
-                } else {
-                    Logger::error('Finally giving up restarting the same transaction again and again, last message: ' . $e->getMessage());
-                    throw $e;
-                }
-            }
-        }
-    }
-    /**
-     * @param DataObject\AbstractObject $parentObject
-     * @param string $currentSortOrder
-     */
-    protected function reindexBasedOnSortOrder(DataObject\AbstractObject $parentObject, string $currentSortOrder)
-    {
-        $fn = function () use ($parentObject, $currentSortOrder) {
-            $list = new DataObject\Listing();
-            Db::get()->executeUpdate(
-                'UPDATE '.$list->getDao()->getTableName().' o,
-                    (
-                    SELECT newIndex, o_id FROM (
-                        SELECT @n := @n +1 AS newIndex, o_id
-                        FROM '.$list->getDao()->getTableName().',
-                                (SELECT @n := -1) variable
-                                 WHERE o_parentId = ? ORDER BY o_key ' . $currentSortOrder
-                               .') tmp
-                    ) order_table
-                    SET o.o_index = order_table.newIndex
-                    WHERE o.o_id=order_table.o_id',
-                [
-                    $parentObject->getId(),
-                ]
-            );
-            $db = Db::get();
-            $children = $db->fetchAll(
-                'SELECT o_id, o_modificationDate, o_versionCount FROM objects'
-                .' WHERE o_parentId = ? ORDER BY o_index ASC',
-                [$parentObject->getId()]
-            );
-            $index = 0;
-            foreach ($children as $child) {
-                $this->updateLatestVersionIndex($child['o_id'], $child['o_modificationDate']);
-                $index++;
-                DataObject::clearDependentCacheByObjectId($child['o_id']);
-            }
-        };
-        $this->executeInsideTransaction($fn);
-    }
-    private function updateLatestVersionIndex($objectId, $newIndex)
-    {
-        $object = DataObject\Concrete::getById($objectId);
-        if ($object && $latestVersion = $object->getLatestVersion()) {
-            $object = $latestVersion->loadData(false);
-            if ($newIndex !== $object->getIndex()) {
-                $object->setIndex($newIndex);
-            }
-            $latestVersion->save();
-        }
-    }
-    /**
-     * @param DataObject\AbstractObject $updatedObject
-     * @param int $newIndex
-     */
-    protected function updateIndexesOfObjectSiblings(DataObject\AbstractObject $updatedObject, $newIndex)
-    {
-        $fn = function () use ($updatedObject, $newIndex) {
-            $list = new DataObject\Listing();
-            $updatedObject->saveIndex($newIndex);
-            Db::get()->executeUpdate(
-                'UPDATE '.$list->getDao()->getTableName().' o,
-                    (
-                        SELECT newIndex, o_id FROM (SELECT @n := IF(@n = ? - 1,@n + 2,@n + 1) AS newIndex, o_id
-                        FROM '.$list->getDao()->getTableName().',
-                        (SELECT @n := -1) variable
-                        WHERE o_id != ? AND o_parentId = ? AND o_type IN (\''.implode(
-                    "','", [
-                        DataObject::OBJECT_TYPE_OBJECT,
-                        DataObject::OBJECT_TYPE_VARIANT,
-                        DataObject::OBJECT_TYPE_FOLDER,
-                    ]
-                ).'\')
-                            ORDER BY o_index, o_id=?
-                        ) tmp
-                    ) order_table
-                    SET o.o_index = order_table.newIndex
-                    WHERE o.o_id=order_table.o_id',
-                [
-                    $newIndex,
-                    $updatedObject->getId(),
-                    $updatedObject->getParentId(),
-                    $updatedObject->getId(),
-                ]
-            );
-            $db = Db::get();
-            $siblings = $db->fetchAll(
-                'SELECT o_id, o_modificationDate, o_versionCount FROM objects'
-                ." WHERE o_parentId = ? AND o_id != ? AND o_type IN ('object', 'variant','folder') ORDER BY o_index ASC",
-                [$updatedObject->getParentId(), $updatedObject->getId()]
-            );
-            $index = 0;
-            foreach ($siblings as $sibling) {
-                if ($index == $newIndex) {
-                    $index++;
-                }
-                $this->updateLatestVersionIndex($sibling['o_id'], $index);
-                $index++;
-                DataObject::clearDependentCacheByObjectId($sibling['o_id']);
-            }
-        };
-        $this->executeInsideTransaction($fn);
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_dataobject_dataobject_save", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $objectFromDatabase = DataObject\Concrete::getById($request->get('id'));
-        $object = $this->getLatestVersion($objectFromDatabase);
-        $object->setUserModification($this->getAdminUser()->getId());
-        $objectFromVersion = $object !== $objectFromDatabase;
-        $originalModificationDate = $objectFromVersion ? $object->getModificationDate() : $objectFromDatabase->getModificationDate();
-        if ($objectFromVersion) {
-            if (method_exists($object, 'getLocalizedFields')) {
-                /** @var DataObject\Localizedfield $localizedFields */
-                $localizedFields = $object->getLocalizedFields();
-                $localizedFields->setLoadedAllLazyData();
-            }
-        }
-        $data = [];
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            foreach ($data as $key => $value) {
-                $fd = $object->getClass()->getFieldDefinition($key);
-                if ($fd) {
-                    if ($fd instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                        $user = Tool\Admin::getCurrentUser();
-                        if (!$user->getAdmin()) {
-                            $allowedLanguages = DataObject\Service::getLanguagePermissions($object, $user, 'lEdit');
-                            if (!is_null($allowedLanguages)) {
-                                $allowedLanguages = array_keys($allowedLanguages);
-                                $submittedLanguages = array_keys($data[$key]);
-                                foreach ($submittedLanguages as $submittedLanguage) {
-                                    if (!in_array($submittedLanguage, $allowedLanguages)) {
-                                        unset($value[$submittedLanguage]);
-                                    }
-                                }
-                            }
-                        }
-                    }
-                    if ($fd instanceof ReverseObjectRelation) {
-                        $remoteClass = DataObject\ClassDefinition::getByName($fd->getOwnerClassName());
-                        $relations = $object->getRelationData($fd->getOwnerFieldName(), false, $remoteClass->getId());
-                        $toAdd = $this->detectAddedRemoteOwnerRelations($relations, $value);
-                        $toDelete = $this->detectDeletedRemoteOwnerRelations($relations, $value);
-                        if (count($toAdd) > 0 or count($toDelete) > 0) {
-                            $this->processRemoteOwnerRelations($object, $toDelete, $toAdd, $fd->getOwnerFieldName());
-                        }
-                    } else {
-                        $object->setValue($key, $fd->getDataFromEditmode($value, $object, ['objectFromVersion' => $objectFromVersion]));
-                    }
-                }
-            }
-        }
-        if ($request->get('general')) {
-            $general = $this->decodeJson($request->get('general'));
-            if (is_array($general) && count($general) > 0) {
-                foreach ($general as $key => $value) {
-                    if (!in_array($key, ['o_id', 'o_classId', 'o_className', 'o_type', 'icon', 'o_userOwner', 'o_userModification', 'o_modificationDate'])) {
-                        $object->setValue($key, $value);
-                    }
-                }
-            }
-        }
-        $this->assignPropertiesFromEditmode($request, $object);
-        $this->applySchedulerDataToElement($request, $object);
-        if (($request->get('task') === 'unpublish' && !$object->isAllowed('unpublish')) || ($request->get('task') === 'publish' && !$object->isAllowed('publish'))) {
-            throw $this->createAccessDeniedHttpException();
-        }
-        if ($request->get('task') == 'unpublish') {
-            $object->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $object->setPublished(true);
-        }
-        if (in_array($request->get('task'), ['unpublish', 'version', 'autoSave'])) {
-            $object->setOmitMandatoryCheck(true);
-        }
-        if (($request->get('task') == 'publish') || ($request->get('task') == 'unpublish')) {
-            $object->save();
-            $treeData = $this->getTreeNodeConfig($object);
-            $newObject = DataObject::getById($object->getId(), true);
-            if ($request->get('task') == 'publish') {
-                $object->deleteAutoSaveVersions($this->getUser()->getId());
-            }
-            return $this->adminJson([
-                'success' => true,
-                'general' => ['o_modificationDate' => $object->getModificationDate(),
-                    'versionDate' => $newObject->getModificationDate(),
-                    'versionCount' => $newObject->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } elseif ($request->get('task') == 'session') {
-            DataObject\Service::saveElementToSession($object, '', false);
-            return $this->adminJson(['success' => true]);
-        } elseif ($request->get('task') == 'scheduler') {
-            if ($object->isAllowed('settings')) {
-                $object->saveScheduledTasks();
-                return $this->adminJson(['success' => true]);
-            }
-        } elseif ($object->isAllowed('save')) {
-            $isAutoSave = $request->get('task') == 'autoSave';
-            $draftData = [];
-            if ($object->isPublished() || $isAutoSave) {
-                $version = $object->saveVersion(true, true, null, $isAutoSave);
-                $draftData = [
-                    'id' => $version->getId(),
-                    'modificationDate' => $version->getDate(),
-                ];
-            } else {
-                $object->save();
-            }
-            if ($request->get('task') == 'version') {
-                $object->deleteAutoSaveVersions($this->getUser()->getId());
-            }
-            $treeData = $this->getTreeNodeConfig($object);
-            $newObject = DataObject::getById($object->getId(), true);
-            return $this->adminJson([
-                'success' => true,
-                'general' => ['o_modificationDate' => $object->getModificationDate(),
-                    'versionDate' => $newObject->getModificationDate(),
-                    'versionCount' => $newObject->getVersionCount(),
-                ],
-                'draft' => $draftData,
-                'treeData' => $treeData,
-            ]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param Request $request
-     * @param DataObject\Concrete $object
-     * @param int $originalModificationDate
-     * @param array $data
-     *
-     * @return bool
-     *
-     * @throws \Exception
-     */
-    protected function performFieldcollectionModificationCheck(Request $request, DataObject\Concrete $object, $originalModificationDate, $data)
-    {
-        $modificationDate = $request->get('modificationDate');
-        if ($modificationDate != $originalModificationDate) {
-            $fielddefinitions = $object->getClass()->getFieldDefinitions();
-            foreach ($fielddefinitions as $fd) {
-                if ($fd instanceof DataObject\ClassDefinition\Data\Fieldcollections) {
-                    if (isset($data[$fd->getName()])) {
-                        $allowedTypes = $fd->getAllowedTypes();
-                        foreach ($allowedTypes as $type) {
-                            /** @var DataObject\Fieldcollection\Definition $fdDef */
-                            $fdDef = DataObject\Fieldcollection\Definition::getByKey($type);
-                            $childDefinitions = $fdDef->getFieldDefinitions();
-                            foreach ($childDefinitions as $childDef) {
-                                if ($childDef instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                                    return false;
-                                }
-                            }
-                        }
-                    }
-                }
-            }
-        }
-        return true;
-    }
-    /**
-     * @Route("/save-folder", name="pimcore_admin_dataobject_dataobject_savefolder", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function saveFolderAction(Request $request)
-    {
-        $object = DataObject::getById($request->get('id'));
-        if (!$object) {
-            throw $this->createNotFoundException('Object not found');
-        }
-        if ($object->isAllowed('publish')) {
-            try {
-                $general = $this->decodeJson($request->get('general'));
-                $object->setValues($general);
-                $object->setUserModification($this->getAdminUser()->getId());
-                $this->assignPropertiesFromEditmode($request, $object);
-                $object->save();
-                return $this->adminJson(['success' => true]);
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param Request $request
-     * @param DataObject\AbstractObject $object
-     */
-    protected function assignPropertiesFromEditmode(Request $request, $object)
-    {
-        if ($request->get('properties')) {
-            $properties = [];
-            foreach ($object->getProperties() as $p) {
-                if ($p->isInherited()) {
-                    $properties[$p->getName()] = $p;
-                }
-            }
-            $propertiesData = $this->decodeJson($request->get('properties'));
-            if (is_array($propertiesData)) {
-                foreach ($propertiesData as $propertyName => $propertyData) {
-                    $value = $propertyData['data'];
-                    try {
-                        $property = new Model\Property();
-                        $property->setType($propertyData['type']);
-                        $property->setName($propertyName);
-                        $property->setCtype('object');
-                        $property->setDataFromEditmode($value);
-                        $property->setInheritable($propertyData['inheritable']);
-                        $properties[$propertyName] = $property;
-                    } catch (\Exception $e) {
-                        Logger::err("Can't add " . $propertyName . ' to object ' . $object->getRealFullPath());
-                    }
-                }
-            }
-            $object->setProperties($properties);
-        }
-    }
-    /**
-     * @Route("/publish-version", name="pimcore_admin_dataobject_dataobject_publishversion", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function publishVersionAction(Request $request)
-    {
-        $version = Model\Version::getById($request->get('id'));
-        $object = $version->loadData();
-        $currentObject = DataObject::getById($object->getId());
-        if ($currentObject->isAllowed('publish')) {
-            $object->setPublished(true);
-            $object->setUserModification($this->getAdminUser()->getId());
-            try {
-                $object->save();
-                $this->addAdminStyle($object, ElementAdminStyleEvent::CONTEXT_TREE, $treeData);
-                return $this->adminJson(
-                    [
-                        'success' => true,
-                        'general' => ['o_modificationDate' => $object->getModificationDate() ],
-                        'treeData' => $treeData, ]
-                );
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/preview-version", name="pimcore_admin_dataobject_dataobject_previewversion", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @throws \Exception
-     *
-     * @return Response
-     */
-    public function previewVersionAction(Request $request)
-    {
-        DataObject::setDoNotRestoreKeyAndPath(true);
-        $id = (int)$request->get('id');
-        $version = Model\Version::getById($id);
-        $object = $version->loadData();
-        if (method_exists($object, 'getLocalizedFields')) {
-            /** @var DataObject\Localizedfield $localizedFields */
-            $localizedFields = $object->getLocalizedFields();
-            $localizedFields->setLoadedAllLazyData();
-        }
-        DataObject::setDoNotRestoreKeyAndPath(false);
-        if ($object) {
-            if ($object->isAllowed('versions')) {
-                return $this->render('@PimcoreAdmin/Admin/DataObject/DataObject/previewVersion.html.twig',
-                    [
-                        'object' => $object,
-                        'versionNote' => $version->getNote(),
-                        'validLanguages' => Tool::getValidLanguages(),
-                    ]);
-            }
-            throw $this->createAccessDeniedException('Permission denied, version id [' . $id . ']');
-        }
-        throw $this->createNotFoundException('Version with id [' . $id . "] doesn't exist");
-    }
-    /**
-     * @Route("/diff-versions/from/{from}/to/{to}", name="pimcore_admin_dataobject_dataobject_diffversions", methods={"GET"})
-     *
-     * @param Request $request
-     * @param int $from
-     * @param int $to
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function diffVersionsAction(Request $request, $from, $to)
-    {
-        DataObject::setDoNotRestoreKeyAndPath(true);
-        $id1 = (int)$from;
-        $id2 = (int)$to;
-        $version1 = Model\Version::getById($id1);
-        $object1 = $version1->loadData();
-        if (method_exists($object1, 'getLocalizedFields')) {
-            /** @var DataObject\Localizedfield $localizedFields1 */
-            $localizedFields1 = $object1->getLocalizedFields();
-            $localizedFields1->setLoadedAllLazyData();
-        }
-        $version2 = Model\Version::getById($id2);
-        $object2 = $version2->loadData();
-        if (method_exists($object2, 'getLocalizedFields')) {
-            /** @var DataObject\Localizedfield $localizedFields2 */
-            $localizedFields2 = $object2->getLocalizedFields();
-            $localizedFields2->setLoadedAllLazyData();
-        }
-        DataObject::setDoNotRestoreKeyAndPath(false);
-        if ($object1 && $object2) {
-            if ($object1->isAllowed('versions') && $object2->isAllowed('versions')) {
-                return $this->render('@PimcoreAdmin/Admin/DataObject/DataObject/diffVersions.html.twig',
-                    [
-                        'object1' => $object1,
-                        'versionNote1' => $version1->getNote(),
-                        'object2' => $object2,
-                        'versionNote2' => $version2->getNote(),
-                        'validLanguages' => Tool::getValidLanguages(),
-                    ]);
-            }
-            throw $this->createAccessDeniedException('Permission denied, version ids [' . $id1 . ', ' . $id2 . ']');
-        }
-        throw $this->createNotFoundException('Version with ids [' . $id1 . ', ' . $id2 . "] doesn't exist");
-    }
-    /**
-     * @Route("/grid-proxy", name="pimcore_admin_dataobject_dataobject_gridproxy", methods={"GET", "POST", "PUT"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     * @param GridHelperService $gridHelperService
-     * @param LocaleServiceInterface $localeService
-     * @param CsrfProtectionHandler $csrfProtection
-     *
-     * @return JsonResponse
-     */
-    public function gridProxyAction(
-        Request $request,
-        EventDispatcherInterface $eventDispatcher,
-        GridHelperService $gridHelperService,
-        LocaleServiceInterface $localeService,
-        CsrfProtectionHandler $csrfProtection
-    ) {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $csvMode = $allParams['csvMode'] ?? false;
-        if (isset($allParams['context']) && $allParams['context']) {
-            $allParams['context'] = json_decode($allParams['context'], true);
-        } else {
-            $allParams['context'] = [];
-        }
-        $filterPrepareEvent = new GenericEvent($this, [
-            'requestParams' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($filterPrepareEvent, AdminEvents::OBJECT_LIST_BEFORE_FILTER_PREPARE);
-        $allParams = $filterPrepareEvent->getArgument('requestParams');
-        $requestedLanguage = $allParams['language'] ?? null;
-        if ($requestedLanguage) {
-            if ($requestedLanguage != 'default') {
-                $request->setLocale($requestedLanguage);
-            }
-        } else {
-            $requestedLanguage = $request->getLocale();
-        }
-        if (isset($allParams['data']) && $allParams['data']) {
-            $csrfProtection->checkCsrfToken($request);
-            if ($allParams['xaction'] == 'update') {
-                try {
-                    $data = $this->decodeJson($allParams['data']);
-                    $object = DataObject::getById($data['id']);
-                    if (!$object instanceof DataObject\Concrete) {
-                        throw $this->createNotFoundException('Object not found');
-                    }
-                    $class = $object->getClass();
-                    if (!$object->isAllowed('publish')) {
-                        throw $this->createAccessDeniedException("Permission denied. You don't have the rights to save this object.");
-                    }
-                    $user = Tool\Admin::getCurrentUser();
-                    $allLanguagesAllowed = false;
-                    $languagePermissions = [];
-                    if (!$user->isAdmin()) {
-                        $languagePermissions = $object->getPermissions('lEdit', $user);
-                        $allLanguagesAllowed = $languagePermissions['lEdit'] == '';
-                        $languagePermissions = explode(',', $languagePermissions['lEdit']);
-                    }
-                    $objectData = [];
-                    foreach ($data as $key => $value) {
-                        $parts = explode('~', $key);
-                        if (substr($key, 0, 1) == '~') {
-                            $type = $parts[1];
-                            $field = $parts[2];
-                            $keyid = $parts[3];
-                            if ($type == 'classificationstore') {
-                                $groupKeyId = explode('-', $keyid);
-                                $groupId = $groupKeyId[0];
-                                $keyid = $groupKeyId[1];
-                                $getter = 'get' . ucfirst($field);
-                                if (method_exists($object, $getter)) {
-                                    /** @var Model\DataObject\ClassDefinition\Data\Classificationstore $csFieldDefinition */
-                                    $csFieldDefinition = $object->getClass()->getFieldDefinition($field);
-                                    $csLanguage = $requestedLanguage;
-                                    if (!$csFieldDefinition->isLocalized()) {
-                                        $csLanguage = 'default';
-                                    }
-                                    /** @var DataObject\Classificationstore $classificationStoreData */
-                                    $classificationStoreData = $object->$getter();
-                                    $keyConfig = DataObject\Classificationstore\KeyConfig::getById($keyid);
-                                    if ($keyConfig) {
-                                        $fieldDefinition = $keyDef = DataObject\Classificationstore\Service::getFieldDefinitionFromJson(
-                                            json_decode($keyConfig->getDefinition()),
-                                            $keyConfig->getType()
-                                        );
-                                        if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                                            $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                                        }
-                                    }
-                                    $activeGroups = $classificationStoreData->getActiveGroups() ? $classificationStoreData->getActiveGroups() : [];
-                                    $activeGroups[$groupId] = true;
-                                    $classificationStoreData->setActiveGroups($activeGroups);
-                                    $classificationStoreData->setLocalizedKeyValue($groupId, $keyid, $value, $csLanguage);
-                                }
-                            }
-                        } elseif (count($parts) > 1) {
-                            $brickType = $parts[0];
-                            $brickDescriptor = null;
-                            if (strpos($brickType, '?') !== false) {
-                                $brickDescriptor = substr($brickType, 1);
-                                $brickDescriptor = json_decode($brickDescriptor, true);
-                                $brickType = $brickDescriptor['containerKey'];
-                            }
-                            $brickKey = $parts[1];
-                            $brickField = DataObject\Service::getFieldForBrickType($object->getClass(), $brickType);
-                            $fieldGetter = 'get' . ucfirst($brickField);
-                            $brickGetter = 'get' . ucfirst($brickType);
-                            $valueSetter = 'set' . ucfirst($brickKey);
-                            $brick = $object->$fieldGetter()->$brickGetter();
-                            if (empty($brick)) {
-                                $classname = '\\Pimcore\\Model\\DataObject\\Objectbrick\\Data\\' . ucfirst($brickType);
-                                $brickSetter = 'set' . ucfirst($brickType);
-                                $brick = new $classname($object);
-                                $object->$fieldGetter()->$brickSetter($brick);
-                            }
-                            if ($brickDescriptor) {
-                                $brickDefinition = Model\DataObject\Objectbrick\Definition::getByKey($brickType);
-                                /** @var DataObject\ClassDefinition\Data\Localizedfields $fieldDefinitionLocalizedFields */
-                                $fieldDefinitionLocalizedFields = $brickDefinition->getFieldDefinition('localizedfields');
-                                $fieldDefinition = $fieldDefinitionLocalizedFields->getFieldDefinition($brickKey);
-                            } else {
-                                $fieldDefinition = $this->getFieldDefinitionFromBrick($brickType, $brickKey);
-                            }
-                            if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                                $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                            }
-                            if ($brickDescriptor) {
-                                /** @var DataObject\Localizedfield $localizedFields */
-                                $localizedFields = $brick->getLocalizedfields();
-                                $localizedFields->setLocalizedValue($brickKey, $value);
-                            } else {
-                                $brick->$valueSetter($value);
-                            }
-                        } else {
-                            if (!$user->isAdmin() && $languagePermissions) {
-                                $fd = $class->getFieldDefinition($key);
-                                if (!$fd) {
-                                    $localized = $class->getFieldDefinition('localizedfields');
-                                    if ($localized instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                                        $field = $localized->getFieldDefinition($key);
-                                        if ($field) {
-                                            $currentLocale = $localeService->findLocale();
-                                            if (!$allLanguagesAllowed && !in_array($currentLocale, $languagePermissions)) {
-                                                continue;
-                                            }
-                                        }
-                                    }
-                                }
-                            }
-                            $fieldDefinition = $this->getFieldDefinition($class, $key);
-                            if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                                $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                            }
-                            $objectData[$key] = $value;
-                        }
-                    }
-                    $object->setValues($objectData);
-                    if ($object->getPublished() == false) {
-                        $object->setOmitMandatoryCheck(true);
-                    }
-                    $object->save();
-                    return $this->adminJson(['data' => DataObject\Service::gridObjectData($object, $allParams['fields'], $requestedLanguage), 'success' => true]);
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            }
-        } else {
-            $list = $gridHelperService->prepareListingForGrid($allParams, $requestedLanguage, $this->getAdminUser());
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $list,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::OBJECT_LIST_BEFORE_LIST_LOAD);
-            /** @var DataObject\Listing\Concrete $list */
-            $list = $beforeListLoadEvent->getArgument('list');
-            $list->load();
-            $objects = [];
-            foreach ($list->getObjects() as $object) {
-                if ($csvMode) {
-                    $o = DataObject\Service::getCsvDataForObject($object, $requestedLanguage, $request->get('fields'), DataObject\Service::getHelperDefinitions(), $localeService, false, $allParams['context']);
-                } else {
-                    $o = DataObject\Service::gridObjectData($object, $allParams['fields'] ?? null, $requestedLanguage,
-                        ['csvMode' => $csvMode]);
-                }
-                if ($object->isAllowed('list')) {
-                    $objects[] = $o;
-                }
-            }
-            $result = ['data' => $objects, 'success' => true, 'total' => $list->getTotalCount()];
-            $afterListLoadEvent = new GenericEvent($this, [
-                'list' => $result,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::OBJECT_LIST_AFTER_LIST_LOAD);
-            $result = $afterListLoadEvent->getArgument('list');
-            return $this->adminJson($result);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param DataObject\ClassDefinition $class
-     * @param string $key
-     *
-     * @return DataObject\ClassDefinition\Data|null
-     */
-    protected function getFieldDefinition($class, $key)
-    {
-        $fieldDefinition = $class->getFieldDefinition($key);
-        if ($fieldDefinition) {
-            return $fieldDefinition;
-        }
-        $localized = $class->getFieldDefinition('localizedfields');
-        if ($localized instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-            $fieldDefinition = $localized->getFieldDefinition($key);
-        }
-        return $fieldDefinition;
-    }
-    /**
-     * @param string $brickType
-     * @param string $key
-     *
-     * @return DataObject\ClassDefinition\Data|null
-     */
-    protected function getFieldDefinitionFromBrick($brickType, $key)
-    {
-        $brickDefinition = DataObject\Objectbrick\Definition::getByKey($brickType);
-        $fieldDefinition = null;
-        if ($brickDefinition) {
-            $fieldDefinition = $brickDefinition->getFieldDefinition($key);
-        }
-        return $fieldDefinition;
-    }
-    /**
-     * @Route("/copy-info", name="pimcore_admin_dataobject_dataobject_copyinfo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyInfoAction(Request $request)
-    {
-        $transactionId = time();
-        $pasteJobs = [];
-        Tool\Session::useSession(function (AttributeBagInterface $session) use ($transactionId) {
-            $session->set($transactionId, ['idMapping' => []]);
-        }, 'pimcore_copy');
-        if ($request->get('type') == 'recursive' || $request->get('type') == 'recursive-update-references') {
-            $object = DataObject::getById($request->get('sourceId'));
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_dataobject_dataobject_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => 'child',
-                    'transactionId' => $transactionId,
-                    'saveParentId' => true,
-                ],
-            ]];
-            if ($object->hasChildren(DataObject::$types)) {
-                $list = new DataObject\Listing();
-                $list->setCondition('o_path LIKE ' . $list->quote($list->escapeLike($object->getRealFullPath()) . '/%'));
-                $list->setOrderKey('LENGTH(o_path)', false);
-                $list->setOrder('ASC');
-                $list->setObjectTypes(DataObject::$types);
-                $childIds = $list->loadIdList();
-                if (count($childIds) > 0) {
-                    foreach ($childIds as $id) {
-                        $pasteJobs[] = [[
-                            'url' => $this->generateUrl('pimcore_admin_dataobject_dataobject_copy'),
-                            'method' => 'POST',
-                            'params' => [
-                                'sourceId' => $id,
-                                'targetParentId' => $request->get('targetId'),
-                                'sourceParentId' => $request->get('sourceId'),
-                                'type' => 'child',
-                                'transactionId' => $transactionId,
-                            ],
-                        ]];
-                    }
-                }
-                if ($request->get('type') == 'recursive-update-references') {
-                    for ($i = 0; $i < (count($childIds) + 1); $i++) {
-                        $pasteJobs[] = [[
-                            'url' => $this->generateUrl('pimcore_admin_dataobject_dataobject_copyrewriteids'),
-                            'method' => 'PUT',
-                            'params' => [
-                                'transactionId' => $transactionId,
-                                '_dc' => uniqid(),
-                            ],
-                        ]];
-                    }
-                }
-            }
-        } elseif ($request->get('type') == 'child' || $request->get('type') == 'replace') {
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_dataobject_dataobject_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => $request->get('type'),
-                    'transactionId' => $transactionId,
-                ],
-            ]];
-        }
-        return $this->adminJson([
-            'pastejobs' => $pasteJobs,
-        ]);
-    }
-    /**
-     * @Route("/copy-rewrite-ids", name="pimcore_admin_dataobject_dataobject_copyrewriteids", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function copyRewriteIdsAction(Request $request)
-    {
-        $transactionId = $request->get('transactionId');
-        $idStore = Tool\Session::useSession(function (AttributeBagInterface $session) use ($transactionId) {
-            return $session->get($transactionId);
-        }, 'pimcore_copy');
-        if (!array_key_exists('rewrite-stack', $idStore)) {
-            $idStore['rewrite-stack'] = array_values($idStore['idMapping']);
-        }
-        $id = array_shift($idStore['rewrite-stack']);
-        $object = DataObject::getById($id);
-        $rewriteConfig = ['object' => $idStore['idMapping']];
-        $object = DataObject\Service::rewriteIds($object, $rewriteConfig);
-        $object->setUserModification($this->getAdminUser()->getId());
-        $object->save();
-        Tool\Session::useSession(function (AttributeBagInterface $session) use ($transactionId, $idStore) {
-            $session->set($transactionId, $idStore);
-        }, 'pimcore_copy');
-        return $this->adminJson([
-            'success' => true,
-            'id' => $id,
-        ]);
-    }
-    /**
-     * @Route("/copy", name="pimcore_admin_dataobject_dataobject_copy", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyAction(Request $request)
-    {
-        $message = '';
-        $sourceId = (int)$request->get('sourceId');
-        $source = DataObject::getById($sourceId);
-        $session = Tool\Session::get('pimcore_copy');
-        $sessionBag = $session->get($request->get('transactionId'));
-        $targetId = (int)$request->get('targetId');
-        if ($request->get('targetParentId')) {
-            $sourceParent = DataObject::getById($request->get('sourceParentId'));
-            if ($sessionBag['parentId']) {
-                $targetParent = DataObject::getById($sessionBag['parentId']);
-            } else {
-                $targetParent = DataObject::getById($request->get('targetParentId'));
-            }
-            $targetPath = preg_replace('@^' . preg_quote($sourceParent->getRealFullPath(), '@') . '@', $targetParent . '/', $source->getRealPath());
-            $target = DataObject::getByPath($targetPath);
-        } else {
-            $target = DataObject::getById($targetId);
-        }
-        if ($target->isAllowed('create')) {
-            $source = DataObject::getById($sourceId);
-            if ($source != null) {
-                if ($source instanceof DataObject\Concrete && $latestVersion = $source->getLatestVersion()) {
-                    $source = $latestVersion->loadData();
-                    $source->setPublished(false); //as latest version is used which is not published
-                }
-                if ($request->get('type') == 'child') {
-                    $newObject = $this->_objectService->copyAsChild($target, $source);
-                    $sessionBag['idMapping'][(int)$source->getId()] = (int)$newObject->getId();
-                    if ($request->get('saveParentId')) {
-                        $sessionBag['parentId'] = $newObject->getId();
-                    }
-                } elseif ($request->get('type') == 'replace') {
-                    $this->_objectService->copyContents($target, $source);
-                }
-                $session->set($request->get('transactionId'), $sessionBag);
-                Tool\Session::writeClose();
-                return $this->adminJson(['success' => true, 'message' => $message]);
-            } else {
-                Logger::error("could not execute copy/paste, source object with id [ $sourceId ] not found");
-                return $this->adminJson(['success' => false, 'message' => 'source object not found']);
-            }
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @Route("/preview", name="pimcore_admin_dataobject_dataobject_preview", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response|RedirectResponse
-     */
-    public function previewAction(Request $request)
-    {
-        $id = $request->get('id');
-        $object = DataObject\Service::getElementFromSession('object', $id);
-        if ($object instanceof DataObject\Concrete) {
-            $url = $object->getClass()->getPreviewUrl();
-            if ($url) {
-                $vars = $object->getObjectVars();
-                foreach ($vars as $key => $value) {
-                    if (!empty($value) && \is_scalar($value)) {
-                        $url = str_replace('%' . $key, urlencode($value), $url);
-                    } else {
-                        if (strpos($url, '%' . $key) !== false) {
-                            return new Response('No preview available, please ensure that all fields which are required for the preview are filled correctly.');
-                        }
-                    }
-                }
-                $url = str_replace('%_locale', $this->getAdminUser()->getLanguage(), $url);
-            } elseif ($previewService = $object->getClass()->getPreviewGenerator()) {
-                $url = $previewService->generatePreviewUrl($object, array_merge(['preview' => true, 'context' => $this], $request->query->all()));
-            } elseif ($linkGenerator = $object->getClass()->getLinkGenerator()) {
-                $url = $linkGenerator->generate($object, ['preview' => true, 'context' => $this]);
-            }
-            if (!$url) {
-                return new Response("Preview not available, it seems that there's a problem with this object.");
-            }
-            $url = str_replace('%', '%25', $url);
-            $urlParts = parse_url($url);
-            return $this->redirect($urlParts['path'] . '?pimcore_object_preview=' . $id . '&_dc=' . time() . (isset($urlParts['query']) ? '&' . $urlParts['query'] : ''));
-        } else {
-            return new Response("Preview not available, it seems that there's a problem with this object.");
-        }
-    }
-    /**
-     * @param  DataObject\Concrete $object
-     * @param  array $toDelete
-     * @param  array $toAdd
-     * @param  string $ownerFieldName
-     */
-    protected function processRemoteOwnerRelations($object, $toDelete, $toAdd, $ownerFieldName)
-    {
-        $getter = 'get' . ucfirst($ownerFieldName);
-        $setter = 'set' . ucfirst($ownerFieldName);
-        foreach ($toDelete as $id) {
-            $owner = DataObject::getById($id);
-            if (method_exists($owner, $getter)) {
-                $currentData = $owner->$getter();
-                if (is_array($currentData)) {
-                    for ($i = 0; $i < count($currentData); $i++) {
-                        if ($currentData[$i]->getId() == $object->getId()) {
-                            unset($currentData[$i]);
-                            $owner->$setter($currentData);
-                            break;
-                        }
-                    }
-                } else {
-                    if ($currentData->getId() == $object->getId()) {
-                        $owner->$setter(null);
-                    }
-                }
-            }
-            $owner->setUserModification($this->getAdminUser()->getId());
-            $owner->save();
-            Logger::debug('Saved object id [ ' . $owner->getId() . ' ] by remote modification through [' . $object->getId() . '], Action: deleted [ ' . $object->getId() . " ] from [ $ownerFieldName]");
-        }
-        foreach ($toAdd as $id) {
-            $owner = DataObject::getById($id);
-            if (method_exists($owner, $getter)) {
-                $currentData = $owner->$getter();
-                if (is_array($currentData)) {
-                    $currentData[] = $object;
-                } else {
-                    $currentData = $object;
-                }
-                $owner->$setter($currentData);
-                $owner->setUserModification($this->getAdminUser()->getId());
-                $owner->save();
-                Logger::debug('Saved object id [ ' . $owner->getId() . ' ] by remote modification through [' . $object->getId() . '], Action: added [ ' . $object->getId() . " ] to [ $ownerFieldName ]");
-            }
-        }
-    }
-    /**
-     * @param  array $relations
-     * @param  array $value
-     *
-     * @return array
-     */
-    protected function detectDeletedRemoteOwnerRelations($relations, $value)
-    {
-        $originals = [];
-        $changed = [];
-        foreach ($relations as $r) {
-            $originals[] = $r['dest_id'];
-        }
-        if (is_array($value)) {
-            foreach ($value as $row) {
-                $changed[] = $row['id'];
-            }
-        }
-        $diff = array_diff($originals, $changed);
-        return $diff;
-    }
-    /**
-     * @param  array $relations
-     * @param  array $value
-     *
-     * @return array
-     */
-    protected function detectAddedRemoteOwnerRelations($relations, $value)
-    {
-        $originals = [];
-        $changed = [];
-        foreach ($relations as $r) {
-            $originals[] = $r['dest_id'];
-        }
-        if (is_array($value)) {
-            foreach ($value as $row) {
-                $changed[] = $row['id'];
-            }
-        }
-        $diff = array_diff($changed, $originals);
-        return $diff;
-    }
-    /**
-     * @param DataObject\Concrete $object
-     * @param null|Version $draftVersion
-     *
-     * @return DataObject\Concrete|null
-     */
-    protected function getLatestVersion(DataObject\Concrete $object, &$draftVersion = null)
-    {
-        $latestVersion = $object->getLatestVersion($this->getUser()->getId());
-        if ($latestVersion) {
-            $latestObj = $latestVersion->loadData();
-            if ($latestObj instanceof DataObject\Concrete) {
-                $draftVersion = $latestVersion;
-                return $latestObj;
-            }
-        }
-        return $object;
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkPermission('objects');
-        $this->_objectService = new DataObject\Service($this->getAdminUser());
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/DataObjectHelperController.php
+++ b//dev/null
@@ -1,1458 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use PhpOffice\PhpSpreadsheet\Reader\Csv;
-use PhpOffice\PhpSpreadsheet\Writer\Xlsx;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Config;
-use Pimcore\Db;
-use Pimcore\Event\AdminEvents;
-use Pimcore\File;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Logger;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\GridConfig;
-use Pimcore\Model\GridConfigFavourite;
-use Pimcore\Model\GridConfigShare;
-use Pimcore\Model\User;
-use Pimcore\Tool;
-use Pimcore\Version;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/object-helper")
- *
- * @internal
- */
-class DataObjectHelperController extends AdminController
-{
-    const SYSTEM_COLUMNS = ['id', 'fullpath', 'key', 'published', 'creationDate', 'modificationDate', 'filename', 'classname'];
-    /**
-     * @Route("/load-object-data", name="pimcore_admin_dataobject_dataobjecthelper_loadobjectdata", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function loadObjectDataAction(Request $request)
-    {
-        $object = DataObject::getById($request->get('id'));
-        $result = [];
-        if ($object) {
-            $result['success'] = true;
-            $fields = $request->get('fields');
-            $result['fields'] = DataObject\Service::gridObjectData($object, $fields);
-        } else {
-            $result['success'] = false;
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @param int $userId
-     * @param string $classId
-     * @param string $searchType
-     *
-     * @return array
-     */
-    public function getMyOwnGridColumnConfigs($userId, $classId, $searchType)
-    {
-        $db = Db::get();
-        $configListingConditionParts = [];
-        $configListingConditionParts[] = 'ownerId = ' . $userId;
-        $configListingConditionParts[] = 'classId = ' . $db->quote($classId);
-        if ($searchType) {
-            $configListingConditionParts[] = 'searchType = ' . $db->quote($searchType);
-        }
-        $configCondition = implode(' AND ', $configListingConditionParts);
-        $configListing = new GridConfig\Listing();
-        $configListing->setOrderKey('name');
-        $configListing->setOrder('ASC');
-        $configListing->setCondition($configCondition);
-        $configListing = $configListing->load();
-        $configData = [];
-        if (is_array($configListing)) {
-            foreach ($configListing as $config) {
-                $configData[] = $config->getObjectVars();
-            }
-        }
-        return $configData;
-    }
-    /**
-     * @param User $user
-     * @param string $classId
-     * @param string $searchType
-     *
-     * @return array
-     */
-    public function getSharedGridColumnConfigs($user, $classId, $searchType = null)
-    {
-        $configListing = [];
-        $userIds = [$user->getId()];
-        $userIds = array_merge($userIds, $user->getRoles());
-        $userIds = implode(',', $userIds);
-        $db = Db::get();
-        $query = 'select distinct c1.id from gridconfigs c1, gridconfig_shares s
-                    where (c1.searchType = ' . $db->quote($searchType) . ' and ((c1.id = s.gridConfigId and s.sharedWithUserId IN (' . $userIds . '))) and c1.classId = ' . $db->quote($classId) . ')
-                            UNION distinct select c2.id from gridconfigs c2 where shareGlobally = 1 and c2.classId = '. $db->quote($classId) . '  and c2.ownerId != ' . $db->quote($user->getId());
-        $ids = $db->fetchCol($query);
-        if ($ids) {
-            $ids = implode(',', $ids);
-            $configListing = new GridConfig\Listing();
-            $configListing->setOrderKey('name');
-            $configListing->setOrder('ASC');
-            $configListing->setCondition('id in (' . $ids . ')');
-            $configListing = $configListing->load();
-        }
-        $configData = [];
-        if (is_array($configListing)) {
-            foreach ($configListing as $config) {
-                $configData[] = $config->getObjectVars();
-            }
-        }
-        return $configData;
-    }
-    /**
-     * @Route("/get-export-configs", name="pimcore_admin_dataobject_dataobjecthelper_getexportconfigs", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getExportConfigsAction(Request $request)
-    {
-        $classId = $request->get('classId');
-        $list = $this->getMyOwnGridColumnConfigs($this->getAdminUser()->getId(), $classId, null);
-        if (!is_array($list)) {
-            $list = [];
-        }
-        $list = array_merge($list, $this->getSharedGridColumnConfigs($this->getAdminUser(), $classId, null));
-        $result = [];
-        $result[] = [
-            'id' => -1,
-            'name' => '--default--',
-        ];
-        if ($list) {
-            /** @var GridConfig $config */
-            foreach ($list as $config) {
-                $result[] = [
-                    'id' => $config['id'],
-                    'name' => $config['name'],
-                ];
-            }
-        }
-        return $this->adminJson(['success' => true, 'data' => $result]);
-    }
-    /**
-     * @Route("/grid-delete-column-config", name="pimcore_admin_dataobject_dataobjecthelper_griddeletecolumnconfig", methods={"DELETE"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function gridDeleteColumnConfigAction(Request $request, Config $config)
-    {
-        $gridConfigId = $request->get('gridConfigId');
-        $gridConfig = null;
-        try {
-            $gridConfig = GridConfig::getById($gridConfigId);
-        } catch (\Exception $e) {
-        }
-        $success = false;
-        if ($gridConfig) {
-            if ($gridConfig->getOwnerId() != $this->getAdminUser()->getId() && !$this->getAdminUser()->isAdmin()) {
-                throw new \Exception("don't mess with someone elses grid config");
-            }
-            $gridConfig->delete();
-            $success = true;
-        }
-        $newGridConfig = $this->doGetGridColumnConfig($request, $config, true);
-        $newGridConfig['deleteSuccess'] = $success;
-        return $this->adminJson($newGridConfig);
-    }
-    /**
-     * @Route("/grid-get-column-config", name="pimcore_admin_dataobject_dataobjecthelper_gridgetcolumnconfig", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function gridGetColumnConfigAction(Request $request, Config $config)
-    {
-        $result = $this->doGetGridColumnConfig($request, $config);
-        return $this->adminJson($result);
-    }
-    /**
-     * @param Request $request
-     * @param Config $config
-     * @param bool $isDelete
-     *
-     * @return array
-     */
-    public function doGetGridColumnConfig(Request $request, Config $config, $isDelete = false)
-    {
-        $class = null;
-        $fields = null;
-        if ($request->get('id')) {
-            $class = DataObject\ClassDefinition::getById($request->get('id'));
-        } elseif ($request->get('name')) {
-            $class = DataObject\ClassDefinition::getByName($request->get('name'));
-        }
-        $gridConfigId = null;
-        $gridType = 'search';
-        if ($request->get('gridtype')) {
-            $gridType = $request->get('gridtype');
-        }
-        $objectId = $request->get('objectId');
-        if ($objectId) {
-            $fields = DataObject\Service::getCustomGridFieldDefinitions($class->getId(), $objectId);
-        }
-        $context = ['purpose' => 'gridconfig'];
-        if ($class) {
-            $context['class'] = $class;
-        }
-        if ($objectId) {
-            $object = DataObject::getById($objectId);
-            $context['object'] = $object;
-        }
-        if (!$fields && $class) {
-            $fields = $class->getFieldDefinitions();
-        }
-        $types = [];
-        if ($request->get('types')) {
-            $types = explode(',', $request->get('types'));
-        }
-        $userId = $this->getAdminUser()->getId();
-        $requestedGridConfigId = $isDelete ? null : $request->get('gridConfigId');
-        $gridConfig = [];
-        $searchType = $request->get('searchType');
-        if (strlen($requestedGridConfigId) == 0 && $class) {
-            $favourite = null;
-            try {
-                try {
-                    $favourite = GridConfigFavourite::getByOwnerAndClassAndObjectId($userId, $class->getId(), $objectId ? $objectId : 0, $searchType);
-                } catch (\Exception $e) {
-                }
-                if (!$favourite && $objectId) {
-                    $favourite = GridConfigFavourite::getByOwnerAndClassAndObjectId($userId, $class->getId(), 0, $searchType);
-                }
-                if ($favourite) {
-                    $requestedGridConfigId = $favourite->getGridConfigId();
-                }
-            } catch (\Exception $e) {
-            }
-        }
-        if (is_numeric($requestedGridConfigId) && $requestedGridConfigId > 0) {
-            $db = Db::get();
-            $configListingConditionParts = [];
-            $configListingConditionParts[] = 'ownerId = ' . $userId;
-            $configListingConditionParts[] = 'classId = ' . $db->quote($class->getId());
-            if ($searchType) {
-                $configListingConditionParts[] = 'searchType = ' . $db->quote($searchType);
-            }
-            $savedGridConfig = null;
-            try {
-                $savedGridConfig = GridConfig::getById($requestedGridConfigId);
-            } catch (\Exception $e) {
-            }
-            if ($savedGridConfig) {
-                $shared = false;
-                if (!$this->getAdminUser()->isAdmin()) {
-                    try {
-                        $userIds = [$this->getAdminUser()->getId()];
-                        if ($this->getAdminUser()->getRoles()) {
-                            $userIds = array_merge($userIds, $this->getAdminUser()->getRoles());
-                        }
-                        $userIds = implode(',', $userIds);
-                        $shared = ($savedGridConfig->getOwnerId() != $userId && $savedGridConfig->isShareGlobally()) || $db->fetchOne('select 1 from gridconfig_shares where sharedWithUserId IN ('.$userIds.') and gridConfigId = '.$savedGridConfig->getId());
-                    } catch (\Exception $e) {
-                    }
-                    if (!$shared && $savedGridConfig->getOwnerId() != $this->getAdminUser()->getId()) {
-                        throw new \Exception('you are neither the onwner of this config nor it is shared with you');
-                    }
-                }
-                $gridConfigId = $savedGridConfig->getId();
-                $gridConfig = $savedGridConfig->getConfig();
-                $gridConfig = json_decode($gridConfig, true);
-                $gridConfigName = $savedGridConfig->getName();
-                $owner = $savedGridConfig->getOwnerId();
-                $ownerObject = User::getById($owner);
-                if ($ownerObject instanceof User) {
-                    $owner = $ownerObject->getName();
-                }
-                $modificationDate = $savedGridConfig->getModificationDate();
-                $gridConfigDescription = $savedGridConfig->getDescription();
-                $sharedGlobally = $savedGridConfig->isShareGlobally();
-            }
-        }
-        $localizedFields = [];
-        $objectbrickFields = [];
-        if (is_array($fields)) {
-            foreach ($fields as $key => $field) {
-                if ($field instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                    $localizedFields[] = $field;
-                } elseif ($field instanceof DataObject\ClassDefinition\Data\Objectbricks) {
-                    $objectbrickFields[] = $field;
-                }
-            }
-        }
-        $availableFields = [];
-        if (empty($gridConfig)) {
-            $availableFields = $this->getDefaultGridFields(
-                $request->get('no_system_columns'),
-                $class,
-                $gridType,
-                $request->get('no_brick_columns'),
-                $fields,
-                $context,
-                $objectId,
-                $types);
-        } else {
-            $savedColumns = $gridConfig['columns'];
-            foreach ($savedColumns as $key => $sc) {
-                if (!$sc['hidden']) {
-                    if (in_array($key, self::SYSTEM_COLUMNS)) {
-                        $colConfig = [
-                            'key' => $key,
-                            'type' => 'system',
-                            'label' => $key,
-                            'locked' => $sc['locked'] ?? null,
-                            'position' => $sc['position'],
-                        ];
-                        if (isset($sc['width'])) {
-                            $colConfig['width'] = $sc['width'];
-                        }
-                        $availableFields[] = $colConfig;
-                    } else {
-                        $keyParts = explode('~', $key);
-                        if (substr($key, 0, 1) == '~') {
-                            $type = $keyParts[1];
-                            $groupAndKeyId = explode('-', $keyParts[3]);
-                            $keyId = $groupAndKeyId[1];
-                            if ($type == 'classificationstore') {
-                                $keyDef = DataObject\Classificationstore\KeyConfig::getById($keyId);
-                                if ($keyDef) {
-                                    $keyFieldDef = json_decode($keyDef->getDefinition(), true);
-                                    if ($keyFieldDef) {
-                                        $keyFieldDef = \Pimcore\Model\DataObject\Classificationstore\Service::getFieldDefinitionFromJson($keyFieldDef, $keyDef->getType());
-                                        $fieldConfig = $this->getFieldGridConfig($keyFieldDef, $gridType, $sc['position'], true, null, $class, $objectId);
-                                        if ($fieldConfig) {
-                                            $fieldConfig['key'] = $key;
-                                            $fieldConfig['label'] = '#' . $keyFieldDef->getTitle();
-                                            if (isset($sc['locked'])) {
-                                                $fieldConfig['locked'] = $sc['locked'];
-                                            }
-                                            $availableFields[] = $fieldConfig;
-                                        }
-                                    }
-                                }
-                            }
-                        } elseif (count($keyParts) > 1) {
-                            $brick = $keyParts[0];
-                            $brickDescriptor = null;
-                            if (strpos($brick, '?') !== false) {
-                                $brickDescriptor = substr($brick, 1);
-                                $brickDescriptor = json_decode($brickDescriptor, true);
-                                $keyPrefix = $brick . '~';
-                                $brick = $brickDescriptor['containerKey'];
-                            } else {
-                                $keyPrefix = $brick . '~';
-                            }
-                            $fieldname = $keyParts[1];
-                            $brickClass = DataObject\Objectbrick\Definition::getByKey($brick);
-                            $fd = null;
-                            if ($brickClass instanceof DataObject\Objectbrick\Definition) {
-                                if ($brickDescriptor) {
-                                    $innerContainer = $brickDescriptor['innerContainer'] ?? 'localizedfields';
-                                    /** @var DataObject\ClassDefinition\Data\Localizedfields $localizedFields */
-                                    $localizedFields = $brickClass->getFieldDefinition($innerContainer);
-                                    $fd = $localizedFields->getFieldDefinition($brickDescriptor['brickfield']);
-                                } else {
-                                    $fd = $brickClass->getFieldDefinition($fieldname);
-                                }
-                            }
-                            if ($fd !== null) {
-                                $fieldConfig = $this->getFieldGridConfig($fd, $gridType, $sc['position'], true, $keyPrefix, $class, $objectId);
-                                if (!empty($fieldConfig)) {
-                                    if (isset($sc['width'])) {
-                                        $fieldConfig['width'] = $sc['width'];
-                                    }
-                                    if (isset($sc['locked'])) {
-                                        $fieldConfig['locked'] = $sc['locked'];
-                                    }
-                                    $availableFields[] = $fieldConfig;
-                                }
-                            }
-                        } else {
-                            if (DataObject\Service::isHelperGridColumnConfig($key)) {
-                                $calculatedColumnConfig = $this->getCalculatedColumnConfig($savedColumns[$key]);
-                                if ($calculatedColumnConfig) {
-                                    $availableFields[] = $calculatedColumnConfig;
-                                }
-                            } else {
-                                $fd = $class->getFieldDefinition($key);
-                                if (empty($fd)) {
-                                    foreach ($localizedFields as $lf) {
-                                        $fd = $lf->getFieldDefinition($key);
-                                        if (!empty($fd)) {
-                                            break;
-                                        }
-                                    }
-                                }
-                                if (!empty($fd)) {
-                                    $fieldConfig = $this->getFieldGridConfig($fd, $gridType, $sc['position'], true, null, $class, $objectId);
-                                    if (!empty($fieldConfig)) {
-                                        if (isset($sc['width'])) {
-                                            $fieldConfig['width'] = $sc['width'];
-                                        }
-                                        if (isset($sc['locked'])) {
-                                            $fieldConfig['locked'] = $sc['locked'];
-                                        }
-                                        $availableFields[] = $fieldConfig;
-                                    }
-                                }
-                            }
-                        }
-                    }
-                }
-            }
-        }
-        usort($availableFields, function ($a, $b) {
-            if ($a['position'] == $b['position']) {
-                return 0;
-            }
-            return ($a['position'] < $b['position']) ? -1 : 1;
-        });
-        $frontendLanguages = Tool\Admin::reorderWebsiteLanguages(\Pimcore\Tool\Admin::getCurrentUser(), $config['general']['valid_languages']);
-        if ($frontendLanguages) {
-            $language = explode(',', $frontendLanguages)[0];
-        } else {
-            $language = $request->getLocale();
-        }
-        if (!Tool::isValidLanguage($language)) {
-            $validLanguages = Tool::getValidLanguages();
-            $language = $validLanguages[0];
-        }
-        if (!empty($gridConfig) && !empty($gridConfig['language'])) {
-            $language = $gridConfig['language'];
-        }
-        if (!empty($gridConfig) && !empty($gridConfig['pageSize'])) {
-            $pageSize = $gridConfig['pageSize'];
-        }
-        $availableConfigs = $class ? $this->getMyOwnGridColumnConfigs($userId, $class->getId(), $searchType) : [];
-        $sharedConfigs = $class ? $this->getSharedGridColumnConfigs($this->getAdminUser(), $class->getId(), $searchType) : [];
-        $settings = $this->getShareSettings((int)$gridConfigId);
-        $settings['gridConfigId'] = (int)$gridConfigId;
-        $settings['gridConfigName'] = $gridConfigName ?? null;
-        $settings['gridConfigDescription'] = $gridConfigDescription ?? null;
-        $settings['owner'] = $owner ?? null;
-        $settings['modificationDate'] = $modificationDate ?? null;
-        $settings['shareGlobally'] = $sharedGlobally ?? null;
-        $settings['isShared'] = !$gridConfigId || ($shared ?? null);
-        $context = $gridConfig['context'] ?? null;
-        if ($context) {
-            $context = json_decode($context, true);
-        }
-        return [
-            'sortinfo' => $gridConfig['sortinfo'] ?? false,
-            'language' => $language,
-            'availableFields' => $availableFields,
-            'settings' => $settings,
-            'onlyDirectChildren' => $gridConfig['onlyDirectChildren'] ?? false,
-            'pageSize' => $gridConfig['pageSize'] ?? false,
-            'availableConfigs' => $availableConfigs,
-            'sharedConfigs' => $sharedConfigs,
-            'context' => $context,
-            'sqlFilter' => $gridConfig['sqlFilter'] ?? '',
-            'searchFilter' => $gridConfig['searchFilter'] ?? '',
-        ];
-    }
-    /**
-     * @param bool $noSystemColumns
-     * @param DataObject\ClassDefinition|null $class
-     * @param string $gridType
-     * @param bool $noBrickColumns
-     * @param DataObject\ClassDefinition\Data[] $fields
-     * @param array $context
-     * @param int $objectId
-     * @param array $types
-     *
-     * @return array
-     */
-    public function getDefaultGridFields($noSystemColumns, $class, $gridType, $noBrickColumns, $fields, $context, $objectId, $types = [])
-    {
-        $count = 0;
-        $availableFields = [];
-        if (!$noSystemColumns && $class) {
-            $vis = $class->getPropertyVisibility();
-            foreach (self::SYSTEM_COLUMNS as $sc) {
-                $key = $sc;
-                if ($key === 'fullpath') {
-                    $key = 'path';
-                }
-                if (empty($types) && (!empty($vis[$gridType][$key]) || $gridType === 'all')) {
-                    $availableFields[] = [
-                        'key' => $sc,
-                        'type' => 'system',
-                        'label' => $sc,
-                        'position' => $count, ];
-                    $count++;
-                }
-            }
-        }
-        $includeBricks = !$noBrickColumns;
-        if (is_array($fields)) {
-            foreach ($fields as $key => $field) {
-                if ($field instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                    foreach ($field->getFieldDefinitions($context) as $fd) {
-                        if (empty($types) || in_array($fd->getFieldType(), $types)) {
-                            $fieldConfig = $this->getFieldGridConfig($fd, $gridType, $count, false, null, $class, $objectId);
-                            if (!empty($fieldConfig)) {
-                                $availableFields[] = $fieldConfig;
-                                $count++;
-                            }
-                        }
-                    }
-                } elseif ($field instanceof DataObject\ClassDefinition\Data\Objectbricks && $includeBricks) {
-                    if (in_array($field->getFieldType(), $types)) {
-                        $fieldConfig = $this->getFieldGridConfig($field, $gridType, $count, false, null, $class, $objectId);
-                        if (!empty($fieldConfig)) {
-                            $availableFields[] = $fieldConfig;
-                            $count++;
-                        }
-                    } else {
-                        $allowedTypes = $field->getAllowedTypes();
-                        if (!empty($allowedTypes)) {
-                            foreach ($allowedTypes as $t) {
-                                $brickClass = DataObject\Objectbrick\Definition::getByKey($t);
-                                $brickFields = $brickClass->getFieldDefinitions($context);
-                                $this->appendBrickFields($field, $brickFields, $availableFields, $gridType, $count, $t, $class, $objectId);
-                            }
-                        }
-                    }
-                } else {
-                    if (empty($types) || in_array($field->getFieldType(), $types)) {
-                        $fieldConfig = $this->getFieldGridConfig($field, $gridType, $count, !empty($types), null, $class, $objectId);
-                        if (!empty($fieldConfig)) {
-                            $availableFields[] = $fieldConfig;
-                            $count++;
-                        }
-                    }
-                }
-            }
-        }
-        return $availableFields;
-    }
-    /**
-     * @param DataObject\ClassDefinition\Data $field
-     * @param DataObject\ClassDefinition\Data[] $brickFields
-     * @param array $availableFields
-     * @param string $gridType
-     * @param int $count
-     * @param string $brickType
-     * @param DataObject\ClassDefinition $class
-     * @param int $objectId
-     * @param array|null $context
-     */
-    protected function appendBrickFields($field, $brickFields, &$availableFields, $gridType, &$count, $brickType, $class, $objectId, $context = null)
-    {
-        if (!empty($brickFields)) {
-            foreach ($brickFields as $bf) {
-                if ($bf instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                    $localizedFieldDefinitions = $bf->getFieldDefinitions();
-                    $localizedContext = [
-                        'containerKey' => $brickType,
-                        'fieldname' => $field->getName(),
-                    ];
-                    $this->appendBrickFields($bf, $localizedFieldDefinitions, $availableFields, $gridType, $count, $brickType, $class, $objectId, $localizedContext);
-                } else {
-                    if ($context) {
-                        $context['brickfield'] = $bf->getName();
-                        $keyPrefix = '?' . json_encode($context) . '~';
-                    } else {
-                        $keyPrefix = $brickType . '~';
-                    }
-                    $fieldConfig = $this->getFieldGridConfig($bf, $gridType, $count, false, $keyPrefix, $class, $objectId);
-                    if (!empty($fieldConfig)) {
-                        $availableFields[] = $fieldConfig;
-                        $count++;
-                    }
-                }
-            }
-        }
-    }
-    /**
-     * @param array $config
-     *
-     * @return mixed
-     */
-    protected function getCalculatedColumnConfig($config)
-    {
-        try {
-            $calculatedColumnConfig = Tool\Session::useSession(function (AttributeBagInterface $session) use ($config) {
-                $calculatedColumn = [];
-                $existingKey = $config['fieldConfig']['key'];
-                $calculatedColumnConfig['key'] = $existingKey;
-                $calculatedColumnConfig['position'] = $config['position'];
-                $calculatedColumnConfig['isOperator'] = true;
-                $calculatedColumnConfig['attributes'] = $config['fieldConfig']['attributes'];
-                $calculatedColumnConfig['width'] = $config['width'];
-                $calculatedColumnConfig['locked'] = $config['locked'];
-                $existingColumns = $session->get('helpercolumns', []);
-                if (isset($existingColumns[$existingKey])) {
-                    return $calculatedColumnConfig;
-                }
-                $newKey = '#' . uniqid();
-                $calculatedColumnConfig['key'] = $newKey;
-                $phpConfig = json_encode($config['fieldConfig']);
-                $phpConfig = json_decode($phpConfig);
-                $helperColumns = [];
-                $helperColumns[$newKey] = $phpConfig;
-                $helperColumns = array_merge($helperColumns, $existingColumns);
-                $session->set('helpercolumns', $helperColumns);
-                return $calculatedColumnConfig;
-            }, 'pimcore_gridconfig');
-            return $calculatedColumnConfig;
-        } catch (\Exception $e) {
-            Logger::error($e);
-        }
-    }
-    /**
-     * @Route("/prepare-helper-column-configs", name="pimcore_admin_dataobject_dataobjecthelper_preparehelpercolumnconfigs", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function prepareHelperColumnConfigs(Request $request)
-    {
-        $helperColumns = [];
-        $newData = [];
-        /** @var \stdClass[] $data */
-        $data = json_decode($request->get('columns'));
-        foreach ($data as $item) {
-            if (!empty($item->isOperator)) {
-                $itemKey = '#' . uniqid();
-                $item->key = $itemKey;
-                $newData[] = $item;
-                $helperColumns[$itemKey] = $item;
-            } else {
-                $newData[] = $item;
-            }
-        }
-        Tool\Session::useSession(function (AttributeBagInterface $session) use ($helperColumns) {
-            $existingColumns = $session->get('helpercolumns', []);
-            $helperColumns = array_merge($helperColumns, $existingColumns);
-            $session->set('helpercolumns', $helperColumns);
-        }, 'pimcore_gridconfig');
-        return $this->adminJson(['success' => true, 'columns' => $newData]);
-    }
-    /**
-     * @Route("/grid-config-apply-to-all", name="pimcore_admin_dataobject_dataobjecthelper_gridconfigapplytoall", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridConfigApplyToAllAction(Request $request)
-    {
-        $objectId = $request->get('objectId');
-        $object = DataObject::getById($objectId);
-        if ($object->isAllowed('list')) {
-            $classId = $request->get('classId');
-            $gridConfigId = $request->get('gridConfigId');
-            $searchType = $request->get('searchType');
-            $user = $this->getAdminUser();
-            $db = Db::get();
-            $db->query('delete from gridconfig_favourites where '
-                . 'ownerId = ' . $user->getId()
-                . ' and classId = ' . $db->quote($classId) .
-                ' and searchType = ' . $db->quote($searchType)
-                . ' and objectId != ' . $objectId . ' and objectId != 0');
-            return $this->adminJson(['success' => true]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/grid-mark-favourite-column-config", name="pimcore_admin_dataobject_dataobjecthelper_gridmarkfavouritecolumnconfig", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridMarkFavouriteColumnConfigAction(Request $request)
-    {
-        $objectId = $request->get('objectId');
-        $object = DataObject::getById($objectId);
-        if ($object->isAllowed('list')) {
-            $classId = $request->get('classId');
-            $gridConfigId = $request->get('gridConfigId');
-            $searchType = $request->get('searchType');
-            $global = $request->get('global');
-            $user = $this->getAdminUser();
-            $type = $request->get('type');
-            $favourite = new GridConfigFavourite();
-            $favourite->setOwnerId($user->getId());
-            $class = DataObject\ClassDefinition::getById($classId);
-            if (!$class) {
-                throw new \Exception('class ' . $classId . ' does not exist anymore');
-            }
-            $favourite->setClassId($classId);
-            $favourite->setSearchType($searchType);
-            $favourite->setType($type);
-            $specializedConfigs = false;
-            try {
-                if ($gridConfigId != 0) {
-                    $gridConfig = GridConfig::getById($gridConfigId);
-                    $favourite->setGridConfigId($gridConfig->getId());
-                }
-                $favourite->setObjectId($objectId);
-                $favourite->save();
-                if ($global) {
-                    $favourite->setObjectId(0);
-                    $favourite->save();
-                }
-                $db = Db::get();
-                $count = $db->fetchOne('select * from gridconfig_favourites where '
-                    . 'ownerId = ' . $user->getId()
-                    . ' and classId = ' . $db->quote($classId).
-                    ' and searchType = ' . $db->quote($searchType)
-                    . ' and objectId != ' . $objectId . ' and objectId != 0'
-                    . ' and type != ' . $db->quote($type));
-                $specializedConfigs = $count > 0;
-            } catch (\Exception $e) {
-                $favourite->delete();
-            }
-            return $this->adminJson(['success' => true, 'spezializedConfigs' => $specializedConfigs]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param int $gridConfigId
-     *
-     * @return array
-     */
-    protected function getShareSettings($gridConfigId)
-    {
-        $result = [
-            'sharedUserIds' => [],
-            'sharedRoleIds' => [],
-        ];
-        $db = Db::get();
-        $allShares = $db->fetchAll('select s.sharedWithUserId, u.type from gridconfig_shares s, users u
-                      where s.sharedWithUserId = u.id and s.gridConfigId = ' . $gridConfigId);
-        if ($allShares) {
-            foreach ($allShares as $share) {
-                $type = $share['type'];
-                $key = 'shared' . ucfirst($type) . 'Ids';
-                $result[$key][] = $share['sharedWithUserId'];
-            }
-        }
-        foreach ($result as $idx => $value) {
-            $value = $value ? implode(',', $value) : '';
-            $result[$idx] = $value;
-        }
-        return $result;
-    }
-    /**
-     * @Route("/grid-save-column-config", name="pimcore_admin_dataobject_dataobjecthelper_gridsavecolumnconfig", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function gridSaveColumnConfigAction(Request $request)
-    {
-        $object = DataObject::getById($request->get('id'));
-        if ($object->isAllowed('list')) {
-            try {
-                $classId = $request->get('class_id');
-                $context = $request->get('context');
-                $searchType = $request->get('searchType');
-                $gridConfigData = $this->decodeJson($request->get('gridconfig'));
-                $gridConfigData['pimcore_version'] = Version::getVersion();
-                $gridConfigData['pimcore_revision'] = Version::getRevision();
-                $gridConfigData['context'] = $context;
-                unset($gridConfigData['settings']['isShared']);
-                $metadata = $request->get('settings');
-                $metadata = json_decode($metadata, true);
-                $gridConfigId = $metadata['gridConfigId'];
-                $gridConfig = null;
-                if ($gridConfigId) {
-                    try {
-                        $gridConfig = GridConfig::getById($gridConfigId);
-                    } catch (\Exception $e) {
-                    }
-                }
-                if ($gridConfig && $gridConfig->getOwnerId() != $this->getAdminUser()->getId() && !$this->getAdminUser()->isAdmin()) {
-                    throw new \Exception("don't mess around with somebody elses configuration");
-                }
-                $this->updateGridConfigShares($gridConfig, $metadata);
-                if (!$gridConfig) {
-                    $gridConfig = new GridConfig();
-                    $gridConfig->setName(date('c'));
-                    $gridConfig->setClassId($classId);
-                    $gridConfig->setSearchType($searchType);
-                    $gridConfig->setOwnerId($this->getAdminUser()->getId());
-                }
-                if ($metadata) {
-                    $gridConfig->setName($metadata['gridConfigName']);
-                    $gridConfig->setDescription($metadata['gridConfigDescription']);
-                    $gridConfig->setShareGlobally($metadata['shareGlobally'] && $this->getAdminUser()->isAdmin());
-                }
-                $gridConfigData = json_encode($gridConfigData);
-                $gridConfig->setConfig($gridConfigData);
-                $gridConfig->save();
-                $userId = $this->getAdminUser()->getId();
-                $availableConfigs = $this->getMyOwnGridColumnConfigs($userId, $classId, $searchType);
-                $sharedConfigs = $this->getSharedGridColumnConfigs($this->getAdminUser(), $classId, $searchType);
-                $settings = $this->getShareSettings($gridConfig->getId());
-                $settings['gridConfigId'] = (int)$gridConfig->getId();
-                $settings['gridConfigName'] = $gridConfig->getName();
-                $settings['gridConfigDescription'] = $gridConfig->getDescription();
-                $settings['shareGlobally'] = $gridConfig->isShareGlobally();
-                $settings['isShared'] = $gridConfig->getOwnerId() != $this->getAdminUser()->getId() && !$this->getAdminUser()->isAdmin();
-                return $this->adminJson([
-                    'success' => true,
-                    'settings' => $settings,
-                    'availableConfigs' => $availableConfigs,
-                    'sharedConfigs' => $sharedConfigs,
-                ]);
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param GridConfig|null $gridConfig
-     * @param array $metadata
-     *
-     * @throws \Exception
-     */
-    protected function updateGridConfigShares($gridConfig, $metadata)
-    {
-        $user = $this->getAdminUser();
-        if (!$gridConfig || !$user->isAllowed('share_configurations')) {
-            return;
-        }
-        if ($gridConfig->getOwnerId() != $user->getId() && !$user->isAdmin()) {
-            throw new \Exception("don't mess with someone elses grid config");
-        }
-        $combinedShares = [];
-        $sharedUserIds = $metadata['sharedUserIds'];
-        $sharedRoleIds = $metadata['sharedRoleIds'];
-        if ($sharedUserIds) {
-            $combinedShares = explode(',', $sharedUserIds);
-        }
-        if ($sharedRoleIds) {
-            $sharedRoleIds = explode(',', $sharedRoleIds);
-            $combinedShares = array_merge($combinedShares, $sharedRoleIds);
-        }
-        $db = Db::get();
-        $db->delete('gridconfig_shares', ['gridConfigId' => $gridConfig->getId()]);
-        foreach ($combinedShares as $id) {
-            $share = new GridConfigShare();
-            $share->setGridConfigId($gridConfig->getId());
-            $share->setSharedWithUserId($id);
-            $share->save();
-        }
-    }
-    /**
-     * @param DataObject\ClassDefinition\Data $field
-     * @param string $gridType
-     * @param string $position
-     * @param bool $force
-     * @param string|null $keyPrefix
-     * @param DataObject\ClassDefinition|null $class
-     * @param int|null $objectId
-     *
-     * @return array|null
-     */
-    protected function getFieldGridConfig($field, $gridType, $position, $force = false, $keyPrefix = null, $class = null, $objectId = null)
-    {
-        $key = $keyPrefix . $field->getName();
-        $config = null;
-        $title = $field->getName();
-        if (method_exists($field, 'getTitle')) {
-            if ($field->getTitle()) {
-                $title = $field->getTitle();
-            }
-        }
-        if ($field instanceof DataObject\ClassDefinition\Data\Slider) {
-            $config['minValue'] = $field->getMinValue();
-            $config['maxValue'] = $field->getMaxValue();
-            $config['increment'] = $field->getIncrement();
-        }
-        if (method_exists($field, 'getWidth')) {
-            $config['width'] = $field->getWidth();
-        }
-        if (method_exists($field, 'getHeight')) {
-            $config['height'] = $field->getHeight();
-        }
-        $visible = false;
-        if ($gridType == 'search') {
-            $visible = $field->getVisibleSearch();
-        } elseif ($gridType == 'grid') {
-            $visible = $field->getVisibleGridView();
-        } elseif ($gridType == 'all') {
-            $visible = true;
-        }
-        if (!$field->getInvisible() && ($force || $visible)) {
-            $context = ['purpose' => 'gridconfig'];
-            if ($class) {
-                $context['class'] = $class;
-            }
-            if ($objectId) {
-                $object = DataObject::getById($objectId);
-                $context['object'] = $object;
-            }
-            DataObject\Service::enrichLayoutDefinition($field, null, $context);
-            $result = [
-                'key' => $key,
-                'type' => $field->getFieldType(),
-                'label' => $title,
-                'config' => $config,
-                'layout' => $field,
-                'position' => $position,
-            ];
-            if ($field instanceof DataObject\ClassDefinition\Data\EncryptedField) {
-                $result['delegateDatatype'] = $field->getDelegateDatatype();
-            }
-            return $result;
-        } else {
-            return null;
-        }
-    }
-    /**
-     * IMPORTER
-     */
-    /**
-     * @Route("/import-upload", name="pimcore_admin_dataobject_dataobjecthelper_importupload", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function importUploadAction(Request $request)
-    {
-        $data = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $data = Tool\Text::convertToUTF8($data);
-        $importId = $request->get('importId');
-        $importId = str_replace('..', '', $importId);
-        $importFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/import_' . $importId;
-        File::put($importFile, $data);
-        $importFileOriginal = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/import_' . $importId . '_original';
-        File::put($importFileOriginal, $data);
-        $response = $this->adminJson([
-            'success' => true,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    private function getDataPreview($originalFile, $dialect)
-    {
-        $count = 0;
-        $data = [];
-        if (($handle = fopen($originalFile, 'r')) !== false) {
-            while (($rowData = fgetcsv($handle, 0, $dialect->delimiter, $dialect->quotechar, $dialect->escapechar)) !== false) {
-                $tmpData = [];
-                foreach ($rowData as $key => $value) {
-                    $tmpData['field_' . $key] = $value;
-                }
-                $tmpData['rowId'] = $count + 1;
-                $data[] = $tmpData;
-                $count++;
-                /**
-                 * Reached the number or rows for the preview
-                 */
-                if ($count > 18) {
-                    break;
-                }
-            }
-            fclose($handle);
-        }
-        return $data;
-    }
-    /**
-     * @param Request $request
-     *
-     * @return mixed|string
-     */
-    protected function extractLanguage(Request $request)
-    {
-        $requestedLanguage = $request->get('language');
-        if ($requestedLanguage) {
-            if ($requestedLanguage != 'default') {
-                $request->setLocale($requestedLanguage);
-            }
-        } else {
-            $requestedLanguage = $request->getLocale();
-        }
-        return $requestedLanguage;
-    }
-    /**
-     * @param string $fileHandle
-     *
-     * @return string
-     */
-    protected function getCsvFile($fileHandle)
-    {
-        return PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $fileHandle . '.csv';
-    }
-    /**
-     * @Route("/get-export-jobs", name="pimcore_admin_dataobject_dataobjecthelper_getexportjobs", methods={"GET"})
-     *
-     * @param Request $request
-     * @param GridHelperService $gridHelperService
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function getExportJobsAction(Request $request, GridHelperService $gridHelperService, EventDispatcherInterface $eventDispatcher)
-    {
-        $requestedLanguage = $this->extractLanguage($request);
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $list = $gridHelperService->prepareListingForGrid($allParams, $requestedLanguage, $this->getAdminUser());
-        $beforeListPrepareEvent = new GenericEvent($this, [
-            'list' => $list,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($beforeListPrepareEvent, AdminEvents::OBJECT_LIST_BEFORE_EXPORT_PREPARE);
-        $list = $beforeListPrepareEvent->getArgument('list');
-        $ids = $list->loadIdList();
-        $jobs = array_chunk($ids, 20);
-        $fileHandle = uniqid('export-');
-        file_put_contents($this->getCsvFile($fileHandle), '');
-        return $this->adminJson(['success' => true, 'jobs' => $jobs, 'fileHandle' => $fileHandle]);
-    }
-    /**
-     * @Route("/do-export", name="pimcore_admin_dataobject_dataobjecthelper_doexport", methods={"POST"})
-     *
-     * @param Request $request
-     * @param LocaleServiceInterface $localeService
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function doExportAction(Request $request, LocaleServiceInterface $localeService, EventDispatcherInterface $eventDispatcher)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $ids = $request->get('ids');
-        $settings = $request->get('settings');
-        $settings = json_decode($settings, true);
-        $delimiter = $settings['delimiter'] ?? ';';
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $enableInheritance = $settings['enableInheritance'] ?? null;
-        DataObject\Concrete::setGetInheritedValues($enableInheritance);
-        $class = DataObject\ClassDefinition::getById($request->get('classId'));
-        if (!$class) {
-            throw new \Exception('No class definition found');
-        }
-        $className = $class->getName();
-        $listClass = '\\Pimcore\\Model\\DataObject\\' . ucfirst($className) . '\\Listing';
-        /** @var \Pimcore\Model\DataObject\Listing $list */
-        $list = new $listClass();
-        $quotedIds = [];
-        foreach ($ids as $id) {
-            $quotedIds[] = $list->quote($id);
-        }
-        $list->setObjectTypes(DataObject::$types);
-        $list->setCondition('o_id IN (' . implode(',', $quotedIds) . ')');
-        $list->setOrderKey(' FIELD(o_id, ' . implode(',', $quotedIds) . ')', false);
-        $beforeListExportEvent = new GenericEvent($this, [
-            'list' => $list,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($beforeListExportEvent, AdminEvents::OBJECT_LIST_BEFORE_EXPORT);
-        $list = $beforeListExportEvent->getArgument('list');
-        $fields = $request->get('fields');
-        $addTitles = $request->get('initial');
-        $requestedLanguage = $this->extractLanguage($request);
-        $contextFromRequest = $request->get('context');
-        if ($contextFromRequest) {
-            $contextFromRequest = json_decode($contextFromRequest, true);
-        }
-        $context = [
-            'source' => 'pimcore-export',
-        ];
-        if (is_array($contextFromRequest)) {
-            $context = array_merge($context, $contextFromRequest);
-        }
-        $csv = DataObject\Service::getCsvData($requestedLanguage, $localeService, $list, $fields, $addTitles, $context);
-        $fp = fopen($this->getCsvFile($fileHandle), 'a');
-        $firstLine = true;
-        $lineCount = count($csv);
-        if (!$addTitles && $lineCount > 0) {
-            fwrite($fp, "\r\n");
-        }
-        for ($i = 0; $i < $lineCount; $i++) {
-            $line = $csv[$i];
-            if ($addTitles && $firstLine) {
-                $firstLine = false;
-                $line = implode($delimiter, $line);
-                fwrite($fp, $line);
-            } else {
-                fwrite($fp, implode($delimiter, array_map([$this, 'encodeFunc'], $line)));
-            }
-            if ($i < $lineCount - 1) {
-                fwrite($fp, "\r\n");
-            }
-        }
-        fclose($fp);
-        return $this->adminJson(['success' => true]);
-    }
-    public function encodeFunc($value)
-    {
-        $value = str_replace('"', '""', $value);
-        return '"' . $value . '"';
-    }
-    /**
-     * @Route("/download-csv-file", name="pimcore_admin_dataobject_dataobjecthelper_downloadcsvfile", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadCsvFileAction(Request $request)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $csvFile = $this->getCsvFile($fileHandle);
-        if (file_exists($csvFile)) {
-            $response = new BinaryFileResponse($csvFile);
-            $response->headers->set('Content-Type', 'application/csv');
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, 'export.csv');
-            $response->deleteFileAfterSend(true);
-            return $response;
-        }
-        throw $this->createNotFoundException('CSV file not found');
-    }
-    /**
-     * @Route("/download-xlsx-file", name="pimcore_admin_dataobject_dataobjecthelper_downloadxlsxfile", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadXlsxFileAction(Request $request)
-    {
-        $fileHandle = \Pimcore\File::getValidFilename($request->get('fileHandle'));
-        $csvFile = $this->getCsvFile($fileHandle);
-        if (file_exists($csvFile)) {
-            $csvReader = new Csv();
-            $csvReader->setDelimiter(';');
-            $csvReader->setSheetIndex(0);
-            $spreadsheet = $csvReader->load($csvFile);
-            $writer = new Xlsx($spreadsheet);
-            $xlsxFilename = PIMCORE_SYSTEM_TEMP_DIRECTORY. '/' .$fileHandle. '.xlsx';
-            $writer->save($xlsxFilename);
-            $response = new BinaryFileResponse($xlsxFilename);
-            $response->headers->set('Content-Type', 'application/xlsx');
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, 'export.xlsx');
-            $response->deleteFileAfterSend(true);
-            return $response;
-        }
-        throw $this->createNotFoundException('XLSX file not found');
-    }
-    /**
-     * Flattens object data to an array with key=>value where
-     * value is simply a string representation of the value (for objects, hrefs and assets the full path is used)
-     *
-     * @param DataObject\Concrete $object
-     *
-     * @return array
-     */
-    protected function csvObjectData($object)
-    {
-        $o = [];
-        foreach ($object->getClass()->getFieldDefinitions() as $key => $value) {
-            if (!$value instanceof DataObject\ClassDefinition\Data\ReverseObjectRelation) {
-                $o[$key] = $value->getForCsvExport($object);
-            }
-        }
-        $o['id (system)'] = $object->getId();
-        $o['key (system)'] = $object->getKey();
-        $o['fullpath (system)'] = $object->getRealFullPath();
-        $o['published (system)'] = $object->isPublished();
-        $o['type (system)'] = $object->getType();
-        return $o;
-    }
-    /**
-     * @Route("/get-batch-jobs", name="pimcore_admin_dataobject_dataobjecthelper_getbatchjobs", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getBatchJobsAction(Request $request, GridHelperService $gridHelperService)
-    {
-        if ($request->get('language')) {
-            $request->setLocale($request->get('language'));
-        }
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $list = $gridHelperService->prepareListingForGrid($allParams, $request->getLocale(), $this->getAdminUser());
-        $jobs = $list->loadIdList();
-        return $this->adminJson(['success' => true, 'jobs' => $jobs]);
-    }
-    /**
-     * @Route("/batch", name="pimcore_admin_dataobject_dataobjecthelper_batch", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function batchAction(Request $request)
-    {
-        $success = true;
-        try {
-            if ($request->get('data')) {
-                $params = $this->decodeJson($request->get('data'), true);
-                $object = DataObject\Concrete::getById($params['job']);
-                if ($object) {
-                    $name = $params['name'];
-                    if (!$object->isAllowed('save') || ($name === 'published' && !$object->isAllowed('publish'))) {
-                        throw new \Exception("Permission denied. You don't have the rights to save this object.");
-                    }
-                    $append = $params['append'] ?? false;
-                    $remove = $params['remove'] ?? false;
-                    $className = $object->getClassName();
-                    $class = DataObject\ClassDefinition::getByName($className);
-                    $value = $params['value'];
-                    if ($params['valueType'] == 'object') {
-                        $value = $this->decodeJson($value);
-                    }
-                    $parts = explode('~', $name);
-                    if (substr($name, 0, 1) == '~') {
-                        $type = $parts[1];
-                        $field = $parts[2];
-                        $keyid = $parts[3];
-                        if ($type == 'classificationstore') {
-                            $requestedLanguage = $params['language'];
-                            if ($requestedLanguage) {
-                                if ($requestedLanguage != 'default') {
-                                    $request->setLocale($requestedLanguage);
-                                }
-                            } else {
-                                $requestedLanguage = $request->getLocale();
-                            }
-                            $groupKeyId = explode('-', $keyid);
-                            $groupId = $groupKeyId[0];
-                            $keyid = $groupKeyId[1];
-                            $getter = 'get' . ucfirst($field);
-                            if (method_exists($object, $getter)) {
-                                /** @var DataObject\ClassDefinition\Data\Classificationstore $csFieldDefinition */
-                                $csFieldDefinition = $object->getClass()->getFieldDefinition($field);
-                                $csLanguage = $requestedLanguage;
-                                if (!$csFieldDefinition->isLocalized()) {
-                                    $csLanguage = 'default';
-                                }
-                                /** @var DataObject\ClassDefinition\Data\Classificationstore $fd */
-                                $fd = $class->getFieldDefinition($field);
-                                $keyConfig = $fd->getKeyConfiguration($keyid);
-                                $dataDefinition = DataObject\Classificationstore\Service::getFieldDefinitionFromKeyConfig($keyConfig);
-                                /** @var DataObject\Classificationstore $classificationStoreData */
-                                $classificationStoreData = $object->$getter();
-                                $classificationStoreData->setLocalizedKeyValue(
-                                    $groupId,
-                                    $keyid,
-                                    $dataDefinition->getDataFromEditmode($value),
-                                    $csLanguage
-                                );
-                            }
-                        }
-                    } elseif (count($parts) > 1) {
-                        $brickType = $parts[0];
-                        $brickKey = $parts[1];
-                        $brickField = DataObject\Service::getFieldForBrickType($object->getClass(), $brickType);
-                        $fieldGetter = 'get' . ucfirst($brickField);
-                        $brickGetter = 'get' . ucfirst($brickType);
-                        $valueSetter = 'set' . ucfirst($brickKey);
-                        $brick = $object->$fieldGetter()->$brickGetter();
-                        if (empty($brick)) {
-                            $classname = '\\Pimcore\\Model\\DataObject\\Objectbrick\\Data\\' . ucfirst($brickType);
-                            $brickSetter = 'set' . ucfirst($brickType);
-                            $brick = new $classname($object);
-                            $object->$fieldGetter()->$brickSetter($brick);
-                        }
-                        $brickClass = DataObject\Objectbrick\Definition::getByKey($brickType);
-                        $field = $brickClass->getFieldDefinition($brickKey);
-                        $newData = $field->getDataFromEditmode($value, $object);
-                        if ($append) {
-                            $valueGetter = 'get' . ucfirst($brickKey);
-                            $existingData = $brick->$valueGetter();
-                            $newData = $field->appendData($existingData, $newData);
-                        }
-                        if ($remove) {
-                            $valueGetter = 'get' . ucfirst($brickKey);
-                            $existingData = $brick->$valueGetter();
-                            $newData = $field->removeData($existingData, $newData);
-                        }
-                        $brick->$valueSetter($newData);
-                    } else {
-                        $field = $class->getFieldDefinition($name);
-                        if ($field) {
-                            $newData = $field->getDataFromEditmode($value, $object);
-                            if ($append) {
-                                $existingData = $object->{'get' . $name}();
-                                $newData = $field->appendData($existingData, $newData);
-                            }
-                            if ($remove) {
-                                $existingData = $object->{'get' . $name}();
-                                $newData = $field->removeData($existingData, $newData);
-                            }
-                            $object->setValue($name, $newData);
-                        } else {
-                            if ($params['language']) {
-                                $localizedField = $class->getFieldDefinition('localizedfields');
-                                if ($localizedField instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                                    $field = $localizedField->getFieldDefinition($name);
-                                    if ($field) {
-                                        $getter = 'get' . $name;
-                                        $setter = 'set' . $name;
-                                        $newData = $field->getDataFromEditmode($value, $object);
-                                        if ($append) {
-                                            $existingData = $object->$getter($params['language']);
-                                            $newData = $field->appendData($existingData, $newData);
-                                        }
-                                        if ($remove) {
-                                            $existingData = $object->$getter($request->get('language'));
-                                            $newData = $field->removeData($existingData, $newData);
-                                        }
-                                        $object->$setter($newData, $params['language']);
-                                    }
-                                }
-                            }
-                            if ($name == 'published') {
-                                if ($value === 'false' || empty($value)) {
-                                    $object->setPublished(false);
-                                } else {
-                                    $object->setPublished(true);
-                                }
-                            }
-                        }
-                    }
-                    try {
-                        $object->setOmitMandatoryCheck(!$object->isPublished());
-                        $object->setUserModification($this->getAdminUser()->getId());
-                        $object->save();
-                        $success = true;
-                    } catch (\Exception $e) {
-                        return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                    }
-                } else {
-                    Logger::debug('DataObjectController::batchAction => There is no object left to update.');
-                    return $this->adminJson(['success' => false, 'message' => 'DataObjectController::batchAction => There is no object left to update.']);
-                }
-            }
-        } catch (\Exception $e) {
-            Logger::err($e);
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/get-available-visible-vields", name="pimcore_admin_dataobject_dataobjecthelper_getavailablevisiblefields", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableVisibleFieldsAction(Request $request)
-    {
-        $class = null;
-        $fields = null;
-        $classList = [];
-        $classNameList = [];
-        if ($request->get('classes')) {
-            $classNameList = $request->get('classes');
-            $classNameList = explode(',', $classNameList);
-            foreach ($classNameList as $className) {
-                $class = DataObject\ClassDefinition::getByName($className);
-                if ($class) {
-                    $classList[] = $class;
-                }
-            }
-        }
-        if (!$classList) {
-            return $this->adminJson(['availableFields' => []]);
-        }
-        $availableFields = [];
-        foreach (self::SYSTEM_COLUMNS as $field) {
-            $availableFields[] = [
-                'key' => $field,
-                'value' => $field,
-            ];
-        }
-        /** @var DataObject\ClassDefinition\Data[] $commonFields */
-        $commonFields = [];
-        $firstOne = true;
-        foreach ($classNameList as $className) {
-            $class = DataObject\ClassDefinition::getByName($className);
-            if ($class) {
-                $fds = $class->getFieldDefinitions();
-                $additionalFieldNames = array_keys($fds);
-                $localizedFields = $class->getFieldDefinition('localizedfields');
-                if ($localizedFields instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                    $lfNames = array_keys($localizedFields->getFieldDefinitions());
-                    $additionalFieldNames = array_merge($additionalFieldNames, $lfNames);
-                }
-                foreach ($commonFields as $commonFieldKey => $commonFieldDefinition) {
-                    if (!in_array($commonFieldKey, $additionalFieldNames)) {
-                        unset($commonFields[$commonFieldKey]);
-                    }
-                }
-                $this->processAvailableFieldDefinitions($fds, $firstOne, $commonFields);
-                $firstOne = false;
-            }
-        }
-        $commonFieldKeys = array_keys($commonFields);
-        foreach ($commonFieldKeys as $field) {
-            $availableFields[] = [
-                'key' => $field,
-                'value' => $field,
-            ];
-        }
-        return $this->adminJson(['availableFields' => $availableFields]);
-    }
-    /**
-     * @param DataObject\ClassDefinition\Data[] $fds
-     * @param bool $firstOne
-     * @param DataObject\ClassDefinition\Data[] $commonFields
-     */
-    protected function processAvailableFieldDefinitions($fds, &$firstOne, &$commonFields)
-    {
-        foreach ($fds as $fd) {
-            if ($fd instanceof DataObject\ClassDefinition\Data\Fieldcollections || $fd instanceof DataObject\ClassDefinition\Data\Objectbricks
-                || $fd instanceof DataObject\ClassDefinition\Data\Block) {
-                continue;
-            }
-            if ($fd instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                $lfDefs = $fd->getFieldDefinitions();
-                $this->processAvailableFieldDefinitions($lfDefs, $firstOne, $commonFields);
-            } elseif ($firstOne || (isset($commonFields[$fd->getName()]) && $commonFields[$fd->getName()]->getFieldtype() == $fd->getFieldtype())) {
-                $commonFields[$fd->getName()] = $fd;
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/QuantityValueController.php
+++ b//dev/null
@@ -1,234 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Model\DataObject\Data\QuantityValue;
-use Pimcore\Model\DataObject\QuantityValue\Unit;
-use Pimcore\Model\DataObject\QuantityValue\UnitConversionService;
-use Pimcore\Model\Translation;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- *  @internal
- */
-class QuantityValueController extends AdminController
-{
-    /**
-     * @Route("/quantity-value/unit-proxy", name="pimcore_admin_dataobject_quantityvalue_unitproxyget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function unitProxyGetAction(Request $request)
-    {
-        $list = new Unit\Listing();
-        $order = ['ASC', 'ASC', 'ASC'];
-        $orderKey = ['baseunit', 'factor', 'abbreviation'];
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey']) {
-            array_unshift($orderKey, $sortingSettings['orderKey']);
-        }
-        if ($sortingSettings['order']) {
-            array_unshift($order, $sortingSettings['order']);
-        }
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey);
-        $list->setLimit($request->get('limit'));
-        $list->setOffset($request->get('start'));
-        $condition = '1 = 1';
-        if ($request->get('filter')) {
-            $filterString = $request->get('filter');
-            $filters = json_decode($filterString);
-            $db = \Pimcore\Db::get();
-            foreach ($filters as $f) {
-                if ($f->type == 'string') {
-                    $condition .= ' AND ' . $db->quoteIdentifier($f->property) . ' LIKE ' . $db->quote('%' . $f->value . '%');
-                } elseif ($f->type == 'numeric') {
-                    $operator = $this->getOperator($f->comparison);
-                    $condition .= ' AND ' . $db->quoteIdentifier($f->property) . ' ' . $operator . ' ' . $db->quote($f->value);
-                }
-            }
-            $list->setCondition($condition);
-        }
-        $units = [];
-        foreach ($list->getUnits() as $u) {
-            $units[] = $u->getObjectVars();
-        }
-        return $this->adminJson(['data' => $units, 'success' => true, 'total' => $list->getTotalCount()]);
-    }
-    /**
-     * @Route("/quantity-value/unit-proxy", name="pimcore_admin_dataobject_quantityvalue_unitproxy", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function unitProxyAction(Request $request)
-    {
-        if ($request->get('data')) {
-            if ($request->get('xaction') == 'destroy') {
-                $data = json_decode($request->get('data'), true);
-                $id = $data['id'];
-                $unit = \Pimcore\Model\DataObject\QuantityValue\Unit::getById($id);
-                if (!empty($unit)) {
-                    $unit->delete();
-                    return $this->adminJson(['data' => [], 'success' => true]);
-                } else {
-                    throw new \Exception('Unit with id ' . $id . ' not found.');
-                }
-            } elseif ($request->get('xaction') == 'update') {
-                $data = json_decode($request->get('data'), true);
-                $unit = Unit::getById($data['id']);
-                if (!empty($unit)) {
-                    if (($data['baseunit'] ?? null) === -1) {
-                        $data['baseunit'] = null;
-                    }
-                    $unit->setValues($data);
-                    $unit->save();
-                    return $this->adminJson(['data' => $unit->getObjectVars(), 'success' => true]);
-                } else {
-                    throw new \Exception('Unit with id ' . $data['id'] . ' not found.');
-                }
-            } elseif ($request->get('xaction') == 'create') {
-                $data = json_decode($request->get('data'), true);
-                if (isset($data['baseunit']) && $data['baseunit'] === -1) {
-                    $data['baseunit'] = null;
-                }
-                $id = $data['id'];
-                if (Unit::getById($id)) {
-                    throw new \Exception('unit with ID [' . $id . '] already exists');
-                }
-                $unit = new Unit();
-                $unit->setValues($data);
-                $unit->save();
-                return $this->adminJson(['data' => $unit->getObjectVars(), 'success' => true]);
-            }
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param string $comparison
-     *
-     * @return string
-     */
-    private function getOperator($comparison)
-    {
-        $mapper = [
-            'lt' => '<',
-            'gt' => '>',
-            'eq' => '=',
-        ];
-        return $mapper[$comparison];
-    }
-    /**
-     * @Route("/quantity-value/unit-list", name="pimcore_admin_dataobject_quantityvalue_unitlist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function unitListAction(Request $request)
-    {
-        $list = new Unit\Listing();
-        $list->setOrderKey(['baseunit', 'factor', 'abbreviation']);
-        $list->setOrder(['ASC', 'ASC', 'ASC']);
-        if ($request->get('filter')) {
-            $array = explode(',', $request->get('filter'));
-            $quotedArray = [];
-            $db = \Pimcore\Db::get();
-            foreach ($array as $a) {
-                $quotedArray[] = $db->quote($a);
-            }
-            $string = implode(',', $quotedArray);
-            $list->setCondition('id IN (' . $string . ')');
-        }
-        $result = [];
-        $units = $list->getUnits();
-        foreach ($units as &$unit) {
-            try {
-                if ($unit->getAbbreviation()) {
-                    $unit->setAbbreviation(\Pimcore\Model\Translation::getByKeyLocalized($unit->getAbbreviation(), Translation::DOMAIN_ADMIN,
-                        true, true));
-                }
-                if ($unit->getLongname()) {
-                    $unit->setLongname(\Pimcore\Model\Translation::getByKeyLocalized($unit->getLongname(), Translation::DOMAIN_ADMIN, true,
-                        true));
-                }
-                $result[] = $unit->getObjectVars();
-            } catch (\Exception $e) {
-            }
-        }
-        return $this->adminJson(['data' => $result, 'success' => true, 'total' => $list->getTotalCount()]);
-    }
-    /**
-     * @Route("/quantity-value/convert", name="pimcore_admin_dataobject_quantityvalue_convert", methods={"GET"})
-     *
-     * @param Request $request
-     * @param UnitConversionService $conversionService
-     *
-     * @return JsonResponse
-     */
-    public function convertAction(Request $request, UnitConversionService $conversionService)
-    {
-        $fromUnitId = $request->get('fromUnit');
-        $toUnitId = $request->get('toUnit');
-        $fromUnit = Unit::getById($fromUnitId);
-        $toUnit = Unit::getById($toUnitId);
-        if (!$fromUnit instanceof Unit || !$toUnit instanceof Unit) {
-            return $this->adminJson(['success' => false]);
-        }
-        try {
-            $convertedValue = $conversionService->convert(new QuantityValue($request->get('value'), $fromUnit), $toUnit);
-        } catch (\Exception $e) {
-            return $this->adminJson(['success' => false]);
-        }
-        return $this->adminJson(['value' => $convertedValue->getValue(), 'success' => true]);
-    }
-    /**
-     * @Route("/quantity-value/convert-all", name="pimcore_admin_dataobject_quantityvalue_convertall", methods={"GET"})
-     *
-     * @param Request $request
-     * @param UnitConversionService $conversionService
-     *
-     * @return JsonResponse
-     */
-    public function convertAllAction(Request $request, UnitConversionService $conversionService)
-    {
-        $unitId = $request->get('unit');
-        $fromUnit = Unit::getById($unitId);
-        if (!$fromUnit instanceof Unit) {
-            return $this->adminJson(['success' => false]);
-        }
-        $baseUnit = $fromUnit->getBaseunit() ?? $fromUnit;
-        $units = new Unit\Listing();
-        $units->setCondition('baseunit = '.$units->quote($baseUnit->getId()).' AND id != '.$units->quote($fromUnit->getId()));
-        $convertedValues = [];
-        foreach ($units->getUnits() as $targetUnit) {
-            try {
-                $convertedValue = $conversionService->convert(new QuantityValue($request->get('value'), $fromUnit), $targetUnit);
-                $convertedValues[] = ['unit' => $targetUnit->getAbbreviation(), 'unitName' => $targetUnit->getLongname(), 'value' => round($convertedValue->getValue(), 4)];
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        return $this->adminJson(['value' => $request->get('value'), 'fromUnit' => $fromUnit->getAbbreviation(), 'values' => $convertedValues, 'success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/DataObject/VariantsController.php
+++ b//dev/null
@@ -1,228 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\DataObject;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Model\DataObject;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/variants")
- *
- * @internal
- */
-class VariantsController extends AdminController
-{
-    /**
-     * @Route("/update-key", name="pimcore_admin_dataobject_variants_updatekey", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updateKeyAction(Request $request)
-    {
-        $id = $request->get('id');
-        $key = $request->get('key');
-        $object = DataObject\Concrete::getById($id);
-        try {
-            if (!empty($object)) {
-                $object->setKey($key);
-                $object->save();
-                return $this->adminJson(['success' => true]);
-            } else {
-                throw new \Exception('No Object found for given id.');
-            }
-        } catch (\Exception $e) {
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @Route("/get-variants", name="pimcore_admin_dataobject_variants_getvariants", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     * @param GridHelperService $gridHelperService
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getVariantsAction(Request $request, GridHelperService $gridHelperService)
-    {
-        $requestedLanguage = $request->get('language');
-        if ($requestedLanguage) {
-            if ($requestedLanguage != 'default') {
-                $request->setLocale($requestedLanguage);
-            }
-        } else {
-            $requestedLanguage = $request->getLocale();
-        }
-        if ($request->get('xaction') == 'update') {
-            $data = $this->decodeJson($request->get('data'));
-            $object = DataObject\Concrete::getById($data['id']);
-            $class = $object->getClass();
-            if ($object->isAllowed('publish')) {
-                $objectData = [];
-                foreach ($data as $key => $value) {
-                    $parts = explode('~', $key);
-                    if (substr($key, 0, 1) == '~') {
-                        $type = $parts[1];
-                        $field = $parts[2];
-                        $keyid = $parts[3];
-                        if ($type == 'classificationstore') {
-                            $groupKeyId = explode('-', $keyid);
-                            $groupId = $groupKeyId[0];
-                            $keyid = $groupKeyId[1];
-                            $getter = 'get' . ucfirst($field);
-                            if (method_exists($object, $getter)) {
-                                /** @var DataObject\ClassDefinition\Data\Classificationstore $csFieldDefinition */
-                                $csFieldDefinition = $object->getClass()->getFieldDefinition($field);
-                                $csLanguage = $requestedLanguage;
-                                if (!$csFieldDefinition->isLocalized()) {
-                                    $csLanguage = 'default';
-                                }
-                                /** @var DataObject\Classificationstore $classificationStoreData */
-                                $classificationStoreData = $object->$getter();
-                                $keyConfig = DataObject\Classificationstore\KeyConfig::getById($keyid);
-                                if ($keyConfig) {
-                                    $fieldDefinition = $keyDef = DataObject\Classificationstore\Service::getFieldDefinitionFromJson(
-                                        json_decode($keyConfig->getDefinition()),
-                                        $keyConfig->getType()
-                                    );
-                                    if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                                        $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                                    }
-                                }
-                                $activeGroups = $classificationStoreData->getActiveGroups() ? $classificationStoreData->getActiveGroups() : [];
-                                $activeGroups[$groupId] = true;
-                                $classificationStoreData->setActiveGroups($activeGroups);
-                                $classificationStoreData->setLocalizedKeyValue($groupId, $keyid, $value, $csLanguage);
-                            }
-                        }
-                    } elseif (count($parts) > 1) {
-                        $brickType = $parts[0];
-                        $brickDescriptor = null;
-                        if (strpos($brickType, '?') !== false) {
-                            $brickDescriptor = substr($brickType, 1);
-                            $brickDescriptor = json_decode($brickDescriptor, true);
-                            $brickType = $brickDescriptor['containerKey'];
-                        }
-                        $brickKey = $parts[1];
-                        $brickField = DataObject\Service::getFieldForBrickType($object->getClass(), $brickType);
-                        $fieldGetter = 'get' . ucfirst($brickField);
-                        $brickGetter = 'get' . ucfirst($brickType);
-                        $valueSetter = 'set' . ucfirst($brickKey);
-                        $brick = $object->$fieldGetter()->$brickGetter();
-                        if (empty($brick)) {
-                            $classname = '\\Pimcore\\Model\\DataObject\\Objectbrick\\Data\\' . ucfirst($brickType);
-                            $brickSetter = 'set' . ucfirst($brickType);
-                            $brick = new $classname($object);
-                            $object->$fieldGetter()->$brickSetter($brick);
-                        }
-                        if ($brickDescriptor) {
-                            $brickDefinition = DataObject\Objectbrick\Definition::getByKey($brickType);
-                            /** @var DataObject\ClassDefinition\Data\Localizedfields $fieldDefinitionLocalizedFields */
-                            $fieldDefinitionLocalizedFields = $brickDefinition->getFieldDefinition('localizedfields');
-                            $fieldDefinition = $fieldDefinitionLocalizedFields->getFieldDefinition($brickKey);
-                        } else {
-                            $fieldDefinition = $this->getFieldDefinitionFromBrick($brickType, $brickKey);
-                        }
-                        if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                            $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                        }
-                        if ($brickDescriptor) {
-                            /** @var DataObject\Localizedfield $localizedFields */
-                            $localizedFields = $brick->getLocalizedfields();
-                            $localizedFields->setLocalizedValue($brickKey, $value);
-                        } else {
-                            $brick->$valueSetter($value);
-                        }
-                    }
-                    $fieldDefinition = $this->getFieldDefinition($class, $key);
-                    if ($fieldDefinition && method_exists($fieldDefinition, 'getDataFromGridEditor')) {
-                        $value = $fieldDefinition->getDataFromGridEditor($value, $object, []);
-                    }
-                    $objectData[$key] = $value;
-                }
-                $object->setValues($objectData);
-                try {
-                    $object->save();
-                    return $this->adminJson(['data' => DataObject\Service::gridObjectData($object, $request->get('fields')), 'success' => true]);
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            } else {
-                throw new \Exception('Permission denied');
-            }
-        } else {
-            $parentObject = DataObject\Concrete::getById($request->get('objectId'));
-            if (empty($parentObject)) {
-                throw new \Exception('No Object found with id ' . $request->get('objectId'));
-            }
-            if ($parentObject->isAllowed('view')) {
-                $allParams = array_merge($request->request->all(), $request->query->all());
-                $allParams['folderId'] = $parentObject->getId();
-                $allParams['only_direct_children'] = 'true';
-                $allParams['classId'] = $parentObject->getClassId();
-                $list = $gridHelperService->prepareListingForGrid($allParams, $request->getLocale(), $this->getAdminUser());
-                $list->setObjectTypes([DataObject::OBJECT_TYPE_VARIANT]);
-                $list->load();
-                $objects = [];
-                foreach ($list->getObjects() as $object) {
-                    if ($object->isAllowed('view')) {
-                        $o = DataObject\Service::gridObjectData($object, $request->get('fields'), $requestedLanguage);
-                        $objects[] = $o;
-                    }
-                }
-                return $this->adminJson(['data' => $objects, 'success' => true, 'total' => $list->getTotalCount()]);
-            } else {
-                throw new \Exception('Permission denied');
-            }
-        }
-    }
-    /**
-     * @param DataObject\ClassDefinition $class
-     * @param string $key
-     *
-     * @return DataObject\ClassDefinition\Data|null
-     */
-    protected function getFieldDefinition($class, $key)
-    {
-        $fieldDefinition = $class->getFieldDefinition($key);
-        if ($fieldDefinition) {
-            return $fieldDefinition;
-        }
-        $localized = $class->getFieldDefinition('localizedfields');
-        if ($localized instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-            $fieldDefinition = $localized->getFieldDefinition($key);
-        }
-        return $fieldDefinition;
-    }
-    /**
-     * @param string $brickType
-     * @param string $key
-     *
-     * @return DataObject\ClassDefinition\Data|null
-     */
-    protected function getFieldDefinitionFromBrick($brickType, $key)
-    {
-        $brickDefinition = DataObject\Objectbrick\Definition::getByKey($brickType);
-        $fieldDefinition = null;
-        if ($brickDefinition) {
-            $fieldDefinition = $brickDefinition->getFieldDefinition($key);
-        }
-        return $fieldDefinition;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/DocumentController.php
+++ b//dev/null
@@ -1,1294 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Bundle\AdminBundle\Controller\Admin\ElementControllerBase;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\DocumentTreeConfigTrait;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Db;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Image\HtmlToImage;
-use Pimcore\Logger;
-use Pimcore\Model\Document;
-use Pimcore\Model\Redirect;
-use Pimcore\Model\Site;
-use Pimcore\Model\Version;
-use Pimcore\Routing\Dynamic\DocumentRouteHandler;
-use Pimcore\Tool;
-use Pimcore\Tool\Frontend;
-use Pimcore\Tool\Session;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/document")
- *
- * @internal
- */
-class DocumentController extends ElementControllerBase implements KernelControllerEventInterface
-{
-    use DocumentTreeConfigTrait;
-    /**
-     * @var Document\Service
-     */
-    protected $_documentService;
-    /**
-     * @Route("/tree-get-root", name="pimcore_admin_document_document_treegetroot", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetRootAction(Request $request)
-    {
-        return parent::treeGetRootAction($request);
-    }
-    /**
-     * @Route("/delete-info", name="pimcore_admin_document_document_deleteinfo", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function deleteInfoAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        return parent::deleteInfoAction($request, $eventDispatcher);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_document_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $document = Document::getById($request->get('id'));
-        if (!$document) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        $document = clone $document;
-        $data = $document->getObjectVars();
-        $data['versionDate'] = $document->getModificationDate();
-        $data['php'] = [
-            'classes' => array_merge([get_class($document)], array_values(class_parents($document))),
-            'interfaces' => array_values(class_implements($document)),
-        ];
-        $this->addAdminStyle($document, ElementAdminStyleEvent::CONTEXT_EDITOR, $data);
-        $event = new GenericEvent($this, [
-            'data' => $data,
-            'document' => $document,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::DOCUMENT_GET_PRE_SEND_DATA);
-        $data = $event->getArgument('data');
-        if ($document->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/tree-get-childs-by-id", name="pimcore_admin_document_document_treegetchildsbyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetChildsByIdAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $filter = $request->get('filter');
-        $limit = (int)($allParams['limit'] ?? 100000000);
-        $offset = (int)($allParams['start'] ?? 0);
-        if (!is_null($filter)) {
-            if (substr($filter, -1) != '*') {
-                $filter .= '*';
-            }
-            $filter = str_replace('*', '%', $filter);
-            $limit = 100;
-            $offset = 0;
-        }
-        $document = Document::getById($allParams['node']);
-        if (!$document) {
-            throw $this->createNotFoundException('Document was not found');
-        }
-        $documents = [];
-        $cv = false;
-        if ($document->hasChildren()) {
-            if ($allParams['view']) {
-                $cv = \Pimcore\Model\Element\Service::getCustomViewById($allParams['view']);
-            }
-            $db = Db::get();
-            $list = new Document\Listing();
-            if ($this->getAdminUser()->isAdmin()) {
-                $condition = 'parentId =  ' . $db->quote($document->getId());
-            } else {
-                $userIds = $this->getAdminUser()->getRoles();
-                $userIds[] = $this->getAdminUser()->getId();
-                $condition = 'parentId = ' . $db->quote($document->getId()) . ' AND
-                (
-                    (SELECT list FROM users_workspaces_document WHERE userId IN (' . implode(',', $userIds) . ') AND LOCATE(CONCAT(path,`key`),cpath)=1  ORDER BY LENGTH(cpath) DESC, FIELD(userId, '. $this->getAdminUser()->getId() .') DESC, list DESC LIMIT 1)=1
-                    or
-                    (SELECT list FROM users_workspaces_document WHERE userId IN (' . implode(',', $userIds) . ') AND LOCATE(cpath,CONCAT(path,`key`))=1  ORDER BY LENGTH(cpath) DESC, FIELD(userId, '. $this->getAdminUser()->getId() .') DESC, list DESC LIMIT 1)=1
-                )';
-            }
-            if ($filter) {
-                $condition = '(' . $condition . ')' . ' AND CAST(documents.key AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci LIKE ' . $db->quote($filter);
-            }
-            $list->setCondition($condition);
-            $list->setOrderKey(['index', 'id']);
-            $list->setOrder(['asc', 'asc']);
-            $list->setLimit($limit);
-            $list->setOffset($offset);
-            \Pimcore\Model\Element\Service::addTreeFilterJoins($cv, $list);
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $list,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::DOCUMENT_LIST_BEFORE_LIST_LOAD);
-            /** @var Document\Listing $list */
-            $list = $beforeListLoadEvent->getArgument('list');
-            $childsList = $list->load();
-            foreach ($childsList as $childDocument) {
-                if ($childDocument->isAllowed('list')) {
-                    $documents[] = $this->getTreeNodeConfig($childDocument);
-                }
-            }
-        }
-        $event = new GenericEvent($this, [
-            'documents' => $documents,
-        ]);
-        $eventDispatcher->dispatch($event, AdminEvents::DOCUMENT_TREE_GET_CHILDREN_BY_ID_PRE_SEND_DATA);
-        $documents = $event->getArgument('documents');
-        if ($allParams['limit']) {
-            return $this->adminJson([
-                'offset' => $offset,
-                'limit' => $limit,
-                'total' => $document->getChildAmount($this->getAdminUser()),
-                'nodes' => $documents,
-                'filter' => $request->get('filter') ? $request->get('filter') : '',
-                'inSearch' => (int)$request->get('inSearch'),
-            ]);
-        } else {
-            return $this->adminJson($documents);
-        }
-    }
-    /**
-     * @Route("/add", name="pimcore_admin_document_document_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        $success = false;
-        $errorMessage = '';
-        $parentDocument = Document::getById((int)$request->get('parentId'));
-        $document = null;
-        if ($parentDocument->isAllowed('create')) {
-            $intendedPath = $parentDocument->getRealFullPath() . '/' . $request->get('key');
-            if (!Document\Service::pathExists($intendedPath)) {
-                $createValues = [
-                    'userOwner' => $this->getAdminUser()->getId(),
-                    'userModification' => $this->getAdminUser()->getId(),
-                    'published' => false,
-                ];
-                $createValues['key'] = \Pimcore\Model\Element\Service::getValidKey($request->get('key'), 'document');
-                $docType = Document\DocType::getById((int)$request->get('docTypeId'));
-                if ($docType) {
-                    $createValues['template'] = $docType->getTemplate();
-                    $createValues['controller'] = $docType->getController();
-                } elseif ($request->get('translationsBaseDocument')) {
-                    $translationsBaseDocument = Document::getById($request->get('translationsBaseDocument'));
-                    if ($translationsBaseDocument instanceof Document\PageSnippet) {
-                        $createValues['template'] = $translationsBaseDocument->getTemplate();
-                        $createValues['controller'] = $translationsBaseDocument->getController();
-                    }
-                } elseif ($request->get('type') == 'page' || $request->get('type') == 'snippet' || $request->get('type') == 'email') {
-                    $createValues['controller'] = $this->getParameter('pimcore.documents.default_controller');
-                } elseif ($request->get('type') == 'printpage') {
-                    $createValues['controller'] = $this->getParameter('pimcore.documents.web_to_print.default_controller_print_page');
-                } elseif ($request->get('type') == 'printcontainer') {
-                    $createValues['controller'] = $this->getParameter('pimcore.documents.web_to_print.default_controller_print_container');
-                }
-                if ($request->get('inheritanceSource')) {
-                    $createValues['contentMasterDocumentId'] = $request->get('inheritanceSource');
-                }
-                switch ($request->get('type')) {
-                    case 'page':
-                        $document = Document\Page::create($request->get('parentId'), $createValues, false);
-                        $document->setTitle($request->get('title', null));
-                        $document->setProperty('navigation_name', 'text', $request->get('name', null), false, false);
-                        $document->save();
-                        $success = true;
-                        break;
-                    case 'snippet':
-                        $document = Document\Snippet::create($request->get('parentId'), $createValues);
-                        $success = true;
-                        break;
-                    case 'email': //ckogler
-                        $document = Document\Email::create($request->get('parentId'), $createValues);
-                        $success = true;
-                        break;
-                    case 'link':
-                        $document = Document\Link::create($request->get('parentId'), $createValues);
-                        $success = true;
-                        break;
-                    case 'hardlink':
-                        $document = Document\Hardlink::create($request->get('parentId'), $createValues);
-                        $success = true;
-                        break;
-                    case 'folder':
-                        $document = Document\Folder::create($request->get('parentId'), $createValues);
-                        $document->setPublished(true);
-                        try {
-                            $document->save();
-                            $success = true;
-                        } catch (\Exception $e) {
-                            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                        }
-                        break;
-                    default:
-                        $classname = '\\Pimcore\\Model\\Document\\' . ucfirst($request->get('type'));
-                        if (!\Pimcore\Tool::classExists($classname)) {
-                            $oldStyleClass = '\\Document_' . ucfirst($request->get('type'));
-                            if (\Pimcore\Tool::classExists($oldStyleClass)) {
-                                $classname = $oldStyleClass;
-                            }
-                        }
-                        if (Tool::classExists($classname)) {
-                            $document = $classname::create($request->get('parentId'), $createValues);
-                            try {
-                                $document->save();
-                                $success = true;
-                            } catch (\Exception $e) {
-                                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                            }
-                            break;
-                        } else {
-                            Logger::debug("Unknown document type, can't add [ " . $request->get('type') . ' ] ');
-                        }
-                        break;
-                }
-            } else {
-                $errorMessage = "prevented adding a document because document with same path+key [ $intendedPath ] already exists";
-                Logger::debug($errorMessage);
-            }
-        } else {
-            $errorMessage = 'prevented adding a document because of missing permissions';
-            Logger::debug($errorMessage);
-        }
-        if ($success && $document instanceof Document) {
-            if ($request->get('translationsBaseDocument')) {
-                $translationsBaseDocument = Document::getById($request->get('translationsBaseDocument'));
-                $properties = $translationsBaseDocument->getProperties();
-                $properties = array_merge($properties, $document->getProperties());
-                $document->setProperties($properties);
-                $document->setProperty('language', 'text', $request->get('language'), false, true);
-                $document->save();
-                $service = new Document\Service();
-                $service->addTranslation($translationsBaseDocument, $document);
-            }
-            return $this->adminJson([
-                'success' => $success,
-                'id' => $document->getId(),
-                'type' => $document->getType(),
-            ]);
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'message' => $errorMessage,
-        ]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_document_document_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteAction(Request $request)
-    {
-        if ($request->get('type') == 'childs') {
-            $parentDocument = Document::getById($request->get('id'));
-            $list = new Document\Listing();
-            $list->setCondition('path LIKE ?', [$list->escapeLike($parentDocument->getRealFullPath()) . '/%']);
-            $list->setLimit((int)$request->get('amount'));
-            $list->setOrderKey('LENGTH(path)', false);
-            $list->setOrder('DESC');
-            $documents = $list->load();
-            $deletedItems = [];
-            foreach ($documents as $document) {
-                $deletedItems[$document->getId()] = $document->getRealFullPath();
-                if ($document->isAllowed('delete') && !$document->isLocked()) {
-                    $document->delete();
-                }
-            }
-            return $this->adminJson(['success' => true, 'deleted' => $deletedItems]);
-        } elseif ($request->get('id')) {
-            $document = Document::getById($request->get('id'));
-            if ($document && $document->isAllowed('delete')) {
-                try {
-                    if ($document->isLocked()) {
-                        throw new \Exception('prevented deleting document, because it is locked: ID: ' . $document->getId());
-                    }
-                    $document->delete();
-                    return $this->adminJson(['success' => true]);
-                } catch (\Exception $e) {
-                    Logger::err($e);
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            }
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/update", name="pimcore_admin_document_document_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function updateAction(Request $request)
-    {
-        $success = false;
-        $allowUpdate = true;
-        $document = Document::getById($request->get('id'));
-        $oldPath = $document->getDao()->getCurrentFullPath();
-        $oldDocument = Document::getById($document->getId(), true);
-        if ($document instanceof Document\PageSnippet) {
-            $latestVersion = $document->getLatestVersion();
-            if ($latestVersion && $latestVersion->getData()->getModificationDate() != $document->getModificationDate()) {
-                return $this->adminJson(['success' => false, 'message' => "You can't rename or relocate if there's a newer not published version"]);
-            }
-        }
-        if ($document->isAllowed('settings')) {
-            if ($request->get('parentId')) {
-                $parentDocument = Document::getById($request->get('parentId'));
-                if ($document->getParentId() != $parentDocument->getId()) {
-                    if (!$parentDocument->isAllowed('create')) {
-                        throw new \Exception('Prevented moving document - no create permission on new parent ');
-                    }
-                    $intendedPath = $parentDocument->getRealPath();
-                    $pKey = $parentDocument->getKey();
-                    if (!empty($pKey)) {
-                        $intendedPath .= $parentDocument->getKey() . '/';
-                    }
-                    $documentWithSamePath = Document::getByPath($intendedPath . $document->getKey());
-                    if ($documentWithSamePath != null) {
-                        $allowUpdate = false;
-                    }
-                    if ($document->isLocked()) {
-                        $allowUpdate = false;
-                    }
-                }
-            }
-            if ($allowUpdate) {
-                $blockedVars = ['controller', 'action', 'module'];
-                if (!$document->isAllowed('rename') && $request->get('key')) {
-                    $blockedVars[] = 'key';
-                    Logger::debug('prevented renaming document because of missing permissions ');
-                }
-                $updateData = array_merge($request->request->all(), $request->query->all());
-                foreach ($updateData as $key => $value) {
-                    if (!in_array($key, $blockedVars)) {
-                        $document->setValue($key, $value);
-                    }
-                }
-                $document->setUserModification($this->getAdminUser()->getId());
-                try {
-                    $document->save();
-                    if ($request->get('index') !== null) {
-                        $this->updateIndexesOfDocumentSiblings($document, $request->get('index'));
-                    }
-                    $success = true;
-                    $this->createRedirectForFormerPath($request, $document, $oldPath, $oldDocument);
-                } catch (\Exception $e) {
-                    return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-                }
-            } else {
-                $msg = 'Prevented moving document, because document with same path+key already exists or the document is locked. ID: ' . $document->getId();
-                Logger::debug($msg);
-                return $this->adminJson(['success' => false, 'message' => $msg]);
-            }
-        } elseif ($document->isAllowed('rename') && $request->get('key')) {
-            try {
-                $document->setKey($request->get('key'));
-                $document->setUserModification($this->getAdminUser()->getId());
-                $document->save();
-                $success = true;
-                $this->createRedirectForFormerPath($request, $document, $oldPath, $oldDocument);
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        } else {
-            Logger::debug('Prevented update document, because of missing permissions.');
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    private function createRedirectForFormerPath(Request $request, Document $document, string $oldPath, Document $oldDocument)
-    {
-        if ($document instanceof Document\Page || $document instanceof Document\Hardlink) {
-            if ($request->get('create_redirects') === 'true' && $this->getAdminUser()->isAllowed('redirects')) {
-                if ($oldPath && $oldPath != $document->getRealFullPath()) {
-                    $sourceSite = Frontend::getSiteForDocument($oldDocument);
-                    if ($sourceSite) {
-                        $oldPath = preg_replace('@^' . preg_quote($sourceSite->getRootPath(), '@') . '@', '', $oldPath);
-                    }
-                    $targetSite = Frontend::getSiteForDocument($document);
-                    $this->doCreateRedirectForFormerPath($oldPath, $document->getId(), $sourceSite, $targetSite);
-                    if ($document->hasChildren()) {
-                        $list = new Document\Listing();
-                        $list->setCondition('path LIKE :path', [
-                            'path' => $list->escapeLike($document->getRealFullPath()) . '/%',
-                        ]);
-                        $childrenList = $list->loadIdPathList();
-                        $count = 0;
-                        foreach ($childrenList as $child) {
-                            $source = preg_replace('@^' . preg_quote($document->getRealFullPath(), '@') . '@', $oldDocument, $child['path']);
-                            if ($sourceSite) {
-                                $source = preg_replace('@^' . preg_quote($sourceSite->getRootPath(), '@') . '@', '', $source);
-                            }
-                            $target = $child['id'];
-                            $this->doCreateRedirectForFormerPath($source, $target, $sourceSite, $targetSite);
-                            $count++;
-                            if ($count % 10 === 0) {
-                                \Pimcore::collectGarbage();
-                            }
-                        }
-                    }
-                }
-            }
-        }
-    }
-    private function doCreateRedirectForFormerPath(string $source, int $targetId, ?Site $sourceSite, ?Site $targetSite)
-    {
-        $redirect = new Redirect();
-        $redirect->setType(Redirect::TYPE_AUTO_CREATE);
-        $redirect->setRegex(false);
-        $redirect->setTarget($targetId);
-        $redirect->setSource($source);
-        $redirect->setStatusCode(301);
-        $redirect->setExpiry(time() + 86400 * 365); // this entry is removed automatically after 1 year
-        if ($sourceSite) {
-            $redirect->setSourceSite($sourceSite->getId());
-        }
-        if ($targetSite) {
-            $redirect->setTargetSite($targetSite->getId());
-        }
-        $redirect->save();
-    }
-    /**
-     * @param Document $document
-     * @param int $newIndex
-     */
-    protected function updateIndexesOfDocumentSiblings(Document $document, $newIndex)
-    {
-        $updateLatestVersionIndex = function ($document, $newIndex) {
-            if ($document instanceof Document\PageSnippet && $latestVersion = $document->getLatestVersion()) {
-                $document = $latestVersion->loadData();
-                $document->setIndex($newIndex);
-                $latestVersion->save();
-            }
-        };
-        $newIndex = (int)$newIndex;
-        $document->saveIndex($newIndex);
-        $list = new Document\Listing();
-        $list->setCondition('parentId = ? AND id != ?', [$document->getParentId(), $document->getId()]);
-        $list->setOrderKey('index');
-        $list->setOrder('asc');
-        $childsList = $list->load();
-        $count = 0;
-        foreach ($childsList as $child) {
-            if ($count == $newIndex) {
-                $count++;
-            }
-            $child->saveIndex($count);
-            $updateLatestVersionIndex($child, $count);
-            $count++;
-        }
-    }
-    /**
-     * @Route("/doc-types", name="pimcore_admin_document_document_doctypesget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function docTypesGetAction(Request $request)
-    {
-        $list = new Document\DocType\Listing();
-        $list->load();
-        $docTypes = [];
-        foreach ($list->getDocTypes() as $type) {
-            if ($this->getAdminUser()->isAllowed($type->getId(), 'docType')) {
-                $docTypes[] = $type->getObjectVars();
-            }
-        }
-        return $this->adminJson(['data' => $docTypes, 'success' => true, 'total' => count($docTypes)]);
-    }
-    /**
-     * @Route("/doc-types", name="pimcore_admin_document_document_doctypes", methods={"PUT", "POST","DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function docTypesAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $this->checkPermission('document_types');
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'];
-                $type = Document\DocType::getById($id);
-                $type->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $data = $this->decodeJson($request->get('data'));
-                $type = Document\DocType::getById($data['id']);
-                $type->setValues($data);
-                $type->save();
-                return $this->adminJson(['data' => $type->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $data = $this->decodeJson($request->get('data'));
-                unset($data['id']);
-                $type = Document\DocType::create();
-                $type->setValues($data);
-                $type->save();
-                return $this->adminJson(['data' => $type->getObjectVars(), 'success' => true]);
-            }
-        }
-        return $this->adminJson(false);
-    }
-    /**
-     * @Route("/get-doc-types", name="pimcore_admin_document_document_getdoctypes", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDocTypesAction(Request $request)
-    {
-        $list = new Document\DocType\Listing();
-        if ($request->get('type')) {
-            $type = $request->get('type');
-            if (Document\Service::isValidType($type)) {
-                $list->setFilter(function ($row) use ($type) {
-                    if ($row['type'] == $type) {
-                        return true;
-                    }
-                    return false;
-                });
-            }
-        }
-        $list->load();
-        $docTypes = [];
-        foreach ($list->getDocTypes() as $type) {
-            $docTypes[] = $type->getObjectVars();
-        }
-        return $this->adminJson(['docTypes' => $docTypes]);
-    }
-    /**
-     * @Route("/version-to-session", name="pimcore_admin_document_document_versiontosession", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function versionToSessionAction(Request $request)
-    {
-        $version = Version::getById($request->get('id'));
-        $document = $version->loadData();
-        Document\Service::saveElementToSession($document);
-        return new Response();
-    }
-    /**
-     * @Route("/publish-version", name="pimcore_admin_document_document_publishversion", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function publishVersionAction(Request $request)
-    {
-        $this->versionToSessionAction($request);
-        $version = Version::getById($request->get('id'));
-        $document = $version->loadData();
-        $currentDocument = Document::getById($document->getId());
-        if ($currentDocument->isAllowed('publish')) {
-            $document->setPublished(true);
-            try {
-                $document->setKey($currentDocument->getKey());
-                $document->setPath($currentDocument->getRealPath());
-                $document->setUserModification($this->getAdminUser()->getId());
-                $document->save();
-            } catch (\Exception $e) {
-                return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-            }
-        }
-        $this->addAdminStyle($document, ElementAdminStyleEvent::CONTEXT_EDITOR, $treeData);
-        return $this->adminJson(['success' => true, 'treeData' => $treeData]);
-    }
-    /**
-     * @Route("/update-site", name="pimcore_admin_document_document_updatesite", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updateSiteAction(Request $request)
-    {
-        $domains = $request->get('domains');
-        $domains = str_replace(' ', '', $domains);
-        $domains = explode("\n", $domains);
-        if (!$site = Site::getByRootId((int)$request->get('id'))) {
-            $site = Site::create([
-                'rootId' => (int)$request->get('id'),
-            ]);
-        }
-        $site->setDomains($domains);
-        $site->setMainDomain($request->get('mainDomain'));
-        $site->setErrorDocument($request->get('errorDocument'));
-        $site->setRedirectToMainDomain(($request->get('redirectToMainDomain') == 'true') ? true : false);
-        $site->save();
-        $site->setRootDocument(null); // do not send the document to the frontend
-        return $this->adminJson($site->getObjectVars());
-    }
-    /**
-     * @Route("/remove-site", name="pimcore_admin_document_document_removesite", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function removeSiteAction(Request $request)
-    {
-        $site = Site::getByRootId((int)$request->get('id'));
-        $site->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/copy-info", name="pimcore_admin_document_document_copyinfo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyInfoAction(Request $request)
-    {
-        $transactionId = time();
-        $pasteJobs = [];
-        Session::useSession(function (AttributeBagInterface $session) use ($transactionId) {
-            $session->set($transactionId, ['idMapping' => []]);
-        }, 'pimcore_copy');
-        if ($request->get('type') == 'recursive' || $request->get('type') == 'recursive-update-references') {
-            $document = Document::getById($request->get('sourceId'));
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_document_document_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => 'child',
-                    'language' => $request->get('language'),
-                    'enableInheritance' => $request->get('enableInheritance'),
-                    'transactionId' => $transactionId,
-                    'saveParentId' => true,
-                    'resetIndex' => true,
-                ],
-            ]];
-            $childIds = [];
-            if ($document->hasChildren()) {
-                $list = new Document\Listing();
-                $list->setCondition('path LIKE ?', [$list->escapeLike($document->getRealFullPath()) . '/%']);
-                $list->setOrderKey('LENGTH(path)', false);
-                $list->setOrder('ASC');
-                $childIds = $list->loadIdList();
-                if (count($childIds) > 0) {
-                    foreach ($childIds as $id) {
-                        $pasteJobs[] = [[
-                            'url' => $this->generateUrl('pimcore_admin_document_document_copy'),
-                            'method' => 'POST',
-                            'params' => [
-                                'sourceId' => $id,
-                                'targetParentId' => $request->get('targetId'),
-                                'sourceParentId' => $request->get('sourceId'),
-                                'type' => 'child',
-                                'language' => $request->get('language'),
-                                'enableInheritance' => $request->get('enableInheritance'),
-                                'transactionId' => $transactionId,
-                            ],
-                        ]];
-                    }
-                }
-            }
-            if ($request->get('type') == 'recursive-update-references') {
-                for ($i = 0; $i < (count($childIds) + 1); $i++) {
-                    $pasteJobs[] = [[
-                        'url' => $this->generateUrl('pimcore_admin_document_document_copyrewriteids'),
-                        'method' => 'PUT',
-                        'params' => [
-                            'transactionId' => $transactionId,
-                            'enableInheritance' => $request->get('enableInheritance'),
-                            '_dc' => uniqid(),
-                        ],
-                    ]];
-                }
-            }
-        } elseif ($request->get('type') == 'child' || $request->get('type') == 'replace') {
-            $pasteJobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_document_document_copy'),
-                'method' => 'POST',
-                'params' => [
-                    'sourceId' => $request->get('sourceId'),
-                    'targetId' => $request->get('targetId'),
-                    'type' => $request->get('type'),
-                    'language' => $request->get('language'),
-                    'enableInheritance' => $request->get('enableInheritance'),
-                    'transactionId' => $transactionId,
-                    'resetIndex' => ($request->get('type') == 'child'),
-                ],
-            ]];
-        }
-        return $this->adminJson([
-            'pastejobs' => $pasteJobs,
-        ]);
-    }
-    /**
-     * @Route("/copy-rewrite-ids", name="pimcore_admin_document_document_copyrewriteids", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyRewriteIdsAction(Request $request)
-    {
-        $transactionId = $request->get('transactionId');
-        $idStore = Session::useSession(function (AttributeBagInterface $session) use ($transactionId) {
-            return $session->get($transactionId);
-        }, 'pimcore_copy');
-        if (!array_key_exists('rewrite-stack', $idStore)) {
-            $idStore['rewrite-stack'] = array_values($idStore['idMapping']);
-        }
-        $id = array_shift($idStore['rewrite-stack']);
-        $document = Document::getById($id);
-        if ($document) {
-            $rewriteConfig = ['document' => $idStore['idMapping']];
-            $document = Document\Service::rewriteIds($document, $rewriteConfig, [
-                'enableInheritance' => ($request->get('enableInheritance') == 'true') ? true : false,
-            ]);
-            $document->setUserModification($this->getAdminUser()->getId());
-            $document->save();
-        }
-        Session::useSession(function (AttributeBagInterface $session) use ($transactionId, $idStore) {
-            $session->set($transactionId, $idStore);
-        }, 'pimcore_copy');
-        return $this->adminJson([
-            'success' => true,
-            'id' => $id,
-        ]);
-    }
-    /**
-     * @Route("/copy", name="pimcore_admin_document_document_copy", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function copyAction(Request $request)
-    {
-        $success = false;
-        $sourceId = (int)$request->get('sourceId');
-        $source = Document::getById($sourceId);
-        $session = Session::get('pimcore_copy');
-        $targetId = (int)$request->get('targetId');
-        $sessionBag = $session->get($request->get('transactionId'));
-        if ($request->get('targetParentId')) {
-            $sourceParent = Document::getById($request->get('sourceParentId'));
-            if ($sessionBag['parentId']) {
-                $targetParent = Document::getById($sessionBag['parentId']);
-            } else {
-                $targetParent = Document::getById($request->get('targetParentId'));
-            }
-            $targetPath = preg_replace('@^' . $sourceParent->getRealFullPath() . '@', $targetParent . '/', $source->getRealPath());
-            $target = Document::getByPath($targetPath);
-        } else {
-            $target = Document::getById($targetId);
-        }
-        if ($target instanceof Document) {
-            if ($target->isAllowed('create')) {
-                if ($source != null) {
-                    if ($source instanceof Document\PageSnippet && $latestVersion = $source->getLatestVersion()) {
-                        $source = $latestVersion->loadData();
-                        $source->setPublished(false); //as latest version is used which is not published
-                    }
-                    if ($request->get('type') == 'child') {
-                        $enableInheritance = ($request->get('enableInheritance') == 'true') ? true : false;
-                        $language = false;
-                        if (Tool::isValidLanguage($request->get('language'))) {
-                            $language = $request->get('language');
-                        }
-                        $resetIndex = ($request->get('resetIndex') == 'true') ? true : false;
-                        $newDocument = $this->_documentService->copyAsChild($target, $source, $enableInheritance, $resetIndex, $language);
-                        $sessionBag['idMapping'][(int)$source->getId()] = (int)$newDocument->getId();
-                        if ($request->get('saveParentId')) {
-                            $sessionBag['parentId'] = $newDocument->getId();
-                        }
-                        $session->set($request->get('transactionId'), $sessionBag);
-                        Session::writeClose();
-                    } elseif ($request->get('type') == 'replace') {
-                        $this->_documentService->copyContents($target, $source);
-                    }
-                    $success = true;
-                } else {
-                    Logger::error('prevended copy/paste because document with same path+key already exists in this location');
-                }
-            } else {
-                Logger::error('could not execute copy/paste because of missing permissions on target [ ' . $targetId . ' ]');
-                throw $this->createAccessDeniedHttpException();
-            }
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/diff-versions/from/{from}/to/{to}", name="pimcore_admin_document_document_diffversions", requirements={"from": "\d+", "to": "\d+"}, methods={"GET"})
-     *
-     * @param Request $request
-     * @param int $from
-     * @param int $to
-     *
-     * @return Response
-     */
-    public function diffVersionsAction(Request $request, $from, $to)
-    {
-        if (!HtmlToImage::isSupported() || !class_exists('Imagick')) {
-            return $this->render('@PimcoreAdmin/Admin/Document/Document/diff-versions-unsupported.html.twig');
-        }
-        $versionFrom = Version::getById($from);
-        $docFrom = $versionFrom->loadData();
-        $prefix = $request->getSchemeAndHttpHost() . $docFrom->getRealFullPath() . '?pimcore_version=';
-        $fromUrl = $prefix . $from;
-        $toUrl = $prefix . $to;
-        $toFileId = uniqid();
-        $fromFileId = uniqid();
-        $diffFileId = uniqid();
-        $fromFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/version-diff-tmp-' . $fromFileId . '.png';
-        $toFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/version-diff-tmp-' . $toFileId . '.png';
-        $diffFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/version-diff-tmp-' . $diffFileId . '.png';
-        $viewParams = [];
-        HtmlToImage::convert($fromUrl, $fromFile);
-        HtmlToImage::convert($toUrl, $toFile);
-        $image1 = new \Imagick($fromFile);
-        $image2 = new \Imagick($toFile);
-        if ($image1->getImageWidth() == $image2->getImageWidth() && $image1->getImageHeight() == $image2->getImageHeight()) {
-            $result = $image1->compareImages($image2, \Imagick::METRIC_MEANSQUAREERROR);
-            $result[0]->setImageFormat('png');
-            $result[0]->writeImage($diffFile);
-            $result[0]->clear();
-            $result[0]->destroy();
-            $viewParams['image'] = $diffFileId;
-        } else {
-            $viewParams['image1'] = $fromFileId;
-            $viewParams['image2'] = $toFileId;
-        }
-        $image1->clear();
-        $image1->destroy();
-        $image2->clear();
-        $image2->destroy();
-        return $this->render('@PimcoreAdmin/Admin/Document/Document/diff-versions.html.twig', $viewParams);
-    }
-    /**
-     * @Route("/diff-versions-image", name="pimcore_admin_document_document_diffversionsimage", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function diffVersionsImageAction(Request $request)
-    {
-        $file = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/version-diff-tmp-' . $request->get('id') . '.png';
-        if (file_exists($file)) {
-            $response = new BinaryFileResponse($file);
-            $response->headers->set('Content-Type', 'image/png');
-            return $response;
-        }
-        throw $this->createNotFoundException('Version diff file not found');
-    }
-    /**
-     * @Route("/get-id-for-path", name="pimcore_admin_document_document_getidforpath", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getIdForPathAction(Request $request)
-    {
-        if ($doc = Document::getByPath($request->get('path'))) {
-            return $this->adminJson([
-                'id' => $doc->getId(),
-                'type' => $doc->getType(),
-            ]);
-        } else {
-            return $this->adminJson(false);
-        }
-    }
-    /**
-     * SEO PANEL
-     */
-    /**
-     * @Route("/seopanel-tree-root", name="pimcore_admin_document_document_seopaneltreeroot", methods={"GET"})
-     *
-     * @param DocumentRouteHandler $documentRouteHandler
-     *
-     * @return JsonResponse
-     */
-    public function seopanelTreeRootAction(DocumentRouteHandler $documentRouteHandler)
-    {
-        $this->checkPermission('seo_document_editor');
-        /** @var Document\Page $root */
-        $root = Document\Page::getById(1);
-        if ($root->isAllowed('list')) {
-            $documentRouteHandler->setForceHandleUnpublishedDocuments(true);
-            $nodeConfig = $this->getSeoNodeConfig($root);
-            return $this->adminJson($nodeConfig);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/seopanel-tree", name="pimcore_admin_document_document_seopaneltree", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     * @param DocumentRouteHandler $documentRouteHandler
-     *
-     * @return JsonResponse
-     */
-    public function seopanelTreeAction(
-        Request $request,
-        EventDispatcherInterface $eventDispatcher,
-        DocumentRouteHandler $documentRouteHandler
-    ) {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $filterPrepareEvent = new GenericEvent($this, [
-            'requestParams' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($filterPrepareEvent, AdminEvents::DOCUMENT_LIST_BEFORE_FILTER_PREPARE);
-        $allParams = $filterPrepareEvent->getArgument('requestParams');
-        $this->checkPermission('seo_document_editor');
-        $documentRouteHandler->setForceHandleUnpublishedDocuments(true);
-        $document = Document::getById($allParams['node']);
-        $documents = [];
-        if ($document->hasChildren()) {
-            $list = new Document\Listing();
-            $list->setCondition('parentId = ?', $document->getId());
-            $list->setOrderKey('index');
-            $list->setOrder('asc');
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $list,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::DOCUMENT_LIST_BEFORE_LIST_LOAD);
-            /** @var Document\Listing $list */
-            $list = $beforeListLoadEvent->getArgument('list');
-            $childsList = $list->load();
-            foreach ($childsList as $childDocument) {
-                if ($childDocument->isAllowed('list')) {
-                    $list = new Document\Listing();
-                    $list->setCondition('path LIKE ? and type = ?', [$list->escapeLike($childDocument->getRealFullPath()). '/%', 'page']);
-                    if ($childDocument instanceof Document\Page || $list->getTotalCount() > 0) {
-                        $documents[] = $this->getSeoNodeConfig($childDocument);
-                    }
-                }
-            }
-        }
-        $result = ['data' => $documents, 'success' => true, 'total' => count($documents)];
-        $afterListLoadEvent = new GenericEvent($this, [
-            'list' => $result,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::DOCUMENT_LIST_AFTER_LIST_LOAD);
-        $result = $afterListLoadEvent->getArgument('list');
-        return $this->adminJson($result['data']);
-    }
-    /**
-     * @Route("/language-tree", name="pimcore_admin_document_document_languagetree", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function languageTreeAction(Request $request)
-    {
-        $document = Document::getById($request->query->get('node'));
-        $service = new Document\Service();
-        $languages = explode(',', $request->get('languages'));
-        $result = [];
-        foreach ($document->getChildren() as $child) {
-            $result[] = $this->getTranslationTreeNodeConfig($child, $languages);
-        }
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/language-tree-root", name="pimcore_admin_document_document_languagetreeroot", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function languageTreeRootAction(Request $request)
-    {
-        $document = Document::getById($request->query->get('id'));
-        if (!$document) {
-            return $this->adminJson([
-                'success' => false,
-            ]);
-        }
-        $service = new Document\Service();
-        $locales = Tool::getSupportedLocales();
-        $lang = $document->getProperty('language');
-        $columns = [
-            [
-                'xtype' => 'treecolumn',
-                'text' => $lang ? $locales[$lang] : '',
-                'dataIndex' => 'text',
-                'cls' => $lang ? 'x-column-header_' . strtolower($lang) : null,
-                'width' => 300,
-                'sortable' => false,
-            ],
-        ];
-        $translations = $service->getTranslations($document);
-        $combinedTranslations = $translations;
-        if ($parentDocument = $document->getParent()) {
-            $parentTranslations = $service->getTranslations($parentDocument);
-            foreach ($parentTranslations as $language => $languageDocumentId) {
-                $combinedTranslations[$language] = $translations[$language] ?? $languageDocumentId;
-            }
-        }
-        foreach ($combinedTranslations as $language => $languageDocumentId) {
-            $languageDocument = Document::getById($languageDocumentId);
-            if ($languageDocument && $languageDocument->isAllowed('list') && $language != $document->getProperty('language')) {
-                $columns[] = [
-                    'text' => $locales[$language],
-                    'dataIndex' => $language,
-                    'cls' => 'x-column-header_' . strtolower($language),
-                    'width' => 300,
-                    'sortable' => false,
-                ];
-            }
-        }
-        return $this->adminJson([
-            'root' => $this->getTranslationTreeNodeConfig($document, array_keys($translations), $translations),
-            'columns' => $columns,
-            'languages' => array_keys($translations),
-        ]);
-    }
-    private function getTranslationTreeNodeConfig($document, array $languages, array $translations = null)
-    {
-        $service = new Document\Service();
-        $config = $this->getTreeNodeConfig($document);
-        $translations = is_null($translations) ? $service->getTranslations($document) : $translations;
-        foreach ($languages as $language) {
-            if ($languageDocument = $translations[$language] ?? false) {
-                $languageDocument = Document::getById($languageDocument);
-                $config[$language] = [
-                    'text' => $languageDocument->getKey(),
-                    'id' => $languageDocument->getId(),
-                    'type' => $languageDocument->getType(),
-                    'fullPath' => $languageDocument->getFullPath(),
-                    'published' => $languageDocument->getPublished(),
-                    'itemType' => 'document',
-                    'permissions' => $languageDocument->getUserPermissions(),
-                ];
-            } elseif (!$document instanceof Document\Folder) {
-                $config[$language] = [
-                    'text' => '--',
-                    'itemType' => 'empty',
-                ];
-            }
-        }
-        return $config;
-    }
-    /**
-     * @Route("/convert", name="pimcore_admin_document_document_convert", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function convertAction(Request $request)
-    {
-        $document = Document::getById($request->get('id'));
-        $type = $request->get('type');
-        $class = '\\Pimcore\\Model\\Document\\' . ucfirst($type);
-        if (Tool::classExists($class)) {
-            $new = new $class;
-            \Pimcore\Cache\Runtime::set('document_' . $document->getId(), $new);
-            $props = $document->getObjectVars();
-            foreach ($props as $name => $value) {
-                $new->setValue($name, $value);
-            }
-            if ($type == 'hardlink' || $type == 'folder') {
-                foreach (['name', 'title', 'target', 'exclude', 'class', 'anchor', 'parameters', 'relation', 'accesskey', 'tabindex'] as $propertyName) {
-                    $new->removeProperty('navigation_' . $propertyName);
-                }
-            }
-            $new->setType($type);
-            $new->save();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/translation-determine-parent", name="pimcore_admin_document_document_translationdetermineparent", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function translationDetermineParentAction(Request $request)
-    {
-        $success = false;
-        $targetDocument = null;
-        $document = Document::getById($request->get('id'));
-        if ($document) {
-            $service = new Document\Service;
-            $document = $document->getId() === 1 ? $document : $document->getParent();
-            $translations = $service->getTranslations($document);
-            if (isset($translations[$request->get('language')])) {
-                $targetDocument = Document::getById($translations[$request->get('language')]);
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'targetPath' => $targetDocument ? $targetDocument->getRealFullPath() : null,
-            'targetId' => $targetDocument ? $targetDocument->getid() : null,
-        ]);
-    }
-    /**
-     * @Route("/translation-add", name="pimcore_admin_document_document_translationadd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function translationAddAction(Request $request)
-    {
-        $sourceDocument = Document::getById($request->get('sourceId'));
-        $targetDocument = Document::getByPath($request->get('targetPath'));
-        if ($sourceDocument && $targetDocument) {
-            if (empty($sourceDocument->getProperty('language'))) {
-                throw new \Exception(sprintf('Source Document(ID:%s) Language(Properties) missing', $sourceDocument->getId()));
-            }
-            if (empty($targetDocument->getProperty('language'))) {
-                throw new \Exception(sprintf('Target Document(ID:%s) Language(Properties) missing', $sourceDocument->getId()));
-            }
-            $service = new Document\Service;
-            if ($service->getTranslationSourceId($targetDocument) != $targetDocument->getId()) {
-                throw new \Exception('Target Document already linked to Source Document ID('.$service->getTranslationSourceId($targetDocument).'). Please unlink existing relation first.');
-            }
-            $service->addTranslation($sourceDocument, $targetDocument);
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/translation-remove", name="pimcore_admin_document_document_translationremove", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function translationRemoveAction(Request $request)
-    {
-        $sourceDocument = Document::getById($request->get('sourceId'));
-        $targetDocument = Document::getById($request->get('targetId'));
-        if ($sourceDocument && $targetDocument) {
-            $service = new Document\Service;
-            $service->removeTranslationLink($sourceDocument, $targetDocument);
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/translation-check-language", name="pimcore_admin_document_document_translationchecklanguage", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function translationCheckLanguageAction(Request $request)
-    {
-        $success = false;
-        $language = null;
-        $translationLinks = null;
-        $document = Document::getByPath($request->get('path'));
-        if ($document) {
-            $language = $document->getProperty('language');
-            if ($language) {
-                $success = true;
-            }
-            $translationLinks = array_keys($this->_documentService->getTranslations($document));
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'language' => $language,
-            'translationLinks' => $translationLinks,
-        ]);
-    }
-    /**
-     * @param Document\Page $document
-     *
-     * @return array
-     */
-    private function getSeoNodeConfig($document)
-    {
-        $nodeConfig = $this->getTreeNodeConfig($document);
-        if (method_exists($document, 'getTitle') && method_exists($document, 'getDescription')) {
-            $nodeConfig['prettyUrl'] = $document->getPrettyUrl();
-            $title = $document->getTitle();
-            $description = $document->getDescription();
-            $nodeConfig['title'] = $title;
-            $nodeConfig['description'] = $description;
-            $nodeConfig['title_length'] = mb_strlen($title);
-            $nodeConfig['description_length'] = mb_strlen($description);
-        }
-        return $nodeConfig;
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'documents', ['docTypesGetAction']);
-        $this->_documentService = new Document\Service($this->getAdminUser());
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/DocumentControllerBase.php
+++ b//dev/null
@@ -1,285 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\ApplySchedulerDataTrait;
-use Pimcore\Bundle\AdminBundle\Controller\Traits\DocumentTreeConfigTrait;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Logger;
-use Pimcore\Model;
-use Pimcore\Model\Document\Targeting\TargetingDocumentInterface;
-use Pimcore\Model\Element;
-use Pimcore\Model\Property;
-use Pimcore\Model\Version;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-/**
- * @internal
- */
-abstract class DocumentControllerBase extends AdminController implements KernelControllerEventInterface
-{
-    use ApplySchedulerDataTrait;
-    use DocumentTreeConfigTrait;
-    protected function preSendDataActions(&$data, Model\Document $document, ?Version $draftVersion = null)
-    {
-        $documentFromDatabase = Model\Document::getById($document->getId(), true);
-        $data['versionDate'] = $documentFromDatabase->getModificationDate();
-        $data['userPermissions'] = $document->getUserPermissions();
-        $data['idPath'] = Element\Service::getIdPath($document);
-        $data['php'] = [
-            'classes' => array_merge([get_class($document)], array_values(class_parents($document))),
-            'interfaces' => array_values(class_implements($document)),
-        ];
-        $this->addAdminStyle($document, ElementAdminStyleEvent::CONTEXT_EDITOR, $data);
-        if ($draftVersion && $documentFromDatabase->getModificationDate() < $draftVersion->getDate()) {
-            $data['draft'] = [
-                'id' => $draftVersion->getId(),
-                'modificationDate' => $draftVersion->getDate(),
-            ];
-        }
-        $event = new GenericEvent($this, [
-            'data' => $data,
-            'document' => $document,
-        ]);
-        \Pimcore::getEventDispatcher()->dispatch($event, AdminEvents::DOCUMENT_GET_PRE_SEND_DATA);
-        $data = $event->getArgument('data');
-    }
-    /**
-     * @param Request $request
-     * @param Model\Document $document
-     */
-    protected function addPropertiesToDocument(Request $request, Model\Document $document)
-    {
-        if ($request->get('properties')) {
-            $properties = [];
-            foreach ($document->getProperties() as $p) {
-                if ($p->isInherited()) {
-                    $properties[$p->getName()] = $p;
-                }
-            }
-            $propertiesData = $this->decodeJson($request->get('properties'));
-            if (is_array($propertiesData)) {
-                foreach ($propertiesData as $propertyName => $propertyData) {
-                    $value = $propertyData['data'];
-                    try {
-                        $property = new Property();
-                        $property->setType($propertyData['type']);
-                        $property->setName($propertyName);
-                        $property->setCtype('document');
-                        $property->setDataFromEditmode($value);
-                        $property->setInheritable($propertyData['inheritable']);
-                        if ($propertyName == 'language') {
-                            $property->setInherited($this->getPropertyInheritance($document, $propertyName, $value));
-                        }
-                        $properties[$propertyName] = $property;
-                    } catch (\Exception $e) {
-                        Logger::warning("Can't add " . $propertyName . ' to document ' . $document->getRealFullPath());
-                    }
-                }
-            }
-            if ($document->isAllowed('properties')) {
-                $document->setProperties($properties);
-            }
-        }
-        $document->getProperties();
-    }
-    /**
-     * @param Request $request
-     * @param Model\Document $document
-     */
-    protected function addSettingsToDocument(Request $request, Model\Document $document)
-    {
-        if ($request->get('settings')) {
-            if ($document->isAllowed('settings')) {
-                $settings = $this->decodeJson($request->get('settings'));
-                $document->setValues($settings);
-            }
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Model\Document\PageSnippet $document
-     */
-    protected function addDataToDocument(Request $request, Model\Document\PageSnippet $document)
-    {
-        if ($request->get('appendEditables') || ($document instanceof TargetingDocumentInterface && $document->hasTargetGroupSpecificEditables())) {
-            $document->getEditables();
-        }
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            foreach ($data as $name => $value) {
-                $data = $value['data'] ?? null;
-                $type = $value['type'];
-                $document->setRawEditable($name, $type, $data);
-            }
-        }
-    }
-    /**
-     * @param Model\Document $document
-     * @param array $data
-     */
-    protected function addTranslationsData(Model\Document $document, array &$data)
-    {
-        $service = new Model\Document\Service;
-        $translations = $service->getTranslations($document);
-        $unlinkTranslations = $service->getTranslations($document, 'unlink');
-        $language = $document->getProperty('language');
-        unset($translations[$language], $unlinkTranslations[$language]);
-        $data['translations'] = $translations;
-        $data['unlinkTranslations'] = $unlinkTranslations;
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        if ($request->get('id')) {
-            $documentId = $request->get('id');
-            if (!$document = Model\Document\Service::getElementFromSession('document', $documentId)) {
-                $document = Model\Document::getById($request->get('id'));
-                $document = $this->getLatestVersion($document);
-            }
-            $document->setInDumpState(true);
-            $this->setValuesToDocument($request, $document);
-            Model\Document\Service::saveElementToSession($document);
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param Model\Document $doc
-     * @param bool $useForSave
-     */
-    protected function saveToSession($doc, $useForSave = false)
-    {
-        Model\Document\Service::saveElementToSession($doc);
-        if ($useForSave) {
-            Model\Document\Service::saveElementToSession($doc, '_useForSave');
-        }
-    }
-    /**
-     * @param Model\Document $doc
-     *
-     * @return Model\Document|null $sessionDocument
-     */
-    protected function getFromSession($doc)
-    {
-        $sessionDocument = null;
-        if ($doc instanceof Model\Document) {
-            if (($sessionDocument = Model\Document\Service::getElementFromSession('document', $doc->getId())) &&
-                ($documentForSave = Model\Document\Service::getElementFromSession('document', $doc->getId(), '_useForSave'))) {
-                Model\Document\Service::removeElementFromSession('document', $doc->getId(), '_useForSave');
-            }
-        }
-        return $sessionDocument;
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        Model\Document\Service::removeElementFromSession('document', $request->get('id'));
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param Model\Document $document
-     * @param array $data
-     */
-    protected function minimizeProperties($document, array &$data)
-    {
-        $data['properties'] = Model\Element\Service::minimizePropertiesForEditmode($document->getProperties());
-    }
-    /**
-     * @param Model\Document $document
-     * @param string $propertyName
-     * @param string $propertyValue
-     *
-     * @return bool
-     */
-    protected function getPropertyInheritance(Model\Document $document, $propertyName, $propertyValue)
-    {
-        if ($document->getParent()) {
-            return $propertyValue == $document->getParent()->getProperty($propertyName);
-        }
-        return false;
-    }
-    /**
-     * @param Model\Document\PageSnippet $document
-     * @param null|Version $draftVersion
-     *
-     * @return Model\Document\PageSnippet
-     */
-    protected function getLatestVersion(Model\Document\PageSnippet $document, &$draftVersion = null)
-    {
-        $latestVersion = $document->getLatestVersion($this->getUser()->getId());
-        if ($latestVersion) {
-            $latestDoc = $latestVersion->loadData();
-            if ($latestDoc instanceof Model\Document\PageSnippet) {
-                $draftVersion = $latestVersion;
-                return $latestDoc;
-            }
-        }
-        return $document;
-    }
-    /**
-     * This is used for pages and snippets to change the master document (which is not saved with the normal save button)
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        $doc = Model\Document::getById($request->get('id'));
-        if ($doc instanceof Model\Document\PageSnippet) {
-            $doc->setEditables([]);
-            $doc->setContentMasterDocumentId($request->get('contentMasterDocumentPath'));
-            $doc->saveVersion();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkPermission('documents');
-    }
-    /**
-     * @param Request $request
-     * @param Model\Document $page
-     */
-    abstract protected function setValuesToDocument(Request $request, Model\Document $page);
-    /**
-     * @param string $task
-     * @param Model\Document\Snippet $page
-     */
-    protected function handleTask($task, $page)
-    {
-        if ($task == 'publish' || $task == 'version') {
-            $page->deleteAutoSaveVersions($this->getUser()->getId());
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/EmailController.php
+++ b//dev/null
@@ -1,154 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/email")
- *
- * @internal
- */
-class EmailController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_email_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_email_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_email_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_email_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-            return $this->getEditLockResponse($request->get('id'), 'document');
-        }
-        Element\Editlock::lock($request->get('id'), 'document');
-        $email = Document\Email::getById($request->get('id'));
-        if (!$email) {
-            throw $this->createNotFoundException('Email not found');
-        }
-        $email = clone $email;
-        $draftVersion = null;
-        $email = $this->getLatestVersion($email, $draftVersion);
-        $versions = Element\Service::getSafeVersionInfo($email->getVersions());
-        $email->setVersions(array_splice($versions, -1, 1));
-        $email->setLocked($email->isLocked());
-        $email->setParent(null);
-        $email->setEditables(null);
-        $email->setChildren(null);
-        $data = $email->getObjectVars();
-        $this->addTranslationsData($email, $data);
-        $this->minimizeProperties($email, $data);
-        $data['url'] = $email->getUrl();
-        $this->preSendDataActions($data, $email, $draftVersion);
-        if ($email->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_email_save", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $page = Document\Email::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Email not found');
-        }
-        $page = $this->getLatestVersion($page);
-        $page->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('task') == 'unpublish') {
-            $page->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $page->setPublished(true);
-        }
-        if (($request->get('task') == 'publish' && $page->isAllowed('publish')) || ($request->get('task') == 'unpublish' && $page->isAllowed('unpublish'))) {
-            $this->setValuesToDocument($request, $page);
-            $page->save();
-            $this->saveToSession($page);
-            $treeData = $this->getTreeNodeConfig($page);
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $page->getModificationDate(),
-                    'versionCount' => $page->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } elseif ($page->isAllowed('save')) {
-            $this->setValuesToDocument($request, $page);
-            $version = $page->saveVersion(true, true, null, $request->get('task') == 'autoSave');
-            $this->saveToSession($page);
-            $draftData = [
-                'id' => $version->getId(),
-                'modificationDate' => $version->getDate(),
-            ];
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson(['success' => true, 'draft' => $draftData]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document $page
-     */
-    protected function setValuesToDocument(Request $request, Document $page)
-    {
-        $this->addSettingsToDocument($request, $page);
-        $this->addDataToDocument($request, $page);
-        $this->addPropertiesToDocument($request, $page);
-        $this->applySchedulerDataToElement($request, $page);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/FolderController.php
+++ b//dev/null
@@ -1,120 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/folder")
- *
- * @internal
- */
-class FolderController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_folder_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_folder_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_folder_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_folder_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        $folder = Document\Folder::getById($request->get('id'));
-        if (!$folder) {
-            throw $this->createNotFoundException('Folder not found');
-        }
-        if ($folder->isAllowed('save') || $folder->isAllowed('publish') || $folder->isAllowed('unpublish') || $folder->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $folder = clone $folder;
-        $folder->setLocked($folder->isLocked());
-        $folder->setParent(null);
-        $data = $folder->getObjectVars();
-        $this->addTranslationsData($folder, $data);
-        $this->minimizeProperties($folder, $data);
-        $this->preSendDataActions($data, $folder);
-        if ($folder->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_folder_save", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $folder = Document\Folder::getById($request->get('id'));
-        if (!$folder) {
-            throw $this->createNotFoundException('Folder not found');
-        }
-        $folder->setModificationDate(time());
-        $folder->setUserModification($this->getAdminUser()->getId());
-        if ($folder->isAllowed('publish')) {
-            $this->setValuesToDocument($request, $folder);
-            $folder->save();
-            $treeData = $this->getTreeNodeConfig($folder);
-            return $this->adminJson(['success' => true, 'treeData' => $treeData]);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param Request $request
-     * @param Document $folder
-     */
-    protected function setValuesToDocument(Request $request, Document $folder)
-    {
-        $this->addPropertiesToDocument($request, $folder);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/HardlinkController.php
+++ b//dev/null
@@ -1,148 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/hardlink")
- *
- * @internal
- */
-class HardlinkController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_hardlink_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_hardlink_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_hardlink_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_hardlink_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        $link = Document\Hardlink::getById($request->get('id'));
-        if (!$link) {
-            throw $this->createNotFoundException('Hardlink not found');
-        }
-        if ($link->isAllowed('save') || $link->isAllowed('publish') || $link->isAllowed('unpublish') || $link->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $link = clone $link;
-        $link->setLocked($link->isLocked());
-        $link->setParent(null);
-        $link->getScheduledTasks();
-        $data = $link->getObjectVars();
-        $this->addTranslationsData($link, $data);
-        $this->minimizeProperties($link, $data);
-        if ($link->getSourceDocument()) {
-            $data['sourcePath'] = $link->getSourceDocument()->getRealFullPath();
-        }
-        $this->preSendDataActions($data, $link);
-        if ($link->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_hardlink_save", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $link = Document\Hardlink::getById($request->get('id'));
-        if (!$link) {
-            throw $this->createNotFoundException('Hardlink not found');
-        }
-        $this->setValuesToDocument($request, $link);
-        $link->setModificationDate(time());
-        $link->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('task') == 'unpublish') {
-            $link->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $link->setPublished(true);
-        }
-        if (($request->get('task') == 'publish' && $link->isAllowed('publish')) || ($request->get('task') == 'unpublish' && $link->isAllowed('unpublish'))) {
-            $link->save();
-            $treeData = $this->getTreeNodeConfig($link);
-            return $this->adminJson([
-                'success' => true,
-                 'data' => [
-                     'versionDate' => $link->getModificationDate(),
-                     'versionCount' => $link->getVersionCount(),
-                 ],
-                'treeData' => $treeData,
-            ]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document\Hardlink $link
-     */
-    protected function setValuesToDocument(Request $request, Document $link)
-    {
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            $sourceId = null;
-            if ($sourceDocument = Document::getByPath($data['sourcePath'])) {
-                $sourceId = $sourceDocument->getId();
-            }
-            $link->setSourceId($sourceId);
-            $link->setValues($data);
-        }
-        $this->addPropertiesToDocument($request, $link);
-        $this->applySchedulerDataToElement($request, $link);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/LinkController.php
+++ b//dev/null
@@ -1,189 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject\Concrete;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Component\Serializer\SerializerInterface;
-/**
- * @Route("/link")
- *
- * @internal
- */
-class LinkController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_link_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_link_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_link_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_link_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     * @param SerializerInterface $serializer
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request, SerializerInterface $serializer)
-    {
-        $link = Document\Link::getById($request->get('id'));
-        if (!$link) {
-            throw $this->createNotFoundException('Link not found');
-        }
-        if ($link->isAllowed('save') || $link->isAllowed('publish') || $link->isAllowed('unpublish') || $link->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $link = clone $link;
-        $link->setObject(null);
-        $link->setLocked($link->isLocked());
-        $link->setParent(null);
-        $link->getScheduledTasks();
-        $data = $serializer->serialize($link->getObjectVars(), 'json', []);
-        $data = json_decode($data, true);
-        $data['rawHref'] = $link->getRawHref();
-        $this->addTranslationsData($link, $data);
-        $this->minimizeProperties($link, $data);
-        $this->preSendDataActions($data, $link);
-        if ($link->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_link_save", methods={"POST", "PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $link = Document\Link::getById($request->get('id'));
-        if (!$link) {
-            throw $this->createNotFoundException('Link not found');
-        }
-        $this->setValuesToDocument($request, $link);
-        $link->setModificationDate(time());
-        $link->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('task') == 'unpublish') {
-            $link->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $link->setPublished(true);
-        }
-        $task = $request->get('task');
-        if (($task == 'publish' && $link->isAllowed('publish'))
-            || ($task == 'unpublish' && $link->isAllowed('unpublish'))
-            || $task == 'scheduler' && $link->isAllowed('settings')
-        ) {
-            $link->save();
-            $treeData = $this->getTreeNodeConfig($link);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $link->getModificationDate(),
-                    'versionCount' => $link->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document\Link $link
-     */
-    protected function setValuesToDocument(Request $request, Document $link)
-    {
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            $path = $data['path'];
-            if (!empty($path)) {
-                $target = null;
-                if ($data['linktype'] == 'internal' && $data['internalType']) {
-                    $target = Element\Service::getElementByPath($data['internalType'], $path);
-                    if ($target) {
-                        $data['internal'] = $target->getId();
-                    }
-                }
-                if (!$target) {
-                    if ($target = Document::getByPath($path)) {
-                        $data['linktype'] = 'internal';
-                        $data['internalType'] = 'document';
-                        $data['internal'] = $target->getId();
-                    } elseif ($target = Asset::getByPath($path)) {
-                        $data['linktype'] = 'internal';
-                        $data['internalType'] = 'asset';
-                        $data['internal'] = $target->getId();
-                    } elseif ($target = Concrete::getByPath($path)) {
-                        $data['linktype'] = 'internal';
-                        $data['internalType'] = 'object';
-                        $data['internal'] = $target->getId();
-                    } else {
-                        $data['linktype'] = 'direct';
-                        $data['internalType'] = null;
-                        $data['direct'] = $path;
-                    }
-                    if ($target) {
-                        $data['linktype'] = 'internal';
-                    }
-                }
-            } else {
-                $data['linktype'] = 'internal';
-                $data['direct'] = '';
-                $data['internalType'] = null;
-                $data['internal'] = null;
-            }
-            unset($data['path']);
-            $link->setValues($data);
-        }
-        $this->addPropertiesToDocument($request, $link);
-        $this->applySchedulerDataToElement($request, $link);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/NewsletterController.php
+++ b//dev/null
@@ -1,389 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Exception;
-use Pimcore;
-use Pimcore\Document\Newsletter\AddressSourceAdapterFactoryInterface;
-use Pimcore\Model\DataObject\ClassDefinition\Data\Email;
-use Pimcore\Model\DataObject\ClassDefinition\Data\NewsletterActive;
-use Pimcore\Model\DataObject\ClassDefinition\Data\NewsletterConfirmed;
-use Pimcore\Model\DataObject\ClassDefinition\Listing;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Pimcore\Model\Tool;
-use Pimcore\Model\Tool\CustomReport\Config;
-use Pimcore\Tool\Console;
-use Pimcore\Tool\Newsletter;
-use RuntimeException;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/newsletter")
- *
- * @internal
- */
-class NewsletterController extends DocumentControllerBase
-{
-    use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_newsletter_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_newsletter_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_newsletter_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_newsletter_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request): JsonResponse
-    {
-        $email = Document\Newsletter::getById($request->get('id'));
-        if (!$email) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        if ($email->isAllowed('save') || $email->isAllowed('publish') || $email->isAllowed('unpublish') || $email->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $email = clone $email;
-        $draftVersion = null;
-        $email = $this->getLatestVersion($email, $draftVersion);
-        $versions = Element\Service::getSafeVersionInfo($email->getVersions());
-        $email->setVersions(array_splice($versions, -1, 1));
-        $email->setLocked($email->isLocked());
-        $email->setParent(null);
-        $email->setEditables(null);
-        $email->setChildren(null);
-        $data = $email->getObjectVars();
-        $this->addTranslationsData($email, $data);
-        $this->minimizeProperties($email, $data);
-        $data['url'] = $email->getUrl();
-        $this->preSendDataActions($data, $email, $draftVersion);
-        if ($email->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_newsletter_save", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws Exception
-     */
-    public function saveAction(Request $request): JsonResponse
-    {
-        $page = Document\Newsletter::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        $page = $this->getLatestVersion($page);
-        $page->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('task') === 'unpublish') {
-            $page->setPublished(false);
-        }
-        if ($request->get('task') === 'publish') {
-            $page->setPublished(true);
-        }
-        if (($request->get('task') === 'publish' && $page->isAllowed('publish')) ||
-            ($request->get('task') === 'unpublish' && $page->isAllowed('unpublish'))) {
-            $this->setValuesToDocument($request, $page);
-            $page->save();
-            $this->saveToSession($page);
-            $treeData = $this->getTreeNodeConfig($page);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $page->getModificationDate(),
-                    'versionCount' => $page->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } elseif ($page->isAllowed('save')) {
-            $this->setValuesToDocument($request, $page);
-            $version = $page->saveVersion();
-            $this->saveToSession($page);
-            $draftData = [
-                'id' => $version->getId(),
-                'modificationDate' => $version->getDate(),
-            ];
-            return $this->adminJson(['success' => true, 'draft' => $draftData]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document $page
-     */
-    protected function setValuesToDocument(Request $request, Document $page)
-    {
-        $this->addSettingsToDocument($request, $page);
-        $this->addDataToDocument($request, $page);
-        $this->addPropertiesToDocument($request, $page);
-        if ($request->get('plaintext')) {
-            $plaintext = $this->decodeJson($request->get('plaintext'));
-            $page->setValues($plaintext);
-        }
-    }
-    /**
-     * @Route("/checksql", name="pimcore_admin_document_newsletter_checksql", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function checksqlAction(Request $request): JsonResponse
-    {
-        $count = 0;
-        $success = false;
-        try {
-            $className = '\\Pimcore\\Model\\DataObject\\' . ucfirst($request->get('class')) . '\\Listing';
-            /** @var Pimcore\Model\DataObject\Listing $list */
-            $list = new $className();
-            $conditions = ['(newsletterActive = 1 AND newsletterConfirmed = 1)'];
-            if ($request->get('objectFilterSQL')) {
-                $conditions[] = $request->get('objectFilterSQL');
-            }
-            $list->setCondition(implode(' AND ', $conditions));
-            $count = $list->getTotalCount();
-            $success = true;
-        } catch (Exception $e) {
-        }
-        return $this->adminJson([
-            'count' => $count,
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/get-available-classes", name="pimcore_admin_document_newsletter_getavailableclasses", methods={"GET"})
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableClassesAction(): JsonResponse
-    {
-        $classList = new Listing();
-        $availableClasses = [];
-        foreach ($classList->load() as $class) {
-            $fieldCount = 0;
-            foreach ($class->getFieldDefinitions() as $fd) {
-                if ($fd instanceof NewsletterActive ||
-                    $fd instanceof NewsletterConfirmed ||
-                    $fd instanceof Email) {
-                    $fieldCount++;
-                }
-            }
-            if ($fieldCount >= 3) {
-                $availableClasses[] = ['name' => $class->getName()];
-            }
-        }
-        return $this->adminJson(['data' => $availableClasses]);
-    }
-    /**
-     * @Route("/get-available-reports", name="pimcore_admin_document_newsletter_getavailablereports", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableReportsAction(Request $request): JsonResponse
-    {
-        $task = $request->get('task');
-        if ($task === 'list') {
-            $reportList = Config::getReportsList();
-            $availableReports = [];
-            foreach ($reportList as $report) {
-                $availableReports[] = ['id' => $report['id'], 'text' => $report['text']];
-            }
-            return $this->adminJson(['data' => $availableReports]);
-        }
-        if ($task === 'fieldNames') {
-            $reportId = $request->get('reportId');
-            $report = Config::getByName($reportId);
-            $columnConfiguration = $report !== null ? $report->getColumnConfiguration() : [];
-            $availableColumns = [];
-            foreach ($columnConfiguration as $column) {
-                if ($column['display']) {
-                    $availableColumns[] = ['name' => $column['name']];
-                }
-            }
-            return $this->adminJson(['data' => $availableColumns]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-send-status", name="pimcore_admin_document_newsletter_getsendstatus", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getSendStatusAction(Request $request): JsonResponse
-    {
-        /** @var Document\Newsletter $document */
-        $document = Document\Newsletter::getById($request->get('id'));
-        $data = Tool\TmpStore::get($document->getTmpStoreId());
-        return $this->adminJson([
-            'data' => $data ? $data->getData() : null,
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/stop-send", name="pimcore_admin_document_newsletter_stopsend", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function stopSendAction(Request $request): JsonResponse
-    {
-        /** @var Document\Newsletter $document */
-        $document = Document\Newsletter::getById($request->get('id'));
-        Tool\TmpStore::delete($document->getTmpStoreId());
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/send", name="pimcore_admin_document_newsletter_send", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws Exception
-     */
-    public function sendAction(Request $request): JsonResponse
-    {
-        /** @var Document\Newsletter $document */
-        $document = Document\Newsletter::getById($request->get('id'));
-        if (Tool\TmpStore::get($document->getTmpStoreId())) {
-            throw new RuntimeException('Newsletter sending already in progress, need to finish first.');
-        }
-        /** @var Document\Newsletter $document */
-        $document = Document\Newsletter::getById($request->get('id'));
-        Tool\TmpStore::add($document->getTmpStoreId(), [
-            'documentId' => $document->getId(),
-            'addressSourceAdapterName' => $request->get('addressAdapterName'),
-            'adapterParams' => json_decode($request->get('adapterParams'), true),
-            'inProgress' => false,
-            'progress' => 0,
-        ], 'newsletter');
-        Console::runPhpScriptInBackground(
-            realpath(PIMCORE_PROJECT_ROOT . DIRECTORY_SEPARATOR . 'bin' . DIRECTORY_SEPARATOR . 'console'),
-            ['internal:newsletter-document-send', $document->getTmpStoreId(), \Pimcore\Tool::getHostUrl()],
-            PIMCORE_LOG_DIRECTORY . DIRECTORY_SEPARATOR . 'newsletter-sending-output.log'
-        );
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/calculate", name="pimcore_admin_document_newsletter_calculate", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function calculateAction(Request $request): JsonResponse
-    {
-        $addressSourceAdapterName = $request->get('addressAdapterName');
-        $adapterParams = json_decode($request->get('adapterParams'), true);
-        $serviceLocator = \Pimcore::getContainer()->get('pimcore.newsletter.address_source_adapter.factories');
-        if (!$serviceLocator->has($addressSourceAdapterName)) {
-            $msg = sprintf(
-                'Cannot send newsletters because Address Source Adapter with identifier %s could not be found',
-                $addressSourceAdapterName
-            );
-            return $this->adminJson(['success' => false, 'count' => '0', 'message' => $msg]);
-        }
-        /** @var AddressSourceAdapterFactoryInterface $addressAdapterFactory */
-        $addressAdapterFactory = $serviceLocator->get($addressSourceAdapterName);
-        $addressAdapter = $addressAdapterFactory->create($adapterParams);
-        return $this->adminJson(['success' => true, 'count' => $addressAdapter->getTotalRecordCount()]);
-    }
-    /**
-     * @Route("/send-test", name="pimcore_admin_document_newsletter_sendtest", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws Exception
-     */
-    public function sendTestAction(Request $request): JsonResponse
-    {
-        $document = Document\Newsletter::getById($request->get('id'));
-        $addressSourceAdapterName = $request->get('addressAdapterName');
-        $adapterParams = json_decode($request->get('adapterParams'), true);
-        $testMailAddress = $request->get('testMailAddress');
-        if (empty($testMailAddress)) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => 'Please provide a valid email address to send test newsletter',
-            ]);
-        }
-        $serviceLocator = \Pimcore::getContainer()->get('pimcore.newsletter.address_source_adapter.factories');
-        if (!$serviceLocator->has($addressSourceAdapterName)) {
-            return $this->adminJson([
-                'success' => false,
-                'error' => sprintf(
-                    'Cannot send newsletters because Address Source Adapter with identifier %s could not be found',
-                    $addressSourceAdapterName
-                ),
-            ]);
-        }
-        /** @var AddressSourceAdapterFactoryInterface $addressAdapterFactory */
-        $addressAdapterFactory = $serviceLocator->get($addressSourceAdapterName);
-        $addressAdapter = $addressAdapterFactory->create($adapterParams);
-        $sendingContainer = $addressAdapter->getParamsForTestSending($testMailAddress);
-        try {
-            $mail = Newsletter::prepareMail($document);
-            Newsletter::sendNewsletterDocumentBasedMail($mail, $sendingContainer);
-        } catch (\Exception $e) {
-            return $this->adminJson([
-                'success' => false,
-                'error' => $e->getMessage(),
-            ]);
-        }
-        return $this->adminJson(['success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/PageController.php
+++ b//dev/null
@@ -1,387 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Document\Editable\Block\BlockStateStack;
-use Pimcore\Document\Editable\EditmodeEditableDefinitionCollector;
-use Pimcore\Http\Request\Resolver\EditmodeResolver;
-use Pimcore\Logger;
-use Pimcore\Model\Document;
-use Pimcore\Model\Document\Targeting\TargetingDocumentInterface;
-use Pimcore\Model\Element;
-use Pimcore\Templating\Renderer\EditableRenderer;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-use Twig\Environment;
-/**
- * @Route("/page")
- *
- * @internal
- */
-class PageController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_page_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_page_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_page_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_page_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        $page = Document\Page::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Page not found');
-        }
-        if ($page->isAllowed('save') || $page->isAllowed('publish') || $page->isAllowed('unpublish') || $page->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $page = clone $page;
-        $draftVersion = null;
-        $page = $this->getLatestVersion($page, $draftVersion);
-        $pageVersions = Element\Service::getSafeVersionInfo($page->getVersions());
-        $page->setVersions(array_splice($pageVersions, -1, 1));
-        $page->getScheduledTasks();
-        $page->setLocked($page->isLocked());
-        $page->setParent(null);
-        $page->setEditables(null);
-        $page->setChildren(null);
-        $data = $page->getObjectVars();
-        $this->addTranslationsData($page, $data);
-        $this->minimizeProperties($page, $data);
-        if ($page->getContentMasterDocument()) {
-            $data['contentMasterDocumentPath'] = $page->getContentMasterDocument()->getRealFullPath();
-        }
-        $data['url'] = $page->getUrl();
-        $this->preSendDataActions($data, $page, $draftVersion);
-        if ($page->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_page_save", methods={"PUT", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $page = Document\Page::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Page not found');
-        }
-        /** @var Document\Page|null $pageSession */
-        $pageSession = $this->getFromSession($page);
-        if ($pageSession) {
-            $page = $pageSession;
-        } else {
-            /** @var Document\Page $page */
-            $page = $this->getLatestVersion($page);
-        }
-        $page->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('missingRequiredEditable') !== null) {
-            $page->setMissingRequiredEditable(($request->get('missingRequiredEditable') == 'true') ? true : false);
-        }
-        $settings = [];
-        if ($request->get('settings')) {
-            $settings = $this->decodeJson($request->get('settings'));
-            if ($settings['published'] ?? false) {
-                $page->setMissingRequiredEditable(null);
-            }
-        }
-        if ($request->get('settings') && is_array($settings)) {
-            $metaData = [];
-            for ($i = 1; $i < 30; $i++) {
-                if (array_key_exists('metadata_' . $i, $settings)) {
-                    $metaData[] = $settings['metadata_' . $i];
-                }
-            }
-            $page->setMetaData($metaData);
-        }
-        if (($request->get('task') == 'publish' && $page->isAllowed('publish')) || ($request->get('task') == 'unpublish' && $page->isAllowed('unpublish'))) {
-            $this->setValuesToDocument($request, $page);
-            if ($request->get('task') == 'unpublish') {
-                $page->setPublished(false);
-            } elseif ($request->get('task') == 'publish') {
-                $page->setPublished(true);
-            }
-            $page->save();
-            $this->saveToSession($page);
-            $treeData = $this->getTreeNodeConfig($page);
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson([
-                'success' => true,
-                'treeData' => $treeData,
-                'data' => [
-                    'versionDate' => $page->getModificationDate(),
-                    'versionCount' => $page->getVersionCount(),
-                ],
-            ]);
-        } elseif ($page->isAllowed('save')) {
-            $this->setValuesToDocument($request, $page);
-            $version = $page->saveVersion(true, true, null, $request->get('task') == 'autoSave');
-            $this->saveToSession($page);
-            $draftData = [
-                'id' => $version->getId(),
-                'modificationDate' => $version->getDate(),
-            ];
-            $treeData = $this->getTreeNodeConfig($page);
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson(['success' => true, 'treeData' => $treeData, 'draft' => $draftData]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @Route("/get-list", name="pimcore_admin_document_page_getlist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getListAction(Request $request)
-    {
-        $list = new Document\Listing();
-        $list->setCondition('type = ?', ['page']);
-        $data = $list->loadIdPathList();
-        return $this->adminJson([
-            'success' => true,
-            'data' => $data,
-        ]);
-    }
-    /**
-     * @Route("/generate-screenshot", name="pimcore_admin_document_page_generatescreenshot", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function generateScreenshotAction(Request $request)
-    {
-        $success = false;
-        if ($request->get('id')) {
-            try {
-                $success = Document\Service::generatePagePreview($request->get('id'), $request);
-            } catch (\Exception $e) {
-                Logger::err($e);
-            }
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/display-preview-image", name="pimcore_admin_page_display_preview_image", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function displayPreviewImageAction(Request $request)
-    {
-        $document = Document\Page::getById($request->get('id'));
-        if ($document instanceof Document\Page) {
-            return new BinaryFileResponse($document->getPreviewImageFilesystemPath((bool) $request->get('hdpi')), 200, ['Content-Type' => 'image/jpg']);
-        }
-        throw $this->createNotFoundException('Page not found');
-    }
-    /**
-     * @Route("/check-pretty-url", name="pimcore_admin_document_page_checkprettyurl", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function checkPrettyUrlAction(Request $request)
-    {
-        $docId = $request->get('id');
-        $path = (string) trim($request->get('path'));
-        $success = true;
-        if ($path === '') {
-            return $this->adminJson([
-                'success' => $success,
-            ]);
-        }
-        $message = [];
-        $path = rtrim($path, '/');
-        if ($path !== '' && strpos($path, '/') !== 0) {
-            $success = false;
-            $message[] = 'URL must start with /.';
-        }
-        if (strlen($path) < 2) {
-            $success = false;
-            $message[] = 'URL must be at least 2 characters long.';
-        }
-        if (!Element\Service::isValidPath($path, 'document')) {
-            $success = false;
-            $message[] = 'URL is invalid.';
-        }
-        $list = new Document\Listing();
-        $list->setCondition('(CONCAT(path, `key`) = ? OR id IN (SELECT id from documents_page WHERE prettyUrl = ?))
-            AND id != ?', [
-            $path, $path, $docId,
-        ]);
-        if ($list->getTotalCount() > 0) {
-            $success = false;
-            $message[] = 'URL path already exists.';
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'message' => implode('<br>', $message),
-        ]);
-    }
-    /**
-     * @Route("/clear-editable-data", name="pimcore_admin_document_page_cleareditabledata", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function clearEditableDataAction(Request $request)
-    {
-        $targetGroupId = $request->get('targetGroup');
-        $docId = $request->get('id');
-        $doc = Document\PageSnippet::getById($docId);
-        if (!$doc) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        foreach ($doc->getEditables() as $editable) {
-            if ($targetGroupId && $doc instanceof TargetingDocumentInterface) {
-                if (preg_match('/^' . preg_quote($doc->getTargetGroupEditablePrefix($targetGroupId), '/') . '/', $editable->getName())) {
-                    $doc->removeEditable($editable->getName());
-                }
-            } else {
-                if (!preg_match('/^' . preg_quote(TargetingDocumentInterface::TARGET_GROUP_EDITABLE_PREFIX, '/') . '/', $editable->getName())) {
-                    $doc->removeEditable($editable->getName());
-                }
-            }
-        }
-        $this->saveToSession($doc, true);
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/qr-code", name="pimcore_admin_document_page_qrcode", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function qrCodeAction(Request $request)
-    {
-        $page = Document\Page::getById($request->query->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Page not found');
-        }
-        $url = $request->getScheme() . '://' . $request->getHttpHost() . $page->getFullPath();
-        $code = new \Endroid\QrCode\QrCode;
-        $code->setWriterByName('png');
-        $code->setText($url);
-        $code->setSize(500);
-        $tmpFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/qr-code-' . uniqid() . '.png';
-        $code->writeFile($tmpFile);
-        $response = new BinaryFileResponse($tmpFile);
-        $response->headers->set('Content-Type', 'image/png');
-        if ($request->query->get('download')) {
-            $code->setSize(4000);
-            $response->setContentDisposition('attachment', 'qrcode-preview.png');
-        }
-        $response->deleteFileAfterSend(true);
-        return $response;
-    }
-    /**
-     * @Route("/areabrick-render-index-editmode", name="pimcore_admin_document_page_areabrick-render-index-editmode", methods={"POST"})
-     *
-     * @param Request $request
-     * @param BlockStateStack $blockStateStack
-     * @param EditmodeEditableDefinitionCollector $definitionCollector
-     * @param Environment $twig
-     * @param EditableRenderer $editableRenderer
-     *
-     * @return JsonResponse
-     */
-    public function areabrickRenderIndexEditmode(
-        Request $request,
-        BlockStateStack $blockStateStack,
-        EditmodeEditableDefinitionCollector $definitionCollector,
-        Environment $twig,
-        EditableRenderer $editableRenderer
-    ) {
-        $blockStateStackData = json_decode($request->get('blockStateStack'), true);
-        $blockStateStack->loadArray($blockStateStackData);
-        $document = Document\PageSnippet::getById($request->get('documentId'));
-        $twig->addGlobal('document', $document);
-        $twig->addGlobal('editmode', true);
-        $request->attributes->set(EditmodeResolver::ATTRIBUTE_EDITMODE, true);
-        $areaBlockConfig = json_decode($request->get('areablockConfig'), true);
-        /** @var Document\Editable\Areablock $areablock */
-        $areablock = $editableRenderer->getEditable($document, 'areablock', $request->get('realName'), $areaBlockConfig, true);
-        $areablock->setRealName($request->get('realName'));
-        $areablock->setEditmode(true);
-        $areaBrickData = json_decode($request->get('areablockData'), true);
-        $areablock->setDataFromEditmode($areaBrickData);
-        $htmlCode = trim($areablock->renderIndex($request->get('index'), true));
-        return new JsonResponse([
-            'editableDefinitions' => $definitionCollector->getDefinitions(),
-            'htmlCode' => $htmlCode,
-        ]);
-    }
-    /**
-     * @param Request $request
-     * @param Document $page
-     */
-    protected function setValuesToDocument(Request $request, Document $page)
-    {
-        $this->addSettingsToDocument($request, $page);
-        $this->addDataToDocument($request, $page);
-        $this->addPropertiesToDocument($request, $page);
-        $this->applySchedulerDataToElement($request, $page);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/PrintcontainerController.php
+++ b//dev/null
@@ -1,124 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Config;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/printcontainer")
- *
- * @internal
- */
-class PrintcontainerController extends PrintpageControllerBase
-{
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_printcontainer_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_printcontainer_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_printcontainer_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_printcontainer_getdatabyid", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        return parent::getDataByIdAction($request);
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_printcontainer_save", methods={"PUT", "POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveAction(Request $request)
-    {
-        return parent::saveAction($request);
-    }
-    /**
-     * @Route("/active-generate-process", name="pimcore_admin_document_printcontainer_activegenerateprocess", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function activeGenerateProcessAction(Request $request)
-    {
-        return parent::activeGenerateProcessAction($request);
-    }
-    /**
-     * @Route("/pdf-download", name="pimcore_admin_document_printcontainer_pdfdownload", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function pdfDownloadAction(Request $request)
-    {
-        return parent::pdfDownloadAction($request);
-    }
-    /**
-     * @Route("/start-pdf-generation", name="pimcore_admin_document_printcontainer_startpdfgeneration", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function startPdfGenerationAction(Request $request, Config $config)
-    {
-        return parent::startPdfGenerationAction($request, $config);
-    }
-    /**
-     * @Route("/check-pdf-dirty", name="pimcore_admin_document_printcontainer_checkpdfdirty", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function checkPdfDirtyAction(Request $request)
-    {
-        return parent::checkPdfDirtyAction($request);
-    }
-    /**
-     * @Route("/get-processing-options", name="pimcore_admin_document_printcontainer_getprocessingoptions", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function getProcessingOptionsAction(Request $request)
-    {
-        return parent::getProcessingOptionsAction($request);
-    }
-    /**
-     * @Route("/cancel-generation", name="pimcore_admin_document_printcontainer_cancelgeneration", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function cancelGenerationAction(Request $request)
-    {
-        return parent::cancelGenerationAction($request);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/PrintpageController.php
+++ b//dev/null
@@ -1,124 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Config;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/printpage")
- *
- * @internal
- */
-class PrintpageController extends PrintpageControllerBase
-{
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_printpage_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_printpage_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_printpage_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_printpage_getdatabyid", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        return parent::getDataByIdAction($request);
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_printpage_save", methods={"PUT", "POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveAction(Request $request)
-    {
-        return parent::saveAction($request);
-    }
-    /**
-     * @Route("/active-generate-process", name="pimcore_admin_document_printpage_activegenerateprocess", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function activeGenerateProcessAction(Request $request)
-    {
-        return parent::activeGenerateProcessAction($request);
-    }
-    /**
-     * @Route("/pdf-download", name="pimcore_admin_document_printpage_pdfdownload", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function pdfDownloadAction(Request $request)
-    {
-        return parent::pdfDownloadAction($request);
-    }
-    /**
-     * @Route("/start-pdf-generation", name="pimcore_admin_document_printpage_startpdfgeneration", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function startPdfGenerationAction(Request $request, Config $config)
-    {
-        return parent::startPdfGenerationAction($request, $config);
-    }
-    /**
-     * @Route("/check-pdf-dirty", name="pimcore_admin_document_printpage_checkpdfdirty", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function checkPdfDirtyAction(Request $request)
-    {
-        return parent::checkPdfDirtyAction($request);
-    }
-    /**
-     * @Route("/get-processing-options", name="pimcore_admin_document_printpage_getprocessingoptions", methods={"GET"})
-     *
-     * {@inheritDoc}
-     */
-    public function getProcessingOptionsAction(Request $request)
-    {
-        return parent::getProcessingOptionsAction($request);
-    }
-    /**
-     * @Route("/cancel-generation", name="pimcore_admin_document_printpage_cancelgeneration", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function cancelGenerationAction(Request $request)
-    {
-        return parent::cancelGenerationAction($request);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/PrintpageControllerBase.php
+++ b//dev/null
@@ -1,280 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Config;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Document;
-use Pimcore\Web2Print\Processor;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-/**
- * @internal
- */
-abstract class PrintpageControllerBase extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        $page = Document\PrintAbstract::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        if ($page->isAllowed('save') || $page->isAllowed('publish') || $page->isAllowed('unpublish') || $page->isAllowed('delete')) {
-            if (\Pimcore\Model\Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            \Pimcore\Model\Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $page = clone $page;
-        $draftVersion = null;
-        $page = $this->getLatestVersion($page, $draftVersion);
-        $page->getVersions();
-        $page->getScheduledTasks();
-        $page->setLocked($page->isLocked());
-        $page->setEditables(null);
-        $page->setChildren(null);
-        $data = $page->getObjectVars();
-        $this->addTranslationsData($page, $data);
-        $this->minimizeProperties($page, $data);
-        $data['url'] = $page->getUrl();
-        if ($page->getContentMasterDocument()) {
-            $data['contentMasterDocumentPath'] = $page->getContentMasterDocument()->getRealFullPath();
-        }
-        $this->preSendDataActions($data, $page, $draftVersion);
-        if ($page->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function saveAction(Request $request)
-    {
-        $page = Document\PrintAbstract::getById($request->get('id'));
-        if (!$page) {
-            throw $this->createNotFoundException('Document not found');
-        }
-        $page = $this->getLatestVersion($page);
-        $page->setUserModification($this->getAdminUser()->getId());
-        $key = 'document_' . $request->get('id');
-        Document\Service::saveElementToSession($page);
-        if ($request->get('task') == 'unpublish') {
-            $page->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $page->setPublished(true);
-        }
-        if (($request->get('task') == 'publish' && $page->isAllowed('publish')) || ($request->get('task') == 'unpublish' && $page->isAllowed('unpublish'))) {
-            $config = Config::getWeb2PrintConfig();
-            if ($config->get('generalDocumentSaveMode') == 'cleanup') {
-                $page->setEditables([]);
-            }
-            $this->setValuesToDocument($request, $page);
-            $page->save();
-            $treeData = $this->getTreeNodeConfig($page);
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $page->getModificationDate(),
-                    'versionCount' => $page->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } elseif ($page->isAllowed('save')) {
-            $this->setValuesToDocument($request, $page);
-            $version = $page->saveVersion(true, true, null, $request->get('task') == 'autoSave');
-            $draftData = [
-                'id' => $version->getId(),
-                'modificationDate' => $version->getDate(),
-            ];
-            $this->handleTask($request->get('task'), $page);
-            return $this->adminJson(['success' => true, 'draft' => $draftData]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document\PrintAbstract $page
-     */
-    protected function setValuesToDocument(Request $request, Document $page)
-    {
-        $this->addSettingsToDocument($request, $page);
-        $this->addDataToDocument($request, $page);
-        $this->addPropertiesToDocument($request, $page);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function activeGenerateProcessAction(Request $request)
-    {
-        $document = Document\PrintAbstract::getById((int)$request->get('id'));
-        if (!$document) {
-            throw $this->createNotFoundException('Document with id ' . $request->get('id') . ' not found.');
-        }
-        $date = $document->getLastGeneratedDate();
-        if ($date) {
-            $date = $date->format('Y-m-d H:i');
-        }
-        $inProgress = $document->getInProgress();
-        $statusUpdate = [];
-        if ($inProgress) {
-            $statusUpdate = Processor::getInstance()->getStatusUpdate($document->getId());
-        }
-        return $this->adminJson([
-            'activeGenerateProcess' => !empty($inProgress),
-            'date' => $date,
-            'message' => $document->getLastGenerateMessage(),
-            'downloadAvailable' => file_exists($document->getPdfFileName()),
-            'statusUpdate' => $statusUpdate,
-        ]);
-    }
-    /**
-     * @param Request $request
-     *
-     * @throws \Exception
-     *
-     * @return BinaryFileResponse
-     */
-    public function pdfDownloadAction(Request $request)
-    {
-        $document = Document\PrintAbstract::getById((int)$request->get('id'));
-        if (!$document) {
-            throw $this->createNotFoundException('Document with id ' . $request->get('id') . ' not found.');
-        }
-        if (file_exists($document->getPdfFileName())) {
-            $response = new BinaryFileResponse($document->getPdfFileName());
-            $response->headers->set('Content-Type', 'application/pdf');
-            if ($request->get('download')) {
-                $response->setContentDisposition('attachment', $document->getKey() . '.pdf');
-            }
-            return $response;
-        } else {
-            throw $this->createNotFoundException('File does not exist');
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function startPdfGenerationAction(Request $request, Config $config)
-    {
-        $allParams = json_decode($request->getContent(), true);
-        $document = Document\PrintAbstract::getById($allParams['id']);
-        if (!$document) {
-            throw $this->createNotFoundException('Document with id ' . $allParams['id'] . ' not found.');
-        }
-        if (empty($allParams['hostName'] = $config['general']['domain'])) {
-            $allParams['hostName'] = $_SERVER['HTTP_HOST'];
-        }
-        $https = $_SERVER['HTTPS'] ?? 'off';
-        $allParams['protocol'] = $https === 'on' ? 'https' : 'http';
-        $pdf = $document->getPdfFileName();
-        if (is_file($pdf)) {
-            unlink($pdf);
-        }
-        $result = $document->generatePdf($allParams);
-        $this->saveProcessingOptions($document->getId(), $allParams);
-        return $this->adminJson(['success' => $result]);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function checkPdfDirtyAction(Request $request)
-    {
-        $printDocument = Document\PrintAbstract::getById($request->get('id'));
-        $dirty = true;
-        if ($printDocument) {
-            $dirty = $printDocument->pdfIsDirty();
-        }
-        return $this->adminJson(['pdfDirty' => $dirty]);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getProcessingOptionsAction(Request $request)
-    {
-        $options = Processor::getInstance()->getProcessingOptions();
-        $returnValue = [];
-        $storedValues = $this->getStoredProcessingOptions($request->get('id'));
-        foreach ($options as $option) {
-            $value = $option['default'];
-            if ($storedValues && array_key_exists($option['name'], $storedValues)) {
-                $value = $storedValues[$option['name']];
-            }
-            $returnValue[] = [
-                'name' => $option['name'],
-                'label' => $option['name'],
-                'value' => $value,
-                'type' => $option['type'],
-                'values' => isset($option['values']) ? $option['values'] : null,
-            ];
-        }
-        return $this->adminJson(['options' => $returnValue]);
-    }
-    /**
-     * @param int $documentId
-     *
-     * @return array|mixed
-     */
-    private function getStoredProcessingOptions($documentId)
-    {
-        $filename = PIMCORE_SYSTEM_TEMP_DIRECTORY . DIRECTORY_SEPARATOR . 'web2print-processingoptions-' . $documentId . '_' . $this->getAdminUser()->getId() . '.psf';
-        if (file_exists($filename)) {
-            return \Pimcore\Tool\Serialize::unserialize(file_get_contents($filename));
-        } else {
-            return [];
-        }
-    }
-    /**
-     * @param int $documentId
-     * @param array $options
-     */
-    private function saveProcessingOptions($documentId, $options)
-    {
-        file_put_contents(PIMCORE_SYSTEM_TEMP_DIRECTORY . DIRECTORY_SEPARATOR . 'web2print-processingoptions-' . $documentId . '_' . $this->getAdminUser()->getId() . '.psf', \Pimcore\Tool\Serialize::serialize($options));
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function cancelGenerationAction(Request $request)
-    {
-        Processor::getInstance()->cancelGeneration((int)$request->get('id'));
-        return $this->adminJson(['success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/RenderletController.php
+++ b//dev/null
@@ -1,112 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Document\Editable\EditableHandler;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element\ElementInterface;
-use Pimcore\Model\Element\Service;
-use Pimcore\Model\Tool\Targeting\TargetGroup;
-use Pimcore\Templating\Renderer\ActionRenderer;
-use Symfony\Cmf\Bundle\RoutingBundle\Routing\DynamicRouter;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @internal
- */
-class RenderletController extends AdminController
-{
-    /**
-     * Handles editmode preview for renderlets
-     *
-     * @Route("/document_tag/renderlet", name="pimcore_admin_document_renderlet_renderlet")
-     *
-     * @param Request $request
-     * @param ActionRenderer $actionRenderer
-     * @param EditableHandler $editableHandler
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return Response
-     */
-    public function renderletAction(
-        Request $request,
-        ActionRenderer $actionRenderer,
-        EditableHandler $editableHandler,
-        LocaleServiceInterface $localeService
-    ) {
-        $query = $request->query->all();
-        $attributes = [];
-        $element = $this->loadElement($request);
-        $this->configureElementTargeting($request, $element);
-        $controller = $request->get('controller');
-        $action = $request->get('action');
-        $moduleOrBundle = null;
-        if ($request->get('bundle')) {
-            $moduleOrBundle = $request->get('bundle');
-        } elseif ($request->get('module')) {
-            $moduleOrBundle = $request->get('bundle');
-        }
-        if ($document = $request->get('pimcore_parentDocument')) {
-            $document = Document\PageSnippet::getById($document);
-            if ($document) {
-                $attributes = $actionRenderer->addDocumentAttributes($document, $attributes);
-                unset($attributes[DynamicRouter::CONTENT_TEMPLATE]);
-            }
-        }
-        if ($template = $request->get('template')) {
-            $attributes[DynamicRouter::CONTENT_TEMPLATE] = $template;
-        }
-        foreach (['controller', 'action', 'module', 'bundle'] as $key) {
-            if (isset($query[$key])) {
-                unset($query[$key]);
-            }
-        }
-        if (isset($attributes['_locale'])) {
-            $localeService->setLocale($attributes['_locale']);
-        }
-        $result = $editableHandler->renderAction($controller, $attributes, $query);
-        return new Response($result);
-    }
-    private function loadElement(Request $request): ElementInterface
-    {
-        $element = null;
-        $id = $request->get('id');
-        $type = $request->get('type');
-        if ($id && $type) {
-            $element = Service::getElementById($type, (int)$id);
-        }
-        if (!$element instanceof ElementInterface) {
-            throw $this->createNotFoundException(sprintf('Element with type %s and ID %d was not found', $type ?: 'null', $id ?: 'null'));
-        }
-        if (!$element->isAllowed('view')) {
-            throw $this->createAccessDeniedException(sprintf('Access to element with type %s and ID %d is not allowed', $type, $id));
-        }
-        return $element;
-    }
-    private function configureElementTargeting(Request $request, ElementInterface $element)
-    {
-        if (!$element instanceof Document\Targeting\TargetingDocumentInterface) {
-            return;
-        }
-        if ($request->get('_ptg')) {
-            $targetGroup = TargetGroup::getById((int)$request->get('_ptg'));
-            if ($targetGroup) {
-                $element->setUseTargetGroup($targetGroup->getId());
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/Document/SnippetController.php
+++ b//dev/null
@@ -1,165 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\Document;
-use Pimcore\Controller\Traits\ElementEditLockHelperTrait;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/snippet")
- *
- * @internal
- */
-class SnippetController extends DocumentControllerBase
-{
-    use ElementEditLockHelperTrait;
-    /**
-     * @Route("/save-to-session", name="pimcore_admin_document_snippet_savetosession", methods={"POST"})
-     *
-     * {@inheritDoc}
-     */
-    public function saveToSessionAction(Request $request)
-    {
-        return parent::saveToSessionAction($request);
-    }
-    /**
-     * @Route("/remove-from-session", name="pimcore_admin_document_snippet_removefromsession", methods={"DELETE"})
-     *
-     * {@inheritDoc}
-     */
-    public function removeFromSessionAction(Request $request)
-    {
-        return parent::removeFromSessionAction($request);
-    }
-    /**
-     * @Route("/change-master-document", name="pimcore_admin_document_snippet_changemasterdocument", methods={"PUT"})
-     *
-     * {@inheritDoc}
-     */
-    public function changeMasterDocumentAction(Request $request)
-    {
-        return parent::changeMasterDocumentAction($request);
-    }
-    /**
-     * @Route("/get-data-by-id", name="pimcore_admin_document_snippet_getdatabyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDataByIdAction(Request $request)
-    {
-        $snippet = Document\Snippet::getById($request->get('id'));
-        if (!$snippet) {
-            throw $this->createNotFoundException('Snippet not found');
-        }
-        if ($snippet->isAllowed('save') || $snippet->isAllowed('publish') || $snippet->isAllowed('unpublish') || $snippet->isAllowed('delete')) {
-            if (Element\Editlock::isLocked($request->get('id'), 'document')) {
-                return $this->getEditLockResponse($request->get('id'), 'document');
-            }
-            Element\Editlock::lock($request->get('id'), 'document');
-        }
-        $snippet = clone $snippet;
-        $draftVersion = null;
-        $snippet = $this->getLatestVersion($snippet, $draftVersion);
-        $versions = Element\Service::getSafeVersionInfo($snippet->getVersions());
-        $snippet->setVersions(array_splice($versions, -1, 1));
-        $snippet->getScheduledTasks();
-        $snippet->setLocked($snippet->isLocked());
-        $snippet->setParent(null);
-        $snippet->setEditables(null);
-        $data = $snippet->getObjectVars();
-        $this->addTranslationsData($snippet, $data);
-        $this->minimizeProperties($snippet, $data);
-        $data['url'] = $snippet->getUrl();
-        if ($snippet->getContentMasterDocument()) {
-            $data['contentMasterDocumentPath'] = $snippet->getContentMasterDocument()->getRealFullPath();
-        }
-        $this->preSendDataActions($data, $snippet, $draftVersion);
-        if ($snippet->isAllowed('view')) {
-            return $this->adminJson($data);
-        }
-        throw $this->createAccessDeniedHttpException();
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_document_snippet_save", methods={"POST","PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function saveAction(Request $request)
-    {
-        $snippet = Document\Snippet::getById($request->get('id'));
-        if (!$snippet) {
-            throw $this->createNotFoundException('Snippet not found');
-        }
-        /** @var Document\Snippet|null $snippetSession */
-        $snippetSession = $this->getFromSession($snippet);
-        if ($snippetSession) {
-            $snippet = $snippetSession;
-        } else {
-            $snippet = $this->getLatestVersion($snippet);
-        }
-        $snippet->setUserModification($this->getAdminUser()->getId());
-        if ($request->get('task') == 'unpublish') {
-            $snippet->setPublished(false);
-        }
-        if ($request->get('task') == 'publish') {
-            $snippet->setPublished(true);
-        }
-        if (($request->get('task') == 'publish' && $snippet->isAllowed('publish')) || ($request->get('task') == 'unpublish' && $snippet->isAllowed('unpublish'))) {
-            $this->setValuesToDocument($request, $snippet);
-            $snippet->save();
-            $this->saveToSession($snippet);
-            $treeData = $this->getTreeNodeConfig($snippet);
-            $this->handleTask($request->get('task'), $snippet);
-            return $this->adminJson([
-                'success' => true,
-                'data' => [
-                    'versionDate' => $snippet->getModificationDate(),
-                    'versionCount' => $snippet->getVersionCount(),
-                ],
-                'treeData' => $treeData,
-            ]);
-        } elseif ($snippet->isAllowed('save')) {
-            $this->setValuesToDocument($request, $snippet);
-            $version = $snippet->saveVersion(true, true, null, $request->get('task') == 'autoSave');
-            $this->saveToSession($snippet);
-            $draftData = [
-                'id' => $version->getId(),
-                'modificationDate' => $version->getDate(),
-            ];
-            $this->handleTask($request->get('task'), $snippet);
-            return $this->adminJson(['success' => true, 'draft' => $draftData]);
-        } else {
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param Request $request
-     * @param Document $snippet
-     */
-    protected function setValuesToDocument(Request $request, Document $snippet)
-    {
-        $this->addSettingsToDocument($request, $snippet);
-        $this->addDataToDocument($request, $snippet);
-        $this->applySchedulerDataToElement($request, $snippet);
-        $this->addPropertiesToDocument($request, $snippet);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/ElementController.php
+++ b//dev/null
@@ -1,801 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\DependencyInjection\PimcoreAdminExtension;
-use Pimcore\Db;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Event\Model\ResolveElementEvent;
-use Pimcore\Logger;
-use Pimcore\Model;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Pimcore\Model\Version;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- *
- * @internal
- */
-class ElementController extends AdminController
-{
-    /**
-     * @Route("/element/lock-element", name="pimcore_admin_element_lockelement", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function lockElementAction(Request $request)
-    {
-        Element\Editlock::lock($request->get('id'), $request->get('type'));
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/element/unlock-element", name="pimcore_admin_element_unlockelement", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function unlockElementAction(Request $request)
-    {
-        Element\Editlock::unlock($request->get('id'), $request->get('type'));
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * Returns the element data denoted by the given type and ID or path.
-     *
-     * @Route("/element/get-subtype", name="pimcore_admin_element_getsubtype", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getSubtypeAction(Request $request)
-    {
-        $idOrPath = trim($request->get('id'));
-        $type = $request->get('type');
-        $event = new ResolveElementEvent($type, $idOrPath);
-        \Pimcore::getEventDispatcher()->dispatch($event, AdminEvents::RESOLVE_ELEMENT);
-        $idOrPath = $event->getId();
-        $type = $event->getType();
-        if (is_numeric($idOrPath)) {
-            $el = Element\Service::getElementById($type, (int) $idOrPath);
-        } else {
-            if ($type == 'document') {
-                $el = Document\Service::getByUrl($idOrPath);
-            } else {
-                $el = Element\Service::getElementByPath($type, $idOrPath);
-            }
-        }
-        if ($el) {
-            $subtype = null;
-            if ($el instanceof Asset || $el instanceof Document) {
-                $subtype = $el->getType();
-            } elseif ($el instanceof DataObject\Concrete) {
-                $subtype = $el->getClassName();
-            } elseif ($el instanceof DataObject\Folder) {
-                $subtype = 'folder';
-            }
-            return $this->adminJson([
-                'subtype' => $subtype,
-                'id' => $el->getId(),
-                'type' => $type,
-                'success' => true,
-            ]);
-        } else {
-            return $this->adminJson([
-                'success' => false,
-            ]);
-        }
-    }
-    /**
-     * @param string $parameterName
-     *
-     * @return \Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse
-     */
-    protected function processNoteTypesFromParameters(string $parameterName)
-    {
-        $config = $this->getParameter($parameterName);
-        $result = [];
-        foreach ($config as $configEntry) {
-            $result[] = [
-                'name' => $configEntry,
-            ];
-        }
-        return $this->adminJson(['noteTypes' => $result]);
-    }
-    /**
-     * @Route("/element/note-types", name="pimcore_admin_element_notetypes", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function noteTypes(Request $request)
-    {
-        switch ($request->get('ctype')) {
-            case 'document':
-                return $this->processNoteTypesFromParameters(PimcoreAdminExtension::PARAM_DOCUMENTS_NOTES_EVENTS_TYPES);
-            case 'asset':
-                return $this->processNoteTypesFromParameters(PimcoreAdminExtension::PARAM_ASSETS_NOTES_EVENTS_TYPES);
-            case 'object':
-                return $this->processNoteTypesFromParameters(PimcoreAdminExtension::PARAM_DATAOBJECTS_NOTES_EVENTS_TYPES);
-            default:
-                return $this->adminJson(['noteTypes' => []]);
-        }
-    }
-    /**
-     * @Route("/element/note-list", name="pimcore_admin_element_notelist", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function noteListAction(Request $request)
-    {
-        $this->checkPermission('notes_events');
-        $list = new Element\Note\Listing();
-        $list->setLimit($request->get('limit'));
-        $list->setOffset($request->get('start'));
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-        if ($sortingSettings['orderKey'] && $sortingSettings['order']) {
-            $list->setOrderKey($sortingSettings['orderKey']);
-            $list->setOrder($sortingSettings['order']);
-        } else {
-            $list->setOrderKey(['date', 'id']);
-            $list->setOrder(['DESC', 'DESC']);
-        }
-        $conditions = [];
-        $filterText = $request->get('filterText');
-        if ($filterText) {
-            $conditions[] = '('
-                . '`title` LIKE ' . $list->quote('%'. $filterText .'%')
-                . ' OR `description` LIKE ' . $list->quote('%'.$filterText.'%')
-                . ' OR `type` LIKE ' . $list->quote('%'.$filterText.'%')
-                . ' OR `user` IN (SELECT `id` FROM `users` WHERE `name` LIKE ' . $list->quote('%'.$filterText.'%') . ')'
-                . " OR DATE_FORMAT(FROM_UNIXTIME(`date`), '%Y-%m-%d') LIKE " . $list->quote('%'.$filterText.'%')
-                . ')';
-        }
-        $filterJson = $request->get('filter');
-        if ($filterJson) {
-            $db = Db::get();
-            $filters = $this->decodeJson($filterJson);
-            $propertyKey = 'property';
-            $comparisonKey = 'operator';
-            foreach ($filters as $filter) {
-                $operator = '=';
-                if ($filter['type'] == 'string') {
-                    $operator = 'LIKE';
-                } elseif ($filter['type'] == 'numeric') {
-                    if ($filter[$comparisonKey] == 'lt') {
-                        $operator = '<';
-                    } elseif ($filter[$comparisonKey] == 'gt') {
-                        $operator = '>';
-                    } elseif ($filter[$comparisonKey] == 'eq') {
-                        $operator = '=';
-                    }
-                } elseif ($filter['type'] == 'date') {
-                    if ($filter[$comparisonKey] == 'lt') {
-                        $operator = '<';
-                    } elseif ($filter[$comparisonKey] == 'gt') {
-                        $operator = '>';
-                    } elseif ($filter[$comparisonKey] == 'eq') {
-                        $operator = '=';
-                    }
-                    $filter['value'] = strtotime($filter['value']);
-                } elseif ($filter[$comparisonKey] == 'list') {
-                    $operator = '=';
-                } elseif ($filter[$comparisonKey] == 'boolean') {
-                    $operator = '=';
-                    $filter['value'] = (int) $filter['value'];
-                }
-                $value = $filter['value'];
-                if ($operator == 'LIKE') {
-                    $value = '%' . $value . '%';
-                }
-                if ($filter[$propertyKey] == 'user') {
-                    $conditions[] = '`user` IN (SELECT `id` FROM `users` WHERE `name` LIKE ' . $list->quote('%'.$filter['value'].'%') . ')';
-                } else {
-                    if ($filter['type'] == 'date' && $filter[$comparisonKey] == 'eq') {
-                        $maxTime = $filter['value'] + (86400 - 1); //specifies the top point of the range used in the condition
-                        $dateCondition = '`' . $filter[$propertyKey] . '` ' . ' BETWEEN ' . $db->quote($filter['value']) . ' AND ' . $db->quote($maxTime);
-                        $conditions[] = $dateCondition;
-                    } else {
-                        $field = '`'.$filter[$propertyKey].'` ';
-                        $conditions[] = $field.$operator.' '.$db->quote($value);
-                    }
-                }
-            }
-        }
-        if ($request->get('cid') && $request->get('ctype')) {
-            $conditions[] = '(cid = ' . $list->quote($request->get('cid')) . ' AND ctype = ' . $list->quote($request->get('ctype')) . ')';
-        }
-        if (!empty($conditions)) {
-            $condition = implode(' AND ', $conditions);
-            $list->setCondition($condition);
-        }
-        $list->load();
-        $notes = [];
-        foreach ($list->getNotes() as $note) {
-            $e = Element\Service::getNoteData($note);
-            $notes[] = $e;
-        }
-        return $this->adminJson([
-            'data' => $notes,
-            'success' => true,
-            'total' => $list->getTotalCount(),
-        ]);
-    }
-    /**
-     * @Route("/element/note-add", name="pimcore_admin_element_noteadd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function noteAddAction(Request $request)
-    {
-        $this->checkPermission('notes_events');
-        $note = new Element\Note();
-        $note->setCid((int) $request->get('cid'));
-        $note->setCtype($request->get('ctype'));
-        $note->setDate(time());
-        $note->setTitle($request->get('title'));
-        $note->setDescription($request->get('description'));
-        $note->setType($request->get('type'));
-        $note->save();
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/element/find-usages", name="pimcore_admin_element_findusages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function findUsagesAction(Request $request)
-    {
-        $element = null;
-        if ($request->get('id')) {
-            $element = Element\Service::getElementById($request->get('type'), $request->get('id'));
-        } elseif ($request->get('path')) {
-            $element = Element\Service::getElementByPath($request->get('type'), $request->get('path'));
-        }
-        $results = [];
-        $success = false;
-        $hasHidden = false;
-        $total = 0;
-        $limit = (int)$request->get('limit', 50);
-        $offset = (int)$request->get('start', 0);
-        if ($element instanceof Element\ElementInterface) {
-            $total = $element->getDependencies()->getRequiredByTotalCount();
-            if ($request->get('sort')) {
-                $sort = json_decode($request->get('sort'))[0];
-                $orderBy = $sort->property;
-                $orderDirection = $sort->direction;
-            } else {
-                $orderBy = null;
-                $orderDirection = null;
-            }
-            $queryOffset = $offset;
-            $queryLimit = $limit;
-            while (count($results) < min($limit, $total) && $queryOffset < $total) {
-                $elements = $element->getDependencies()
-                    ->getRequiredByWithPath($queryOffset, $queryLimit, $orderBy, $orderDirection);
-                foreach ($elements as $el) {
-                    $item = Element\Service::getElementById($el['type'], $el['id']);
-                    if ($item instanceof Element\ElementInterface) {
-                        if ($item->isAllowed('list')) {
-                            $results[] = $el;
-                        } else {
-                            $hasHidden = true;
-                        }
-                    }
-                }
-                $queryOffset += count($elements);
-                $queryLimit = $limit - count($results);
-            }
-            $success = true;
-        }
-        return $this->adminJson([
-            'data' => $results,
-            'total' => $total,
-            'hasHidden' => $hasHidden,
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/element/get-replace-assignments-batch-jobs", name="pimcore_admin_element_getreplaceassignmentsbatchjobs", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return \Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse
-     */
-    public function getReplaceAssignmentsBatchJobsAction(Request $request)
-    {
-        $element = null;
-        if ($request->get('id')) {
-            $element = Element\Service::getElementById($request->get('type'), $request->get('id'));
-        } elseif ($request->get('path')) {
-            $element = Element\Service::getElementByPath($request->get('type'), $request->get('path'));
-        }
-        if ($element instanceof Element\ElementInterface) {
-            return $this->adminJson([
-                'success' => true,
-                'jobs' => $element->getDependencies()->getRequiredBy(),
-            ]);
-        } else {
-            return $this->adminJson(['success' => false], Response::HTTP_NOT_FOUND);
-        }
-    }
-    /**
-     * @Route("/element/replace-assignments", name="pimcore_admin_element_replaceassignments", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function replaceAssignmentsAction(Request $request)
-    {
-        $success = false;
-        $message = '';
-        $element = Element\Service::getElementById($request->get('type'), $request->get('id'));
-        $sourceEl = Element\Service::getElementById($request->get('sourceType'), $request->get('sourceId'));
-        $targetEl = Element\Service::getElementById($request->get('targetType'), $request->get('targetId'));
-        if ($element && $sourceEl && $targetEl
-            && $request->get('sourceType') == $request->get('targetType')
-            && $sourceEl->getType() == $targetEl->getType()
-            && $element->isAllowed('save')
-        ) {
-            $rewriteConfig = [
-                $request->get('sourceType') => [
-                    $sourceEl->getId() => $targetEl->getId(),
-                ],
-            ];
-            if ($element instanceof Document) {
-                $element = Document\Service::rewriteIds($element, $rewriteConfig);
-            } elseif ($element instanceof DataObject\AbstractObject) {
-                $element = DataObject\Service::rewriteIds($element, $rewriteConfig);
-            } elseif ($element instanceof Asset) {
-                $element = Asset\Service::rewriteIds($element, $rewriteConfig);
-            }
-            $element->setUserModification($this->getAdminUser()->getId());
-            $element->save();
-            $success = true;
-        } else {
-            $message = 'source-type and target-type do not match';
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'message' => $message,
-        ]);
-    }
-    /**
-     * @Route("/element/unlock-propagate", name="pimcore_admin_element_unlockpropagate", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function unlockPropagateAction(Request $request)
-    {
-        $success = false;
-        $element = Element\Service::getElementById($request->get('type'), $request->get('id'));
-        if ($element) {
-            $element->unlockPropagate();
-            $success = true;
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/element/type-path", name="pimcore_admin_element_typepath", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function typePathAction(Request $request)
-    {
-        $id = $request->get('id');
-        $type = $request->get('type');
-        $data = [];
-        if ($type === 'asset') {
-            $element = Asset::getById($id);
-        } elseif ($type === 'document') {
-            $element = Document::getById($id);
-        } else {
-            $element = DataObject::getById($id);
-        }
-        if (!$element) {
-            $data['success'] = false;
-            return $this->adminJson($data);
-        }
-        $typePath = Element\Service::getTypePath($element);
-        $data['success'] = true;
-        $data['index'] = method_exists($element, 'getIndex') ? (int) $element->getIndex() : 0;
-        $data['idPath'] = Element\Service::getIdPath($element);
-        $data['typePath'] = $typePath;
-        $data['fullpath'] = $element->getRealFullPath();
-        if ($type !== 'asset') {
-            $sortIndexPath = Element\Service::getSortIndexPath($element);
-            $data['sortIndexPath'] = $sortIndexPath;
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/element/version-update", name="pimcore_admin_element_versionupdate", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function versionUpdateAction(Request $request)
-    {
-        $data = $this->decodeJson($request->get('data'));
-        $version = Version::getById($data['id']);
-        if ($data['public'] != $version->getPublic() || $data['note'] != $version->getNote()) {
-            $version->setPublic($data['public']);
-            $version->setNote($data['note']);
-            $version->save();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/element/get-nice-path", name="pimcore_admin_element_getnicepath", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getNicePathAction(Request $request)
-    {
-        $source = $this->decodeJson($request->get('source'));
-        if ($source['type'] != 'object') {
-            throw new \Exception('currently only objects as source elements are supported');
-        }
-        $result = [];
-        $id = $source['id'];
-        $source = DataObject\Concrete::getById($id);
-        if ($request->get('context')) {
-            $context = $this->decodeJson($request->get('context'));
-        } else {
-            $context = [];
-        }
-        $ownerType = $context['containerType'];
-        $fieldname = $context['fieldname'];
-        $fd = $this->getNicePathFormatterFieldDefinition($source, $context);
-        $targets = $this->decodeJson($request->get('targets'));
-        $result = $this->convertResultWithPathFormatter($source, $context, $result, $targets);
-        if ($request->get('loadEditModeData') == 'true') {
-            $idProperty = $request->get('idProperty', 'id');
-            $methodName = 'get' . ucfirst($fieldname);
-            if ($ownerType == 'object' && method_exists($source, $methodName)) {
-                $data = $source->$methodName();
-                $editModeData = $fd->getDataForEditmode($data, $source);
-                if (is_array($editModeData) && !empty($editModeData)) {
-                    foreach ($editModeData as $relationObjectAttribute) {
-                        $relationObjectAttribute['$$nicepath'] =
-                            isset($relationObjectAttribute[$idProperty]) && isset($result[$relationObjectAttribute[$idProperty]]) ? $result[$relationObjectAttribute[$idProperty]] : null;
-                        $result[$relationObjectAttribute[$idProperty]] = $relationObjectAttribute;
-                    }
-                } else {
-                    foreach ($result as $resultItemId => $resultItem) {
-                        $result[$resultItemId] = ['$$nicepath' => $resultItem];
-                    }
-                }
-            } else {
-                Logger::error('Loading edit mode data is not supported for ownertype: ' . $ownerType);
-            }
-        }
-        return $this->adminJson(['success' => true, 'data' => $result]);
-    }
-    /**
-     * @Route("/element/get-versions", name="pimcore_admin_element_getversions", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getVersionsAction(Request $request)
-    {
-        $id = (int)$request->get('id');
-        $type = $request->get('elementType');
-        $allowedTypes = ['asset', 'document', 'object'];
-        if ($id && in_array($type, $allowedTypes)) {
-            $element = Model\Element\Service::getElementById($type, $id);
-            if ($element) {
-                if ($element->isAllowed('versions')) {
-                    $schedule = $element->getScheduledTasks();
-                    $schedules = [];
-                    foreach ($schedule as $task) {
-                        if ($task->getActive()) {
-                            $schedules[$task->getVersion()] = $task->getDate();
-                        }
-                    }
-                    $list = new Version\Listing();
-                    $list->setLoadAutoSave(true);
-                    $list->setCondition('cid = ? AND ctype = ? AND (autoSave=0 OR (autoSave=1 AND userId = ?)) ', [
-                        $element->getId(),
-                        Element\Service::getType($element),
-                        $this->getUser()->getId(),
-                    ])
-                        ->setOrderKey('date')
-                        ->setOrder('ASC');
-                    $versions = $list->load();
-                    $versions = Model\Element\Service::getSafeVersionInfo($versions);
-                    $versions = array_reverse($versions); //reverse array to sort by ID DESC
-                    foreach ($versions as &$version) {
-                        $version['scheduled'] = null;
-                        if (array_key_exists($version['id'], $schedules)) {
-                            $version['scheduled'] = $schedules[$version['id']];
-                        }
-                    }
-                    return $this->adminJson(['versions' => $versions]);
-                } else {
-                    throw $this->createAccessDeniedException('Permission denied, ' . $type . ' id [' . $id . ']');
-                }
-            } else {
-                throw $this->createNotFoundException($type . ' with id [' . $id . "] doesn't exist");
-            }
-        }
-        throw $this->createNotFoundException('Element type not found');
-    }
-    /**
-     * @Route("/element/delete-draft", name="pimcore_admin_element_deletedraft", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteDraftAction(Request $request)
-    {
-        $version = Version::getById($request->get('id'));
-        if ($version) {
-            $version->delete();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/element/delete-version", name="pimcore_admin_element_deleteversion", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteVersionAction(Request $request)
-    {
-        $version = Model\Version::getById($request->get('id'));
-        $version->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/element/delete-all-versions", name="pimcore_admin_element_deleteallversion", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteAllVersionAction(Request $request)
-    {
-        $elementId = $request->get('id');
-        $elementModificationdate = $request->get('date');
-        $versions = new Model\Version\Listing();
-        $versions->setCondition('cid = ' . $versions->quote($elementId) . ' AND date <> ' . $versions->quote($elementModificationdate));
-        foreach ($versions->load() as $vkey => $version) {
-            $version->delete();
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/element/get-requires-dependencies", name="pimcore_admin_element_getrequiresdependencies", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getRequiresDependenciesAction(Request $request)
-    {
-        $id = $request->get('id');
-        $type = $request->get('elementType');
-        $allowedTypes = ['asset', 'document', 'object'];
-        $offset = $request->get('start');
-        $limit = $request->get('limit');
-        if ($id && in_array($type, $allowedTypes)) {
-            $element = Model\Element\Service::getElementById($type, $id);
-            $dependencies = $element->getDependencies();
-            if ($element instanceof Model\Element\ElementInterface) {
-                $dependenciesResult = Model\Element\Service::getRequiresDependenciesForFrontend($dependencies, $offset, $limit);
-                $dependenciesResult['start'] = $offset;
-                $dependenciesResult['limit'] = $limit;
-                $dependenciesResult['total'] = $dependencies->getRequiresTotalCount();
-                return $this->adminJson($dependenciesResult);
-            }
-        }
-        return $this->adminJson(false);
-    }
-    /**
-     * @Route("/element/get-required-by-dependencies", name="pimcore_admin_element_getrequiredbydependencies", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getRequiredByDependenciesAction(Request $request)
-    {
-        $id = $request->get('id');
-        $type = $request->get('elementType');
-        $allowedTypes = ['asset', 'document', 'object'];
-        $offset = $request->get('start');
-        $limit = $request->get('limit');
-        if ($id && in_array($type, $allowedTypes)) {
-            $element = Model\Element\Service::getElementById($type, $id);
-            $dependencies = $element->getDependencies();
-            if ($element instanceof Model\Element\ElementInterface) {
-                $dependenciesResult = Model\Element\Service::getRequiredByDependenciesForFrontend($dependencies, $offset, $limit);
-                $dependenciesResult['start'] = $offset;
-                $dependenciesResult['limit'] = $limit;
-                $dependenciesResult['total'] = $dependencies->getRequiredByTotalCount();
-                return $this->adminJson($dependenciesResult);
-            }
-        }
-        return $this->adminJson(false);
-    }
-    /**
-     * @Route("/element/get-predefined-properties", name="pimcore_admin_element_getpredefinedproperties", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getPredefinedPropertiesAction(Request $request)
-    {
-        $properties = [];
-        $type = $request->get('elementType');
-        $allowedTypes = ['asset', 'document', 'object'];
-        if (in_array($type, $allowedTypes)) {
-            $list = new Model\Property\Predefined\Listing();
-            $list->setFilter(function ($row) use ($type) {
-                if (is_array($row['ctype'])) {
-                    $row['ctype'] = implode(',', $row['ctype']);
-                }
-                if (strpos($row['ctype'], $type) !== false) {
-                    return true;
-                }
-                return false;
-            });
-            $list->load();
-            foreach ($list->getProperties() as $type) {
-                $properties[] = $type->getObjectVars();
-            }
-        }
-        return $this->adminJson(['properties' => $properties]);
-    }
-    /**
-     * @Route("/element/analyze-permissions", name="pimcore_admin_element_analyzepermissions", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function analyzePermissionsAction(Request $request)
-    {
-        $userId = $request->get('userId');
-        if ($userId) {
-            $user = Model\User::getById($userId);
-            $userList = [$user];
-        } else {
-            $userList = new Model\User\Listing();
-            $userList->setCondition('type = ?', ['user']);
-            $userList = $userList->load();
-        }
-        $elementType = $request->get('elementType');
-        $elementId = $request->get('elementId');
-        $element = Element\Service::getElementById($elementType, $elementId);
-        $result = Element\PermissionChecker::check($element, $userList);
-        return $this->adminJson(
-            [
-                'data' => $result,
-                'success' => true,
-            ]
-        );
-    }
-    /**
-     * @param DataObject\Concrete $source
-     * @param array $context
-     *
-     * @return bool|DataObject\ClassDefinition\Data|null
-     *
-     * @throws \Exception
-     */
-    protected function getNicePathFormatterFieldDefinition($source, $context)
-    {
-        $ownerType = $context['containerType'];
-        $fieldname = $context['fieldname'];
-        $fd = null;
-        if ($ownerType == 'object') {
-            $subContainerType = isset($context['subContainerType']) ? $context['subContainerType'] : null;
-            if ($subContainerType) {
-                $subContainerKey = $context['subContainerKey'];
-                $subContainer = $source->getClass()->getFieldDefinition($subContainerKey);
-                if (method_exists($subContainer, 'getFieldDefinition')) {
-                    $fd = $subContainer->getFieldDefinition($fieldname);
-                }
-            } else {
-                $fd = $source->getClass()->getFieldDefinition($fieldname);
-            }
-        } elseif ($ownerType == 'localizedfield') {
-            $localizedfields = $source->getClass()->getFieldDefinition('localizedfields');
-            if ($localizedfields instanceof DataObject\ClassDefinition\Data\Localizedfields) {
-                $fd = $localizedfields->getFieldDefinition($fieldname);
-            }
-        } elseif ($ownerType == 'objectbrick') {
-            $fdBrick = DataObject\Objectbrick\Definition::getByKey($context['containerKey']);
-            $fd = $fdBrick->getFieldDefinition($fieldname);
-        } elseif ($ownerType == 'fieldcollection') {
-            $containerKey = $context['containerKey'];
-            $fdCollection = DataObject\Fieldcollection\Definition::getByKey($containerKey);
-            if (($context['subContainerType'] ?? null) === 'localizedfield') {
-                /** @var DataObject\ClassDefinition\Data\Localizedfields $fdLocalizedFields */
-                $fdLocalizedFields = $fdCollection->getFieldDefinition('localizedfields');
-                $fd = $fdLocalizedFields->getFieldDefinition($fieldname);
-            } else {
-                $fd = $fdCollection->getFieldDefinition($fieldname);
-            }
-        }
-        return $fd;
-    }
-    /**
-     * @param DataObject\Concrete $source
-     * @param array $context
-     * @param array $result
-     * @param array $targets
-     *
-     * @return array
-     *
-     * @throws \Exception
-     */
-    protected function convertResultWithPathFormatter(DataObject\Concrete $source, $context, $result, $targets): array
-    {
-        $fd = $this->getNicePathFormatterFieldDefinition($source, $context);
-        if ($fd instanceof DataObject\ClassDefinition\PathFormatterAwareInterface) {
-            $formatter = $fd->getPathFormatterClass();
-            if (null !== $formatter) {
-                $pathFormatter = DataObject\ClassDefinition\Helper\PathFormatterResolver::resolvePathFormatter(
-                    $fd->getPathFormatterClass()
-                );
-                if ($pathFormatter instanceof DataObject\ClassDefinition\PathFormatterInterface) {
-                    $result = $pathFormatter->formatPath($result, $source, $targets, [
-                        'fd' => $fd,
-                        'context' => $context,
-                    ]);
-                }
-            }
-        }
-        return $result;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/ElementControllerBase.php
+++ b//dev/null
@@ -1,192 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Event\AssetEvents;
-use Pimcore\Event\DataObjectEvents;
-use Pimcore\Event\DocumentEvents;
-use Pimcore\Event\Model\AssetDeleteInfoEvent;
-use Pimcore\Event\Model\DataObjectDeleteInfoEvent;
-use Pimcore\Event\Model\DocumentDeleteInfoEvent;
-use Pimcore\Event\Model\ElementDeleteInfoEventInterface;
-use Pimcore\Logger;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject\AbstractObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element\ElementInterface;
-use Pimcore\Model\Element\Service;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @internal
- */
-abstract class ElementControllerBase extends AdminController
-{
-    /**
-     * @param ElementInterface $element
-     *
-     * @return array
-     */
-    protected function getTreeNodeConfig($element)
-    {
-        return [];
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetRootAction(Request $request)
-    {
-        $type = $request->get('elementType');
-        $allowedTypes = ['asset', 'document', 'object'];
-        $id = 1;
-        if ($request->get('id')) {
-            $id = (int)$request->get('id');
-        }
-        if (in_array($type, $allowedTypes)) {
-            /** @var Document|Asset|AbstractObject $root */
-            $root = Service::getElementById($type, $id);
-            if ($root->isAllowed('list')) {
-                return $this->adminJson($this->getTreeNodeConfig($root));
-            }
-        }
-        return $this->adminJson(['success' => false, 'message' => 'missing_permission']);
-    }
-    /**
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function deleteInfoAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $hasDependency = false;
-        $errors = false;
-        $deleteJobs = [];
-        $itemResults = [];
-        $totalChilds = 0;
-        $ids = $request->get('id');
-        $ids = explode(',', $ids);
-        $type = $request->get('type');
-        foreach ($ids as $id) {
-            try {
-                $element = Service::getElementById($type, $id);
-                if (!$element) {
-                    continue;
-                }
-                if (!$hasDependency) {
-                    $hasDependency = $element->getDependencies()->isRequired();
-                }
-            } catch (\Exception $e) {
-                Logger::err('failed to access element with id: ' . $id);
-                continue;
-            }
-            if ($element instanceof ElementInterface) {
-                $event = null;
-                $eventName = null;
-                if ($element instanceof Asset) {
-                    $event = new AssetDeleteInfoEvent($element);
-                    $eventName = AssetEvents::DELETE_INFO;
-                } elseif ($element instanceof Document) {
-                    $event = new DocumentDeleteInfoEvent($element);
-                    $eventName = DocumentEvents::DELETE_INFO;
-                } elseif ($element instanceof AbstractObject) {
-                    $event = new DataObjectDeleteInfoEvent($element);
-                    $eventName = DataObjectEvents::DELETE_INFO;
-                }
-                if ($event instanceof ElementDeleteInfoEventInterface) {
-                    $eventDispatcher->dispatch($event, $eventName);
-                    if (!$event->getDeletionAllowed()) {
-                        $itemResults[] = [
-                            'id' => $element->getId(),
-                            'type' => $element->getType(),
-                            'key' => $element->getKey(),
-                            'reason' => $event->getReason(),
-                            'allowed' => false,
-                        ];
-                        $errors |= true;
-                        continue;
-                    }
-                }
-                $itemResults[] = [
-                    'id' => $element->getId(),
-                    'type' => $element->getType(),
-                    'key' => $element->getKey(),
-                    'allowed' => true,
-                ];
-                $deleteJobs[] = [[
-                    'url' => $this->generateUrl('pimcore_admin_recyclebin_add'),
-                    'method' => 'POST',
-                    'params' => [
-                        'type' => $type,
-                        'id' => $element->getId(),
-                    ],
-                ]];
-                $hasChilds = $element->hasChildren();
-                if (!$hasDependency) {
-                    $hasDependency = $hasChilds;
-                }
-                if ($hasChilds) {
-                    $list = $element::getList(['unpublished' => true]);
-                    $pathColumn = ($type === 'object') ? 'o_path' : 'path';
-                    $list->setCondition($pathColumn . ' LIKE ?', [$element->getRealFullPath() . '/%']);
-                    $childs = $list->getTotalCount();
-                    $totalChilds += $childs;
-                    if ($childs > 0) {
-                        $deleteObjectsPerRequest = 5;
-                        for ($i = 0, $iMax = ceil($childs / $deleteObjectsPerRequest); $i < $iMax; $i++) {
-                            $deleteJobs[] = [[
-                                'url' => $request->getBaseUrl() . '/admin/' . $type . '/delete',
-                                'method' => 'DELETE',
-                                'params' => [
-                                    'step' => $i,
-                                    'amount' => $deleteObjectsPerRequest,
-                                    'type' => 'childs',
-                                    'id' => $element->getId(),
-                                ],
-                            ]];
-                        }
-                    }
-                }
-                $deleteJobs[] = [[
-                    'url' => $request->getBaseUrl() . '/admin/' . $type . '/delete',
-                    'method' => 'DELETE',
-                    'params' => [
-                        'id' => $element->getId(),
-                    ],
-                ]];
-            }
-        }
-        $elementKey = false;
-        if (count($ids) === 1) {
-            $element = Service::getElementById($type, $ids[0]);
-            if ($element instanceof ElementInterface) {
-                $elementKey = $element->getKey();
-            }
-        }
-        return $this->adminJson([
-            'hasDependencies' => $hasDependency,
-            'childs' => $totalChilds,
-            'deletejobs' => $deleteJobs,
-            'batchDelete' => count($ids) > 1,
-            'elementKey' => $elementKey,
-            'errors' => $errors,
-            'itemResults' => $itemResults,
-        ]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/EmailController.php
+++ b//dev/null
@@ -1,459 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Logger;
-use Pimcore\Mail;
-use Pimcore\Model\Element\ElementInterface;
-use Pimcore\Model\Tool;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Profiler\Profiler;
-use Symfony\Component\Mime\Address;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/email")
- *
- * @internal
- */
-class EmailController extends AdminController
-{
-    /**
-     * @Route("/email-logs", name="pimcore_admin_email_emaillogs", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function emailLogsAction(Request $request)
-    {
-        if (!$this->getAdminUser()->isAllowed('emails') && !$this->getAdminUser()->isAllowed('gdpr_data_extractor')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        $list = new Tool\Email\Log\Listing();
-        if ($request->get('documentId')) {
-            $list->setCondition('documentId = ' . (int)$request->get('documentId'));
-        }
-        $list->setLimit($request->get('limit'));
-        $list->setOffset($request->get('start'));
-        $list->setOrderKey('sentDate');
-        if ($request->get('filter')) {
-            if ($request->get('filter')) {
-                $filterTerm = $request->get('filter');
-                if ($filterTerm == '*') {
-                    $filterTerm = '';
-                }
-                $filterTerm = str_replace('%', '*', $filterTerm);
-                $filterTerm = htmlspecialchars($filterTerm, ENT_QUOTES);
-                if (strpos($filterTerm, '@')) {
-                    $parts = explode(' ', $filterTerm);
-                    $parts = array_map(function ($part) {
-                        if (strpos($part, '@')) {
-                            $part = '"' . $part . '"';
-                        }
-                        return $part;
-                    }, $parts);
-                    $filterTerm = implode(' ', $parts);
-                }
-                $condition = '( MATCH (`from`,`to`,`cc`,`bcc`,`subject`,`params`) AGAINST (' . $list->quote($filterTerm) . ' IN BOOLEAN MODE) )';
-                if ($request->get('documentId')) {
-                    $condition .= 'AND documentId = ' . (int)$request->get('documentId');
-                }
-                $list->setCondition($condition);
-            }
-        }
-        $list->setOrder('DESC');
-        $data = $list->load();
-        $jsonData = [];
-        if (is_array($data)) {
-            foreach ($data as $entry) {
-                $tmp = $entry->getObjectVars();
-                unset($tmp['bodyHtml']);
-                unset($tmp['bodyText']);
-                $jsonData[] = $tmp;
-            }
-        }
-        return $this->adminJson([
-            'data' => $jsonData,
-            'success' => true,
-            'total' => $list->getTotalCount(),
-        ]);
-    }
-    /**
-     * @Route("/show-email-log", name="pimcore_admin_email_showemaillog", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Profiler $profiler
-     *
-     * @return JsonResponse|Response
-     *
-     * @throws \Exception
-     */
-    public function showEmailLogAction(Request $request, ?Profiler $profiler)
-    {
-        if ($profiler) {
-            $profiler->disable();
-        }
-        if (!$this->getAdminUser()->isAllowed('emails')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        $type = $request->get('type');
-        $emailLog = Tool\Email\Log::getById($request->get('id'));
-        if ($request->get('type') == 'text') {
-            return $this->render('@PimcoreAdmin/Admin/Email/text.html.twig', ['log' => $emailLog->getTextLog()]);
-        } elseif ($request->get('type') == 'html') {
-            return new Response($emailLog->getHtmlLog(), 200, [
-                'Content-Security-Policy' => "default-src 'self'; style-src 'self' 'unsafe-inline'",
-            ]);
-        } elseif ($request->get('type') == 'params') {
-            try {
-                $params = $this->decodeJson($emailLog->getParams());
-            } catch (\Exception $e) {
-                Logger::warning('Could not decode JSON param string');
-                $params = [];
-            }
-            foreach ($params as &$entry) {
-                $this->enhanceLoggingData($entry);
-            }
-            return $this->adminJson($params);
-        } elseif ($request->get('type') == 'details') {
-            $data = $emailLog->getObjectVars();
-            return $this->adminJson($data);
-        } else {
-            return new Response('No Type specified');
-        }
-    }
-    /**
-     * @param array $data
-     * @param array $fullEntry
-     */
-    protected function enhanceLoggingData(&$data, &$fullEntry = null)
-    {
-        if (!empty($data['objectClass'])) {
-            $class = '\\' . ltrim($data['objectClass'], '\\');
-            $reflection = new \ReflectionClass($class);
-            if (!empty($data['objectId']) && $reflection->implementsInterface(ElementInterface::class)) {
-                $obj = $class::getById($data['objectId']);
-                if (is_null($obj)) {
-                    $data['objectPath'] = '';
-                } else {
-                    $data['objectPath'] = $obj->getRealFullPath();
-                }
-                if (stristr($class, '\\Pimcore\\Model') === false) {
-                    $niceClassName = '\\' . ltrim($reflection->getParentClass()->getName(), '\\');
-                } else {
-                    $niceClassName = $class;
-                }
-                $niceClassName = str_replace('\\Pimcore\\Model\\', '', $niceClassName);
-                $niceClassName = str_replace('_', '\\', $niceClassName);
-                $tmp = explode('\\', $niceClassName);
-                if (in_array($tmp[0], ['DataObject', 'Document', 'Asset'])) {
-                    $data['objectClassBase'] = $tmp[0];
-                    $data['objectClassSubType'] = $tmp[1];
-                }
-            }
-        }
-        foreach ($data as &$value) {
-            if (is_array($value)) {
-                $this->enhanceLoggingData($value, $data);
-            }
-        }
-        if ($data['children'] ?? false) {
-            foreach ($data['children'] as $key => $entry) {
-                if (is_string($key)) { //key must be integers
-                    unset($data['children'][$key]);
-                }
-            }
-            $data['iconCls'] = 'pimcore_icon_folder';
-            $data['data'] = ['type' => 'simple', 'value' => 'Children (' . count($data['children']) . ')'];
-        } else {
-            if (empty($data['iconCls'])) {
-                if (($data['objectClassBase'] ?? '') == 'DataObject') {
-                    $fullEntry['iconCls'] = 'pimcore_icon_object';
-                } elseif (($data['objectClassBase'] ?? '') == 'Asset') {
-                    switch ($data['objectClassSubType']) {
-                        case 'Image':
-                            $fullEntry['iconCls'] = 'pimcore_icon_image';
-                            break;
-                        case 'Video':
-                            $fullEntry['iconCls'] = 'pimcore_icon_wmv';
-                            break;
-                        case 'Text':
-                            $fullEntry['iconCls'] = 'pimcore_icon_txt';
-                            break;
-                        case 'Document':
-                            $fullEntry['iconCls'] = 'pimcore_icon_pdf';
-                            break;
-                        default:
-                            $fullEntry['iconCls'] = 'pimcore_icon_asset';
-                    }
-                } elseif (strpos($data['objectClass'] ?? '', 'Document') === 0) {
-                    $fullEntry['iconCls'] = 'pimcore_icon_' . strtolower($data['objectClassSubType']);
-                } else {
-                    $data['iconCls'] = 'pimcore_icon_text';
-                }
-            }
-            $data['leaf'] = true;
-        }
-    }
-    /**
-     * @Route("/delete-email-log", name="pimcore_admin_email_deleteemaillog", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function deleteEmailLogAction(Request $request)
-    {
-        if (!$this->getAdminUser()->isAllowed('emails')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        $success = false;
-        $emailLog = Tool\Email\Log::getById($request->get('id'));
-        if ($emailLog instanceof Tool\Email\Log) {
-            $emailLog->delete();
-            $success = true;
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/resend-email", name="pimcore_admin_email_resendemail", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function resendEmailAction(Request $request)
-    {
-        if (!$this->getAdminUser()->isAllowed('emails')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        $success = false;
-        $emailLog = Tool\Email\Log::getById($request->get('id'));
-        if ($emailLog instanceof Tool\Email\Log) {
-            $mail = new Mail();
-            $mail->preventDebugInformationAppending();
-            $mail->setIgnoreDebugMode(true);
-            if (!empty($request->get('to'))) {
-                $emailLog->setTo(null);
-                $emailLog->setCc(null);
-                $emailLog->setBcc(null);
-            } else {
-                $mail->disableLogging();
-            }
-            if ($html = $emailLog->getHtmlLog()) {
-                $mail->html($html);
-            }
-            if ($text = $emailLog->getTextLog()) {
-                $mail->text($text);
-            }
-            foreach (['From', 'To', 'Cc', 'Bcc', 'ReplyTo'] as $field) {
-                if (!$values = $request->get(strtolower($field))) {
-                    $getter = 'get' . $field;
-                    $values = $emailLog->{$getter}();
-                }
-                $values = \Pimcore\Helper\Mail::parseEmailAddressField($values);
-                if (!empty($values)) {
-                    list($value) = $values;
-                    if ($value) {
-                        $prefix = 'add';
-                        $mail->{$prefix . $field}(new Address($value['email'], $value['name'] ?? ''));
-                    }
-                }
-            }
-            $mail->setSubject($emailLog->getSubject());
-            if ($emailLog->getDocumentId()) {
-                $mail->setDocument($emailLog->getDocumentId());
-            }
-            try {
-                $params = $this->decodeJson($emailLog->getParams());
-            } catch (\Exception $e) {
-                Logger::warning('Could not decode JSON param string');
-                $params = [];
-            }
-            foreach ($params as $entry) {
-                $data = null;
-                $hasChildren = isset($entry['children']) && is_array($entry['children']);
-                if ($hasChildren) {
-                    $childData = [];
-                    foreach ($entry['children'] as $childParam) {
-                        $childData[$childParam['key']] = $this->parseLoggingParamObject($childParam);
-                    }
-                    $data = $childData;
-                } else {
-                    $data = $this->parseLoggingParamObject($entry);
-                }
-                $mail->setParam($entry['key'], $data);
-            }
-            $mail->send();
-            $success = true;
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/send-test-email", name="pimcore_admin_email_sendtestemail", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function sendTestEmailAction(Request $request)
-    {
-        if (!$this->getAdminUser()->isAllowed('emails')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        $mail = new Mail();
-        if ($from = $request->get('from')) {
-            $addressArray = \Pimcore\Helper\Mail::parseEmailAddressField($from);
-            if ($addressArray) {
-                list($cleanedFromAddress) = $addressArray;
-                $mail->from(new Address($cleanedFromAddress['email'], $cleanedFromAddress['name'] ?? ''));
-            }
-        }
-        $toAddresses = \Pimcore\Helper\Mail::parseEmailAddressField($request->get('to'));
-        foreach ($toAddresses as $cleanedToAddress) {
-            $mail->addTo($cleanedToAddress['email'], $cleanedToAddress['name'] ?? '');
-        }
-        $mail->setSubject($request->get('subject'));
-        $mail->setIgnoreDebugMode(true);
-        if ($request->get('emailType') == 'text') {
-            $mail->text($request->get('content'));
-        } elseif ($request->get('emailType') == 'html') {
-            $mail->html($request->get('content'));
-        } elseif ($request->get('emailType') == 'document') {
-            $doc = \Pimcore\Model\Document::getByPath($request->get('documentPath'));
-            if ($doc instanceof \Pimcore\Model\Document\Email || $doc instanceof \Pimcore\Model\Document\Newsletter) {
-                $mail->setDocument($doc);
-                if ($request->get('mailParamaters')) {
-                    if ($mailParamsArray = json_decode($request->get('mailParamaters'), true)) {
-                        foreach ($mailParamsArray as $mailParam) {
-                            if ($mailParam['key']) {
-                                $mail->setParam($mailParam['key'], $mailParam['value']);
-                            }
-                        }
-                    }
-                }
-            } else {
-                throw new \Exception('Email document not found!');
-            }
-        }
-        $mail->send();
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/blacklist", name="pimcore_admin_email_blacklist", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function blacklistAction(Request $request)
-    {
-        if (!$this->getAdminUser()->isAllowed('emails')) {
-            throw new \Exception("Permission denied, user needs 'emails' permission.");
-        }
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            if (is_array($data)) {
-                foreach ($data as &$value) {
-                    if (is_string($value)) {
-                        $value = trim($value);
-                    }
-                }
-            }
-            if ($request->get('xaction') == 'destroy') {
-                $address = Tool\Email\Blacklist::getByAddress($data['address']);
-                $address->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $address = Tool\Email\Blacklist::getByAddress($data['address']);
-                $address->setValues($data);
-                $address->save();
-                return $this->adminJson(['data' => $address->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                unset($data['id']);
-                $address = new Tool\Email\Blacklist();
-                $address->setValues($data);
-                $address->save();
-                return $this->adminJson(['data' => $address->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Tool\Email\Blacklist\Listing();
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($request->query->all());
-            if ($sortingSettings['orderKey']) {
-                $orderKey = $sortingSettings['orderKey'];
-            }
-            if ($sortingSettings['order']) {
-                $order = $sortingSettings['order'];
-            }
-            if ($request->get('filter')) {
-                $list->setCondition('`address` LIKE ' . $list->quote('%'.$request->get('filter').'%'));
-            }
-            $data = $list->load();
-            $jsonData = [];
-            if (is_array($data)) {
-                foreach ($data as $entry) {
-                    $jsonData[] = $entry->getObjectVars();
-                }
-            }
-            return $this->adminJson([
-                'success' => true,
-                'data' => $jsonData,
-                'total' => $list->getTotalCount(),
-            ]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param array $params
-     *
-     * @return array
-     */
-    protected function parseLoggingParamObject($params)
-    {
-        $data = null;
-        if ($params['data']['type'] === 'object') {
-            $class = '\\' . ltrim($params['data']['objectClass'], '\\');
-            $reflection = new \ReflectionClass($class);
-            if (!empty($params['data']['objectId']) && $reflection->implementsInterface(ElementInterface::class)) {
-                $obj = $class::getById($params['data']['objectId']);
-                if (!is_null($obj)) {
-                    $data = $obj;
-                }
-            }
-        } else {
-            $data = $params['data']['value'];
-        }
-        return $data;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/External/AdminerController.php
+++ b//dev/null
@@ -1,229 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\External {
-    use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-    use Pimcore\Controller\KernelControllerEventInterface;
-    use Pimcore\Tool\Session;
-    use Symfony\Component\HttpFoundation\Request;
-    use Symfony\Component\HttpFoundation\Response;
-    use Symfony\Component\HttpKernel\Event\ControllerEvent;
-    use Symfony\Component\HttpKernel\Profiler\Profiler;
-    use Symfony\Component\Routing\Annotation\Route;
-    /**
-     * @internal
-     */
-    class AdminerController extends AdminController implements KernelControllerEventInterface
-    {
-        /**
-         * @var string
-         */
-        protected $adminerHome = '';
-        /**
-         * @Route("/external_adminer/adminer", name="pimcore_admin_external_adminer_adminer")
-         *
-         * @param Request $request
-         * @param Profiler $profiler
-         *
-         * @return Response
-         */
-        public function adminerAction(Request $request, ?Profiler $profiler)
-        {
-            if ($profiler) {
-                $profiler->disable();
-            }
-            $errorHandler = set_error_handler(function () {
-            });
-            chdir($this->adminerHome . 'adminer');
-            include($this->adminerHome . 'adminer/index.php');
-            set_error_handler($errorHandler);
-            $response = new Response();
-            return $this->mergeAdminerHeaders($response);
-        }
-        /**
-         * @Route("/external_adminer/{path}", name="pimcore_admin_external_adminer_proxy", requirements={"path"=".*"})
-         * @Route("/adminer/{path}", name="pimcore_admin_external_adminer_proxy_1", requirements={"path"=".*"})
-         * @Route("/externals/{path}", name="pimcore_admin_external_adminer_proxy_2", requirements={"path"=".*"}, defaults={"type": "external"})
-         *
-         * @param Request $request
-         *
-         * @return Response
-         */
-        public function proxyAction(Request $request)
-        {
-            $response = new Response();
-            $content = '';
-            $path = $request->get('path');
-            if (preg_match("@\.(css|js|ico|png|jpg|gif)$@", $path)) {
-                if ($request->get('type') == 'external') {
-                    $path = '../' . $path;
-                }
-                if (strpos($path, 'static/') === 0) {
-                    $path = 'adminer/' . $path;
-                }
-                $filePath = $this->adminerHome . '/' . $path;
-                if (preg_match('@.css$@', $path)) {
-                    $response->headers->set('Content-Type', 'text/css');
-                } elseif (preg_match('@.js$@', $path)) {
-                    $response->headers->set('Content-Type', 'text/javascript');
-                }
-                if (file_exists($filePath)) {
-                    $content = file_get_contents($filePath);
-                    if (preg_match('@default.css$@', $path)) {
-                        $content .= file_get_contents($this->adminerHome . 'designs/konya/adminer.css');
-                        $content .= file_get_contents(PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin/css/adminer-modifications.css');
-                    }
-                }
-            }
-            $response->setContent($content);
-            return $this->mergeAdminerHeaders($response);
-        }
-        /**
-         * @param ControllerEvent $event
-         */
-        public function onKernelControllerEvent(ControllerEvent $event)
-        {
-            $isMasterRequest = $event->isMasterRequest();
-            if (!$isMasterRequest) {
-                return;
-            }
-            $request = $event->getRequest();
-            ini_set('display_errors', 0);
-            $this->checkPermission('adminer');
-            $session = Session::get();
-            $this->adminerHome = PIMCORE_COMPOSER_PATH . '/vrana/adminer/';
-        }
-        /**
-         * Merges http-headers set from Adminer via headers function
-         * to the Symfony Response Object
-         *
-         * @param Response $response
-         *
-         * @return Response
-         */
-        protected function mergeAdminerHeaders(Response $response)
-        {
-            if (!headers_sent()) {
-                $headersRaw = headers_list();
-                foreach ($headersRaw as $header) {
-                    $header = explode(':', $header, 2);
-                    list($headerKey, $headerValue) = $header;
-                    if ($headerKey && $headerValue) {
-                        $response->headers->set($headerKey, $headerValue);
-                    }
-                }
-                header_remove();
-            }
-            return $response;
-        }
-    }
-}
-namespace {
-    use Pimcore\Cache;
-    use Pimcore\Tool\Session;
-    if (!function_exists('adminer_object')) {
-        /**
-         * @return AdminerPimcore
-         */
-        function adminer_object()
-        {
-            $pluginDir = PIMCORE_COMPOSER_PATH . '/vrana/adminer/plugins';
-            include_once $pluginDir . '/plugin.php';
-            foreach (glob($pluginDir . '/*.php') as $filename) {
-                include_once $filename;
-            }
-            $plugins = [
-                new \AdminerFrames(),
-                new \AdminerDumpDate,
-                new \AdminerDumpJson,
-                new \AdminerDumpBz2,
-                new \AdminerDumpZip,
-                new \AdminerDumpXml,
-                new \AdminerDumpAlter,
-            ];
-            class AdminerPimcore extends \AdminerPlugin
-            {
-                /**
-                 * @return string
-                 */
-                public function name()
-                {
-                    return '';
-                }
-                public function loginForm()
-                {
-                    parent::loginForm();
-                    echo '<script' . nonce() . ">document.querySelector('input[name=auth\\\\[db\\\\]]').value='" . $this->database() . "'; document.querySelector('form').submit()</script>";
-                }
-                /**
-                 * @param bool $create
-                 *
-                 * @return string
-                 */
-                public function permanentLogin($create = false)
-                {
-                    return Session::getSessionId();
-                }
-                /**
-                 * @param string $login
-                 * @param string $password
-                 *
-                 * @return bool
-                 */
-                public function login($login, $password)
-                {
-                    return true;
-                }
-                /**
-                 * @return array
-                 */
-                public function credentials()
-                {
-                    $params = \Pimcore\Db::get()->getParams();
-                    $host = $params['host'] ?? null;
-                    if ($port = $params['port'] ?? null) {
-                        $host .= ':' . $port;
-                    }
-                    $result = [
-                        $host,
-                        $params['user'] ?? null,
-                        $params['password'] ?? null,
-                    ];
-                    return $result;
-                }
-                /**
-                 * @return mixed
-                 */
-                public function database()
-                {
-                    $db = \Pimcore\Db::get();
-                    return $db->getDatabase();
-                }
-                public function databases($flush = true)
-                {
-                    $cacheKey = 'pimcore_adminer_databases';
-                    if (!$return = Cache::load($cacheKey)) {
-                        $db = Pimcore\Db::get();
-                        $return = $db->fetchAll('SELECT SCHEMA_NAME FROM information_schema.SCHEMATA');
-                        foreach ($return as &$ret) {
-                            $ret = $ret['SCHEMA_NAME'];
-                        }
-                        Cache::save($return, $cacheKey);
-                    }
-                    return $return;
-                }
-            }
-            return new AdminerPimcore($plugins);
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/External/OpcacheController.php
+++ b//dev/null
@@ -1,57 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin\External;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Profiler\Profiler;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @internal
- */
-class OpcacheController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/external_opcache", name="pimcore_admin_external_opcache_index")
-     *
-     * @param Request $request
-     * @param Profiler $profiler
-     *
-     * @return Response
-     */
-    public function indexAction(Request $request, ?Profiler $profiler)
-    {
-        if ($profiler) {
-            $profiler->disable();
-        }
-        $path = PIMCORE_COMPOSER_PATH . '/amnuts/opcache-gui';
-        ob_start();
-        include($path . '/index.php');
-        $content = ob_get_clean();
-        return new Response($content);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkPermission('opcache');
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/IndexController.php
+++ b//dev/null
@@ -1,332 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Analytics\Google\Config\SiteConfigProvider;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Bundle\AdminBundle\Security\CsrfProtectionHandler;
-use Pimcore\Config;
-use Pimcore\Controller\KernelResponseEventInterface;
-use Pimcore\Db\ConnectionInterface;
-use Pimcore\Event\Admin\IndexActionSettingsEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Extension\Bundle\PimcoreBundleManager;
-use Pimcore\Google;
-use Pimcore\Maintenance\Executor;
-use Pimcore\Maintenance\ExecutorInterface;
-use Pimcore\Model\Element\Service;
-use Pimcore\Model\User;
-use Pimcore\Tool;
-use Pimcore\Tool\Admin;
-use Pimcore\Tool\Session;
-use Pimcore\Version;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpKernel\Event\ResponseEvent;
-use Symfony\Component\HttpKernel\KernelInterface;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @internal
- */
-class IndexController extends AdminController implements KernelResponseEventInterface
-{
-    /**
-     * @var EventDispatcherInterface
-     */
-    private $eventDispatcher;
-    /**
-     * @param EventDispatcherInterface $eventDispatcher
-     */
-    public function __construct(EventDispatcherInterface $eventDispatcher)
-    {
-        $this->eventDispatcher = $eventDispatcher;
-    }
-    /**
-     * @Route("/", name="pimcore_admin_index", methods={"GET"})
-     *
-     * @param Request $request
-     * @param SiteConfigProvider $siteConfigProvider
-     * @param KernelInterface $kernel
-     * @param Executor $maintenanceExecutor
-     * @param CsrfProtectionHandler $csrfProtection
-     * @param Config $config
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function indexAction(
-        Request $request,
-        SiteConfigProvider $siteConfigProvider,
-        KernelInterface $kernel,
-        Executor $maintenanceExecutor,
-        CsrfProtectionHandler $csrfProtection,
-        Config $config
-    ) {
-        $user = $this->getAdminUser();
-        $templateParams = [
-            'config' => $config,
-        ];
-        $this
-            ->addRuntimePerspective($templateParams, $user)
-            ->addPluginAssets($templateParams);
-        $this->buildPimcoreSettings($request, $templateParams, $user, $kernel, $maintenanceExecutor, $csrfProtection, $siteConfigProvider);
-        if ($user->getTwoFactorAuthentication('required') && !$user->getTwoFactorAuthentication('enabled')) {
-            $user->setTwoFactorAuthentication('enabled', true);
-            Tool\Session::useSession(function (AttributeBagInterface $adminSession) {
-                $adminSession->set('2fa_required', false);
-            });
-            $user->save();
-            $templateParams['settings']['twoFactorSetupRequired'] = true;
-        }
-        $settingsEvent = new IndexActionSettingsEvent($templateParams['settings'] ?? []);
-        $this->eventDispatcher->dispatch($settingsEvent, AdminEvents::INDEX_ACTION_SETTINGS);
-        $templateParams['settings'] = $settingsEvent->getSettings();
-        return $this->render('@PimcoreAdmin/Admin/Index/index.html.twig', $templateParams);
-    }
-    /**
-     * @Route("/index/statistics", name="pimcore_admin_index_statistics", methods={"GET"})
-     *
-     * @param Request $request
-     * @param ConnectionInterface $db
-     * @param KernelInterface $kernel
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function statisticsAction(Request $request, ConnectionInterface $db, KernelInterface $kernel)
-    {
-        try {
-            $tables = $db->fetchAll('SELECT TABLE_NAME as name,TABLE_ROWS as `rows` from information_schema.TABLES
-                WHERE TABLE_ROWS IS NOT NULL AND TABLE_SCHEMA = ?', [$db->getDatabase()]);
-        } catch (\Exception $e) {
-            $tables = [];
-        }
-        try {
-            $mysqlVersion = $db->fetchOne('SELECT VERSION()');
-        } catch (\Exception $e) {
-            $mysqlVersion = null;
-        }
-        try {
-            $data = [
-                'instanceId' => $this->getInstanceId(),
-                'pimcore_major_version' => 10,
-                'pimcore_version' => Version::getVersion(),
-                'pimcore_hash' => Version::getRevision(),
-                'php_version' => PHP_VERSION,
-                'mysql_version' => $mysqlVersion,
-                'bundles' => array_keys($kernel->getBundles()),
-                'tables' => $tables,
-            ];
-        } catch (\Exception $e) {
-            $data = [];
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @param array $templateParams
-     * @param User $user
-     *
-     * @return $this
-     */
-    protected function addRuntimePerspective(array &$templateParams, User $user)
-    {
-        $runtimePerspective = Config::getRuntimePerspective($user);
-        $templateParams['runtimePerspective'] = $runtimePerspective;
-        return $this;
-    }
-    /**
-     * @param array $templateParams
-     *
-     * @return $this
-     */
-    protected function addPluginAssets(array &$templateParams)
-    {
-        $bundleManager = $this->get(PimcoreBundleManager::class);
-        $templateParams['pluginJsPaths'] = $bundleManager->getJsPaths();
-        $templateParams['pluginCssPaths'] = $bundleManager->getCssPaths();
-        return $this;
-    }
-    /**
-     * @param Request $request
-     * @param array $templateParams
-     * @param User $user
-     * @param KernelInterface $kernel
-     * @param ExecutorInterface $maintenanceExecutor
-     * @param CsrfProtectionHandler $csrfProtection
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return $this
-     */
-    protected function buildPimcoreSettings(Request $request, array &$templateParams, User $user, KernelInterface $kernel, ExecutorInterface $maintenanceExecutor, CsrfProtectionHandler $csrfProtection, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $templateParams['config'];
-        $dashboardHelper = new \Pimcore\Helper\Dashboard($user);
-        $settings = [
-            'instanceId' => $this->getInstanceId(),
-            'version' => Version::getVersion(),
-            'build' => Version::getRevision(),
-            'debug' => \Pimcore::inDebugMode(),
-            'devmode' => \Pimcore::inDevMode(),
-            'disableMinifyJs' => \Pimcore::disableMinifyJs(),
-            'environment' => $kernel->getEnvironment(),
-            'cached_environments' => Tool::getCachedSymfonyEnvironments(),
-            'sessionId' => htmlentities(Session::getSessionId(), ENT_QUOTES, 'UTF-8'),
-            'language' => $request->getLocale(),
-            'websiteLanguages' => Admin::reorderWebsiteLanguages(
-                $this->getAdminUser(),
-                $config['general']['valid_languages'],
-                true
-            ),
-            'showCloseConfirmation' => true,
-            'debug_admin_translations' => (bool)$config['general']['debug_admin_translations'],
-            'document_generatepreviews' => (bool)$config['documents']['generate_preview'],
-            'asset_disable_tree_preview' => (bool)$config['assets']['disable_tree_preview'],
-            'htmltoimage' => \Pimcore\Image\HtmlToImage::isSupported(),
-            'videoconverter' => \Pimcore\Video::isAvailable(),
-            'asset_hide_edit' => (bool)$config['assets']['hide_edit_image'],
-            'main_domain' => $config['general']['domain'],
-            'timezone' => $config['general']['timezone'],
-            'tile_layer_url_template' => $config['maps']['tile_layer_url_template'],
-            'geocoding_url_template' => $config['maps']['geocoding_url_template'],
-            'reverse_geocoding_url_template' => $config['maps']['reverse_geocoding_url_template'],
-            'asset_tree_paging_limit' => $config['assets']['tree_paging_limit'],
-            'document_tree_paging_limit' => $config['documents']['tree_paging_limit'],
-            'object_tree_paging_limit' => $config['objects']['tree_paging_limit'],
-            'maxmind_geoip_installed' => (bool) $this->getParameter('pimcore.geoip.db_file'),
-            'hostname' => htmlentities(\Pimcore\Tool::getHostname(), ENT_QUOTES, 'UTF-8'),
-            'document_auto_save_interval' => $config['documents']['auto_save_interval'],
-            'object_auto_save_interval' => $config['objects']['auto_save_interval'],
-            'perspective' => $templateParams['runtimePerspective'],
-            'availablePerspectives' => Config::getAvailablePerspectives($user),
-            'disabledPortlets' => $dashboardHelper->getDisabledPortlets(),
-            'google_analytics_enabled' => (bool) $siteConfigProvider->isSiteReportingConfigured(),
-        ];
-        $this
-            ->addSystemVarSettings($settings)
-            ->addMaintenanceSettings($settings, $maintenanceExecutor)
-            ->addMailSettings($settings, $config)
-            ->addCustomViewSettings($settings);
-        $settings['csrfToken'] = $csrfProtection->getCsrfToken();
-        $templateParams['settings'] = $settings;
-        return $this;
-    }
-    /**
-     * @return string
-     */
-    private function getInstanceId()
-    {
-        $instanceId = 'not-set';
-        try {
-            $instanceId = $this->getParameter('secret');
-            $instanceId = sha1(substr($instanceId, 3, -3));
-        } catch (\Exception $e) {
-        }
-        return $instanceId;
-    }
-    /**
-     * @param array $settings
-     *
-     * @return $this
-     */
-    protected function addSystemVarSettings(array &$settings)
-    {
-        $max_upload = filesize2bytes(ini_get('upload_max_filesize') . 'B');
-        $max_post = filesize2bytes(ini_get('post_max_size') . 'B');
-        $upload_mb = min($max_upload, $max_post);
-        $settings['upload_max_filesize'] = (int) $upload_mb;
-        $session_gc_maxlifetime = ini_get('session.gc_maxlifetime');
-        if (empty($session_gc_maxlifetime)) {
-            $session_gc_maxlifetime = 120;
-        }
-        $settings['session_gc_maxlifetime'] = (int)$session_gc_maxlifetime;
-        return $this;
-    }
-    /**
-     * @param array $settings
-     * @param ExecutorInterface $maintenanceExecutor
-     *
-     * @return $this
-     */
-    protected function addMaintenanceSettings(array &$settings, ExecutorInterface $maintenanceExecutor)
-    {
-        $maintenance_active = false;
-        if ($lastExecution = $maintenanceExecutor->getLastExecution()) {
-            if ((time() - $lastExecution) < 3660) { // maintenance script should run at least every hour + a little tolerance
-                $maintenance_active = true;
-            }
-        }
-        $settings['maintenance_active'] = $maintenance_active;
-        $settings['maintenance_mode'] = Admin::isInMaintenanceMode();
-        return $this;
-    }
-    /**
-     * @param array $settings
-     * @param Config $config
-     *
-     * @return $this
-     */
-    protected function addMailSettings(array &$settings, $config)
-    {
-        $mailIncomplete = false;
-        if (isset($config['email'])) {
-            if (empty($config['email']['debug']['email_addresses'])) {
-                $mailIncomplete = true;
-            }
-            if (empty($config['email']['sender']['email'])) {
-                $mailIncomplete = true;
-            }
-        }
-        $settings['mail'] = !$mailIncomplete;
-        $settings['mailDefaultAddress'] = $config['email']['sender']['email'] ?? null;
-        return $this;
-    }
-    /**
-     * @param array $settings
-     *
-     * @return $this
-     */
-    protected function addCustomViewSettings(array &$settings)
-    {
-        $cvData = [];
-        $cvConfig = Tool::getCustomViewConfig();
-        if ($cvConfig) {
-            foreach ($cvConfig as $node) {
-                $tmpData = $node;
-                $treeType = $tmpData['treetype'] ? $tmpData['treetype'] : 'object';
-                $rootNode = Service::getElementByPath($treeType, $tmpData['rootfolder']);
-                if ($rootNode) {
-                    $tmpData['rootId'] = $rootNode->getId();
-                    $tmpData['allowedClasses'] = $tmpData['classes'] ?? null;
-                    $tmpData['showroot'] = (bool)$tmpData['showroot'];
-                    if ($rootNode->isAllowed('list')) {
-                        $cvData[] = $tmpData;
-                    }
-                }
-            }
-        }
-        $settings['customviews'] = $cvData;
-        return $this;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelResponseEvent(ResponseEvent $event)
-    {
-        $event->getResponse()->headers->set('X-Frame-Options', 'deny', true);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/InstallController.php
+++ b//dev/null
@@ -1,47 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Db\ConnectionInterface;
-use Pimcore\Tool\Requirements;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Profiler\Profiler;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/install")
- *
- * @internal
- */
-class InstallController extends AdminController
-{
-    /**
-     * @Route("/check", name="pimcore_admin_install_check", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     * @param ConnectionInterface $db
-     * @param Profiler $profiler
-     *
-     * @return Response
-     */
-    public function checkAction(Request $request, ConnectionInterface $db, ?Profiler $profiler)
-    {
-        if ($profiler) {
-            $profiler->disable();
-        }
-        $viewParams = Requirements::checkAll($db);
-        $viewParams['headless'] = (bool)$request->get('headless');
-        return $this->render('@PimcoreAdmin/Admin/Install/check.html.twig', $viewParams);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/LogController.php
+++ b//dev/null
@@ -1,232 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Doctrine\DBAL\Types\Types;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Helper\QueryParams;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Db;
-use Pimcore\Log\Handler\ApplicationLoggerDb;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\StreamedResponse;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @internal
- */
-class LogController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        if (!$this->getAdminUser()->isAllowed('application_logging')) {
-            throw new AccessDeniedHttpException("Permission denied, user needs 'application_logging' permission.");
-        }
-    }
-    /**
-     * @Route("/log/show", name="pimcore_admin_log_show", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function showAction(Request $request, Db\ConnectionInterface $db)
-    {
-        $qb = $db->createQueryBuilder();
-        $qb
-            ->select('*')
-            ->from(ApplicationLoggerDb::TABLE_NAME)
-            ->setFirstResult($request->get('start', 0))
-            ->setMaxResults($request->get('limit', 50));
-        $sortingSettings = QueryParams::extractSortingSettings(array_merge(
-            $request->request->all(),
-            $request->query->all()
-        ));
-        if ($sortingSettings['orderKey']) {
-            $qb->orderBy($sortingSettings['orderKey'], $sortingSettings['order']);
-        } else {
-            $qb->orderBy('id', 'DESC');
-        }
-        $priority = $request->get('priority');
-        if ($priority !== '-1' && ($priority == '0' || $priority)) {
-            $levels = [];
-            foreach (['emergency', 'alert', 'critical', 'error', 'warning', 'notice', 'info', 'debug'] as $level) {
-                $levels[] = $level;
-                if ($priority === $level) {
-                    break;
-                }
-            }
-            $qb->andWhere($qb->expr()->in('priority', ':priority'));
-            $qb->setParameter('priority', $levels, Db\Connection::PARAM_STR_ARRAY);
-        }
-        if ($fromDate = $this->parseDateObject($request->get('fromDate'), $request->get('fromTime'))) {
-            $qb->andWhere('timestamp > :fromDate');
-            $qb->setParameter('fromDate', $fromDate, Types::DATETIME_MUTABLE);
-        }
-        if ($toDate = $this->parseDateObject($request->get('toDate'), $request->get('toTime'))) {
-            $qb->andWhere('timestamp <= :toDate');
-            $qb->setParameter('toDate', $toDate, Types::DATETIME_MUTABLE);
-        }
-        if (!empty($component = $request->get('component'))) {
-            $qb->andWhere('component = ' . $qb->createNamedParameter($component));
-        }
-        if (!empty($relatedObject = $request->get('relatedobject'))) {
-            $qb->andWhere('relatedobject = ' . $qb->createNamedParameter($relatedObject));
-        }
-        if (!empty($message = $request->get('message'))) {
-            $qb->andWhere('message LIKE ' . $qb->createNamedParameter('%' . $message . '%'));
-        }
-        if (!empty($pid = $request->get('pid'))) {
-            $qb->andWhere('pid LIKE ' . $qb->createNamedParameter('%' . $pid . '%'));
-        }
-        $totalQb = clone $qb;
-        $totalQb->setMaxResults(null)
-            ->setFirstResult(0)
-            ->select('COUNT(id) as count');
-        $total = $totalQb->execute()->fetch();
-        $total = (int) $total['count'];
-        $stmt = $qb->execute();
-        $result = $stmt->fetchAll();
-        $logEntries = [];
-        foreach ($result as $row) {
-            $fileobject = null;
-            if ($row['fileobject']) {
-                $fileobject = str_replace(PIMCORE_PROJECT_ROOT, '', $row['fileobject']);
-            }
-            $logEntry = [
-                'id' => $row['id'],
-                'pid' => $row['pid'],
-                'message' => $row['message'],
-                'timestamp' => $row['timestamp'],
-                'priority' => $this->getPriorityName($row['priority']),
-                'fileobject' => $fileobject,
-                'relatedobject' => $row['relatedobject'],
-                'relatedobjecttype' => $row['relatedobjecttype'],
-                'component' => $row['component'],
-                'source' => $row['source'],
-            ];
-            $logEntries[] = $logEntry;
-        }
-        return $this->adminJson([
-            'p_totalCount' => $total,
-            'p_results' => $logEntries,
-        ]);
-    }
-    /**
-     * @param string|null $date
-     * @param string|null $time
-     *
-     * @return \DateTime|null
-     */
-    private function parseDateObject($date = null, $time = null)
-    {
-        if (empty($date)) {
-            return null;
-        }
-        $pattern = '/^(?P<date>\d{4}\-\d{2}\-\d{2})T(?P<time>\d{2}:\d{2}:\d{2})$/';
-        $dateTime = null;
-        if (preg_match($pattern, $date, $dateMatches)) {
-            if (!empty($time) && preg_match($pattern, $time, $timeMatches)) {
-                $dateTime = new \DateTime(sprintf('%sT%s', $dateMatches['date'], $timeMatches['time']));
-            } else {
-                $dateTime = new \DateTime($date);
-            }
-        }
-        return $dateTime;
-    }
-    /**
-     * @param int $priority
-     *
-     * @return string
-     */
-    private function getPriorityName($priority)
-    {
-        $p = ApplicationLoggerDb::getPriorities();
-        return $p[$priority];
-    }
-    /**
-     * @Route("/log/priority-json", name="pimcore_admin_log_priorityjson", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function priorityJsonAction(Request $request)
-    {
-        $priorities[] = ['key' => '-1', 'value' => '-'];
-        foreach (ApplicationLoggerDb::getPriorities() as $key => $p) {
-            $priorities[] = ['key' => $key, 'value' => $p];
-        }
-        return $this->adminJson(['priorities' => $priorities]);
-    }
-    /**
-     * @Route("/log/component-json", name="pimcore_admin_log_componentjson", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function componentJsonAction(Request $request)
-    {
-        $components[] = ['key' => '', 'value' => '-'];
-        foreach (ApplicationLoggerDb::getComponents() as $p) {
-            $components[] = ['key' => $p, 'value' => $p];
-        }
-        return $this->adminJson(['components' => $components]);
-    }
-    /**
-     * @Route("/log/show-file-object", name="pimcore_admin_log_showfileobject", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function showFileObjectAction(Request $request)
-    {
-        $filePath = $request->get('filePath');
-        if (!filter_var($filePath, FILTER_VALIDATE_URL)) {
-            $filePath = PIMCORE_PROJECT_ROOT . DIRECTORY_SEPARATOR . $filePath;
-            $filePath = realpath($filePath);
-            $fileObjectPath = realpath(PIMCORE_LOG_FILEOBJECT_DIRECTORY);
-        } else {
-            $fileObjectPath = PIMCORE_LOG_FILEOBJECT_DIRECTORY;
-        }
-        if (!preg_match('@^' . $fileObjectPath . '@', $filePath)) {
-            throw new AccessDeniedHttpException('Accessing file out of scope');
-        }
-        if (file_exists($filePath)) {
-            $response = new StreamedResponse(
-                static function () use ($filePath) {
-                    $handle = fopen($filePath, 'rb');
-                    fpassthru($handle);
-                    fclose($handle);
-                }
-            );
-            $response->headers->set('Content-Type', 'text/plain');
-        } else {
-            $response = new Response();
-            $response->headers->set('Content-Type', 'text/plain');
-            $response->setContent('Path `'.$filePath.'` not found.');
-            $response->setStatusCode(404);
-        }
-        return $response;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/LoginController.php
+++ b//dev/null
@@ -1,276 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Controller\BruteforceProtectedControllerInterface;
-use Pimcore\Bundle\AdminBundle\Security\BruteforceProtectionHandler;
-use Pimcore\Bundle\AdminBundle\Security\CsrfProtectionHandler;
-use Pimcore\Config;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Controller\KernelResponseEventInterface;
-use Pimcore\Event\Admin\Login\LostPasswordEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Extension\Bundle\PimcoreBundleManager;
-use Pimcore\Http\ResponseHelper;
-use Pimcore\Logger;
-use Pimcore\Model\User;
-use Pimcore\Tool;
-use Pimcore\Tool\Authentication;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Event\ResponseEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Component\Routing\Generator\UrlGeneratorInterface;
-use Symfony\Component\Security\Core\Exception\AuthenticationException;
-use Symfony\Component\Security\Core\Security;
-use Symfony\Component\Security\Core\User\UserInterface;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @internal
- */
-class LoginController extends AdminController implements BruteforceProtectedControllerInterface, KernelControllerEventInterface, KernelResponseEventInterface
-{
-    /**
-     * @var ResponseHelper
-     */
-    protected $reponseHelper;
-    public function __construct(ResponseHelper $responseHelper)
-    {
-        $this->reponseHelper = $responseHelper;
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $locale = 'en';
-        $availableLocales = Tool\Admin::getLanguages();
-        foreach ($event->getRequest()->getLanguages() as $userLocale) {
-            if (in_array($userLocale, $availableLocales)) {
-                $locale = $userLocale;
-                break;
-            }
-        }
-        $this->get('translator')->setLocale($locale);
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelResponseEvent(ResponseEvent $event)
-    {
-        $response = $event->getResponse();
-        $response->headers->set('X-Frame-Options', 'deny', true);
-        $this->reponseHelper->disableCache($response, true);
-    }
-    /**
-     * @Route("/login", name="pimcore_admin_login")
-     * @Route("/login/", name="pimcore_admin_login_fallback")
-     */
-    public function loginAction(Request $request, CsrfProtectionHandler $csrfProtection, Config $config)
-    {
-        if ($request->get('_route') === 'pimcore_admin_login_fallback') {
-            return $this->redirectToRoute('pimcore_admin_login', $request->query->all(), Response::HTTP_MOVED_PERMANENTLY);
-        }
-        $csrfProtection->regenerateCsrfToken();
-        $user = $this->getAdminUser();
-        if ($user instanceof UserInterface) {
-            return $this->redirectToRoute('pimcore_admin_index');
-        }
-        $params = $this->buildLoginPageViewParams($config);
-        $session_gc_maxlifetime = ini_get('session.gc_maxlifetime');
-        if (empty($session_gc_maxlifetime)) {
-            $session_gc_maxlifetime = 120;
-        }
-        $params['csrfTokenRefreshInterval'] = ((int)$session_gc_maxlifetime - 60) * 1000;
-        if ($request->get('auth_failed')) {
-            $params['error'] = 'error_auth_failed';
-        }
-        if ($request->get('session_expired')) {
-            $params['error'] = 'error_session_expired';
-        }
-        if ($request->get('deeplink')) {
-            $params['deeplink'] = true;
-        }
-        $params['browserSupported'] = $this->detectBrowser();
-        $params['debug'] = \Pimcore::inDebugMode();
-        return $this->render('@PimcoreAdmin/Admin/Login/login.html.twig', $params);
-    }
-    /**
-     * @Route("/login/csrf-token", name="pimcore_admin_login_csrf_token")
-     */
-    public function csrfTokenAction(Request $request, CsrfProtectionHandler $csrfProtection)
-    {
-        if (!$this->getAdminUser()) {
-            $csrfProtection->regenerateCsrfToken();
-        }
-        return $this->json([
-           'csrfToken' => $csrfProtection->getCsrfToken(),
-        ]);
-    }
-    /**
-     * @Route("/logout", name="pimcore_admin_logout")
-     */
-    public function logoutAction()
-    {
-    }
-    /**
-     * Dummy route used to check authentication
-     *
-     * @Route("/login/login", name="pimcore_admin_login_check")
-     *
-     * @see AdminAuthenticator for the security implementation
-     */
-    public function loginCheckAction()
-    {
-        return new RedirectResponse($this->generateUrl('pimcore_admin_login'));
-    }
-    /**
-     * @Route("/login/lostpassword", name="pimcore_admin_login_lostpassword")
-     */
-    public function lostpasswordAction(Request $request, BruteforceProtectionHandler $bruteforceProtectionHandler, CsrfProtectionHandler $csrfProtection, Config $config, EventDispatcherInterface $eventDispatcher)
-    {
-        $params = $this->buildLoginPageViewParams($config);
-        $error = null;
-        if ($request->getMethod() === 'POST' && $username = $request->get('username')) {
-            $user = User::getByName($username);
-            if ($user instanceof User) {
-                if (!$user->isActive()) {
-                    $error = 'user_inactive';
-                }
-                if (!$user->getEmail()) {
-                    $error = 'user_no_email_address';
-                }
-                if (!$user->getPassword()) {
-                    $error = 'user_no_password';
-                }
-            } else {
-                $error = 'user_unknown';
-            }
-            if (!$error && $user instanceof User) {
-                $token = Authentication::generateToken($user->getName());
-                $loginUrl = $this->generateUrl('pimcore_admin_login_check', [
-                    'token' => $token,
-                    'reset' => 'true',
-                ], UrlGeneratorInterface::ABSOLUTE_URL);
-                try {
-                    $event = new LostPasswordEvent($user, $loginUrl);
-                    $eventDispatcher->dispatch($event, AdminEvents::LOGIN_LOSTPASSWORD);
-                    if ($event->getSendMail()) {
-                        $mail = Tool::getMail([$user->getEmail()], 'Pimcore lost password service');
-                        $mail->setIgnoreDebugMode(true);
-                        $mail->text("Login to pimcore and change your password using the following link. This temporary login link will expire in 24 hours: \r\n\r\n" . $loginUrl);
-                        $mail->send();
-                    }
-                    if ($event->hasResponse()) {
-                        return $event->getResponse();
-                    }
-                } catch (\Exception $e) {
-                    Logger::error('Error sending password recovery email: ' . $e->getMessage());
-                    $error = 'lost_password_email_error';
-                }
-            }
-            if ($error) {
-                Logger::error('Lost password service: ' . $error);
-                $bruteforceProtectionHandler->addEntry($request->get('username'), $request);
-                $params['error'] = $error;
-            }
-        }
-        $csrfProtection->regenerateCsrfToken();
-        return $this->render('@PimcoreAdmin/Admin/Login/lostpassword.html.twig', $params);
-    }
-    /**
-     * @Route("/login/deeplink", name="pimcore_admin_login_deeplink")
-     */
-    public function deeplinkAction(Request $request)
-    {
-        $queryString = $_SERVER['QUERY_STRING'];
-        if (preg_match('/(document|asset|object)_([0-9]+)_([a-z]+)/', $queryString, $deeplink)) {
-            $deeplink = $deeplink[0];
-            $perspective = strip_tags($request->get('perspective'));
-            if (strpos($queryString, 'token')) {
-                $url = $this->generateUrl('pimcore_admin_login', [
-                    'deeplink' => $deeplink,
-                    'perspective' => $perspective,
-                ]);
-                $url .= '&' . $queryString;
-                return $this->redirect($url);
-            } elseif ($queryString) {
-                return $this->render('@PimcoreAdmin/Admin/Login/deeplink.html.twig', [
-                    'tab' => $deeplink,
-                    'perspective' => $perspective,
-                ]);
-            }
-        }
-    }
-    protected function buildLoginPageViewParams(Config $config): array
-    {
-        $bundleManager = $this->get(PimcoreBundleManager::class);
-        return [
-            'config' => $config,
-            'pluginCssPaths' => $bundleManager->getCssPaths(),
-        ];
-    }
-    /**
-     * @Route("/login/2fa", name="pimcore_admin_2fa")
-     */
-    public function twoFactorAuthenticationAction(Request $request, BruteforceProtectionHandler $bruteforceProtectionHandler, Config $config)
-    {
-        $params = $this->buildLoginPageViewParams($config);
-        if ($request->hasSession()) {
-            $bruteforceProtectionHandler->checkProtection($this->getAdminUser()->getName(), $request);
-            $session = $request->getSession();
-            $authException = $session->get(Security::AUTHENTICATION_ERROR);
-            if ($authException instanceof AuthenticationException) {
-                $session->remove(Security::AUTHENTICATION_ERROR);
-                $params['error'] = $authException->getMessage();
-                $bruteforceProtectionHandler->addEntry($this->getAdminUser()->getName(), $request);
-            }
-        } else {
-            $params['error'] = 'No session available, it either timed out or cookies are not enabled.';
-        }
-        return $this->render('@PimcoreAdmin/Admin/Login/twoFactorAuthentication.html.twig', $params);
-    }
-    /**
-     * @Route("/login/2fa-verify", name="pimcore_admin_2fa-verify")
-     *
-     * @param Request $request
-     */
-    public function twoFactorAuthenticationVerifyAction(Request $request)
-    {
-    }
-    /**
-     * @return bool
-     */
-    public function detectBrowser()
-    {
-        $supported = false;
-        $browser = new \Browser();
-        $browserVersion = (int)$browser->getVersion();
-        if ($browser->getBrowser() == \Browser::BROWSER_FIREFOX && $browserVersion >= 72) {
-            $supported = true;
-        }
-        if ($browser->getBrowser() == \Browser::BROWSER_CHROME && $browserVersion >= 84) {
-            $supported = true;
-        }
-        if ($browser->getBrowser() == \Browser::BROWSER_SAFARI && $browserVersion >= 13.1) {
-            $supported = true;
-        }
-        if ($browser->getBrowser() == \Browser::BROWSER_OPERA && $browserVersion >= 67) {
-            $supported = true;
-        }
-        return $supported;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/MiscController.php
+++ b//dev/null
@@ -1,647 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Config;
-use Pimcore\Controller\Config\ControllerDataProvider;
-use Pimcore\Db;
-use Pimcore\File;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Tool;
-use Pimcore\Translation\Translator;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Profiler\Profiler;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\Translation\TranslatorInterface;
-/**
- * @Route("/misc")
- *
- * @internal
- */
-class MiscController extends AdminController
-{
-    /**
-     * @Route("/get-available-controller-references", name="pimcore_admin_misc_getavailablecontroller_references", methods={"GET"})
-     *
-     * @param Request $request
-     * @param ControllerDataProvider $provider
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableControllerReferencesAction(Request $request, ControllerDataProvider $provider)
-    {
-        $controllerReferences = $provider->getControllerReferences();
-        $result = array_map(function ($controller) {
-            return [
-                'name' => $controller,
-            ];
-        }, $controllerReferences);
-        return $this->adminJson([
-            'data' => $result,
-        ]);
-    }
-    /**
-     * @Route("/get-available-templates", name="pimcore_admin_misc_getavailabletemplates", methods={"GET"})
-     *
-     * @param ControllerDataProvider $provider
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableTemplatesAction(ControllerDataProvider $provider)
-    {
-        $templates = $provider->getTemplates();
-        sort($templates, SORT_NATURAL | SORT_FLAG_CASE);
-        $result = array_map(static function ($template) {
-            return [
-                'path' => $template,
-            ];
-        }, $templates);
-        return $this->adminJson([
-            'data' => $result,
-        ]);
-    }
-    /**
-     * @Route("/json-translations-system", name="pimcore_admin_misc_jsontranslationssystem", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function jsonTranslationsSystemAction(Request $request, TranslatorInterface $translator)
-    {
-        $language = $request->get('language');
-        /** @var Translator $translator */
-        $translator->lazyInitialize('admin', $language);
-        $translations = $translator->getCatalogue($language)->all('admin');
-        if ($language != 'en') {
-            $translator->lazyInitialize('admin', 'en');
-            foreach ($translator->getCatalogue('en')->all('admin') as $key => $value) {
-                if (!isset($translations[$key]) || empty($translations[$key])) {
-                    $translations[$key] = $value;
-                }
-            }
-        }
-        $response = new Response('pimcore.system_i18n = ' . $this->encodeJson($translations) . ';');
-        $response->headers->set('Content-Type', 'text/javascript');
-        return $response;
-    }
-    /**
-     * @Route("/script-proxy", name="pimcore_admin_misc_scriptproxy", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function scriptProxyAction(Request $request)
-    {
-        $allowedFileTypes = ['js', 'css'];
-        $scripts = explode(',', $request->get('scripts'));
-        if ($request->get('scriptPath')) {
-            $scriptPath = PIMCORE_WEB_ROOT . $request->get('scriptPath');
-        } else {
-            $scriptPath = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/';
-        }
-        $scriptsContent = '';
-        foreach ($scripts as $script) {
-            $filePath = $scriptPath . $script;
-            if (is_file($filePath) && is_readable($filePath) && in_array(\Pimcore\File::getFileExtension($script), $allowedFileTypes)) {
-                $scriptsContent .= file_get_contents($filePath);
-            }
-        }
-        if (!empty($scriptsContent)) {
-            $fileExtension = \Pimcore\File::getFileExtension($scripts[0]);
-            $contentType = 'text/javascript';
-            if ($fileExtension == 'css') {
-                $contentType = 'text/css';
-            }
-            $lifetime = 86400;
-            $response = new Response($scriptsContent);
-            $response->headers->set('Cache-Control', 'max-age=' . $lifetime);
-            $response->headers->set('Pragma', '');
-            $response->headers->set('Content-Type', $contentType);
-            $response->headers->set('Expires', gmdate('D, d M Y H:i:s', time() + $lifetime) . ' GMT');
-            return $response;
-        } else {
-            throw $this->createNotFoundException('Scripts not found');
-        }
-    }
-    /**
-     * @Route("/admin-css", name="pimcore_admin_misc_admincss", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return Response
-     */
-    public function adminCssAction(Request $request, Config $config)
-    {
-        $cvData = Tool::getCustomViewConfig();
-        $languages = \Pimcore\Tool::getValidLanguages();
-        $adminLanguages = \Pimcore\Tool\Admin::getLanguages();
-        $languages = array_unique(array_merge($languages, $adminLanguages));
-        $response = $this->render('@PimcoreAdmin/Admin/Misc/admin-css.html.twig', [
-            'customviews' => $cvData,
-            'config' => $config,
-            'languages' => $languages,
-        ]);
-        $response->headers->set('Content-Type', 'text/css; charset=UTF-8');
-        return $response;
-    }
-    /**
-     * @Route("/ping", name="pimcore_admin_misc_ping", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function pingAction(Request $request)
-    {
-        $response = [
-            'success' => true,
-        ];
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/available-languages", name="pimcore_admin_misc_availablelanguages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function availableLanguagesAction(Request $request)
-    {
-        $locales = Tool::getSupportedLocales();
-        $response = new Response('pimcore.available_languages = ' . $this->encodeJson($locales) . ';');
-        $response->headers->set('Content-Type', 'text/javascript');
-        return $response;
-    }
-    /**
-     * @Route("/get-valid-filename", name="pimcore_admin_misc_getvalidfilename", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getValidFilenameAction(Request $request)
-    {
-        return $this->adminJson([
-            'filename' => \Pimcore\Model\Element\Service::getValidKey($request->get('value'), $request->get('type')),
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-tree", name="pimcore_admin_misc_fileexplorertree", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fileexplorerTreeAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $referencePath = $this->getFileexplorerPath($request, 'node');
-        $items = scandir($referencePath);
-        $contents = [];
-        foreach ($items as $item) {
-            if ($item == '.' || $item == '..') {
-                continue;
-            }
-            $file = $referencePath . '/' . $item;
-            $file = str_replace('//', '/', $file);
-            if (is_dir($file) || is_file($file)) {
-                $itemConfig = [
-                    'id' => '/fileexplorer' . str_replace(PIMCORE_PROJECT_ROOT, '', $file),
-                    'text' => $item,
-                    'leaf' => true,
-                    'writeable' => is_writable($file),
-                ];
-                if (is_dir($file)) {
-                    $itemConfig['leaf'] = false;
-                    $itemConfig['type'] = 'folder';
-                    if (is_dir_empty($file)) {
-                        $itemConfig['loaded'] = true;
-                    }
-                    $itemConfig['expandable'] = true;
-                } elseif (is_file($file)) {
-                    $itemConfig['type'] = 'file';
-                }
-                $contents[] = $itemConfig;
-            }
-        }
-        return $this->adminJson($contents);
-    }
-    /**
-     * @Route("/fileexplorer-content", name="pimcore_admin_misc_fileexplorercontent", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fileexplorerContentAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        $writeable = false;
-        $file = $this->getFileexplorerPath($request, 'path');
-        $content = null;
-        if (is_file($file)) {
-            if (is_readable($file)) {
-                $content = file_get_contents($file);
-                $success = true;
-                $writeable = is_writable($file);
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'content' => $content,
-            'writeable' => $writeable,
-            'filename' => basename($file),
-            'path' => preg_replace('@^' . preg_quote(PIMCORE_PROJECT_ROOT, '@') . '@', '', $file),
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-content-save", name="pimcore_admin_misc_fileexplorercontentsave", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fileexplorerContentSaveAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        if ($request->get('content') && $request->get('path')) {
-            $file = $this->getFileexplorerPath($request, 'path');
-            if (is_file($file) && is_writable($file)) {
-                File::put($file, $request->get('content'));
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-add", name="pimcore_admin_misc_fileexploreradd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function fileexplorerAddAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        if ($request->get('filename') && $request->get('path')) {
-            $path = $this->getFileexplorerPath($request, 'path');
-            $file = $path . '/' . $request->get('filename');
-            $file = resolvePath($file);
-            if (strpos($file, PIMCORE_PROJECT_ROOT) !== 0) {
-                throw new \Exception('not allowed');
-            }
-            if (is_writable(dirname($file))) {
-                File::put($file, '');
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-add-folder", name="pimcore_admin_misc_fileexploreraddfolder", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function fileexplorerAddFolderAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        if ($request->get('filename') && $request->get('path')) {
-            $path = $this->getFileexplorerPath($request, 'path');
-            $file = $path . '/' . $request->get('filename');
-            $file = resolvePath($file);
-            if (strpos($file, PIMCORE_PROJECT_ROOT) !== 0) {
-                throw new \Exception('not allowed');
-            }
-            if (is_writable(dirname($file))) {
-                File::mkdir($file);
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-delete", name="pimcore_admin_misc_fileexplorerdelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fileexplorerDeleteAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        if ($request->get('path')) {
-            $file = $this->getFileexplorerPath($request, 'path');
-            if (is_writable($file)) {
-                unlink($file);
-                $success = true;
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/fileexplorer-rename", name="pimcore_admin_misc_fileexplorerrename", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function fileexplorerRenameAction(Request $request)
-    {
-        $this->checkPermission('fileexplorer');
-        $success = false;
-        if ($request->get('path') && $request->get('newPath')) {
-            $file = $this->getFileexplorerPath($request, 'path');
-            $newFile = $this->getFileexplorerPath($request, 'newPath');
-            $success = rename($file, $newFile);
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @param Request $request
-     * @param string $paramName
-     *
-     * @return mixed|string
-     *
-     * @throws \Exception
-     */
-    private function getFileexplorerPath(Request $request, $paramName = 'node')
-    {
-        $path = preg_replace("/^\/fileexplorer/", '', $request->get($paramName));
-        $path = resolvePath(PIMCORE_PROJECT_ROOT . $path);
-        if (strpos($path, PIMCORE_PROJECT_ROOT) !== 0) {
-            throw new \Exception('operation permitted, permission denied');
-        }
-        return $path;
-    }
-    /**
-     * @Route("/maintenance", name="pimcore_admin_misc_maintenance", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function maintenanceAction(Request $request)
-    {
-        $this->checkPermission('maintenance_mode');
-        if ($request->get('activate')) {
-            Tool\Admin::activateMaintenanceMode(Tool\Session::getSessionId());
-        }
-        if ($request->get('deactivate')) {
-            Tool\Admin::deactivateMaintenanceMode();
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/http-error-log", name="pimcore_admin_misc_httperrorlog", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function httpErrorLogAction(Request $request)
-    {
-        $this->checkPermission('http_errors');
-        $db = Db::get();
-        $limit = (int)$request->get('limit');
-        $offset = (int)$request->get('start');
-        $sortInfo = ($request->get('sort') ? json_decode($request->get('sort'), true)[0] : []);
-        $sort = $sortInfo['property'] ?? null;
-        $dir = $sortInfo['direction'] ?? null;
-        $filter = $request->get('filter');
-        if (!$limit) {
-            $limit = 20;
-        }
-        if (!$offset) {
-            $offset = 0;
-        }
-        if (!$sort || !in_array($sort, ['code', 'uri', 'date', 'count'])) {
-            $sort = 'count';
-        }
-        if (!$dir || !in_array($dir, ['DESC', 'ASC'])) {
-            $dir = 'DESC';
-        }
-        $condition = '';
-        if ($filter) {
-            $filter = $db->quote('%' . $filter . '%');
-            $conditionParts = [];
-            foreach (['uri', 'code', 'parametersGet', 'parametersPost', 'serverVars', 'cookies'] as $field) {
-                $conditionParts[] = $field . ' LIKE ' . $filter;
-            }
-            $condition = ' WHERE ' . implode(' OR ', $conditionParts);
-        }
-        $logs = $db->fetchAll('SELECT code,uri,`count`,date FROM http_error_log ' . $condition . ' ORDER BY ' . $sort . ' ' . $dir . ' LIMIT ' . $offset . ',' . $limit);
-        $total = $db->fetchOne('SELECT count(*) FROM http_error_log ' . $condition);
-        return $this->adminJson([
-            'items' => $logs,
-            'total' => $total,
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/http-error-log-flush", name="pimcore_admin_misc_httperrorlogflush", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function httpErrorLogFlushAction(Request $request)
-    {
-        $this->checkPermission('http_errors');
-        $db = Db::get();
-        $db->query('TRUNCATE TABLE http_error_log');
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/http-error-log-detail", name="pimcore_admin_misc_httperrorlogdetail", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Profiler $profiler
-     *
-     * @return Response
-     */
-    public function httpErrorLogDetailAction(Request $request, ?Profiler $profiler)
-    {
-        $this->checkPermission('http_errors');
-        if ($profiler) {
-            $profiler->disable();
-        }
-        $db = Db::get();
-        $data = $db->fetchRow('SELECT * FROM http_error_log WHERE uri = ?', [$request->get('uri')]);
-        foreach ($data as $key => &$value) {
-            if (in_array($key, ['parametersGet', 'parametersPost', 'serverVars', 'cookies'])) {
-                $value = unserialize($value);
-            }
-        }
-        $response = $this->render('@PimcoreAdmin/Admin/Misc/http-error-log-detail.html.twig', ['data' => $data]);
-        return $response;
-    }
-    /**
-     * @Route("/country-list", name="pimcore_admin_misc_countrylist", methods={"GET"})
-     *
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return JsonResponse
-     */
-    public function countryListAction(LocaleServiceInterface $localeService)
-    {
-        $countries = $localeService->getDisplayRegions();
-        asort($countries);
-        $options = [];
-        foreach ($countries as $short => $translation) {
-            if (strlen($short) == 2) {
-                $options[] = [
-                    'name' => $translation,
-                    'code' => $short,
-                ];
-            }
-        }
-        return $this->adminJson(['data' => $options]);
-    }
-    /**
-     * @Route("/language-list", name="pimcore_admin_misc_languagelist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function languageListAction(Request $request)
-    {
-        $locales = Tool::getSupportedLocales();
-        $options = [];
-        foreach ($locales as $short => $translation) {
-            $options[] = [
-                'name' => $translation,
-                'code' => $short,
-            ];
-        }
-        return $this->adminJson(['data' => $options]);
-    }
-    /**
-     * @Route("/phpinfo", name="pimcore_admin_misc_phpinfo", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Profiler $profiler
-     *
-     * @throws \Exception
-     *
-     * @return Response
-     */
-    public function phpinfoAction(Request $request, ?Profiler $profiler)
-    {
-        if ($profiler) {
-            $profiler->disable();
-        }
-        if (!$this->getAdminUser()->isAdmin()) {
-            throw new \Exception('Permission denied');
-        }
-        ob_start();
-        phpinfo();
-        $content = ob_get_clean();
-        return new Response($content);
-    }
-    /**
-     * @Route("/get-language-flag", name="pimcore_admin_misc_getlanguageflag", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function getLanguageFlagAction(Request $request)
-    {
-        $iconPath = Tool::getLanguageFlagFile($request->get('language'));
-        $response = new BinaryFileResponse($iconPath);
-        $response->headers->set('Content-Type', 'image/svg+xml');
-        return $response;
-    }
-    /**
-     * @Route("/icon-list", name="pimcore_admin_misc_iconlist", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Profiler $profiler
-     *
-     * @return Response
-     */
-    public function iconListAction(Request $request, ?Profiler $profiler)
-    {
-        if ($profiler) {
-            $profiler->disable();
-        }
-        $publicDir = PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin';
-        $iconDir = $publicDir . '/img';
-        $colorIcons = rscandir($iconDir . '/flat-color-icons/');
-        $whiteIcons = rscandir($iconDir . '/flat-white-icons/');
-        $twemoji = rscandir($iconDir . '/twemoji/');
-        $locales = Tool::getSupportedLocales();
-        $languageOptions = [];
-        foreach ($locales as $short => $translation) {
-            if (!empty($short)) {
-                $languageOptions[] = [
-                    'language' => $short,
-                    'display' => $translation . " ($short)",
-                    'flag' => \Pimcore\Tool::getLanguageFlagFile($short, false),
-                ];
-            }
-        }
-        $iconsCss = file_get_contents($publicDir . '/css/icons.css');
-        return $this->render('@PimcoreAdmin/Admin/Misc/iconList.html.twig', [
-            'colorIcons' => $colorIcons,
-            'whiteIcons' => $whiteIcons,
-            'twemoji' => $twemoji,
-            'languageOptions' => $languageOptions,
-            'iconsCss' => $iconsCss,
-        ]);
-    }
-    /**
-     * @Route("/test", name="pimcore_admin_misc_test")
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function testAction(Request $request)
-    {
-        return new Response('done');
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/NotificationController.php
+++ b//dev/null
@@ -1,209 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Model\Element\Service;
-use Pimcore\Model\Notification\Service\NotificationService;
-use Pimcore\Model\Notification\Service\NotificationServiceFilterParser;
-use Pimcore\Model\Notification\Service\UserService;
-use Pimcore\Model\User;
-use Pimcore\Translation\Translator;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/notification")
- *
- * @internal
- */
-class NotificationController extends AdminController
-{
-    /**
-     * @Route("/recipients", name="pimcore_admin_notification_recipients", methods={"GET"})
-     *
-     * @param UserService $service
-     * @param Translator $translator
-     *
-     * @return JsonResponse
-     */
-    public function recipientsAction(UserService $service, Translator $translator): JsonResponse
-    {
-        $this->checkPermission('notifications_send');
-        $data = [];
-        foreach ($service->findAll($this->getAdminUser()) as $recipient) {
-            $group = $translator->trans('group');
-            $prefix = $recipient->getType() == 'role' ? $group . ' - ' : '';
-            $data[] = [
-                'id' => $recipient->getId(),
-                'text' => $prefix . $recipient->getName(),
-            ];
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/send", name="pimcore_admin_notification_send", methods={"POST"})
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function sendAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications_send');
-        $recipientId = (int) $request->get('recipientId', 0);
-        $fromUser = (int) $this->getAdminUser()->getId();
-        $title = $request->get('title', '');
-        $message = $request->get('message', '');
-        $elementId = $request->get('elementId');
-        $elementType = $request->get('elementType', '');
-        $element = Service::getElementById($elementType, $elementId);
-        if (User::getById($recipientId) instanceof User) {
-            $service->sendToUser($recipientId, $fromUser, $title, $message, $element);
-        } else {
-            $service->sendToGroup($recipientId, $fromUser, $title, $message, $element);
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/find", name="pimcore_admin_notification_find")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function findAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $id = (int) $request->get('id', 0);
-        try {
-            $notification = $service->findAndMarkAsRead($id, $this->getAdminUser()->getId());
-        } catch (\UnexpectedValueException $e) {
-            return $this->adminJson(
-                [
-                    'success' => false,
-                ]
-            );
-        }
-        $data = $service->format($notification);
-        return $this->adminJson([
-            'success' => true,
-            'data' => $data,
-        ]);
-    }
-    /**
-     * @Route("/find-all", name="pimcore_admin_notification_findall")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function findAllAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $filter = ['recipient' => (int) $this->getAdminUser()->getId()];
-        $parser = new NotificationServiceFilterParser($request);
-        foreach ($parser->parse() as $key => $val) {
-            $filter[$key] = $val;
-        }
-        $options = [
-            'offset' => $request->get('start', 0),
-            'limit' => $request->get('limit', 40),
-        ];
-        $result = $service->findAll($filter, $options);
-        $data = [];
-        foreach ($result['data'] as $notification) {
-            $data[] = $service->format($notification);
-        }
-        return $this->adminJson([
-            'success' => true,
-            'total' => $result['total'],
-            'data' => $data,
-        ]);
-    }
-    /**
-     * @Route("/find-last-unread", name="pimcore_admin_notification_findlastunread")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function findLastUnreadAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $user = $this->getAdminUser();
-        $lastUpdate = (int) $request->get('lastUpdate', time());
-        $result = $service->findLastUnread((int) $user->getId(), $lastUpdate);
-        $unread = $service->countAllUnread((int) $user->getId());
-        $data = [];
-        foreach ($result['data'] as $notification) {
-            $data[] = $service->format($notification);
-        }
-        return $this->adminJson([
-            'success' => true,
-            'total' => $result['total'],
-            'data' => $data,
-            'unread' => $unread,
-        ]);
-    }
-    /**
-     * @Route("/mark-as-read", name="pimcore_admin_notification_markasread")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function markAsReadAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $id = (int) $request->get('id', 0);
-        $service->findAndMarkAsRead($id, $this->getAdminUser()->getId());
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_notification_delete")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function deleteAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $id = (int) $request->get('id', 0);
-        $service->delete($id, $this->getAdminUser()->getId());
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/delete-all", name="pimcore_admin_notification_deleteall")
-     *
-     * @param Request $request
-     * @param NotificationService $service
-     *
-     * @return JsonResponse
-     */
-    public function deleteAllAction(Request $request, NotificationService $service): JsonResponse
-    {
-        $this->checkPermission('notifications');
-        $user = $this->getAdminUser();
-        $service->deleteAll((int) $user->getId());
-        return $this->adminJson(['success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/PortalController.php
+++ b//dev/null
@@ -1,376 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Analytics\Google\Config\SiteConfigProvider;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Site;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\Translation\TranslatorInterface;
-/**
- * @Route("/portal")
- *
- * @internal
- */
-class PortalController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @var \Pimcore\Helper\Dashboard
-     */
-    protected $dashboardHelper = null;
-    /**
-     * @param Request $request
-     *
-     * @return mixed
-     */
-    protected function getCurrentConfiguration(Request $request)
-    {
-        return $this->dashboardHelper->getDashboard($request->get('key'));
-    }
-    /**
-     * @param Request $request
-     * @param array $config
-     */
-    protected function saveConfiguration(Request $request, $config)
-    {
-        $this->dashboardHelper->saveDashboard($request->get('key'), $config);
-    }
-    /**
-     * @Route("/dashboard-list", name="pimcore_admin_portal_dashboardlist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function dashboardListAction(Request $request)
-    {
-        $dashboards = $this->dashboardHelper->getAllDashboards();
-        $data = [];
-        foreach ($dashboards as $key => $config) {
-            if ($key != 'welcome') {
-                $data[] = $key;
-            }
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/create-dashboard", name="pimcore_admin_portal_createdashboard", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function createDashboardAction(Request $request)
-    {
-        $dashboards = $this->dashboardHelper->getAllDashboards();
-        $key = trim($request->get('key'));
-        if ($dashboards[$key]) {
-            return $this->adminJson(['success' => false, 'message' => 'name_already_in_use']);
-        } elseif (!empty($key)) {
-            $this->dashboardHelper->saveDashboard($key);
-            return $this->adminJson(['success' => true]);
-        } else {
-            return $this->adminJson(['success' => false, 'message' => 'empty']);
-        }
-    }
-    /**
-     * @Route("/delete-dashboard", name="pimcore_admin_portal_deletedashboard", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteDashboardAction(Request $request)
-    {
-        $key = $request->get('key');
-        $this->dashboardHelper->deleteDashboard($key);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/get-configuration", name="pimcore_admin_portal_getconfiguration", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getConfigurationAction(Request $request)
-    {
-        return $this->adminJson($this->getCurrentConfiguration($request));
-    }
-    /**
-     * @Route("/remove-widget", name="pimcore_admin_portal_removewidget", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function removeWidgetAction(Request $request)
-    {
-        $config = $this->getCurrentConfiguration($request);
-        $newConfig = [[], []];
-        $colCount = 0;
-        foreach ($config['positions'] as $col) {
-            foreach ($col as $row) {
-                if ($row['id'] != $request->get('id')) {
-                    $newConfig[$colCount][] = $row;
-                }
-            }
-            $colCount++;
-        }
-        $config['positions'] = $newConfig;
-        $this->saveConfiguration($request, $config);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/add-widget", name="pimcore_admin_portal_addwidget", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addWidgetAction(Request $request)
-    {
-        $config = $this->getCurrentConfiguration($request);
-        $nextId = 0;
-        foreach ($config['positions'] as $col) {
-            foreach ($col as $row) {
-                $nextId = ($row['id'] > $nextId ? $row['id'] : $nextId);
-            }
-        }
-        $nextId = $nextId + 1;
-        $config['positions'][0][] = ['id' => $nextId, 'type' => $request->get('type'), 'config' => null];
-        $this->saveConfiguration($request, $config);
-        return $this->adminJson(['success' => true, 'id' => $nextId]);
-    }
-    /**
-     * @Route("/reorder-widget", name="pimcore_admin_portal_reorderwidget", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function reorderWidgetAction(Request $request)
-    {
-        $config = $this->getCurrentConfiguration($request);
-        $newConfig = [[], []];
-        $colCount = 0;
-        $toMove = null;
-        foreach ($config['positions'] as $col) {
-            foreach ($col as $row) {
-                if ($row['id'] != $request->get('id')) {
-                    $newConfig[$colCount][] = $row;
-                } else {
-                    $toMove = $row;
-                }
-            }
-            $colCount++;
-        }
-        array_splice($newConfig[$request->get('column')], $request->get('row'), 0, [$toMove]);
-        $config['positions'] = $newConfig;
-        $this->saveConfiguration($request, $config);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/update-portlet-config", name="pimcore_admin_portal_updateportletconfig", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updatePortletConfigAction(Request $request)
-    {
-        $key = $request->get('key');
-        $id = $request->get('id');
-        $configuration = $request->get('config');
-        $dashboard = $this->dashboardHelper->getDashboard($key);
-        foreach ($dashboard['positions'] as &$col) {
-            foreach ($col as &$portlet) {
-                if ($portlet['id'] == $id) {
-                    $portlet['config'] = $configuration;
-                    break;
-                }
-            }
-        }
-        $this->dashboardHelper->saveDashboard($key, $dashboard);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/portlet-modified-documents", name="pimcore_admin_portal_portletmodifieddocuments", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function portletModifiedDocumentsAction(Request $request)
-    {
-        $list = Document::getList([
-            'limit' => 10,
-            'order' => 'DESC',
-            'orderKey' => 'modificationDate',
-            'condition' => "userModification = '".$this->getAdminUser()->getId()."'",
-        ]);
-        $response = [];
-        $response['documents'] = [];
-        foreach ($list as $doc) {
-            if ($doc->isAllowed('view')) {
-                $response['documents'][] = [
-                    'id' => $doc->getId(),
-                    'type' => $doc->getType(),
-                    'path' => $doc->getRealFullPath(),
-                    'date' => $doc->getModificationDate(),
-                ];
-            }
-        }
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/portlet-modified-assets", name="pimcore_admin_portal_portletmodifiedassets", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function portletModifiedAssetsAction(Request $request)
-    {
-        $list = Asset::getList([
-            'limit' => 10,
-            'order' => 'DESC',
-            'orderKey' => 'modificationDate',
-            'condition' => "userModification = '".$this->getAdminUser()->getId()."'",
-        ]);
-        $response = [];
-        $response['assets'] = [];
-        foreach ($list as $doc) {
-            /**
-             * @var Asset $doc
-             */
-            if ($doc->isAllowed('view')) {
-                $response['assets'][] = [
-                    'id' => $doc->getId(),
-                    'type' => $doc->getType(),
-                    'path' => $doc->getRealFullPath(),
-                    'date' => $doc->getModificationDate(),
-                ];
-            }
-        }
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/portlet-modified-objects", name="pimcore_admin_portal_portletmodifiedobjects", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function portletModifiedObjectsAction(Request $request)
-    {
-        $list = DataObject::getList([
-            'limit' => 10,
-            'order' => 'DESC',
-            'orderKey' => 'o_modificationDate',
-            'condition' => "o_userModification = '".$this->getAdminUser()->getId()."'",
-        ]);
-        $response = [];
-        $response['objects'] = [];
-        foreach ($list as $object) {
-            if ($object->isAllowed('view')) {
-                $response['objects'][] = [
-                    'id' => $object->getId(),
-                    'type' => $object->getType(),
-                    'path' => $object->getRealFullPath(),
-                    'date' => $object->getModificationDate(),
-                ];
-            }
-        }
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/portlet-modification-statistics", name="pimcore_admin_portal_portletmodificationstatistics", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function portletModificationStatisticsAction(Request $request)
-    {
-        $db = \Pimcore\Db::get();
-        $days = 31;
-        $startDate = mktime(23, 59, 59, date('m'), date('d'), date('Y'));
-        $data = [];
-        for ($i = 0; $i < $days; $i++) {
-            $end = $startDate - ($i * 86400);
-            $start = $end - 86399;
-            $o = $db->fetchOne('SELECT COUNT(*) AS count FROM objects WHERE o_modificationDate > '.$start . ' AND o_modificationDate < '.$end);
-            $a = $db->fetchOne('SELECT COUNT(*) AS count FROM assets WHERE modificationDate > '.$start . ' AND modificationDate < '.$end);
-            $d = $db->fetchOne('SELECT COUNT(*) AS count FROM documents WHERE modificationDate > '.$start . ' AND modificationDate < '.$end);
-            $date = new \DateTime();
-            $date->setTimestamp($start);
-            $data[] = [
-                'timestamp' => $start,
-                'datetext' => $date->format('Y-m-d'),
-                'objects' => (int) $o,
-                'documents' => (int) $d,
-                'assets' => (int) $a,
-            ];
-        }
-        $data = array_reverse($data);
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @Route("/portlet-analytics-sites", name="pimcore_admin_portal_portletanalyticssites", methods={"GET"})
-     *
-     * @param TranslatorInterface $translator
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return JsonResponse
-     */
-    public function portletAnalyticsSitesAction(
-        TranslatorInterface $translator,
-        SiteConfigProvider $siteConfigProvider
-    ) {
-        $sites = new Site\Listing();
-        $data = [
-            [
-                'id' => 0,
-                'site' => $translator->trans('main_site', [], 'admin'),
-            ],
-        ];
-        foreach ($sites->load() as $site) {
-            if ($siteConfigProvider->isSiteReportingConfigured($site)) {
-                $data[] = [
-                    'id' => $site->getId(),
-                    'site' => $site->getMainDomain(),
-                ];
-            }
-        }
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->dashboardHelper = new \Pimcore\Helper\Dashboard($this->getAdminUser());
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/RecyclebinController.php
+++ b//dev/null
@@ -1,183 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Model\Element;
-use Pimcore\Model\Element\Recyclebin;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @internal
- */
-class RecyclebinController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/recyclebin/list", name="pimcore_admin_recyclebin_list", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function listAction(Request $request)
-    {
-        if ($request->get('xaction') == 'destroy') {
-            $item = Recyclebin\Item::getById(\Pimcore\Bundle\AdminBundle\Helper\QueryParams::getRecordIdForGridRequest($request->get('data')));
-            $item->delete();
-            return $this->adminJson(['success' => true, 'data' => []]);
-        } else {
-            $db = \Pimcore\Db::get();
-            $list = new Recyclebin\Item\Listing();
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $list->setOrderKey('date');
-            $list->setOrder('DESC');
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-            if ($sortingSettings['orderKey']) {
-                $list->setOrderKey($sortingSettings['orderKey']);
-                $list->setOrder($sortingSettings['order']);
-            }
-            $conditionFilters = [];
-            if ($request->get('filterFullText')) {
-                $conditionFilters[] = 'path LIKE ' . $list->quote('%'. $list->escapeLike($request->get('filterFullText')) .'%');
-            }
-            $filters = $request->get('filter');
-            if ($filters) {
-                $filters = $this->decodeJson($filters);
-                foreach ($filters as $filter) {
-                    $operator = '=';
-                    $filterField = $filter['property'];
-                    $filterOperator = $filter['operator'];
-                    if ($filter['type'] == 'string') {
-                        $operator = 'LIKE';
-                    } elseif ($filter['type'] == 'numeric') {
-                        if ($filterOperator == 'lt') {
-                            $operator = '<';
-                        } elseif ($filterOperator == 'gt') {
-                            $operator = '>';
-                        } elseif ($filterOperator == 'eq') {
-                            $operator = '=';
-                        }
-                    } elseif ($filter['type'] == 'date') {
-                        if ($filterOperator == 'lt') {
-                            $operator = '<';
-                        } elseif ($filterOperator == 'gt') {
-                            $operator = '>';
-                        } elseif ($filterOperator == 'eq') {
-                            $operator = '=';
-                        }
-                        $filter['value'] = strtotime($filter['value']);
-                    } elseif ($filter['type'] == 'list') {
-                        $operator = '=';
-                    } elseif ($filter['type'] == 'boolean') {
-                        $operator = '=';
-                        $filter['value'] = (int) $filter['value'];
-                    }
-                    $value = $filter['value'];
-                    if ($operator == 'LIKE') {
-                        $value = '%' . $value . '%';
-                    }
-                    $field = '`' . $filterField . '` ';
-                    if ($filter['field'] == 'fullpath') {
-                        $field = 'CONCAT(path,filename)';
-                    }
-                    if ($filter['type'] == 'date' && $operator == '=') {
-                        $maxTime = $value + (86400 - 1); //specifies the top point of the range used in the condition
-                        $condition = $field . ' BETWEEN ' . $db->quote($value) . ' AND ' . $db->quote($maxTime);
-                        $conditionFilters[] = $condition;
-                    } else {
-                        $conditionFilters[] = $field . $operator . " '" . $value . "' ";
-                    }
-                }
-            }
-            if (!empty($conditionFilters)) {
-                $condition = implode(' AND ', $conditionFilters);
-                $list->setCondition($condition);
-            }
-            $items = $list->load();
-            $data = [];
-            if (is_array($items)) {
-                /** @var Recyclebin\Item $item */
-                foreach ($items as $item) {
-                    $data[] = $item->getObjectVars();
-                }
-            }
-            return $this->adminJson(['data' => $data, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-    }
-    /**
-     * @Route("/recyclebin/restore", name="pimcore_admin_recyclebin_restore", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function restoreAction(Request $request)
-    {
-        $item = Recyclebin\Item::getById($request->get('id'));
-        $item->restore();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/recyclebin/flush", name="pimcore_admin_recyclebin_flush", methods={"DELETE"})
-     *
-     * @return JsonResponse
-     */
-    public function flushAction()
-    {
-        $bin = new Element\Recyclebin();
-        $bin->flush();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/recyclebin/add", name="pimcore_admin_recyclebin_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        try {
-            $element = Element\Service::getElementById($request->get('type'), $request->get('id'));
-            if ($element) {
-                $list = $element::getList(['unpublished' => true]);
-                $list->setCondition((($request->get('type') === 'object') ? 'o_' : '') . 'path LIKE ' . $list->quote($list->escapeLike($element->getRealFullPath()) . '/%'));
-                $children = $list->getTotalCount();
-                if ($children <= 100) {
-                    Recyclebin\Item::create($element, $this->getAdminUser());
-                }
-            }
-        } catch (\Exception $e) {
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $timeout = 600; // 10 minutes
-        @ini_set('max_execution_time', $timeout);
-        set_time_limit($timeout);
-        $this->checkActionPermission($event, 'recyclebin', ['addAction']);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/RedirectsController.php
+++ b//dev/null
@@ -1,212 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Logger;
-use Pimcore\Model\Document;
-use Pimcore\Model\Redirect;
-use Pimcore\Model\Site;
-use Pimcore\Routing\Redirect\Csv;
-use Pimcore\Routing\RedirectHandler;
-use Symfony\Component\HttpFoundation\File\UploadedFile;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\HttpKernel\Exception\BadRequestHttpException;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/redirects")
- *
- * @internal
- */
-class RedirectsController extends AdminController
-{
-    /**
-     * @Route("/list", name="pimcore_admin_redirects_redirects", methods={"POST"})
-     *
-     * @param Request $request
-     * @param RedirectHandler $redirectHandler
-     *
-     * @return JsonResponse
-     */
-    public function redirectsAction(Request $request, RedirectHandler $redirectHandler)
-    {
-        $this->checkPermission('redirects');
-        if ($request->get('data')) {
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'] ?? null;
-                if ($id) {
-                    $redirect = Redirect::getById($id);
-                    $redirect->delete();
-                }
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $data = $this->decodeJson($request->get('data'));
-                $redirect = Redirect::getById($data['id']);
-                if ($data['target']) {
-                    if ($doc = Document::getByPath($data['target'])) {
-                        $data['target'] = $doc->getId();
-                    }
-                }
-                if (!$data['regex'] && $data['source']) {
-                    $data['source'] = str_replace('+', ' ', $data['source']);
-                }
-                $redirect->setValues($data);
-                $redirect->save();
-                $redirectTarget = $redirect->getTarget();
-                if (is_numeric($redirectTarget)) {
-                    if ($doc = Document::getById((int)$redirectTarget)) {
-                        $redirect->setTarget($doc->getRealFullPath());
-                    }
-                }
-                return $this->adminJson(['data' => $redirect->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $data = $this->decodeJson($request->get('data'));
-                unset($data['id']);
-                $redirect = new Redirect();
-                if (!empty($data['target'])) {
-                    if ($doc = Document::getByPath($data['target'])) {
-                        $data['target'] = $doc->getId();
-                    }
-                }
-                if (isset($data['regex']) && !$data['regex'] && isset($data['source']) && $data['source']) {
-                    $data['source'] = str_replace('+', ' ', $data['source']);
-                }
-                $redirect->setValues($data);
-                $redirect->save();
-                $redirectTarget = $redirect->getTarget();
-                if (is_numeric($redirectTarget)) {
-                    if ($doc = Document::getById((int)$redirectTarget)) {
-                        $redirect->setTarget($doc->getRealFullPath());
-                    }
-                }
-                return $this->adminJson(['data' => $redirect->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Redirect\Listing();
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-            if ($sortingSettings['orderKey']) {
-                $list->setOrderKey($sortingSettings['orderKey']);
-                $list->setOrder($sortingSettings['order']);
-            }
-            if ($filterValue = $request->get('filter')) {
-                if (is_numeric($filterValue)) {
-                    $list->setCondition('id = ?', [$filterValue]);
-                } elseif (preg_match('@^https?://@', $filterValue)) {
-                    $dummyRequest = Request::create($filterValue);
-                    $site = Site::getByDomain($dummyRequest->getHost());
-                    $dummyResponse = $redirectHandler->checkForRedirect($dummyRequest, false, $site);
-                    if ($dummyResponse && $redirectId = $dummyResponse->headers->get(RedirectHandler::RESPONSE_HEADER_NAME_ID)) {
-                        $list->setCondition('id = ?', [$redirectId]);
-                    } else {
-                        $list->setCondition('1 = 2');
-                    }
-                } else {
-                    $list->setCondition('`source` LIKE ' . $list->quote('%' . $filterValue . '%') . ' OR `target` LIKE ' . $list->quote('%' . $filterValue . '%'));
-                }
-            }
-            $list->load();
-            $redirects = [];
-            foreach ($list->getRedirects() as $redirect) {
-                if ($link = $redirect->getTarget()) {
-                    if (is_numeric($link)) {
-                        if ($doc = Document::getById((int)$link)) {
-                            $redirect->setTarget($doc->getRealFullPath());
-                        }
-                    }
-                }
-                $redirects[] = $redirect->getObjectVars();
-            }
-            return $this->adminJson(['data' => $redirects, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/csv-export", name="pimcore_admin_redirects_csvexport", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Csv $csv
-     *
-     * @return Response
-     */
-    public function csvExportAction(Request $request, Csv $csv)
-    {
-        $this->checkPermission('redirects');
-        $list = new Redirect\Listing();
-        $list->setOrderKey('id');
-        $list->setOrder('ASC');
-        $list->load();
-        $writer = $csv->createExportWriter($list);
-        $response = new Response();
-        $response->headers->set('Content-Encoding', 'none');
-        $response->headers->set('Content-Type', 'text/csv; charset=UTF-8');
-        $response->headers->set('Content-Disposition', $response->headers->makeDisposition(
-            ResponseHeaderBag::DISPOSITION_ATTACHMENT,
-            'redirects.csv'
-        ));
-        $response->setContent($writer->getContent());
-        return $response;
-    }
-    /**
-     * @Route("/csv-import", name="pimcore_admin_redirects_csvimport", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Csv $csv
-     *
-     * @return Response
-     */
-    public function csvImportAction(Request $request, Csv $csv)
-    {
-        $this->checkPermission('redirects');
-        /** @var UploadedFile|null $file */
-        $file = $request->files->get('redirects');
-        if (!$file) {
-            throw new BadRequestHttpException('Missing file');
-        }
-        $result = $csv->import($file->getRealPath());
-        return $this->adminJson([
-            'success' => true,
-            'data' => $result,
-        ]);
-    }
-    /**
-     * @Route("/cleanup", name="pimcore_admin_redirects_cleanup", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function cleanupAction(Request $request)
-    {
-        $this->checkPermission('redirects');
-        try {
-            $now = time();
-            $expiredRedirects = new Redirect\Listing();
-            $expiredRedirects->setCondition("expiry IS NOT NULL AND expiry < $now");
-            $expiredRedirects = $expiredRedirects->load();
-            foreach ($expiredRedirects as $expiredRedirect) {
-                $expiredRedirect->delete();
-            }
-            return $this->adminJson(['success' => true]);
-        } catch (\Exception $e) {
-            Logger::error($e->getMessage());
-            return $this->adminJson(['success' => false]);
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/SettingsController.php
+++ b//dev/null
@@ -1,1383 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Cache;
-use Pimcore\Cache\Core\CoreCacheHandler;
-use Pimcore\Cache\Symfony\CacheClearer;
-use Pimcore\Config;
-use Pimcore\Event\SystemEvents;
-use Pimcore\File;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Model;
-use Pimcore\Model\Asset;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Pimcore\Model\Glossary;
-use Pimcore\Model\Metadata;
-use Pimcore\Model\Property;
-use Pimcore\Model\Staticroute;
-use Pimcore\Model\Tool\SettingsStore;
-use Pimcore\Model\WebsiteSetting;
-use Pimcore\Tool;
-use Symfony\Component\EventDispatcher\EventDispatcherInterface;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\Filesystem\Filesystem;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\StreamedResponse;
-use Symfony\Component\HttpKernel\KernelEvents;
-use Symfony\Component\HttpKernel\KernelInterface;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Component\Yaml\Yaml;
-/**
- * @Route("/settings")
- *
- * @internal
- */
-class SettingsController extends AdminController
-{
-    private const CUSTOM_LOGO_PATH = 'custom-logo.image';
-    /**
-     * @Route("/display-custom-logo", name="pimcore_settings_display_custom_logo", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function displayCustomLogoAction(Request $request)
-    {
-        $mime = 'image/svg+xml';
-        if ($request->get('white')) {
-            $logo = PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin/img/logo-claim-white.svg';
-        } else {
-            $logo = PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin/img/logo-claim-gray.svg';
-        }
-        $stream = fopen($logo, 'rb');
-        $storage = Tool\Storage::get('admin');
-        if ($storage->fileExists(self::CUSTOM_LOGO_PATH)) {
-            try {
-                $mime = $storage->mimeType(self::CUSTOM_LOGO_PATH);
-                $stream = $storage->readStream(self::CUSTOM_LOGO_PATH);
-            } catch (\Exception $e) {
-            }
-        }
-        return new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, ['Content-Type' => $mime]);
-    }
-    /**
-     * @Route("/upload-custom-logo", name="pimcore_admin_settings_uploadcustomlogo", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function uploadCustomLogoAction(Request $request)
-    {
-        $fileExt = File::getFileExtension($_FILES['Filedata']['name']);
-        if (!in_array($fileExt, ['svg', 'png', 'jpg'])) {
-            throw new \Exception('Unsupported file format');
-        }
-        $storage = Tool\Storage::get('admin');
-        $storage->writeStream(self::CUSTOM_LOGO_PATH, fopen($_FILES['Filedata']['tmp_name'], 'rb'));
-        $response = $this->adminJson(['success' => true]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/delete-custom-logo", name="pimcore_admin_settings_deletecustomlogo", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteCustomLogoAction(Request $request)
-    {
-        if (Tool\Storage::get('admin')->fileExists(self::CUSTOM_LOGO_PATH)) {
-            Tool\Storage::get('admin')->delete(self::CUSTOM_LOGO_PATH);
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * Used by the predefined metadata grid
-     *
-     * @Route("/predefined-metadata", name="pimcore_admin_settings_metadata", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function metadataAction(Request $request)
-    {
-        $this->checkPermission('asset_metadata');
-        if ($request->get('data')) {
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'];
-                $metadata = Metadata\Predefined::getById($id);
-                $metadata->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $data = $this->decodeJson($request->get('data'));
-                $metadata = Metadata\Predefined::getById($data['id']);
-                $metadata->setValues($data);
-                $existingItem = Metadata\Predefined\Listing::getByKeyAndLanguage($metadata->getName(), $metadata->getLanguage(), $metadata->getTargetSubtype());
-                if ($existingItem && $existingItem->getId() != $metadata->getId()) {
-                    return $this->adminJson(['message' => 'rule_violation', 'success' => false]);
-                }
-                $metadata->minimize();
-                $metadata->save();
-                $metadata->expand();
-                return $this->adminJson(['data' => $metadata->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $data = $this->decodeJson($request->get('data'));
-                unset($data['id']);
-                $metadata = Metadata\Predefined::create();
-                $metadata->setValues($data);
-                $existingItem = Metadata\Predefined\Listing::getByKeyAndLanguage($metadata->getName(), $metadata->getLanguage(), $metadata->getTargetSubtype());
-                if ($existingItem) {
-                    return $this->adminJson(['message' => 'rule_violation', 'success' => false]);
-                }
-                $metadata->save();
-                return $this->adminJson(['data' => $metadata->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Metadata\Predefined\Listing();
-            if ($request->get('filter')) {
-                $filter = $request->get('filter');
-                $list->setFilter(function ($row) use ($filter) {
-                    foreach ($row as $value) {
-                        if (strpos($value, $filter) !== false) {
-                            return true;
-                        }
-                    }
-                    return false;
-                });
-            }
-            $list->load();
-            $properties = [];
-            if (is_array($list->getDefinitions())) {
-                foreach ($list->getDefinitions() as $metadata) {
-                    $metadata->expand();
-                    $properties[] = $metadata->getObjectVars();
-                }
-            }
-            return $this->adminJson(['data' => $properties, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-predefined-metadata", name="pimcore_admin_settings_getpredefinedmetadata", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getPredefinedMetadataAction(Request $request)
-    {
-        $type = $request->get('type');
-        $subType = $request->get('subType');
-        $list = Metadata\Predefined\Listing::getByTargetType($type, [$subType]);
-        $result = [];
-        foreach ($list as $item) {
-            $item->expand();
-            $result[] = $item->getObjectVars();
-        }
-        return $this->adminJson(['data' => $result, 'success' => true]);
-    }
-    /**
-     * @Route("/properties", name="pimcore_admin_settings_properties", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function propertiesAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $this->checkPermission('predefined_properties');
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'];
-                $property = Property\Predefined::getById($id);
-                $property->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $data = $this->decodeJson($request->get('data'));
-                $property = Property\Predefined::getById($data['id']);
-                if (is_array($data['ctype'])) {
-                    $data['ctype'] = implode(',', $data['ctype']);
-                }
-                $property->setValues($data);
-                $property->save();
-                return $this->adminJson(['data' => $property->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $data = $this->decodeJson($request->get('data'));
-                unset($data['id']);
-                $property = Property\Predefined::create();
-                $property->setValues($data);
-                $property->save();
-                return $this->adminJson(['data' => $property->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Property\Predefined\Listing();
-            if ($request->get('filter')) {
-                $filter = $request->get('filter');
-                $list->setFilter(function ($row) use ($filter) {
-                    foreach ($row as $value) {
-                        if ($value) {
-                            $cellValues = is_array($value) ? $value : [$value];
-                            foreach ($cellValues as $cellValue) {
-                                if (strpos($cellValue, $filter) !== false) {
-                                    return true;
-                                }
-                            }
-                        }
-                    }
-                    return false;
-                });
-            }
-            $list->load();
-            $properties = [];
-            if (is_array($list->getProperties())) {
-                foreach ($list->getProperties() as $property) {
-                    $properties[] = $property->getObjectVars();
-                }
-            }
-            return $this->adminJson(['data' => $properties, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-system", name="pimcore_admin_settings_getsystem", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function getSystemAction(Request $request, Config $config)
-    {
-        $this->checkPermission('system_settings');
-        $valueArray = [
-            'general' => $config['general'],
-            'documents' => $config['documents'],
-            'assets' => $config['assets'],
-            'objects' => $config['objects'],
-            'branding' => $config['branding'],
-            'email' => $config['email'],
-        ];
-        $locales = Tool::getSupportedLocales();
-        $languageOptions = [];
-        $validLanguages = [];
-        foreach ($locales as $short => $translation) {
-            if (!empty($short)) {
-                $languageOptions[] = [
-                    'language' => $short,
-                    'display' => $translation . " ($short)",
-                ];
-                $validLanguages[] = $short;
-            }
-        }
-        $valueArray['general']['valid_language'] = explode(',', $valueArray['general']['valid_languages']);
-        if (is_array($valueArray['general']['valid_language'])) {
-            foreach ($valueArray['general']['valid_language'] as $existingValue) {
-                if (!in_array($existingValue, $validLanguages)) {
-                    $languageOptions[] = [
-                        'language' => $existingValue,
-                        'display' => $existingValue,
-                    ];
-                }
-            }
-        }
-        $response = [
-            'values' => $valueArray,
-            'config' => [
-                'languages' => $languageOptions,
-            ],
-        ];
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/set-system", name="pimcore_admin_settings_setsystem", methods={"PUT"})
-     *
-     * @param Request $request
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return JsonResponse
-     */
-    public function setSystemAction(Request $request, LocaleServiceInterface $localeService)
-    {
-        $this->checkPermission('system_settings');
-        $values = $this->decodeJson($request->get('data'));
-        $existingValues = [];
-        try {
-            $file = Config::locateConfigFile('system.yml');
-            $existingValues = Config::getConfigInstance($file, true);
-        } catch (\Exception $e) {
-        }
-        $fallbackLanguages = [];
-        $existingValues['pimcore']['general']['fallback_languages'] = [];
-        $languages = explode(',', $values['general.validLanguages']);
-        $filteredLanguages = [];
-        foreach ($languages as $language) {
-            if (isset($values['general.fallbackLanguages.' . $language])) {
-                $fallbackLanguages[$language] = str_replace(' ', '', $values['general.fallbackLanguages.' . $language]);
-            }
-            if ($localeService->isLocale($language)) {
-                $filteredLanguages[] = $language;
-            }
-        }
-        foreach ($fallbackLanguages as $sourceLang => $targetLang) {
-            $this->checkFallbackLanguageLoop($sourceLang, $fallbackLanguages);
-        }
-        $settings['pimcore'] = [
-            'general' => [
-                'domain' => $values['general.domain'],
-                'redirect_to_maindomain' => $values['general.redirect_to_maindomain'],
-                'language' => $values['general.language'],
-                'valid_languages' => implode(',', $filteredLanguages),
-                'fallback_languages' => $fallbackLanguages,
-                'default_language' => $values['general.defaultLanguage'],
-                'debug_admin_translations' => $values['general.debug_admin_translations'],
-            ],
-            'documents' => [
-                'versions' => [
-                    'days' => $values['documents.versions.days'] ?? null,
-                    'steps' => $values['documents.versions.steps'] ?? null,
-                ],
-                'error_pages' => [
-                    'default' => $values['documents.error_pages.default'],
-                ],
-            ],
-            'objects' => [
-                'versions' => [
-                    'days' => $values['objects.versions.days'] ?? null,
-                    'steps' => $values['objects.versions.steps'] ?? null,
-                ],
-            ],
-            'assets' => [
-                'versions' => [
-                    'days' => $values['assets.versions.days'] ?? null,
-                    'steps' => $values['assets.versions.steps'] ?? null,
-                ],
-                'hide_edit_image' => $values['assets.hide_edit_image'],
-                'disable_tree_preview' => $values['assets.disable_tree_preview'],
-            ],
-        ];
-        $settings['pimcore_admin'] = [
-            'branding' =>
-                [
-                    'login_screen_invert_colors' => $values['branding.login_screen_invert_colors'],
-                    'color_login_screen' => $values['branding.color_login_screen'],
-                    'color_admin_interface' => $values['branding.color_admin_interface'],
-                    'login_screen_custom_image' => $values['branding.login_screen_custom_image'],
-                ],
-        ];
-        if (array_key_exists('email.debug.emailAddresses', $values) && $values['email.debug.emailAddresses']) {
-            $settings['pimcore']['email']['debug']['email_addresses'] = $values['email.debug.emailAddresses'];
-        }
-        $settingsYml = Yaml::dump($settings, 5);
-        $configFile = Config::locateConfigFile('system.yml');
-        File::put($configFile, $settingsYml);
-        $this->forward(self::class . '::clearCacheAction', [
-            'only_symfony_cache' => false,
-            'only_pimcore_cache' => false,
-            'env' => [\Pimcore::getKernel()->getEnvironment()],
-        ]);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param string $source
-     * @param array $definitions
-     * @param array $fallbacks
-     *
-     * @throws \Exception
-     */
-    protected function checkFallbackLanguageLoop($source, $definitions, $fallbacks = [])
-    {
-        if (isset($definitions[$source])) {
-            $targets = explode(',', $definitions[$source]);
-            foreach ($targets as $l) {
-                $target = trim($l);
-                if ($target) {
-                    if (in_array($target, $fallbacks)) {
-                        throw new \Exception("Language `$source` | `$target` causes an infinte loop.");
-                    }
-                    $fallbacks[] = $target;
-                    $this->checkFallbackLanguageLoop($target, $definitions, $fallbacks);
-                }
-            }
-        } else {
-            throw new \Exception("Language `$source` doesn't exist");
-        }
-    }
-    /**
-     * @Route("/get-web2print", name="pimcore_admin_settings_getweb2print", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getWeb2printAction(Request $request)
-    {
-        $this->checkPermission('web2print_settings');
-        $values = Config::getWeb2PrintConfig();
-        $valueArray = $values->toArray();
-        $optionsString = [];
-        if ($valueArray['wkhtml2pdfOptions']) {
-            foreach ($valueArray['wkhtml2pdfOptions'] as $key => $value) {
-                $tmpStr = '--'.$key;
-                if ($value !== null && $value !== '') {
-                    $tmpStr .= ' '.$value;
-                }
-                $optionsString[] = $tmpStr;
-            }
-        }
-        $valueArray['wkhtml2pdfOptions'] = implode("\n", $optionsString);
-        $response = [
-            'values' => $valueArray,
-        ];
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/set-web2print", name="pimcore_admin_settings_setweb2print", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function setWeb2printAction(Request $request)
-    {
-        $this->checkPermission('web2print_settings');
-        $values = $this->decodeJson($request->get('data'));
-        if ($values['wkhtml2pdfOptions']) {
-            $optionArray = [];
-            $lines = explode("\n", $values['wkhtml2pdfOptions']);
-            foreach ($lines as $line) {
-                $parts = explode(' ', substr($line, 2));
-                $key = trim($parts[0]);
-                if ($key) {
-                    $value = trim($parts[1] ?? '');
-                    $optionArray[$key] = $value;
-                }
-            }
-            $values['wkhtml2pdfOptions'] = $optionArray;
-        }
-        $configFile = \Pimcore\Config::locateConfigFile('web2print.php');
-        File::putPhpFile($configFile, to_php_data_file_format($values));
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/clear-cache", name="pimcore_admin_settings_clearcache", methods={"DELETE"})
-     *
-     * @param Request $request
-     * @param KernelInterface $kernel
-     * @param EventDispatcherInterface $eventDispatcher
-     * @param CoreCacheHandler $cache
-     * @param Filesystem $filesystem
-     * @param CacheClearer $symfonyCacheClearer
-     *
-     * @return JsonResponse
-     */
-    public function clearCacheAction(
-        Request $request,
-        KernelInterface $kernel,
-        EventDispatcherInterface $eventDispatcher,
-        CoreCacheHandler $cache,
-        Filesystem $filesystem,
-        CacheClearer $symfonyCacheClearer
-    ) {
-        $this->checkPermissionsHasOneOf(['clear_cache', 'system_settings']);
-        $result = [
-            'success' => true,
-        ];
-        $clearPimcoreCache = !(bool)$request->get('only_symfony_cache');
-        $clearSymfonyCache = !(bool)$request->get('only_pimcore_cache');
-        if ($clearPimcoreCache) {
-            $cache->clearAll();
-            if ($filesystem->exists(PIMCORE_CACHE_DIRECTORY)) {
-                $filesystem->remove(PIMCORE_CACHE_DIRECTORY);
-            }
-            File::put(PIMCORE_CACHE_DIRECTORY . '/.gitkeep', '');
-            $eventDispatcher->dispatch(new GenericEvent(), SystemEvents::CACHE_CLEAR);
-        }
-        if ($clearSymfonyCache) {
-            $environments = $request->get('env', $kernel->getEnvironment());
-            if (!is_array($environments)) {
-                $environments = trim((string)$environments);
-                if (empty($environments)) {
-                    $environments = [];
-                } else {
-                    $environments = [$environments];
-                }
-            }
-            if (empty($environments)) {
-                $environments = [$kernel->getEnvironment()];
-            }
-            $result['environments'] = $environments;
-            if (in_array($kernel->getEnvironment(), $environments)) {
-                foreach ($eventDispatcher->getListeners(KernelEvents::TERMINATE) as $listener) {
-                    $eventDispatcher->removeListener(KernelEvents::TERMINATE, $listener);
-                }
-                foreach ($eventDispatcher->getListeners(KernelEvents::EXCEPTION) as $listener) {
-                    $eventDispatcher->removeListener(KernelEvents::EXCEPTION, $listener);
-                }
-            }
-            foreach ($environments as $environment) {
-                try {
-                    $symfonyCacheClearer->clear($environment);
-                } catch (\Throwable $e) {
-                    $errors = $result['errors'] ?? [];
-                    $errors[] = $e->getMessage();
-                    $result = array_merge($result, [
-                        'success' => false,
-                        'errors' => $errors,
-                    ]);
-                }
-            }
-        }
-        $response = new JsonResponse($result);
-        if ($clearSymfonyCache) {
-            $response->sendHeaders();
-            $response->sendContent();
-            exit;
-        }
-        return $response;
-    }
-    /**
-     * @Route("/clear-output-cache", name="pimcore_admin_settings_clearoutputcache", methods={"DELETE"})
-     *
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function clearOutputCacheAction(EventDispatcherInterface $eventDispatcher)
-    {
-        $this->checkPermission('clear_fullpage_cache');
-        Cache::removeIgnoredTagOnClear('output');
-        Cache::clearTags(['output', 'output_lifetime']);
-        $eventDispatcher->dispatch(new GenericEvent(), SystemEvents::CACHE_CLEAR_FULLPAGE_CACHE);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/clear-temporary-files", name="pimcore_admin_settings_cleartemporaryfiles", methods={"DELETE"})
-     *
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function clearTemporaryFilesAction(EventDispatcherInterface $eventDispatcher)
-    {
-        $this->checkPermission('clear_temp_files');
-        Tool\Storage::get('thumbnail')->deleteDirectory('/');
-        Tool\Storage::get('asset_cache')->deleteDirectory('/');
-        recursiveDelete(PIMCORE_SYSTEM_TEMP_DIRECTORY, false);
-        $eventDispatcher->dispatch(new GenericEvent(), SystemEvents::CACHE_CLEAR_TEMPORARY_FILES);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/staticroutes", name="pimcore_admin_settings_staticroutes", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function staticroutesAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $this->checkPermission('routes');
-            $data = $this->decodeJson($request->get('data'));
-            if (is_array($data)) {
-                foreach ($data as &$value) {
-                    if (is_string($value)) {
-                        $value = trim($value);
-                    }
-                }
-            }
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'];
-                $route = Staticroute::getById($id);
-                $route->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $route = Staticroute::getById($data['id']);
-                $route->setValues($data);
-                $route->save();
-                return $this->adminJson(['data' => $route->getObjectVars(), 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                unset($data['id']);
-                $route = new Staticroute();
-                $route->setValues($data);
-                $route->save();
-                return $this->adminJson(['data' => $route->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Staticroute\Listing();
-            if ($request->get('filter')) {
-                $filter = $request->get('filter');
-                $list->setFilter(function ($row) use ($filter) {
-                    foreach ($row as $value) {
-                        if (! is_scalar($value)) {
-                            continue;
-                        }
-                        if (strpos((string)$value, $filter) !== false) {
-                            return true;
-                        }
-                    }
-                    return false;
-                });
-            }
-            $list->load();
-            $routes = [];
-            /** @var Staticroute $route */
-            foreach ($list->getRoutes() as $route) {
-                if (is_array($route->getSiteId())) {
-                    $route = $route->getObjectVars();
-                    $route['siteId'] = implode(',', $route['siteId']);
-                }
-                $routes[] = $route;
-            }
-            return $this->adminJson(['data' => $routes, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-available-admin-languages", name="pimcore_admin_settings_getavailableadminlanguages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableAdminLanguagesAction(Request $request)
-    {
-        $langs = [];
-        $availableLanguages = Tool\Admin::getLanguages();
-        $locales = Tool::getSupportedLocales();
-        foreach ($availableLanguages as $lang) {
-            if (array_key_exists($lang, $locales)) {
-                $langs[] = [
-                    'language' => $lang,
-                    'display' => $locales[$lang],
-                ];
-            }
-        }
-        usort($langs, function ($a, $b) {
-            return strcmp($a['display'], $b['display']);
-        });
-        return $this->adminJson($langs);
-    }
-    /**
-     * @Route("/glossary", name="pimcore_admin_settings_glossary", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function glossaryAction(Request $request)
-    {
-        if ($request->get('data')) {
-            $this->checkPermission('glossary');
-            Cache::clearTag('glossary');
-            if ($request->get('xaction') == 'destroy') {
-                $data = $this->decodeJson($request->get('data'));
-                $id = $data['id'];
-                $glossary = Glossary::getById($id);
-                $glossary->delete();
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $data = $this->decodeJson($request->get('data'));
-                $glossary = Glossary::getById($data['id']);
-                if (!empty($data['link'])) {
-                    if ($doc = Document::getByPath($data['link'])) {
-                        $data['link'] = $doc->getId();
-                    }
-                }
-                $glossary->setValues($data);
-                $glossary->save();
-                if ($link = $glossary->getLink()) {
-                    if ((int)$link > 0) {
-                        if ($doc = Document::getById((int)$link)) {
-                            $glossary->setLink($doc->getRealFullPath());
-                        }
-                    }
-                }
-                return $this->adminJson(['data' => $glossary, 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $data = $this->decodeJson($request->get('data'));
-                unset($data['id']);
-                $glossary = new Glossary();
-                if (!empty($data['link'])) {
-                    if ($doc = Document::getByPath($data['link'])) {
-                        $data['link'] = $doc->getId();
-                    }
-                }
-                $glossary->setValues($data);
-                $glossary->save();
-                if ($link = $glossary->getLink()) {
-                    if ((int)$link > 0) {
-                        if ($doc = Document::getById((int)$link)) {
-                            $glossary->setLink($doc->getRealFullPath());
-                        }
-                    }
-                }
-                return $this->adminJson(['data' => $glossary->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new Glossary\Listing();
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-            if ($sortingSettings['orderKey']) {
-                $list->setOrderKey($sortingSettings['orderKey']);
-                $list->setOrder($sortingSettings['order']);
-            }
-            if ($request->get('filter')) {
-                $list->setCondition('`text` LIKE ' . $list->quote('%'.$request->get('filter').'%'));
-            }
-            $list->load();
-            $glossaries = [];
-            foreach ($list->getGlossary() as $glossary) {
-                if ($link = $glossary->getLink()) {
-                    if ((int)$link > 0) {
-                        if ($doc = Document::getById((int)$link)) {
-                            $glossary->setLink($doc->getRealFullPath());
-                        }
-                    }
-                }
-                $glossaries[] = $glossary->getObjectVars();
-            }
-            return $this->adminJson(['data' => $glossaries, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @Route("/get-available-sites", name="pimcore_admin_settings_getavailablesites", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableSitesAction(Request $request)
-    {
-        $excludeMainSite = $request->get('excludeMainSite');
-        $sitesList = new Model\Site\Listing();
-        $sitesObjects = $sitesList->load();
-        $sites = [];
-        if (!$excludeMainSite) {
-            $sites[] = [
-                'id' => 'default',
-                'rootId' => 1,
-                'domains' => '',
-                'rootPath' => '/',
-                'domain' => $this->trans('main_site'),
-            ];
-        }
-        foreach ($sitesObjects as $site) {
-            if ($site->getRootDocument()) {
-                if ($site->getMainDomain()) {
-                    $sites[] = [
-                        'id' => $site->getId(),
-                        'rootId' => $site->getRootId(),
-                        'domains' => implode(',', $site->getDomains()),
-                        'rootPath' => $site->getRootPath(),
-                        'domain' => $site->getMainDomain(),
-                    ];
-                }
-            } else {
-                $site->delete();
-            }
-        }
-        return $this->adminJson($sites);
-    }
-    /**
-     * @Route("/get-available-countries", name="pimcore_admin_settings_getavailablecountries", methods={"GET"})
-     *
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableCountriesAction(LocaleServiceInterface $localeService)
-    {
-        $countries = $localeService->getDisplayRegions();
-        asort($countries);
-        $options = [];
-        foreach ($countries as $short => $translation) {
-            if (strlen($short) == 2) {
-                $options[] = [
-                    'key' => $translation . ' (' . $short . ')',
-                    'value' => $short,
-                ];
-            }
-        }
-        $result = ['data' => $options, 'success' => true, 'total' => count($options)];
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/thumbnail-adapter-check", name="pimcore_admin_settings_thumbnailadaptercheck", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function thumbnailAdapterCheckAction(Request $request)
-    {
-        $content = '';
-        $instance = \Pimcore\Image::getInstance();
-        if ($instance instanceof \Pimcore\Image\Adapter\GD) {
-            $content = '<span style="color: red; font-weight: bold;padding: 10px;margin:0 0 20px 0;border:1px solid red;display:block;">' .
-                $this->trans('important_use_imagick_pecl_extensions_for_best_results_gd_is_just_a_fallback_with_less_quality') .
-                '</span>';
-        }
-        return new Response($content);
-    }
-    /**
-     * @Route("/thumbnail-tree", name="pimcore_admin_settings_thumbnailtree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailTreeAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $thumbnails = [];
-        $list = new Asset\Image\Thumbnail\Config\Listing();
-        $items = $list->getThumbnails();
-        $groups = [];
-        /** @var Asset\Image\Thumbnail\Config $item */
-        foreach ($items as $item) {
-            if ($item->getGroup()) {
-                if (empty($groups[$item->getGroup()])) {
-                    $groups[$item->getGroup()] = [
-                        'id' => 'group_' . $item->getName(),
-                        'text' => $item->getGroup(),
-                        'expandable' => true,
-                        'leaf' => false,
-                        'allowChildren' => true,
-                        'iconCls' => 'pimcore_icon_folder',
-                        'group' => $item->getGroup(),
-                        'children' => [],
-                        ];
-                }
-                $groups[$item->getGroup()]['children'][] =
-                    [
-                        'id' => $item->getName(),
-                        'text' => $item->getName(),
-                        'leaf' => true,
-                        'iconCls' => 'pimcore_icon_thumbnails',
-                    ];
-            } else {
-                $thumbnails[] = [
-                    'id' => $item->getName(),
-                    'text' => $item->getName(),
-                    'leaf' => true,
-                    'iconCls' => 'pimcore_icon_thumbnails',
-                ];
-            }
-        }
-        foreach ($groups as $group) {
-            $thumbnails[] = $group;
-        }
-        return $this->adminJson($thumbnails);
-    }
-    /**
-     * @Route("/thumbnail-downloadable", name="pimcore_admin_settings_thumbnaildownloadable", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailDownloadableAction(Request $request)
-    {
-        $thumbnails = [];
-        $list = new Asset\Image\Thumbnail\Config\Listing();
-        $list->setFilter(function (array $config) {
-            return array_key_exists('downloadable', $config) ? $config['downloadable'] : false;
-        });
-        $items = $list->getThumbnails();
-        /** @var Asset\Image\Thumbnail\Config $item */
-        foreach ($items as $item) {
-            $thumbnails[] = [
-                'id' => $item->getName(),
-                'text' => $item->getName(),
-            ];
-        }
-        return $this->adminJson($thumbnails);
-    }
-    /**
-     * @Route("/thumbnail-add", name="pimcore_admin_settings_thumbnailadd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailAddAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $success = false;
-        $pipe = Asset\Image\Thumbnail\Config::getByName($request->get('name'));
-        if (!$pipe) {
-            $pipe = new Asset\Image\Thumbnail\Config();
-            $pipe->setName($request->get('name'));
-            $pipe->save();
-            $success = true;
-        }
-        return $this->adminJson(['success' => $success, 'id' => $pipe->getName()]);
-    }
-    /**
-     * @Route("/thumbnail-delete", name="pimcore_admin_settings_thumbnaildelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailDeleteAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Image\Thumbnail\Config::getByName($request->get('name'));
-        $pipe->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/thumbnail-get", name="pimcore_admin_settings_thumbnailget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailGetAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Image\Thumbnail\Config::getByName($request->get('name'));
-        return $this->adminJson($pipe->getObjectVars());
-    }
-    /**
-     * @Route("/thumbnail-update", name="pimcore_admin_settings_thumbnailupdate", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function thumbnailUpdateAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Image\Thumbnail\Config::getByName($request->get('name'));
-        $settingsData = $this->decodeJson($request->get('settings'));
-        $mediaData = $this->decodeJson($request->get('medias'));
-        $mediaOrder = $this->decodeJson($request->get('mediaOrder'));
-        foreach ($settingsData as $key => $value) {
-            $setter = 'set' . ucfirst($key);
-            if (method_exists($pipe, $setter)) {
-                $pipe->$setter($value);
-            }
-        }
-        $pipe->resetItems();
-        uksort($mediaData, function ($a, $b) use ($mediaOrder) {
-            if ($a === 'default') {
-                return -1;
-            }
-            return ($mediaOrder[$a] < $mediaOrder[$b]) ? -1 : 1;
-        });
-        foreach ($mediaData as $mediaName => $items) {
-            foreach ($items as $item) {
-                $type = $item['type'];
-                unset($item['type']);
-                $pipe->addItem($type, $item, $mediaName);
-            }
-        }
-        $pipe->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/video-thumbnail-adapter-check", name="pimcore_admin_settings_videothumbnailadaptercheck", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function videoThumbnailAdapterCheckAction(Request $request)
-    {
-        $content = '';
-        if (!\Pimcore\Video::isAvailable()) {
-            $content = '<span style="color: red; font-weight: bold;padding: 10px;margin:0 0 20px 0;border:1px solid red;display:block;">' .
-                $this->trans('php_cli_binary_and_or_ffmpeg_binary_setting_is_missing') .
-                '</span>';
-        }
-        return new Response($content);
-    }
-    /**
-     * @Route("/video-thumbnail-tree", name="pimcore_admin_settings_videothumbnailtree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function videoThumbnailTreeAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $thumbnails = [];
-        $list = new Asset\Video\Thumbnail\Config\Listing();
-        $items = $list->getThumbnails();
-        $groups = [];
-        /** @var Asset\Image\Thumbnail\Config $item */
-        foreach ($items as $item) {
-            if ($item->getGroup()) {
-                if (!$groups[$item->getGroup()]) {
-                    $groups[$item->getGroup()] = [
-                        'id' => 'group_' . $item->getName(),
-                        'text' => $item->getGroup(),
-                        'expandable' => true,
-                        'leaf' => false,
-                        'allowChildren' => true,
-                        'iconCls' => 'pimcore_icon_folder',
-                        'group' => $item->getGroup(),
-                        'children' => [],
-                    ];
-                }
-                $groups[$item->getGroup()]['children'][] =
-                    [
-                        'id' => $item->getName(),
-                        'text' => $item->getName(),
-                        'leaf' => true,
-                        'iconCls' => 'pimcore_icon_videothumbnails',
-                    ];
-            } else {
-                $thumbnails[] = [
-                    'id' => $item->getName(),
-                    'text' => $item->getName(),
-                    'leaf' => true,
-                    'iconCls' => 'pimcore_icon_videothumbnails',
-                ];
-            }
-        }
-        foreach ($groups as $group) {
-            $thumbnails[] = $group;
-        }
-        return $this->adminJson($thumbnails);
-    }
-    /**
-     * @Route("/video-thumbnail-add", name="pimcore_admin_settings_videothumbnailadd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function videoThumbnailAddAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $success = false;
-        $pipe = Asset\Video\Thumbnail\Config::getByName($request->get('name'));
-        if (!$pipe) {
-            $pipe = new Asset\Video\Thumbnail\Config();
-            $pipe->setName($request->get('name'));
-            $pipe->save();
-            $success = true;
-        }
-        return $this->adminJson(['success' => $success, 'id' => $pipe->getName()]);
-    }
-    /**
-     * @Route("/video-thumbnail-delete", name="pimcore_admin_settings_videothumbnaildelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function videoThumbnailDeleteAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Video\Thumbnail\Config::getByName($request->get('name'));
-        $pipe->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/video-thumbnail-get", name="pimcore_admin_settings_videothumbnailget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function videoThumbnailGetAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Video\Thumbnail\Config::getByName($request->get('name'));
-        return $this->adminJson($pipe->getObjectVars());
-    }
-    /**
-     * @Route("/video-thumbnail-update", name="pimcore_admin_settings_videothumbnailupdate", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function videoThumbnailUpdateAction(Request $request)
-    {
-        $this->checkPermission('thumbnails');
-        $pipe = Asset\Video\Thumbnail\Config::getByName($request->get('name'));
-        $settingsData = $this->decodeJson($request->get('settings'));
-        $mediaData = $this->decodeJson($request->get('medias'));
-        $mediaOrder = $this->decodeJson($request->get('mediaOrder'));
-        foreach ($settingsData as $key => $value) {
-            $setter = 'set' . ucfirst($key);
-            if (method_exists($pipe, $setter)) {
-                $pipe->$setter($value);
-            }
-        }
-        $pipe->resetItems();
-        uksort($mediaData, function ($a, $b) use ($mediaOrder) {
-            if ($a === 'default') {
-                return -1;
-            }
-            return ($mediaOrder[$a] < $mediaOrder[$b]) ? -1 : 1;
-        });
-        foreach ($mediaData as $mediaName => $items) {
-            foreach ($items as $item) {
-                $type = $item['type'];
-                unset($item['type']);
-                $pipe->addItem($type, $item, $mediaName);
-            }
-        }
-        $pipe->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/robots-txt", name="pimcore_admin_settings_robotstxtget", methods={"GET"})
-     *
-     * @return JsonResponse
-     */
-    public function robotsTxtGetAction()
-    {
-        $this->checkPermission('robots.txt');
-        $config = Config::getRobotsConfig();
-        $config = $config->toArray();
-        return $this->adminJson([
-            'success' => true,
-            'data' => $config,
-            'onFileSystem' => file_exists(PIMCORE_WEB_ROOT . '/robots.txt'),
-        ]);
-    }
-    /**
-     * @Route("/robots-txt", name="pimcore_admin_settings_robotstxtput", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function robotsTxtPutAction(Request $request)
-    {
-        $this->checkPermission('robots.txt');
-        $values = $request->get('data');
-        if (!is_array($values)) {
-            $values = [];
-        }
-        foreach ($values as $siteId => $robotsContent) {
-            SettingsStore::set('robots.txt-' . $siteId, $robotsContent, 'string', 'robots.txt');
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/website-settings", name="pimcore_admin_settings_websitesettings", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function websiteSettingsAction(Request $request)
-    {
-        $this->checkPermission('website_settings');
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            if (is_array($data)) {
-                foreach ($data as &$value) {
-                    $value = trim($value);
-                }
-            }
-            if ($request->get('xaction') == 'destroy') {
-                $id = $data['id'];
-                $setting = WebsiteSetting::getById($id);
-                if ($setting instanceof WebsiteSetting) {
-                    $setting->delete();
-                    return $this->adminJson(['success' => true, 'data' => []]);
-                }
-            } elseif ($request->get('xaction') == 'update') {
-                $setting = WebsiteSetting::getById($data['id']);
-                if ($setting instanceof WebsiteSetting) {
-                    switch ($setting->getType()) {
-                        case 'document':
-                        case 'asset':
-                        case 'object':
-                            if (isset($data['data'])) {
-                                $element = Element\Service::getElementByPath($setting->getType(), $data['data']);
-                                $data['data'] = $element;
-                            }
-                            break;
-                    }
-                    $setting->setValues($data);
-                    $setting->save();
-                    $data = $this->getWebsiteSettingForEditMode($setting);
-                    return $this->adminJson(['data' => $data, 'success' => true]);
-                }
-            } elseif ($request->get('xaction') == 'create') {
-                unset($data['id']);
-                $setting = new WebsiteSetting();
-                $setting->setValues($data);
-                $setting->save();
-                return $this->adminJson(['data' => $setting->getObjectVars(), 'success' => true]);
-            }
-        } else {
-            $list = new WebsiteSetting\Listing();
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-            if ($sortingSettings['orderKey']) {
-                $list->setOrderKey($sortingSettings['orderKey']);
-                $list->setOrder($sortingSettings['order']);
-            } else {
-                $list->setOrderKey('name');
-                $list->setOrder('asc');
-            }
-            if ($request->get('filter')) {
-                $list->setCondition('`name` LIKE ' . $list->quote('%'.$request->get('filter').'%'));
-            }
-            $totalCount = $list->getTotalCount();
-            $list = $list->load();
-            $settings = [];
-            foreach ($list as $item) {
-                $resultItem = $this->getWebsiteSettingForEditMode($item);
-                $settings[] = $resultItem;
-            }
-            return $this->adminJson(['data' => $settings, 'success' => true, 'total' => $totalCount]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param WebsiteSetting $item
-     *
-     * @return array
-     */
-    private function getWebsiteSettingForEditMode($item)
-    {
-        $resultItem = [
-            'id' => $item->getId(),
-            'name' => $item->getName(),
-            'language' => $item->getLanguage(),
-            'type' => $item->getType(),
-            'data' => null,
-            'siteId' => $item->getSiteId(),
-            'creationDate' => $item->getCreationDate(),
-            'modificationDate' => $item->getModificationDate(),
-        ];
-        switch ($item->getType()) {
-            case 'document':
-            case 'asset':
-            case 'object':
-                $element = $item->getData();
-                if ($element) {
-                    $resultItem['data'] = $element->getRealFullPath();
-                }
-                break;
-            default:
-                $resultItem['data'] = $item->getData();
-                break;
-        }
-        return $resultItem;
-    }
-    /**
-     * @Route("/get-available-algorithms", name="pimcore_admin_settings_getavailablealgorithms", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAvailableAlgorithmsAction(Request $request)
-    {
-        $options = [
-            [
-                'key' => 'password_hash',
-                'value' => 'password_hash',
-            ],
-        ];
-        $algorithms = hash_algos();
-        foreach ($algorithms as $algorithm) {
-            $options[] = [
-                'key' => $algorithm,
-                'value' => $algorithm,
-            ];
-        }
-        $result = ['data' => $options, 'success' => true, 'total' => count($options)];
-        return $this->adminJson($result);
-    }
-    /**
-     * deleteViews
-     * delete views for localized fields when languages are removed to
-     * prevent mysql errors
-     *
-     * @param string $language
-     * @param string $dbName
-     */
-    protected function deleteViews($language, $dbName)
-    {
-        $db = \Pimcore\Db::get();
-        $views = $db->fetchAll('SHOW FULL TABLES IN ' . $db->quoteIdentifier($dbName) . " WHERE TABLE_TYPE LIKE 'VIEW'");
-        foreach ($views as $view) {
-            if (preg_match('/^object_localized_[0-9]+_' . $language . '$/', $view['Tables_in_' . $dbName])) {
-                $sql = 'DROP VIEW ' . $db->quoteIdentifier($view['Tables_in_' . $dbName]);
-                $db->query($sql);
-            }
-        }
-    }
-    /**
-     * @Route("/test-web2print", name="pimcore_admin_settings_testweb2print", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function testWeb2printAction(Request $request)
-    {
-        $this->checkPermission('web2print_settings');
-        $response = $this->render('@PimcoreAdmin/Admin/Settings/testWeb2print.html.twig');
-        $html = $response->getContent();
-        $adapter = \Pimcore\Web2Print\Processor::getInstance();
-        $params = [];
-        if ($adapter instanceof \Pimcore\Web2Print\Processor\WkHtmlToPdf) {
-            $params['adapterConfig'] = '-O landscape';
-        } elseif ($adapter instanceof \Pimcore\Web2Print\Processor\PdfReactor) {
-            $params['adapterConfig'] = [
-                'javaScriptMode' => 0,
-                'addLinks' => true,
-                'appendLog' => true,
-                'enableDebugMode' => true,
-            ];
-        }
-        $responseOptions = [
-            'Content-Type' => 'application/pdf',
-        ];
-        $pdfData = $adapter->getPdfFromString($html, $params);
-        return new \Symfony\Component\HttpFoundation\Response(
-            $pdfData,
-            200,
-            $responseOptions
-        );
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/TagsController.php
+++ b//dev/null
@@ -1,381 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Model\Element\Tag;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/tags")
- *
- * @internal
- */
-class TagsController extends AdminController
-{
-    /**
-     * @Route("/add", name="pimcore_admin_tags_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        try {
-            $tag = new Tag();
-            $tag->setName(strip_tags($request->get('text')));
-            $tag->setParentId((int)$request->get('parentId'));
-            $tag->save();
-            return $this->adminJson(['success' => true, 'id' => $tag->getId()]);
-        } catch (\Exception $e) {
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_tags_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function deleteAction(Request $request)
-    {
-        $tag = Tag::getById($request->get('id'));
-        if ($tag) {
-            $tag->delete();
-            return $this->adminJson(['success' => true]);
-        } else {
-            throw new \Exception('Tag with ID ' . $request->get('id') . ' not found.');
-        }
-    }
-    /**
-     * @Route("/update", name="pimcore_admin_tags_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function updateAction(Request $request)
-    {
-        $tag = Tag::getById($request->get('id'));
-        if ($tag) {
-            $parentId = $request->get('parentId');
-            if ($parentId || $parentId === '0') {
-                $tag->setParentId((int)$parentId);
-            }
-            if ($request->get('text')) {
-                $tag->setName(strip_tags($request->get('text')));
-            }
-            $tag->save();
-            return $this->adminJson(['success' => true]);
-        } else {
-            throw new \Exception('Tag with ID ' . $request->get('id') . ' not found.');
-        }
-    }
-    /**
-     * @Route("/tree-get-children-by-id", name="pimcore_admin_tags_treegetchildrenbyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetChildrenByIdAction(Request $request)
-    {
-        $showSelection = $request->get('showSelection') == 'true';
-        $assignmentCId = (int)$request->get('assignmentCId');
-        $assignmentCType = strip_tags($request->get('assignmentCType'));
-        $recursiveChildren = false;
-        $assignedTagIds = [];
-        if ($assignmentCId && $assignmentCType) {
-            $assignedTags = Tag::getTagsForElement($assignmentCType, $assignmentCId);
-            foreach ($assignedTags as $assignedTag) {
-                $assignedTagIds[$assignedTag->getId()] = $assignedTag;
-            }
-        }
-        $tagList = new Tag\Listing();
-        if ($request->get('node')) {
-            $tagList->setCondition('parentId = ?', (int)$request->get('node'));
-        } else {
-            $tagList->setCondition('ISNULL(parentId) OR parentId = 0');
-        }
-        $tagList->setOrderKey('name');
-        if (!empty($request->get('filter'))) {
-            $filterIds = [0];
-            $filterTagList = new Tag\Listing();
-            $filterTagList->setCondition('LOWER(`name`) LIKE ?', ['%' . $filterTagList->escapeLike(mb_strtolower($request->get('filter'))) . '%']);
-            foreach ($filterTagList->load() as $filterTag) {
-                if ($filterTag->getParentId() === 0) {
-                    $filterIds[] = $filterTag->getId();
-                } else {
-                    $ids = explode('/', $filterTag->getIdPath());
-                    if (isset($ids[1])) {
-                        $filterIds[] = (int)$ids[1];
-                    }
-                }
-            }
-            $filterIds = array_unique(array_values($filterIds));
-            $tagList->setCondition('id IN('.implode(',', $filterIds).')');
-            $recursiveChildren = true;
-        }
-        $tags = [];
-        foreach ($tagList->load() as $tag) {
-            $tags[] = $this->convertTagToArray($tag, $showSelection, $assignedTagIds, true, $recursiveChildren);
-        }
-        return $this->adminJson($tags);
-    }
-    /**
-     * @param Tag $tag
-     * @param bool $showSelection
-     * @param array $assignedTagIds
-     * @param bool $loadChildren
-     * @param bool $recursiveChildren
-     *
-     * @return array
-     */
-    protected function convertTagToArray(Tag $tag, $showSelection, $assignedTagIds, $loadChildren = false, $recursiveChildren = false)
-    {
-        $tagArray = [
-            'id' => $tag->getId(),
-            'text' => $tag->getName(),
-            'path' => $tag->getNamePath(),
-            'expandable' => $tag->hasChildren(),
-            'leaf' => !$tag->hasChildren(),
-            'iconCls' => 'pimcore_icon_element_tags',
-            'qtipCfg' => [
-                'title' => 'ID: ' . $tag->getId(),
-            ],
-        ];
-        if ($showSelection) {
-            $tagArray['checked'] = isset($assignedTagIds[$tag->getId()]);
-        }
-        if ($loadChildren) {
-            $children = $tag->getChildren();
-            $loadChildren = $recursiveChildren ?? false;
-            foreach ($children as $child) {
-                $tagArray['children'][] = $this->convertTagToArray($child, $showSelection, $assignedTagIds, $loadChildren, $recursiveChildren);
-            }
-        }
-        return $tagArray;
-    }
-    /**
-     * @Route("/load-tags-for-element", name="pimcore_admin_tags_loadtagsforelement", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function loadTagsForElementAction(Request $request)
-    {
-        $assginmentCId = (int)$request->get('assignmentCId');
-        $assginmentCType = strip_tags($request->get('assignmentCType'));
-        $assignedTagArray = [];
-        if ($assginmentCId && $assginmentCType) {
-            $assignedTags = Tag::getTagsForElement($assginmentCType, $assginmentCId);
-            foreach ($assignedTags as $assignedTag) {
-                $assignedTagArray[] = $this->convertTagToArray($assignedTag, false, []);
-            }
-        }
-        return $this->adminJson($assignedTagArray);
-    }
-    /**
-     * @Route("/add-tag-to-element", name="pimcore_admin_tags_addtagtoelement", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addTagToElementAction(Request $request)
-    {
-        $assginmentCId = (int)$request->get('assignmentElementId');
-        $assginmentCType = strip_tags($request->get('assignmentElementType'));
-        $tagId = (int)$request->get('tagId');
-        $tag = Tag::getById($tagId);
-        if ($tag) {
-            Tag::addTagToElement($assginmentCType, $assginmentCId, $tag);
-            return $this->adminJson(['success' => true, 'id' => $tag->getId()]);
-        } else {
-            return $this->adminJson(['success' => false]);
-        }
-    }
-    /**
-     * @Route("/remove-tag-from-element", name="pimcore_admin_tags_removetagfromelement", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function removeTagFromElementAction(Request $request)
-    {
-        $assginmentCId = (int)$request->get('assignmentElementId');
-        $assginmentCType = strip_tags($request->get('assignmentElementType'));
-        $tagId = (int)$request->get('tagId');
-        $tag = Tag::getById($tagId);
-        if ($tag) {
-            Tag::removeTagFromElement($assginmentCType, $assginmentCId, $tag);
-            return $this->adminJson(['success' => true, 'id' => $tag->getId()]);
-        } else {
-            return $this->adminJson(['success' => false]);
-        }
-    }
-    /**
-     * @Route("/get-batch-assignment-jobs", name="pimcore_admin_tags_getbatchassignmentjobs", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function getBatchAssignmentJobsAction(Request $request, EventDispatcherInterface $eventDispatcher)
-    {
-        $elementId = (int)$request->get('elementId');
-        $elementType = strip_tags($request->get('elementType'));
-        $idList = [];
-        switch ($elementType) {
-            case 'object':
-                $object = \Pimcore\Model\DataObject::getById($elementId);
-                if ($object) {
-                    $idList = $this->getSubObjectIds($object, $eventDispatcher);
-                }
-                break;
-            case 'asset':
-                $asset = \Pimcore\Model\Asset::getById($elementId);
-                if ($asset) {
-                    $idList = $this->getSubAssetIds($asset, $eventDispatcher);
-                }
-                break;
-            case 'document':
-                $document = \Pimcore\Model\Document::getById($elementId);
-                if ($document) {
-                    $idList = $this->getSubDocumentIds($document, $eventDispatcher);
-                }
-                break;
-        }
-        $size = 2;
-        $offset = 0;
-        $idListParts = [];
-        while ($offset < count($idList)) {
-            $idListParts[] = array_slice($idList, $offset, $size);
-            $offset += $size;
-        }
-        return $this->adminJson(['success' => true, 'idLists' => $idListParts, 'totalCount' => count($idList)]);
-    }
-    /**
-     * @param \Pimcore\Model\DataObject\AbstractObject $object
-     *
-     * @return int[]
-     */
-    private function getSubObjectIds(\Pimcore\Model\DataObject\AbstractObject $object, EventDispatcherInterface $eventDispatcher)
-    {
-        $childsList = new \Pimcore\Model\DataObject\Listing();
-        $condition = 'o_path LIKE ?';
-        if (!$this->getAdminUser()->isAdmin()) {
-            $userIds = $this->getAdminUser()->getRoles();
-            $userIds[] = $this->getAdminUser()->getId();
-            $condition .= ' AND (
-                (SELECT `view` FROM users_workspaces_object WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(CONCAT(o_path,o_key),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                    OR
-                (SELECT `view` FROM users_workspaces_object WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(o_path,o_key))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-             )';
-        }
-        $childsList->setCondition($condition, $childsList->escapeLike($object->getRealFullPath()) . '/%');
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $childsList,
-            'context' => [],
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::OBJECT_LIST_BEFORE_LIST_LOAD);
-        /** @var \Pimcore\Model\DataObject\Listing $childsList */
-        $childsList = $beforeListLoadEvent->getArgument('list');
-        return $childsList->loadIdList();
-    }
-    /**
-     * @param \Pimcore\Model\Asset $asset
-     *
-     * @return int[]
-     */
-    private function getSubAssetIds(\Pimcore\Model\Asset $asset, EventDispatcherInterface $eventDispatcher)
-    {
-        $childsList = new \Pimcore\Model\Asset\Listing();
-        $condition = 'path LIKE ?';
-        if (!$this->getAdminUser()->isAdmin()) {
-            $userIds = $this->getAdminUser()->getRoles();
-            $userIds[] = $this->getAdminUser()->getId();
-            $condition .= ' AND (
-                (SELECT `view` FROM users_workspaces_asset WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path,filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                    OR
-                (SELECT `view` FROM users_workspaces_asset WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path,filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-            )';
-        }
-        $childsList->setCondition($condition, $childsList->escapeLike($asset->getRealFullPath()) . '/%');
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $childsList,
-            'context' => [],
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::ASSET_LIST_BEFORE_LIST_LOAD);
-        /** @var \Pimcore\Model\Asset\Listing $childsList */
-        $childsList = $beforeListLoadEvent->getArgument('list');
-        return $childsList->loadIdList();
-    }
-    /**
-     * @param \Pimcore\Model\Document $document
-     *
-     * @return int[]
-     */
-    private function getSubDocumentIds(\Pimcore\Model\Document $document, EventDispatcherInterface $eventDispatcher)
-    {
-        $childsList = new \Pimcore\Model\Document\Listing();
-        $condition = 'path LIKE ?';
-        if (!$this->getAdminUser()->isAdmin()) {
-            $userIds = $this->getAdminUser()->getRoles();
-            $userIds[] = $this->getAdminUser()->getId();
-            $condition .= ' AND (
-                (SELECT `view` FROM users_workspaces_document WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path,`key`),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                    OR
-                (SELECT `view` FROM users_workspaces_document WHERE userId IN (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path,`key`))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-            )';
-        }
-        $childsList->setCondition($condition, $childsList->escapeLike($document->getRealFullPath()) . '/%');
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $childsList,
-            'context' => [],
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::DOCUMENT_LIST_BEFORE_LIST_LOAD);
-        /** @var \Pimcore\Model\Document\Listing $childsList */
-        $childsList = $beforeListLoadEvent->getArgument('list');
-        return $childsList->loadIdList();
-    }
-    /**
-     * @Route("/do-batch-assignment", name="pimcore_admin_tags_dobatchassignment", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function doBatchAssignmentAction(Request $request)
-    {
-        $cType = strip_tags($request->get('elementType'));
-        $assignedTags = json_decode($request->get('assignedTags'));
-        $elementIds = json_decode($request->get('childrenIds'));
-        $doCleanupTags = $request->get('removeAndApply') == 'true';
-        Tag::batchAssignTagsToElement($cType, $elementIds, $assignedTags, $doCleanupTags);
-        return $this->adminJson(['success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/TargetingController.php
+++ b//dev/null
@@ -1,272 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Cache\Core\CoreCacheHandler;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Event\Model\TargetGroupEvent;
-use Pimcore\Event\TargetGroupEvents;
-use Pimcore\Model\Tool\Targeting;
-use Pimcore\Model\Tool\Targeting\TargetGroup;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/targeting")
- *
- * @internal
- */
-class TargetingController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/rule/list", name="pimcore_admin_targeting_rulelist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleListAction(Request $request)
-    {
-        $targets = [];
-        $list = new Targeting\Rule\Listing();
-        $list->setOrderKey('prio');
-        $list->setOrder('ASC');
-        foreach ($list->load() as $target) {
-            $targets[] = [
-                'id' => $target->getId(),
-                'text' => $target->getName(),
-                'active' => $target->getActive(),
-                'qtip' => 'ID: ' . $target->getId(),
-            ];
-        }
-        return $this->adminJson($targets);
-    }
-    /**
-     * @Route("/rule/add", name="pimcore_admin_targeting_ruleadd", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleAddAction(Request $request)
-    {
-        $target = new Targeting\Rule();
-        $target->setName($request->get('name'));
-        $target->save();
-        return $this->adminJson(['success' => true, 'id' => $target->getId()]);
-    }
-    /**
-     * @Route("/rule/delete", name="pimcore_admin_targeting_ruledelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleDeleteAction(Request $request)
-    {
-        $success = false;
-        $target = Targeting\Rule::getById($request->get('id'));
-        if ($target) {
-            $target->delete();
-            $success = true;
-        }
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/rule/get", name="pimcore_admin_targeting_ruleget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleGetAction(Request $request)
-    {
-        $target = Targeting\Rule::getById($request->get('id'));
-        $target = $target->getObjectVars();
-        return $this->adminJson($target);
-    }
-    /**
-     * @Route("/rule/save", name="pimcore_admin_targeting_rulesave", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleSaveAction(Request $request)
-    {
-        $data = $this->decodeJson($request->get('data'));
-        /** @var Targeting\Rule|Targeting\Rule\Dao $target */
-        $target = Targeting\Rule::getById($request->get('id'));
-        $target->setValues($data['settings']);
-        $target->setConditions($data['conditions']);
-        $target->setActions($data['actions']);
-        $target->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/rule/order", name="pimcore_admin_targeting_ruleorder", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function ruleOrderAction(Request $request)
-    {
-        $return = [
-            'success' => false,
-            'message' => '',
-        ];
-        $rules = $this->decodeJson($request->get('rules'));
-        /** @var Targeting\Rule[] $changedRules */
-        $changedRules = [];
-        foreach ($rules as $id => $prio) {
-            $rule = Targeting\Rule::getById((int)$id);
-            $prio = (int)$prio;
-            if ($rule) {
-                if ($rule->getPrio() !== $prio) {
-                    $rule->setPrio((int)$prio);
-                    $changedRules[] = $rule;
-                }
-            } else {
-                $return['message'] = sprintf('Rule %d was not found', (int)$id);
-                return $this->adminJson($return, 400);
-            }
-        }
-        foreach ($changedRules as $changedRule) {
-            $changedRule->save();
-        }
-        $return['success'] = true;
-        return $this->adminJson($return);
-    }
-    /**
-     * @Route("/target-group/list", name="pimcore_admin_targeting_targetgrouplist", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function targetGroupListAction(Request $request)
-    {
-        $targetGroups = [];
-        /** @var TargetGroup\Listing|TargetGroup\Listing\Dao $list */
-        $list = new TargetGroup\Listing();
-        if ($request->get('add-default')) {
-            $targetGroups[] = [
-                'id' => 0,
-                'text' => 'default',
-                'active' => true,
-                'qtip' => 0,
-            ];
-        }
-        foreach ($list->load() as $targetGroup) {
-            $targetGroups[] = [
-                'id' => $targetGroup->getId(),
-                'text' => $targetGroup->getName(),
-                'active' => $targetGroup->getActive(),
-                'qtip' => $targetGroup->getId(),
-            ];
-        }
-        return $this->adminJson($targetGroups);
-    }
-    /**
-     * @Route("/target-group/add", name="pimcore_admin_targeting_targetgroupadd", methods={"POST"})
-     *
-     * @param Request $request
-     * @param CoreCacheHandler $cache
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function targetGroupAddAction(Request $request, CoreCacheHandler $cache, EventDispatcherInterface $eventDispatcher)
-    {
-        /** @var TargetGroup|TargetGroup\Dao $targetGroup */
-        $targetGroup = new TargetGroup();
-        $targetGroup->setName($request->get('name'));
-        $targetGroup->save();
-        $event = new TargetGroupEvent($targetGroup);
-        $eventDispatcher->dispatch($event, TargetGroupEvents::POST_ADD);
-        $cache->clearTag('target_groups');
-        return $this->adminJson(['success' => true, 'id' => $targetGroup->getId()]);
-    }
-    /**
-     * @Route("/target-group/delete", name="pimcore_admin_targeting_targetgroupdelete", methods={"DELETE"})
-     *
-     * @param Request $request
-     * @param CoreCacheHandler $cache
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function targetGroupDeleteAction(Request $request, CoreCacheHandler $cache, EventDispatcherInterface $eventDispatcher)
-    {
-        $success = false;
-        $targetGroup = TargetGroup::getById($request->get('id'));
-        if ($targetGroup) {
-            $event = new TargetGroupEvent($targetGroup);
-            $targetGroup->delete();
-            $success = true;
-            $eventDispatcher->dispatch($event, TargetGroupEvents::POST_DELETE);
-        }
-        $cache->clearTag('target_groups');
-        return $this->adminJson(['success' => $success]);
-    }
-    /**
-     * @Route("/target-group/get", name="pimcore_admin_targeting_targetgroupget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function targetGroupGetAction(Request $request)
-    {
-        /** @var TargetGroup|TargetGroup\Dao $targetGroup */
-        $targetGroup = TargetGroup::getById($request->get('id'));
-        $targetGroup = $targetGroup->getObjectVars();
-        return $this->adminJson($targetGroup);
-    }
-    /**
-     * @Route("/target-group/save", name="pimcore_admin_targeting_targetgroupsave", methods={"PUT"})
-     *
-     * @param Request $request
-     * @param CoreCacheHandler $cache
-     * @param EventDispatcherInterface $eventDispatcher
-     *
-     * @return JsonResponse
-     */
-    public function targetGroupSaveAction(Request $request, CoreCacheHandler $cache, EventDispatcherInterface $eventDispatcher)
-    {
-        $data = $this->decodeJson($request->get('data'));
-        /** @var TargetGroup|TargetGroup\Dao $targetGroup */
-        $targetGroup = TargetGroup::getById($request->get('id'));
-        $targetGroup->setValues($data['settings']);
-        $targetGroup->save();
-        $event = new TargetGroupEvent($targetGroup);
-        $eventDispatcher->dispatch($event, TargetGroupEvents::POST_UPDATE);
-        $cache->clearTag('target_groups');
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'targeting', ['targetGroupListAction']);
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/TranslationController.php
+++ b//dev/null
@@ -1,1036 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Doctrine\DBAL\Query\QueryBuilder as DoctrineQueryBuilder;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\File;
-use Pimcore\Localization\LocaleServiceInterface;
-use Pimcore\Logger;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Pimcore\Model\Translation;
-use Pimcore\Tool;
-use Pimcore\Translation\ExportService\Exporter\ExporterInterface;
-use Pimcore\Translation\ExportService\ExportServiceInterface;
-use Pimcore\Translation\ImportDataExtractor\ImportDataExtractorInterface;
-use Pimcore\Translation\ImporterService\ImporterServiceInterface;
-use Pimcore\Translation\TranslationItemCollection\TranslationItemCollection;
-use Pimcore\Translation\Translator;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\HttpKernel\Exception\BadRequestHttpException;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\Translation\TranslatorInterface;
-/**
- * @Route("/translation")
- *
- * @internal
- */
-class TranslationController extends AdminController
-{
-    /**
-     * @Route("/import", name="pimcore_admin_translation_import", methods={"POST"})
-     *
-     * @param Request $request
-     * @param LocaleServiceInterface $localeService
-     *
-     * @return JsonResponse
-     */
-    public function importAction(Request $request, LocaleServiceInterface $localeService)
-    {
-        $admin = $request->get('admin');
-        $dialect = $request->get('csvSettings', null);
-        $tmpFile = $request->get('importFile');
-        if ($dialect) {
-            $dialect = json_decode($dialect);
-        }
-        if (!empty($tmpFile)) {
-            $tmpFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $tmpFile;
-        } else {
-            $tmpFile = $_FILES['Filedata']['tmp_name'];
-        }
-        $this->checkPermission(($admin ? 'admin_' : '') . 'translations');
-        $merge = $request->get('merge');
-        $overwrite = $merge ? false : true;
-        if ($admin) {
-            $delta = Translation::importTranslationsFromFile($tmpFile, Translation::DOMAIN_ADMIN, $overwrite, Tool\Admin::getLanguages(), $dialect);
-        } else {
-            $delta = Translation::importTranslationsFromFile(
-                $tmpFile,
-                Translation::DOMAIN_DEFAULT,
-                $overwrite,
-                $this->getAdminUser()->getAllowedLanguagesForEditingWebsiteTranslations(),
-                $dialect
-            );
-        }
-        if (is_file($tmpFile)) {
-            @unlink($tmpFile);
-        }
-        $result = [
-            'success' => true,
-        ];
-        if ($merge) {
-            $enrichedDelta = [];
-            foreach ($delta as $item) {
-                $lg = $item['lg'];
-                $currentLocale = $localeService->findLocale();
-                $item['lgname'] = \Locale::getDisplayLanguage($lg, $currentLocale);
-                $item['icon'] = $this->generateUrl('pimcore_admin_misc_getlanguageflag', ['language' => $lg]);
-                $item['current'] = $item['text'];
-                $enrichedDelta[] = $item;
-            }
-            $result['delta'] = base64_encode(json_encode($enrichedDelta));
-        }
-        $response = $this->adminJson($result);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/upload-import", name="pimcore_admin_translation_uploadimportfile", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function uploadImportFileAction(Request $request)
-    {
-        $tmpData = file_get_contents($_FILES['Filedata']['tmp_name']);
-        $filename = uniqid('import_translations-');
-        $importFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . $filename;
-        File::put($importFile, $tmpData);
-        $dialect = Tool\Admin::determineCsvDialect($importFile);
-        if (!empty($dialect->lineterminator) && empty(preg_match('/[a-f0-9]{2}/i', $dialect->lineterminator))) {
-            $dialect->lineterminator = bin2hex($dialect->lineterminator);
-        }
-        return $this->adminJson([
-            'success' => true,
-            'config' => [
-                'tmpFile' => $filename,
-                'csvSettings' => $dialect,
-            ],
-        ]);
-    }
-    /**
-     * @Route("/export", name="pimcore_admin_translation_export", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function exportAction(Request $request)
-    {
-        $admin = $request->get('admin');
-        $this->checkPermission(($admin ? 'admin_' : '') . 'translations');
-        $domain = Translation::DOMAIN_DEFAULT;
-        if ($admin) {
-            $domain = Translation::DOMAIN_ADMIN;
-        }
-        $translation = new Translation();
-        $translation->setDomain($domain);
-        $tableName = $translation->getDao()->getDatabaseTableName();
-        Translation::clearDependentCache();
-        $list = new Translation\Listing();
-        $list->setDomain($domain);
-        $joins = [];
-        $list->setOrder('asc');
-        $list->setOrderKey($tableName . '.key', false);
-        $condition = $this->getGridFilterCondition($request, $tableName, false, $admin);
-        if ($condition) {
-            $list->setCondition($condition);
-        }
-        $filters = $this->getGridFilterCondition($request, $tableName, true, $admin);
-        if ($filters) {
-            $joins = array_merge($joins, $filters['joins']);
-        }
-        $this->extendTranslationQuery($joins, $list, $tableName, $filters);
-        $list->load();
-        $translations = [];
-        $translationObjects = $list->getTranslations();
-        if (empty($translationObjects)) {
-            if ($admin) {
-                $t = new Translation();
-                $t->setDomain(Translation::DOMAIN_ADMIN);
-                $languages = Tool\Admin::getLanguages();
-            } else {
-                $t = new Translation();
-                $languages = $this->getAdminUser()->getAllowedLanguagesForViewingWebsiteTranslations();
-            }
-            foreach ($languages as $language) {
-                $t->addTranslation($language, '');
-            }
-            $translationObjects[] = $t;
-        }
-        foreach ($translationObjects as $t) {
-            $translations[] = array_merge(
-                ['key' => $t->getKey(),
-                    'creationDate' => $t->getCreationDate(),
-                    'modificationDate' => $t->getModificationDate(),
-                ],
-                $t->getTranslations()
-            );
-        }
-        $columns = array_keys($translations[0]);
-        if ($admin) {
-            $languages = Tool\Admin::getLanguages();
-        } else {
-            $languages = $this->getAdminUser()->getAllowedLanguagesForViewingWebsiteTranslations();
-        }
-        foreach ($languages as $l) {
-            if (!in_array($l, $columns)) {
-                $columns[] = $l;
-            }
-        }
-        foreach ($columns as $key => $column) {
-            if (strtolower(trim($column)) != 'key' && !in_array($column, $languages)) {
-                unset($columns[$key]);
-            }
-        }
-        $columns = array_values($columns);
-        $headerRow = [];
-        foreach ($columns as $key => $value) {
-            $headerRow[] = '"' . $value . '"';
-        }
-        $csv = implode(';', $headerRow) . "\r\n";
-        foreach ($translations as $t) {
-            $tempRow = [];
-            foreach ($columns as $key) {
-                $value = $t[$key];
-                if (is_string($value)) {
-                    $value = Tool\Text::removeLineBreaks($value);
-                    $value = str_replace('"', '&quot;', $value);
-                    $tempRow[$key] = '"' . $value . '"';
-                } else {
-                    $tempRow[$key] = $value;
-                }
-            }
-            $csv .= implode(';', $tempRow) . "\r\n";
-        }
-        $response = new Response("\xEF\xBB\xBF" . $csv);
-        $response->headers->set('Content-Encoding', 'UTF-8');
-        $response->headers->set('Content-Type', 'text/csv; charset=UTF-8');
-        $response->headers->set('Content-Disposition', 'attachment; filename="export_' . $domain . '_translations.csv"');
-        ini_set('display_errors', false); //to prevent warning messages in csv
-        return $response;
-    }
-    /**
-     * @Route("/add-admin-translation-keys", name="pimcore_admin_translation_addadmintranslationkeys", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAdminTranslationKeysAction(Request $request)
-    {
-        $keys = $request->get('keys');
-        if ($keys) {
-            $availableLanguages = Tool\Admin::getLanguages();
-            $data = $this->decodeJson($keys);
-            foreach ($data as $translationData) {
-                $t = null; // reset
-                try {
-                    $t = Translation::getByKey($translationData, Translation::DOMAIN_ADMIN);
-                } catch (\Exception $e) {
-                    Logger::log($e);
-                }
-                if (!$t instanceof Translation) {
-                    $t = new Translation();
-                    $t->setDomain(Translation::DOMAIN_ADMIN);
-                    $t->setKey($translationData);
-                    $t->setCreationDate(time());
-                    $t->setModificationDate(time());
-                    foreach ($availableLanguages as $lang) {
-                        $t->addTranslation($lang, '');
-                    }
-                    try {
-                        $t->save();
-                    } catch (\Exception $e) {
-                        Logger::log($e);
-                    }
-                }
-            }
-        }
-        return $this->adminJson(null);
-    }
-    /**
-     * @Route("/translations", name="pimcore_admin_translation_translations", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Translator $translator
-     *
-     * @return JsonResponse
-     */
-    public function translationsAction(Request $request, TranslatorInterface $translator)
-    {
-        $admin = $request->get('admin');
-        $this->checkPermission(($admin ? 'admin_' : '') . 'translations');
-        $domain = Translation::DOMAIN_DEFAULT;
-        if ($admin) {
-            $domain = Translation::DOMAIN_ADMIN;
-        }
-        $translation = new Translation();
-        $translation->setDomain($domain);
-        $tableName = $translation->getDao()->getDatabaseTableName();
-        Translation::clearDependentCache();
-        if ($request->get('data')) {
-            $data = $this->decodeJson($request->get('data'));
-            if ($request->get('xaction') == 'destroy') {
-                $t = Translation::getByKey($data['key'], $domain);
-                if ($t instanceof Translation) {
-                    $t->delete();
-                }
-                return $this->adminJson(['success' => true, 'data' => []]);
-            } elseif ($request->get('xaction') == 'update') {
-                $t = Translation::getByKey($data['key'], $domain);
-                foreach ($data as $key => $value) {
-                    $key = preg_replace('/^_/', '', $key, 1);
-                    if (!in_array($key, ['key', 'type'])) {
-                        $t->addTranslation($key, $value);
-                    }
-                }
-                if ($data['key']) {
-                    $t->setKey($data['key']);
-                }
-                if ($data['type']) {
-                    $t->setType($data['type']);
-                }
-                $t->setModificationDate(time());
-                $t->save();
-                $return = array_merge(
-                    [
-                        'key' => $t->getKey(),
-                        'creationDate' => $t->getCreationDate(),
-                        'modificationDate' => $t->getModificationDate(),
-                        'type' => $t->getType(),
-                    ],
-                    $this->prefixTranslations($t->getTranslations())
-                );
-                return $this->adminJson(['data' => $return, 'success' => true]);
-            } elseif ($request->get('xaction') == 'create') {
-                $t = Translation::getByKey($data['key'], $domain);
-                if ($t) {
-                    throw new \Exception($translator->trans('identifier_already_exists', [], $domain));
-                }
-                $t = new Translation();
-                $t->setDomain($domain);
-                $t->setKey($data['key']);
-                $t->setCreationDate(time());
-                $t->setModificationDate(time());
-                $t->setType($data['type'] ?? null);
-                foreach (Tool::getValidLanguages() as $lang) {
-                    $t->addTranslation($lang, '');
-                }
-                $t->save();
-                $return = array_merge(
-                    [
-                        'key' => $t->getKey(),
-                        'creationDate' => $t->getCreationDate(),
-                        'modificationDate' => $t->getModificationDate(),
-                        'type' => $t->getType(),
-                    ],
-                    $this->prefixTranslations($t->getTranslations())
-                );
-                return $this->adminJson(['data' => $return, 'success' => true]);
-            }
-        } else {
-            $list = new Translation\Listing();
-            $list->setDomain($domain);
-            $validLanguages = $admin ? Tool\Admin::getLanguages() : $this->getAdminUser()->getAllowedLanguagesForViewingWebsiteTranslations();
-            $list->setOrder('asc');
-            $list->setOrderKey($tableName . '.key', false);
-            $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(
-                array_merge($request->request->all(), $request->query->all())
-            );
-            $joins = [];
-            if ($orderKey = $sortingSettings['orderKey']) {
-                if (in_array(trim($orderKey, '_'), $validLanguages)) {
-                    $orderKey = trim($orderKey, '_');
-                    $joins[] = [
-                        'language' => $orderKey,
-                    ];
-                    $list->setOrderKey($orderKey);
-                } elseif ($list->isValidOrderKey($sortingSettings['orderKey'])) {
-                    $list->setOrderKey($tableName . '.' . $sortingSettings['orderKey'], false);
-                }
-            }
-            if ($sortingSettings['order']) {
-                $list->setOrder($sortingSettings['order']);
-            }
-            $list->setLimit($request->get('limit'));
-            $list->setOffset($request->get('start'));
-            $condition = $this->getGridFilterCondition($request, $tableName, false, $admin);
-            $filters = $this->getGridFilterCondition($request, $tableName, true, $admin);
-            if ($filters) {
-                $joins = array_merge($joins, $filters['joins']);
-            }
-            if ($condition) {
-                $list->setCondition($condition);
-            }
-            $this->extendTranslationQuery($joins, $list, $tableName, $filters);
-            $list->load();
-            $translations = [];
-            foreach ($list->getTranslations() as $t) {
-                $translations[] = array_merge(
-                    $this->prefixTranslations($t->getTranslations()),
-                    [
-                        'key' => $t->getKey(),
-                        'creationDate' => $t->getCreationDate(),
-                        'modificationDate' => $t->getModificationDate(),
-                        'type' => $t->getType(),
-                    ]
-                );
-            }
-            return $this->adminJson(['data' => $translations, 'success' => true, 'total' => $list->getTotalCount()]);
-        }
-        return $this->adminJson(['success' => false]);
-    }
-    /**
-     * @param array $translations
-     *
-     * @return array
-     */
-    protected function prefixTranslations($translations)
-    {
-        if (!is_array($translations)) {
-            return $translations;
-        }
-        $prefixedTranslations = [];
-        foreach ($translations as $lang => $trans) {
-            $prefixedTranslations['_' . $lang] = $trans;
-        }
-        return $prefixedTranslations;
-    }
-    /**
-     * @param array $joins
-     * @param Translation\Listing $list
-     * @param string $tableName
-     * @param array $filters
-     */
-    protected function extendTranslationQuery($joins, $list, $tableName, $filters)
-    {
-        if ($joins) {
-            $list->onCreateQueryBuilder(
-                function (DoctrineQueryBuilder $select) use (
-                    $joins,
-                    $tableName,
-                    $filters
-                ) {
-                    $db = \Pimcore\Db::get();
-                    $alreadyJoined = [];
-                    foreach ($joins as $join) {
-                        $fieldname = $join['language'];
-                        if (isset($alreadyJoined[$fieldname])) {
-                            continue;
-                        }
-                        $alreadyJoined[$fieldname] = 1;
-                        $select->addSelect($fieldname . '.text AS ' . $fieldname);
-                        $select->leftJoin(
-                            $tableName,
-                            $tableName,
-                            $fieldname,
-                            '('
-                            . $fieldname . '.key = ' . $tableName . '.key'
-                            . ' and ' . $fieldname . '.language = ' . $db->quote($fieldname)
-                            . ')'
-                        );
-                    }
-                    $havings = $filters['conditions'];
-                    if ($havings) {
-                        $havings = implode(' AND ', $havings);
-                        $select->having($havings);
-                    }
-                }
-            );
-        }
-    }
-    /**
-     * @param Request $request
-     * @param string $tableName
-     * @param bool $languageMode
-     *
-     * @return array|null|string
-     */
-    protected function getGridFilterCondition(Request $request, $tableName, $languageMode = false, $admin = false)
-    {
-        $joins = [];
-        $conditions = [];
-        $validLanguages = $admin ? Tool\Admin::getLanguages() : $this->getAdminUser()->getAllowedLanguagesForViewingWebsiteTranslations();
-        $db = \Pimcore\Db::get();
-        $conditionFilters = [];
-        $filterJson = $request->get('filter');
-        if ($filterJson) {
-            $propertyField = 'property';
-            $operatorField = 'operator';
-            $filters = $this->decodeJson($filterJson);
-            foreach ($filters as $filter) {
-                $operator = '=';
-                $field = null;
-                $value = null;
-                $fieldname = $filter[$propertyField];
-                if (in_array(ltrim($fieldname, '_'), $validLanguages)) {
-                    $fieldname = ltrim($fieldname, '_');
-                }
-                if (!$languageMode && in_array($fieldname, $validLanguages)
-                    || $languageMode && !in_array($fieldname, $validLanguages)) {
-                    continue;
-                }
-                if (!$languageMode) {
-                    $fieldname = $tableName . '.' . $fieldname;
-                }
-                if ($filter['type'] == 'string') {
-                    $operator = 'LIKE';
-                    $field = $fieldname;
-                    $value = '%' . $filter['value'] . '%';
-                } elseif ($filter['type'] == 'date' ||
-                    (in_array($fieldname, ['modificationDate', 'creationDate']))) {
-                    if ($filter[$operatorField] == 'lt') {
-                        $operator = '<';
-                    } elseif ($filter[$operatorField] == 'gt') {
-                        $operator = '>';
-                    } elseif ($filter[$operatorField] == 'eq') {
-                        $operator = '=';
-                        $fieldname = "UNIX_TIMESTAMP(DATE(FROM_UNIXTIME({$fieldname})))";
-                    }
-                    $filter['value'] = strtotime($filter['value']);
-                    $field = $fieldname;
-                    $value = $filter['value'];
-                }
-                if ($field && $value) {
-                    $condition = $field . ' ' . $operator . ' ' . $db->quote($value);
-                    if ($languageMode) {
-                        $conditions[$fieldname] = $condition;
-                        $joins[] = [
-                            'language' => $fieldname,
-                        ];
-                    } else {
-                        $conditionFilters[] = $condition;
-                    }
-                }
-            }
-        }
-        if ($request->get('searchString')) {
-            $filterTerm = $db->quote('%' . mb_strtolower($request->get('searchString')) . '%');
-            $conditionFilters[] = '(lower(' . $tableName . '.key) LIKE ' . $filterTerm . ' OR lower(' . $tableName . '.text) LIKE ' . $filterTerm . ')';
-        }
-        if ($languageMode) {
-            $result = [
-                'joins' => $joins,
-                'conditions' => $conditions,
-            ];
-            return $result;
-        } else {
-            if (!empty($conditionFilters)) {
-                return implode(' AND ', $conditionFilters);
-            }
-            return null;
-        }
-    }
-    /**
-     * @Route("/cleanup", name="pimcore_admin_translation_cleanup", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function cleanupAction(Request $request)
-    {
-        $admin = $request->get('admin');
-        $domain = Translation::DOMAIN_DEFAULT;
-        if ($admin) {
-            $domain = Translation::DOMAIN_ADMIN;
-        }
-        $list = new Translation\Listing();
-        $list->setDomain($domain);
-        $list->cleanup();
-        \Pimcore\Cache::clearTags(['translator', 'translate']);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * -----------------------------------------------------------------------------------
-     * THE FOLLOWING ISN'T RELATED TO THE SHARED TRANSLATIONS OR ADMIN-TRANSLATIONS
-     * XLIFF CONTENT-EXPORT & MS WORD CONTENT-EXPORT
-     * -----------------------------------------------------------------------------------
-     */
-    /**
-     * @Route("/content-export-jobs", name="pimcore_admin_translation_contentexportjobs", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function contentExportJobsAction(Request $request)
-    {
-        $data = $this->decodeJson($request->get('data'));
-        $elements = [];
-        $jobs = [];
-        $exportId = uniqid();
-        $source = $request->get('source');
-        $target = $request->get('target');
-        $type = $request->get('type');
-        $source = str_replace('_', '-', $source);
-        $target = str_replace('_', '-', $target);
-        if ($data && is_array($data)) {
-            foreach ($data as $element) {
-                $elements[$element['type'] . '_' . $element['id']] = [
-                    'id' => $element['id'],
-                    'type' => $element['type'],
-                ];
-                $el = null;
-                if ($element['children']) {
-                    $el = Element\Service::getElementById($element['type'], $element['id']);
-                    $baseClass = ELement\Service::getBaseClassNameForElement($element['type']);
-                    $listClass = '\\Pimcore\\Model\\' . $baseClass . '\\Listing';
-                    $list = new $listClass();
-                    $list->setUnpublished(true);
-                    if ($el instanceof DataObject\AbstractObject) {
-                        $list->setObjectTypes(
-                            [DataObject::OBJECT_TYPE_VARIANT,
-                                DataObject::OBJECT_TYPE_OBJECT,
-                                DataObject::OBJECT_TYPE_FOLDER, ]
-                        );
-                    }
-                    $list->setCondition(
-                        ($el instanceof DataObject ? 'o_' : '') . 'path LIKE ?',
-                        [$list->escapeLike($el->getRealFullPath() . ($el->getRealFullPath() != '/' ? '/' : '')) . '%']
-                    );
-                    $childs = $list->load();
-                    foreach ($childs as $child) {
-                        $childId = $child->getId();
-                        $elements[$element['type'] . '_' . $childId] = [
-                            'id' => $childId,
-                            'type' => $element['type'],
-                        ];
-                        if (isset($element['relations']) && $element['relations']) {
-                            $childDependencies = $child->getDependencies()->getRequires();
-                            foreach ($childDependencies as $cd) {
-                                if ($cd['type'] == 'object' || $cd['type'] == 'document') {
-                                    $elements[$cd['type'] . '_' . $cd['id']] = $cd;
-                                }
-                            }
-                        }
-                    }
-                }
-                if (isset($element['relations']) && $element['relations']) {
-                    if (!$el instanceof Element\ElementInterface) {
-                        $el = Element\Service::getElementById($element['type'], $element['id']);
-                    }
-                    $dependencies = $el->getDependencies()->getRequires();
-                    foreach ($dependencies as $dependency) {
-                        if ($dependency['type'] == 'object' || $dependency['type'] == 'document') {
-                            $elements[$dependency['type'] . '_' . $dependency['id']] = $dependency;
-                        }
-                    }
-                }
-            }
-        }
-        $elements = array_values($elements);
-        $elementsPerJob = 10;
-        if ($type == 'word') {
-            $elementsPerJob = 1;
-        }
-        $elements = array_chunk($elements, $elementsPerJob);
-        foreach ($elements as $chunk) {
-            $jobs[] = [[
-                'url' => $request->getBaseUrl() . '/admin/translation/' . $type . '-export',
-                'method' => 'POST',
-                'params' => [
-                    'id' => $exportId,
-                    'source' => $source,
-                    'target' => $target,
-                    'data' => $this->encodeJson($chunk),
-                ],
-            ]];
-        }
-        return $this->adminJson(
-            [
-                'success' => true,
-                'jobs' => $jobs,
-                'id' => $exportId,
-            ]
-        );
-    }
-    /**
-     * @Route("/xliff-export", name="pimcore_admin_translation_xliffexport", methods={"POST"})
-     *
-     * @param Request $request
-     * @param ExportServiceInterface $exportService
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function xliffExportAction(Request $request, ExportServiceInterface $exportService)
-    {
-        $id = $request->get('id');
-        $data = $this->decodeJson($request->get('data'));
-        $source = $request->get('source');
-        $target = $request->get('target');
-        $translationItems = new TranslationItemCollection();
-        foreach ($data as $el) {
-            $element = Element\Service::getElementById($el['type'], $el['id']);
-            $translationItems->addPimcoreElement($element);
-        }
-        $exportService->exportTranslationItems($translationItems, $source, [$target], $id);
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/xliff-export-download", name="pimcore_admin_translation_xliffexportdownload", methods={"GET"})
-     *
-     * @param Request $request
-     * @param ExporterInterface $translationExporter
-     *
-     * @return BinaryFileResponse
-     */
-    public function xliffExportDownloadAction(Request $request, ExporterInterface $translationExporter, ExportServiceInterface $exportService)
-    {
-        $id = $request->get('id');
-        $exportFile = $exportService->getTranslationExporter()->getExportFilePath($id);
-        $response = new BinaryFileResponse($exportFile);
-        $response->headers->set('Content-Type', $translationExporter->getContentType());
-        $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, basename($exportFile));
-        $response->deleteFileAfterSend(true);
-        return $response;
-    }
-    /**
-     * @Route("/xliff-import-upload", name="pimcore_admin_translation_xliffimportupload", methods={"POST"})
-     *
-     * @param Request $request
-     * @param ImportDataExtractorInterface $importDataExtractor
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function xliffImportUploadAction(Request $request, ImportDataExtractorInterface $importDataExtractor)
-    {
-        $jobs = [];
-        $id = uniqid();
-        $importFile = $importDataExtractor->getImportFilePath($id);
-        copy($_FILES['file']['tmp_name'], $importFile);
-        $steps = $importDataExtractor->countSteps($id);
-        for ($i = 0; $i < $steps; $i++) {
-            $jobs[] = [[
-                'url' => $this->generateUrl('pimcore_admin_translation_xliffimportelement'),
-                'method' => 'POST',
-                'params' => [
-                    'id' => $id,
-                    'step' => $i,
-                ],
-            ]];
-        }
-        $response = $this->adminJson([
-            'success' => true,
-            'jobs' => $jobs,
-            'id' => $id,
-        ]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/xliff-import-element", name="pimcore_admin_translation_xliffimportelement", methods={"POST"})
-     *
-     * @param Request $request
-     * @param ImportDataExtractorInterface $importDataExtractor
-     * @param ImporterServiceInterface $importerService
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function xliffImportElementAction(Request $request, ImportDataExtractorInterface $importDataExtractor, ImporterServiceInterface $importerService)
-    {
-        $id = $request->get('id');
-        $step = $request->get('step');
-        try {
-            $attributeSet = $importDataExtractor->extractElement($id, $step);
-            if ($attributeSet) {
-                $importerService->import($attributeSet);
-            } else {
-                Logger::warning(sprintf('Could not resolve element %s', $id));
-            }
-        } catch (\Exception $e) {
-            Logger::err($e->getMessage());
-            return $this->adminJson([
-                'success' => false,
-                'message' => $e->getMessage(),
-            ]);
-        }
-        return $this->adminJson([
-            'success' => true,
-        ]);
-    }
-    /**
-     * @Route("/word-export", name="pimcore_admin_translation_wordexport", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function wordExportAction(Request $request)
-    {
-        ini_set('display_errors', 'off');
-        $id = $this->sanitzeExportId((string)$request->get('id'));
-        $exportFile = $this->getExportFilePath($id, false);
-        $data = $this->decodeJson($request->get('data'));
-        $source = $request->get('source');
-        if (!is_file($exportFile)) {
-            File::put($exportFile, '');
-        }
-        foreach ($data as $el) {
-            try {
-                $element = Element\Service::getElementById($el['type'], $el['id']);
-                $output = '';
-                if (!in_array($element->getType(), ['page', 'snippet', 'email', 'object'])) {
-                    continue;
-                }
-                if ($element instanceof Element\ElementInterface) {
-                    $output .= '<h1 class="element-headline">' . ucfirst(
-                            $element->getType()
-                        ) . ' - ' . $element->getRealFullPath() . ' (ID: ' . $element->getId() . ')</h1>';
-                }
-                if ($element instanceof Document\PageSnippet) {
-                    if ($element instanceof Document\Page) {
-                        $structuredDataEmpty = true;
-                        $structuredData = '
-                            <table border="1" cellspacing="0" cellpadding="5">
-                                <tr>
-                                    <td colspan="2"><span style="color:#cc2929;font-weight: bold;">Structured Data</span></td>
-                                </tr>
-                        ';
-                        if ($element->getTitle()) {
-                            $structuredData .= '<tr>
-                                    <td><span style="color:#cc2929;">Title</span></td>
-                                    <td>' . $element->getTitle() . '&nbsp;</td>
-                                </tr>';
-                            $structuredDataEmpty = false;
-                        }
-                        if ($element->getDescription()) {
-                            $structuredData .= '<tr>
-                                    <td><span style="color:#cc2929;">Description</span></td>
-                                    <td>' . $element->getDescription() . '&nbsp;</td>
-                                </tr>';
-                            $structuredDataEmpty = false;
-                        }
-                        if ($element->getProperty('navigation_name')) {
-                            $structuredData .= '<tr>
-                                    <td><span style="color:#cc2929;">Navigation</span></td>
-                                    <td>' . $element->getProperty('navigation_name') . '&nbsp;</td>
-                                </tr>';
-                            $structuredDataEmpty = false;
-                        }
-                        $structuredData .= '</table>';
-                        if (!$structuredDataEmpty) {
-                            $output .= $structuredData;
-                        }
-                    }
-                    $html = Document\Service::render($element, [], false, ['pimcore_admin' => true]);
-                    $html = preg_replace(
-                        '@</?(img|meta|div|section|aside|article|body|bdi|bdo|canvas|embed|footer|head|header|html)([^>]+)?>@',
-                        '',
-                        $html
-                    );
-                    $html = preg_replace('/<!--(.*)-->/Uis', '', $html);
-                    $dom = new Tool\DomCrawler($html);
-                    $elements = $dom->filter('form, script, style, noframes, noscript, object, area, mapm, video, audio, iframe, textarea, input, select, button');
-                    foreach ($elements as $element) {
-                        $element->parentNode->removeChild($element);
-                    }
-                    $clearText = function ($string) {
-                        $string = str_replace("\r\n", '', $string);
-                        $string = str_replace("\n", '', $string);
-                        $string = str_replace("\r", '', $string);
-                        $string = str_replace("\t", '', $string);
-                        $string = preg_replace('/&[a-zA-Z0-9]+;/', '', $string); // remove html entities
-                        $string = preg_replace('#[ ]+#', '', $string);
-                        return $string;
-                    };
-                    $elements = $dom->filter('a');
-                    foreach ($elements as $element) {
-                        $string = $clearText($element->textContent);
-                        if (!empty($string)) {
-                            $newNode = $element->ownerDocument->createTextNode('[' . $element->textContent . ']');
-                            $element->parentNode->replaceChild($newNode, $element);
-                        } else {
-                            $element->ownerDocument->textContent = '';
-                        }
-                    }
-                    if ($dom->count() > 0) {
-                        $html = $dom->html();
-                    }
-                    $dom->clear();
-                    unset($dom);
-                    $doc = new \DOMDocument();
-                    libxml_use_internal_errors(true);
-                    $doc->loadHTML('<?xml encoding="UTF-8"><article>' . $html . '</article>');
-                    libxml_clear_errors();
-                    $html = $doc->saveHTML();
-                    $bodyStart = strpos($html, '<body>') + 6;
-                    $bodyEnd = strpos($html, '</body>');
-                    if ($bodyStart && $bodyEnd) {
-                        $html = substr($html, $bodyStart, $bodyEnd - $bodyStart);
-                    }
-                    $output .= $html;
-                } elseif ($element instanceof DataObject\Concrete) {
-                    $hasContent = false;
-                    /** @var DataObject\ClassDefinition\Data\Localizedfields|null $fd */
-                    $fd = $element->getClass()->getFieldDefinition('localizedfields');
-                    if ($fd) {
-                        $definitions = $fd->getFieldDefinitions();
-                        $locale = str_replace('-', '_', $source);
-                        if (!Tool::isValidLanguage($locale)) {
-                            $locale = \Locale::getPrimaryLanguage($locale);
-                        }
-                        $output .= '
-                            <table border="1" cellspacing="0" cellpadding="2">
-                                <tr>
-                                    <td colspan="2"><span style="color:#cc2929;font-weight: bold;">Localized Data</span></td>
-                                </tr>
-                        ';
-                        foreach ($definitions as $definition) {
-                            if (!in_array($definition->getFieldtype(), ['input', 'textarea', 'wysiwyg'])) {
-                                continue;
-                            }
-                            $content = $element->{'get' . ucfirst($definition->getName())}($locale);
-                            if (!empty($content)) {
-                                $output .= '
-                                <tr>
-                                    <td><span style="color:#cc2929;">' . $definition->getTitle() . ' (' . $definition->getName() . ')<span></td>
-                                    <td>' . $content . '&nbsp;</td>
-                                </tr>
-                                ';
-                                $hasContent = true;
-                            }
-                        }
-                        $output .= '</table>';
-                    }
-                    if (!$hasContent) {
-                        $output = ''; // there's no content in the object, so reset all contents and do not inclide it in the export
-                    }
-                }
-                if (!empty($output)) {
-                    $f = fopen($exportFile, 'a+');
-                    fwrite($f, $output);
-                    fclose($f);
-                }
-            } catch (\Exception $e) {
-                Logger::error('Word Export: ' . $e->getMessage());
-                Logger::error($e);
-                throw $e;
-            }
-        }
-        return $this->adminJson(
-            [
-                'success' => true,
-            ]
-        );
-    }
-    /**
-     * @Route("/word-export-download", name="pimcore_admin_translation_wordexportdownload", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function wordExportDownloadAction(Request $request)
-    {
-        $id = $this->sanitzeExportId((string)$request->get('id'));
-        $exportFile = $this->getExportFilePath($id, true);
-        $content = file_get_contents($exportFile);
-        @unlink($exportFile);
-        $content = preg_replace('/<link[^>]+>/im', '$1', $content);
-        $content = preg_replace("/<script[^>]+>(.*)?<\/script>/im", '$1', $content);
-        $content =
-            "<html>\n" .
-            "<head>\n" .
-            '<style type="text/css">' . "\n" .
-            file_get_contents(PIMCORE_WEB_ROOT . '/bundles/pimcoreadmin/css/word-export.css') .
-            "</style>\n" .
-            "</head>\n\n" .
-            "<body>\n" .
-            $content .
-            "\n\n</body>\n" .
-            "</html>\n";
-        $response = new Response($content);
-        $response->headers->set('Content-Type', 'text/html');
-        $response->headers->set(
-            'Content-Disposition',
-            'attachment; filename="word-export-' . date('Ymd') . '_' . uniqid() . '.htm"'
-        );
-        return $response;
-    }
-    private function sanitzeExportId(string $id): string
-    {
-        if (empty($id) || !preg_match('/^[a-z0-9]+$/', $id)) {
-            throw new BadRequestHttpException('Invalid export ID format');
-        }
-        return $id;
-    }
-    private function getExportFilePath(string $id, bool $checkExistence = true): string
-    {
-        $exportFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . DIRECTORY_SEPARATOR . $id . '.html';
-        if ($checkExistence && !file_exists($exportFile)) {
-            throw $this->createNotFoundException(sprintf('Export file does not exist at path %s', $exportFile));
-        }
-        return $exportFile;
-    }
-    /**
-     * @Route("/merge-item", name="pimcore_admin_translation_mergeitem", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function mergeItemAction(Request $request)
-    {
-        $translationType = $request->get('translationType');
-        $dataList = json_decode($request->get('data'), true);
-        $domain = Translation::DOMAIN_DEFAULT;
-        if ($translationType == 'admin') {
-            $domain = Translation::DOMAIN_ADMIN;
-        }
-        foreach ($dataList as $data) {
-            $t = Translation::getByKey($data['key'], $domain, true);
-            $newValue = htmlspecialchars_decode($data['current']);
-            $t->addTranslation($data['lg'], $newValue);
-            $t->setModificationDate(time());
-            $t->save();
-        }
-        return $this->adminJson(
-            [
-                'success' => true,
-            ]
-        );
-    }
-    /**
-     * @Route("/get-website-translation-languages", name="pimcore_admin_translation_getwebsitetranslationlanguages", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getWebsiteTranslationLanguagesAction(Request $request)
-    {
-        return $this->adminJson(
-            [
-                'view' => $this->getAdminUser()->getAllowedLanguagesForViewingWebsiteTranslations(),
-                'edit' => $this->getAdminUser()->getAllowedLanguagesForEditingWebsiteTranslations(),
-            ]
-        );
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/UserController.php
+++ b//dev/null
@@ -1,1036 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Config;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Logger;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Element;
-use Pimcore\Model\User;
-use Pimcore\Tool;
-use Scheb\TwoFactorBundle\Security\TwoFactor\Provider\Google\GoogleAuthenticatorInterface;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-use Symfony\Component\HttpFoundation\StreamedResponse;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Component\Routing\Generator\UrlGeneratorInterface;
-/**
- * @internal
- */
-class UserController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/user/tree-get-childs-by-id", name="pimcore_admin_user_treegetchildsbyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeGetChildsByIdAction(Request $request)
-    {
-        $list = new User\Listing();
-        $list->setCondition('parentId = ?', (int)$request->get('node'));
-        $list->setOrder('ASC');
-        $list->setOrderKey('name');
-        $list->load();
-        $users = [];
-        if (is_array($list->getUsers())) {
-            foreach ($list->getUsers() as $user) {
-                if ($user->getId() && $user->getName() != 'system') {
-                    $users[] = $this->getTreeNodeConfig($user);
-                }
-            }
-        }
-        return $this->adminJson($users);
-    }
-    /**
-     * @param User|User\Folder $user
-     *
-     * @return array
-     */
-    protected function getTreeNodeConfig($user)
-    {
-        $tmpUser = [
-            'id' => $user->getId(),
-            'text' => $user->getName(),
-            'elementType' => 'user',
-            'type' => $user->getType(),
-            'qtipCfg' => [
-                'title' => 'ID: ' . $user->getId(),
-            ],
-        ];
-        if ($user instanceof User\Folder) {
-            $tmpUser['leaf'] = false;
-            $tmpUser['iconCls'] = 'pimcore_icon_folder';
-            $tmpUser['expanded'] = true;
-            $tmpUser['allowChildren'] = true;
-            if ($user->hasChildren()) {
-                $tmpUser['expanded'] = false;
-            } else {
-                $tmpUser['loaded'] = true;
-            }
-        } else {
-            $tmpUser['leaf'] = true;
-            $tmpUser['iconCls'] = 'pimcore_icon_user';
-            if (!$user->getActive()) {
-                $tmpUser['cls'] = ' pimcore_unpublished';
-            }
-            $tmpUser['allowChildren'] = false;
-            $tmpUser['admin'] = $user->isAdmin();
-        }
-        return $tmpUser;
-    }
-    /**
-     * @Route("/user/add", name="pimcore_admin_user_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        try {
-            $type = $request->get('type');
-            $className = User\Service::getClassNameForType($type);
-            $user = $className::create([
-                'parentId' => (int)$request->get('parentId'),
-                'name' => trim($request->get('name')),
-                'password' => '',
-                'active' => $request->get('active'),
-            ]);
-            if ($request->get('rid')) {
-                $rid = $request->get('rid');
-                $rObject = $className::getById($rid);
-                if ($rObject) {
-                    if ($type == 'user' || $type == 'role') {
-                        $user->setParentId($rObject->getParentId());
-                        if ($rObject->getClasses()) {
-                            $user->setClasses(implode(',', $rObject->getClasses()));
-                        }
-                        if ($rObject->getDocTypes()) {
-                            $user->setDocTypes(implode(',', $rObject->getDocTypes()));
-                        }
-                        $keys = ['asset', 'document', 'object'];
-                        foreach ($keys as $key) {
-                            $getter = 'getWorkspaces' . ucfirst($key);
-                            $setter = 'setWorkspaces' . ucfirst($key);
-                            $workspaces = $rObject->$getter();
-                            $clonedWorkspaces = [];
-                            if (is_array($workspaces)) {
-                                /** @var User\Workspace\AbstractWorkspace $workspace */
-                                foreach ($workspaces as $workspace) {
-                                    $vars = $workspace->getObjectVars();
-                                    if ($key == 'object') {
-                                        $workspaceClass = '\\Pimcore\\Model\\User\\Workspace\\DataObject';
-                                    } else {
-                                        $workspaceClass = '\\Pimcore\\Model\\User\\Workspace\\' . ucfirst($key);
-                                    }
-                                    $newWorkspace = new $workspaceClass();
-                                    foreach ($vars as $varKey => $varValue) {
-                                        $newWorkspace->setObjectVar($varKey, $varValue);
-                                    }
-                                    $newWorkspace->setUserId($user->getId());
-                                    $clonedWorkspaces[] = $newWorkspace;
-                                }
-                            }
-                            $user->$setter($clonedWorkspaces);
-                        }
-                        $user->setPerspectives($rObject->getPerspectives());
-                        $user->setPermissions($rObject->getPermissions());
-                        if ($type == 'user') {
-                            $user->setAdmin(false);
-                            if ($this->getAdminUser()->isAdmin()) {
-                                $user->setAdmin($rObject->getAdmin());
-                            }
-                            $user->setActive($rObject->getActive());
-                            $user->setRoles($rObject->getRoles());
-                            $user->setWelcomeScreen($rObject->getWelcomescreen());
-                            $user->setMemorizeTabs($rObject->getMemorizeTabs());
-                            $user->setCloseWarning($rObject->getCloseWarning());
-                        }
-                        $user->setWebsiteTranslationLanguagesView($rObject->getWebsiteTranslationLanguagesView());
-                        $user->setWebsiteTranslationLanguagesEdit($rObject->getWebsiteTranslationLanguagesEdit());
-                        $user->save();
-                    }
-                }
-            }
-            return $this->adminJson([
-                'success' => true,
-                'id' => $user->getId(),
-            ]);
-        } catch (\Exception $e) {
-            return $this->adminJson(['success' => false, 'message' => $e->getMessage()]);
-        }
-    }
-    /**
-     * @param User $node
-     * @param array $currentList
-     * @param bool $roleMode
-     *
-     * @return array
-     *
-     * @throws \Exception
-     */
-    protected function populateChildNodes($node, &$currentList, $roleMode)
-    {
-        $currentUser = \Pimcore\Tool\Admin::getCurrentUser();
-        $list = $roleMode ? new User\Role\Listing() : new User\Listing();
-        $list->setCondition('parentId = ?', $node->getId());
-        $list->setOrder('ASC');
-        $list->setOrderKey('name');
-        $list->load();
-        $childList = $roleMode ? $list->getRoles() : $list->getUsers();
-        if (is_array($childList)) {
-            foreach ($childList as $user) {
-                if ($user->getId() == $currentUser->getId()) {
-                    throw new \Exception('Cannot delete current user');
-                }
-                if ($user->getId() && $currentUser->getId() && $user->getName() != 'system') {
-                    $currentList[] = $user;
-                    $this->populateChildNodes($user, $currentList, $roleMode);
-                }
-            }
-        }
-        return $currentList;
-    }
-    /**
-     * @Route("/user/delete", name="pimcore_admin_user_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function deleteAction(Request $request)
-    {
-        $user = User\AbstractUser::getById((int)$request->get('id'));
-        if (($user instanceof User\Folder && !$this->getAdminUser()->isAdmin()) || ($user instanceof User && $user->isAdmin() && !$this->getAdminUser()->isAdmin())) {
-            throw new \Exception('You are not allowed to delete this user');
-        } else {
-            if ($user instanceof User\Role\Folder) {
-                $list = [$user];
-                $this->populateChildNodes($user, $list, $user instanceof User\Role\Folder);
-                $listCount = count($list);
-                for ($i = $listCount - 1; $i >= 0; $i--) {
-                    $user = $list[$i];
-                    $user->delete();
-                }
-            } else {
-                if ($user->getId()) {
-                    $user->delete();
-                }
-            }
-        }
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/user/update", name="pimcore_admin_user_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function updateAction(Request $request)
-    {
-        /** @var User|User\Role $user */
-        $user = User\AbstractUser::getById((int)$request->get('id'));
-        if ($user instanceof User && $user->isAdmin() && !$this->getAdminUser()->isAdmin()) {
-            throw new \Exception('Only admin users are allowed to modify admin users');
-        }
-        if ($request->get('data')) {
-            $values = $this->decodeJson($request->get('data'), true);
-            if (!empty($values['password'])) {
-                if (strlen($values['password']) < 10) {
-                    throw new \Exception('Passwords have to be at least 10 characters long');
-                }
-                $values['password'] = Tool\Authentication::getPasswordHash($user->getName(), $values['password']);
-            }
-            foreach ($values as $key => $value) {
-                if (strpos($key, 'permission_') === 0) {
-                    if (method_exists($user, 'setAllAclToFalse')) {
-                        $user->setAllAclToFalse();
-                    }
-                    break;
-                }
-            }
-            if ($user instanceof User && isset($values['2fa_required'])) {
-                $user->setTwoFactorAuthentication('required', (bool) $values['2fa_required']);
-            }
-            $user->setValues($values);
-            if (!$this->getAdminUser()->isAdmin() && $user instanceof User) {
-                if ($user instanceof User) {
-                    $user->setAdmin(false);
-                }
-            }
-            $availableUserPermissionsList = new User\Permission\Definition\Listing();
-            $availableUserPermissions = $availableUserPermissionsList->load();
-            foreach ($availableUserPermissions as $permission) {
-                if (isset($values['permission_' . $permission->getKey()])) {
-                    $user->setPermission($permission->getKey(), (bool) $values['permission_' . $permission->getKey()]);
-                }
-            }
-            if ($request->get('workspaces')) {
-                $processedPaths = ['object' => [], 'asset' => [], 'document' => []]; //array to find if there are multiple entries for a path
-                $workspaces = $this->decodeJson($request->get('workspaces'), true);
-                foreach ($workspaces as $type => $spaces) {
-                    $newWorkspaces = [];
-                    foreach ($spaces as $space) {
-                        if (in_array($space['path'], $processedPaths[$type])) {
-                            throw new \Exception('Error saving workspaces as multiple entries found for path "' . $space['path'] .'" in '.$this->trans((string)$type) . 's');
-                        }
-                        $element = Element\Service::getElementByPath($type, $space['path']);
-                        if ($element) {
-                            $className = '\\Pimcore\\Model\\User\\Workspace\\' . Element\Service::getBaseClassNameForElement($type);
-                            $workspace = new $className();
-                            $workspace->setValues($space);
-                            $workspace->setCid($element->getId());
-                            $workspace->setCpath($element->getRealFullPath());
-                            $workspace->setUserId($user->getId());
-                            $newWorkspaces[] = $workspace;
-                            $processedPaths[$type][] = $space['path'];
-                        }
-                    }
-                    $user->{'setWorkspaces' . ucfirst($type)}($newWorkspaces);
-                }
-            }
-        }
-        if ($request->get('keyBindings')) {
-            $keyBindings = json_decode($request->get('keyBindings'), true);
-            $tmpArray = [];
-            foreach ($keyBindings as $action => $item) {
-                $tmpArray[] = json_decode($item, true);
-            }
-            $tmpArray = array_values(array_filter($tmpArray));
-            $tmpArray = json_encode($tmpArray);
-            $user->setKeyBindings($tmpArray);
-        }
-        $user->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/user/get", name="pimcore_admin_user_get", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Config $config
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getAction(Request $request, Config $config)
-    {
-        if ((int)$request->get('id') < 1) {
-            return $this->adminJson(['success' => false]);
-        }
-        /** @var User $user */
-        $user = User::getById((int)$request->get('id'));
-        if ($user->isAdmin() && !$this->getAdminUser()->isAdmin()) {
-            throw new \Exception('Only admin users are allowed to modify admin users');
-        }
-        $types = ['asset', 'document', 'object'];
-        foreach ($types as $type) {
-            $workspaces = $user->{'getWorkspaces' . ucfirst($type)}();
-            foreach ($workspaces as $wKey => $workspace) {
-                $el = Element\Service::getElementById($type, $workspace->getCid());
-                if ($el) {
-                    $workspace->path = $el->getRealFullPath();
-                    $workspaces[$wKey] = $workspace->getObjectVars();
-                }
-            }
-            $user->{'setWorkspaces' . ucfirst($type)}($workspaces);
-        }
-        $userObjects = DataObject\Service::getObjectsReferencingUser($user->getId());
-        $userObjectData = [];
-        $hasHidden = false;
-        foreach ($userObjects as $o) {
-            if ($o->isAllowed('list')) {
-                $userObjectData[] = [
-                    'path' => $o->getRealFullPath(),
-                    'id' => $o->getId(),
-                    'subtype' => $o->getClass()->getName(),
-                ];
-            } else {
-                $hasHidden = true;
-            }
-        }
-        $availableUserPermissionsList = new User\Permission\Definition\Listing();
-        $availableUserPermissions = $availableUserPermissionsList->load();
-        $availableUserPermissionsData = [];
-        if (is_array($availableUserPermissions)) {
-            foreach ($availableUserPermissions as $availableUserPermission) {
-                $availableUserPermissionsData[] = $availableUserPermission->getObjectVars();
-            }
-        }
-        $list = new User\Role\Listing();
-        $list->setCondition('`type` = ?', ['role']);
-        $list->load();
-        $roles = [];
-        if (is_array($list->getItems())) {
-            foreach ($list->getItems() as $role) {
-                $roles[] = [$role->getId(), $role->getName()];
-            }
-        }
-        $userData = $user->getObjectVars();
-        $userData['roles'] =  array_map('intval', $user->getRoles());
-        $userData['docTypes'] =  array_map('intval', $user->getDocTypes());
-        $contentLanguages = Tool\Admin::reorderWebsiteLanguages($user, Tool::getValidLanguages());
-        $userData['contentLanguages'] = $contentLanguages;
-        $userData['twoFactorAuthentication']['isActive'] = ($user->getTwoFactorAuthentication('enabled') || $user->getTwoFactorAuthentication('secret'));
-        unset($userData['password']);
-        unset($userData['twoFactorAuthentication']['secret']);
-        $userData['hasImage'] = $user->hasImage();
-        $availablePerspectives = \Pimcore\Config::getAvailablePerspectives(null);
-        return $this->adminJson([
-            'success' => true,
-            'user' => $userData,
-            'roles' => $roles,
-            'permissions' => $user->generatePermissionList(),
-            'availablePermissions' => $availableUserPermissionsData,
-            'availablePerspectives' => $availablePerspectives,
-            'validLanguages' => Tool::getValidLanguages(),
-            'objectDependencies' => [
-                'hasHidden' => $hasHidden,
-                'dependencies' => $userObjectData,
-            ],
-        ]);
-    }
-    /**
-     * @Route("/user/get-minimal", name="pimcore_admin_user_getminimal", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getMinimalAction(Request $request)
-    {
-        /** @var User $user */
-        $user = User::getById((int)$request->get('id'));
-        $user->setPassword(null);
-        $minimalUserData['id'] = $user->getId();
-        $minimalUserData['admin'] = $user->isAdmin();
-        $minimalUserData['active'] = $user->isActive();
-        $minimalUserData['permissionInfo']['assets'] = $user->isAllowed('assets');
-        $minimalUserData['permissionInfo']['documents'] = $user->isAllowed('documents');
-        $minimalUserData['permissionInfo']['objects'] = $user->isAllowed('objects');
-        return $this->adminJson($minimalUserData);
-    }
-    /**
-     * @Route("/user/upload-current-user-image", name="pimcore_admin_user_uploadcurrentuserimage", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function uploadCurrentUserImageAction(Request $request)
-    {
-        $user = $this->getAdminUser();
-        if ($user != null) {
-            if ($user->getId() == $request->get('id')) {
-                return $this->uploadImageAction($request);
-            } else {
-                Logger::warn('prevented save current user, because ids do not match. ');
-                return $this->adminJson(false);
-            }
-        } else {
-            return $this->adminJson(false);
-        }
-    }
-    /**
-     * @Route("/user/update-current-user", name="pimcore_admin_user_updatecurrentuser", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updateCurrentUserAction(Request $request)
-    {
-        $user = $this->getAdminUser();
-        if ($user != null) {
-            if ($user->getId() == $request->get('id')) {
-                $values = $this->decodeJson($request->get('data'), true);
-                unset($values['name']);
-                unset($values['id']);
-                unset($values['admin']);
-                unset($values['permissions']);
-                unset($values['roles']);
-                unset($values['active']);
-                if (!empty($values['new_password'])) {
-                    $oldPasswordCheck = false;
-                    if (empty($values['old_password'])) {
-                        $oldPasswordCheck = Tool\Session::useSession(function (AttributeBagInterface $adminSession) {
-                            if ($adminSession->get('password_reset')) {
-                                return true;
-                            }
-                            return false;
-                        });
-                    } else {
-                        $checkUser = Tool\Authentication::authenticatePlaintext($user->getName(), $values['old_password']);
-                        if ($checkUser) {
-                            $oldPasswordCheck = true;
-                        }
-                    }
-                    if (strlen($values['new_password']) < 10) {
-                        throw new \Exception('Passwords have to be at least 10 characters long');
-                    }
-                    if ($oldPasswordCheck && $values['new_password'] == $values['retype_password']) {
-                        $values['password'] = Tool\Authentication::getPasswordHash($user->getName(), $values['new_password']);
-                    } else {
-                        return $this->adminJson(['success' => false, 'message' => 'password_cannot_be_changed']);
-                    }
-                }
-                $user->setValues($values);
-                if ($request->get('keyBindings')) {
-                    $keyBindings = json_decode($request->get('keyBindings'), true);
-                    $tmpArray = [];
-                    foreach ($keyBindings as $action => $item) {
-                        $tmpArray[] = json_decode($item, true);
-                    }
-                    $tmpArray = array_values(array_filter($tmpArray));
-                    $tmpArray = json_encode($tmpArray);
-                    $user->setKeyBindings($tmpArray);
-                }
-                $user->save();
-                return $this->adminJson(['success' => true]);
-            } else {
-                Logger::warn('prevented save current user, because ids do not match. ');
-                return $this->adminJson(false);
-            }
-        } else {
-            return $this->adminJson(false);
-        }
-    }
-    /**
-     * @Route("/user/get-current-user", name="pimcore_admin_user_getcurrentuser", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return Response
-     */
-    public function getCurrentUserAction(Request $request)
-    {
-        $user = $this->getAdminUser();
-        $list = new User\Permission\Definition\Listing();
-        $definitions = $list->load();
-        foreach ($definitions as $definition) {
-            $user->setPermission($definition->getKey(), $user->isAllowed($definition->getKey()));
-        }
-        $userData = $user->getObjectVars();
-        $contentLanguages = Tool\Admin::reorderWebsiteLanguages($user, Tool::getValidLanguages());
-        $userData['contentLanguages'] = $contentLanguages;
-        $userData['keyBindings'] = $user->getKeyBindings();
-        unset($userData['password']);
-        $userData['twoFactorAuthentication'] = $user->getTwoFactorAuthentication();
-        unset($userData['twoFactorAuthentication']['secret']);
-        $userData['twoFactorAuthentication']['isActive'] = $user->getTwoFactorAuthentication('enabled') && $user->getTwoFactorAuthentication('secret');
-        $userData['hasImage'] = $user->hasImage();
-        $userData['isPasswordReset'] = Tool\Session::useSession(function (AttributeBagInterface $adminSession) {
-            return $adminSession->get('password_reset');
-        });
-        $response = new Response('pimcore.currentuser = ' . $this->encodeJson($userData));
-        $response->headers->set('Content-Type', 'text/javascript');
-        return $response;
-    }
-    /**
-     * @Route("/user/role-tree-get-childs-by-id", name="pimcore_admin_user_roletreegetchildsbyid", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function roleTreeGetChildsByIdAction(Request $request)
-    {
-        $list = new User\Role\Listing();
-        $list->setCondition('parentId = ?', (int)$request->get('node'));
-        $list->load();
-        $roles = [];
-        if (is_array($list->getItems())) {
-            foreach ($list->getItems() as $role) {
-                $roles[] = $this->getRoleTreeNodeConfig($role);
-            }
-        }
-        return $this->adminJson($roles);
-    }
-    /**
-     * @param User\Role|User\Role\Folder $role
-     *
-     * @return array
-     */
-    protected function getRoleTreeNodeConfig($role)
-    {
-        $tmpUser = [
-            'id' => $role->getId(),
-            'text' => $role->getName(),
-            'elementType' => 'role',
-            'qtipCfg' => [
-                'title' => 'ID: ' . $role->getId(),
-            ],
-        ];
-        if ($role instanceof User\Role\Folder) {
-            $tmpUser['leaf'] = false;
-            $tmpUser['iconCls'] = 'pimcore_icon_folder';
-            $tmpUser['expanded'] = true;
-            $tmpUser['allowChildren'] = true;
-            if ($role->hasChildren()) {
-                $tmpUser['expanded'] = false;
-            } else {
-                $tmpUser['loaded'] = true;
-            }
-        } else {
-            $tmpUser['leaf'] = true;
-            $tmpUser['iconCls'] = 'pimcore_icon_roles';
-            $tmpUser['allowChildren'] = false;
-        }
-        return $tmpUser;
-    }
-    /**
-     * @Route("/user/role-get", name="pimcore_admin_user_roleget", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function roleGetAction(Request $request)
-    {
-        /** @var User\UserRole $role */
-        $role = User\Role::getById((int)$request->get('id'));
-        $types = ['asset', 'document', 'object'];
-        foreach ($types as $type) {
-            $workspaces = $role->{'getWorkspaces' . ucfirst($type)}();
-            foreach ($workspaces as $wKey => $workspace) {
-                $el = Element\Service::getElementById($type, $workspace->getCid());
-                if ($el) {
-                    $workspace->path = $el->getRealFullPath();
-                    $workspaces[$wKey] = $workspace->getObjectVars();
-                }
-            }
-            $role->{'setWorkspaces' . ucfirst($type)}($workspaces);
-        }
-        $replaceFn = function ($value) {
-            return $value->getObjectVars();
-        };
-        $availableUserPermissionsList = new User\Permission\Definition\Listing();
-        $availableUserPermissions = $availableUserPermissionsList->load();
-        $availableUserPermissions = array_map($replaceFn, $availableUserPermissions);
-        $availablePerspectives = \Pimcore\Config::getAvailablePerspectives(null);
-        return $this->adminJson([
-            'success' => true,
-            'role' => $role->getObjectVars(),
-            'permissions' => $role->generatePermissionList(),
-            'classes' => $role->getClasses(),
-            'docTypes' => $role->getDocTypes(),
-            'availablePermissions' => $availableUserPermissions,
-            'availablePerspectives' => $availablePerspectives,
-            'validLanguages' => Tool::getValidLanguages(),
-        ]);
-    }
-    /**
-     * @Route("/user/upload-image", name="pimcore_admin_user_uploadimage", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @throws \Exception
-     *
-     * @return JsonResponse
-     */
-    public function uploadImageAction(Request $request)
-    {
-        /** @var User $userObj */
-        $userObj = User::getById($this->getUserId($request));
-        if ($userObj->isAdmin() && !$this->getAdminUser()->isAdmin()) {
-            throw new \Exception('Only admin users are allowed to modify admin users');
-        }
-        $userObj->setImage($_FILES['Filedata']['tmp_name']);
-        $response = $this->adminJson(['success' => true]);
-        $response->headers->set('Content-Type', 'text/html');
-        return $response;
-    }
-    /**
-     * @Route("/user/delete-image", name="pimcore_admin_user_deleteimage", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @throws \Exception
-     *
-     * @return JsonResponse
-     */
-    public function deleteImageAction(Request $request)
-    {
-        /** @var User $userObj */
-        $userObj = User::getById($this->getUserId($request));
-        if ($userObj->isAdmin() && !$this->getAdminUser()->isAdmin()) {
-            throw new \Exception('Only admin users are allowed to modify admin users');
-        }
-        $userObj->setImage(null);
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/user/renew-2fa-qr-secret", name="pimcore_admin_user_renew2fasecret", methods={"GET"})
-     *
-     * @param Request $request
-     * @param GoogleAuthenticatorInterface $twoFactor
-     *
-     * @return BinaryFileResponse
-     */
-    public function renew2FaSecretAction(Request $request, GoogleAuthenticatorInterface $twoFactor)
-    {
-        $user = $this->getAdminUser();
-        $proxyUser = $this->getAdminUser(true);
-        $newSecret = $twoFactor->generateSecret();
-        $user->setTwoFactorAuthentication('enabled', true);
-        $user->setTwoFactorAuthentication('type', 'google');
-        $user->setTwoFactorAuthentication('secret', $newSecret);
-        $user->save();
-        Tool\Session::useSession(function (AttributeBagInterface $adminSession) {
-            Tool\Session::regenerateId();
-            $adminSession->set('2fa_required', true);
-        });
-        $url = $twoFactor->getQRContent($proxyUser);
-        $code = new \Endroid\QrCode\QrCode;
-        $code->setWriterByName('png');
-        $code->setText($url);
-        $code->setSize(200);
-        $qrCodeFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/qr-code-' . uniqid() . '.png';
-        $code->writeFile($qrCodeFile);
-        $response = new BinaryFileResponse($qrCodeFile);
-        return $response;
-    }
-    /**
-     * @Route("/user/disable-2fa", name="pimcore_admin_user_disable2fasecret", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function disable2FaSecretAction(Request $request)
-    {
-        $user = $this->getAdminUser();
-        $success = false;
-        if (!$user->getTwoFactorAuthentication('required')) {
-            $user->setTwoFactorAuthentication([]);
-            $user->save();
-            $success = true;
-        }
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/user/reset-2fa-secret", name="pimcore_admin_user_reset2fasecret", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function reset2FaSecretAction(Request $request)
-    {
-        /**
-         * @var User $user
-         */
-        $user = User::getById((int)$request->get('id'));
-        $success = true;
-        $user->setTwoFactorAuthentication('enabled', false);
-        $user->setTwoFactorAuthentication('secret', '');
-        $user->save();
-        return $this->adminJson([
-            'success' => $success,
-        ]);
-    }
-    /**
-     * @Route("/user/get-image", name="pimcore_admin_user_getimage", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return StreamedResponse
-     */
-    public function getImageAction(Request $request)
-    {
-        /** @var User $userObj */
-        $userObj = User::getById($this->getUserId($request));
-        $stream = $userObj->getImage();
-        return new StreamedResponse(function () use ($stream) {
-            fpassthru($stream);
-        }, 200, [
-            'Content-Type' => 'image/png',
-        ]);
-    }
-    /**
-     * @Route("/user/get-token-login-link", name="pimcore_admin_user_gettokenloginlink", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getTokenLoginLinkAction(Request $request)
-    {
-        $user = User::getById($request->get('id'));
-        if (!$user) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $this->trans('login_token_invalid_user_error'),
-            ], Response::HTTP_NOT_FOUND);
-        }
-        if ($user->isAdmin() && !$this->getAdminUser()->isAdmin()) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $this->trans('login_token_as_admin_non_admin_user_error'),
-            ], Response::HTTP_FORBIDDEN);
-        }
-        if (empty($user->getPassword())) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $this->trans('login_token_no_password_error'),
-            ], Response::HTTP_FORBIDDEN);
-        }
-        $token = Tool\Authentication::generateToken($user->getName());
-        $link = $this->generateCustomUrl([
-            'token' => $token,
-        ]);
-        return $this->adminJson([
-            'success' => true,
-            'link' => $link,
-        ]);
-    }
-    /**
-     * @Route("/user/search", name="pimcore_admin_user_search", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function searchAction(Request $request)
-    {
-        $q = '%' . $request->get('query') . '%';
-        $list = new User\Listing();
-        $list->setCondition('name LIKE ? OR firstname LIKE ? OR lastname LIKE ? OR email LIKE ? OR id = ?', [$q, $q, $q, $q, (int)$request->get('query')]);
-        $list->setOrder('ASC');
-        $list->setOrderKey('name');
-        $list->load();
-        $users = [];
-        if (is_array($list->getUsers())) {
-            foreach ($list->getUsers() as $user) {
-                if ($user instanceof User && $user->getId() && $user->getName() != 'system') {
-                    $users[] = [
-                        'id' => $user->getId(),
-                        'name' => $user->getName(),
-                        'email' => $user->getEmail(),
-                        'firstname' => $user->getFirstname(),
-                        'lastname' => $user->getLastname(),
-                    ];
-                }
-            }
-        }
-        return $this->adminJson([
-            'success' => true,
-            'users' => $users,
-        ]);
-    }
-    /**
-     * @param ControllerEvent $event
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $unrestrictedActions = [
-            'getCurrentUserAction', 'updateCurrentUserAction', 'getAvailablePermissionsAction', 'getMinimalAction',
-            'getImageAction', 'uploadCurrentUserImageAction', 'disable2FaSecretAction', 'renew2FaSecretAction',
-            'getUsersForSharingAction', 'getRolesForSharingAction',
-        ];
-        $this->checkActionPermission($event, 'users', $unrestrictedActions);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @Route("/user/get-users-for-sharing", name="pimcore_admin_user_getusersforsharing", methods={"GET"})
-     */
-    public function getUsersForSharingAction(Request $request)
-    {
-        $this->checkPermission('share_configurations');
-        return $this->getUsersAction($request);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @Route("/user/get-roles-for-sharing", name="pimcore_admin_user_getrolesforsharing", methods={"GET"}))
-     */
-    public function getRolesForSharingAction(Request $request)
-    {
-        $this->checkPermission('share_configurations');
-        return $this->getRolesAction($request);
-    }
-    /**
-     * @Route("/user/get-users", name="pimcore_admin_user_getusers", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getUsersAction(Request $request)
-    {
-        $users = [];
-        $list = new \Pimcore\Model\User\Listing();
-        $conditions = [ 'type = "user"' ];
-        if (!$request->get('include_current_user')) {
-            $conditions[] = 'id != ' . $this->getAdminUser()->getId();
-        }
-        $list->setCondition(implode(' AND ', $conditions));
-        $list->load();
-        $userList = $list->getUsers();
-        foreach ($userList as $user) {
-            if (!$request->get('permission') || $user->isAllowed($request->get('permission'))) {
-                $users[] = [
-                    'id' => $user->getId(),
-                    'label' => $user->getUsername(),
-                ];
-            }
-        }
-        return $this->adminJson(['success' => true, 'total' => count($users), 'data' => $users]);
-    }
-    /**
-     * @Route("/user/get-roles", name="pimcore_admin_user_getroles", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getRolesAction(Request $request)
-    {
-        $roles = [];
-        $list = new \Pimcore\Model\User\Role\Listing();
-        $list->setCondition('type = "role"');
-        $list->load();
-        $roleList = $list->getRoles();
-        foreach ($roleList as $role) {
-            if (!$request->get('permission') || in_array($request->get('permission'), $role->getPermissions())) {
-                $roles[] = [
-                    'id' => $role->getId(),
-                    'label' => $role->getName(),
-                ];
-            }
-        }
-        return $this->adminJson(['success' => true, 'total' => count($roles), 'data' => $roles]);
-    }
-    /**
-     * @Route("/user/get-default-key-bindings", name="pimcore_admin_user_getdefaultkeybindings", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDefaultKeyBindingsAction(Request $request)
-    {
-        $data = User::getDefaultKeyBindings();
-        return $this->adminJson(['success' => true, 'data' => $data]);
-    }
-    /**
-     * @Route("/user/invitationlink", name="pimcore_admin_user_invitationlink", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function invitationLinkAction(Request $request)
-    {
-        $success = false;
-        $message = '';
-        if ($username = $request->get('username')) {
-            $user = User::getByName($username);
-            if ($user instanceof User) {
-                if (!$user->isActive()) {
-                    $message .= 'User inactive  <br />';
-                }
-                if (!$user->getEmail()) {
-                    $message .= 'User has no email address <br />';
-                }
-            } else {
-                $message .= 'User unknown <br />';
-            }
-            if (empty($message)) {
-                if (!$user->getPassword()) {
-                    $user->setPassword(bin2hex(random_bytes(16)));
-                    $user->save();
-                }
-                $token = Tool\Authentication::generateToken($user->getName());
-                $loginUrl = $this->generateCustomUrl([
-                    'token' => $token,
-                    'reset' => true,
-                ]);
-                try {
-                    $mail = Tool::getMail([$user->getEmail()], 'Pimcore login invitation for ' . Tool::getHostname());
-                    $mail->setIgnoreDebugMode(true);
-                    $mail->text("Login to pimcore and change your password using the following link. This temporary login link will expire in  24 hours: \r\n\r\n" . $loginUrl);
-                    $mail->send();
-                    $success = true;
-                    $message = sprintf($this->trans('invitation_link_sent'), $user->getEmail());
-                } catch (\Exception $e) {
-                    $message .= 'could not send email';
-                }
-            }
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'message' => $message,
-        ]);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return int
-     */
-    protected function getUserId(Request $request)
-    {
-        if ($request->get('id')) {
-            if ($this->getAdminUser()->getId() != $request->get('id')) {
-                $this->checkPermission('users');
-            }
-            return (int) $request->get('id');
-        }
-        return $this->getAdminUser()->getId();
-    }
-    /**
-     *
-     * @param array $params
-     * @param string $fallbackUrl
-     * @param int $referenceType //UrlGeneratorInterface::ABSOLUTE_URL, ABSOLUTE_PATH, RELATIVE_PATH, NETWORK_PATH
-     *
-     * @return string The generated URL
-     */
-    private function generateCustomUrl(array $params, $fallbackUrl = 'pimcore_admin_login_check', $referenceType = UrlGeneratorInterface::ABSOLUTE_URL): string
-    {
-        try {
-            $loginUrl = $this->generateUrl('my_custom_admin_entry_point', $params, $referenceType);
-        } catch (\Exception $e) {
-            $loginUrl = $this->generateUrl($fallbackUrl, $params, $referenceType);
-        }
-        return $loginUrl;
-    }
-}

--- a/bundles/AdminBundle/Controller/Admin/WorkflowController.php
+++ b//dev/null
@@ -1,391 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Admin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\DataObject\Concrete as ConcreteObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element\ValidationException;
-use Pimcore\Tool\Console;
-use Pimcore\Workflow\ActionsButtonService;
-use Pimcore\Workflow\Manager;
-use Pimcore\Workflow\Notes\CustomHtmlServiceInterface;
-use Pimcore\Workflow\Place\StatusInfo;
-use Pimcore\Workflow\Transition;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Process\Process;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Component\Routing\RouterInterface;
-use Symfony\Component\Workflow\Registry;
-use Symfony\Component\Workflow\Workflow;
-/**
- * @Route("/workflow")
- *
- * @internal
- */
-class WorkflowController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @var Document|Asset|ConcreteObject|null $element
-     */
-    private $element;
-    /**
-     * Returns a JSON of the available workflow actions to the admin panel
-     *
-     * @Route("/get-workflow-form", name="pimcore_admin_workflow_getworkflowform")
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getWorkflowFormAction(Request $request, Manager $workflowManager)
-    {
-        try {
-            $workflow = $workflowManager->getWorkflowIfExists($this->element, (string) $request->get('workflowName'));
-            $workflowConfig = $workflowManager->getWorkflowConfig((string) $request->get('workflowName'));
-            if (empty($workflow) || empty($workflowConfig)) {
-                $wfConfig = [
-                    'message' => 'workflow not found',
-                ];
-            } else {
-                $wfConfig = [
-                    'message' => '',
-                    'notes_enabled' => false,
-                    'notes_required' => false,
-                    'additional_fields' => [],
-                ];
-                $enabledTransitions = $workflow->getEnabledTransitions($this->element);
-                $transition = null;
-                foreach ($enabledTransitions as $_transition) {
-                    if ($_transition->getName() === $request->get('transitionName')) {
-                        $transition = $_transition;
-                    }
-                }
-                if (!$transition instanceof Transition) {
-                    $wfConfig['message'] = sprintf('transition %s currently not allowed', (string) $request->get('transitionName'));
-                } else {
-                    $wfConfig['notes_required'] = $transition->getNotesCommentRequired();
-                    $wfConfig['additional_fields'] = [];
-                }
-            }
-        } catch (\Exception $e) {
-            $wfConfig['message'] = $e->getMessage();
-        }
-        return $this->adminJson($wfConfig);
-    }
-    /**
-     * @Route("/submit-workflow-transition", name="pimcore_admin_workflow_submitworkflowtransition", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function submitWorkflowTransitionAction(Request $request, Registry $workflowRegistry, Manager $workflowManager)
-    {
-        $workflowOptions = $request->get('workflow', []);
-        $workflow = $workflowRegistry->get($this->element, $request->get('workflowName'));
-        if ($workflow->can($this->element, $request->get('transition'))) {
-            try {
-                $workflowManager->applyWithAdditionalData($workflow, $this->element, $request->get('transition'), $workflowOptions, true);
-                $data = [
-                    'success' => true,
-                    'callback' => 'reloadObject',
-                ];
-            } catch (ValidationException $e) {
-                $reason = '';
-                if (count((array)$e->getSubItems()) > 0) {
-                    $reason = '<ul>' . implode('', array_map(function ($item) {
-                        return '<li>' . $item . '</li>';
-                    }, $e->getSubItems())) . '</ul>';
-                }
-                $data = [
-                    'success' => false,
-                    'message' => $e->getMessage(),
-                    'reasons' => [$reason],
-                ];
-            } catch (\Exception $e) {
-                $data = [
-                    'success' => false,
-                    'message' => 'error performing action on this element',
-                    'reasons' => [$e->getMessage()],
-                ];
-            }
-        } else {
-            $blockTransitionList = $workflow->buildTransitionBlockerList($this->element, $request->get('transition'));
-            $reasons = array_map(function ($blockTransitionItem) {
-                return $blockTransitionItem->getMessage();
-            }, $blockTransitionList->getIterator()->getArrayCopy());
-            $data = [
-                'success' => false,
-                'message' => 'transition failed',
-                'reasons' => $reasons,
-            ];
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * @Route("/submit-global-action", name="pimcore_admin_workflow_submitglobal", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function submitGlobalAction(Request $request, Registry $workflowRegistry, Manager $workflowManager)
-    {
-        $workflowOptions = $request->get('workflow', []);
-        $workflow = $workflowRegistry->get($this->element, $request->get('workflowName'));
-        try {
-            $workflowManager->applyGlobalAction($workflow, $this->element, $request->get('transition'), $workflowOptions, true);
-            $data = [
-                'success' => true,
-                'callback' => 'reloadObject',
-            ];
-        } catch (ValidationException $e) {
-            $reason = '';
-            if (count((array)$e->getSubItems()) > 0) {
-                $reason = '<ul>' . implode('', array_map(function ($item) {
-                    return '<li>' . $item . '</li>';
-                }, $e->getSubItems())) . '</ul>';
-            }
-            $data = [
-                'success' => false,
-                'message' => $e->getMessage(),
-                'reasons' => [$reason],
-            ];
-        } catch (\Exception $e) {
-            $data = [
-                'success' => false,
-                'message' => 'error performing action on this element',
-                'reasons' => [$e->getMessage()],
-            ];
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * Returns the JSON needed by the workflow elements detail tab store
-     *
-     * @Route("/get-workflow-details", name="pimcore_admin_workflow_getworkflowdetailsstore")
-     *
-     * @param Request $request
-     * @param Manager $workflowManager
-     * @param StatusInfo $placeStatusInfo
-     * @param RouterInterface $router
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function getWorkflowDetailsStore(Request $request, Manager $workflowManager, StatusInfo $placeStatusInfo, RouterInterface $router, ActionsButtonService $actionsButtonService)
-    {
-        $data = [];
-        foreach ($workflowManager->getAllWorkflowsForSubject($this->element) as $workflow) {
-            $workflowConfig = $workflowManager->getWorkflowConfig($workflow->getName());
-            $svg = null;
-            $msg = '';
-            try {
-                $svg = $this->getWorkflowSvg($workflow);
-            } catch (\InvalidArgumentException $e) {
-                $msg = $e->getMessage();
-            }
-            $url = $router->generate(
-                'pimcore_admin_workflow_show_graph',
-                [
-                    'cid' => $request->get('cid'),
-                    'ctype' => $request->get('ctype'),
-                    'workflow' => $workflow->getName(),
-                ]
-            );
-            $allowedTransitions = $actionsButtonService->getAllowedTransitions($workflow, $this->element);
-            $globalActions = $actionsButtonService->getGlobalActions($workflow, $this->element);
-            $data[] = [
-                'workflowName' => $workflowConfig->getLabel(),
-                'placeInfo' => $placeStatusInfo->getAllPalacesHtml($this->element, $workflow->getName()),
-                'graph' => $msg ?: '<a href="' . $url .'" target="_blank"><div class="workflow-graph-preview">'.$svg.'</div></a>',
-                'allowedTransitions' => $allowedTransitions,
-                'globalActions' => $globalActions,
-            ];
-        }
-        return $this->adminJson([
-            'data' => $data,
-            'success' => true,
-            'total' => count($data),
-        ]);
-    }
-    /**
-     * Returns the JSON needed by the workflow elements detail tab store
-     *
-     * @Route("/show-graph", name="pimcore_admin_workflow_show_graph")
-     *
-     * @param Request $request
-     * @param Manager $workflowManager
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function showGraph(Request $request, Manager $workflowManager)
-    {
-        $workflow = $workflowManager->getWorkflowByName($request->get('workflow'));
-        $response = new Response($this->getWorkflowSvg($workflow));
-        $response->headers->set('Content-Type', 'image/svg+xml');
-        return $response;
-    }
-    /**
-     * Get custom HTML for the workflow transition submit modal, depending whether it is configured or not.
-     *
-     * @Route("/modal-custom-html", name="pimcore_admin_workflow_modal_custom_html", methods={"POST"})
-     *
-     * @param Request $request
-     * @param Registry $workflowRegistry
-     * @param Manager $manager
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function getModalCustomHtml(Request $request, Registry $workflowRegistry, Manager $manager)
-    {
-        $workflow = $workflowRegistry->get($this->element, $request->get('workflowName'));
-        if ($request->get('isGlobalAction') == 'true') {
-            $globalAction = $manager->getGlobalAction($workflow->getName(), $request->get('transition'));
-            if ($globalAction) {
-                return $this->customHtmlResponse($globalAction->getCustomHtmlService());
-            }
-        } elseif ($workflow->can($this->element, $request->get('transition'))) {
-            $enabledTransitions = $workflow->getEnabledTransitions($this->element);
-            $transition = null;
-            foreach ($enabledTransitions as $_transition) {
-                if ($_transition->getName() === $request->get('transition')) {
-                    $transition = $_transition;
-                }
-            }
-            if ($transition instanceof Transition) {
-                return $this->customHtmlResponse($transition->getCustomHtmlService());
-            }
-        }
-        $data = [
-            'success' => false,
-            'message' => 'error validating the action on this element, element cannot peform this action',
-        ];
-        return new JsonResponse($data);
-    }
-    private function customHtmlResponse(CustomHtmlServiceInterface $customHtmlService = null): JsonResponse
-    {
-        $data = [
-            'success' => true,
-            'customHtml' => [],
-        ];
-        if ($customHtmlService) {
-            foreach (['top', 'center', 'bottom'] as $position) {
-                $data['customHtml'][$position] = $customHtmlService->renderHtmlForRequestedPosition($this->element, $position);
-            }
-        }
-        return new JsonResponse($data);
-    }
-    /**
-     * @param Workflow $workflow
-     *
-     * @return string
-     *
-     * @throws \Exception
-     */
-    private function getWorkflowSvg(Workflow $workflow)
-    {
-        $marking = $workflow->getMarking($this->element);
-        $php = Console::getExecutable('php');
-        $dot = Console::getExecutable('dot');
-        if (!$php) {
-            throw new \InvalidArgumentException($this->trans('workflow_cmd_not_found', ['php']));
-        }
-        if (!$dot) {
-            throw new \InvalidArgumentException($this->trans('workflow_cmd_not_found', ['dot']));
-        }
-        $cmd = $php . ' ' . PIMCORE_PROJECT_ROOT . '/bin/console pimcore:workflow:dump ${WNAME} ${WPLACES} | ${DOT} -Tsvg';
-        $params = [
-            'WNAME' => $workflow->getName(),
-            'WPLACES' => implode(' ', array_keys($marking->getPlaces())),
-            'DOT' => $dot,
-        ];
-        Console::addLowProcessPriority($cmd);
-        $process = Process::fromShellCommandline($cmd);
-        $process->run(null, $params);
-        return $process->getOutput();
-    }
-    /**
-     * @param Document|Asset|DataObject $element
-     *
-     * @return Document|Asset|DataObject
-     */
-    protected function getLatestVersion($element)
-    {
-        if (
-            $element instanceof Document\Folder
-            || $element instanceof Asset\Folder
-            || $element instanceof DataObject\Folder
-            || $element instanceof Document\Hardlink
-            || $element instanceof Document\Link
-        ) {
-            return $element;
-        }
-        if ($element instanceof Document\PageSnippet) {
-            $latestVersion = $element->getLatestVersion();
-            if ($latestVersion) {
-                $latestDoc = $latestVersion->loadData();
-                if ($latestDoc instanceof Document\PageSnippet) {
-                    $element = $latestDoc;
-                }
-            }
-        }
-        if ($element instanceof DataObject\Concrete) {
-            $latestVersion = $element->getLatestVersion();
-            if ($latestVersion) {
-                $latestObj = $latestVersion->loadData();
-                if ($latestObj instanceof ConcreteObject) {
-                    $element = $latestObj;
-                }
-            }
-        }
-        return $element;
-    }
-    /**
-     * @param ControllerEvent $event
-     *
-     * @throws \Exception
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $request = $event->getRequest();
-        if ($request->get('ctype') === 'document') {
-            $this->element = Document::getById((int) $request->get('cid', 0));
-        } elseif ($request->get('ctype') === 'asset') {
-            $this->element = Asset::getById((int) $request->get('cid', 0));
-        } elseif ($request->get('ctype') === 'object') {
-            $this->element = ConcreteObject::getById((int) $request->get('cid', 0));
-        }
-        if (!$this->element) {
-            throw new \Exception('Cannot load element' . $request->get('cid') . ' of type \'' . $request->get('ctype') . '\'');
-        }
-        $this->element = $this->getLatestVersion($this->element);
-        $this->element->setUserModification($this->getAdminUser()->getId());
-    }
-}

--- a/bundles/AdminBundle/Controller/AdminController.php
+++ b//dev/null
@@ -1,224 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Bundle\AdminBundle\Security\User\TokenStorageUserResolver;
-use Pimcore\Bundle\AdminBundle\Security\User\User as UserProxy;
-use Pimcore\Controller\Controller;
-use Pimcore\Extension\Bundle\PimcoreBundleManager;
-use Pimcore\Logger;
-use Pimcore\Model\User;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException;
-use Symfony\Component\Serializer\Encoder\DecoderInterface;
-use Symfony\Component\Serializer\SerializerInterface;
-use Symfony\Component\Translation\Exception\InvalidArgumentException;
-use Symfony\Contracts\Translation\TranslatorInterface;
-abstract class AdminController extends Controller implements AdminControllerInterface
-{
-    public static function getSubscribedServices()
-    {
-        $services = parent::getSubscribedServices();
-        $services['translator'] = TranslatorInterface::class;
-        $services[TokenStorageUserResolver::class] = TokenStorageUserResolver::class;
-        $services[PimcoreBundleManager::class] = PimcoreBundleManager::class;
-        $services['pimcore_admin.serializer'] = '?Pimcore\\Admin\\Serializer';
-        return $services;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function needsSessionDoubleAuthenticationCheck()
-    {
-        return true;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function needsStorageDoubleAuthenticationCheck()
-    {
-        return true;
-    }
-    /**
-     * Get user from user proxy object which is registered on security component
-     *
-     * @param bool $proxyUser Return the proxy user (UserInterface) instead of the pimcore model
-     *
-     * @return UserProxy|User|null
-     */
-    protected function getAdminUser($proxyUser = false)
-    {
-        $resolver = $this->get(TokenStorageUserResolver::class);
-        if ($proxyUser) {
-            return $resolver->getUserProxy();
-        }
-        return $resolver->getUser();
-    }
-    /**
-     * Check user permission
-     *
-     * @param string $permission
-     *
-     * @throws AccessDeniedHttpException
-     */
-    protected function checkPermission($permission)
-    {
-        if (!$this->getAdminUser() || !$this->getAdminUser()->isAllowed($permission)) {
-            Logger::error(
-                'User {user} attempted to access {permission}, but has no permission to do so',
-                [
-                    'user' => $this->getAdminUser()->getName(),
-                    'permission' => $permission,
-                ]
-            );
-            throw $this->createAccessDeniedHttpException();
-        }
-    }
-    /**
-     * @param string $message
-     * @param \Throwable|null $previous
-     * @param int $code
-     * @param array $headers
-     *
-     * @return AccessDeniedHttpException
-     */
-    protected function createAccessDeniedHttpException(string $message = 'Access Denied.', \Throwable $previous = null, int $code = 0, array $headers = []): AccessDeniedHttpException
-    {
-        return new AccessDeniedHttpException($message, $previous, $code, $headers);
-    }
-    /**
-     * @param string[] $permissions
-     */
-    protected function checkPermissionsHasOneOf(array $permissions)
-    {
-        $allowed = false;
-        $permission = null;
-        foreach ($permissions as $permission) {
-            if ($this->getAdminUser()->isAllowed($permission)) {
-                $allowed = true;
-                break;
-            }
-        }
-        if (!$this->getAdminUser() || !$allowed) {
-            Logger::error(
-                'User {user} attempted to access {permission}, but has no permission to do so',
-                [
-                    'user' => $this->getAdminUser()->getName(),
-                    'permission' => $permission,
-                ]
-            );
-            throw new AccessDeniedHttpException('Attempt to access ' . $permission . ', but has no permission to do so.');
-        }
-    }
-    /**
-     * Check permission against all controller actions. Can optionally exclude a list of actions.
-     *
-     * @param ControllerEvent $event
-     * @param string $permission
-     * @param array $unrestrictedActions
-     */
-    protected function checkActionPermission(ControllerEvent $event, string $permission, array $unrestrictedActions = [])
-    {
-        $actionName = null;
-        $controller = $event->getController();
-        if (is_array($controller) && count($controller) === 2 && is_string($controller[1])) {
-            $actionName = $controller[1];
-        }
-        if (null === $actionName || !in_array($actionName, $unrestrictedActions)) {
-            $this->checkPermission($permission);
-        }
-    }
-    /**
-     * Encodes data into JSON string
-     *
-     * @param mixed $data    The data to be encoded
-     * @param array $context Context to pass to serializer when using serializer component
-     * @param int $options   Options passed to json_encode
-     * @param bool $useAdminSerializer
-     *
-     * @TODO check if $useAdminSerializer still required?
-     *
-     * @return string
-     */
-    protected function encodeJson($data, array $context = [], $options = JsonResponse::DEFAULT_ENCODING_OPTIONS, bool $useAdminSerializer = true)
-    {
-        /** @var SerializerInterface $serializer */
-        $serializer = null;
-        if ($useAdminSerializer) {
-            $serializer = $this->container->get('pimcore_admin.serializer');
-        } else {
-            $serializer = $this->container->get('serializer');
-        }
-        return $serializer->serialize($data, 'json', array_merge([
-            'json_encode_options' => $options,
-        ], $context));
-    }
-    /**
-     * Decodes a JSON string into an array/object
-     *
-     * @param mixed $json       The data to be decoded
-     * @param bool $associative Whether to decode into associative array or object
-     * @param array $context    Context to pass to serializer when using serializer component
-     * @param bool $useAdminSerializer
-     *
-     * @return mixed
-     */
-    protected function decodeJson($json, $associative = true, array $context = [], bool $useAdminSerializer = true)
-    {
-        /** @var SerializerInterface|DecoderInterface $serializer */
-        $serializer = null;
-        if ($useAdminSerializer) {
-            $serializer = $this->container->get('pimcore_admin.serializer');
-        } else {
-            $serializer = $this->container->get('serializer');
-        }
-        if ($associative) {
-            $context['json_decode_associative'] = true;
-        }
-        return $serializer->decode($json, 'json', $context);
-    }
-    /**
-     * Returns a JsonResponse that uses the admin serializer
-     *
-     * @param mixed $data    The response data
-     * @param int $status    The status code to use for the Response
-     * @param array $headers Array of extra headers to add
-     * @param array $context Context to pass to serializer when using serializer component
-     * @param bool $useAdminSerializer
-     *
-     * @return JsonResponse
-     */
-    protected function adminJson($data, $status = 200, $headers = [], $context = [], bool $useAdminSerializer = true)
-    {
-        $json = $this->encodeJson($data, $context, JsonResponse::DEFAULT_ENCODING_OPTIONS, $useAdminSerializer);
-        return new JsonResponse($json, $status, $headers, true);
-    }
-    /**
-     * Translates the given message.
-     *
-     * @param string $id The message id (may also be an object that can be cast to string)
-     * @param array $parameters An array of parameters for the message
-     * @param string|null $domain The domain for the message or null to use the default
-     * @param string|null $locale The locale or null to use the default
-     *
-     * @return string The translated string
-     *
-     * @throws InvalidArgumentException If the locale contains invalid characters
-     */
-    public function trans($id, array $parameters = [], $domain = 'admin', $locale = null)
-    {
-        $translator = $this->get('translator');
-        return $translator->trans($id, $parameters, $domain, $locale);
-    }
-}

--- a/bundles/AdminBundle/Controller/AdminControllerInterface.php
+++ b//dev/null
@@ -1,20 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller;
-/**
- * Tagging interface defining controller as admin controller.
- */
-interface AdminControllerInterface extends DoubleAuthenticationControllerInterface
-{
-}

--- a/bundles/AdminBundle/Controller/BruteforceProtectedControllerInterface.php
+++ b//dev/null
@@ -1,24 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller;
-use Pimcore\Bundle\AdminBundle\EventListener\BruteforceProtectionListener;
-/**
- * @internal
- * Tagging interface used to protect certain controllers from brute force attacks
- *
- * @see BruteforceProtectionListener
- */
-interface BruteforceProtectedControllerInterface
-{
-}

--- a/bundles/AdminBundle/Controller/DoubleAuthenticationControllerInterface.php
+++ b//dev/null
@@ -1,34 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller;
-/**
- * Controllers implementing this interface will be double-checked for admin authentication.
- *
- * @see AdminAuthenticationDoubleCheckListener
- */
-interface DoubleAuthenticationControllerInterface
-{
-    /**
-     * Determines if session should be checked for a valid user in authentication double check
-     *
-     * @return bool
-     */
-    public function needsSessionDoubleAuthenticationCheck();
-    /**
-     * Determines if token storage should be checked for a valid user in authentication double check
-     *
-     * @return bool
-     */
-    public function needsStorageDoubleAuthenticationCheck();
-}

--- a/bundles/AdminBundle/Controller/ExtensionManager/ExtensionManagerController.php
+++ b//dev/null
@@ -1,424 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\ExtensionManager;
-use ForceUTF8\Encoding;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Cache\Symfony\CacheClearer;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Extension\Bundle\Exception\BundleNotFoundException;
-use Pimcore\Extension\Bundle\PimcoreBundleInterface;
-use Pimcore\Extension\Bundle\PimcoreBundleManager;
-use Pimcore\Extension\Document\Areabrick\AreabrickInterface;
-use Pimcore\Extension\Document\Areabrick\AreabrickManagerInterface;
-use Pimcore\Logger;
-use Pimcore\Routing\RouteReferenceInterface;
-use Pimcore\Tool\AssetsInstaller;
-use SensioLabs\AnsiConverter\AnsiToHtmlConverter;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Exception\BadRequestHttpException;
-use Symfony\Component\HttpKernel\KernelInterface;
-use Symfony\Component\Process\Exception\ProcessFailedException;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @internal
- */
-class ExtensionManagerController extends AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @var PimcoreBundleManager
-     */
-    private $bundleManager;
-    /**
-     * @var AreabrickManagerInterface
-     */
-    private $areabrickManager;
-    public function __construct(
-        PimcoreBundleManager $bundleManager,
-        AreabrickManagerInterface $areabrickManager
-    ) {
-        $this->bundleManager = $bundleManager;
-        $this->areabrickManager = $areabrickManager;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $this->checkPermission('plugins');
-    }
-    /**
-     * @Route("/admin/extensions", name="pimcore_admin_extensionmanager_extensionmanager_getextensions", methods={"GET"})
-     *
-     * @return JsonResponse
-     */
-    public function getExtensionsAction()
-    {
-        $extensions = array_merge(
-            $this->getBundleList(),
-            $this->getBrickList()
-        );
-        return $this->adminJson(['extensions' => $extensions]);
-    }
-    /**
-     * Updates bundle options (priority, environments)
-     *
-     * @Route("/admin/extensions", name="pimcore_admin_extensionmanager_extensionmanager_updateextensions", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updateExtensionsAction(Request $request)
-    {
-        $data = $this->decodeJson($request->getContent());
-        if (!is_array($data) || !isset($data['extensions']) || !is_array($data['extensions'])) {
-            throw new BadRequestHttpException('Invalid data. Need an array of extensions to update.');
-        }
-        $updates = [];
-        foreach ($data['extensions'] as $row) {
-            if (!$row || !is_array($row) || !isset($row['id'])) {
-                throw new BadRequestHttpException('Invalid data. Missing row ID.');
-            }
-            $id = (string)$row['id'];
-            $options = [];
-            if (isset($row['environments'])) {
-                $environments = explode(',', $row['environments']);
-                $environments = array_map(function ($item) {
-                    return trim((string)$item);
-                }, $environments);
-                $options['environments'] = $environments;
-            }
-            if (isset($row['priority'])) {
-                $options['priority'] = (int)$row['priority'];
-            }
-            $updates[$id] = $options;
-        }
-        $this->bundleManager->setStates($updates);
-        return $this->adminJson([
-            'extensions' => $this->getBundleList(array_keys($updates)),
-        ]);
-    }
-    /**
-     * @Route("/admin/toggle-extension-state", name="pimcore_admin_extensionmanager_extensionmanager_toggleextensionstate", methods={"PUT"})
-     *
-     * @param Request $request
-     * @param KernelInterface $kernel
-     * @param AssetsInstaller $assetsInstaller
-     *
-     * @return JsonResponse
-     */
-    public function toggleExtensionStateAction(
-        Request $request,
-        KernelInterface $kernel,
-        CacheClearer $cacheClearer,
-        AssetsInstaller $assetsInstaller
-    ) {
-        $type = $request->get('type');
-        $id = $request->get('id');
-        $enable = $request->get('method', 'enable') === 'enable' ? true : false;
-        $reload = false;
-        $message = null;
-        $data = [
-            'success' => true,
-            'errors' => [],
-        ];
-        if ($type === 'bundle') {
-            $this->bundleManager->setState($id, ['enabled' => $enable]);
-            $reload = true;
-            $message = $this->installAssets($assetsInstaller, $enable);
-            if (!$kernel->isDebug()) {
-                try {
-                    $cacheClearer->clear($kernel->getEnvironment(), [
-                        'no-warmup' => true,
-                    ]);
-                } catch (\Throwable $e) {
-                    $data['errors'][] = $e->getMessage();
-                }
-            }
-        } elseif ($type === 'areabrick') {
-            $this->areabrickManager->setState($id, $enable);
-            $reload = true;
-        }
-        $data['reload'] = $reload;
-        if ($message) {
-            $data['message'] = $message;
-        }
-        return $this->adminJson($data);
-    }
-    /**
-     * Runs array:install command and returns its result as array (line-by-line)
-     *
-     * @param AssetsInstaller $assetsInstaller
-     * @param bool $enable
-     *
-     * @return array
-     */
-    private function installAssets(AssetsInstaller $assetsInstaller, bool $enable): array
-    {
-        $message = null;
-        try {
-            $installProcess = $assetsInstaller->install();
-            if ($enable) {
-                $message = str_replace("'", '', $installProcess->getCommandLine()) . PHP_EOL . $installProcess->getOutput();
-            }
-        } catch (ProcessFailedException $e) {
-            $message = 'Failed to run assets:install command. Please run command manually.' . PHP_EOL . PHP_EOL . $e->getMessage();
-        }
-        if (!$message) {
-            return [];
-        }
-        $message = Encoding::fixUTF8($message);
-        $message = (new AnsiToHtmlConverter())->convert($message);
-        return explode(PHP_EOL, $message);
-    }
-    /**
-     * @Route("/admin/install", name="pimcore_admin_extensionmanager_extensionmanager_install", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function installAction(Request $request)
-    {
-        return $this->handleInstallation($request, true);
-    }
-    /**
-     * @Route("/admin/uninstall", name="pimcore_admin_extensionmanager_extensionmanager_uninstall", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function uninstallAction(Request $request)
-    {
-        return $this->handleInstallation($request, false);
-    }
-    /**
-     * @param Request $request
-     * @param bool $install
-     *
-     * @return JsonResponse
-     */
-    private function handleInstallation(Request $request, $install = true)
-    {
-        try {
-            $bundle = $this->bundleManager->getActiveBundle($request->get('id'), false);
-            if ($install) {
-                $this->bundleManager->install($bundle);
-            } else {
-                $this->bundleManager->uninstall($bundle);
-            }
-            $data = [
-                'success' => true,
-                'reload' => $this->bundleManager->needsReloadAfterInstall($bundle),
-            ];
-            if (!empty($message = $this->getInstallerOutput($bundle))) {
-                $data['message'] = $message;
-            }
-            return $this->adminJson($data);
-        } catch (BundleNotFoundException $e) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $e->getMessage(),
-            ], 404);
-        } catch (\Exception $e) {
-            return $this->adminJson([
-                'success' => false,
-                'message' => $e->getMessage(),
-            ], 400);
-        }
-    }
-    /**
-     * @param array $filter
-     *
-     * @return array
-     */
-    private function getBundleList(array $filter = [])
-    {
-        $bm = $this->bundleManager;
-        $results = [];
-        foreach ($bm->getEnabledBundleNames() as $className) {
-            try {
-                $bundle = $bm->getActiveBundle($className, false);
-                $results[$bm->getBundleIdentifier($bundle)] = $this->buildBundleInfo($bundle, true, $bm->isInstalled($bundle));
-            } catch (\Throwable $e) {
-                Logger::error($e);
-            }
-        }
-        foreach ($bm->getAvailableBundles() as $className) {
-            if (array_key_exists($className, $results)) {
-                continue;
-            }
-            $bundle = $this->buildBundleInstance($className);
-            if ($bundle) {
-                $results[$bm->getBundleIdentifier($bundle)] = $this->buildBundleInfo($bundle);
-            }
-        }
-        $results = array_values($results);
-        if (count($filter) > 0) {
-            $results = array_filter($results, function (array $item) use ($filter) {
-                return in_array($item['id'], $filter);
-            });
-        }
-        usort($results, function ($a, $b) {
-            if ($a['active'] && !$b['active']) {
-                return -1;
-            }
-            if (!$a['active'] && $b['active']) {
-                return 1;
-            }
-            if ($a['active'] === $b['active']) {
-                if ($a['priority'] === $b['priority']) {
-                    return 0;
-                }
-                return $a['priority'] < $b['priority'] ? 1 : -1;
-            }
-        });
-        return $results;
-    }
-    /**
-     * @param string $bundleName
-     *
-     * @return PimcoreBundleInterface|null
-     */
-    private function buildBundleInstance($bundleName)
-    {
-        try {
-            /** @var PimcoreBundleInterface $bundle */
-            $bundle = new $bundleName();
-            $bundle->setContainer(\Pimcore::getContainer());
-            return $bundle;
-        } catch (\Exception $e) {
-            Logger::error('Failed to build instance of bundle {bundle}: {error}', [
-                'bundle' => $bundleName,
-                'error' => $e->getMessage(),
-            ]);
-        }
-        return null;
-    }
-    /**
-     * @param PimcoreBundleInterface $bundle
-     * @param bool $enabled
-     * @param bool $installed
-     *
-     * @return array
-     */
-    private function buildBundleInfo(PimcoreBundleInterface $bundle, $enabled = false, $installed = false)
-    {
-        $bm = $this->bundleManager;
-        $state = $bm->getState($bundle);
-        $info = [
-            'id' => $bm->getBundleIdentifier($bundle),
-            'type' => 'bundle',
-            'name' => !empty($bundle->getNiceName()) ? $bundle->getNiceName() : $bundle->getName(),
-            'active' => $enabled,
-            'installable' => false,
-            'uninstallable' => false,
-            'installed' => $installed,
-            'canChangeState' => $bm->canChangeState($bundle),
-            'configuration' => $this->getIframePath($bundle),
-            'version' => $bundle->getVersion(),
-            'priority' => $state['priority'],
-            'environments' => implode(', ', $state['environments']),
-        ];
-        if ($enabled) {
-            $info = array_merge($info, [
-                'installable' => $bm->canBeInstalled($bundle),
-                'uninstallable' => $bm->canBeUninstalled($bundle),
-            ]);
-        }
-        $description = $bundle->getDescription();
-        if (!empty($installerOutput = $this->getInstallerOutput($bundle))) {
-            if (!empty($description)) {
-                $description = $description . '. ';
-            }
-            $description .= $installerOutput;
-        }
-        $info['description'] = $description;
-        return $info;
-    }
-    /**
-     * @param PimcoreBundleInterface $bundle
-     *
-     * @return string|null
-     */
-    private function getIframePath(PimcoreBundleInterface $bundle)
-    {
-        if ($iframePath = $bundle->getAdminIframePath()) {
-            if ($iframePath instanceof RouteReferenceInterface) {
-                return $this->generateUrl(
-                    $iframePath->getRoute(),
-                    $iframePath->getParameters(),
-                    $iframePath->getType()
-                );
-            }
-            if (!empty($iframePath)) {
-                return $iframePath;
-            }
-        }
-        return null;
-    }
-    /**
-     * @return array
-     */
-    private function getBrickList()
-    {
-        $results = [];
-        foreach ($this->areabrickManager->getBricks() as $brick) {
-            $results[] = $this->buildBrickInfo($brick);
-        }
-        return $results;
-    }
-    /**
-     * @param AreabrickInterface $brick
-     *
-     * @return array
-     */
-    private function buildBrickInfo(AreabrickInterface $brick)
-    {
-        return [
-            'id' => $brick->getId(),
-            'type' => 'areabrick',
-            'name' => $this->trans($brick->getName()),
-            'description' => $this->trans($brick->getDescription()),
-            'installable' => false,
-            'uninstallable' => false,
-            'installed' => true,
-            'active' => $this->areabrickManager->isEnabled($brick->getId()),
-            'version' => $brick->getVersion(),
-        ];
-    }
-    private function getInstallerOutput(PimcoreBundleInterface $bundle, bool $decorated = false)
-    {
-        if (!$this->bundleManager->isEnabled($bundle)) {
-            return null;
-        }
-        $installer = $this->bundleManager->getInstaller($bundle);
-        if (null !== $installer) {
-            /** @var \Symfony\Component\Console\Output\BufferedOutput $output */
-            $output = $installer->getOutput();
-            if (!empty($output)) {
-                $converter = new AnsiToHtmlConverter(null);
-                $converted = Encoding::fixUTF8($output->fetch());
-                $converted = $converter->convert($converted);
-                if (!$decorated) {
-                    $converted = strip_tags($converted);
-                }
-                return $converted;
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/GDPR/AdminController.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\GDPR;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\Manager;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- *
- * @internal
- */
-class AdminController extends \Pimcore\Bundle\AdminBundle\Controller\AdminController implements KernelControllerEventInterface
-{
-    /**
-     * @Route("/get-data-providers", name="pimcore_admin_gdpr_admin_getdataproviders", methods={"GET"})
-     */
-    public function getDataProvidersAction(Manager $manager)
-    {
-        $response = [];
-        foreach ($manager->getServices() as $service) {
-            $response[] = [
-                'name' => $service->getName(),
-                'jsClass' => $service->getJsClassName(),
-            ];
-        }
-        return $this->adminJson($response);
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        $this->checkActionPermission($event, 'gdpr_data_extractor');
-    }
-}

--- a/bundles/AdminBundle/Controller/GDPR/AssetController.php
+++ b//dev/null
@@ -1,84 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\GDPR;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\Assets;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * Class AssetController
- *
- * @Route("/asset")
- *
- * @package GDPRDataExtractorBundle\Controller
- *
- * @internal
- */
-class AssetController extends \Pimcore\Bundle\AdminBundle\Controller\AdminController implements KernelControllerEventInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'gdpr_data_extractor');
-    }
-    /**
-     * @Route("/search-assets", name="pimcore_admin_gdpr_asset_searchasset", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function searchAssetAction(Request $request, Assets $service)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $result = $service->searchData(
-            (int)$allParams['id'],
-            strip_tags($allParams['firstname']),
-            strip_tags($allParams['lastname']),
-            strip_tags($allParams['email']),
-            (int)$allParams['start'],
-            (int)$allParams['limit'],
-            $allParams['sort'] ?? null
-        );
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/export", name="pimcore_admin_gdpr_asset_exportassets", methods={"GET"})
-     *
-     * @param Request $request
-     * @param Assets $service
-     *
-     * @return Response
-     *
-     * @throws \Exception
-     */
-    public function exportAssetsAction(Request $request, Assets $service)
-    {
-        $asset = \Pimcore\Model\Asset::getById($request->get('id'));
-        if (!$asset->isAllowed('view')) {
-            throw new \Exception('export denied');
-        }
-        $exportResult = $service->doExportData($asset);
-        return $exportResult;
-    }
-}

--- a/bundles/AdminBundle/Controller/GDPR/DataObjectController.php
+++ b//dev/null
@@ -1,85 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\GDPR;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\DataObjects;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Model\DataObject;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * Class DataObjectController
- *
- * @Route("/data-object")
- *
- * @internal
- */
-class DataObjectController extends \Pimcore\Bundle\AdminBundle\Controller\AdminController implements KernelControllerEventInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'gdpr_data_extractor');
-    }
-    /**
-     * @Route("/search-data-objects", name="pimcore_admin_gdpr_dataobject_searchdataobjects", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function searchDataObjectsAction(Request $request, DataObjects $service)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $result = $service->searchData(
-            (int)$allParams['id'],
-            strip_tags($allParams['firstname']),
-            strip_tags($allParams['lastname']),
-            strip_tags($allParams['email']),
-            (int)$allParams['start'],
-            (int)$allParams['limit'],
-            $allParams['sort'] ?? null
-        );
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/export", name="pimcore_admin_gdpr_dataobject_exportdataobject", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @throws \Exception
-     */
-    public function exportDataObjectAction(Request $request, DataObjects $service)
-    {
-        $object = DataObject::getById($request->get('id'));
-        if (!$object->isAllowed('view')) {
-            throw new \Exception('export denied');
-        }
-        $exportResult = $service->doExportData($object);
-        $json = $this->encodeJson($exportResult, [], JsonResponse::DEFAULT_ENCODING_OPTIONS | JSON_PRETTY_PRINT);
-        $jsonResponse = new JsonResponse($json, 200, [
-            'Content-Disposition' => 'attachment; filename="export-data-object-' . $object->getId() . '.json"',
-        ], true);
-        return $jsonResponse;
-    }
-}

--- a/bundles/AdminBundle/Controller/GDPR/PimcoreUsersController.php
+++ b//dev/null
@@ -1,81 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\GDPR;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\PimcoreUsers;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * Class PimcoreUsersController
- *
- * @Route("/pimcore-users")
- *
- * @internal
- */
-class PimcoreUsersController extends \Pimcore\Bundle\AdminBundle\Controller\AdminController implements KernelControllerEventInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'gdpr_data_extractor');
-    }
-    /**
-     * @Route("/search-users", name="pimcore_admin_gdpr_pimcoreusers_searchusers", methods={"GET"})
-     *
-     * @param Request $request
-     * @param PimcoreUsers $pimcoreUsers
-     *
-     * @return JsonResponse
-     */
-    public function searchUsersAction(Request $request, PimcoreUsers $pimcoreUsers)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $result = $pimcoreUsers->searchData(
-            (int)$allParams['id'],
-            strip_tags($allParams['firstname']),
-            strip_tags($allParams['lastname']),
-            strip_tags($allParams['email']),
-            (int)$allParams['start'],
-            (int)$allParams['limit'],
-            $allParams['sort'] ?? null
-        );
-        return $this->adminJson($result);
-    }
-    /**
-     * @Route("/export-user-data", name="pimcore_admin_gdpr_pimcoreusers_exportuserdata", methods={"GET"})
-     *
-     * @param Request $request
-     * @param PimcoreUsers $pimcoreUsers
-     *
-     * @return \Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse
-     */
-    public function exportUserDataAction(Request $request, PimcoreUsers $pimcoreUsers)
-    {
-        $this->checkPermission('users');
-        $userData = $pimcoreUsers->getExportData((int)$request->get('id'));
-        $json = $this->encodeJson($userData, [], JsonResponse::DEFAULT_ENCODING_OPTIONS | JSON_PRETTY_PRINT);
-        $jsonResponse = new JsonResponse($json, 200, [
-            'Content-Disposition' => 'attachment; filename="export-userdata-' . $userData['id'] . '.json"',
-        ], true);
-        return $jsonResponse;
-    }
-}

--- a/bundles/AdminBundle/Controller/GDPR/SentMailController.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\GDPR;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Model\Tool\Email\Log;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * Class SentMailController
- *
- * @Route("/sent-mail")
- *
- * @internal
- */
-class SentMailController extends \Pimcore\Bundle\AdminBundle\Controller\AdminController implements KernelControllerEventInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $this->checkActionPermission($event, 'gdpr_data_extractor');
-    }
-    /**
-     * @Route("/export", name="pimcore_admin_gdpr_sentmail_exportdataobject", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function exportDataObjectAction(Request $request)
-    {
-        $this->checkPermission('emails');
-        $sentMail = Log::getById($request->get('id'));
-        $sentMailArray = (array)$sentMail;
-        $sentMailArray['htmlBody'] = $sentMail->getHtmlLog();
-        $sentMailArray['textBody'] = $sentMail->getTextLog();
-        $json = $this->encodeJson($sentMailArray, [], JsonResponse::DEFAULT_ENCODING_OPTIONS | JSON_PRETTY_PRINT);
-        $jsonResponse = new JsonResponse($json, 200, [
-            'Content-Disposition' => 'attachment; filename="export-mail-' . $sentMail->getId() . '.json"',
-        ], true);
-        return $jsonResponse;
-    }
-}

--- a/bundles/AdminBundle/Controller/Reports/AnalyticsController.php
+++ b//dev/null
@@ -1,438 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Reports;
-use Pimcore\Analytics\Google\Config\SiteConfigProvider;
-use Pimcore\Controller\KernelControllerEventInterface;
-use Pimcore\Google;
-use Pimcore\Model\Document;
-use Pimcore\Model\Site;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/analytics")
- *
- * @internal
- */
-class AnalyticsController extends ReportsControllerBase implements KernelControllerEventInterface
-{
-    /**
-     * @var \Google_Service_Analytics
-     */
-    protected $service;
-    /**
-     * @Route("/deeplink", name="pimcore_admin_reports_analytics_deeplink", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return RedirectResponse
-     */
-    public function deeplinkAction(Request $request, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $siteConfigProvider->getSiteConfig();
-        $url = $request->get('url');
-        $url = str_replace(['{accountId}', '{internalWebPropertyId}', '{id}'], [$config->accountid, $config->internalid, $config->profile], $url);
-        $url = 'https://www.google.com/analytics/web/' . $url;
-        return $this->redirect($url);
-    }
-    /**
-     * @Route("/get-profiles", name="pimcore_admin_reports_analytics_getprofiles", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getProfilesAction(Request $request)
-    {
-        try {
-            $data = ['data' => []];
-            $result = $this->service->management_accounts->listManagementAccounts();
-            $accountIds = [];
-            if (is_array($result['items'])) {
-                foreach ($result['items'] as $account) {
-                    $accountIds[] = $account['id'];
-                }
-            }
-            foreach ($accountIds as $accountId) {
-                $propertyNames = [];
-                $properties = $this->service->management_webproperties->listManagementWebproperties($accountId);
-                if (is_array($properties['items'])) {
-                    foreach ($properties['items'] as $property) {
-                        $propertyNames[$property['id']] = $property['name'];
-                    }
-                }
-                $details = $this->service->management_profiles->listManagementProfiles($accountId, '~all');
-                if (is_array($details['items'])) {
-                    foreach ($details['items'] as $detail) {
-                        $name = $detail['name'];
-                        if (array_key_exists($detail['webPropertyId'], $propertyNames)) {
-                            $name = $propertyNames[$detail['webPropertyId']] . ': ' . $name;
-                        }
-                        $data['data'][] = [
-                            'id' => $detail['id'],
-                            'name' => $name,
-                            'trackid' => $detail['webPropertyId'],
-                            'internalid' => $detail['internalWebPropertyId'],
-                            'accountid' => $detail['accountId'],
-                        ];
-                    }
-                }
-            }
-            return $this->adminJson($data);
-        } catch (\Exception $e) {
-            return $this->adminJson(false);
-        }
-    }
-    /**
-     * @param Request $request
-     *
-     * @return \Pimcore\Model\Site|null
-     */
-    private function getSite(Request $request)
-    {
-        $siteId = $request->get('site');
-        return Site::getById($siteId);
-    }
-    /**
-     * @param Request $request
-     *
-     * @return mixed|string
-     */
-    protected function getFilterPath(Request $request)
-    {
-        if ($request->get('type') == 'document' && $request->get('id')) {
-            $doc = Document::getById($request->get('id'));
-            $path = $doc->getFullPath();
-            if ($doc instanceof Document\Page && $doc->getPrettyUrl()) {
-                $path = $doc->getPrettyUrl();
-            }
-            if ($request->get('site')) {
-                $site = Site::getById($request->get('site'));
-                $path = preg_replace('@^' . preg_quote($site->getRootPath(), '@') . '/@', '/', $path);
-            }
-            return $path;
-        }
-        return $request->get('path');
-    }
-    /**
-     * @Route("/chartmetricdata", name="pimcore_admin_reports_analytics_chartmetricdata", methods={"GET"})
-     *
-     * @param Request $request
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return JsonResponse
-     */
-    public function chartmetricdataAction(Request $request, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $siteConfigProvider->getSiteConfig($this->getSite($request));
-        $startDate = date('Y-m-d', (time() - (86400 * 31)));
-        $endDate = date('Y-m-d');
-        if ($request->get('dateFrom') && $request->get('dateTo')) {
-            $startDate = date('Y-m-d', strtotime($request->get('dateFrom')));
-            $endDate = date('Y-m-d', strtotime($request->get('dateTo')));
-        }
-        $metrics = ['ga:pageviews'];
-        if ($request->get('metric')) {
-            $metrics = [];
-            if (is_array($request->get('metric'))) {
-                foreach ($request->get('metric') as $m) {
-                    $metrics[] = 'ga:' . $m;
-                }
-            } else {
-                $metrics[] = 'ga:' . $request->get('metric');
-            }
-        }
-        $filters = [];
-        if ($filterPath = $this->getFilterPath($request)) {
-            $filters[] = 'ga:pagePath=='.$filterPath;
-        }
-        if ($request->get('filters')) {
-            $filters[] = $request->get('filters');
-        }
-        $opts = [
-            'dimensions' => 'ga:date',
-        ];
-        if (!empty($filters)) {
-            $opts['filters'] = implode(';', $filters);
-        }
-        $result = $this->service->data_ga->get(
-            'ga:' . $config->profile,
-            $startDate,
-            $endDate,
-            implode(',', $metrics),
-            $opts
-        );
-        $data = [];
-        foreach ($result['rows'] as $row) {
-            $date = $row[0];
-            $tmpData = [
-                'timestamp' => strtotime($date),
-                'datetext' => $this->formatDimension('date', $date),
-            ];
-            foreach ($result['columnHeaders'] as $index => $metric) {
-                if (!$request->get('dataField')) {
-                    $tmpData[str_replace('ga:', '', $metric['name'])] = $row[$index];
-                } else {
-                    $tmpData[$request->get('dataField')] = $row[$index];
-                }
-            }
-            $data[] = $tmpData;
-        }
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @Route("/summary", name="pimcore_admin_reports_analytics_summary", methods={"GET"})
-     *
-     * @param Request $request
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return JsonResponse
-     */
-    public function summaryAction(Request $request, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $siteConfigProvider->getSiteConfig($this->getSite($request));
-        $startDate = date('Y-m-d', (time() - (86400 * 31)));
-        $endDate = date('Y-m-d');
-        if ($request->get('dateFrom') && $request->get('dateTo')) {
-            $startDate = date('Y-m-d', strtotime($request->get('dateFrom')));
-            $endDate = date('Y-m-d', strtotime($request->get('dateTo')));
-        }
-        if ($filterPath = $this->getFilterPath($request)) {
-            $filters[] = 'ga:pagePath=='.$filterPath;
-        }
-        $opts = [
-            'dimensions' => 'ga:date',
-        ];
-        if (!empty($filters)) {
-            $opts['filters'] = implode(';', $filters);
-        }
-        $result = $this->service->data_ga->get(
-            'ga:' . $config->profile,
-            $startDate,
-            $endDate,
-            'ga:uniquePageviews,ga:pageviews,ga:exits,ga:bounces,ga:entrances',
-            $opts
-        );
-        $data = [];
-        $dailyDataGrouped = [];
-        foreach ($result['rows'] as $row) {
-            foreach ($result['columnHeaders'] as $index => $metric) {
-                if ($index) {
-                    $dailyDataGrouped[$metric['name']][] = $row[$index];
-                    if (!isset($data[$metric['name']])) {
-                        $data[$metric['name']] = 0;
-                    }
-                    $data[$metric['name']] += $row[$index];
-                }
-            }
-        }
-        $order = [
-            'ga:pageviews' => 0,
-            'ga:uniquePageviews' => 1,
-            'ga:exits' => 2,
-            'ga:entrances' => 3,
-            'ga:bounces' => 4,
-        ];
-        $outputData = [];
-        foreach ($data as $key => $value) {
-            $outputData[$order[$key]] = [
-                'label' => str_replace('ga:', '', $key),
-                'value' => round($value, 2),
-                'chart' => \Pimcore\Helper\ImageChart::lineSmall($dailyDataGrouped[$key]),
-                'metric' => str_replace('ga:', '', $key),
-            ];
-        }
-        ksort($outputData);
-        return $this->adminJson(['data' => $outputData]);
-    }
-    /**
-     * @Route("/source", name="pimcore_admin_reports_analytics_source", methods={"GET"})
-     *
-     * @param Request $request
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return JsonResponse
-     */
-    public function sourceAction(Request $request, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $siteConfigProvider->getSiteConfig($this->getSite($request));
-        $startDate = date('Y-m-d', (time() - (86400 * 31)));
-        $endDate = date('Y-m-d');
-        if ($request->get('dateFrom') && $request->get('dateTo')) {
-            $startDate = date('Y-m-d', strtotime($request->get('dateFrom')));
-            $endDate = date('Y-m-d', strtotime($request->get('dateTo')));
-        }
-        if ($filterPath = $this->getFilterPath($request)) {
-            $filters[] = 'ga:pagePath=='.$filterPath;
-        }
-        $opts = [
-            'dimensions' => 'ga:source',
-            'max-results' => '10',
-            'sort' => '-ga:pageviews',
-        ];
-        if (!empty($filters)) {
-            $opts['filters'] = implode(';', $filters);
-        }
-        $result = $this->service->data_ga->get(
-            'ga:' . $config->profile,
-            $startDate,
-            $endDate,
-            'ga:pageviews',
-            $opts
-        );
-        $data = [];
-        foreach ((array) $result['rows'] as $row) {
-            $data[] = [
-                'pageviews' => $row[1],
-                'source' => $row[0],
-            ];
-        }
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @Route("/data-explorer", name="pimcore_admin_reports_analytics_dataexplorer", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     * @param SiteConfigProvider $siteConfigProvider
-     *
-     * @return JsonResponse
-     */
-    public function dataExplorerAction(Request $request, SiteConfigProvider $siteConfigProvider)
-    {
-        $config = $siteConfigProvider->getSiteConfig($this->getSite($request));
-        $startDate = date('Y-m-d', (time() - (86400 * 31)));
-        $endDate = date('Y-m-d');
-        $metric = 'ga:pageviews';
-        $dimension = 'ga:date';
-        $descending = true;
-        $limit = 10;
-        if ($request->get('dateFrom') && $request->get('dateTo')) {
-            $startDate = date('Y-m-d', strtotime($request->get('dateFrom')));
-            $endDate = date('Y-m-d', strtotime($request->get('dateTo')));
-        }
-        if ($request->get('dimension')) {
-            $dimension = $request->get('dimension');
-        }
-        if ($request->get('metric')) {
-            $metric = $request->get('metric');
-        }
-        if ($request->get('sort')) {
-            if ($request->get('sort') == 'asc') {
-                $descending = false;
-            }
-        }
-        if ($request->get('limit')) {
-            $limit = $request->get('limit');
-        }
-        if ($filterPath = $this->getFilterPath($request)) {
-            $filters[] = 'ga:pagePath=='.$filterPath;
-        }
-        $opts = [
-            'dimensions' => $dimension,
-            'max-results' => $limit,
-            'sort' => ($descending ? '-' : '') . $metric,
-        ];
-        if (!empty($filters)) {
-            $opts['filters'] = implode(';', $filters);
-        }
-        $result = $this->service->data_ga->get(
-            'ga:' . $config->profile,
-            $startDate,
-            $endDate,
-            $metric,
-            $opts
-        );
-        $data = [];
-        foreach ($result['rows'] as $row) {
-            $data[] = [
-                'dimension' => $this->formatDimension($dimension, $row[0]),
-                'metric' => (float) $row[1],
-            ];
-        }
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @Route("/get-dimensions", name="pimcore_admin_reports_analytics_getdimensions", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getDimensionsAction(Request $request)
-    {
-        return $this->adminJson(['data' => Google\Api::getAnalyticsDimensions()]);
-    }
-    /**
-     * @Route("/get-metrics", name="pimcore_admin_reports_analytics_getmetrics", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getMetricsAction(Request $request)
-    {
-        return $this->adminJson(['data' => Google\Api::getAnalyticsMetrics()]);
-    }
-    /**
-     * @Route("/get-segments", name="pimcore_admin_reports_analytics_getsegments", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getSegmentsAction(Request $request)
-    {
-        $result = $this->service->management_segments->listManagementSegments();
-        $data = [];
-        foreach ($result['items'] as $row) {
-            $data[] = [
-                'id' => $row['segmentId'],
-                'name' => $row['name'],
-            ];
-        }
-        return $this->adminJson(['data' => $data]);
-    }
-    /**
-     * @param string $type
-     * @param string $value
-     *
-     * @return string
-     */
-    protected function formatDimension($type, $value)
-    {
-        if (strpos($type, 'date') !== false) {
-            $date = new \DateTime();
-            $date->setTimestamp(strtotime($value));
-            return $date->format('Y-m-d');
-        }
-        return $value;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function onKernelControllerEvent(ControllerEvent $event)
-    {
-        $isMasterRequest = $event->isMasterRequest();
-        if (!$isMasterRequest) {
-            return;
-        }
-        $client = Google\Api::getServiceClient();
-        if (!$client) {
-            die('Google Analytics is not configured');
-        }
-        $this->service = new \Google_Service_Analytics($client);
-    }
-}

--- a/bundles/AdminBundle/Controller/Reports/CustomReportController.php
+++ b//dev/null
@@ -1,381 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Reports;
-use Pimcore\Model\Tool\CustomReport;
-use Symfony\Component\Filesystem\Exception\FileNotFoundException;
-use Symfony\Component\HttpFoundation\BinaryFileResponse;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\ResponseHeaderBag;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/custom-report")
- *
- * @internal
- */
-class CustomReportController extends ReportsControllerBase
-{
-    /**
-     * @Route("/tree", name="pimcore_admin_reports_customreport_tree", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function treeAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $reports = CustomReport\Config::getReportsList();
-        return $this->adminJson($reports);
-    }
-    /**
-     * @Route("/portlet-report-list", name="pimcore_admin_reports_customreport_portletreportlist", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function portletReportListAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        $reports = CustomReport\Config::getReportsList($this->getAdminUser());
-        return $this->adminJson(['data' => $reports]);
-    }
-    /**
-     * @Route("/add", name="pimcore_admin_reports_customreport_add", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function addAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $success = false;
-        $report = CustomReport\Config::getByName($request->get('name'));
-        if (!$report) {
-            $report = new CustomReport\Config();
-            $report->setName($request->get('name'));
-            $report->save();
-            $success = true;
-        }
-        return $this->adminJson(['success' => $success, 'id' => $report->getName()]);
-    }
-    /**
-     * @Route("/delete", name="pimcore_admin_reports_customreport_delete", methods={"DELETE"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function deleteAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $report = CustomReport\Config::getByName($request->get('name'));
-        $report->delete();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/clone", name="pimcore_admin_reports_customreport_clone", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function cloneAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $newName = $request->get('newName');
-        $report = CustomReport\Config::getByName($newName);
-        if ($report) {
-            throw new \Exception('report already exists');
-        }
-        $report = CustomReport\Config::getByName($request->get('name'));
-        $reportData = $this->encodeJson($report);
-        $reportData = $this->decodeJson($reportData);
-        unset($reportData['name']);
-        $reportData['name'] = $newName;
-        foreach ($reportData as $key => $value) {
-            $setter = 'set' . ucfirst($key);
-            if (method_exists($report, $setter)) {
-                $report->$setter($value);
-            }
-        }
-        $report->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/get", name="pimcore_admin_reports_customreport_get", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAction(Request $request)
-    {
-        $this->checkPermissionsHasOneOf(['reports_config', 'reports']);
-        $report = CustomReport\Config::getByName($request->get('name'));
-        return $this->adminJson($report);
-    }
-    /**
-     * @Route("/update", name="pimcore_admin_reports_customreport_update", methods={"PUT"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function updateAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $report = CustomReport\Config::getByName($request->get('name'));
-        $data = $this->decodeJson($request->get('configuration'));
-        if (!is_array($data['yAxis'])) {
-            $data['yAxis'] = strlen($data['yAxis']) ? [$data['yAxis']] : [];
-        }
-        foreach ($data as $key => $value) {
-            $setter = 'set' . ucfirst($key);
-            if (method_exists($report, $setter)) {
-                $report->$setter($value);
-            }
-        }
-        $report->save();
-        return $this->adminJson(['success' => true]);
-    }
-    /**
-     * @Route("/column-config", name="pimcore_admin_reports_customreport_columnconfig", methods={"POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function columnConfigAction(Request $request)
-    {
-        $this->checkPermission('reports_config');
-        $report = CustomReport\Config::getByName($request->get('name'));
-        $columnConfiguration = $report->getColumnConfiguration();
-        if (!is_array($columnConfiguration)) {
-            $columnConfiguration = [];
-        }
-        $configuration = json_decode($request->get('configuration'));
-        $configuration = $configuration[0] ?? null;
-        $success = false;
-        $errorMessage = null;
-        $result = [];
-        try {
-            $adapter = CustomReport\Config::getAdapter($configuration);
-            $columns = $adapter->getColumns($configuration);
-            if (!is_array($columns)) {
-                $columns = [];
-            }
-            foreach ($columnConfiguration as $item) {
-                $name = $item['name'];
-                if (in_array($name, $columns)) {
-                    $result[] = $name;
-                    array_splice($columns, array_search($name, $columns), 1);
-                }
-            }
-            foreach ($columns as $remainingColumn) {
-                $result[] = $remainingColumn;
-            }
-            $success = true;
-        } catch (\Exception $e) {
-            $errorMessage = $e->getMessage();
-        }
-        return $this->adminJson([
-            'success' => $success,
-            'columns' => $result,
-            'errorMessage' => $errorMessage,
-        ]);
-    }
-    /**
-     * @Route("/get-report-config", name="pimcore_admin_reports_customreport_getreportconfig", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getReportConfigAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        $reports = [];
-        $list = new CustomReport\Config\Listing();
-        $items = $list->getDao()->loadForGivenUser($this->getAdminUser());
-        foreach ($items as $report) {
-            $reports[] = [
-                'name' => $report->getName(),
-                'niceName' => $report->getNiceName(),
-                'iconClass' => $report->getIconClass(),
-                'group' => $report->getGroup(),
-                'groupIconClass' => $report->getGroupIconClass(),
-                'menuShortcut' => $report->getMenuShortcut(),
-                'reportClass' => $report->getReportClass(),
-            ];
-        }
-        return $this->adminJson([
-            'success' => true,
-            'reports' => $reports,
-        ]);
-    }
-    /**
-     * @Route("/data", name="pimcore_admin_reports_customreport_data", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function dataAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        $offset = $request->get('start', 0);
-        $limit = $request->get('limit', 40);
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(array_merge($request->request->all(), $request->query->all()));
-        $sort = null;
-        $dir = null;
-        if ($sortingSettings['orderKey']) {
-            $sort = $sortingSettings['orderKey'];
-            $dir = $sortingSettings['order'];
-        }
-        $filters = ($request->get('filter') ? json_decode($request->get('filter'), true) : null);
-        $drillDownFilters = $request->get('drillDownFilters', null);
-        $config = CustomReport\Config::getByName($request->get('name'));
-        $configuration = $config->getDataSourceConfig();
-        $adapter = CustomReport\Config::getAdapter($configuration, $config);
-        $result = $adapter->getData($filters, $sort, $dir, $offset, $limit, null, $drillDownFilters);
-        return $this->adminJson([
-            'success' => true,
-            'data' => $result['data'],
-            'total' => $result['total'],
-        ]);
-    }
-    /**
-     * @Route("/drill-down-options", name="pimcore_admin_reports_customreport_drilldownoptions", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function drillDownOptionsAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        $field = $request->get('field');
-        $filters = ($request->get('filter') ? json_decode($request->get('filter'), true) : null);
-        $drillDownFilters = $request->get('drillDownFilters', null);
-        $config = CustomReport\Config::getByName($request->get('name'));
-        $configuration = $config->getDataSourceConfig();
-        $adapter = CustomReport\Config::getAdapter($configuration, $config);
-        $result = $adapter->getAvailableOptions($filters, $field, $drillDownFilters);
-        return $this->adminJson([
-            'success' => true,
-            'data' => $result['data'],
-        ]);
-    }
-    /**
-     * @Route("/chart", name="pimcore_admin_reports_customreport_chart", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function chartAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        $sort = $request->get('sort');
-        $dir = $request->get('dir');
-        $filters = ($request->get('filter') ? json_decode($request->get('filter'), true) : null);
-        $drillDownFilters = $request->get('drillDownFilters', null);
-        $config = CustomReport\Config::getByName($request->get('name'));
-        $configuration = $config->getDataSourceConfig();
-        $adapter = CustomReport\Config::getAdapter($configuration, $config);
-        $result = $adapter->getData($filters, $sort, $dir, null, null, null, $drillDownFilters);
-        return $this->adminJson([
-            'success' => true,
-            'data' => $result['data'],
-            'total' => $result['total'],
-        ]);
-    }
-    /**
-     * @Route("/create-csv", name="pimcore_admin_reports_customreport_createcsv", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function createCsvAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        set_time_limit(300);
-        $sort = $request->get('sort');
-        $dir = $request->get('dir');
-        $filters = $request->get('filter') ? json_decode(urldecode($request->get('filter')), true) : null;
-        $drillDownFilters = $request->get('drillDownFilters', null);
-        $includeHeaders = $request->get('headers', false);
-        $config = CustomReport\Config::getByName($request->get('name'));
-        $columns = $config->getColumnConfiguration();
-        $fields = [];
-        foreach ($columns as $column) {
-            if ($column['export']) {
-                $fields[] = $column['name'];
-            }
-        }
-        $configuration = $config->getDataSourceConfig();
-        $adapter = CustomReport\Config::getAdapter($configuration, $config);
-        $offset = $request->get('offset', 0);
-        $limit = 5000;
-        $tempData = [];
-        $result = $adapter->getData($filters, $sort, $dir, $offset * $limit, $limit, $fields, $drillDownFilters);
-        ++$offset;
-        if (!($exportFile = $request->get('exportFile'))) {
-            $exportFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/report-export-' . uniqid() . '.csv';
-            @unlink($exportFile);
-        } else {
-            $exportFile = PIMCORE_SYSTEM_TEMP_DIRECTORY.'/'.$exportFile;
-        }
-        $fp = fopen($exportFile, 'a');
-        if ($includeHeaders) {
-            fputcsv($fp, $fields, ';');
-        }
-        foreach ($result['data'] as $row) {
-            fputcsv($fp, array_values($row), ';');
-        }
-        fclose($fp);
-        $progress = $result['total'] ? ($offset * $limit) / $result['total'] : 1;
-        $progress = $progress > 1 ? 1 : $progress;
-        return new JsonResponse([
-            'exportFile' => basename($exportFile),
-            'offset' => $offset,
-            'progress' => $progress,
-            'finished' => empty($result['data']) || count($result['data']) < $limit,
-        ]);
-    }
-    /**
-     * @Route("/download-csv", name="pimcore_admin_reports_customreport_downloadcsv", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return BinaryFileResponse
-     */
-    public function downloadCsvAction(Request $request)
-    {
-        $this->checkPermission('reports');
-        if ($exportFile = $request->get('exportFile')) {
-            $exportFile = PIMCORE_SYSTEM_TEMP_DIRECTORY . '/' . basename($exportFile);
-            $response = new BinaryFileResponse($exportFile);
-            $response->headers->set('Content-Type', 'text/csv; charset=UTF-8');
-            $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT, 'export.csv');
-            $response->deleteFileAfterSend(true);
-            return $response;
-        }
-        throw new FileNotFoundException("File \"$exportFile\" not found!");
-    }
-}

--- a/bundles/AdminBundle/Controller/Reports/ReportsControllerBase.php
+++ b//dev/null
@@ -1,29 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Reports;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Config;
-/**
- * @internal
- */
-abstract class ReportsControllerBase extends AdminController
-{
-    /**
-     * @return \Pimcore\Config\Config
-     */
-    public function getConfig()
-    {
-        return Config::getReportConfig();
-    }
-}

--- a/bundles/AdminBundle/Controller/Reports/SettingsController.php
+++ b//dev/null
@@ -1,70 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Reports;
-use Pimcore\Config;
-use Pimcore\Config\ReportConfigWriter;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-/**
- * @Route("/settings")
- *
- * @internal
- */
-class SettingsController extends ReportsControllerBase
-{
-    /**
-     * @Route("/get", name="pimcore_admin_reports_settings_get", methods={"GET"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     */
-    public function getAction(Request $request)
-    {
-        $this->checkPermission('system_settings');
-        $config = $this->getConfig()->toArray();
-        if (!$this->getAdminUser()->isAllowed('piwik_settings') && isset($config['piwik'])) {
-            unset($config['piwik']);
-        }
-        $response = [
-            'values' => $config,
-            'config' => [],
-        ];
-        return $this->adminJson($response);
-    }
-    /**
-     * @Route("/save", name="pimcore_admin_reports_settings_save", methods={"PUT"})
-     *
-     * @param Request $request
-     * @param ReportConfigWriter $configWriter
-     *
-     * @return JsonResponse
-     */
-    public function saveAction(Request $request, ReportConfigWriter $configWriter)
-    {
-        $this->checkPermission('system_settings');
-        $values = $this->decodeJson($request->get('data'));
-        if (!is_array($values)) {
-            $values = [];
-        }
-        if (!$this->getAdminUser()->isAllowed('piwik_settings')) {
-            $currentConfig = Config::getReportConfig()->toArray();
-            $piwikConfig = $currentConfig['piwik'] ?? [];
-            $values['piwik'] = $piwikConfig;
-        }
-        $configWriter->write($values);
-        return $this->adminJson(['success' => true]);
-    }
-}

--- a/bundles/AdminBundle/Controller/Searchadmin/SearchController.php
+++ b//dev/null
@@ -1,426 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Searchadmin;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Bundle\AdminBundle\Helper\GridHelperService;
-use Pimcore\Config;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\Document;
-use Pimcore\Model\Element;
-use Pimcore\Model\Search\Backend\Data;
-use Symfony\Component\EventDispatcher\GenericEvent;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Routing\Annotation\Route;
-use Symfony\Contracts\EventDispatcher\EventDispatcherInterface;
-/**
- * @Route("/search")
- *
- * @internal
- */
-class SearchController extends AdminController
-{
-    /**
-     * @Route("/find", name="pimcore_admin_searchadmin_search_find", methods={"GET", "POST"})
-     *
-     * @param Request $request
-     *
-     * @return JsonResponse
-     *
-     * @todo: $conditionTypeParts could be undefined
-     * @todo: $conditionSubtypeParts could be undefined
-     * @todo: $conditionClassnameParts could be undefined
-     * @todo: $data could be undefined
-     */
-    public function findAction(Request $request, EventDispatcherInterface $eventDispatcher, GridHelperService $gridHelperService)
-    {
-        $allParams = array_merge($request->request->all(), $request->query->all());
-        $requestedLanguage = $allParams['language'] ?? null;
-        if ($requestedLanguage) {
-            if ($requestedLanguage != 'default') {
-                $request->setLocale($requestedLanguage);
-            }
-        }
-        $filterPrepareEvent = new GenericEvent($this, [
-            'requestParams' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($filterPrepareEvent, AdminEvents::SEARCH_LIST_BEFORE_FILTER_PREPARE);
-        $allParams = $filterPrepareEvent->getArgument('requestParams');
-        $query = $this->filterQueryParam($allParams['query']);
-        $types = explode(',', $allParams['type'] ?? '');
-        $subtypes = explode(',', $allParams['subtype'] ?? '');
-        $classnames = explode(',', $allParams['class'] ?? '');
-        $offset = (int)$allParams['start'];
-        $limit = (int)$allParams['limit'];
-        $offset = $offset ? $offset : 0;
-        $limit = $limit ? $limit : 50;
-        $searcherList = new Data\Listing();
-        $conditionParts = [];
-        $db = \Pimcore\Db::get();
-        $forbiddenConditions = $this->getForbiddenCondition($types);
-        if ($forbiddenConditions) {
-            $conditionParts[] = '(' . implode(' AND ', $forbiddenConditions) . ')';
-        }
-        $queryCondition = '';
-        if (!empty($query)) {
-            $queryCondition = '( MATCH (`data`,`properties`) AGAINST (' . $db->quote($query) . ' IN BOOLEAN MODE) )';
-            $conditionParts[] = $queryCondition;
-        }
-        $fields = [];
-        $bricks = [];
-        if (!empty($allParams['fields'])) {
-            $fields = $allParams['fields'];
-            foreach ($fields as $f) {
-                $parts = explode('~', $f);
-                if (substr($f, 0, 1) == '~') {
-                } elseif (count($parts) > 1) {
-                    $bricks[$parts[0]] = $parts[0];
-                }
-            }
-        }
-        if (!empty($allParams['filter']) && !empty($allParams['class'])) {
-            $class = DataObject\ClassDefinition::getByName($allParams['class']);
-            $params = $this->decodeJson($allParams['filter']);
-            $unlocalizedFieldsFilters = [];
-            $localizedFieldsFilters = [];
-            foreach ($params as $paramConditionObject) {
-                $definitionExists = in_array('o_' . $paramConditionObject['property'], DataObject\Service::getSystemFields())
-                    || $class->getFieldDefinition($paramConditionObject['property']);
-                if ($definitionExists) { //TODO: for sure, we can add additional condition like getLocalizedFieldDefinition()->getFieldDefiniton(...
-                    $unlocalizedFieldsFilters[] = $paramConditionObject;
-                } else {
-                    $localizedFieldsFilters[] = $paramConditionObject;
-                }
-            }
-            $conditionFilters = count($unlocalizedFieldsFilters)
-                ? $gridHelperService->getFilterCondition($this->encodeJson($unlocalizedFieldsFilters), $class)
-                : null;
-            $localizedConditionFilters = count($localizedFieldsFilters)
-                ? $gridHelperService->getFilterCondition($this->encodeJson($localizedFieldsFilters), $class)
-                : null;
-            $join = '';
-            foreach ($bricks as $ob) {
-                $join .= ' LEFT JOIN object_brick_query_' . $ob . '_' . $class->getId();
-                $join .= ' `' . $ob . '`';
-                $join .= ' ON `' . $ob . '`.o_id = `object_' . $class->getId() . '`.o_id';
-            }
-            if (null !== $conditionFilters) {
-                $conditionParts[] = '( id IN (SELECT `object_' . $class->getId() . '`.o_id FROM object_' . $class->getId()
-                    . $join . ' WHERE ' . $conditionFilters . ') )';
-            }
-            if (null !== $localizedConditionFilters) {
-                $conditionParts[] = '( id IN (SELECT `object_localized_data_' . $class->getId()
-                    . '`.ooo_id FROM object_localized_data_' . $class->getId() . $join . ' WHERE '
-                    . $localizedConditionFilters . ' GROUP BY ooo_id ' . ') )';
-            }
-        }
-        if (is_array($types) and !empty($types[0])) {
-            $conditionTypeParts = [];
-            foreach ($types as $type) {
-                $conditionTypeParts[] = $db->quote($type);
-            }
-            if (in_array('folder', $subtypes)) {
-                $conditionTypeParts[] = $db->quote('folder');
-            }
-            $conditionParts[] = '( maintype IN (' . implode(',', $conditionTypeParts) . ') )';
-        }
-        if (is_array($subtypes) and !empty($subtypes[0])) {
-            $conditionSubtypeParts = [];
-            foreach ($subtypes as $subtype) {
-                $conditionSubtypeParts[] = $db->quote($subtype);
-            }
-            $conditionParts[] = '( type IN (' . implode(',', $conditionSubtypeParts) . ') )';
-        }
-        if (is_array($classnames) and !empty($classnames[0])) {
-            if (in_array('folder', $subtypes)) {
-                $classnames[] = 'folder';
-            }
-            $conditionClassnameParts = [];
-            foreach ($classnames as $classname) {
-                $conditionClassnameParts[] = $db->quote($classname);
-            }
-            $conditionParts[] = '( subtype IN (' . implode(',', $conditionClassnameParts) . ') )';
-        }
-        if (!empty($allParams['tagIds'])) {
-            $tagIds = $allParams['tagIds'];
-            foreach ($tagIds as $tagId) {
-                foreach ($types as $type) {
-                    if (($allParams['considerChildTags'] ?? 'false') === 'true') {
-                        $tag = Element\Tag::getById($tagId);
-                        if ($tag) {
-                            $tagPath = $tag->getFullIdPath();
-                            $conditionParts[] = 'id IN (SELECT cId FROM tags_assignment INNER JOIN tags ON tags.id = tags_assignment.tagid WHERE ctype = ' . $db->quote($type) . ' AND (id = ' .(int)$tagId. ' OR idPath LIKE ' . $db->quote($db->escapeLike($tagPath) . '%') . '))';
-                        }
-                    } else {
-                        $conditionParts[] = 'id IN (SELECT cId FROM tags_assignment WHERE ctype = ' . $db->quote($type) . ' AND tagid = ' .(int)$tagId. ')';
-                    }
-                }
-            }
-        }
-        if (count($conditionParts) > 0) {
-            $condition = implode(' AND ', $conditionParts);
-            $searcherList->setCondition($condition);
-        }
-        $searcherList->setOffset($offset);
-        $searcherList->setLimit($limit);
-        $searcherList->setOrderKey($queryCondition, false);
-        $searcherList->setOrder('DESC');
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey']) {
-            $sortMapping = [
-                'classname' => 'subtype',
-            ];
-            $sort = $sortingSettings['orderKey'];
-            if (array_key_exists($sortingSettings['orderKey'], $sortMapping)) {
-                $sort = $sortMapping[$sortingSettings['orderKey']];
-            }
-            $searcherList->setOrderKey($sort);
-        }
-        if ($sortingSettings['order']) {
-            $searcherList->setOrder($sortingSettings['order']);
-        }
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $searcherList,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::SEARCH_LIST_BEFORE_LIST_LOAD);
-        /** @var Data\Listing $searcherList */
-        $searcherList = $beforeListLoadEvent->getArgument('list');
-        if (in_array('asset', $types)) {
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $searcherList,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::ASSET_LIST_BEFORE_LIST_LOAD);
-            /** @var Data\Listing $searcherList */
-            $searcherList = $beforeListLoadEvent->getArgument('list');
-        }
-        if (in_array('document', $types)) {
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $searcherList,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::DOCUMENT_LIST_BEFORE_LIST_LOAD);
-            /** @var Data\Listing $searcherList */
-            $searcherList = $beforeListLoadEvent->getArgument('list');
-        }
-        if (in_array('object', $types)) {
-            $beforeListLoadEvent = new GenericEvent($this, [
-                'list' => $searcherList,
-                'context' => $allParams,
-            ]);
-            $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::OBJECT_LIST_BEFORE_LIST_LOAD);
-            /** @var Data\Listing $searcherList */
-            $searcherList = $beforeListLoadEvent->getArgument('list');
-        }
-        $hits = $searcherList->load();
-        $elements = [];
-        foreach ($hits as $hit) {
-            $element = Element\Service::getElementById($hit->getId()->getType(), $hit->getId()->getId());
-            if ($element->isAllowed('list')) {
-                $data = null;
-                if ($element instanceof DataObject\AbstractObject) {
-                    $data = DataObject\Service::gridObjectData($element, $fields);
-                } elseif ($element instanceof Document) {
-                    $data = Document\Service::gridDocumentData($element);
-                } elseif ($element instanceof Asset) {
-                    $data = Asset\Service::gridAssetData($element);
-                }
-                if ($data) {
-                    $elements[] = $data;
-                }
-            } else {
-            }
-        }
-        if ($allParams['limit']) {
-            $totalMatches = $searcherList->getTotalCount();
-        } else {
-            $totalMatches = count($elements);
-        }
-        $result = ['data' => $elements, 'success' => true, 'total' => $totalMatches];
-        $afterListLoadEvent = new GenericEvent($this, [
-            'list' => $result,
-            'context' => $allParams,
-        ]);
-        $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::SEARCH_LIST_AFTER_LIST_LOAD);
-        $result = $afterListLoadEvent->getArgument('list');
-        return $this->adminJson($result);
-    }
-    /**
-     * @param array $types
-     *
-     * @return array
-     */
-    protected function getForbiddenCondition($types = ['assets', 'documents', 'objects'])
-    {
-        $user = $this->getAdminUser();
-        $db = \Pimcore\Db::get();
-        $forbiddenConditions = [];
-        if (in_array('asset', $types)) {
-            if (!$user->isAllowed('assets')) {
-                $forbiddenConditions[] = " `type` != 'asset' ";
-            } else {
-                $forbiddenAssetPaths = Element\Service::findForbiddenPaths('asset', $user);
-                if (count($forbiddenAssetPaths) > 0) {
-                    for ($i = 0; $i < count($forbiddenAssetPaths); $i++) {
-                        $forbiddenAssetPaths[$i] = " (maintype = 'asset' AND fullpath not like " . $db->quote($forbiddenAssetPaths[$i] . '%') . ')';
-                    }
-                    $forbiddenConditions[] = implode(' AND ', $forbiddenAssetPaths) ;
-                }
-            }
-        }
-        if (in_array('document', $types)) {
-            if (!$user->isAllowed('documents')) {
-                $forbiddenConditions[] = " `type` != 'document' ";
-            } else {
-                $forbiddenDocumentPaths = Element\Service::findForbiddenPaths('document', $user);
-                if (count($forbiddenDocumentPaths) > 0) {
-                    for ($i = 0; $i < count($forbiddenDocumentPaths); $i++) {
-                        $forbiddenDocumentPaths[$i] = " (maintype = 'document' AND fullpath not like " . $db->quote($forbiddenDocumentPaths[$i] . '%') . ')';
-                    }
-                    $forbiddenConditions[] = implode(' AND ', $forbiddenDocumentPaths) ;
-                }
-            }
-        }
-        if (in_array('object', $types)) {
-            if (!$user->isAllowed('objects')) {
-                $forbiddenConditions[] = " `type` != 'object' ";
-            } else {
-                $forbiddenObjectPaths = Element\Service::findForbiddenPaths('object', $user);
-                if (count($forbiddenObjectPaths) > 0) {
-                    for ($i = 0; $i < count($forbiddenObjectPaths); $i++) {
-                        $forbiddenObjectPaths[$i] = " (maintype = 'object' AND fullpath not like " . $db->quote($forbiddenObjectPaths[$i] . '%') . ')';
-                    }
-                    $forbiddenConditions[] = implode(' AND ', $forbiddenObjectPaths);
-                }
-            }
-        }
-        return $forbiddenConditions;
-    }
-    /**
-     * @param string $query
-     *
-     * @return string
-     */
-    protected function filterQueryParam(string $query)
-    {
-        if ($query == '*') {
-            $query = '';
-        }
-        $query = str_replace('%', '*', $query);
-        $query = str_replace('@', '#', $query);
-        $query = preg_replace("@([^ ])\-@", '$1 ', $query);
-        $query = str_replace(['<', '>', '(', ')', '~'], ' ', $query);
-        $query = preg_replace('#[*]+#', '*', $query);
-        $query = rtrim($query, '+- ');
-        return $query;
-    }
-    /**
-     * @Route("/quicksearch", name="pimcore_admin_searchadmin_search_quicksearch", methods={"GET"})
-     *
-     * @param Request $request
-     * @param EventDispatcherInterface $eventDispatcher
-     * @param Config $config
-     *
-     * @return JsonResponse
-     */
-    public function quicksearchAction(Request $request, EventDispatcherInterface $eventDispatcher, Config $config)
-    {
-        $query = $this->filterQueryParam($request->get('query'));
-        if (!preg_match('/[\+\-\*"]/', $query)) {
-            $query = $query . '*';
-        }
-        $db = \Pimcore\Db::get();
-        $searcherList = new Data\Listing();
-        $conditionParts = [];
-        $forbiddenConditions = $this->getForbiddenCondition();
-        if ($forbiddenConditions) {
-            $conditionParts[] = '(' . implode(' AND ', $forbiddenConditions) . ')';
-        }
-        $matchCondition = '( MATCH (`data`,`properties`) AGAINST (' . $db->quote($query) . ' IN BOOLEAN MODE) )';
-        $conditionParts[] = '(' . $matchCondition . " AND type != 'folder') ";
-        $queryCondition = implode(' AND ', $conditionParts);
-        $searcherList->setCondition($queryCondition);
-        $searcherList->setLimit(50);
-        $searcherList->setOrderKey($matchCondition, false);
-        $searcherList->setOrder('DESC');
-        $beforeListLoadEvent = new GenericEvent($this, [
-            'list' => $searcherList,
-            'query' => $query,
-        ]);
-        $eventDispatcher->dispatch($beforeListLoadEvent, AdminEvents::QUICKSEARCH_LIST_BEFORE_LIST_LOAD);
-        $searcherList = $beforeListLoadEvent->getArgument('list');
-        $hits = $searcherList->load();
-        $elements = [];
-        foreach ($hits as $hit) {
-            $element = Element\Service::getElementById($hit->getId()->getType(), $hit->getId()->getId());
-            if ($element->isAllowed('list')) {
-                $data = [
-                    'id' => $element->getId(),
-                    'type' => $hit->getId()->getType(),
-                    'subtype' => $element->getType(),
-                    'className' => ($element instanceof DataObject\Concrete) ? $element->getClassName() : '',
-                    'fullpath' => htmlspecialchars($element->getRealFullPath()),
-                    'fullpathList' => htmlspecialchars($this->shortenPath($element->getRealFullPath())),
-                    'iconCls' => 'pimcore_icon_asset_default',
-                ];
-                if ($element instanceof Asset) {
-                    $data['iconCls'] .= ' pimcore_icon_' . \Pimcore\File::getFileExtension($element->getFilename());
-                } else {
-                    $data['iconCls'] .= ' pimcore_icon_' . $element->getType();
-                }
-                $validLanguages = \Pimcore\Tool::getValidLanguages();
-                $data['preview'] = $this->renderView('@PimcoreAdmin/SearchAdmin/Search/Quicksearch/' . $hit->getId()->getType() . '.html.twig', [
-                    'element' => $element,
-                    'iconCls' => $data['iconCls'],
-                    'config' => $config,
-                    'validLanguages' => $validLanguages,
-                ]);
-                $elements[] = $data;
-            }
-        }
-        $afterListLoadEvent = new GenericEvent($this, [
-            'list' => $elements,
-            'context' => $query,
-        ]);
-        $eventDispatcher->dispatch($afterListLoadEvent, AdminEvents::QUICKSEARCH_LIST_AFTER_LIST_LOAD);
-        $elements = $afterListLoadEvent->getArgument('list');
-        $result = ['data' => $elements, 'success' => true];
-        return $this->adminJson($result);
-    }
-    /**
-     * @param string $path
-     *
-     * @return string
-     */
-    protected function shortenPath($path)
-    {
-        $parts = explode('/', trim($path, '/'));
-        $count = count($parts) - 1;
-        $shortPath = '';
-        for ($i = $count; $i >= 0; $i--) {
-            $shortPath = '/' . implode('/', array_unique($parts));
-            if (strlen($shortPath) <= 50 || $i === 0) {
-                break;
-            }
-            array_splice($parts, $i - 1, 1, '');
-        }
-        if (mb_strlen($shortPath) > 50) {
-            $shortPath = mb_substr($shortPath, 0, 49) . '';
-        }
-        return $shortPath;
-    }
-}

--- a/bundles/AdminBundle/Controller/Traits/AdminStyleTrait.php
+++ b//dev/null
@@ -1,46 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Traits;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Event\AdminEvents;
-use Pimcore\Model\Element\AdminStyle;
-use Pimcore\Model\Element\ElementInterface;
-/**
- * @internal
- */
-trait AdminStyleTrait
-{
-    /**
-     * @param ElementInterface $element
-     * @param null|int $context
-     * @param array $data
-     *
-     * @throws \Exception
-     */
-    protected function addAdminStyle(ElementInterface $element, $context = null, &$data = [])
-    {
-        $event = new ElementAdminStyleEvent($element, new AdminStyle($element), $context);
-        \Pimcore::getEventDispatcher()->dispatch($event, AdminEvents::RESOLVE_ELEMENT_ADMIN_STYLE);
-        $adminStyle = $event->getAdminStyle();
-        $data['icon'] = $adminStyle->getElementIcon() !== false ? $adminStyle->getElementIcon() : null;
-        $data['iconCls'] = $adminStyle->getElementIconClass() !== false ? $adminStyle->getElementIconClass() : null;
-        if ($adminStyle->getElementCssClass() !== false) {
-            if (!isset($data['cls'])) {
-                $data['cls'] = '';
-            }
-            $data['cls'] .= $adminStyle->getElementCssClass() . ' ';
-        }
-        $data['qtipCfg'] = $adminStyle->getElementQtipConfig();
-    }
-}

--- a/bundles/AdminBundle/Controller/Traits/ApplySchedulerDataTrait.php
+++ b//dev/null
@@ -1,47 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Traits;
-use Pimcore\Bundle\AdminBundle\Controller\AdminController;
-use Pimcore\Model\Element\ElementInterface;
-use Pimcore\Model\Schedule\Task;
-use Symfony\Component\HttpFoundation\Request;
-/**
- * @internal
- */
-trait ApplySchedulerDataTrait
-{
-    /**
-     * @param Request $request
-     * @param ElementInterface $element
-     */
-    protected function applySchedulerDataToElement(Request $request, ElementInterface $element)
-    {
-        /** @var AdminController $this */
-        if ($request->get('scheduler')) {
-            $tasks = [];
-            $tasksData = $this->decodeJson($request->get('scheduler'));
-            if (!empty($tasksData)) {
-                foreach ($tasksData as $taskData) {
-                    $taskData['date'] = strtotime($taskData['date'] . ' ' . ($taskData['time'] ?? ''));
-                    $taskData['userId'] = $this->getAdminUser()->getId();
-                    $task = new Task($taskData);
-                    $tasks[] = $task;
-                }
-            }
-            if ($element->isAllowed('settings') && method_exists($element, 'setScheduledTasks')) {
-                $element->setScheduledTasks($tasks);
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/Controller/Traits/DocumentTreeConfigTrait.php
+++ b//dev/null
@@ -1,112 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Controller\Traits;
-use Pimcore\Config;
-use Pimcore\Event\Admin\ElementAdminStyleEvent;
-use Pimcore\Model\Document;
-use Pimcore\Model\Site;
-use Pimcore\Tool\Frontend;
-/**
- * @internal
- */
-trait DocumentTreeConfigTrait
-{
-    use AdminStyleTrait;
-    /**
-     * @param Document $element
-     *
-     * @return array
-     *
-     * @throws \Exception
-     */
-    public function getTreeNodeConfig($element)
-    {
-        $site = null;
-        $childDocument = $element;
-        $container = \Pimcore::getContainer();
-        /** @var Config $config */
-        $config = $container->get(Config::class);
-        $tmpDocument = [
-            'id' => $childDocument->getId(),
-            'idx' => (int)$childDocument->getIndex(),
-            'text' => $childDocument->getKey(),
-            'type' => $childDocument->getType(),
-            'path' => $childDocument->getRealFullPath(),
-            'basePath' => $childDocument->getRealPath(),
-            'locked' => $childDocument->isLocked(),
-            'lockOwner' => $childDocument->getLocked() ? true : false,
-            'published' => $childDocument->isPublished(),
-            'elementType' => 'document',
-            'leaf' => true,
-            'permissions' => [
-                'view' => $childDocument->isAllowed('view'),
-                'remove' => $childDocument->isAllowed('delete'),
-                'settings' => $childDocument->isAllowed('settings'),
-                'rename' => $childDocument->isAllowed('rename'),
-                'publish' => $childDocument->isAllowed('publish'),
-                'unpublish' => $childDocument->isAllowed('unpublish'),
-                'create' => $childDocument->isAllowed('create'),
-            ],
-        ];
-        $tmpDocument['expandable'] = $childDocument->hasChildren();
-        $tmpDocument['loaded'] = !$childDocument->hasChildren();
-        if ($childDocument->getType() == 'page') {
-            $tmpDocument['leaf'] = false;
-            $tmpDocument['expanded'] = !$childDocument->hasChildren();
-            if ($site = Site::getByRootId($childDocument->getId())) {
-                $site->setRootDocument(null);
-                $tmpDocument['site'] = $site->getObjectVars();
-            }
-        } elseif ($childDocument->getType() == 'folder' || $childDocument->getType() == 'link' || $childDocument->getType() == 'hardlink') {
-            $tmpDocument['leaf'] = false;
-            $tmpDocument['expanded'] = !$childDocument->hasChildren();
-        } elseif (method_exists($childDocument, 'getTreeNodeConfig')) {
-            $tmp = $childDocument->getTreeNodeConfig();
-            $tmpDocument = array_merge($tmpDocument, $tmp);
-        }
-        $this->addAdminStyle($childDocument, ElementAdminStyleEvent::CONTEXT_TREE, $tmpDocument);
-        if ($childDocument instanceof Document\Page && isset($config['documents']['generate_preview'])) {
-            $thumbnailFile = $childDocument->getPreviewImageFilesystemPath();
-            if (file_exists($thumbnailFile) && filemtime($thumbnailFile) > ($childDocument->getModificationDate() - 20)) {
-                $tmpDocument['thumbnail'] = $this->generateUrl('pimcore_admin_page_display_preview_image', ['id' => $childDocument->getId()]);
-                $thumbnailFileHdpi = $childDocument->getPreviewImageFilesystemPath(true);
-                if (file_exists($thumbnailFileHdpi)) {
-                    $tmpDocument['thumbnailHdpi'] = $this->generateUrl('pimcore_admin_page_display_preview_image',
-                        ['id' => $childDocument->getId(), 'hdpi' => true]);
-                }
-            }
-        }
-        $tmpDocument['cls'] = '';
-        if ($childDocument instanceof Document\Page) {
-            $tmpDocument['url'] = $childDocument->getFullPath();
-            $site = Frontend::getSiteForDocument($childDocument);
-            if ($site instanceof Site) {
-                $tmpDocument['url'] = 'http://' . $site->getMainDomain() . preg_replace('@^' . $site->getRootPath() . '/?@', '/', $childDocument->getRealFullPath());
-            }
-        }
-        if ($childDocument->getProperty('navigation_exclude')) {
-            $tmpDocument['cls'] .= 'pimcore_navigation_exclude ';
-        }
-        if (!$childDocument->isPublished()) {
-            $tmpDocument['cls'] .= 'pimcore_unpublished ';
-        }
-        if ($childDocument->isLocked()) {
-            $tmpDocument['cls'] .= 'pimcore_treenode_locked ';
-        }
-        if ($childDocument->getLocked()) {
-            $tmpDocument['cls'] .= 'pimcore_treenode_lockOwner ';
-        }
-        return $tmpDocument;
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/Compiler/GDPRDataProviderPass.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\Manager;
-use Pimcore\DependencyInjection\CollectionServiceLocator;
-use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Definition;
-use Symfony\Component\DependencyInjection\Reference;
-/**
- * @internal
- */
-final class GDPRDataProviderPass implements CompilerPassInterface
-{
-    /**
-     * Registers each service with tag pimcore.gdpr.data-provider as dataprovider for gdpr data extractor
-     *
-     * @param ContainerBuilder $container
-     */
-    public function process(ContainerBuilder $container)
-    {
-        $providers = $container->findTaggedServiceIds('pimcore.gdpr.data-provider');
-        $mapping = [];
-        foreach ($providers as $id => $tags) {
-            $mapping[$id] = new Reference($id);
-        }
-        $collectionLocator = new Definition(CollectionServiceLocator::class, [$mapping]);
-        $collectionLocator->setPublic(false);
-        $collectionLocator->addTag('container.service_locator');
-        $manager = $container->getDefinition(Manager::class);
-        $manager->setArgument('$services', $collectionLocator);
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/Compiler/ImportExportLocatorsPass.php
+++ b//dev/null
@@ -1,77 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler;
-use Pimcore\DataObject\GridColumnConfig\Service as GridColumnService;
-use Symfony\Component\Config\Definition\Exception\InvalidDefinitionException;
-use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Definition;
-use Symfony\Component\DependencyInjection\Reference;
-use Symfony\Component\DependencyInjection\ServiceLocator;
-/**
- * @internal
- */
-final class ImportExportLocatorsPass implements CompilerPassInterface
-{
-    public function process(ContainerBuilder $container)
-    {
-        $this->processGridColumns($container);
-    }
-    private function processGridColumns(ContainerBuilder $container)
-    {
-        $gridColumnService = $container->getDefinition(GridColumnService::class);
-        $this->createLocatorForTaggedServices(
-            $container,
-            $gridColumnService,
-            'grid column operator factory',
-            'pimcore.data_object.grid_column_config.operator_factory',
-            '$operatorFactories'
-        );
-        $this->createLocatorForTaggedServices(
-            $container,
-            $gridColumnService,
-            'grid column value factory',
-            'pimcore.data_object.grid_column_config.value_factory',
-            '$valueFactories'
-        );
-    }
-    private function createLocatorForTaggedServices(
-        ContainerBuilder $container,
-        Definition $definition,
-        string $type,
-        string $tag,
-        string $argument
-    ) {
-        $resolvers = $container->findTaggedServiceIds($tag);
-        $mapping = [];
-        foreach ($resolvers as $id => $tagEntries) {
-            foreach ($tagEntries as $tagEntry) {
-                if (!isset($tagEntry['id'])) {
-                    throw new InvalidDefinitionException(sprintf(
-                        'The %s "%s" does not define an ID on the "%s" tag.',
-                        $type,
-                        $id,
-                        $tag
-                    ));
-                }
-                $mapping[$tagEntry['id']] = new Reference($id);
-            }
-        }
-        $serviceLocator = new Definition(ServiceLocator::class, [$mapping]);
-        $serviceLocator->setPublic(false);
-        $serviceLocator->addTag('container.service_locator');
-        $definition->setArgument($argument, $serviceLocator);
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/Compiler/SerializerPass.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler;
-use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
-use Symfony\Component\DependencyInjection\Compiler\PriorityTaggedServiceTrait;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Exception\RuntimeException;
-/**
- * Adds all services with the tags "pimcore_admin.serializer.encoder" and "pimcore_admin.serializer.normalizer" as
- * encoders and normalizers to the Admin Serializer service.
- *
- * This does exactly the same as the framework serializer pass, but adds encoders/normalizers to our custom admin
- * serializer.
- *
- * @see \Symfony\Component\Serializer\Serializer
- *
- * @internal
- */
-final class SerializerPass implements CompilerPassInterface
-{
-    use PriorityTaggedServiceTrait;
-    public function process(ContainerBuilder $container)
-    {
-        if (!$container->hasDefinition('Pimcore\\Admin\\Serializer')) {
-            return;
-        }
-        $definition = $container->getDefinition('Pimcore\\Admin\\Serializer');
-        $normalizers = $this->findAndSortTaggedServices('pimcore_admin.serializer.normalizer', $container);
-        if (empty($normalizers)) {
-            throw new RuntimeException('You must tag at least one service as "pimcore_admin.serializer.normalizer" to use the Admin Serializer service');
-        }
-        $encoders = $this->findAndSortTaggedServices('pimcore_admin.serializer.encoder', $container);
-        if (empty($encoders)) {
-            throw new RuntimeException('You must tag at least one service as "pimcore_admin.serializer.encoder" to use the Admin Serializer service');
-        }
-        $definition->setArguments([
-            '$normalizers' => $normalizers,
-            '$encoders' => $encoders,
-        ]);
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/Compiler/TranslationServicesPass.php
+++ b//dev/null
@@ -1,55 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler;
-use Pimcore\Translation\ExportDataExtractorService\ExportDataExtractorServiceInterface;
-use Pimcore\Translation\ImporterService\ImporterServiceInterface;
-use Symfony\Component\DependencyInjection\Compiler\CompilerPassInterface;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Reference;
-/**
- * @internal
- */
-final class TranslationServicesPass implements CompilerPassInterface
-{
-    /**
-     * Registers each service with tag pimcore.translation.data-extractor as data extractor for the translations export data extractor service.
-     * Registers each service with tag pimcore.translation.importer as importer for the translations importer service.
-     *
-     * @param ContainerBuilder $container
-     */
-    public function process(ContainerBuilder $container)
-    {
-        $providers = $container->findTaggedServiceIds('pimcore.translation.data-extractor');
-        foreach ($providers as $id => $tags) {
-            foreach ($tags as $attributes) {
-                if (empty($attributes['type'])) {
-                    throw new \Exception('service with tag "pimcore.translation.data-extractor" but without type registered');
-                }
-                $definition = $container->getDefinition(ExportDataExtractorServiceInterface::class);
-                $definition->addMethodCall('registerDataExtractor', [$attributes['type'], new Reference($id)]);
-            }
-        }
-        $providers = $container->findTaggedServiceIds('pimcore.translation.importer');
-        foreach ($providers as $id => $tags) {
-            foreach ($tags as $attributes) {
-                if (empty($attributes['type'])) {
-                    throw new \Exception('service with tag "pimcore.translation.data-extractor" but without type registered');
-                }
-                $definition = $container->getDefinition(ImporterServiceInterface::class);
-                $definition->addMethodCall('registerImporter', [$attributes['type'], new Reference($id)]);
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/Configuration.php
+++ b//dev/null
@@ -1,194 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection;
-use Symfony\Component\Config\Definition\Builder\ArrayNodeDefinition;
-use Symfony\Component\Config\Definition\Builder\TreeBuilder;
-use Symfony\Component\Config\Definition\ConfigurationInterface;
-/**
- * Adds configuration for gdpr data provider
- *
- * @internal
- */
-final class Configuration implements ConfigurationInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function getConfigTreeBuilder()
-    {
-        $treeBuilder = new TreeBuilder('pimcore_admin');
-        /** @var ArrayNodeDefinition $rootNode */
-        $rootNode = $treeBuilder->getRootNode();
-        $rootNode->append($this->buildGdprDataExtractorNode());
-        $rootNode->append($this->buildObjectsNode());
-        $rootNode->append($this->buildAssetsNode());
-        $rootNode->append($this->buildDocumentsNode());
-        $rootNode->children()
-            ->arrayNode('admin_languages')
-                ->prototype('scalar')
-                ->end()
-            ->end()
-            ->arrayNode('csrf_protection')
-                ->addDefaultsIfNotSet()
-                ->children()
-                    ->arrayNode('excluded_routes')
-                        ->prototype('scalar')
-                        ->end()
-                    ->end()
-                ->end()
-            ->end()
-            ->scalarNode('custom_admin_path_identifier')
-                ->defaultNull()
-                ->validate()
-                    ->ifTrue(function ($v) {
-                        return strlen($v) < 20;
-                    })
-                    ->thenInvalid('custom_admin_path_identifier must be at least 20 characters long')
-                ->end()
-            ->end()
-            ->arrayNode('branding')
-                ->addDefaultsIfNotSet()
-                ->children()
-                    ->booleanNode('login_screen_invert_colors')
-                        ->defaultFalse()
-                    ->end()
-                    ->scalarNode('color_login_screen')
-                        ->defaultNull()
-                    ->end()
-                    ->scalarNode('color_admin_interface')
-                        ->defaultNull()
-                    ->end()
-                    ->scalarNode('login_screen_custom_image')
-                        ->defaultNull()
-                    ->end()
-                ->end()
-            ->end()
-        ;
-        return $treeBuilder;
-    }
-    /**
-     * @return \Symfony\Component\Config\Definition\Builder\ArrayNodeDefinition|\Symfony\Component\Config\Definition\Builder\NodeDefinition
-     */
-    protected function buildGdprDataExtractorNode()
-    {
-        $treeBuilder = new TreeBuilder('gdpr_data_extractor');
-        $gdprDataExtractor = $treeBuilder->getRootNode();
-        $gdprDataExtractor->addDefaultsIfNotSet();
-        $dataObjects = $treeBuilder->getRootNode()->children()->arrayNode('dataObjects');
-        $dataObjects
-            ->addDefaultsIfNotSet()
-            ->info('Settings for DataObjects DataProvider');
-        $dataObjects
-            ->children()
-                ->arrayNode('classes')
-                    ->info('Configure which classes should be considered, array key is class name')
-                    ->prototype('array')
-                        ->info('
-    MY_CLASS_NAME:
-		include: true
-		allowDelete: false
-		includedRelations:
-			- manualSegemens
-			- calculatedSegments
-                        ')
-                        ->children()
-                            ->booleanNode('include')
-                                ->info('Set if class should be considered in export.')
-                                ->defaultTrue()
-                            ->end()
-                            ->booleanNode('allowDelete')
-                                ->info('Allow delete of objects directly in preview grid.')
-                                ->defaultFalse()
-                            ->end()
-                            ->arrayNode('includedRelations')
-                                ->info('List relation attributes that should be included recursively into export.')
-                                ->prototype('scalar')->end()
-                            ->end()
-                        ->end()
-                    ->end()
-                ->end()
-            ->end()
-        ;
-        $gdprDataExtractor->append($dataObjects);
-        $assets = $treeBuilder->getRootNode()->children()->arrayNode('assets');
-        $assets
-            ->addDefaultsIfNotSet()
-            ->info('Settings for Assets DataProvider');
-        $assets
-            ->children()
-                ->arrayNode('types')
-                    ->info('Configure which types should be considered')
-                    ->prototype('array')
-                    ->info('asset types')
-                ->end()->defaultValue([])
-            ->end();
-        $gdprDataExtractor->append($assets);
-        return $gdprDataExtractor;
-    }
-    /**
-     * @return ArrayNodeDefinition|\Symfony\Component\Config\Definition\Builder\NodeDefinition
-     */
-    protected function buildEventsNode()
-    {
-        $treeBuilder = new TreeBuilder('notes_events');
-        $notesEvents = $treeBuilder->getRootNode();
-        $notesEvents
-            ->addDefaultsIfNotSet()
-            ->children()
-                ->arrayNode('types')
-                    ->info('List all notes/event types.')
-                    ->prototype('scalar')->end()
-                    ->defaultValue(['', 'content', 'seo', 'warning', 'notice'])
-                ->end()
-            ->end()
-        ;
-        return $notesEvents;
-    }
-    /**
-     * @return ArrayNodeDefinition|\Symfony\Component\Config\Definition\Builder\NodeDefinition
-     */
-    protected function buildObjectsNode()
-    {
-        $treeBuilder = new TreeBuilder('objects');
-        $objectsNode = $treeBuilder->getRootNode();
-        $objectsNode
-            ->addDefaultsIfNotSet()
-            ->append($this->buildEventsNode());
-        return $objectsNode;
-    }
-    /**
-     * @return ArrayNodeDefinition|\Symfony\Component\Config\Definition\Builder\NodeDefinition
-     */
-    protected function buildAssetsNode()
-    {
-        $treeBuilder = new TreeBuilder('assets');
-        $assetsNode = $treeBuilder->getRootNode();
-        $assetsNode
-            ->addDefaultsIfNotSet()
-            ->append($this->buildEventsNode());
-        return $assetsNode;
-    }
-    /**
-     * @return ArrayNodeDefinition|\Symfony\Component\Config\Definition\Builder\NodeDefinition
-     */
-    protected function buildDocumentsNode()
-    {
-        $treeBuilder = new TreeBuilder('documents');
-        $documentsNode = $treeBuilder->getRootNode();
-        $documentsNode
-            ->addDefaultsIfNotSet()
-            ->append($this->buildEventsNode());
-        return $documentsNode;
-    }
-}

--- a/bundles/AdminBundle/DependencyInjection/PimcoreAdminExtension.php
+++ b//dev/null
@@ -1,55 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\DependencyInjection;
-use Symfony\Component\Config\FileLocator;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Extension\Extension;
-use Symfony\Component\DependencyInjection\Loader\YamlFileLoader;
-/**
- * @internal
- */
-final class PimcoreAdminExtension extends Extension
-{
-    const PARAM_DATAOBJECTS_NOTES_EVENTS_TYPES = 'pimcore_admin.dataObjects.notes_events.types';
-    const PARAM_ASSETS_NOTES_EVENTS_TYPES = 'pimcore_admin.assets.notes_events.types';
-    const PARAM_DOCUMENTS_NOTES_EVENTS_TYPES = 'pimcore_admin.documents.notes_events.types';
-    /**
-     * {@inheritdoc}
-     */
-    public function load(array $configs, ContainerBuilder $container)
-    {
-        $configuration = new Configuration();
-        $config = $this->processConfiguration($configuration, $configs);
-        $loader = new YamlFileLoader(
-            $container,
-            new FileLocator(__DIR__ . '/../Resources/config')
-        );
-        $loader->load('services.yml');
-        $loader->load('security_services.yml');
-        $loader->load('security_abstract_services.yml');
-        $loader->load('event_listeners.yml');
-        $loader->load('serializer.yml');
-        $loader->load('export.yml');
-        $loader->load('aliases.yml');
-        $container->setParameter('pimcore.gdpr-data-extrator.dataobjects', $config['gdpr_data_extractor']['dataObjects']);
-        $container->setParameter('pimcore.gdpr-data-extrator.assets', $config['gdpr_data_extractor']['assets']);
-        $container->setParameter(self::PARAM_DATAOBJECTS_NOTES_EVENTS_TYPES, $config['objects']['notes_events']['types']);
-        $container->setParameter(self::PARAM_ASSETS_NOTES_EVENTS_TYPES, $config['assets']['notes_events']['types']);
-        $container->setParameter(self::PARAM_DOCUMENTS_NOTES_EVENTS_TYPES, $config['documents']['notes_events']['types']);
-        $container->setParameter('pimcore_admin.csrf_protection.excluded_routes', $config['csrf_protection']['excluded_routes']);
-        $container->setParameter('pimcore_admin.admin_languages', $config['admin_languages']);
-        $container->setParameter('pimcore_admin.custom_admin_path_identifier', $config['custom_admin_path_identifier']);
-        $container->setParameter('pimcore_admin.config', $config);
-    }
-}

--- a/bundles/AdminBundle/EventListener/AdminAuthenticationDoubleCheckListener.php
+++ b//dev/null
@@ -1,154 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\AdminBundle\Controller\DoubleAuthenticationControllerInterface;
-use Pimcore\Bundle\AdminBundle\EventListener\Traits\ControllerTypeTrait;
-use Pimcore\Bundle\AdminBundle\Security\User\TokenStorageUserResolver;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Pimcore\Http\RequestMatcherFactory;
-use Pimcore\Tool\Authentication;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\RequestMatcherInterface;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Exception\AccessDeniedHttpException;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * Handles double authentication check for pimcore controllers after the firewall did to make sure the admin interface is
- * not accessible on configuration errors. Unauthenticated routes are not double-checked (e.g. login).
- *
- * @internal
- */
-class AdminAuthenticationDoubleCheckListener implements EventSubscriberInterface
-{
-    use ControllerTypeTrait;
-    use PimcoreContextAwareTrait;
-    /**
-     * @var RequestMatcherFactory
-     */
-    protected $requestMatcherFactory;
-    /**
-     * @var array
-     */
-    protected $unauthenticatedRoutes;
-    /**
-     * @var RequestMatcherInterface[]
-     */
-    protected $unauthenticatedMatchers;
-    /**
-     * @var TokenStorageUserResolver
-     */
-    protected $tokenResolver;
-    /**
-     * @param RequestMatcherFactory $factory
-     * @param TokenStorageUserResolver $tokenResolver
-     * @param array $unauthenticatedRoutes
-     */
-    public function __construct(
-        RequestMatcherFactory $factory,
-        TokenStorageUserResolver $tokenResolver,
-        array $unauthenticatedRoutes
-    ) {
-        $this->requestMatcherFactory = $factory;
-        $this->tokenResolver = $tokenResolver;
-        $this->unauthenticatedRoutes = $unauthenticatedRoutes;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::CONTROLLER => 'onKernelController',
-        ];
-    }
-    public function onKernelController(ControllerEvent $event)
-    {
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        $request = $event->getRequest();
-        $isDoubleAuthController = $this->isControllerType($event, DoubleAuthenticationControllerInterface::class);
-        $isPimcoreAdminContext = $this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN);
-        if (!$isDoubleAuthController && !$isPimcoreAdminContext) {
-            return;
-        }
-        if ($this->requestNeedsAuthentication($request)) {
-            if ($isDoubleAuthController) {
-                /** @var DoubleAuthenticationControllerInterface $controller */
-                $controller = $this->getControllerType($event, DoubleAuthenticationControllerInterface::class);
-                if ($controller->needsSessionDoubleAuthenticationCheck()) {
-                    $this->checkSessionUser();
-                }
-                if ($controller->needsStorageDoubleAuthenticationCheck()) {
-                    $this->checkTokenStorageUser();
-                }
-            } else {
-                $this->checkSessionUser();
-                $this->checkTokenStorageUser();
-            }
-        }
-    }
-    /**
-     * Check if the current request needs double authentication
-     *
-     * @param Request $request
-     *
-     * @return bool
-     */
-    protected function requestNeedsAuthentication(Request $request)
-    {
-        foreach ($this->getUnauthenticatedMatchers() as $matcher) {
-            if ($matcher->matches($request)) {
-                return false;
-            }
-        }
-        return true;
-    }
-    /**
-     * Get list of paths which don't need double authentication check
-     *
-     * @return RequestMatcherInterface[]
-     */
-    protected function getUnauthenticatedMatchers()
-    {
-        if (null === $this->unauthenticatedMatchers) {
-            $this->unauthenticatedMatchers = $this->requestMatcherFactory->buildRequestMatchers($this->unauthenticatedRoutes);
-        }
-        return $this->unauthenticatedMatchers;
-    }
-    /**
-     * @throws AccessDeniedHttpException
-     *      if there's no current user in the session
-     */
-    protected function checkSessionUser()
-    {
-        $user = Authentication::authenticateSession();
-        if (null === $user) {
-            throw new AccessDeniedHttpException('User is invalid.');
-        }
-    }
-    /**
-     * @throws AccessDeniedHttpException
-     *      if there's no current user in the token storage
-     */
-    protected function checkTokenStorageUser()
-    {
-        $user = $this->tokenResolver->getUser();
-        if (null === $user || !Authentication::isValidUser($user)) {
-            throw new AccessDeniedHttpException('User is invalid.');
-        }
-    }
-}

--- a/bundles/AdminBundle/EventListener/AdminExceptionListener.php
+++ b//dev/null
@@ -1,136 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Doctrine\DBAL\Exception as DBALException;
-use Pimcore\Bundle\AdminBundle\HttpFoundation\JsonResponse;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Pimcore\Model\Element\ValidationException;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ExceptionEvent;
-use Symfony\Component\HttpKernel\Exception\HttpExceptionInterface;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class AdminExceptionListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents(): array
-    {
-        return [
-            KernelEvents::EXCEPTION => 'onKernelException',
-        ];
-    }
-    /**
-     * @param ExceptionEvent $event
-     */
-    public function onKernelException(ExceptionEvent $event)
-    {
-        $request = $event->getRequest();
-        $ex = $event->getThrowable();
-        if ($this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            if (!$request->isXmlHttpRequest()) {
-                return;
-            }
-            list($code, $headers, $message) = $this->getResponseData($ex);
-            $data = [
-                'success' => false,
-            ];
-            if (!\Pimcore::inDebugMode()) {
-                if ($ex instanceof DBALException) {
-                    $message = 'Database error, see logs for details';
-                }
-            }
-            if (\Pimcore::inDebugMode()) {
-                $data['trace'] = $ex->getTrace();
-                $data['traceString'] = 'in ' . $ex->getFile() . ':' . $ex->getLine() . "\n" . $ex->getTraceAsString();
-            }
-            if ($ex instanceof ValidationException) {
-                $data['type'] = 'ValidationException';
-                $code = 422;
-                $this->recursiveAddValidationExceptionSubItems($ex->getSubItems(), $message, $data['traceString']);
-            }
-            $data['message'] = $message;
-            $response = new JsonResponse($data, $code, $headers);
-            $event->setResponse($response);
-            return;
-        }
-    }
-    private function getResponseData(\Throwable $ex, int $defaultStatusCode = 500): array
-    {
-        $code = $defaultStatusCode;
-        $headers = [];
-        $message = $ex->getMessage();
-        if ($ex instanceof HttpExceptionInterface) {
-            if (empty($message)) {
-                $message = Response::$statusTexts[$ex->getStatusCode()];
-            }
-            $code = $ex->getStatusCode();
-            $headers = $ex->getHeaders();
-        }
-        return [$code, $headers, $message];
-    }
-    /**
-     * @param ValidationException[] $items
-     * @param string $message
-     * @param string $detailedInfo
-     */
-    protected function recursiveAddValidationExceptionSubItems($items, &$message, &$detailedInfo)
-    {
-        if (!$items) {
-            return;
-        }
-        foreach ($items as $e) {
-            if ($e->getMessage()) {
-                $message .= '<b>' . $e->getMessage() . '</b>';
-                $this->addContext($e, $message);
-                $message .= '<br>';
-                $detailedInfo .= '<br><b>Message:</b><br>';
-                $detailedInfo .= $e->getMessage() . '<br>';
-                $inner = $this->getInnerStack($e);
-                $detailedInfo .= '<br><b>Trace:</b> ' . $inner->getTraceAsString() . '<br>';
-            }
-            $this->recursiveAddValidationExceptionSubItems($e->getSubItems(), $message, $detailedInfo);
-        }
-    }
-    /**
-     * @param ValidationException $e
-     * @param string $message
-     */
-    protected function addContext(ValidationException $e, &$message)
-    {
-        $contextStack = $e->getContextStack();
-        if ($contextStack) {
-            $message = $message . ' (' . implode(',', $contextStack) . ')';
-        }
-    }
-    /**
-     * @param \Throwable $e
-     *
-     * @return \Throwable
-     */
-    protected function getInnerStack(\Throwable $e)
-    {
-        while ($e->getPrevious()) {
-            $e = $e->getPrevious();
-        }
-        return $e;
-    }
-}

--- a/bundles/AdminBundle/EventListener/BruteforceProtectionListener.php
+++ b//dev/null
@@ -1,73 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\AdminBundle\Controller\BruteforceProtectedControllerInterface;
-use Pimcore\Bundle\AdminBundle\Security\BruteforceProtectionHandler;
-use Pimcore\Bundle\AdminBundle\Security\Exception\BruteforceProtectionException;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-use Symfony\Component\HttpKernel\Event\ExceptionEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class BruteforceProtectionListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    /**
-     * @var BruteforceProtectionHandler
-     */
-    protected $handler;
-    /**
-     * @param BruteforceProtectionHandler $handler
-     */
-    public function __construct(BruteforceProtectionHandler $handler)
-    {
-        $this->handler = $handler;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::CONTROLLER => 'onKernelController',
-            KernelEvents::EXCEPTION => 'onKernelException',
-        ];
-    }
-    public function onKernelController(ControllerEvent $event)
-    {
-        $request = $event->getRequest();
-        if (!$this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            return;
-        }
-        $callable = $event->getController();
-        if (is_array($callable)) {
-            $controller = $callable[0];
-            if ($controller instanceof BruteforceProtectedControllerInterface) {
-                $this->handler->checkProtection($request->get('username'), $request);
-            }
-        }
-    }
-    public function onKernelException(ExceptionEvent $event)
-    {
-        $e = $event->getThrowable();
-        if ($e instanceof BruteforceProtectionException) {
-            $event->setResponse(new Response($e->getMessage()));
-        }
-    }
-}

--- a/bundles/AdminBundle/EventListener/CsrfProtectionListener.php
+++ b//dev/null
@@ -1,78 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\AdminBundle\Security\CsrfProtectionHandler;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\RequestEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-use Twig\Environment;
-/**
- * @internal
- */
-class CsrfProtectionListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    /**
-     * @var Environment
-     */
-    protected $twig;
-    /**
-     * @var CsrfProtectionHandler $handler
-     */
-    protected $csrfProtectionHandler;
-    /**
-     * @param CsrfProtectionHandler $csrfProtectionHandler
-     */
-    public function __construct(CsrfProtectionHandler $csrfProtectionHandler)
-    {
-        $this->csrfProtectionHandler = $csrfProtectionHandler;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::REQUEST => ['handleRequest', 11],
-        ];
-    }
-    /**
-     * @param RequestEvent $event
-     */
-    public function handleRequest(RequestEvent $event)
-    {
-        $request = $event->getRequest();
-        if (!$this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            return;
-        }
-        $this->csrfProtectionHandler->generateCsrfToken();
-        if ($request->getMethod() == Request::METHOD_GET) {
-            return;
-        }
-        $exludedRoutes = [
-            'pimcore_admin_webdav',
-            'pimcore_admin_external_opcache_index',
-            'pimcore_admin_external_adminer_adminer', 'pimcore_admin_external_adminer_proxy',
-            'pimcore_admin_external_adminer_proxy_1', 'pimcore_admin_external_adminer_proxy_2',
-        ];
-        $route = $request->attributes->get('_route');
-        if (in_array($route, $exludedRoutes) || in_array($route, $this->csrfProtectionHandler->getExcludedRoutes())) {
-            return;
-        }
-        $this->csrfProtectionHandler->checkCsrfToken($request);
-    }
-}

--- a/bundles/AdminBundle/EventListener/CustomAdminEntryPointCheckListener.php
+++ b//dev/null
@@ -1,54 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\RequestEvent;
-use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class CustomAdminEntryPointCheckListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    protected $customAdminPathIdentifier;
-    public function __construct(?string $customAdminPathIdentifier)
-    {
-        $this->customAdminPathIdentifier = $customAdminPathIdentifier;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents(): array
-    {
-        return [
-            KernelEvents::REQUEST => ['onKernelRequest', 560],
-        ];
-    }
-    /**
-     * @param RequestEvent $event
-     */
-    public function onKernelRequest(RequestEvent $event)
-    {
-        $request = $event->getRequest();
-        if ($event->isMasterRequest() && $this->customAdminPathIdentifier && $this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            if ($this->customAdminPathIdentifier !== $request->cookies->get('pimcore_custom_admin')) {
-                throw new NotFoundHttpException();
-            }
-        }
-    }
-}

--- a/bundles/AdminBundle/EventListener/EnablePreviewTimeSliderListener.php
+++ b//dev/null
@@ -1,97 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\ResponseInjectionTrait;
-use Pimcore\Http\Request\Resolver\DocumentResolver;
-use Pimcore\Http\Request\Resolver\EditmodeResolver;
-use Pimcore\Http\Request\Resolver\OutputTimestampResolver;
-use Pimcore\Http\RequestHelper;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\ResponseEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class EnablePreviewTimeSliderListener implements EventSubscriberInterface
-{
-    use ResponseInjectionTrait;
-    /**
-     * @var OutputTimestampResolver
-     */
-    protected $outputTimestampResolver;
-    /**
-     * @var RequestHelper
-     */
-    protected $requestHelper;
-    /**
-     * @var EditmodeResolver
-     */
-    protected $editmodeResolver;
-    /**
-     * @var DocumentResolver
-     */
-    protected $documentResolver;
-    public function __construct(OutputTimestampResolver $outputTimestampResolver, RequestHelper $requestHelper, EditmodeResolver $editmodeResolver, DocumentResolver $documentResolver)
-    {
-        $this->outputTimestampResolver = $outputTimestampResolver;
-        $this->requestHelper = $requestHelper;
-        $this->editmodeResolver = $editmodeResolver;
-        $this->documentResolver = $documentResolver;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::RESPONSE => 'onKernelResponse',
-        ];
-    }
-    public function onKernelResponse(ResponseEvent $event)
-    {
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        if (!$this->outputTimestampResolver->timestampWasQueried()) {
-            return;
-        }
-        $request = $event->getRequest();
-        if ($this->editmodeResolver->isEditmode($request)) {
-            return;
-        }
-        if (!$this->requestHelper->isFrontendRequestByAdmin($request)) {
-            return;
-        }
-        $response = $event->getResponse();
-        if (!$this->isHtmlResponse($response)) {
-            return;
-        }
-        $documentId = 0;
-        $document = $this->documentResolver->getDocument($request);
-        if ($document) {
-            $documentId = $document->getId();
-        }
-        $code = '
-            <script>
-                var documentId = ' . $documentId . ";
-                var documentTab = top.pimcore.globalmanager.get('document_' + documentId);
-                if(documentTab && documentTab.preview) {
-                    documentTab.preview.showTimeSlider();
-                }
-            </script>
-        ";
-        $this->injectBeforeHeadEnd($response, $code);
-    }
-}

--- a/bundles/AdminBundle/EventListener/GridConfigListener.php
+++ b//dev/null
@@ -1,88 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Db;
-use Pimcore\Event\DataObjectClassDefinitionEvents;
-use Pimcore\Event\DataObjectEvents;
-use Pimcore\Event\Model\DataObject\ClassDefinitionEvent;
-use Pimcore\Event\Model\DataObjectEvent;
-use Pimcore\Event\Model\UserRoleEvent;
-use Pimcore\Event\UserRoleEvents;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-/**
- * @internal
- */
-class GridConfigListener implements EventSubscriberInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            DataObjectClassDefinitionEvents::POST_DELETE => 'onClassDelete',
-            UserRoleEvents::POST_DELETE => 'onUserDelete',
-            DataObjectEvents::POST_DELETE => 'onObjectDelete',
-        ];
-    }
-    /**
-     * @param DataObjectEvent $event
-     */
-    public function onObjectDelete($event)
-    {
-        $object = $event->getObject();
-        $objectId = $object->getId();
-        $this->cleanupGridConfigFavourites('objectId = ' . $objectId);
-    }
-    /**
-     * @param ClassDefinitionEvent $event
-     */
-    public function onClassDelete($event)
-    {
-        $class = $event->getClassDefinition();
-        $classId = $class->getId();
-        $db = Db::get();
-        $gridConfigIds = $db->fetchCol('select id from gridconfigs where classId = ?', $classId);
-        if ($gridConfigIds) {
-            $db->query('delete from gridconfig_shares where gridConfigId in (' . implode($gridConfigIds) . ')');
-        }
-        $this->cleanupGridConfigs('classId = ' . $db->quote($classId));
-        $this->cleanupGridConfigFavourites('classId = ' . $db->quote($classId));
-    }
-    /**
-     * @param UserRoleEvent $event
-     */
-    public function onUserDelete($event)
-    {
-        $user = $event->getUserRole();
-        $userId = $user->getId();
-        $db = Db::get();
-        $gridConfigIds = $db->fetchCol('select id from gridconfigs where ownerId = ' . $userId);
-        if ($gridConfigIds) {
-            $db->query('delete from gridconfig_shares where gridConfigId in (' . implode($gridConfigIds) . ')');
-        }
-        $this->cleanupGridConfigs('ownerId = ' . $userId);
-        $this->cleanupGridConfigFavourites('ownerId = ' . $userId);
-    }
-    protected function cleanupGridConfigs($condition)
-    {
-        $db = Db::get();
-        $db->query('DELETE FROM gridconfigs where ' . $condition);
-    }
-    protected function cleanupGridConfigFavourites($condition)
-    {
-        $db = Db::get();
-        $db->query('DELETE FROM gridconfig_favourites where ' . $condition);
-    }
-}

--- a/bundles/AdminBundle/EventListener/HttpCacheListener.php
+++ b//dev/null
@@ -1,76 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Pimcore\Http\RequestHelper;
-use Pimcore\Http\ResponseHelper;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpKernel\Event\ResponseEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class HttpCacheListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    /**
-     * @var RequestHelper
-     */
-    protected $requestHelper;
-    /**
-     * @var ResponseHelper
-     */
-    protected $responseHelper;
-    /**
-     * @param RequestHelper $requestHelper
-     * @param ResponseHelper $responseHelper
-     */
-    public function __construct(RequestHelper $requestHelper, ResponseHelper $responseHelper)
-    {
-        $this->requestHelper = $requestHelper;
-        $this->responseHelper = $responseHelper;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::RESPONSE => 'onKernelResponse',
-        ];
-    }
-    public function onKernelResponse(ResponseEvent $event)
-    {
-        $request = $event->getRequest();
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        $disable = false;
-        if ($this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            $disable = true;
-        } else {
-            if ($this->requestHelper->isFrontendRequestByAdmin($request)) {
-                $disable = true;
-            }
-            if (\Pimcore::inDebugMode()) {
-                $disable = true;
-            }
-        }
-        $response = $event->getResponse();
-        if ($disable) {
-            $this->responseHelper->disableCache($response, false);
-        }
-    }
-}

--- a/bundles/AdminBundle/EventListener/ImportConfigListener.php
+++ b//dev/null
@@ -1,69 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Db;
-use Pimcore\Event\DataObjectClassDefinitionEvents;
-use Pimcore\Event\Model\DataObject\ClassDefinitionEvent;
-use Pimcore\Event\Model\UserRoleEvent;
-use Pimcore\Event\UserRoleEvents;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-/**
- * @internal
- */
-class ImportConfigListener implements EventSubscriberInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            DataObjectClassDefinitionEvents::POST_DELETE => 'onClassDelete',
-            UserRoleEvents::POST_DELETE => 'onUserDelete',
-        ];
-    }
-    /**
-     * @param ClassDefinitionEvent $event
-     */
-    public function onClassDelete($event)
-    {
-        $class = $event->getClassDefinition();
-        $classId = $class->getId();
-        $db = Db::get();
-        $importConfigIds = $db->fetchCol('select id from importconfigs where classId = ?', $classId);
-        if ($importConfigIds) {
-            $db->query('delete from importconfig_shares where importConfigId in (' . implode($importConfigIds) . ')');
-        }
-        $this->cleanupImportConfigs('classId = ' . $db->quote($classId));
-    }
-    /**
-     * @param UserRoleEvent $event
-     */
-    public function onUserDelete($event)
-    {
-        $user = $event->getUserRole();
-        $userId = $user->getId();
-        $db = Db::get();
-        $importConfigIds = $db->fetchCol('select id from importconfigs where ownerId = ' . $userId);
-        if ($importConfigIds) {
-            $db->query('delete from importconfig_shares where importConfigId in (' . implode($importConfigIds) . ')');
-        }
-        $this->cleanupImportConfigs('ownerId = ' . $userId);
-    }
-    protected function cleanupImportConfigs($condition)
-    {
-        $db = Db::get();
-        $db->query('DELETE FROM importconfigs where ' . $condition);
-    }
-}

--- a/bundles/AdminBundle/EventListener/Traits/ControllerTypeTrait.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener\Traits;
-use Symfony\Component\HttpKernel\Event\ControllerEvent;
-/**
- * @internal
- */
-trait ControllerTypeTrait
-{
-    /**
-     * Get controller of specified type
-     *
-     * @param ControllerEvent $event
-     * @param string $type
-     *
-     * @return mixed
-     */
-    protected function getControllerType(ControllerEvent $event, $type)
-    {
-        $callable = $event->getController();
-        if (!is_array($callable) || count($callable) === 0) {
-            return null;
-        }
-        $controller = $callable[0];
-        if ($controller instanceof $type) {
-            return $controller;
-        }
-    }
-    /**
-     * Test if event controller is of the given type
-     *
-     * @param ControllerEvent $event
-     * @param string $type
-     *
-     * @return bool
-     */
-    protected function isControllerType(ControllerEvent $event, $type)
-    {
-        $controller = $this->getControllerType($event, $type);
-        return $controller && $controller instanceof $type;
-    }
-}

--- a/bundles/AdminBundle/EventListener/TwoFactorListener.php
+++ b//dev/null
@@ -1,68 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Tool\Session;
-use Psr\Log\LoggerAwareTrait;
-use Scheb\TwoFactorBundle\Security\Authentication\Token\TwoFactorTokenInterface;
-use Scheb\TwoFactorBundle\Security\TwoFactor\Event\TwoFactorAuthenticationEvent;
-use Scheb\TwoFactorBundle\Security\TwoFactor\Provider\PreparationRecorderInterface;
-use Scheb\TwoFactorBundle\Security\TwoFactor\Provider\TwoFactorProviderRegistry;
-use Symfony\Component\HttpFoundation\Session\Attribute\AttributeBagInterface;
-/**
- * @internal
- */
-class TwoFactorListener
-{
-    use LoggerAwareTrait;
-    /**
-     * @var TwoFactorProviderRegistry
-     */
-    private $providerRegistry;
-    /**
-     * @var PreparationRecorderInterface
-     */
-    private $preparationRecorder;
-    public function __construct(TwoFactorProviderRegistry $providerRegistry, PreparationRecorderInterface $preparationRecorder)
-    {
-        $this->providerRegistry = $providerRegistry;
-        $this->preparationRecorder = $preparationRecorder;
-    }
-    public function onAuthenticationComplete(TwoFactorAuthenticationEvent $event)
-    {
-        Session::useSession(function (AttributeBagInterface $adminSession) {
-            $adminSession->set('2fa_required', false);
-        });
-    }
-    public function onAuthenticationAttempt(TwoFactorAuthenticationEvent $event)
-    {
-        $twoFactorToken = $event->getToken();
-        if (!$twoFactorToken instanceof TwoFactorTokenInterface) {
-            return;
-        }
-        $providerName = $twoFactorToken->getCurrentTwoFactorProvider();
-        if (null === $providerName) {
-            return;
-        }
-        $twoFactorToken->setTwoFactorProviderPrepared($providerName);
-        $firewallName = $twoFactorToken->getProviderKey();
-        if ($this->preparationRecorder->isTwoFactorProviderPrepared($firewallName, $providerName)) {
-            $this->logger->info(sprintf('Two-factor provider "%s" was already prepared.', $providerName));
-            return;
-        }
-        $user = $twoFactorToken->getUser();
-        $this->providerRegistry->getProvider($providerName)->prepareAuthentication($user);
-        $this->preparationRecorder->setTwoFactorProviderPrepared($firewallName, $providerName);
-        $this->logger->info(sprintf('Two-factor provider "%s" prepared.', $providerName));
-    }
-}

--- a/bundles/AdminBundle/EventListener/UsageStatisticsListener.php
+++ b//dev/null
@@ -1,116 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\AdminBundle\Security\User\TokenStorageUserResolver;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Config;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Pimcore\Log\Simple;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\RequestEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class UsageStatisticsListener implements EventSubscriberInterface
-{
-    use PimcoreContextAwareTrait;
-    /**
-     * @var TokenStorageUserResolver
-     */
-    protected $userResolver;
-    /**
-     * @var Config
-     */
-    protected $config;
-    /**
-     * @param TokenStorageUserResolver $userResolver
-     */
-    public function __construct(TokenStorageUserResolver $userResolver, Config $config)
-    {
-        $this->userResolver = $userResolver;
-        $this->config = $config;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::REQUEST => 'onKernelRequest',
-        ];
-    }
-    public function onKernelRequest(RequestEvent $event)
-    {
-        $request = $event->getRequest();
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        if (!$this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            return;
-        }
-        $this->logUsageStatistics($request);
-    }
-    /**
-     * @param Request $request
-     */
-    protected function logUsageStatistics(Request $request)
-    {
-        if (!empty($this->config['general']['disable_usage_statistics'])) {
-            return;
-        }
-        $params = $this->getParams($request);
-        $user = $this->userResolver->getUser();
-        $parts = [
-            $user ? $user->getId() : '0',
-            $request->attributes->get('_controller'),
-            $request->attributes->get('_route'),
-            @json_encode($request->attributes->get('_route_params')),
-            @json_encode($params),
-        ];
-        Simple::log('usagelog', implode('|', $parts));
-    }
-    /**
-     * @param Request $request
-     *
-     * @return array
-     */
-    protected function getParams(Request $request)
-    {
-        $params = [];
-        $disallowedKeys = ['_dc', 'module', 'controller', 'action', 'password'];
-        $requestParams = array_merge(
-            $request->query->all(),
-            $request->request->all()
-        );
-        foreach ($requestParams as $key => $value) {
-            if (is_json($value)) {
-                $value = json_decode($value);
-                if (is_array($value)) {
-                    array_walk_recursive($value, function (&$item, $key) {
-                        if (strpos($key, 'pass') !== false) {
-                            $item = '*************';
-                        }
-                    });
-                }
-                $value = json_encode($value);
-            }
-            if (!in_array($key, $disallowedKeys) && is_string($value)) {
-                $params[$key] = (strlen($value) > 40) ? substr($value, 0, 40) . '...' : $value;
-            }
-        }
-        return $params;
-    }
-}

--- a/bundles/AdminBundle/EventListener/UserPerspectiveListener.php
+++ b//dev/null
@@ -1,112 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\EventListener;
-use Pimcore\Bundle\AdminBundle\Security\User\TokenStorageUserResolver;
-use Pimcore\Bundle\CoreBundle\EventListener\Traits\PimcoreContextAwareTrait;
-use Pimcore\Config;
-use Pimcore\Http\Request\Resolver\PimcoreContextResolver;
-use Pimcore\Model\User;
-use Psr\Log\LoggerAwareInterface;
-use Psr\Log\LoggerAwareTrait;
-use Symfony\Component\EventDispatcher\EventSubscriberInterface;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpKernel\Event\RequestEvent;
-use Symfony\Component\HttpKernel\KernelEvents;
-/**
- * @internal
- */
-class UserPerspectiveListener implements EventSubscriberInterface, LoggerAwareInterface
-{
-    use LoggerAwareTrait;
-    use PimcoreContextAwareTrait;
-    /**
-     * @var TokenStorageUserResolver
-     */
-    protected $userResolver;
-    /**
-     * @param TokenStorageUserResolver $userResolver
-     */
-    public function __construct(TokenStorageUserResolver $userResolver)
-    {
-        $this->userResolver = $userResolver;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public static function getSubscribedEvents()
-    {
-        return [
-            KernelEvents::REQUEST => 'onKernelRequest',
-        ];
-    }
-    public function onKernelRequest(RequestEvent $event)
-    {
-        $request = $event->getRequest();
-        if (!$event->isMasterRequest()) {
-            return;
-        }
-        if (!$this->matchesPimcoreContext($request, PimcoreContextResolver::CONTEXT_ADMIN)) {
-            return;
-        }
-        if ($user = $this->userResolver->getUser()) {
-            $this->setRequestedPerspective($user, $request);
-        }
-    }
-    /**
-     * @param User $user
-     * @param Request $request
-     */
-    protected function setRequestedPerspective(User $user, Request $request)
-    {
-        $requestedPerspective = $request->get('perspective');
-        if ($requestedPerspective) {
-            if ($requestedPerspective !== $user->getActivePerspective()) {
-                $existingPerspectives = array_keys(Config::getPerspectivesConfig()->toArray());
-                if (!in_array($requestedPerspective, $existingPerspectives)) {
-                    $this->logger->warning('Requested perspective {perspective} for {user} is not does not exist.', [
-                        'user' => $user->getName(),
-                        'perspective' => $requestedPerspective,
-                    ]);
-                    $requestedPerspective = null;
-                }
-            }
-        }
-        if (!$requestedPerspective || !$user->isAllowed($requestedPerspective, 'perspective')) {
-            $previouslyRequested = $requestedPerspective;
-            $requestedPerspective = $user->isAllowed($user->getActivePerspective(), 'perspective')
-                ? $user->getActivePerspective()
-                : $user->getFirstAllowedPerspective();
-            if (null !== $previouslyRequested) {
-                $this->logger->warning('User {user} is not allowed requested perspective {requestedPerspective}. Falling back to {perspective}.', [
-                    'user' => $user->getName(),
-                    'requestedPerspective' => $previouslyRequested,
-                    'perspective' => $requestedPerspective,
-                ]);
-            } else {
-                $this->logger->debug('Perspective for user {user} was not requested. Falling back to {perspective}.', [
-                    'user' => $user->getName(),
-                    'perspective' => $requestedPerspective,
-                ]);
-            }
-        }
-        if ($requestedPerspective !== $user->getActivePerspective()) {
-            $this->logger->info('Setting active perspective for user {user} to {perspective}.', [
-                'user' => $user->getName(),
-                'perspective' => $requestedPerspective,
-            ]);
-            $user->setActivePerspective($requestedPerspective);
-            $user->save();
-        }
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/Assets.php
+++ b//dev/null
@@ -1,165 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-use Pimcore\Db;
-use Pimcore\Model\Asset;
-use Pimcore\Model\Element\Service;
-use Pimcore\Model\Search\Backend\Data;
-use Symfony\Component\HttpFoundation\Response;
-/**
- * @internal
- */
-class Assets extends Elements implements DataProviderInterface
-{
-    /**
-     * @var bool[]
-     */
-    protected $exportIds = [];
-    /**
-     * @var array
-     */
-    protected $config = [];
-    public function __construct(array $config = null)
-    {
-        $this->config = $config;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getName(): string
-    {
-        return 'assets';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getJsClassName(): string
-    {
-        return 'pimcore.settings.gdpr.dataproviders.assets';
-    }
-    /**
-     * Exports data of given asset as json
-     *
-     * @param Asset $asset
-     *
-     * @return Response
-     */
-    public function doExportData(Asset $asset)
-    {
-        $this->exportIds = [];
-        $this->exportIds[$asset->getId()] = true;
-        $file = tempnam('/tmp', 'zip');
-        $zip = new \ZipArchive();
-        $zip->open($file, \ZipArchive::OVERWRITE);
-        foreach (array_keys($this->exportIds) as $id) {
-            $theAsset = Asset::getById($id);
-            $resultItem = Exporter::exportAsset($theAsset);
-            $resultItem = json_encode($resultItem);
-            $zip->addFromString($asset->getFilename() . '.txt', $resultItem);
-            if (!$theAsset instanceof Asset\Folder) {
-                $zip->addFromString($theAsset->getFilename(), $theAsset->getData());
-            }
-        }
-        $zip->close();
-        $size = filesize($file);
-        $content = file_get_contents($file);
-        unlink($file);
-        $response = new Response($content);
-        $response->headers->set('Content-Type', 'application/zip');
-        $response->headers->set('Content-Length', $size);
-        $response->headers->set('Content-Disposition', 'attachment; filename="' . $asset->getFilename() . '.zip"');
-        return $response;
-    }
-    /**
-     * @param int $id
-     * @param string $firstname
-     * @param string $lastname
-     * @param string $email
-     * @param int $start
-     * @param int $limit
-     * @param string|null $sort
-     *
-     * @return array
-     */
-    public function searchData(int $id, string $firstname, string $lastname, string $email, int $start, int $limit, string $sort = null): array
-    {
-        if (empty($id) && empty($firstname) && empty($lastname) && empty($email)) {
-            return ['data' => [], 'success' => true, 'total' => 0];
-        }
-        $offset = $start;
-        $offset = $offset ?: 0;
-        $limit = $limit ?: 50;
-        $searcherList = new Data\Listing();
-        $conditionParts = [];
-        $db = \Pimcore\Db::get();
-        if ($id) {
-            $conditionParts[] = '( MATCH (`data`,`properties`) AGAINST (+"' . $id . '" IN BOOLEAN MODE) )';
-        }
-        if ($firstname || $lastname || $email) {
-            $firstname = $this->prepareQueryString($firstname);
-            $lastname = $this->prepareQueryString($lastname);
-            $email = $this->prepareQueryString($email);
-            $queryString = ($firstname ? '+"' . $firstname . '"' : '') . ' ' . ($lastname ? '+"' . $lastname . '"' : '') . ' ' . ($email ? '+"' . $email . '"' : '');
-            $conditionParts[] = '( MATCH (`data`,`properties`) AGAINST ("' . $db->quote($queryString) . '" IN BOOLEAN MODE) )';
-        }
-        $db = Db::get();
-        $typesPart = '';
-        if ($this->config['types']) {
-            $typesList = [];
-            foreach ($this->config['types'] as $type) {
-                $typesList[] = $db->quote($type);
-            }
-            $typesPart = ' AND type IN (' . implode(',', $typesList) . ')';
-        }
-        $conditionParts[] = '( maintype = "asset" ' . $typesPart . ')';
-        $condition = implode(' AND ', $conditionParts);
-        $searcherList->setCondition($condition);
-        $searcherList->setOffset($offset);
-        $searcherList->setLimit($limit);
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(['sort' => $sort]);
-        if ($sortingSettings['orderKey']) {
-            $sortMapping = [
-                'type' => 'subtype',
-            ];
-            $sort = $sortingSettings['orderKey'];
-            if (array_key_exists($sortingSettings['orderKey'], $sortMapping)) {
-                $sort = $sortMapping[$sortingSettings['orderKey']];
-            }
-            $searcherList->setOrderKey($sort);
-        }
-        if ($sortingSettings['order']) {
-            $searcherList->setOrder($sortingSettings['order']);
-        }
-        $hits = $searcherList->load();
-        $elements = [];
-        foreach ($hits as $hit) {
-            $element = Service::getElementById($hit->getId()->getType(), $hit->getId()->getId());
-            if ($element instanceof Asset) {
-                $data = \Pimcore\Model\Asset\Service::gridAssetData($element);
-                $data['permissions'] = $element->getUserPermissions();
-                $elements[] = $data;
-            }
-        }
-        $totalMatches = $searcherList->getTotalCount();
-        return ['data' => $elements, 'success' => true, 'total' => $totalMatches];
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getSortPriority(): int
-    {
-        return 20;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/DataObjects.php
+++ b//dev/null
@@ -1,193 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject\AbstractObject;
-use Pimcore\Model\DataObject\Concrete;
-use Pimcore\Model\DataObject\Data\ElementMetadata;
-use Pimcore\Model\DataObject\Data\ObjectMetadata;
-use Pimcore\Model\Element\ElementInterface;
-use Pimcore\Model\Element\Service;
-use Pimcore\Model\Search\Backend\Data;
-/**
- * @internal
- */
-class DataObjects extends Elements implements DataProviderInterface
-{
-    /**
-     * @var array
-     */
-    protected $exportIds = [];
-    /**
-     * @var array
-     */
-    protected $config = [];
-    public function __construct(array $config)
-    {
-        $this->config = $config;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getName(): string
-    {
-        return 'dataObjects';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getJsClassName(): string
-    {
-        return 'pimcore.settings.gdpr.dataproviders.dataObjects';
-    }
-    /**
-     * Exports data of given object as json including all references that are configured to be included
-     *
-     * @param AbstractObject $object
-     *
-     * @return array
-     */
-    public function doExportData(AbstractObject $object): array
-    {
-        $this->exportIds = [];
-        $this->fillIds($object);
-        $exportResult = [];
-        if (!empty($this->exportIds['object'])) {
-            foreach (array_keys($this->exportIds['object']) as $id) {
-                $object = AbstractObject::getById($id);
-                $exportResult[] = Exporter::exportObject($object);
-            }
-        }
-        if (!empty($this->exportIds['image'])) {
-            foreach (array_keys($this->exportIds['image']) as $id) {
-                $theAsset = Asset::getById($id);
-                $exportResult[] = Exporter::exportAsset($theAsset);
-            }
-        }
-        return $exportResult;
-    }
-    protected function fillIds(ElementInterface $element)
-    {
-        $this->exportIds[$element->getType()][$element->getId()] = true;
-        if ($element instanceof Concrete) {
-            $subFields = $this->config['classes'][$element->getClass()->getName()]['includedRelations'] ?? [];
-            if ($subFields) {
-                foreach ($subFields as $field) {
-                    $getter = 'get' . ucfirst($field);
-                    $subElements = $element->$getter();
-                    if ($subElements) {
-                        if (!is_array($subElements)) {
-                            $subElements = [$subElements];
-                        }
-                        foreach ($subElements as $subElement) {
-                            if ($subElement instanceof ObjectMetadata) {
-                                $subElement = $subElement->getObject();
-                            } elseif ($subElement instanceof ElementMetadata) {
-                                $subElement = $subElement->getElement();
-                            }
-                            $this->fillIds($subElement);
-                        }
-                    }
-                }
-            }
-        }
-    }
-    /**
-     * @param int $id
-     * @param string $firstname
-     * @param string $lastname
-     * @param string $email
-     * @param int $start
-     * @param int $limit
-     * @param string|null $sort
-     *
-     * @return array
-     */
-    public function searchData(int $id, string $firstname, string $lastname, string $email, int $start, int $limit, string $sort = null): array
-    {
-        if (empty($id) && empty($firstname) && empty($lastname) && empty($email)) {
-            return ['data' => [], 'success' => true, 'total' => 0];
-        }
-        $offset = $start;
-        $offset = $offset ?: 0;
-        $limit = $limit ?: 50;
-        $searcherList = new Data\Listing();
-        $conditionParts = [];
-        $db = \Pimcore\Db::get();
-        if ($id) {
-            $conditionParts[] = '( MATCH (`data`,`properties`) AGAINST (+"' . $id . '" IN BOOLEAN MODE) )';
-        }
-        if ($firstname || $lastname || $email) {
-            $firstname = $this->prepareQueryString($firstname);
-            $lastname = $this->prepareQueryString($lastname);
-            $email = $this->prepareQueryString($email);
-            $queryString = ($firstname ? '+"' . $firstname . '"' : '') . ' ' . ($lastname ? '+"' . $lastname . '"' : '') . ' ' . ($email ? '+"' . $email . '"' : '');
-            $conditionParts[] = '( MATCH (`data`,`properties`) AGAINST ("' . $db->quote($queryString) . '" IN BOOLEAN MODE) )';
-        }
-        $conditionParts[] = '( maintype = "object" AND type IN ("object", "variant") )';
-        $classnames = [];
-        if ($this->config['classes']) {
-            foreach ($this->config['classes'] as $classname => $classConfig) {
-                if ($classConfig['include'] == true) {
-                    $classnames[] = $classname;
-                }
-            }
-        }
-        if (is_array($classnames) and !empty($classnames[0])) {
-            $conditionClassnameParts = [];
-            foreach ($classnames as $classname) {
-                $conditionClassnameParts[] = $db->quote($classname);
-            }
-            $conditionParts[] = '( subtype IN (' . implode(',', $conditionClassnameParts) . ') )';
-        }
-        $condition = implode(' AND ', $conditionParts);
-        $searcherList->setCondition($condition);
-        $searcherList->setOffset($offset);
-        $searcherList->setLimit($limit);
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(['sort' => $sort]);
-        if ($sortingSettings['orderKey']) {
-            $sortMapping = [
-                'classname' => 'subtype',
-            ];
-            $sort = $sortingSettings['orderKey'];
-            if (array_key_exists($sortingSettings['orderKey'], $sortMapping)) {
-                $sort = $sortMapping[$sortingSettings['orderKey']];
-            }
-            $searcherList->setOrderKey($sort);
-        }
-        if ($sortingSettings['order']) {
-            $searcherList->setOrder($sortingSettings['order']);
-        }
-        $hits = $searcherList->load();
-        $elements = [];
-        foreach ($hits as $hit) {
-            $element = Service::getElementById($hit->getId()->getType(), $hit->getId()->getId());
-            if ($element instanceof Concrete) {
-                $data = \Pimcore\Model\DataObject\Service::gridObjectData($element);
-                $data['__gdprIsDeletable'] = $this->config['classes'][$element->getClassName()]['allowDelete'] ?? false;
-                $elements[] = $data;
-            }
-        }
-        $totalMatches = $searcherList->getTotalCount();
-        return ['data' => $elements, 'success' => true, 'total' => $totalMatches];
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getSortPriority(): int
-    {
-        return 10;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/DataProviderInterface.php
+++ b//dev/null
@@ -1,36 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-interface DataProviderInterface
-{
-    /**
-     * Returns sort priority - higher is sorted first
-     *
-     * @return int
-     */
-    public function getSortPriority(): int;
-    /**
-     * Returns name of DataProvider
-     *
-     * @return string
-     */
-    public function getName(): string;
-    /**
-     * Returns JavaScript class name of frontend implementation
-     *
-     * @return string
-     */
-    public function getJsClassName(): string;
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/Elements.php
+++ b//dev/null
@@ -1,36 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-/**
- * @internal
- */
-abstract class Elements implements DataProviderInterface
-{
-    /**
-     * @param string $query
-     *
-     * @return string
-     */
-    protected function prepareQueryString($query): string
-    {
-        if ($query == '*') {
-            $query = '';
-        }
-        $query = str_replace('%', '*', $query);
-        $query = str_replace('@', '#', $query);
-        $query = preg_replace("@([^ ])\-@", '$1 ', $query);
-        return $query;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/Exporter.php
+++ b//dev/null
@@ -1,158 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-use Pimcore\Model\Asset;
-use Pimcore\Model\DataObject\AbstractObject;
-use Pimcore\Model\DataObject\ClassDefinition\Data;
-use Pimcore\Model\DataObject\Concrete;
-use Pimcore\Model\DataObject\Fieldcollection;
-use Pimcore\Model\DataObject\Objectbrick;
-use Pimcore\Normalizer\NormalizerInterface;
-/**
- * @internal
- */
-class Exporter
-{
-    /**
-     * @param Asset $theAsset
-     *
-     * @return array
-     */
-    public static function exportAsset(Asset $theAsset)
-    {
-        $webAsset = [];
-        $webAsset['id'] = $theAsset->getId();
-        $webAsset['fullpath'] = $theAsset->getRealFullPath();
-        $properties = $theAsset->getProperties();
-        $finalProperties = [];
-        foreach ($properties as $property) {
-            $finalProperties[] = $property->serialize();
-        }
-        $webAsset['properties'] = $finalProperties;
-        $webAsset['customSettings'] = $theAsset->getCustomSettings();
-        $resultItem = json_decode(json_encode($webAsset), true);
-        unset($resultItem['data']);
-        return $resultItem;
-    }
-    /**
-     * @param Concrete $object
-     * @param array $result
-     * @param Objectbrick $container
-     * @param Data\Objectbricks $brickFieldDef
-     */
-    public static function doExportBrick(Concrete $object, array &$result, Objectbrick $container, Data\Objectbricks $brickFieldDef)
-    {
-        $allowedBrickTypes = $container->getAllowedBrickTypes();
-        $resultContainer = [];
-        foreach ($allowedBrickTypes as $brickType) {
-            $brickDef = Objectbrick\Definition::getByKey($brickType);
-            $brickGetter = 'get' . ucfirst($brickType);
-            $brickValue = $container->$brickGetter();
-            if ($brickValue instanceof Objectbrick\Data\AbstractData) {
-                $resultContainer[$brickType] = [];
-                $fDefs = $brickDef->getFieldDefinitions();
-                foreach ($fDefs as $fd) {
-                    $getter = 'get' . ucfirst($fd->getName());
-                    $value = $brickValue->$getter();
-                    if ($fd instanceof NormalizerInterface) {
-                        $marshalledValue = $fd->normalize($value);
-                        $resultContainer[$brickType][$fd->getName()] = $marshalledValue;
-                    }
-                }
-            }
-        }
-        $result[$container->getFieldname()] = $resultContainer;
-    }
-    /**
-     * @param Concrete $object
-     * @param array $result
-     * @param Fieldcollection $container
-     * @param Data\Fieldcollections $containerDef
-     *
-     * @throws \Exception
-     */
-    public static function doExportFieldcollection(Concrete $object, array &$result, Fieldcollection $container, Data\Fieldcollections $containerDef)
-    {
-        $resultContainer = [];
-        $items = $container->getItems();
-        foreach ($items as $item) {
-            $type = $item->getType();
-            $itemValues = [];
-            $itemContainerDefinition = Fieldcollection\Definition::getByKey($type);
-            $fDefs = $itemContainerDefinition->getFieldDefinitions();
-            foreach ($fDefs as $fd) {
-                $getter = 'get' . ucfirst($fd->getName());
-                $value = $item->$getter();
-                if ($fd instanceof NormalizerInterface) {
-                    $marshalledValue = $fd->normalize($value);
-                    $itemValues[$fd->getName()] = $marshalledValue;
-                }
-            }
-            $resultContainer[] = [
-                'type' => $type,
-                'value' => $itemValues,
-            ];
-        }
-        $result[$container->getFieldname()] = $resultContainer;
-    }
-    /**
-     * @param Concrete $object
-     * @param array $result
-     *
-     * @throws \Exception
-     */
-    public static function doExportObject(Concrete $object, &$result = [])
-    {
-        $fDefs = $object->getClass()->getFieldDefinitions();
-        /** @var Data $fd */
-        foreach ($fDefs as $fd) {
-            $getter = 'get' . ucfirst($fd->getName());
-            $value = $object->$getter();
-            if ($fd instanceof Data\Fieldcollections) {
-                self::doExportFieldcollection($object, $result, $value, $fd);
-            } elseif ($fd instanceof Data\Objectbricks) {
-                self::doExportBrick($object, $result, $value, $fd);
-            } else {
-                if ($fd instanceof NormalizerInterface) {
-                    $marshalledValue = $fd->normalize($value);
-                    $result[$fd->getName()] = $marshalledValue;
-                }
-            }
-        }
-    }
-    /**
-     * @param AbstractObject $object
-     *
-     * @return array
-     */
-    public static function exportObject(AbstractObject $object)
-    {
-        $webObject = [];
-        $webObject['id'] = $object->getId();
-        $webObject['fullpath'] = $object->getFullPath();
-        $properties = $object->getProperties();
-        $finalProperties = [];
-        foreach ($properties as $property) {
-            $finalProperties[] = $property->serialize();
-        }
-        $webObject['properties'] = $finalProperties;
-        if ($object instanceof Concrete) {
-            self::doExportObject($object, $webObject);
-        }
-        $resultItem = json_decode(json_encode($webObject), true);
-        unset($resultItem['data']);
-        return $resultItem;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/Manager.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-use Pimcore\DependencyInjection\CollectionServiceLocator;
-/**
- * @internal
- */
-class Manager
-{
-    /**
-     * @var CollectionServiceLocator
-     */
-    private $services;
-    /**
-     * @var array
-     */
-    private $sortedServices;
-    public function __construct(CollectionServiceLocator $services)
-    {
-        $this->services = $services;
-    }
-    /**
-     * Returns registered services in sorted order
-     *
-     * @return DataProviderInterface[]
-     */
-    public function getServices(): array
-    {
-        if (null !== $this->sortedServices) {
-            return $this->sortedServices;
-        }
-        $this->sortedServices = $this->services->all();
-        usort($this->sortedServices, function (DataProviderInterface $left, DataProviderInterface $right) {
-            return $left->getSortPriority() > $right->getSortPriority();
-        });
-        return $this->sortedServices;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/PimcoreUsers.php
+++ b//dev/null
@@ -1,178 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-use Pimcore\Bundle\AdminBundle\Security\User\TokenStorageUserResolver;
-use Pimcore\Db;
-use Pimcore\Model\User;
-/**
- * @internal
- */
-class PimcoreUsers implements DataProviderInterface
-{
-    /**
-     * @var TokenStorageUserResolver
-     */
-    protected $userResolver;
-    /**
-     * @param TokenStorageUserResolver $userResolver
-     */
-    public function __construct(TokenStorageUserResolver $userResolver)
-    {
-        $this->userResolver = $userResolver;
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getName(): string
-    {
-        return 'pimcoreUsers';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getJsClassName(): string
-    {
-        return 'pimcore.settings.gdpr.dataproviders.pimcoreUsers';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getSortPriority(): int
-    {
-        return 30;
-    }
-    /**
-     * @param int $id
-     * @param string $firstname
-     * @param string $lastname
-     * @param string $email
-     * @param int $start
-     * @param int $limit
-     * @param string|null $sort
-     *
-     * @return array
-     */
-    public function searchData(int $id, string $firstname, string $lastname, string $email, int $start, int $limit, string $sort = null): array
-    {
-        if (empty($id) && empty($firstname) && empty($lastname) && empty($email)) {
-            return ['data' => [], 'success' => true, 'total' => 0];
-        }
-        $userListing = new User\Listing();
-        $conditionParams = [];
-        $conditionParamData = [];
-        if ($id) {
-            $conditionParams[] = 'id = ?';
-            $conditionParamData[] = $id;
-        }
-        if ($firstname) {
-            $conditionParams[] = 'firstname LIKE ?';
-            $conditionParamData[] = '%' . $firstname . '%';
-        }
-        if ($lastname) {
-            $conditionParams[] = 'lastname LIKE ?';
-            $conditionParamData[] = '%' . $lastname . '%';
-        }
-        if ($email) {
-            $conditionParams[] = 'email LIKE ?';
-            $conditionParamData[] = '%' . $email . '%';
-        }
-        $userListing->setCondition(implode(' AND ', $conditionParams), $conditionParamData);
-        $userListing->setLimit($limit);
-        $userListing->setOffset($start);
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings(['sort' => $sort]);
-        if ($sortingSettings['orderKey']) {
-            $userListing->setOrderKey($sortingSettings['orderKey']);
-        }
-        if ($sortingSettings['order']) {
-            $userListing->setOrder($sortingSettings['order']);
-        }
-        $userListing->load();
-        $users = [];
-        $currentUser = $this->userResolver->getUser();
-        foreach ($userListing->getUsers() as $user) {
-            $users[] = [
-                'id' => $user->getId(),
-                'username' => $user->getUsername(),
-                'firstname' => $user->getFirstname(),
-                'lastname' => $user->getLastname(),
-                'email' => $user->getEmail(),
-                '__gdprIsDeletable' => $user->getId() != $currentUser->getId(),
-            ];
-        }
-        return $users;
-    }
-    /**
-     * @param int $id
-     *
-     * @return array
-     */
-    public function getExportData(int $id): array
-    {
-        $user = User::getById($id);
-        $userData = [];
-        if ($user) {
-            $userData = (array)$user->getObjectVars();
-            unset($userData['password']);
-            $userData['versions'] = $this->getVersionDataForUser($user);
-            $userData['usageLog'] = $this->getUsageLogDataForUser($user);
-        }
-        return $userData;
-    }
-    /**
-     * @param User\AbstractUser $user
-     *
-     * @return array
-     */
-    protected function getVersionDataForUser(User\AbstractUser $user): array
-    {
-        $db = Db::get();
-        $versions = $db->fetchAll("SELECT ctype, cid, note, FROM_UNIXTIME(`date`) AS 'date' FROM versions WHERE userId = ?", [$user->getId()]);
-        return $versions;
-    }
-    /**
-     * @param User\AbstractUser $user
-     *
-     * @return array
-     */
-    protected function getUsageLogDataForUser(User\AbstractUser $user): array
-    {
-        $pattern = ' ' . $user->getId() . '|';
-        $matches = [];
-        $handle = @fopen(PIMCORE_LOG_DIRECTORY . '/usagelog.log', 'r');
-        if ($handle) {
-            while (!feof($handle)) {
-                $buffer = fgets($handle);
-                if ($buffer && strpos($buffer, $pattern) !== false) {
-                    $matches[] = $buffer;
-                }
-            }
-            fclose($handle);
-        }
-        $archiveFiles = glob(PIMCORE_LOG_DIRECTORY . '/usagelog-archive-*.log.gz');
-        foreach ($archiveFiles as $archiveFile) {
-            $handle = @gzopen($archiveFile, 'r');
-            if ($handle) {
-                while (!feof($handle)) {
-                    $buffer = fgets($handle);
-                    if (strpos($buffer, $pattern) !== false) {
-                        $matches[] = $buffer;
-                    }
-                }
-                fclose($handle);
-            }
-        }
-        return $matches;
-    }
-}

--- a/bundles/AdminBundle/GDPR/DataProvider/SentMail.php
+++ b//dev/null
@@ -1,39 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\GDPR\DataProvider;
-class SentMail implements DataProviderInterface
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function getName(): string
-    {
-        return 'sentMail';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getJsClassName(): string
-    {
-        return 'pimcore.settings.gdpr.dataproviders.sentMail';
-    }
-    /**
-     * {@inheritdoc}
-     */
-    public function getSortPriority(): int
-    {
-        return 20;
-    }
-}

--- a/bundles/AdminBundle/Helper/GridHelperService.php
+++ b//dev/null
@@ -1,721 +0,0 @@
-<?php
-declare(strict_types=1);
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Helper;
-use Doctrine\DBAL\Query\QueryBuilder as DoctrineQueryBuilder;
-use Pimcore\Db;
-use Pimcore\Logger;
-use Pimcore\Model;
-use Pimcore\Model\DataObject;
-use Pimcore\Model\DataObject\ClassDefinition;
-use Pimcore\Model\DataObject\Objectbrick;
-/**
- * @internal
- */
-class GridHelperService
-{
-    /**
-     * @param string $filterJson
-     * @param ClassDefinition $class
-     * @param string $requestedLanguage
-     *
-     * @return array
-     */
-    public function getFeatureAndSlugFilters(string $filterJson, ClassDefinition $class, string $requestedLanguage): array
-    {
-        $featureJoins = [];
-        $slugJoins = [];
-        $slugConditions = [];
-        $featureConditions = [];
-        if ($filterJson) {
-            $filters = json_decode($filterJson, true);
-            foreach ($filters as $filter) {
-                $operator = '=';
-                $filterField = $filter['property'];
-                $filterOperator = $filter['operator'];
-                if ($filter['type'] == 'string') {
-                    $operator = 'LIKE';
-                } elseif ($filter['type'] == 'numeric') {
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = '=';
-                    }
-                } elseif ($filter['type'] == 'date') {
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = '=';
-                    }
-                    $filter['value'] = strtotime($filter['value']);
-                } elseif ($filter['type'] == 'list') {
-                    $operator = '=';
-                } elseif ($filter['type'] == 'boolean') {
-                    $operator = '=';
-                    $filter['value'] = (int)$filter['value'];
-                }
-                $keyParts = explode('~', $filterField);
-                $slugFd = null;
-                $field = null;
-                $slugKey = null;
-                $mappedKey = null;
-                if (substr($filterField, 0, 1) == '~') {
-                    $type = $keyParts[1];
-                    if ($type != 'classificationstore') {
-                        continue;
-                    }
-                    $fieldName = $keyParts[2];
-                    $groupKeyId = explode('-', $keyParts[3]);
-                    /** @var Model\DataObject\ClassDefinition\Data\Classificationstore $csFieldDefinition */
-                    $csFieldDefinition = $class->getFieldDefinition($fieldName);
-                    $language = $requestedLanguage;
-                    if (!$csFieldDefinition->isLocalized()) {
-                        $language = 'default';
-                    }
-                    $groupId = $groupKeyId[0];
-                    $keyid = $groupKeyId[1];
-                    $keyConfig = Model\DataObject\Classificationstore\KeyConfig::getById($keyid);
-                    $type = $keyConfig->getType();
-                    $definition = json_decode($keyConfig->getDefinition());
-                    $field = \Pimcore\Model\DataObject\Classificationstore\Service::getFieldDefinitionFromJson($definition, $type);
-                    if ($field instanceof Model\DataObject\ClassDefinition\Data) {
-                        $mappedKey = 'cskey_' . $fieldName . '_' . $groupId . '_' . $keyid;
-                        $featureJoins[] = ['fieldname' => $fieldName, 'groupId' => $groupId, 'keyId' => $keyid, 'language' => $language];
-                        $featureCondition = $field->getFilterConditionExt(
-                            $filter['value'],
-                            $operator,
-                            [
-                                'name' => $mappedKey, ]
-                        );
-                        $featureConditions[$mappedKey] = $featureCondition;
-                    }
-                } elseif (count($keyParts) > 1) {
-                    $brickType = $keyParts[0];
-                    $brickKey = $keyParts[1];
-                    if (strpos($brickType, '?') !== false) {
-                        $brickDescriptor = substr($brickType, 1);
-                        $brickDescriptor = json_decode($brickDescriptor, true);
-                        $brickType = $brickDescriptor['containerKey'];
-                    }
-                    $brickDef = Objectbrick\Definition::getByKey($brickType);
-                    if ($slugFd = $brickDef->getFieldDefinition($brickKey) instanceof ClassDefinition\Data\UrlSlug) {
-                        $slugKey = $brickKey;
-                        $slugJoins[] = ['fieldname' => $brickKey];
-                    }
-                } else {
-                    if ($slugFd = $class->getFieldDefinition($filterField) instanceof ClassDefinition\Data\UrlSlug) {
-                        $slugKey = $filterField;
-                        $slugJoins[] = ['fieldname' => $filterField];
-                    }
-                }
-                if ($field && $slugFd) {
-                    $slugCondition = $field->getFilterConditionExt(
-                        $filter['value'],
-                        $operator,
-                        [
-                            'name' => $slugKey, ]
-                    );
-                    $slugConditions[$mappedKey] = $slugCondition;
-                }
-            }
-        }
-        $result = [
-            'featureJoins' => $featureJoins,
-            'slugJoins' => $slugJoins,
-            'featureConditions' => $featureConditions,
-            'slugConditions' => $slugConditions,
-        ];
-        return $result;
-    }
-    /**
-     *
-     * @param string $filterJson
-     * @param ClassDefinition $class
-     *
-     * @return string
-     */
-    public function getFilterCondition($filterJson, ClassDefinition $class, $tablePrefix = null): string
-    {
-        $systemFields = Model\DataObject\Service::getSystemFields();
-        $conditionPartsFilters = [];
-        if ($filterJson) {
-            $db = \Pimcore\Db::get();
-            $filters = json_decode($filterJson, true);
-            foreach ($filters as $filter) {
-                $operator = '=';
-                $filterField = $filter['property'];
-                $filterOperator = $filter['operator'];
-                if ($filter['type'] == 'string') {
-                    $operator = 'LIKE';
-                } elseif ($filter['type'] == 'date') {
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = '=';
-                    }
-                    $filter['value'] = strtotime($filter['value']);
-                } elseif ($filter['type'] == 'list') {
-                    $operator = '=';
-                } elseif ($filter['type'] == 'boolean') {
-                    $operator = '=';
-                    $filter['value'] = (int)$filter['value'];
-                } else {
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = '=';
-                    }
-                }
-                $field = $class->getFieldDefinition($filterField);
-                $brickField = null;
-                $brickKey = null;
-                $brickType = null;
-                $brickDescriptor = null;
-                $isLocalized = false;
-                if (!$field) {
-                    $localized = $class->getFieldDefinition('localizedfields');
-                    if ($localized instanceof ClassDefinition\Data\Localizedfields) {
-                        $field = $localized->getFieldDefinition($filterField);
-                    }
-                    $keyParts = explode('~', $filterField);
-                    if (substr($filterField, 0, 1) === '~') {
-                    } elseif (count($keyParts) > 1) {
-                        $brickType = $keyParts[0];
-                        $brickKey = $keyParts[1];
-                        if (strpos($brickType, '?') !== false) {
-                            $brickDescriptor = substr($brickType, 1);
-                            $brickDescriptor = json_decode($brickDescriptor, true);
-                            $brickType = $brickDescriptor['containerKey'];
-                        }
-                        $key = Model\DataObject\Service::getFieldForBrickType($class, $brickType);
-                        $field = $class->getFieldDefinition($key);
-                        $brickClass = Objectbrick\Definition::getByKey($brickType);
-                        $brickFieldKey = $brickDescriptor ? $brickDescriptor['brickfield'] : $brickKey;
-                        $brickClassDefinitions = $brickClass->getFieldDefinitions();
-                        if (array_key_exists($brickFieldKey, $brickClassDefinitions)) {
-                            $brickField = $brickClass->getFieldDefinition($brickFieldKey);
-                        } else {
-                            /** @var ClassDefinition\Data\Localizedfields|null $localizedFields */
-                            $localizedFields = $brickClass->getFieldDefinition('localizedfields');
-                            if ($localizedFields) {
-                                $brickField = $localizedFields->getFieldDefinition($brickFieldKey);
-                                $isLocalized = true;
-                            }
-                        }
-                    }
-                }
-                if ($field instanceof ClassDefinition\Data\Objectbricks || $brickDescriptor) {
-                    if ($brickDescriptor) {
-                        $brickFilterField = $brickDescriptor['fieldname'];
-                    } else {
-                        $brickFilterField = $field->getName();
-                    }
-                    $db = \Pimcore\Db::get();
-                    if ($isLocalized) {
-                        $brickPrefix = $db->quoteIdentifier($brickType . '_localized') . '.';
-                    } else {
-                        if ($brickField instanceof ClassDefinition\Data\UrlSlug) {
-                            $brickPrefix = $db->quoteIdentifier($brickKey) . '.';
-                        } else {
-                            $brickPrefix = $db->quoteIdentifier($brickType) . '.';
-                        }
-                    }
-                    if (is_array($filter['value'])) {
-                        $fieldConditions = [];
-                        foreach ($filter['value'] as $filterValue) {
-                            $brickCondition = '(' . $brickField->getFilterCondition($filterValue, $operator,
-                                    ['brickPrefix' => $brickPrefix]
-                                ) . ' AND ' . $brickPrefix . 'fieldname = ' . $db->quote($brickFilterField) . ')';
-                            $fieldConditions[] = $brickCondition;
-                        }
-                        $conditionPartsFilters[] = '(' . implode(' OR ', $fieldConditions) . ')';
-                    } else {
-                        $brickCondition = '(' . $brickField->getFilterCondition($filter['value'], $operator,
-                                ['brickPrefix' => $brickPrefix]) . ' AND ' . $brickPrefix . 'fieldname = ' . $db->quote($brickFilterField) . ')';
-                        $conditionPartsFilters[] = $brickCondition;
-                    }
-                } elseif ($field instanceof ClassDefinition\Data\UrlSlug) {
-                    $conditionPartsFilters[] = $db->quoteIdentifier($field->getName()) . '.' . $field->getFilterCondition($filter['value'], $operator);
-                } elseif ($field instanceof ClassDefinition\Data) {
-                    if (is_array($filter['value'] ?? false)) {
-                        $fieldConditions = [];
-                        foreach ($filter['value'] as $filterValue) {
-                            $fieldConditions[] = $field->getFilterCondition($filterValue, $operator, ['brickPrefix' => ($tablePrefix ? $tablePrefix.'.' : null)]);
-                        }
-                        if (!empty($fieldConditions)) {
-                            $conditionPartsFilters[] = '(' . implode(' OR ', $fieldConditions) . ')';
-                        }
-                    } else {
-                        $conditionPartsFilters[] = $field->getFilterCondition($filter['value'] ?? null, $operator, ['brickPrefix' => ($tablePrefix ? $tablePrefix.'.' : null)]);
-                    }
-                } elseif (in_array('o_' . $filterField, $systemFields)) {
-                    if ($filterField == 'fullpath') {
-                        $conditionPartsFilters[] = 'concat(o_path, o_key) ' . $operator . ' ' . $db->quote('%' . $filter['value'] . '%');
-                    } elseif ($filterField == 'key') {
-                        $conditionPartsFilters[] = 'o_key ' . $operator . ' ' . $db->quote('%' . $filter['value'] . '%');
-                    } elseif ($filterField == 'id') {
-                        $conditionPartsFilters[] = 'oo_id ' . $operator . ' ' . $db->quote($filter['value']);
-                    } else {
-                        if ($filter['type'] == 'date' && $operator == '=') {
-                            $maxTime = $filter['value'] + (86400 - 1); //specifies the top point of the range used in the condition
-                            $conditionPartsFilters[] = '`o_' . $filterField . '` BETWEEN ' . $db->quote($filter['value']) . ' AND ' . $db->quote($maxTime);
-                        } else {
-                            $conditionPartsFilters[] = '`o_' . $filterField . '` ' . $operator . ' ' . $db->quote($filter['value']);
-                        }
-                    }
-                }
-            }
-        }
-        $conditionFilters = '1 = 1';
-        if (count($conditionPartsFilters) > 0) {
-            $conditionFilters = '(' . implode(' AND ', $conditionPartsFilters) . ')';
-        }
-        Logger::log('DataObjectController filter condition:' . $conditionFilters);
-        return $conditionFilters;
-    }
-    /**
-     * @param array $fields
-     *
-     * @return array
-     */
-    protected function extractBricks(array $fields): array
-    {
-        $bricks = [];
-        if ($fields) {
-            foreach ($fields as $f) {
-                $fieldName = $f;
-                $parts = explode('~', $f);
-                if (substr($f, 0, 1) == '~') {
-                } elseif (count($parts) > 1) {
-                    $brickType = $parts[0];
-                    if (strpos($brickType, '?') !== false) {
-                        $brickDescriptor = substr($brickType, 1);
-                        $brickDescriptor = json_decode($brickDescriptor, true);
-                        $brickType = $brickDescriptor['containerKey'];
-                    }
-                    $bricks[$brickType] = $brickType;
-                }
-                $newFields[] = $fieldName;
-            }
-        }
-        return $bricks;
-    }
-    /**
-     * Adds all the query stuff that is needed for displaying, filtering and exporting the feature grid data.
-     *
-     * @param DataObject\Listing\Concrete $list
-     * @param array $featureJoins
-     * @param ClassDefinition $class
-     * @param array $featureAndSlugFilters
-     */
-    public function addGridFeatureJoins(DataObject\Listing\Concrete $list, array $featureJoins, ClassDefinition $class, array $featureAndSlugFilters)
-    {
-        if ($featureJoins) {
-            $me = $list;
-            $list->onCreateQueryBuilder(function (DoctrineQueryBuilder $select) use (
-                $featureJoins,
-                $class,
-                $featureAndSlugFilters,
-                $me
-            ) {
-                $db = \Pimcore\Db::get();
-                $alreadyJoined = [];
-                foreach ($featureJoins as $featureJoin) {
-                    $fieldname = $featureJoin['fieldname'];
-                    $mappedKey = 'cskey_' . $fieldname . '_' . $featureJoin['groupId'] . '_' . $featureJoin['keyId'];
-                    if (isset($alreadyJoined[$mappedKey])) {
-                        continue;
-                    }
-                    $alreadyJoined[$mappedKey] = 1;
-                    $table = $me->getDao()->getTableName();
-                    $select->addSelect('value AS ' . $mappedKey);
-                    $select->leftJoin(
-                        $table,
-                        'object_classificationstore_data_' . $class->getId(),
-                        $mappedKey,
-                        '('
-                        . $mappedKey . '.o_id = ' . $table . '.o_id'
-                        . ' and ' . $mappedKey . '.fieldname = ' . $db->quote($fieldname)
-                        . ' and ' . $mappedKey . '.groupId=' . $featureJoin['groupId']
-                        . ' and ' . $mappedKey . '.keyId=' . $featureJoin['keyId']
-                        . ' and ' . $mappedKey . '.language = ' . $db->quote($featureJoin['language'])
-                        . ')'
-                    );
-                }
-                $havings = $featureAndSlugFilters['featureConditions'] ?? null;
-                if ($havings) {
-                    $havings = implode(' AND ', $havings);
-                    $select->having($havings);
-                }
-            });
-        }
-    }
-    /**
-     * Adds all the query stuff that is needed for displaying, filtering and exporting the slug grid data.
-     *
-     * @param DataObject\Listing\Concrete $list
-     * @param array $slugJoins
-     * @param array $featureAndSlugFilters
-     */
-    public function addSlugJoins(DataObject\Listing\Concrete $list, array $slugJoins, array $featureAndSlugFilters)
-    {
-        if ($slugJoins) {
-            $me = $list;
-            $list->onCreateQueryBuilder(function (DoctrineQueryBuilder $select) use (
-                $slugJoins,
-                $featureAndSlugFilters,
-                $me
-            ) {
-                $db = \Pimcore\Db::get();
-                $alreadyJoined = [];
-                foreach ($slugJoins as $slugJoin) {
-                    $fieldname = $slugJoin['fieldname'];
-                    $mappedKey = $fieldname;
-                    $alreadyJoined[$mappedKey] = 1;
-                    $table = $me->getDao()->getTableName();
-                    $select->addSelect('slug AS ' . $mappedKey);
-                    $select->leftJoin(
-                        $table,
-                        'object_url_slugs',
-                        $mappedKey,
-                        '('
-                        . $mappedKey . '.objectId = ' . $table . '.o_id'
-                        . ' and ' . $mappedKey . '.fieldname = ' . $db->quote($fieldname)
-                        . ')'
-                    );
-                }
-                $havings = $featureAndSlugFilters['slugConditions'];
-                if ($havings) {
-                    $havings = implode(' AND ', $havings);
-                    $select->having($havings);
-                }
-            });
-        }
-    }
-    public function prepareListingForGrid(array $requestParams, string $requestedLanguage, $adminUser): DataObject\Listing\Concrete
-    {
-        $folder = Model\DataObject::getById($requestParams['folderId']);
-        $class = ClassDefinition::getById($requestParams['classId']);
-        $className = $class->getName();
-        $listClass = '\\Pimcore\\Model\\DataObject\\' . ucfirst($className) . '\\Listing';
-        /** @var DataObject\Listing\Concrete $list */
-        $list = new $listClass();
-        $colMappings = [
-            'key' => 'o_key',
-            'filename' => 'o_key',
-            'id' => 'oo_id',
-            'published' => 'o_published',
-            'modificationDate' => 'o_modificationDate',
-            'creationDate' => 'o_creationDate',
-        ];
-        $start = 0;
-        $limit = 20;
-        $orderKey = 'o_id';
-        $order = 'ASC';
-        $fields = [];
-        $bricks = [];
-        if (!empty($requestParams['fields'])) {
-            $fields = $requestParams['fields'];
-            $bricks = $this->extractBricks($fields);
-        }
-        if (isset($requestParams['limit'])) {
-            $limit = $requestParams['limit'];
-        }
-        if (isset($requestParams['start'])) {
-            $start = $requestParams['start'];
-        }
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($requestParams);
-        $doNotQuote = false;
-        if ($sortingSettings['order']) {
-            $order = $sortingSettings['order'];
-        }
-        if ($sortingSettings['orderKey'] !== null && strlen($sortingSettings['orderKey']) > 0) {
-            $orderKey = $sortingSettings['orderKey'];
-            if (substr($orderKey, 0, 1) !== '~') {
-                if (array_key_exists($orderKey, $colMappings)) {
-                    $orderKey = $colMappings[$orderKey];
-                } elseif ($orderKey === 'fullpath') {
-                    $orderKey = 'CAST(CONCAT(o_path, o_key) AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci';
-                    $doNotQuote = true;
-                } elseif ($class->getFieldDefinition($orderKey) instanceof ClassDefinition\Data\QuantityValue) {
-                    $orderKey = 'concat(' . $orderKey . '__unit, ' . $orderKey . '__value)';
-                    $doNotQuote = true;
-                } elseif ($class->getFieldDefinition($orderKey) instanceof ClassDefinition\Data\RgbaColor) {
-                    $orderKey = 'concat(' . $orderKey . '__rgb, ' . $orderKey . '__a)';
-                    $doNotQuote = true;
-                } elseif (strpos($orderKey, '~') !== false) {
-                    $orderKeyParts = explode('~', $orderKey);
-                    if (strpos($orderKey, '?') !== false) {
-                        $brickDescriptor = substr($orderKeyParts[0], 1);
-                        $brickDescriptor = json_decode($brickDescriptor, true);
-                        $db = Db::get();
-                        $orderKey = $db->quoteIdentifier($brickDescriptor['containerKey'] . '_localized') . '.' . $db->quoteIdentifier($brickDescriptor['brickfield']);
-                        $doNotQuote = true;
-                    } elseif (count($orderKeyParts) === 2) {
-                        $orderKey = $orderKeyParts[0].'.'.$orderKeyParts[1];
-                        $doNotQuote = true;
-                    }
-                } else {
-                    $orderKey = $list->getDao()->getTableName().'.'.$orderKey;
-                    $doNotQuote = true;
-                }
-            }
-        }
-        $conditionFilters = [];
-        if (($requestParams['specificId'] ?? false) && is_numeric($requestParams['specificId'])) {
-            $conditionFilters[] = 'oo_id = ' . (int) $requestParams['specificId'];
-        }
-        if (isset($requestParams['only_direct_children']) && $requestParams['only_direct_children'] === 'true') {
-            $conditionFilters[] = 'o_parentId = ' . $folder->getId();
-        } else {
-            $quotedPath = $list->quote($folder->getRealFullPath());
-            $quotedWildcardPath = $list->quote($list->escapeLike(str_replace('//', '/', $folder->getRealFullPath() . '/')) . '%');
-            $conditionFilters[] = '(o_path = ' . $quotedPath . ' OR o_path LIKE ' . $quotedWildcardPath . ')';
-        }
-        if (!$adminUser->isAdmin()) {
-            $userIds = $adminUser->getRoles();
-            $userIds[] = $adminUser->getId();
-            $conditionFilters[] = ' (
-                                                    (select list from users_workspaces_object where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(o_path,o_key),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                    OR
-                                                    (select list from users_workspaces_object where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(o_path,o_key))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                 )';
-        }
-        $featureJoins = [];
-        $slugJoins = [];
-        $featureAndSlugFilters = [];
-        if (!empty($requestParams['filter'])) {
-            $conditionFilters[] = $this->getFilterCondition($requestParams['filter'], $class, $list->getDao()->getTableName());
-            $featureAndSlugFilters = $this->getFeatureAndSlugFilters($requestParams['filter'], $class, $requestedLanguage);
-            if ($featureAndSlugFilters) {
-                $featureJoins = array_merge($featureJoins, $featureAndSlugFilters['featureJoins']);
-                $slugJoins = array_merge($slugJoins, $featureAndSlugFilters['slugJoins']);
-            }
-        }
-        if (!empty($requestParams['condition']) && $adminUser->isAdmin()) {
-            $conditionFilters[] = '(' . $requestParams['condition'] . ')';
-        }
-        if (!empty($requestParams['query'])) {
-            $query = $this->filterQueryParam($requestParams['query']);
-            if (!empty($query)) {
-                $conditionFilters[] = 'oo_id IN (SELECT id FROM search_backend_data WHERE maintype = "object" AND MATCH (`data`,`properties`) AGAINST (' . $list->quote($query) . ' IN BOOLEAN MODE))';
-            }
-        }
-        if (!empty($bricks)) {
-            foreach ($bricks as $b) {
-                $brickType = $b;
-                if (is_array($brickType)) {
-                    $brickType = $brickType['containerKey'];
-                }
-                $list->addObjectbrick($brickType);
-            }
-        }
-        $list->setCondition(implode(' AND ', $conditionFilters));
-        if (empty($requestParams['batch']) && empty($requestParams['ids'])) {
-            $list->setLimit($limit);
-            $list->setOffset($start);
-        }
-        if (isset($sortingSettings['isFeature']) && $sortingSettings['isFeature']) {
-            $orderKey = 'cskey_' . $sortingSettings['fieldname'] . '_' . $sortingSettings['groupId'] . '_' . $sortingSettings['keyId'];
-            $list->setOrderKey($orderKey);
-            $list->setGroupBy('oo_id');
-            $parts = explode('_', $orderKey);
-            $fieldname = $parts[1];
-            /** @var DataObject\ClassDefinition\Data\Classificationstore $csFieldDefinition */
-            $csFieldDefinition = $class->getFieldDefinition($fieldname);
-            $sortingSettings['language'] = $csFieldDefinition->isLocalized() ? $requestedLanguage : 'default';
-            $featureJoins[] = $sortingSettings;
-        } else {
-            $list->setOrderKey($orderKey, !$doNotQuote);
-        }
-        $list->setOrder($order);
-        if (!empty($requestParams['ids'])) {
-            $quotedIds = [];
-            foreach ($requestParams['ids'] as $id) {
-                $quotedIds[] = $list->quote($id);
-            }
-            if (!empty($quotedIds)) {
-                $list->addConditionParam('oo_id IN (' . implode(',', $quotedIds) . ')');
-            }
-        }
-        if ($class->getShowVariants()) {
-            $list->setObjectTypes([DataObject::OBJECT_TYPE_OBJECT, DataObject::OBJECT_TYPE_VARIANT]);
-        }
-        $this->addGridFeatureJoins($list, $featureJoins, $class, $featureAndSlugFilters);
-        $this->addSlugJoins($list, $slugJoins, $featureAndSlugFilters);
-        $list->setLocale($requestedLanguage);
-        if (empty($requestParams['filter']) && empty($requestParams['condition']) && empty($requestParams['sort'])) {
-            $list->setIgnoreLocalizedFields(true);
-        }
-        return $list;
-    }
-    public function prepareAssetListingForGrid($allParams, $adminUser)
-    {
-        $db = \Pimcore\Db::get();
-        $folder = Model\Asset::getById($allParams['folderId']);
-        $start = 0;
-        $limit = 0;
-        $orderKey = 'id';
-        $order = 'ASC';
-        if (isset($allParams['limit'])) {
-            $limit = $allParams['limit'];
-        }
-        if (isset($allParams['start'])) {
-            $start = $allParams['start'];
-        }
-        $orderKeyQuote = true;
-        $sortingSettings = \Pimcore\Bundle\AdminBundle\Helper\QueryParams::extractSortingSettings($allParams);
-        if ($sortingSettings['orderKey']) {
-            $orderKey = explode('~', $sortingSettings['orderKey'])[0];
-            if ($orderKey === 'fullpath') {
-                $orderKey = 'CAST(CONCAT(path,filename) AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci';
-                $orderKeyQuote = false;
-            } elseif ($orderKey === 'filename') {
-                $orderKey = 'CAST(filename AS CHAR CHARACTER SET utf8) COLLATE utf8_general_ci';
-                $orderKeyQuote = false;
-            }
-            $order = $sortingSettings['order'];
-        }
-        $list = new Model\Asset\Listing();
-        $conditionFilters = [];
-        if (isset($allParams['only_direct_children']) && $allParams['only_direct_children'] == 'true') {
-            $conditionFilters[] = 'parentId = ' . $folder->getId();
-        } else {
-            $conditionFilters[] = 'path LIKE ' . ($folder->getRealFullPath() === '/' ? "'/%'" : $list->quote($list->escapeLike($folder->getRealFullPath()) . '/%'));
-        }
-        if (isset($allParams['only_unreferenced']) && $allParams['only_unreferenced'] === 'true') {
-            $conditionFilters[] = 'id NOT IN (SELECT targetid FROM dependencies WHERE targettype=\'asset\')';
-        }
-        $conditionFilters[] = "type != 'folder'";
-        $filterJson = $allParams['filter'] ?? null;
-        if ($filterJson) {
-            $filters = json_decode($filterJson, true);
-            foreach ($filters as $filter) {
-                $operator = '=';
-                $filterDef = explode('~', $filter['property']);
-                $filterField = $filterDef[0];
-                $filterOperator = $filter['operator'];
-                $filterType = $filter['type'];
-                if ($filterType == 'string') {
-                    $operator = 'LIKE';
-                } elseif ($filterType == 'numeric') {
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = '=';
-                    }
-                } elseif ($filterType == 'date') {
-                    $filter['value'] = strtotime($filter['value']);
-                    if ($filterOperator == 'lt') {
-                        $operator = '<';
-                    } elseif ($filterOperator == 'gt') {
-                        $operator = '>';
-                    } elseif ($filterOperator == 'eq') {
-                        $operator = 'BETWEEN';
-                        $maxTime = $filter['value'] + (86400 - 1); //specifies the top point of the range used in the condition
-                        $filter['value'] = $db->quote($filter['value']) . ' AND ' . $db->quote($maxTime);
-                    }
-                } elseif ($filterType == 'list') {
-                    $operator = 'IN';
-                } elseif ($filterType == 'boolean') {
-                    $operator = '=';
-                    $filter['value'] = (int) $filter['value'];
-                }
-                $value = $filter['value'] ?? '';
-                if ($operator == 'LIKE') {
-                    $value = $db->quote('%' . $value . '%');
-                } elseif ($operator == 'IN') {
-                    $quoted = array_map(function ($val) use ($db) {
-                        return $db->quote($val);
-                    }, $value);
-                    $value = '(' . implode(',', $quoted) . ')';
-                } elseif ($operator == 'BETWEEN') {
-                } else {
-                    $value = $db->quote($value);
-                }
-                if ($filterField == 'fullpath') {
-                    $filterField = 'CONCAT(path,filename)';
-                }
-                if (isset($filterDef[1]) && $filterDef[1] == 'system') {
-                    $conditionFilters[] = $filterField . ' ' . $operator . ' ' . $value;
-                } else {
-                    $language = $allParams['language'];
-                    if (isset($filterDef[1])) {
-                        $language = $filterDef[1];
-                    }
-                    $language = str_replace(['none', 'default'], '', $language);
-                    $conditionFilters[] = 'id IN (SELECT cid FROM assets_metadata WHERE `name` = ' . $db->quote($filterField) . ' AND `data` ' . $operator . ' ' . $value . ' AND `language` = ' . $db->quote($language). ')';
-                }
-            }
-        }
-        if (!$adminUser->isAdmin()) {
-            $userIds = $adminUser->getRoles();
-            $userIds[] = $adminUser->getId();
-            $conditionFilters[] = ' (
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(CONCAT(path, filename),cpath)=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                    OR
-                                                    (select list from users_workspaces_asset where userId in (' . implode(',', $userIds) . ') and LOCATE(cpath,CONCAT(path, filename))=1  ORDER BY LENGTH(cpath) DESC LIMIT 1)=1
-                                                 )';
-        }
-        if (!empty($allParams['tagIds'])) {
-            $tagIds = $allParams['tagIds'];
-            foreach ($tagIds as $tagId) {
-                if ($allParams['considerChildTags'] ?? false) {
-                    $tag = Model\Element\Tag::getById($tagId);
-                    if ($tag) {
-                        $tagPath = $tag->getFullIdPath();
-                        $conditionFilters[] = 'id IN (SELECT cId FROM `tags_assignment` INNER JOIN `tags` ON tags.id = tags_assignment.tagid WHERE `ctype` = "asset" AND (`id` = ' .(int)$tagId. ' OR `idPath` LIKE ' . $db->quote($tagPath . '%') . '))';
-                    }
-                } else {
-                    $conditionFilters[] = 'id IN (SELECT cId FROM `tags_assignment` WHERE `ctype` = "asset" AND tagid = ' .(int)$tagId. ')';
-                }
-            }
-        }
-        $condition = implode(' AND ', $conditionFilters);
-        $list->setCondition($condition);
-        $list->setLimit($limit);
-        $list->setOffset($start);
-        $list->setOrder($order);
-        $list->setOrderKey($orderKey, $orderKeyQuote);
-        return $list;
-    }
-    /**
-     * @param string $query
-     *
-     * @return string
-     */
-    protected function filterQueryParam(string $query)
-    {
-        if ($query == '*') {
-            $query = '';
-        }
-        $query = str_replace('%', '*', $query);
-        $query = str_replace('@', '#', $query);
-        $query = preg_replace("@([^ ])\-@", '$1 ', $query);
-        $query = str_replace(['<', '>', '(', ')', '~'], ' ', $query);
-        $query = preg_replace('#[*]+#', '*', $query);
-        $query = rtrim($query, '+- ');
-        return $query;
-    }
-}

--- a/bundles/AdminBundle/Helper/QueryParams.php
+++ b//dev/null
@@ -1,131 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\Helper;
-use Carbon\Carbon;
-/**
- * @internal
- */
-class QueryParams
-{
-    /**
-     * @param array $params
-     *
-     * @return array  [orderKey => null|string, order => null|string]
-     */
-    public static function extractSortingSettings($params)
-    {
-        $orderKey = null;
-        $order = null;
-        $sortParam = isset($params['sort']) ? $params['sort'] : false;
-        if ($sortParam) {
-            $sortParam = json_decode($sortParam, true);
-            $sortParam = $sortParam[0];
-            if (substr($sortParam['property'], 0, 1) != '~') {
-                $orderKey = $sortParam['property'];
-                $order = $sortParam['direction'];
-            } else {
-                $orderKey = $sortParam['property'];
-                $order = $sortParam['direction'];
-                $parts = explode('~', $orderKey);
-                $fieldname = $parts[2];
-                $groupKeyId = $parts[3];
-                $groupKeyId = explode('-', $groupKeyId);
-                $groupId = $groupKeyId[0];
-                $keyid = $groupKeyId[1];
-                return ['orderKey' => $sortParam['property'], 'fieldname' => $fieldname, 'groupId' => $groupId, 'keyId' => $keyid, 'order' => $order, 'isFeature' => 1];
-            }
-        }
-        return ['orderKey' => $orderKey, 'order' => $order];
-    }
-    /**
-     * @param string $param
-     *
-     * @return int
-     */
-    public static function getRecordIdForGridRequest($param)
-    {
-        $param = json_decode($param, true);
-        return $param['id'];
-    }
-    /**
-     * Creates a condition string from the passed ExtJs filter definitions
-     *
-     * @param string $filterString
-     * @param array $matchExact
-     * @param bool $returnString
-     * @param array $callbacks
-     *
-     * @return array|string
-     *
-     * @throws \Exception
-     */
-    public static function getFilterCondition($filterString, $matchExact = ['id', 'o_id'], $returnString = true, $callbacks = [])
-    {
-        if (!$filterString) {
-            return '';
-        }
-        $conditions = [];
-        $filters = json_decode($filterString);
-        $db = \Pimcore\Db::get();
-        foreach ($filters as $f) {
-            if ($f->type == 'string') {
-                if (in_array($f->property, $matchExact)) {
-                    $conditions[$f->property][] = ' ' . $db->quoteIdentifier($f->property) . ' = ' . $db->quote($f->value) . ' ';
-                } else {
-                    $conditions[$f->property][] = ' ' . $db->quoteIdentifier($f->property) . ' LIKE ' . $db->quote('%' . $f->value . '%') . ' ';
-                }
-            } elseif ($f->type == 'numeric') {
-                $symbol = null;
-                if ($f->operator == 'eq') {
-                    $symbol = ' = ';
-                } elseif ($f->operator == 'lt') {
-                    $symbol = ' < ';
-                } elseif ($f->operator == 'gt') {
-                    $symbol = ' > ';
-                }
-                $conditions[$f->property][] = ' ' . $db->quoteIdentifier($f->property)  . ' ' . $symbol . $db->quote($f->value) . ' ';
-            } elseif ($f->type == 'date') {
-                /**
-                 * make sure you pass the date as timestamp
-                 *
-                 * filter: {type : 'date',dateFormat: 'timestamp'}
-                 */
-                $date = Carbon::createFromTimestamp($f->value)->setTime(0, 0, 0);
-                if ($f->operator == 'eq') {
-                    $conditions[$f->property][] = ' ' . $f->property . ' >= ' . $db->quote($date->getTimestamp());
-                    $conditions[$f->property][] = ' ' . $f->property . ' <= ' . $db->quote($date->addDay()->subSecond()->getTimestamp());
-                } elseif ($f->operator == 'lt') {
-                    $conditions[$f->property][] = ' ' . $f->property . ' < ' . $db->quote($date->getTimestamp());
-                } elseif ($f->operator == 'gt') {
-                    $conditions[$f->property][] = ' ' . $f->property . ' > ' . $db->quote($date->addDay()->subSecond()->getTimestamp());
-                }
-            } else {
-                throw new \Exception('Filer of type ' . $f->type . ' not jet supported.');
-            }
-        }
-        $conditionsGrouped = [];
-        foreach ($conditions as $fieldName => $fieldConditions) {
-            if (count($fieldConditions) > 1) {
-                $conditionsGrouped[$fieldName] = ' (' . implode(' AND ', $fieldConditions) . ') ';
-            } else {
-                $conditionsGrouped[$fieldName] = $fieldConditions[0];
-            }
-        }
-        if ($returnString) {
-            return implode(' OR ', $conditionsGrouped);
-        } else {
-            return $conditionsGrouped;
-        }
-    }
-}

--- a/bundles/AdminBundle/HttpFoundation/JsonResponse.php
+++ b//dev/null
@@ -1,35 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle\HttpFoundation;
-use Pimcore\Tool\Serialize;
-use Symfony\Component\HttpFoundation\JsonResponse as BaseJsonResponse;
-/**
- * This response serializes its data through the admin serializer (with reference loop handling) instead
- * of calling json_encode. This is to make sure we have consistent responses with `$this->json()` and `new JsonResponse`
- * in admin controllers.
- */
-class JsonResponse extends BaseJsonResponse
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function setData($data = [])
-    {
-        $serializer = Serialize::getAdminSerializer();
-        $json = $serializer->serialize($data, 'json', [
-            'json_encode_options' => $this->encodingOptions,
-        ]);
-        return $this->setJson($json);
-    }
-}

--- a/bundles/AdminBundle/PimcoreAdminBundle.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-/**
- * Pimcore
- *
- * This source file is available under two different licenses:
- * - GNU General Public License version 3 (GPLv3)
- * - Pimcore Commercial License (PCL)
- * Full copyright and license information is available in
- * LICENSE.md which is distributed with this source code.
- *
- *  @copyright  Copyright (c) Pimcore GmbH (http://www.pimcore.org)
- *  @license    http://www.pimcore.org/license     GPLv3 and PCL
- */
-namespace Pimcore\Bundle\AdminBundle;
-use Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler\GDPRDataProviderPass;
-use Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler\ImportExportLocatorsPass;
-use Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler\SerializerPass;
-use Pimcore\Bundle\AdminBundle\DependencyInjection\Compiler\TranslationServicesPass;
-use Pimcore\Bundle\AdminBundle\GDPR\DataProvider\DataProviderInterface;
-use Pimcore\Bundle\AdminBundle\Security\Factory\PreAuthenticatedAdminSessionFactory;
-use Symfony\Bundle\SecurityBundle\DependencyInjection\SecurityExtension;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\HttpKernel\Bundle\Bundle;
-/**
- * @internal
- */
-class PimcoreAdminBundle extends Bundle
-{
-    /**
-     * {@inheritdoc}
-     */
-    public function build(ContainerBuilder $container)
-    {
-        $container
-            ->registerForAutoconfiguration(DataProviderInterface::class)
-            ->addTag('pimcore.gdpr.data-provider');
-        $container->addCompilerPass(new SerializerPass());
-        $container->addCompilerPass(new GDPRDataProviderPass());
-        $container->addCompilerPass(new ImportExportLocatorsPass());
-        $container->addCompilerPass(new TranslationServicesPass());
-        /** @var SecurityExtension $extension */
-        $extension = $container->getExtension('security');
-        $extension->addSecurityListenerFactory(new PreAuthenticatedAdminSessionFactory());
-    }
-}

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/DataSimlet.js
+++ b//dev/null
@@ -1,178 +0,0 @@
-/**
- * This base class is used to handle data preparation (e.g., sorting, filtering and
- * group summary).
- */
-Ext.define('Ext.ux.ajax.DataSimlet', function() {
-    function makeSortFn(def, cmp) {
-        var order = def.direction,
-            sign = (order && order.toUpperCase() === 'DESC') ? -1 : 1;
-        return function(leftRec, rightRec) {
-            var lhs = leftRec[def.property],
-                rhs = rightRec[def.property],
-                c = (lhs < rhs) ? -1 : ((rhs < lhs) ? 1 : 0);
-            if (c || !cmp) {
-                return c * sign;
-            }
-            return cmp(leftRec, rightRec);
-        };
-    }
-    function makeSortFns(defs, cmp) {
-        var sortFn, i;
-        for (sortFn = cmp, i = defs && defs.length; i;) {
-            sortFn = makeSortFn(defs[--i], sortFn);
-        }
-        return sortFn;
-    }
-    return {
-        extend: 'Ext.ux.ajax.Simlet',
-        buildNodes: function(node, path) {
-            var me = this,
-                nodeData = {
-                    data: []
-                },
-                len = node.length,
-                children, i, child, name;
-            me.nodes[path] = nodeData;
-            for (i = 0; i < len; ++i) {
-                nodeData.data.push(child = node[i]);
-                name = child.text || child.title;
-                child.id = path ? path + '/' + name : name;
-                children = child.children;
-                if (!(child.leaf = !children)) {
-                    delete child.children;
-                    me.buildNodes(children, child.id);
-                }
-            }
-        },
-        deleteRecord: function(pos) {
-            if (this.data && typeof this.data !== 'function') {
-                Ext.Array.removeAt(this.data, pos);
-            }
-        },
-        fixTree: function(ctx, tree) {
-            var me = this,
-                node = ctx.params.node,
-                nodes;
-            if (!(nodes = me.nodes)) {
-                me.nodes = nodes = {};
-                me.buildNodes(tree, '');
-            }
-            node = nodes[node];
-            if (node) {
-                if (me.node) {
-                    me.node.sortedData = me.sortedData;
-                    me.node.currentOrder = me.currentOrder;
-                }
-                me.node = node;
-                me.data = node.data;
-                me.sortedData = node.sortedData;
-                me.currentOrder = node.currentOrder;
-            }
-            else {
-                me.data = null;
-            }
-        },
-        getData: function(ctx) {
-            var me = this,
-                params = ctx.params,
-                order = (params.filter || '') + (params.group || '') + '-' + (params.sort || '') +
-                        '-' + (params.dir || ''),
-                tree = me.tree,
-                dynamicData, data, fields, sortFn, filters;
-            if (tree) {
-                me.fixTree(ctx, tree);
-            }
-            data = me.data;
-            if (typeof data === 'function') {
-                dynamicData = true;
-                data = data.call(this, ctx);
-            }
-            if (!data || order === '--') {
-                return data || [];
-            }
-            if (!dynamicData && order === me.currentOrder) {
-                return me.sortedData;
-            }
-            ctx.filterSpec = params.filter && Ext.decode(params.filter);
-            ctx.groupSpec = params.group && Ext.decode(params.group);
-            fields = params.sort;
-            if (params.dir) {
-                fields = [{ direction: params.dir, property: fields }];
-            }
-            else if (params.sort) {
-                fields = Ext.decode(params.sort);
-            }
-            else {
-                fields = null;
-            }
-            if (ctx.filterSpec) {
-                filters = new Ext.util.FilterCollection();
-                filters.add(this.processFilters(ctx.filterSpec));
-                data = Ext.Array.filter(data, filters.getFilterFn());
-            }
-            sortFn = makeSortFns((ctx.sortSpec = fields));
-            if (ctx.groupSpec) {
-                sortFn = makeSortFns([ctx.groupSpec], sortFn);
-            }
-            data = Ext.isArray(data) ? data.slice(0) : data;
-            if (sortFn) {
-                Ext.Array.sort(data, sortFn);
-            }
-            me.sortedData = data;
-            me.currentOrder = order;
-            return data;
-        },
-        processFilters: Ext.identityFn,
-        getPage: function(ctx, data) {
-            var ret = data,
-                length = data.length,
-                start = ctx.params.start || 0,
-                end = ctx.params.limit ? Math.min(length, start + ctx.params.limit) : length;
-            if (start || end < length) {
-                ret = ret.slice(start, end);
-            }
-            return ret;
-        },
-        getGroupSummary: function(groupField, rows, ctx) {
-            return rows[0];
-        },
-        getSummary: function(ctx, data, page) {
-            var me = this,
-                groupField = ctx.groupSpec.property,
-                accum,
-                todo = {},
-                summary = [],
-                fieldValue,
-                lastFieldValue;
-            Ext.each(page, function(rec) {
-                fieldValue = rec[groupField];
-                todo[fieldValue] = true;
-            });
-            function flush() {
-                if (accum) {
-                    summary.push(me.getGroupSummary(groupField, accum, ctx));
-                    accum = null;
-                }
-            }
-            Ext.each(data, function(rec) {
-                fieldValue = rec[groupField];
-                if (lastFieldValue !== fieldValue) {
-                    flush();
-                    lastFieldValue = fieldValue;
-                }
-                if (!todo[fieldValue]) {
-                    return !summary.length;
-                }
-                if (accum) {
-                    accum.push(rec);
-                }
-                else {
-                    accum = [rec];
-                }
-                return true;
-            });
-            flush(); // make sure that last pesky summary goes...
-            return summary;
-        }
-    };
-}());

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/JsonSimlet.js
+++ b//dev/null
@@ -1,31 +0,0 @@
-/**
- * JSON Simlet.
- */
-Ext.define('Ext.ux.ajax.JsonSimlet', {
-    extend: 'Ext.ux.ajax.DataSimlet',
-    alias: 'simlet.json',
-    doGet: function(ctx) {
-        var me = this,
-            data = me.getData(ctx),
-            page = me.getPage(ctx, data),
-            reader = ctx.xhr.options.proxy && ctx.xhr.options.proxy.getReader(),
-            root = reader && reader.getRootProperty(),
-            ret = me.callParent(arguments), // pick up status/statusText
-            response = {};
-        if (root && Ext.isArray(page)) {
-            response[root] = page;
-            response[reader.getTotalProperty()] = data.length;
-        }
-        else {
-            response = page;
-        }
-        if (ctx.groupSpec) {
-            response.summaryData = me.getSummary(ctx, data, page);
-        }
-        ret.responseText = Ext.encode(response);
-        return ret;
-    },
-    doPost: function(ctx) {
-        return this.doGet(ctx);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/PivotSimlet.js
+++ b//dev/null
@@ -1,185 +0,0 @@
-/**
- * Pivot Simlet does remote pivot calculations.
- * Filtering the pivot results doesn't work.
- */
-Ext.define('Ext.ux.ajax.PivotSimlet', {
-    extend: 'Ext.ux.ajax.JsonSimlet',
-    alias: 'simlet.pivot',
-    lastPost: null, // last Ajax params sent to this simlet
-    lastResponse: null, // last JSON response produced by this simlet
-    keysSeparator: '',
-    grandTotalKey: '',
-    doPost: function(ctx) {
-        var me = this,
-            ret = me.callParent(arguments); // pick up status/statusText
-        me.lastResponse = me.processData(me.getData(ctx), Ext.decode(ctx.xhr.body));
-        ret.responseText = Ext.encode(me.lastResponse);
-        return ret;
-    },
-    processData: function(data, params) {
-        var me = this,
-            len = data.length,
-            response = {
-                success: true,
-                leftAxis: [],
-                topAxis: [],
-                results: []
-            },
-            leftAxis = new Ext.util.MixedCollection(),
-            topAxis = new Ext.util.MixedCollection(),
-            results = new Ext.util.MixedCollection(),
-            i, j, k, leftKeys, topKeys, item, agg;
-        me.lastPost = params;
-        me.keysSeparator = params.keysSeparator;
-        me.grandTotalKey = params.grandTotalKey;
-        for (i = 0; i < len; i++) {
-            leftKeys = me.extractValues(data[i], params.leftAxis, leftAxis);
-            topKeys = me.extractValues(data[i], params.topAxis, topAxis);
-            me.addResult(data[i], me.grandTotalKey, me.grandTotalKey, results);
-            for (j = 0; j < leftKeys.length; j++) {
-                me.addResult(data[i], leftKeys[j], me.grandTotalKey, results);
-                for (k = 0; k < topKeys.length; k++) {
-                    me.addResult(data[i], leftKeys[j], topKeys[k], results);
-                }
-            }
-            for (j = 0; j < topKeys.length; j++) {
-                me.addResult(data[i], me.grandTotalKey, topKeys[j], results);
-            }
-        }
-        response.leftAxis = leftAxis.getRange();
-        response.topAxis = topAxis.getRange();
-        len = results.getCount();
-        for (i = 0; i < len; i++) {
-            item = results.getAt(i);
-            item.values = {};
-            for (j = 0; j < params.aggregate.length; j++) {
-                agg = params.aggregate[j];
-                item.values[agg.id] = me[agg.aggregator](
-                    item.records, agg.dataIndex, item.leftKey, item.topKey
-                );
-            }
-            delete(item.records);
-            response.results.push(item);
-        }
-        leftAxis.clear();
-        topAxis.clear();
-        results.clear();
-        return response;
-    },
-    getKey: function(value) {
-        var me = this;
-        me.keysMap = me.keysMap || {};
-        if (!Ext.isDefined(me.keysMap[value])) {
-            me.keysMap[value] = Ext.id();
-        }
-        return me.keysMap[value];
-    },
-    extractValues: function(record, dimensions, col) {
-        var len = dimensions.length,
-            keys = [],
-            j, key, item, dim;
-        key = '';
-        for (j = 0; j < len; j++) {
-            dim = dimensions[j];
-            key += (j > 0 ? this.keysSeparator : '') + this.getKey(record[dim.dataIndex]);
-            item = col.getByKey(key);
-            if (!item) {
-                item = col.add(key, {
-                    key: key,
-                    value: record[dim.dataIndex],
-                    dimensionId: dim.id
-                });
-            }
-            keys.push(key);
-        }
-        return keys;
-    },
-    addResult: function(record, leftKey, topKey, results) {
-        var item = results.getByKey(leftKey + '/' + topKey);
-        if (!item) {
-            item = results.add(leftKey + '/' + topKey, {
-                leftKey: leftKey,
-                topKey: topKey,
-                records: []
-            });
-        }
-        item.records.push(record);
-    },
-    sum: function(records, measure, rowGroupKey, colGroupKey) {
-        var length = records.length,
-            total = 0,
-            i;
-        for (i = 0; i < length; i++) {
-            total += Ext.Number.from(records[i][measure], 0);
-        }
-        return total;
-    },
-    avg: function(records, measure, rowGroupKey, colGroupKey) {
-        var length = records.length,
-            total = 0,
-            i;
-        for (i = 0; i < length; i++) {
-            total += Ext.Number.from(records[i][measure], 0);
-        }
-        return length > 0 ? (total / length) : 0;
-    },
-    min: function(records, measure, rowGroupKey, colGroupKey) {
-        var data = [],
-            length = records.length,
-            i, v;
-        for (i = 0; i < length; i++) {
-            data.push(records[i][measure]);
-        }
-        v = Ext.Array.min(data);
-        return v;
-    },
-    max: function(records, measure, rowGroupKey, colGroupKey) {
-        var data = [],
-            length = records.length,
-            i, v;
-        for (i = 0; i < length; i++) {
-            data.push(records[i][measure]);
-        }
-        v = Ext.Array.max(data);
-        return v;
-    },
-    count: function(records, measure, rowGroupKey, colGroupKey) {
-        return records.length;
-    },
-    variance: function(records, measure, rowGroupKey, colGroupKey) {
-        var me = Ext.pivot.Aggregators,
-            length = records.length,
-            avg = me.avg.apply(me, arguments),
-            total = 0,
-            i;
-        if (avg > 0) {
-            for (i = 0; i < length; i++) {
-                total += Math.pow(Ext.Number.from(records[i][measure], 0) - avg, 2);
-            }
-        }
-        return (total > 0 && length > 1) ? (total / (length - 1)) : 0;
-    },
-    varianceP: function(records, measure, rowGroupKey, colGroupKey) {
-        var me = Ext.pivot.Aggregators,
-            length = records.length,
-            avg = me.avg.apply(me, arguments),
-            total = 0,
-            i;
-        if (avg > 0) {
-            for (i = 0; i < length; i++) {
-                total += Math.pow(Ext.Number.from(records[i][measure], 0) - avg, 2);
-            }
-        }
-        return (total > 0 && length > 0) ? (total / length) : 0;
-    },
-    stdDev: function(records, measure, rowGroupKey, colGroupKey) {
-        var me = Ext.pivot.Aggregators,
-            v = me.variance.apply(me, arguments);
-        return v > 0 ? Math.sqrt(v) : 0;
-    },
-    stdDevP: function(records, measure, rowGroupKey, colGroupKey) {
-        var me = Ext.pivot.Aggregators,
-            v = me.varianceP.apply(me, arguments);
-        return v > 0 ? Math.sqrt(v) : 0;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/SimManager.js
+++ b//dev/null
@@ -1,206 +0,0 @@
-/**
- * This singleton manages simulated Ajax responses. This allows application logic to be
- * written unaware that its Ajax calls are being handled by simulations ("simlets"). This
- * is currently done by hooking {@link Ext.data.Connection} methods, so all users of that
- * class (and {@link Ext.Ajax} since it is a derived class) qualify for simulation.
- *
- * The requires hooks are inserted when either the {@link #init} method is called or the
- * first {@link Ext.ux.ajax.Simlet} is registered. For example:
- *
- *      Ext.onReady(function () {
- *          initAjaxSim();
- *
- *          // normal stuff
- *      });
- *
- *      function initAjaxSim () {
- *          Ext.ux.ajax.SimManager.init({
- *              delay: 300
- *          }).register({
- *              '/app/data/url': {
- *                  type: 'json',  // use JsonSimlet (type is like xtype for components)
- *                  data: [
- *                      { foo: 42, bar: 'abc' },
- *                      ...
- *                  ]
- *              }
- *          });
- *      }
- *
- * As many URL's as desired can be registered and associated with a {@link Ext.ux.ajax.Simlet}.
- * To make non-simulated Ajax requests once this singleton is initialized, add a `nosim:true` option
- * to the Ajax options:
- *
- *      Ext.Ajax.request({
- *          url: 'page.php',
- *          nosim: true, // ignored by normal Ajax request
- *          params: {
- *              id: 1
- *          },
- *          success: function(response){
- *              var text = response.responseText;
- *              // process server response here
- *          }
- *      });
- */
-Ext.define('Ext.ux.ajax.SimManager', {
-    singleton: true,
-    requires: [
-        'Ext.data.Connection',
-        'Ext.ux.ajax.SimXhr',
-        'Ext.ux.ajax.Simlet',
-        'Ext.ux.ajax.JsonSimlet'
-    ],
-    /**
-     * @cfg {Ext.ux.ajax.Simlet} defaultSimlet
-     * The {@link Ext.ux.ajax.Simlet} instance to use for non-matching URL's. By default, this will
-     * return 404. Set this to null to use real Ajax calls for non-matching URL's.
-     */
-    /**
-     * @cfg {String} defaultType
-     * The default `type` to apply to generic {@link Ext.ux.ajax.Simlet} configuration objects. The
-     * default is 'basic'.
-     */
-    defaultType: 'basic',
-    /**
-     * @cfg {Number} delay
-     * The number of milliseconds to delay before delivering a response to an async request.
-     */
-    delay: 150,
-    /**
-     * @property {Boolean} ready
-     * True once this singleton has initialized and applied its Ajax hooks.
-     * @private
-     */
-    ready: false,
-    constructor: function() {
-        this.simlets = [];
-    },
-    getSimlet: function(url) {
-        var me = this,
-            index = url.indexOf('?'),
-            simlets = me.simlets,
-            len = simlets.length,
-            i, simlet, simUrl, match;
-        if (index < 0) {
-            index = url.indexOf('#');
-        }
-        if (index > 0) {
-            url = url.substring(0, index);
-        }
-        for (i = 0; i < len; ++i) {
-            simlet = simlets[i];
-            simUrl = simlet.url;
-            if (simUrl instanceof RegExp) {
-                match = simUrl.test(url);
-            }
-            else {
-                match = simUrl === url;
-            }
-            if (match) {
-                return simlet;
-            }
-        }
-        return me.defaultSimlet;
-    },
-    getXhr: function(method, url, options, async) {
-        var simlet = this.getSimlet(url);
-        if (simlet) {
-            return simlet.openRequest(method, url, options, async);
-        }
-        return null;
-    },
-    /**
-     * Initializes this singleton and applies configuration options.
-     * @param {Object} config An optional object with configuration properties to apply.
-     * @return {Ext.ux.ajax.SimManager} this
-     */
-    init: function(config) {
-        var me = this;
-        Ext.apply(me, config);
-        if (!me.ready) {
-            me.ready = true;
-            if (!('defaultSimlet' in me)) {
-                me.defaultSimlet = new Ext.ux.ajax.Simlet({
-                    status: 404,
-                    statusText: 'Not Found'
-                });
-            }
-            me._openRequest = Ext.data.Connection.prototype.openRequest;
-            Ext.data.request.Ajax.override({
-                openRequest: function(options, requestOptions, async) {
-                    var xhr = !options.nosim &&
-                              me.getXhr(requestOptions.method, requestOptions.url, options, async);
-                    if (!xhr) {
-                        xhr = this.callParent(arguments);
-                    }
-                    return xhr;
-                }
-            });
-            if (Ext.data.JsonP) {
-                Ext.data.JsonP.self.override({
-                    createScript: function(url, params, options) {
-                        var fullUrl = Ext.urlAppend(url, Ext.Object.toQueryString(params)),
-                            script = !options.nosim &&
-                                     me.getXhr('GET', fullUrl, options, true);
-                        if (!script) {
-                            script = this.callParent(arguments);
-                        }
-                        return script;
-                    },
-                    loadScript: function(request) {
-                        var script = request.script;
-                        if (script.simlet) {
-                            script.jsonpCallback = request.params[request.callbackKey];
-                            script.send(null);
-                            request.script = document.createElement('script');
-                        }
-                        else {
-                            this.callParent(arguments);
-                        }
-                    }
-                });
-            }
-        }
-        return me;
-    },
-    openRequest: function(method, url, async) {
-        var opt = {
-            method: method,
-            url: url
-        };
-        return this._openRequest.call(Ext.data.Connection.prototype, {}, opt, async);
-    },
-    /**
-     * Registeres one or more {@link Ext.ux.ajax.Simlet} instances.
-     * @param {Array/Object} simlet Either a {@link Ext.ux.ajax.Simlet} instance or config, an Array
-     * of such elements or an Object keyed by URL with values that are {@link Ext.ux.ajax.Simlet}
-     * instances or configs.
-     */
-    register: function(simlet) {
-        var me = this;
-        me.init();
-        function reg(one) {
-            var simlet = one;
-            if (!simlet.isSimlet) {
-                simlet =
-                    Ext.create('simlet.' + (simlet.type || simlet.stype || me.defaultType), one);
-            }
-            me.simlets.push(simlet);
-            simlet.manager = me;
-        }
-        if (Ext.isArray(simlet)) {
-            Ext.each(simlet, reg);
-        }
-        else if (simlet.isSimlet || simlet.url) {
-            reg(simlet);
-        }
-        else {
-            Ext.Object.each(simlet, function(url, s) {
-                s.url = url;
-                reg(s);
-            });
-        }
-        return me;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/SimXhr.js
+++ b//dev/null
@@ -1,99 +0,0 @@
-/**
- * Simulates an XMLHttpRequest object's methods and properties but is backed by a
- * {@link Ext.ux.ajax.Simlet} instance that provides the data.
- */
-Ext.define('Ext.ux.ajax.SimXhr', {
-    readyState: 0,
-    mgr: null,
-    simlet: null,
-    constructor: function(config) {
-        var me = this;
-        Ext.apply(me, config);
-        me.requestHeaders = {};
-    },
-    abort: function() {
-        var me = this;
-        if (me.timer) {
-            Ext.undefer(me.timer);
-            me.timer = null;
-        }
-        me.aborted = true;
-    },
-    getAllResponseHeaders: function() {
-        var headers = [];
-        if (Ext.isObject(this.responseHeaders)) {
-            Ext.Object.each(this.responseHeaders, function(name, value) {
-                headers.push(name + ': ' + value);
-            });
-        }
-        return headers.join('\x0d\x0a');
-    },
-    getResponseHeader: function(header) {
-        var headers = this.responseHeaders;
-        return (headers && headers[header]) || null;
-    },
-    open: function(method, url, async, user, password) {
-        var me = this;
-        me.method = method;
-        me.url = url;
-        me.async = async !== false;
-        me.user = user;
-        me.password = password;
-        me.setReadyState(1);
-    },
-    overrideMimeType: function(mimeType) {
-        this.mimeType = mimeType;
-    },
-    schedule: function() {
-        var me = this,
-            delay = me.simlet.delay || me.mgr.delay;
-        if (delay) {
-            me.timer = Ext.defer(function() {
-                me.onTick();
-            }, delay);
-        }
-        else {
-            me.onTick();
-        }
-    },
-    send: function(body) {
-        var me = this;
-        me.body = body;
-        if (me.async) {
-            me.schedule();
-        }
-        else {
-            me.onComplete();
-        }
-    },
-    setReadyState: function(state) {
-        var me = this;
-        if (me.readyState !== state) {
-            me.readyState = state;
-            me.onreadystatechange();
-        }
-    },
-    setRequestHeader: function(header, value) {
-        this.requestHeaders[header] = value;
-    },
-    onreadystatechange: Ext.emptyFn,
-    onComplete: function() {
-        var me = this,
-            callback, text;
-        me.readyState = 4;
-        Ext.apply(me, me.simlet.exec(me));
-        callback = me.jsonpCallback;
-        if (callback) {
-            text = callback + '(' + me.responseText + ')';
-            eval(text);
-        }
-    },
-    onTick: function() {
-        var me = this;
-        me.timer = null;
-        me.onComplete();
-        if (me.onreadystatechange) {
-            me.onreadystatechange();
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/Simlet.js
+++ b//dev/null
@@ -1,187 +0,0 @@
-/**
- * This is a base class for more advanced "simlets" (simulated servers). A simlet is asked
- * to provide a response given a {@link Ext.ux.ajax.SimXhr} instance.
- */
-Ext.define('Ext.ux.ajax.Simlet', function() {
-    var urlRegex = /([^?#]*)(#.*)?$/,
-        dateRegex = /^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,
-        intRegex = /^[+-]?\d+$/,
-        floatRegex = /^[+-]?\d+\.\d+$/;
-    function parseParamValue(value) {
-        var m;
-        if (Ext.isDefined(value)) {
-            value = decodeURIComponent(value);
-            if (intRegex.test(value)) {
-                value = parseInt(value, 10);
-            }
-            else if (floatRegex.test(value)) {
-                value = parseFloat(value);
-            }
-            else if (!!(m = dateRegex.exec(value))) {
-                value = new Date(Date.UTC(+m[1], +m[2] - 1, +m[3], +m[4], +m[5], +m[6]));
-            }
-        }
-        return value;
-    }
-    return {
-        alias: 'simlet.basic',
-        isSimlet: true,
-        responseProps: ['responseText', 'responseXML', 'status', 'statusText', 'responseHeaders'],
-        /**
-         * @cfg {String/Function} responseText
-         */
-        /**
-         * @cfg {String/Function} responseXML
-         */
-        /**
-         * @cfg {Object/Function} responseHeaders
-         */
-        /**
-         * @cfg {Number/Function} status
-         */
-        status: 200,
-        /**
-         * @cfg {String/Function} statusText
-         */
-        statusText: 'OK',
-        constructor: function(config) {
-            Ext.apply(this, config);
-        },
-        doGet: function(ctx) {
-            return this.handleRequest(ctx);
-        },
-        doPost: function(ctx) {
-            return this.handleRequest(ctx);
-        },
-        doRedirect: function(ctx) {
-            return false;
-        },
-        doDelete: function(ctx) {
-            var me = this,
-                xhr = ctx.xhr,
-                records = xhr.options.records;
-            me.removeFromData(ctx, records);
-        },
-        /**
-         * Performs the action requested by the given XHR and returns an object to be applied
-         * on to the XHR (containing `status`, `responseText`, etc.). For the most part,
-         * this is delegated to `doMethod` methods on this class, such as `doGet`.
-         *
-         * @param {Ext.ux.ajax.SimXhr} xhr The simulated XMLHttpRequest instance.
-         * @return {Object} The response properties to add to the XMLHttpRequest.
-         */
-        exec: function(xhr) {
-            var me = this,
-                ret = {},
-                method = 'do' + Ext.String.capitalize(xhr.method.toLowerCase()), // doGet
-                fn = me[method];
-            if (fn) {
-                ret = fn.call(me, me.getCtx(xhr.method, xhr.url, xhr));
-            }
-            else {
-                ret = { status: 405, statusText: 'Method Not Allowed' };
-            }
-            return ret;
-        },
-        getCtx: function(method, url, xhr) {
-            return {
-                method: method,
-                params: this.parseQueryString(url),
-                url: url,
-                xhr: xhr
-            };
-        },
-        handleRequest: function(ctx) {
-            var me = this,
-                ret = {},
-                val;
-            Ext.Array.forEach(me.responseProps, function(prop) {
-                if (prop in me) {
-                    val = me[prop];
-                    if (Ext.isFunction(val)) {
-                        val = val.call(me, ctx);
-                    }
-                    ret[prop] = val;
-                }
-            });
-            return ret;
-        },
-        openRequest: function(method, url, options, async) {
-            var ctx = this.getCtx(method, url),
-                redirect = this.doRedirect(ctx),
-                xhr;
-            if (options.action === 'destroy') {
-                method = 'delete';
-            }
-            if (redirect) {
-                xhr = redirect;
-            }
-            else {
-                xhr = new Ext.ux.ajax.SimXhr({
-                    mgr: this.manager,
-                    simlet: this,
-                    options: options
-                });
-                xhr.open(method, url, async);
-            }
-            return xhr;
-        },
-        parseQueryString: function(str) {
-            var m = urlRegex.exec(str),
-                ret = {},
-                key, value, pair, parts, i, n;
-            if (m && m[1]) {
-                parts = m[1].split('&');
-                for (i = 0, n = parts.length; i < n; ++i) {
-                    if ((pair = parts[i].split('='))[0]) {
-                        key = decodeURIComponent(pair.shift());
-                        value = parseParamValue((pair.length > 1) ? pair.join('=') : pair[0]);
-                        if (!(key in ret)) {
-                            ret[key] = value;
-                        }
-                        else if (Ext.isArray(ret[key])) {
-                            ret[key].push(value);
-                        }
-                        else {
-                            ret[key] = [ret[key], value];
-                        }
-                    }
-                }
-            }
-            return ret;
-        },
-        redirect: function(method, url, params) {
-            switch (arguments.length) {
-                case 2:
-                    if (typeof url === 'string') {
-                        break;
-                    }
-                    params = url;
-                case 1:
-                    url = method;
-                    method = 'GET';
-                    break;
-            }
-            if (params) {
-                url = Ext.urlAppend(url, Ext.Object.toQueryString(params));
-            }
-            return this.manager.openRequest(method, url);
-        },
-        removeFromData: function(ctx, records) {
-            var me = this,
-                data = me.getData(ctx),
-                model = (ctx.xhr.options.proxy && ctx.xhr.options.proxy.getModel()) || {},
-                idProperty = model.idProperty || 'id',
-                i;
-            Ext.each(records, function(record) {
-                var id = record.get(idProperty);
-                for (i = data.length; i-- > 0;) {
-                    if (data[i][idProperty] === id) {
-                        me.deleteRecord(i);
-                        break;
-                    }
-                }
-            });
-        }
-    };
-}());

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/ajax/XmlSimlet.js
+++ b//dev/null
@@ -1,90 +0,0 @@
-/**
- * This class simulates XML-based requests.
- */
-Ext.define('Ext.ux.ajax.XmlSimlet', {
-    extend: 'Ext.ux.ajax.DataSimlet',
-    alias: 'simlet.xml',
-    /* eslint-disable indent */
-    /**
-     * This template is used to populate the XML response. The configuration of the Reader
-     * is available so that its `root` and `record` properties can be used as well as the
-     * `fields` of the associated `model`. But beyond that, the way these pieces are put
-     * together in the document requires the flexibility of a template.
-     */
-    xmlTpl: [
-        '<{root}>\n',
-            '<tpl for="data">',
-        '    <{parent.record}>\n',
-                '<tpl for="parent.fields">',
-        '        <{name}>{[parent[values.name]]}</{name}>\n',
-                '</tpl>',
-        '    </{parent.record}>\n',
-            '</tpl>',
-        '</{root}>'
-    ],
-    /* eslint-enable indent */
-    doGet: function(ctx) {
-        var me = this,
-            data = me.getData(ctx),
-            page = me.getPage(ctx, data),
-            proxy = ctx.xhr.options.operation.getProxy(),
-            reader = proxy && proxy.getReader(),
-            model = reader && reader.getModel(),
-            ret = me.callParent(arguments), // pick up status/statusText
-            response = {
-                data: page,
-                reader: reader,
-                fields: model && model.fields,
-                root: reader && reader.getRootProperty(),
-                record: reader && reader.record
-            },
-            tpl, xml, doc;
-        if (ctx.groupSpec) {
-            response.summaryData = me.getSummary(ctx, data, page);
-        }
-        if (me.xmlTpl) {
-            tpl = Ext.XTemplate.getTpl(me, 'xmlTpl');
-            xml = tpl.apply(response);
-        }
-        else {
-            xml = data;
-        }
-        if (typeof DOMParser !== 'undefined') {
-            doc = (new DOMParser()).parseFromString(xml, "text/xml");
-        }
-        else {
-            /* global ActiveXObject */
-            doc = new ActiveXObject("Microsoft.XMLDOM");
-            doc.async = false;
-            doc.loadXML(xml);
-        }
-        ret.responseText = xml;
-        ret.responseXML = doc;
-        return ret;
-    },
-    fixTree: function() {
-        var buffer = [];
-        this.callParent(arguments);
-        this.buildTreeXml(this.data, buffer);
-        this.data = buffer.join('');
-    },
-    buildTreeXml: function(nodes, buffer) {
-        var rootProperty = this.rootProperty,
-            recordProperty = this.recordProperty;
-        buffer.push('<', rootProperty, '>');
-        Ext.Array.forEach(nodes, function(node) {
-            var key;
-            buffer.push('<', recordProperty, '>');
-            for (key in node) {
-                if (key === 'children') {
-                    this.buildTreeXml(node.children, buffer);
-                }
-                else {
-                    buffer.push('<', key, '>', node[key], '</', key, '>');
-                }
-            }
-            buffer.push('</', recordProperty, '>');
-        });
-        buffer.push('</', rootProperty, '>');
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/overrides/rating/Picker.js
+++ b//dev/null
@@ -1,28 +0,0 @@
-/**
- * @class Ext.ux.rating.Picker
- */
-Ext.define('Ext.ux.overrides.rating.Picker', {
-    override: 'Ext.ux.rating.Picker',
-    initConfig: function(config) {
-        if (config && config.tooltip) {
-            config.tip = config.tooltip;
-            Ext.log.warn('[Ext.ux.rating.Picker] The "tooltip" config was replaced by "tip"');
-        }
-        this.callParent([ config ]);
-    },
-    updateTooltipText: function(text) {
-        var innerEl = this.innerEl,
-            QuickTips = Ext.tip && Ext.tip.QuickTipManager,
-            tip = QuickTips && QuickTips.tip,
-            target;
-        if (QuickTips) {
-            innerEl.dom.setAttribute('data-qtip', text);
-            this.trackerEl.dom.setAttribute('data-qtip', text);
-            target = tip && tip.activeTarget;
-            target = target && target.el;
-            if (target && innerEl.contains(target)) {
-                tip.update(text);
-            }
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/BoxReorderer.js
+++ b//dev/null
@@ -1,349 +0,0 @@
-/**
- * Base class from Ext.ux.TabReorderer.
- */
-Ext.define('Ext.ux.BoxReorderer', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.boxreorderer',
-    requires: [
-        'Ext.ux.dd.BoxContainerDD'
-    ],
-    mixins: {
-        observable: 'Ext.util.Observable'
-    },
-    /**
-     * @cfg {String} itemSelector
-     * A {@link Ext.DomQuery DomQuery} selector which identifies the encapsulating elements of child
-     * Components which participate in reordering.
-     */
-    itemSelector: '.x-box-item',
-    /**
-     * @cfg {Mixed} animate
-     * If truthy, child reordering is animated so that moved boxes slide smoothly into position.
-     * If this option is numeric, it is used as the animation duration in milliseconds.
-     */
-    animate: 100,
-    /**
-     * @event StartDrag
-     * Fires when dragging of a child Component begins.
-     * @param {Ext.ux.BoxReorderer} this
-     * @param {Ext.container.Container} container The owning Container
-     * @param {Ext.Component} dragCmp The Component being dragged
-     * @param {Number} idx The start index of the Component being dragged.
-     */
-    /**
-     * @event Drag
-     * Fires during dragging of a child Component.
-     * @param {Ext.ux.BoxReorderer} this
-     * @param {Ext.container.Container} container The owning Container
-     * @param {Ext.Component} dragCmp The Component being dragged
-     * @param {Number} startIdx The index position from which the Component was initially dragged.
-     * @param {Number} idx The current closest index to which the Component would drop.
-     */
-    /**
-     * @event ChangeIndex
-     * Fires when dragging of a child Component causes its drop index to change.
-     * @param {Ext.ux.BoxReorderer} this
-     * @param {Ext.container.Container} container The owning Container
-     * @param {Ext.Component} dragCmp The Component being dragged
-     * @param {Number} startIdx The index position from which the Component was initially dragged.
-     * @param {Number} idx The current closest index to which the Component would drop.
-     */
-    /**
-     * @event Drop
-     * Fires when a child Component is dropped at a new index position.
-     * @param {Ext.ux.BoxReorderer} this
-     * @param {Ext.container.Container} container The owning Container
-     * @param {Ext.Component} dragCmp The Component being dropped
-     * @param {Number} startIdx The index position from which the Component was initially dragged.
-     * @param {Number} idx The index at which the Component is being dropped.
-     */
-    constructor: function() {
-        this.callParent(arguments);
-        this.mixins.observable.constructor.call(this);
-    },
-    init: function(container) {
-        var me = this,
-            layout = container.getLayout();
-        me.container = container;
-        me.names = layout._props[layout.type].names;
-        me.animatePolicy = {};
-        me.animatePolicy[me.names.x] = true;
-        me.container.on({
-            scope: me,
-            boxready: me.onBoxReady,
-            beforedestroy: me.onContainerDestroy
-        });
-    },
-    /**
-     * @private
-     * Clear up on Container destroy
-     */
-    onContainerDestroy: function() {
-        var dd = this.dd;
-        if (dd) {
-            dd.unreg();
-            this.dd = null;
-        }
-    },
-    onBoxReady: function() {
-        var me = this,
-            layout = me.container.getLayout(),
-            names = me.names,
-            dd;
-        dd = me.dd = new Ext.ux.dd.BoxContainerDD(layout.innerCt, me.container.id + '-reorderer');
-        Ext.apply(dd, {
-            animate: me.animate,
-            reorderer: me,
-            container: me.container,
-            getDragCmp: me.getDragCmp,
-            clickValidator: Ext.Function.createInterceptor(
-                dd.clickValidator, me.clickValidator, me, false
-            ),
-            onMouseDown: me.onMouseDown,
-            startDrag: me.startDrag,
-            onDrag: me.onDrag,
-            endDrag: me.endDrag,
-            getNewIndex: me.getNewIndex,
-            doSwap: me.doSwap,
-            findReorderable: me.findReorderable,
-            names: names
-        });
-        dd.dim = names.width;
-        dd.startAttr = names.beforeX;
-        dd.endAttr = names.afterX;
-    },
-    getDragCmp: function(e) {
-        return this.container.getChildByElement(e.getTarget(this.itemSelector, 10));
-    },
-    clickValidator: function(e) {
-        var cmp = this.getDragCmp(e);
-        return !!(cmp && cmp.reorderable !== false);
-    },
-    onMouseDown: function(e) {
-        var me = this,
-            container = me.container,
-            containerBox,
-            cmpEl,
-            cmpBox;
-        me.dragCmp = me.getDragCmp(e);
-        if (me.dragCmp) {
-            cmpEl = me.dragCmp.getEl();
-            me.startIndex = me.curIndex = container.items.indexOf(me.dragCmp);
-            cmpBox = cmpEl.getBox();
-            me.lastPos = cmpBox[me.startAttr];
-            containerBox = container.el.getBox();
-            if (me.dim === 'width') {
-                me.minX = containerBox.left;
-                me.maxX = containerBox.right - cmpBox.width;
-                me.minY = me.maxY = cmpBox.top;
-                me.deltaX = e.getX() - cmpBox.left;
-            }
-            else {
-                me.minY = containerBox.top;
-                me.maxY = containerBox.bottom - cmpBox.height;
-                me.minX = me.maxX = cmpBox.left;
-                me.deltaY = e.getY() - cmpBox.top;
-            }
-            me.constrainY = me.constrainX = true;
-        }
-    },
-    startDrag: function() {
-        var me = this,
-            dragCmp = me.dragCmp,
-            targetEl, dom, left, top, scrollable;
-        if (dragCmp) {
-            scrollable = me.container.getScrollable();
-            if (scrollable) {
-                scrollable.scrollBy(-1).then(function() {
-                    scrollable.scrollBy(1);
-                });
-            }
-            dragCmp.setPosition = Ext.emptyFn;
-            dragCmp.animate = false;
-            if (me.animate) {
-                me.container.getLayout().animatePolicy = me.reorderer.animatePolicy;
-            }
-            me.dragElId = dragCmp.getEl().id;
-            me.reorderer.fireEvent('StartDrag', me, me.container, dragCmp, me.curIndex);
-            dragCmp.suspendEvents();
-            dragCmp.disabled = true;
-            dragCmp.el.setStyle('zIndex', 100);
-            if (!dragCmp.nextSibling()) {
-                targetEl = me.container.layout.targetEl;
-                dom = targetEl.dom;
-                left = dom.scrollWidth - 1;
-                top = dom.scrollHeight - 1;
-                me.spacerEl = Ext.dom.Helper.append(targetEl, {
-                    tag: 'div',
-                    style: 'width: 1px;' +
-                           'height: 1px;' +
-                           'position: absolute;' +
-                           'left: ' + left + 'px;' +
-                           'top: ' + top + 'px;"'
-                });
-            }
-        }
-        else {
-            me.dragElId = null;
-        }
-    },
-    /**
-     * @private
-     * Find next or previous reorderable component index.
-     * @param {Number} newIndex The initial drop index.
-     * @return {Number} The index of the reorderable component.
-     */
-    findReorderable: function(newIndex) {
-        var me = this,
-            items = me.container.items,
-            newItem;
-        if (items.getAt(newIndex).reorderable === false) {
-            newItem = items.getAt(newIndex);
-            if (newIndex > me.startIndex) {
-                while (newItem && newItem.reorderable === false) {
-                    newIndex++;
-                    newItem = items.getAt(newIndex);
-                }
-            }
-            else {
-                while (newItem && newItem.reorderable === false) {
-                    newIndex--;
-                    newItem = items.getAt(newIndex);
-                }
-            }
-        }
-        newIndex = Math.min(Math.max(newIndex, 0), items.getCount() - 1);
-        if (items.getAt(newIndex).reorderable === false) {
-            return -1;
-        }
-        return newIndex;
-    },
-    /**
-     * @private
-     * Swap 2 components.
-     * @param {Number} newIndex The initial drop index.
-     */
-    doSwap: function(newIndex) {
-        var me = this,
-            items = me.container.items,
-            container = me.container,
-            orig, dest, tmpIndex;
-        newIndex = me.findReorderable(newIndex);
-        if (newIndex === -1 || newIndex === me.curIndex) {
-            return;
-        }
-        me.reorderer.fireEvent('ChangeIndex', me, container, me.dragCmp, me.startIndex, newIndex);
-        orig = items.getAt(me.curIndex);
-        dest = items.getAt(newIndex);
-        items.remove(orig);
-        tmpIndex = Math.min(Math.max(newIndex, 0), items.getCount() - 1);
-        items.insert(tmpIndex, orig);
-        items.remove(dest);
-        items.insert(me.curIndex, dest);
-        container.updateLayout({
-            isRoot: true
-        });
-        me.curIndex = newIndex;
-    },
-    onDrag: function(e) {
-        var me = this,
-            newIndex;
-        newIndex = me.getNewIndex(e.getPoint());
-        if ((newIndex !== undefined)) {
-            me.reorderer.fireEvent(
-                'Drag', me, me.container, me.dragCmp, me.startIndex, me.curIndex
-            );
-            me.doSwap(newIndex);
-        }
-    },
-    endDrag: function(e) {
-        var me = this,
-            dragCmp = me.dragCmp,
-            container = me.container,
-            layout = container.getLayout(),
-            temp;
-        if (e) {
-            e.stopEvent();
-        }
-        if (dragCmp) {
-            delete me.dragElId;
-            delete dragCmp.setPosition;
-            dragCmp.animate = true;
-            dragCmp.lastBox[me.names.x] = dragCmp.getPosition(true)[me.names.widthIndex];
-            container.updateLayout({
-                isRoot: true
-            });
-            temp = Ext.fx.Manager.getFxQueue(dragCmp.el.id)[0];
-            if (temp) {
-                temp.on({
-                    afteranimate: me.reorderer.afterBoxReflow,
-                    scope: me
-                });
-            }
-            else {
-                Ext.asap(me.reorderer.afterBoxReflow, me);
-            }
-            if (me.animate) {
-                delete layout.animatePolicy;
-            }
-            me.reorderer.fireEvent('drop', me, container, dragCmp, me.startIndex, me.curIndex);
-        }
-    },
-    /**
-     * @private
-     * Called after the boxes have been reflowed after the drop.
-     * Re-enabled the dragged Component.
-     */
-    afterBoxReflow: function() {
-        var me = this,
-            spacerEl = Ext.fly(me.spacerEl),
-            dragCmp = me.dragCmp;
-        dragCmp.el.setStyle('zIndex', '');
-        dragCmp.disabled = false;
-        dragCmp.resumeEvents();
-        if (spacerEl) {
-            spacerEl.remove();
-            me.spacerEl = null;
-        }
-    },
-    /**
-     * @private
-     * Calculate drop index based upon the dragEl's position.
-     */
-    getNewIndex: function(pointerPos) {
-        var me = this,
-            dragEl = me.getDragEl(),
-            dragBox = Ext.fly(dragEl).getBox(),
-            targetEl,
-            targetBox,
-            targetMidpoint,
-            i = 0,
-            it = me.container.items.items,
-            ln = it.length,
-            lastPos = me.lastPos;
-        me.lastPos = dragBox[me.startAttr];
-        for (; i < ln; i++) {
-            targetEl = it[i].getEl();
-            if (targetEl.dom !== dragEl && targetEl.is(me.reorderer.itemSelector)) {
-                targetBox = targetEl.getBox();
-                targetMidpoint = targetBox[me.startAttr] + (targetBox[me.dim] >> 1);
-                if (i < me.curIndex) {
-                    if (
-                        (dragBox[me.startAttr] < lastPos) &&
-                        (dragBox[me.startAttr] < (targetMidpoint - 5))
-                    ) {
-                        return i;
-                    }
-                }
-                else if (i > me.curIndex) {
-                    if (
-                        (dragBox[me.startAttr] > lastPos) &&
-                        (dragBox[me.endAttr] > (targetMidpoint + 5))
-                    ) {
-                        return i;
-                    }
-                }
-            }
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/CellDragDrop.js
+++ b//dev/null
@@ -1,262 +0,0 @@
-/**
- * This plugin can enable a cell to cell drag and drop operation within the same grid view.
- *
- * Note that the plugin must be added to the grid view, not to the grid panel. For example,
- * using {@link Ext.panel.Table viewConfig}:
- *
- *      viewConfig: {
- *          plugins: {
- *              celldragdrop: {
- *                  // Remove text from source cell and replace with value of emptyText.
- *                  applyEmptyText: true,
- *
- *                  //emptyText: Ext.String.htmlEncode('<<foo>>'),
- *
- *                  // Will only allow drops of the same type.
- *                  enforceType: true
- *              }
- *          }
- *      }
- */
-Ext.define('Ext.ux.CellDragDrop', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.celldragdrop',
-    uses: ['Ext.view.DragZone'],
-    /**
-     * @cfg {Boolean} enforceType
-     * Set to `true` to only allow drops of the same type.
-     *
-     * Defaults to `false`.
-     */
-    enforceType: false,
-    /**
-     * @cfg {Boolean} applyEmptyText
-     * If `true`, then use the value of {@link #emptyText} to replace the drag record's value
-     * after a node drop. Note that, if dropped on a cell of a different type, it will convert
-     * the default text according to its own conversion rules.
-     *
-     * Defaults to `false`.
-     */
-    applyEmptyText: false,
-    /**
-     * @cfg {String} emptyText
-     * If {@link #applyEmptyText} is `true`, then this value as the drag record's value after
-     * a node drop.
-     *
-     * Defaults to an empty string.
-     */
-    emptyText: '',
-    /**
-     * @cfg {String} dropBackgroundColor
-     * The default background color for when a drop is allowed.
-     *
-     * Defaults to green.
-     */
-    dropBackgroundColor: 'green',
-    /**
-     * @cfg {String} noDropBackgroundColor
-     * The default background color for when a drop is not allowed.
-     *
-     * Defaults to red.
-     */
-    noDropBackgroundColor: 'red',
-    /**
-     * @cfg {String} dragText
-     * The text to show while dragging.
-     *
-     * Two placeholders can be used in the text:
-     *
-     * - `{0}` The number of selected items.
-     * - `{1}` 's' when more than 1 items (only useful for English).
-     * @locale
-     */
-    dragText: '{0} selected row{1}',
-    /**
-     * @cfg {String} ddGroup
-     * A named drag drop group to which this object belongs. If a group is specified, then both
-     * the DragZones and DropZone used by this plugin will only interact with other drag drop
-     * objects in the same group.
-     */
-    ddGroup: "GridDD",
-    /**
-     * @cfg {Boolean} enableDrop
-     * Set to `false` to disallow the View from accepting drop gestures.
-     */
-    enableDrop: true,
-    /**
-     * @cfg {Boolean} enableDrag
-     * Set to `false` to disallow dragging items from the View.
-     */
-    enableDrag: true,
-    /**
-     * @cfg {Object/Boolean} containerScroll
-     * True to register this container with the Scrollmanager for auto scrolling during drag
-     * operations. A {@link Ext.dd.ScrollManager} configuration may also be passed.
-     */
-    containerScroll: false,
-    init: function(view) {
-        var me = this;
-        view.on('render', me.onViewRender, me, {
-            single: true
-        });
-    },
-    destroy: function() {
-        var me = this;
-        me.dragZone = me.dropZone = Ext.destroy(me.dragZone, me.dropZone);
-        me.callParent();
-    },
-    enable: function() {
-        var me = this;
-        if (me.dragZone) {
-            me.dragZone.unlock();
-        }
-        if (me.dropZone) {
-            me.dropZone.unlock();
-        }
-        me.callParent();
-    },
-    disable: function() {
-        var me = this;
-        if (me.dragZone) {
-            me.dragZone.lock();
-        }
-        if (me.dropZone) {
-            me.dropZone.lock();
-        }
-        me.callParent();
-    },
-    onViewRender: function(view) {
-        var me = this,
-            scrollEl;
-        if (me.enableDrag) {
-            if (me.containerScroll) {
-                scrollEl = view.getEl();
-            }
-            me.dragZone = new Ext.view.DragZone({
-                view: view,
-                ddGroup: me.dragGroup || me.ddGroup,
-                dragText: me.dragText,
-                containerScroll: me.containerScroll,
-                scrollEl: scrollEl,
-                getDragData: function(e) {
-                    var view = this.view,
-                        item = e.getTarget(view.getItemSelector()),
-                        record = view.getRecord(item),
-                        cell = e.getTarget(view.getCellSelector()),
-                        dragEl, header;
-                    if (item) {
-                        dragEl = document.createElement('div');
-                        dragEl.className = 'x-form-text';
-                        dragEl.appendChild(
-                            document.createTextNode(cell.textContent || cell.innerText)
-                        );
-                        header = view.getHeaderByCell(cell);
-                        return {
-                            event: new Ext.EventObjectImpl(e),
-                            ddel: dragEl,
-                            item: e.target,
-                            columnName: header.dataIndex,
-                            record: record
-                        };
-                    }
-                },
-                onInitDrag: function(x, y) {
-                    var self = this,
-                        data = self.dragData,
-                        view = self.view,
-                        selectionModel = view.getSelectionModel(),
-                        record = data.record,
-                        el = data.ddel;
-                    if (!selectionModel.isSelected(record)) {
-                        selectionModel.select(record, true);
-                    }
-                    Ext.fly(self.ddel).update(el.textContent || el.innerText);
-                    self.proxy.update(self.ddel);
-                    self.onStartDrag(x, y);
-                    return true;
-                }
-            });
-        }
-        if (me.enableDrop) {
-            me.dropZone = new Ext.dd.DropZone(view.el, {
-                view: view,
-                ddGroup: me.dropGroup || me.ddGroup,
-                containerScroll: true,
-                getTargetFromEvent: function(e) {
-                    var self = this,
-                        view = self.view,
-                        cell = e.getTarget(view.cellSelector),
-                        row, header;
-                    if (cell) {
-                        row = view.findItemByChild(cell);
-                        header = view.getHeaderByCell(cell);
-                        if (row && header) {
-                            return {
-                                node: cell,
-                                record: view.getRecord(row),
-                                columnName: header.dataIndex
-                            };
-                        }
-                    }
-                },
-                onNodeEnter: function(target, dd, e, dragData) {
-                    var self = this,
-                        destType, sourceType;
-                    destType = target.record.getField(target.columnName).type.toUpperCase();
-                    sourceType = dragData.record.getField(dragData.columnName).type.toUpperCase();
-                    delete self.dropOK;
-                    if (!target || target.node === dragData.item.parentNode) {
-                        return;
-                    }
-                    if (me.enforceType && destType !== sourceType) {
-                        self.dropOK = false;
-                        if (me.noDropCls) {
-                            Ext.fly(target.node).addCls(me.noDropCls);
-                        }
-                        else {
-                            Ext.fly(target.node).applyStyles({
-                                backgroundColor: me.noDropBackgroundColor
-                            });
-                        }
-                        return false;
-                    }
-                    self.dropOK = true;
-                    if (me.dropCls) {
-                        Ext.fly(target.node).addCls(me.dropCls);
-                    }
-                    else {
-                        Ext.fly(target.node).applyStyles({
-                            backgroundColor: me.dropBackgroundColor
-                        });
-                    }
-                },
-                onNodeOver: function(target, dd, e, dragData) {
-                    return this.dropOK ? this.dropAllowed : this.dropNotAllowed;
-                },
-                onNodeOut: function(target, dd, e, dragData) {
-                    var cls = this.dropOK ? me.dropCls : me.noDropCls;
-                    if (cls) {
-                        Ext.fly(target.node).removeCls(cls);
-                    }
-                    else {
-                        Ext.fly(target.node).applyStyles({
-                            backgroundColor: ''
-                        });
-                    }
-                },
-                onNodeDrop: function(target, dd, e, dragData) {
-                    if (this.dropOK) {
-                        target.record.set(
-                            target.columnName, dragData.record.get(dragData.columnName)
-                        );
-                        if (me.applyEmptyText) {
-                            dragData.record.set(dragData.columnName, me.emptyText);
-                        }
-                        return true;
-                    }
-                },
-                onCellDrop: Ext.emptyFn
-            });
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataTip.js
+++ b//dev/null
@@ -1,120 +0,0 @@
-/**
- * @class Ext.ux.DataTip
- * @extends Ext.tip.ToolTip
- * This plugin implements automatic tooltip generation for an arbitrary number of child nodes
- * *within* a Component.
- *
- * This plugin is applied to a high level Component, which contains repeating elements,
- * and depending on the host Component type, it automatically selects
- * a {@link Ext.ToolTip#delegate delegate} so that it appears when the mouse enters a sub-element.
- *
- * When applied to a GridPanel, this ToolTip appears when over a row, and the Record's data
- * is applied using this object's {@link #tpl} template.
- *
- * When applied to a DataView, this ToolTip appears when over a view node, and the Record's data
- * is applied using this object's {@link #tpl} template.
- *
- * When applied to a TreePanel, this ToolTip appears when over a tree node, and the Node's
- * {@link Ext.data.Model} record data is applied using this object's {@link #tpl} template.
- *
- * When applied to a FormPanel, this ToolTip appears when over a Field, and the Field's `tooltip`
- * property is used is applied using this object's {@link #tpl} template, or if it is a string,
- * used as HTML content. If there is no `tooltip` property, the field itself is used
- * as the template's data object.
- *
- * If more complex logic is needed to determine content, then the {@link #beforeshow} event
- * may be used. This class also publishes a **`beforeshowtip`** event through its host Component.
- * The *host Component* fires the **`beforeshowtip`** event.
- */
-Ext.define('Ext.ux.DataTip', function(DataTip) {
-    function onHostRender() {
-        var e = this.isXType('panel') ? this.body : this.el;
-        if (this.dataTip.renderToTarget) {
-            this.dataTip.render(e);
-        }
-        this.dataTip.setTarget(e);
-    }
-    function updateTip(tip, data) {
-        if (tip.rendered) {
-            if (tip.host.fireEvent('beforeshowtip', tip.eventHost, tip, data) === false) {
-                return false;
-            }
-            tip.update(data);
-        }
-        else {
-            if (Ext.isString(data)) {
-                tip.html = data;
-            }
-            else {
-                tip.data = data;
-            }
-        }
-    }
-    function beforeViewTipShow(tip) {
-        var rec = this.view.getRecord(tip.triggerElement),
-            data;
-        if (rec) {
-            data = tip.initialConfig.data ? Ext.apply(tip.initialConfig.data, rec.data) : rec.data;
-            return updateTip(tip, data);
-        }
-        else {
-            return false;
-        }
-    }
-    function beforeFormTipShow(tip) {
-        var field = Ext.getCmp(tip.triggerElement.id);
-        if (field && (field.tooltip || tip.tpl)) {
-            return updateTip(tip, field.tooltip || field);
-        }
-        else {
-            return false;
-        }
-    }
-    return {
-        extend: 'Ext.tip.ToolTip',
-        mixins: {
-            plugin: 'Ext.plugin.Abstract'
-        },
-        alias: 'plugin.datatip',
-        lockableScope: 'both',
-        constructor: function(config) {
-            var me = this;
-            me.callParent([config]);
-            me.mixins.plugin.constructor.call(me, config);
-        },
-        init: function(host) {
-            var me = this;
-            me.mixins.plugin.init.call(me, host);
-            host.dataTip = me;
-            me.host = host;
-            if (host.isXType('tablepanel')) {
-                me.view = host.getView();
-                if (host.ownerLockable) {
-                    me.host = host.ownerLockable;
-                }
-                me.delegate = me.delegate || me.view.rowSelector;
-                me.on('beforeshow', beforeViewTipShow);
-            }
-            else if (host.isXType('dataview')) {
-                me.view = me.host;
-                me.delegate = me.delegate || host.itemSelector;
-                me.on('beforeshow', beforeViewTipShow);
-            }
-            else if (host.isXType('form')) {
-                me.delegate = '.' + Ext.form.Labelable.prototype.formItemCls;
-                me.on('beforeshow', beforeFormTipShow);
-            }
-            else if (host.isXType('combobox')) {
-                me.view = host.getPicker();
-                me.delegate = me.delegate || me.view.getItemSelector();
-                me.on('beforeshow', beforeViewTipShow);
-            }
-            if (host.rendered) {
-                onHostRender.call(host);
-            }
-            else {
-                host.onRender = Ext.Function.createSequence(host.onRender, onHostRender);
-            }
-        }
-    };
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataView/Animated.js
+++ b//dev/null
@@ -1,280 +0,0 @@
-/**
- * Transition plugin for DataViews
- */
-Ext.define('Ext.ux.DataView.Animated', {
-    alias: 'plugin.ux-animated-dataview',
-    /**
-     * @property defaults
-     * @type Object
-     * Default configuration options for all DataViewTransition instances
-     */
-    defaults: {
-        duration: 750,
-        idProperty: 'id'
-    },
-    /**
-     * Creates the plugin instance, applies defaults
-     * @constructor
-     * @param {Object} config Optional config object
-     */
-    constructor: function(config) {
-        Ext.apply(this, config || {}, this.defaults);
-    },
-    /**
-     * Initializes the transition plugin. Overrides the dataview's default refresh function
-     * @param {Ext.view.View} dataview The dataview
-     */
-    init: function(dataview) {
-        var me = this,
-            store = dataview.store,
-            items = dataview.all,
-            task = {
-                interval: 20
-            },
-            duration = me.duration;
-        /**
-         * @property dataview
-         * @type Ext.view.View
-         * Reference to the DataView this instance is bound to
-         */
-        me.dataview = dataview;
-        dataview.blockRefresh = true;
-        dataview.updateIndexes = Ext.Function.createSequence(dataview.updateIndexes, function() {
-            this.getTargetEl().select(this.itemSelector).each(function(element, composite, index) {
-                element.dom.id = Ext.util.Format.format(
-                    "{0}-{1}", dataview.id, store.getAt(index).internalId
-                );
-            }, this);
-        }, dataview);
-        /**
-         * @property dataviewID
-         * @type String
-         * The string ID of the DataView component. This is used internally when animating
-         * child objects
-         */
-        me.dataviewID = dataview.id;
-        /**
-         * @property cachedStoreData
-         * @type Object
-         * A cache of existing store data, keyed by id. This is used to determine
-         * whether any items were added or removed from the store on data change
-         */
-        me.cachedStoreData = {};
-        me.cacheStoreData(store.data || store.snapshot);
-        dataview.on('resize', function() {
-            var store = dataview.store;
-            if (store.getCount() > 0) {
-            }
-        }, this);
-        dataview.store.on({
-            datachanged: reDraw,
-            scope: this,
-            buffer: 50
-        });
-        function reDraw() {
-            var parentEl = dataview.getTargetEl(),
-                parentElY = parentEl.getY(),
-                parentElPaddingTop = parentEl.getPadding('t'),
-                added = me.getAdded(store),
-                removed = me.getRemoved(store),
-                remaining = me.getRemaining(store),
-                itemArray,
-                i, id,
-                itemFly = new Ext.dom.Fly(),
-                rtl = me.dataview.getInherited().rtl,
-                oldPos, newPos,
-                styleSide = rtl ? 'right' : 'left',
-                newStyle = {},
-                oldPositions, newPositions, doAnimate;
-            if (!parentEl) {
-                return;
-            }
-            Ext.iterate(removed, function(recId, item) {
-                id = me.dataviewID + '-' + recId;
-                Ext.fx.Manager.stopAnimation(id);
-                item.dom = Ext.getDom(id);
-                if (!item.dom) {
-                    delete removed[recId];
-                }
-            });
-            me.cacheStoreData(store);
-            oldPositions = {};
-            newPositions = {};
-            Ext.iterate(remaining, function(id, item) {
-                if (itemFly.attach(Ext.getDom(me.dataviewID + '-' + id))) {
-                    oldPos = oldPositions[id] = {
-                        top: itemFly.getY() - parentElY - itemFly.getMargin('t') -
-                             parentElPaddingTop
-                    };
-                    oldPos[styleSide] = me.getItemX(itemFly);
-                }
-                else {
-                    delete remaining[id];
-                }
-            });
-            dataview.refresh();
-            Ext.iterate(removed, function(id, item) {
-                parentEl.dom.appendChild(item.dom);
-                itemFly.attach(item.dom).animate({
-                    duration: duration,
-                    opacity: 0,
-                    callback: function(anim) {
-                        var el = Ext.get(anim.target.id);
-                        if (el) {
-                            el.destroy();
-                        }
-                    }
-                });
-                delete item.dom;
-            });
-            if (!store.getCount()) {
-                return;
-            }
-            itemArray = items.slice();
-            for (i = itemArray.length - 1; i >= 0; i--) {
-                id = store.getAt(i).internalId;
-                itemFly.attach(itemArray[i]);
-                newPositions[id] = {
-                    dom: itemFly.dom,
-                    top: itemFly.getY() - parentElY - itemFly.getMargin('t') - parentElPaddingTop
-                };
-                newPositions[id][styleSide] = me.getItemX(itemFly);
-                newPos = oldPositions[id] || newPositions[id];
-                newStyle.position = 'absolute';
-                newStyle.top = newPos.top + "px";
-                newStyle[styleSide] = newPos.left + "px";
-                itemFly.applyStyles(newStyle);
-            }
-            doAnimate = function() {
-                var elapsed = new Date() - task.taskStartTime,
-                    fraction = elapsed / duration,
-                    oldPos, newPos, oldTop, newTop, oldLeft, newLeft,
-                    diffTop, diffLeft, midTop, midLeft;
-                if (fraction >= 1) {
-                    newStyle.position = newStyle.top = newStyle[styleSide] = '';
-                    for (id in newPositions) {
-                        itemFly.attach(newPositions[id].dom).applyStyles(newStyle);
-                    }
-                    Ext.TaskManager.stop(task);
-                }
-                else {
-                    for (id in remaining) {
-                        oldPos = oldPositions[id];
-                        newPos = newPositions[id];
-                        oldTop = oldPos.top;
-                        newTop = newPos.top;
-                        oldLeft = oldPos[styleSide];
-                        newLeft = newPos[styleSide];
-                        diffTop = fraction * Math.abs(oldTop - newTop);
-                        diffLeft = fraction * Math.abs(oldLeft - newLeft);
-                        midTop = oldTop > newTop ? oldTop - diffTop : oldTop + diffTop;
-                        midLeft = oldLeft > newLeft ? oldLeft - diffLeft : oldLeft + diffLeft;
-                        newStyle.top = midTop + "px";
-                        newStyle[styleSide] = midLeft + "px";
-                        itemFly.attach(newPos.dom).applyStyles(newStyle);
-                    }
-                }
-            };
-            Ext.iterate(added, function(id, item) {
-                if (itemFly.attach(Ext.getDom(me.dataviewID + '-' + id))) {
-                    itemFly.setOpacity(0);
-                    itemFly.animate({
-                        duration: duration,
-                        opacity: 1
-                    });
-                }
-            });
-            Ext.TaskManager.stop(task);
-            task.run = doAnimate;
-            Ext.TaskManager.start(task);
-            me.cacheStoreData(store);
-        }
-    },
-    getItemX: function(el) {
-        var rtl = this.dataview.getInherited().rtl,
-            parentEl = el.up('');
-        if (rtl) {
-            return parentEl.getViewRegion().right - el.getRegion().right + el.getMargin('r');
-        }
-        else {
-            return el.getX() - parentEl.getX() - el.getMargin('l') - parentEl.getPadding('l');
-        }
-    },
-    /**
-     * Caches the records from a store locally for comparison later
-     * @param {Ext.data.Store} store The store to cache data from
-     */
-    cacheStoreData: function(store) {
-        var cachedStoreData = this.cachedStoreData = {};
-        store.each(function(record) {
-            cachedStoreData[record.internalId] = record;
-        });
-    },
-    /**
-     * Returns all records that were already in the DataView
-     * @return {Object} All existing records
-     */
-    getExisting: function() {
-        return this.cachedStoreData;
-    },
-    /**
-     * Returns the total number of items that are currently visible in the DataView
-     * @return {Number} The number of existing items
-     */
-    getExistingCount: function() {
-        var count = 0,
-            items = this.getExisting(),
-            k; // eslint-disable-line no-unused-vars
-        for (k in items) {
-            count++;
-        }
-        return count;
-    },
-    /**
-     * Returns all records in the given store that were not already present
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Object} Object of records not already present in the dataview in format {id: record}
-     */
-    getAdded: function(store) {
-        var cachedStoreData = this.cachedStoreData,
-            added = {};
-        store.each(function(record) {
-            if (cachedStoreData[record.internalId] == null) {
-                added[record.internalId] = record;
-            }
-        });
-        return added;
-    },
-    /**
-     * Returns all records that are present in the DataView but not the new store
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Array} Array of records that used to be present
-     */
-    getRemoved: function(store) {
-        var cachedStoreData = this.cachedStoreData,
-            removed = {},
-            id;
-        for (id in cachedStoreData) {
-            if (store.findBy(function(record) { return record.internalId === id }) === -1) {
-                removed[id] = cachedStoreData[id];
-            }
-        }
-        return removed;
-    },
-    /**
-     * Returns all records that are already present and are still present in the new store
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Object} Object of records that are still present from last time in format
-     * {id: record}
-     */
-    getRemaining: function(store) {
-        var cachedStoreData = this.cachedStoreData,
-            remaining = {};
-        store.each(function(record) {
-            if (cachedStoreData[record.internalId] != null) {
-                remaining[record.internalId] = record;
-            }
-        });
-        return remaining;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataView/DragSelector.js
+++ b//dev/null
@@ -1,175 +0,0 @@
-/**
- *
- */
-Ext.define('Ext.ux.DataView.DragSelector', {
-    requires: ['Ext.dd.DragTracker', 'Ext.util.Region'],
-    alias: 'plugin.dataviewdragselector',
-    /**
-     * Initializes the plugin by setting up the drag tracker
-     */
-    init: function(dataview) {
-        var scroller = dataview.getScrollable();
-        if (scroller && (scroller.getX() || scroller.getY()) &&
-            (Ext.supports.PointerEvents || Ext.supports.MSPointerEvents)) {
-            Ext.log.warn('DragSelector not available on PointerEvent devices');
-            return;
-        }
-        /**
-         * @property dataview
-         * @type Ext.view.View
-         * The DataView bound to this instance
-         */
-        this.dataview = dataview;
-        dataview.mon(dataview, {
-            beforecontainerclick: this.cancelClick,
-            scope: this,
-            render: {
-                fn: this.onRender,
-                scope: this,
-                single: true
-            }
-        });
-    },
-    /**
-     * @private
-     * Called when the attached DataView is rendered. This sets up the DragTracker instance
-     * that will be used to created a dragged selection area
-     */
-    onRender: function() {
-        /**
-         * @property tracker
-         * @type Ext.dd.DragTracker
-         * The DragTracker attached to this instance. Note that the 4 on* functions are called
-         * in the scope of the  DragTracker ('this' refers to the DragTracker inside those
-         * functions), so we pass a reference to the  DragSelector so that we can call
-         * this class's functions.
-         */
-        this.tracker = Ext.create('Ext.dd.DragTracker', {
-            dataview: this.dataview,
-            el: this.dataview.el,
-            onBeforeStart: this.onBeforeStart,
-            onStart: this.onStart.bind(this),
-            onDrag: this.onDrag.bind(this),
-            onEnd: Ext.Function.createDelayed(this.onEnd, 100, this)
-        });
-        /**
-         * @property dragRegion
-         * @type Ext.util.Region
-         * Represents the region currently dragged out by the user. This is used to figure out
-         * which dataview nodes are in the selected area and to set the size of the Proxy element
-         * used to highlight the current drag area
-         */
-        this.dragRegion = Ext.create('Ext.util.Region');
-    },
-    /**
-     * @private
-     * Listener attached to the DragTracker's onBeforeStart event. Returns false if the drag
-     * didn't start within the DataView's el
-     */
-    onBeforeStart: function(e) {
-        return e.target === this.dataview.getEl().dom;
-    },
-    /**
-     * @private
-     * Listener attached to the DragTracker's onStart event. Cancel's the DataView's containerclick
-     * event from firing and sets the start co-ordinates of the Proxy element. Clears any existing
-     * DataView selection
-     * @param {Ext.event.Event} e The click event
-     */
-    onStart: function(e) {
-        var dataview = this.dataview;
-        this.dragging = true;
-        this.fillRegions();
-        this.getProxy().show();
-        dataview.getSelectionModel().deselectAll();
-    },
-    /**
-     * @private
-     * Reusable handler that's used to cancel the container click event when dragging on the
-     * dataview. See onStart for details
-     */
-    cancelClick: function() {
-        return !this.dragging;
-    },
-    /**
-     * @private
-     * Listener attached to the DragTracker's onDrag event. Figures out how large the drag selection
-     * area should be and updates the proxy element's size to match. Then iterates over all of the
-     * rendered items and marks them selected if the drag region touches them
-     * @param {Ext.event.Event} e The drag event
-     */
-    onDrag: function(e) {
-        var selModel = this.dataview.getSelectionModel(),
-            dragRegion = this.dragRegion,
-            bodyRegion = this.bodyRegion,
-            proxy = this.getProxy(),
-            regions = this.regions,
-            length = regions.length,
-            startXY = this.tracker.startXY,
-            currentXY = this.tracker.getXY(),
-            minX = Math.min(startXY[0], currentXY[0]),
-            minY = Math.min(startXY[1], currentXY[1]),
-            width = Math.abs(startXY[0] - currentXY[0]),
-            height = Math.abs(startXY[1] - currentXY[1]),
-            region, selected, i;
-        Ext.apply(dragRegion, {
-            top: minY,
-            left: minX,
-            right: minX + width,
-            bottom: minY + height
-        });
-        dragRegion.constrainTo(bodyRegion);
-        proxy.setBox(dragRegion);
-        for (i = 0; i < length; i++) {
-            region = regions[i];
-            selected = dragRegion.intersect(region);
-            if (selected) {
-                selModel.select(i, true);
-            }
-            else {
-                selModel.deselect(i);
-            }
-        }
-    },
-    /**
-     * @method
-     * @private
-     * Listener attached to the DragTracker's onEnd event. This is a delayed function which
-     * executes 1 millisecond after it has been called. This is because the dragging flag must
-     * remain active to cancel the containerclick event which the mouseup event will trigger.
-     * @param {Ext.event.Event} e The event object
-     */
-    onEnd: function(e) {
-        var dataview = this.dataview,
-            selModel = dataview.getSelectionModel(); // eslint-disable-line no-unused-vars
-        this.dragging = false;
-        this.getProxy().hide();
-    },
-    /**
-     * @private
-     * Creates a Proxy element that will be used to highlight the drag selection region
-     * @return {Ext.Element} The Proxy element
-     */
-    getProxy: function() {
-        if (!this.proxy) {
-            this.proxy = this.dataview.getEl().createChild({
-                tag: 'div',
-                cls: 'x-view-selector'
-            });
-        }
-        return this.proxy;
-    },
-    /**
-     * @private
-     * Gets the region taken up by each rendered node in the DataView. We use these regions
-     * to figure out which nodes to select based on the selector region the user has dragged out
-     */
-    fillRegions: function() {
-        var dataview = this.dataview,
-            regions = this.regions = [];
-        dataview.all.each(function(node) {
-            regions.push(node.getRegion());
-        });
-        this.bodyRegion = dataview.getEl().getRegion();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataView/Draggable.js
+++ b//dev/null
@@ -1,216 +0,0 @@
-/**
- * ## Basic DataView with Draggable mixin.
- *
- *     Ext.Loader.setPath('Ext.ux', '../../../SDK/extjs/examples/ux');
- *
- *     Ext.define('My.cool.View', {
- *         extend: 'Ext.view.View',
- *
- *         mixins: {
- *             draggable: 'Ext.ux.DataView.Draggable'
- *         },
- *
- *         initComponent: function() {
- *             this.mixins.draggable.init(this, {
- *                 ddConfig: {
- *                     ddGroup: 'someGroup'
- *                 }
- *             });
- * 
- *             this.callParent(arguments);
- *         }
- *     });
- *
- *     Ext.onReady(function () {
- *         Ext.create('Ext.data.Store', {
- *             storeId: 'baseball',
- *             fields: ['team', 'established'],
- *             data: [
- *                 { team: 'Atlanta Braves', established: '1871' },
- *                 { team: 'Miami Marlins', established: '1993' },
- *                 { team: 'New York Mets', established: '1962' },
- *                 { team: 'Philadelphia Phillies', established: '1883' },
- *                 { team: 'Washington Nationals', established: '1969' }
- *             ]
- *          });
- *
- *          Ext.create('My.cool.View', {
- *              store: Ext.StoreMgr.get('baseball'),
- *              tpl: [
- *                  '<tpl for=".">', 
- *                      '<p class="team">', 
- *                          'The {team} were founded in {established}.',
- *                      '</p>', 
- *                  '</tpl>'
- *              ],
- *              itemSelector: 'p.team',
- *              renderTo: Ext.getBody()
- *          });
- *      });
- */
-Ext.define('Ext.ux.DataView.Draggable', {
-    requires: 'Ext.dd.DragZone',
-    /**
-     * @cfg {String} ghostCls The CSS class added to the outermost element of the created
-     * ghost proxy (defaults to 'x-dataview-draggable-ghost')
-     */
-    ghostCls: 'x-dataview-draggable-ghost',
-    /**
-     * @cfg {Ext.XTemplate/Array} ghostTpl The template used in the ghost DataView
-     */
-    ghostTpl: [
-        '<tpl for=".">',
-            '{title}', // eslint-disable-line indent
-        '</tpl>'
-    ],
-    /**
-     * @cfg {Object} ddConfig Config object that is applied to the internally created DragZone
-     */
-    /**
-     * @cfg {String} ghostConfig Config object that is used to configure the internally created
-     * DataView
-     */
-    init: function(dataview, config) {
-        /**
-         * @property dataview
-         * @type Ext.view.View
-         * The Ext.view.View instance that this DragZone is attached to
-         */
-        this.dataview = dataview;
-        dataview.on('render', this.onRender, this);
-        Ext.apply(this, {
-            itemSelector: dataview.itemSelector,
-            ghostConfig: {}
-        }, config || {});
-        Ext.applyIf(this.ghostConfig, {
-            itemSelector: 'img',
-            cls: this.ghostCls,
-            tpl: this.ghostTpl
-        });
-    },
-    /**
-     * @private
-     * Called when the attached DataView is rendered. Sets up the internal DragZone
-     */
-    onRender: function() {
-        var me = this,
-            config = Ext.apply({}, me.ddConfig || {}, {
-                dvDraggable: me,
-                dataview: me.dataview,
-                getDragData: me.getDragData,
-                getTreeNode: me.getTreeNode,
-                afterRepair: me.afterRepair,
-                getRepairXY: me.getRepairXY
-            });
-        /**
-         * @property dragZone
-         * @type Ext.dd.DragZone
-         * The attached DragZone instane
-         */
-        me.dragZone = Ext.create('Ext.dd.DragZone', me.dataview.getEl(), config);
-        me.dataview.setItemsDraggable(true);
-    },
-    getDragData: function(e) {
-        var draggable = this.dvDraggable,
-            dataview = this.dataview,
-            selModel = dataview.getSelectionModel(),
-            target = e.getTarget(draggable.itemSelector),
-            selected, dragData;
-        if (target) {
-            e.preventDefault();
-            if (!dataview.isSelected(target)) {
-                selModel.select(dataview.getRecord(target));
-            }
-            selected = dataview.getSelectedNodes();
-            dragData = {
-                copy: true,
-                nodes: selected,
-                records: selModel.getSelection(),
-                item: true
-            };
-            if (selected.length === 1) {
-                dragData.single = true;
-                dragData.ddel = target;
-            }
-            else {
-                dragData.multi = true;
-                dragData.ddel = draggable.prepareGhost(selModel.getSelection());
-            }
-            return dragData;
-        }
-        return false;
-    },
-    getTreeNode: function() {
-    },
-    afterRepair: function() {
-        var nodes = this.dragData.nodes,
-            length = nodes.length,
-            i;
-        this.dragging = false;
-        for (i = 0; i < length; i++) {
-            Ext.get(nodes[i]).frame('#8db2e3', 1);
-        }
-    },
-    /**
-     * @private
-     * Returns the x and y co-ordinates that the dragged item should be animated back to if it
-     * was dropped on an invalid drop target. If we're dragging more than one item we don't animate
-     * back and just allow afterRepair to frame each dropped item.
-     */
-    getRepairXY: function(e) {
-        var repairEl, repairXY;
-        if (this.dragData.multi) {
-            return false;
-        }
-        else {
-            repairEl = Ext.get(this.dragData.ddel);
-            repairXY = repairEl.getXY();
-            repairXY[0] += repairEl.getPadding('t') + repairEl.getMargin('t');
-            repairXY[1] += repairEl.getPadding('l') + repairEl.getMargin('l');
-            return repairXY;
-        }
-    },
-    /**
-     * Updates the internal ghost DataView by ensuring it is rendered and contains the correct
-     * records
-     * @param {Array} records The set of records that is currently selected in the parent DataView
-     * @return {HTMLElement} The Ghost DataView's encapsulating HTMLElement.
-     */
-    prepareGhost: function(records) {
-        return this.createGhost(records).getEl().dom;
-    },
-    /**
-     * @private
-     * Creates the 'ghost' DataView that follows the mouse cursor during the drag operation.
-     * This div is usually a lighter-weight representation of just the nodes that are selected
-     * in the parent DataView.
-     */
-    createGhost: function(records) {
-        var me = this,
-            store;
-        if (me.ghost) {
-            (store = me.ghost.store).loadRecords(records);
-        }
-        else {
-            store = Ext.create('Ext.data.Store', {
-                model: records[0].self
-            });
-            store.loadRecords(records);
-            me.ghost = Ext.create('Ext.view.View', Ext.apply({
-                renderTo: document.createElement('div'),
-                store: store
-            }, me.ghostConfig));
-            me.ghost.container.skipGarbageCollection = me.ghost.el.skipGarbageCollection = true;
-        }
-        store.clearData();
-        return me.ghost;
-    },
-    destroy: function() {
-        var ghost = this.ghost;
-        if (ghost) {
-            ghost.container.destroy();
-            ghost.destroy();
-        }
-        this.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataView/LabelEditor.js
+++ b//dev/null
@@ -1,57 +0,0 @@
-/**
- *
- */
-Ext.define('Ext.ux.DataView.LabelEditor', {
-    extend: 'Ext.Editor',
-    alias: 'plugin.dataviewlabeleditor',
-    alignment: 'tl-tl',
-    completeOnEnter: true,
-    cancelOnEsc: true,
-    shim: false,
-    autoSize: {
-        width: 'boundEl',
-        height: 'field'
-    },
-    labelSelector: 'x-editable',
-    requires: [
-        'Ext.form.field.Text'
-    ],
-    constructor: function(config) {
-        config.field = config.field || Ext.create('Ext.form.field.Text', {
-            allowOnlyWhitespace: false,
-            selectOnFocus: true
-        });
-        this.callParent([config]);
-    },
-    init: function(view) {
-        this.view = view;
-        this.mon(view, 'afterrender', this.bindEvents, this);
-        this.on('complete', this.onSave, this);
-    },
-    bindEvents: function() {
-        this.mon(this.view.getEl(), {
-            click: {
-                fn: this.onClick,
-                scope: this
-            }
-        });
-    },
-    onClick: function(e, target) {
-        var me = this,
-            item, record;
-        if (Ext.fly(target).hasCls(me.labelSelector) && !me.editing && !e.ctrlKey && !e.shiftKey) {
-            e.stopEvent();
-            item = me.view.findItemByChild(target);
-            record = me.view.store.getAt(me.view.indexOf(item));
-            me.startEdit(target, record.data[me.dataIndex]);
-            me.activeRecord = record;
-        }
-        else if (me.editing) {
-            me.field.blur();
-            e.preventDefault();
-        }
-    },
-    onSave: function(ed, value) {
-        this.activeRecord.set(this.dataIndex, value);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/DataViewTransition.js
+++ b//dev/null
@@ -1,263 +0,0 @@
-/**
- * @class Ext.ux.DataViewTransition
- * Transition plugin for DataViews
- */
-/* eslint-disable vars-on-top, one-var */
-Ext.ux.DataViewTransition = Ext.extend(Object, {
-    /**
-     * @property defaults
-     * @type Object
-     * Default configuration options for all DataViewTransition instances
-     */
-    defaults: {
-        duration: 750,
-        idProperty: 'id'
-    },
-    /**
-     * Creates the plugin instance, applies defaults
-     * @constructor
-     * @param {Object} config Optional config object
-     */
-    constructor: function(config) {
-        Ext.apply(this, config || {}, this.defaults);
-    },
-    /**
-     * Initializes the transition plugin. Overrides the dataview's default refresh function
-     * @param {Ext.view.View} dataview The dataview
-     */
-    init: function(dataview) {
-        /**
-         * @property dataview
-         * @type Ext.view.View
-         * Reference to the DataView this instance is bound to
-         */
-        this.dataview = dataview;
-        var idProperty = this.idProperty;
-        dataview.blockRefresh = true;
-        dataview.updateIndexes = Ext.Function.createSequence(dataview.updateIndexes, function() {
-            this.getTargetEl().select(this.itemSelector).each(function(element, composite, index) {
-                element.id = element.dom.id = Ext.util.Format.format(
-                    "{0}-{1}", dataview.id, dataview.store.getAt(index).get(idProperty)
-                );
-            }, this);
-        }, dataview);
-        /**
-         * @property dataviewID
-         * @type String
-         * The string ID of the DataView component. This is used internally when animating
-         * child objects
-         */
-        this.dataviewID = dataview.id;
-        /**
-         * @property cachedStoreData
-         * @type Object
-         * A cache of existing store data, keyed by id. This is used to determine
-         * whether any items were added or removed from the store on data change
-         */
-        this.cachedStoreData = {};
-        this.cacheStoreData(dataview.store.snapshot);
-        dataview.store.on('datachanged', function(store) {
-            var parentEl = dataview.getTargetEl(),
-                calcItem = store.getAt(0),
-                added = this.getAdded(store),
-                removed = this.getRemoved(store),
-                previous = this.getRemaining(store);
-            Ext.each(removed, function(item) {
-                Ext.fly(this.dataviewID + '-' + item.get(this.idProperty)).animate({
-                    remove: false,
-                    duration: duration,
-                    opacity: 0,
-                    useDisplay: true
-                });
-            }, this);
-            if (calcItem == undefined) { // eslint-disable-line eqeqeq
-                this.cacheStoreData(store);
-                return;
-            }
-            var el = Ext.get(this.dataviewID + "-" + calcItem.get(this.idProperty)),
-                itemWidth = el.getMargin('lr') + el.getWidth(),
-                itemHeight = el.getMargin('bt') + el.getHeight(),
-                dvWidth = parentEl.getWidth(),
-                columns = Math.floor(dvWidth / itemWidth);
-            parentEl.applyStyles({
-                display: 'block',
-                position: 'relative'
-            });
-            var oldPositions = {},
-                newPositions = {},
-                elCache = {};
-            Ext.iterate(previous, function(id, item) {
-                var id = item.get(this.idProperty),
-                    el = elCache[id] = Ext.get(this.dataviewID + '-' + id);
-                oldPositions[id] = {
-                    top: el.getY() - parentEl.getY() - el.getMargin('t') - parentEl.getPadding('t'),
-                    left: el.getX() - parentEl.getX() - el.getMargin('l') - parentEl.getPadding('l')
-                };
-            }, this);
-            Ext.iterate(previous, function(id, item) {
-                var oldPos = oldPositions[id],
-                    el = elCache[id];
-                if (el.getStyle('position') !== 'absolute') {
-                    elCache[id].applyStyles({
-                        position: 'absolute',
-                        left: oldPos.left + "px",
-                        top: oldPos.top + "px",
-                        width: el.getWidth(!Ext.isIE || Ext.isStrict),
-                        height: el.getHeight(!Ext.isIE || Ext.isStrict)
-                    });
-                }
-            });
-            var index = 0;
-            Ext.iterate(store.data.items, function(item) {
-                var id = item.get(idProperty),
-                    column = index % columns,
-                    row = Math.floor(index / columns),
-                    top = row * itemHeight,
-                    left = column * itemWidth;
-                newPositions[id] = {
-                    top: top,
-                    left: left
-                };
-                index ++;
-            }, this);
-            var startTime = new Date(),
-                duration = this.duration,
-                dataviewID = this.dataviewID,
-                doAnimate = function() {
-                    var elapsed = new Date() - startTime,
-                        fraction = elapsed / duration,
-                        id;
-                    if (fraction >= 1) {
-                        for (id in newPositions) {
-                            Ext.fly(dataviewID + '-' + id).applyStyles({
-                                top: newPositions[id].top + "px",
-                                left: newPositions[id].left + "px"
-                            });
-                        }
-                        Ext.TaskManager.stop(task);
-                    }
-                    else {
-                        for (id in newPositions) {
-                            if (!previous[id]) {
-                                continue;
-                            }
-                            var oldPos = oldPositions[id],
-                                newPos = newPositions[id],
-                                oldTop = oldPos.top,
-                                newTop = newPos.top,
-                                oldLeft = oldPos.left,
-                                newLeft = newPos.left,
-                                diffTop = fraction * Math.abs(oldTop - newTop),
-                                diffLeft = fraction * Math.abs(oldLeft - newLeft),
-                                midTop = oldTop > newTop ? oldTop - diffTop : oldTop + diffTop,
-                                midLeft = oldLeft > newLeft
-                                    ? oldLeft - diffLeft
-                                    : oldLeft + diffLeft;
-                            Ext.fly(dataviewID + '-' + id).applyStyles({
-                                top: midTop + "px",
-                                left: midLeft + "px"
-                            });
-                        }
-                    }
-                },
-                task = {
-                    run: doAnimate,
-                    interval: 20,
-                    scope: this
-                };
-            Ext.TaskManager.start(task);
-            var count = 0;
-            for (var k in added) { // eslint-disable-line no-unused-vars
-                count++;
-            }
-            if (Ext.global.console && Ext.global.console.log) {
-                Ext.global.console.log('added:', count);
-            }
-            Ext.iterate(added, function(id, item) {
-                Ext.fly(this.dataviewID + '-' + item.get(this.idProperty)).applyStyles({
-                    top: newPositions[item.get(this.idProperty)].top + "px",
-                    left: newPositions[item.get(this.idProperty)].left + "px"
-                });
-                Ext.fly(this.dataviewID + '-' + item.get(this.idProperty)).animate({
-                    remove: false,
-                    duration: duration,
-                    opacity: 1
-                });
-            }, this);
-            this.cacheStoreData(store);
-        }, this);
-    },
-    /**
-     * Caches the records from a store locally for comparison later
-     * @param {Ext.data.Store} store The store to cache data from
-     */
-    cacheStoreData: function(store) {
-        this.cachedStoreData = {};
-        store.each(function(record) {
-            this.cachedStoreData[record.get(this.idProperty)] = record;
-        }, this);
-    },
-    /**
-     * Returns all records that were already in the DataView
-     * @return {Object} All existing records
-     */
-    getExisting: function() {
-        return this.cachedStoreData;
-    },
-    /**
-     * Returns the total number of items that are currently visible in the DataView
-     * @return {Number} The number of existing items
-     */
-    getExistingCount: function() {
-        var count = 0,
-            items = this.getExisting();
-        for (var k in items) { // eslint-disable-line no-unused-vars
-            count++;
-        }
-        return count;
-    },
-    /**
-     * Returns all records in the given store that were not already present
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Object} Object of records not already present in the dataview in format {id: record}
-     */
-    getAdded: function(store) {
-        var added = {};
-        store.each(function(record) {
-            if (this.cachedStoreData[record.get(this.idProperty)] == undefined) {
-                added[record.get(this.idProperty)] = record;
-            }
-        }, this);
-        return added;
-    },
-    /**
-     * Returns all records that are present in the DataView but not the new store
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Array} Array of records that used to be present
-     */
-    getRemoved: function(store) {
-        var removed = [];
-        for (var id in this.cachedStoreData) {
-            if (store.findExact(this.idProperty, Number(id)) === -1) {
-                removed.push(this.cachedStoreData[id]);
-            }
-        }
-        return removed;
-    },
-    /**
-     * Returns all records that are already present and are still present in the new store
-     * @param {Ext.data.Store} store The updated store instance
-     * @return {Object} Object of records that are still present from last time in format
-     * {id: record}
-     */
-    getRemaining: function(store) {
-        var remaining = {};
-        store.each(function(record) {
-            /* eslint-disable-next-line eqeqeq */
-            if (this.cachedStoreData[record.get(this.idProperty)] != undefined) {
-                remaining[record.get(this.idProperty)] = record;
-            }
-        }, this);
-        return remaining;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/Explorer.js
+++ b//dev/null
@@ -1,159 +0,0 @@
-/**
- * An explorer component for navigating hierarchical content.  Consists of a breadcrumb bar
- * at the top, tree navigation on the left, and a center panel which displays the contents
- * of a given node.
- */
-Ext.define('Ext.ux.Explorer', {
-    extend: 'Ext.panel.Panel',
-    xtype: 'explorer',
-    requires: [
-        'Ext.layout.container.Border',
-        'Ext.toolbar.Breadcrumb',
-        'Ext.tree.Panel'
-    ],
-    config: {
-        /**
-         * @cfg {Object} breadcrumb
-         * Configuration object for the breadcrumb toolbar
-         */
-        breadcrumb: {
-            dock: 'top',
-            xtype: 'breadcrumb',
-            reference: 'breadcrumb'
-        },
-        /* eslint-disable max-len, indent */
-        /**
-         * @cfg {Object} contentView
-         * Configuration object for the "content" data view
-         */
-        contentView: {
-            xtype: 'dataview',
-            reference: 'contentView',
-            region: 'center',
-            cls: Ext.baseCSSPrefix + 'explorer-view',
-            itemSelector: '.' + Ext.baseCSSPrefix + 'explorer-item',
-            tpl:
-                '<tpl for=".">' +
-                    '<div class="' + Ext.baseCSSPrefix + 'explorer-item">' +
-                        '<div class="{iconCls}">' +
-                            '<div class="' + Ext.baseCSSPrefix + 'explorer-node-icon' +
-                                '{[values.leaf ? " ' + Ext.baseCSSPrefix + 'explorer-leaf-icon' + '" : ""]}' + '">' +
-                            '</div>' +
-                            '<div class="' + Ext.baseCSSPrefix + 'explorer-item-text">{text}</div>' +
-                        '</div>' +
-                    '</div>' +
-                '</tpl>'
-        },
-        /* eslint-enable max-len, indent */
-        /**
-         * @cfg {Ext.data.TreeStore} store
-         * The TreeStore to use as the data source
-         */
-        store: null,
-        /**
-         * @cfg {Object} tree
-         * Configuration object for the tree
-         */
-        tree: {
-            xtype: 'treepanel',
-            reference: 'tree',
-            region: 'west',
-            width: 200
-        }
-    },
-    renderConfig: {
-        /**
-         * @cfg {Ext.data.TreeModel} selection
-         * The selected node
-         * @accessor
-         */
-        selection: null
-    },
-    layout: 'border',
-    referenceHolder: true,
-    defaultListenerScope: true,
-    cls: Ext.baseCSSPrefix + 'explorer',
-    initComponent: function() {
-        var me = this,
-            store = me.getStore();
-        if (!store) {
-            Ext.raise('Ext.ux.Explorer requires a store.');
-        }
-        me.dockedItems = [ me.getBreadcrumb() ];
-        me.items = [ me.getTree(), me.getContentView() ];
-        me.callParent();
-    },
-    applyBreadcrumb: function(breadcrumb) {
-        var store = this.getStore();
-        breadcrumb = Ext.create(Ext.apply({
-            store: store,
-            selection: store.getRoot()
-        }, breadcrumb));
-        breadcrumb.on('selectionchange', '_onBreadcrumbSelectionChange', this);
-        return breadcrumb;
-    },
-    applyContentView: function(contentView) {
-        /**
-         * @property {Ext.data.Store} contentStore
-         * @private
-         * The backing store for the content view
-         */
-        var contentStore = this.contentStore = new Ext.data.Store({
-            model: this.getStore().model
-        });
-        contentView = Ext.create(Ext.apply({
-            store: contentStore
-        }, contentView));
-        return contentView;
-    },
-    applyTree: function(tree) {
-        tree = Ext.create(Ext.apply({
-            store: this.getStore()
-        }, tree));
-        tree.on('selectionchange', '_onTreeSelectionChange', this);
-        return tree;
-    },
-    updateSelection: function(node) {
-        var me = this,
-            refs = me.getReferences(),
-            breadcrumb = refs.breadcrumb,
-            tree = refs.tree,
-            treeSelectionModel = tree.getSelectionModel(),
-            contentStore = me.contentStore,
-            parentNode, treeView;
-        if (breadcrumb.getSelection() !== node) {
-            breadcrumb.setSelection(node);
-        }
-        if (treeSelectionModel.getSelection()[0] !== node) {
-            treeSelectionModel.select([node]);
-            parentNode = node.parentNode;
-            if (parentNode) {
-                parentNode.expand();
-            }
-            treeView = tree.getView();
-            treeView.scrollRowIntoView(treeView.getRow(node));
-        }
-        contentStore.removeAll();
-        contentStore.add(node.hasChildNodes() ? node.childNodes : [node]);
-    },
-    updateStore: function(store) {
-        this.getBreadcrumb().setStore(store);
-    },
-    privates: {
-        /**
-         * Handles the tree's selectionchange event
-         * @private
-         * @param {Ext.tree.Panel} tree
-         * @param {Ext.data.TreeModel[]} selection
-         */
-        _onTreeSelectionChange: function(tree, selection) {
-            this.setSelection(selection[0]);
-        },
-        /**
-         * Handles the breadcrumb bar's selectionchange event
-         */
-        _onBreadcrumbSelectionChange: function(breadcrumb, selection) {
-            this.setSelection(selection);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/FieldReplicator.js
+++ b//dev/null
@@ -1,45 +0,0 @@
-/**
- * A plugin for Field Components which creates clones of the Field for as
- * long as the user keeps filling them. Leaving the final one blank ends the repeating series.
- *
- * Usage:
- *
- *      items: [{
- *          xtype: 'combo',
- *          plugins: {
- *              fieldreplicator: true
- *          },
- *          triggerAction: 'all',
- *          fieldLabel: 'Select recipient',
- *          store: recipientStore
- *      }]
- *
- */
-Ext.define('Ext.ux.FieldReplicator', {
-    alias: 'plugin.fieldreplicator',
-    init: function(field) {
-        if (!field.replicatorId) {
-            field.replicatorId = Ext.id();
-        }
-        field.on('blur', this.onBlur, this);
-    },
-    onBlur: function(field) {
-        var ownerCt = field.ownerCt,
-            replicatorId = field.replicatorId,
-            isEmpty = Ext.isEmpty(field.getRawValue()),
-            siblings = ownerCt.query('[replicatorId=' + replicatorId + ']'),
-            isLastInGroup = siblings[siblings.length - 1] === field,
-            clone, idx;
-        if (isEmpty && !isLastInGroup) {
-            Ext.defer(field.destroy, 10, field); // delay to allow tab key to move focus first
-        }
-        else if (!isEmpty && isLastInGroup) {
-            if (field.onReplicate) {
-                field.onReplicate();
-            }
-            clone = field.cloneConfig({ replicatorId: replicatorId });
-            idx = ownerCt.items.indexOf(field);
-            ownerCt.add(idx + 1, clone);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/GMapPanel.js
+++ b//dev/null
@@ -1,118 +0,0 @@
-/**
- * The GMap Panel UX extends `Ext.panel.Panel` in order to display Google Maps.
- *
- * It is important to note that you must include the following Google Maps API above
- * bootstrap.js in your  application's index.html file (or equivalent).
- *
- *     <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false"></script>
- *
- * It is important to note that due to the Google Maps loader, you cannot currently include
- * the above JS resource in the Cmd generated app.json file. Doing so interferes with the loading of
- * Ext JS and Google Maps. 
- *
- * The following example creates a window containing a GMap Panel.  In this case, the center 
- * is set as geoCodeAddr, which is a string that Google translates into longitude and latitude.
- * 
- *     var mapwin = Ext.create('Ext.Window', {
- *         layout: 'fit',
- *         title: 'GMap Window',
- *         width: 450,
- *         height: 250,
- *         items: {
- *             xtype: 'gmappanel',
- *             gmapType: 'map',
- *             center: {
- *                 geoCodeAddr: "221B Baker Street",
- *                 marker: {
- *                     title: 'Holmes Home'
- *                 }
- *             },
- *             mapOptions : {
- *                 mapTypeId: google.maps.MapTypeId.ROADMAP
- *             }
- *         }
- *     }).show();
- * 
- */
-Ext.define('Ext.ux.GMapPanel', {
-    extend: 'Ext.panel.Panel',
-    alias: 'widget.gmappanel',
-    requires: ['Ext.window.MessageBox'],
-    initComponent: function() {
-        Ext.applyIf(this, {
-            plain: true,
-            gmapType: 'map',
-            border: false
-        });
-        this.callParent();
-    },
-    onBoxReady: function() {
-        var center = this.center;
-        this.callParent(arguments);
-        if (center) {
-            if (center.geoCodeAddr) {
-                this.lookupCode(center.geoCodeAddr, center.marker);
-            }
-            else {
-                this.createMap(center);
-            }
-        }
-        else {
-            Ext.raise('center is required');
-        }
-    },
-    createMap: function(center, marker) {
-        var options = Ext.apply({}, this.mapOptions);
-        /* global google */
-        options = Ext.applyIf(options, {
-            zoom: 14,
-            center: center,
-            mapTypeId: google.maps.MapTypeId.HYBRID
-        });
-        this.gmap = new google.maps.Map(this.body.dom, options);
-        if (marker) {
-            this.addMarker(Ext.applyIf(marker, {
-                position: center
-            }));
-        }
-        Ext.each(this.markers, this.addMarker, this);
-        this.fireEvent('mapready', this, this.gmap);
-    },
-    addMarker: function(marker) {
-        var o;
-        marker = Ext.apply({
-            map: this.gmap
-        }, marker);
-        if (!marker.position) {
-            marker.position = new google.maps.LatLng(marker.lat, marker.lng);
-        }
-        o = new google.maps.Marker(marker);
-        Ext.Object.each(marker.listeners, function(name, fn) {
-            google.maps.event.addListener(o, name, fn);
-        });
-        return o;
-    },
-    lookupCode: function(addr, marker) {
-        this.geocoder = new google.maps.Geocoder();
-        this.geocoder.geocode({
-            address: addr
-        }, Ext.Function.bind(this.onLookupComplete, this, [marker], true));
-    },
-    onLookupComplete: function(data, response, marker) {
-        if (response !== 'OK') {
-            Ext.MessageBox.alert('Error', 'An error occured: "' + response + '"');
-            return;
-        }
-        this.createMap(data[0].geometry.location, marker);
-    },
-    afterComponentLayout: function(w, h) {
-        this.callParent(arguments);
-        this.redraw();
-    },
-    redraw: function() {
-        var map = this.gmap;
-        if (map) {
-            google.maps.event.trigger(map, 'resize');
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/IFrame.js
+++ b//dev/null
@@ -1,96 +0,0 @@
-/**
- * Barebones iframe implementation. 
- */
-Ext.define('Ext.ux.IFrame', {
-    extend: 'Ext.Component',
-    alias: 'widget.uxiframe',
-    loadMask: 'Loading...',
-    src: 'about:blank',
-    renderTpl: [
-        '<iframe src="{src}" id="{id}-iframeEl" data-ref="iframeEl" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'
-    ],
-    childEls: ['iframeEl'],
-    initComponent: function() {
-        this.callParent();
-        this.frameName = this.frameName || this.id + '-frame';
-    },
-    initEvents: function() {
-        var me = this;
-        me.callParent();
-        me.iframeEl.on('load', me.onLoad, me);
-    },
-    initRenderData: function() {
-        return Ext.apply(this.callParent(), {
-            src: this.src,
-            frameName: this.frameName
-        });
-    },
-    getBody: function() {
-        var doc = this.getDoc();
-        return doc.body || doc.documentElement;
-    },
-    getDoc: function() {
-        try {
-            return this.getWin().document;
-        }
-        catch (ex) {
-            return null;
-        }
-    },
-    getWin: function() {
-        var me = this,
-            name = me.frameName,
-            win = Ext.isIE ? me.iframeEl.dom.contentWindow : window.frames[name];
-        return win;
-    },
-    getFrame: function() {
-        var me = this;
-        return me.iframeEl.dom;
-    },
-    onLoad: function() {
-        var me = this,
-            doc = me.getDoc();
-        if (doc) {
-            this.el.unmask();
-            this.fireEvent('load', this);
-        }
-        else if (me.src) {
-            this.el.unmask();
-            this.fireEvent('error', this);
-        }
-    },
-    load: function(src) {
-        var me = this,
-            text = me.loadMask,
-            frame = me.getFrame();
-        if (me.fireEvent('beforeload', me, src) !== false) {
-            if (text && me.el) {
-                me.el.mask(text);
-            }
-            frame.src = me.src = (src || me.src);
-        }
-    }
-});
-/*
- * Note: Event relayers are not needed here because the combination of the gesture system and 
- * normal focus/blur will handle it.
- * Tested with the examples/classic/desktop app.
- */
-/*
- * TODO items:
- *
- * Iframe should clean up any Ext.dom.Element wrappers around its window, document
- * documentElement and body when it is destroyed.  This helps prevent "Permission Denied"
- * errors in IE when Ext.dom.GarbageCollector tries to access those objects on an orphaned
- * iframe.  Permission Denied errors can occur in one of the following 2 scenarios:
- *
- *     a. When an iframe is removed from the document, and all references to it have been
- *     removed, IE will "clear" the window object.  At this point the window object becomes
- *     completely inaccessible - accessing any of its properties results in a "Permission
- *     Denied" error. http://msdn.microsoft.com/en-us/library/ie/hh180174(v=vs.85).aspx
- *
- *     b. When an iframe is unloaded (either by navigating to a new url, or via document.open/
- *     document.write, new html and body elements are created and the old the html and body
- *     elements are orphaned.  Accessing the html and body elements or any of their properties
- *     results in a "Permission Denied" error.
- */

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/LiveSearchGridPanel.js
+++ b//dev/null
@@ -1,253 +0,0 @@
-/**
- * A GridPanel class with live search support.
- */
-Ext.define('Ext.ux.LiveSearchGridPanel', {
-    extend: 'Ext.grid.Panel',
-    requires: [
-        'Ext.toolbar.TextItem',
-        'Ext.form.field.Checkbox',
-        'Ext.form.field.Text',
-        'Ext.ux.statusbar.StatusBar'
-    ],
-    /**
-     * @private
-     * search value initialization
-     */
-    searchValue: null,
-    /**
-     * @private
-     * The matched positions from the most recent search
-     */
-    matches: [],
-    /**
-     * @private
-     * The current index matched.
-     */
-    currentIndex: null,
-    /**
-     * @private
-     * The generated regular expression used for searching.
-     */
-    searchRegExp: null,
-    /**
-     * @private
-     * Case sensitive mode.
-     */
-    caseSensitive: false,
-    /**
-     * @private
-     * Regular expression mode.
-     */
-    regExpMode: false,
-    /**
-     * @cfg {String} matchCls
-     * The matched string css classe.
-     */
-    matchCls: 'x-livesearch-match',
-    defaultStatusText: 'Nothing Found',
-    initComponent: function() {
-        var me = this;
-        me.tbar = ['Search', {
-            xtype: 'textfield',
-            name: 'searchField',
-            hideLabel: true,
-            width: 200,
-            listeners: {
-                change: {
-                    fn: me.onTextFieldChange,
-                    scope: this,
-                    buffer: 500
-                }
-            }
-        }, {
-            xtype: 'button',
-            text: '&lt;',
-            tooltip: 'Find Previous Row',
-            handler: me.onPreviousClick,
-            scope: me
-        }, {
-            xtype: 'button',
-            text: '&gt;',
-            tooltip: 'Find Next Row',
-            handler: me.onNextClick,
-            scope: me
-        }, '-', {
-            xtype: 'checkbox',
-            hideLabel: true,
-            margin: '0 0 0 4px',
-            handler: me.regExpToggle,
-            scope: me
-        }, 'Regular expression', {
-            xtype: 'checkbox',
-            hideLabel: true,
-            margin: '0 0 0 4px',
-            handler: me.caseSensitiveToggle,
-            scope: me
-        }, 'Case sensitive'];
-        me.bbar = new Ext.ux.StatusBar({
-            defaultText: me.defaultStatusText,
-            name: 'searchStatusBar'
-        });
-        me.callParent(arguments);
-    },
-    afterRender: function() {
-        var me = this;
-        me.callParent(arguments);
-        me.textField = me.down('textfield[name=searchField]');
-        me.statusBar = me.down('statusbar[name=searchStatusBar]');
-        me.view.on('cellkeydown', me.focusTextField, me);
-    },
-    focusTextField: function(view, td, cellIndex, record, tr, rowIndex, e, eOpts) {
-        if (e.getKey() === e.S) {
-            e.preventDefault();
-            this.textField.focus();
-        }
-    },
-    tagsRe: /<[^>]*>/gm,
-    tagsProtect: '\x0f',
-    /**
-     * In normal mode it returns the value with protected regexp characters.
-     * In regular expression mode it returns the raw value except if the regexp is invalid.
-     * @return {String} The value to process or null if the textfield value is blank or invalid.
-     * @private
-     */
-    getSearchValue: function() {
-        var me = this,
-            value = me.textField.getValue();
-        if (value === '') {
-            return null;
-        }
-        if (!me.regExpMode) {
-            value = Ext.String.escapeRegex(value);
-        }
-        else {
-            try {
-                new RegExp(value);
-            }
-            catch (error) {
-                me.statusBar.setStatus({
-                    text: error.message,
-                    iconCls: 'x-status-error'
-                });
-                return null;
-            }
-            if (value === '^' || value === '$') {
-                return null;
-            }
-        }
-        return value;
-    },
-    /**
-     * Finds all strings that matches the searched value in each grid cells.
-     * @private
-     */
-    onTextFieldChange: function() {
-        var me = this,
-            count = 0,
-            view = me.view,
-            columns = me.visibleColumnManager.getColumns();
-        view.refresh();
-        me.statusBar.setStatus({
-            text: me.defaultStatusText,
-            iconCls: ''
-        });
-        me.searchValue = me.getSearchValue();
-        me.matches = [];
-        me.currentIndex = null;
-        if (me.searchValue !== null) {
-            me.searchRegExp = new RegExp(me.getSearchValue(), 'g' + (me.caseSensitive ? '' : 'i'));
-            me.store.each(function(record, idx) {
-                var node = view.getNode(record);
-                if (node) {
-                    Ext.Array.forEach(columns, function(column) {
-                        var cell = Ext.fly(node).down(column.getCellInnerSelector(), true),
-                            matches, cellHTML,
-                            seen;
-                        if (cell) {
-                            matches = cell.innerHTML.match(me.tagsRe);
-                            cellHTML = cell.innerHTML.replace(me.tagsRe, me.tagsProtect);
-                            cellHTML = cellHTML.replace(me.searchRegExp, function(m) {
-                                ++count;
-                                if (!seen) {
-                                    me.matches.push({
-                                        record: record,
-                                        column: column
-                                    });
-                                    seen = true;
-                                }
-                                return '<span class="' + me.matchCls + '">' + m + '</span>';
-                            }, me);
-                            Ext.each(matches, function(match) {
-                                cellHTML = cellHTML.replace(me.tagsProtect, match);
-                            });
-                            cell.innerHTML = cellHTML;
-                        }
-                    });
-                }
-            }, me);
-            if (count) {
-                me.currentIndex = 0;
-                me.gotoCurrent();
-                me.statusBar.setStatus({
-                    text: Ext.String.format('{0} match{1} found.', count, count === 1 ? 'es' : ''),
-                    iconCls: 'x-status-valid'
-                });
-            }
-        }
-        if (me.currentIndex === null) {
-            me.getSelectionModel().deselectAll();
-            me.textField.focus();
-        }
-    },
-    /**
-     * Selects the previous row containing a match.
-     * @private
-     */   
-    onPreviousClick: function() {
-        var me = this,
-            matches = me.matches,
-            len = matches.length,
-            idx = me.currentIndex;
-        if (len) {
-            me.currentIndex = idx === 0 ? len - 1 : idx - 1;
-            me.gotoCurrent();
-        }
-    },
-    /**
-     * Selects the next row containing a match.
-     * @private
-     */    
-    onNextClick: function() {
-        var me = this,
-            matches = me.matches,
-            len = matches.length,
-            idx = me.currentIndex;
-        if (len) {
-            me.currentIndex = idx === len - 1 ? 0 : idx + 1;
-            me.gotoCurrent();
-        }
-    },
-    /**
-     * Switch to case sensitive mode.
-     * @private
-     */    
-    caseSensitiveToggle: function(checkbox, checked) {
-        this.caseSensitive = checked;
-        this.onTextFieldChange();
-    },
-    /**
-     * Switch to regular expression mode
-     * @private
-     */
-    regExpToggle: function(checkbox, checked) {
-        this.regExpMode = checked;
-        this.onTextFieldChange();
-    },
-    privates: {
-        gotoCurrent: function() {
-            var pos = this.matches[this.currentIndex];
-            this.getNavigationModel().setPosition(pos.record, pos.column);
-            this.getSelectionModel().select(pos.record);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/PreviewPlugin.js
+++ b//dev/null
@@ -1,87 +0,0 @@
-/**
- * The Preview Plugin enables toggle of a configurable preview of all visible records.
- *
- * Note: This plugin does NOT assert itself against an existing RowBody feature and may conflict
- * with another instance of the same plugin.
- */
-Ext.define('Ext.ux.PreviewPlugin', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.preview',
-    requires: ['Ext.grid.feature.RowBody'],
-    /**
-     * @private
-     * css class to use to hide the body
-     */
-    hideBodyCls: 'x-grid-row-body-hidden',
-    /**
-     * @cfg {String} bodyField
-     * Field to display in the preview. Must be a field within the Model definition
-     * that the store is using.
-     */
-    bodyField: '',
-    /**
-     * @cfg {Boolean} previewExpanded
-     */
-    previewExpanded: true,
-    /**
-     * Plugin may be safely declared on either a panel.Grid or a Grid View/viewConfig
-     * @param {Ext.grid.Panel/Ext.view.View} target
-     */
-    setCmp: function(target) {
-        this.callParent(arguments);
-        var me = this,
-            grid = me.cmp = target.isXType('gridview') ? target.grid : target,
-            bodyField = me.bodyField,
-            hideBodyCls = me.hideBodyCls,
-            feature = Ext.create('Ext.grid.feature.RowBody', {
-                grid: grid,
-                getAdditionalData: function(data, idx, model, rowValues) {
-                    var getAdditionalData = Ext.grid.feature.RowBody.prototype.getAdditionalData,
-                        additionalData = {
-                            rowBody: data[bodyField],
-                            rowBodyCls: grid.getView().previewExpanded ? '' : hideBodyCls
-                        };
-                    if (Ext.isFunction(getAdditionalData)) {
-                        Ext.apply(additionalData, getAdditionalData.apply(this, arguments));
-                    }
-                    return additionalData;
-                }
-            }),
-            initFeature = function(grid, view) {
-                view.previewExpanded = me.previewExpanded;
-                view.featuresMC.add(feature);
-                feature.init(grid);
-            };
-        if (grid.view) {
-            initFeature(grid, grid.view);
-        }
-        else {
-            grid.on({
-                viewcreated: initFeature,
-                single: true
-            });
-        }
-    },
-    /**
-     * Toggle between the preview being expanded/hidden on all rows
-     * @param {Boolean} expanded Pass true to expand the record and false to not show the preview.
-     */
-    toggleExpanded: function(expanded) {
-        var grid = this.getCmp(),
-            view = grid && grid.getView(),
-            bufferedRenderer = view.bufferedRenderer,
-            scrollManager = view.scrollManager;
-        if (grid && view && expanded !== view.previewExpanded) {
-            this.previewExpanded = view.previewExpanded = !!expanded;
-            view.refreshView();
-            if (scrollManager) {
-                if (bufferedRenderer) {
-                    bufferedRenderer.stretchView(view, bufferedRenderer.getScrollHeight(true));
-                }
-                else {
-                    scrollManager.refresh(true);
-                }
-            }
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/ProgressBarPager.js
+++ b//dev/null
@@ -1,107 +0,0 @@
-/**
- * Plugin for displaying a progressbar inside of a paging toolbar
- * instead of plain text.
- */
-Ext.define('Ext.ux.ProgressBarPager', {
-    alias: 'plugin.ux-progressbarpager',
-    requires: [
-        'Ext.ProgressBar'
-    ],
-    /**
-     * @cfg {Number} width
-     * <p>The default progress bar width.  Default is 225.</p>
-    */
-    width: 225,
-    /**
-     * @cfg {String} defaultText
-    * <p>The text to display while the store is loading.  Default is 'Loading...'</p>
-     */
-    defaultText: 'Loading...',
-    /**
-     * @cfg {Object} defaultAnimCfg
-     * <p>A {@link Ext.fx.Anim Ext.fx.Anim} configuration object.</p>
-     */
-    defaultAnimCfg: {
-        duration: 1000,
-        easing: 'bounceOut'
-    },
-    /**
-     * Creates new ProgressBarPager.
-     * @param {Object} config Configuration options
-     */
-    constructor: function(config) {
-        if (config) {
-            Ext.apply(this, config);
-        }
-    },
-    init: function(parent) {
-        var displayItem;
-        if (parent.displayInfo) {
-            this.parent = parent;
-            displayItem = parent.child("#displayItem");
-            if (displayItem) {
-                parent.remove(displayItem, true);
-            }
-            this.progressBar = Ext.create('Ext.ProgressBar', {
-                text: this.defaultText,
-                width: this.width,
-                animate: this.defaultAnimCfg,
-                style: {
-                    cursor: 'pointer'
-                },
-                listeners: {
-                    el: {
-                        scope: this,
-                        click: this.handleProgressBarClick
-                    }
-                }
-            });
-            parent.displayItem = this.progressBar;
-            parent.add(parent.displayItem);
-            Ext.apply(parent, this.parentOverrides);
-        }
-    },
-    /**
-     * This method handles the click for the progress bar
-     * @private
-     */
-    handleProgressBarClick: function(e) {
-        var parent = this.parent,
-            displayItem = parent.displayItem,
-            box = this.progressBar.getBox(),
-            xy = e.getXY(),
-            position = xy[0] - box.x,
-            store = parent.store,
-            pageSize = parent.pageSize || store.pageSize,
-            pages = Math.ceil(store.getTotalCount() / pageSize),
-            newPage = Math.max(Math.ceil(position / (displayItem.width / pages)), 1);
-        store.loadPage(newPage);
-    },
-    /**
-     * @private
-     */
-    parentOverrides: {
-        /**
-         * This method updates the information via the progress bar.
-         * @private
-         */
-        updateInfo: function() {
-            if (this.displayItem) {
-                var count = this.store.getCount(),
-                    pageData = this.getPageData(),
-                    message = count === 0
-                        ? this.emptyMsg
-                        : Ext.String.format(
-                            this.displayMsg,
-                            pageData.fromRecord, pageData.toRecord, this.store.getTotalCount()
-                        ),
-                    percentage = pageData.pageCount > 0
-                        ? (pageData.currentPage / pageData.pageCount)
-                        : 0;
-                this.displayItem.updateProgress(
-                    percentage, message, this.animate || this.defaultAnimConfig
-                );
-            }
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/RowExpander.js
+++ b//dev/null
@@ -1,10 +0,0 @@
-/**
- * @deprecated 4.0.0 Ext.ux.RowExpander has been promoted to the core framework. Use
- * {@link Ext.grid.plugin.RowExpander} instead.
- *
- * Ext.ux.RowExpander is now just an empty stub that extends Ext.grid.plugin.RowExpander
- * for backward compatibility reasons.
- */
-Ext.define('Ext.ux.RowExpander', {
-    extend: 'Ext.grid.plugin.RowExpander'
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/SlidingPager.js
+++ b//dev/null
@@ -1,49 +0,0 @@
-/**
- * Plugin for PagingToolbar which replaces the textfield input with a slider
- */
-Ext.define('Ext.ux.SlidingPager', {
-    alias: 'plugin.ux-slidingpager',
-    requires: [
-        'Ext.slider.Single',
-        'Ext.slider.Tip'
-    ],
-    /**
-     * Creates new SlidingPager.
-     * @param {Object} config Configuration options
-     */
-    constructor: function(config) {
-        if (config) {
-            Ext.apply(this, config);
-        }
-    },
-    init: function(pbar) {
-        var idx = pbar.items.indexOf(pbar.child("#inputItem")),
-            slider;
-        Ext.each(pbar.items.getRange(idx - 2, idx + 2), function(c) {
-            c.hide();
-        });
-        slider = Ext.create('Ext.slider.Single', {
-            width: 114,
-            minValue: 1,
-            maxValue: 1,
-            hideLabel: true,
-            tipText: function(thumb) {
-                return Ext.String.format(
-                    'Page <b>{0}</b> of <b>{1}</b>', thumb.value, thumb.slider.maxValue
-                );
-            },
-            listeners: {
-                changecomplete: function(s, v) {
-                    pbar.store.loadPage(v);
-                }
-            }
-        });
-        pbar.insert(idx + 1, slider);
-        pbar.on({
-            change: function(pb, data) {
-                slider.setMaxValue(data.pageCount);
-                slider.setValue(data.currentPage);
-            }
-        });
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/Spotlight.js
+++ b//dev/null
@@ -1,182 +0,0 @@
-/**
- * UX used to provide a spotlight around a specified component/element.
- */
-Ext.define('Ext.ux.Spotlight', {
-    /**
-     * @private
-     * The baseCls for the spotlight elements
-     */
-    baseCls: 'x-spotlight',
-    /**
-     * @cfg animate {Boolean} True to animate the spotlight change
-     * (defaults to true)
-     */
-    animate: true,
-    /**
-     * @cfg duration {Integer} The duration of the animation, in milliseconds
-     * (defaults to 250)
-     */
-    duration: 250,
-    /**
-     * @cfg easing {String} The type of easing for the spotlight animatation
-     * (defaults to null)
-     */
-    easing: null,
-    /**
-     * @private
-     * True if the spotlight is active on the element
-     */
-    active: false,
-    constructor: function(config) {
-        Ext.apply(this, config);
-    },
-    /**
-     * Create all the elements for the spotlight
-     */
-    createElements: function() {
-        var me = this,
-            baseCls = me.baseCls,
-            body = Ext.getBody();
-        me.right = body.createChild({
-            cls: baseCls
-        });
-        me.left = body.createChild({
-            cls: baseCls
-        });
-        me.top = body.createChild({
-            cls: baseCls
-        });
-        me.bottom = body.createChild({
-            cls: baseCls
-        });
-        me.all = Ext.create('Ext.CompositeElement', [me.right, me.left, me.top, me.bottom]);
-    },
-    /**
-     * Show the spotlight
-     */
-    show: function(el, callback, scope) {
-        var me = this;
-        me.el = Ext.get(el);
-        if (!me.right) {
-            me.createElements();
-        }
-        if (!me.active) {
-            me.all.setDisplayed('');
-            me.active = true;
-            Ext.on('resize', me.syncSize, me);
-            me.applyBounds(me.animate, false);
-        }
-        else {
-            me.applyBounds(false, false);
-        }
-    },
-    /**
-     * Hide the spotlight
-     */
-    hide: function(callback, scope) {
-        var me = this;
-        Ext.un('resize', me.syncSize, me);
-        me.applyBounds(me.animate, true);
-    },
-    /**
-     * Resizes the spotlight with the window size.
-     */
-    syncSize: function() {
-        this.applyBounds(false, false);
-    },
-    /**
-     * Resizes the spotlight depending on the arguments
-     * @param {Boolean} animate True to animate the changing of the bounds
-     * @param {Boolean} reverse True to reverse the animation
-     */
-    applyBounds: function(animate, reverse) {
-        var me = this,
-            box = me.el.getBox(),
-            viewWidth = Ext.Element.getViewportWidth(),
-            viewHeight = Ext.Element.getViewportHeight(),
-            from, to, clone;
-        from = {
-            right: {
-                x: box.right,
-                y: viewHeight,
-                width: (viewWidth - box.right),
-                height: 0
-            },
-            left: {
-                x: 0,
-                y: 0,
-                width: box.x,
-                height: 0
-            },
-            top: {
-                x: viewWidth,
-                y: 0,
-                width: 0,
-                height: box.y
-            },
-            bottom: {
-                x: 0,
-                y: (box.y + box.height),
-                width: 0,
-                height: (viewHeight - (box.y + box.height)) + 'px'
-            }
-        };
-        to = {
-            right: {
-                x: box.right,
-                y: box.y,
-                width: (viewWidth - box.right) + 'px',
-                height: (viewHeight - box.y) + 'px'
-            },
-            left: {
-                x: 0,
-                y: 0,
-                width: box.x + 'px',
-                height: (box.y + box.height) + 'px'
-            },
-            top: {
-                x: box.x,
-                y: 0,
-                width: (viewWidth - box.x) + 'px',
-                height: box.y + 'px'
-            },
-            bottom: {
-                x: 0,
-                y: (box.y + box.height),
-                width: (box.x + box.width) + 'px',
-                height: (viewHeight - (box.y + box.height)) + 'px'
-            }
-        };
-        if (reverse) {
-            clone = Ext.clone(from);
-            from = to;
-            to = clone;
-        }
-        if (animate) {
-            Ext.Array.forEach(['right', 'left', 'top', 'bottom'], function(side) {
-                me[side].setBox(from[side]);
-                me[side].animate({
-                    duration: me.duration,
-                    easing: me.easing,
-                    to: to[side]
-                });
-            }, this);
-        }
-        else {
-            Ext.Array.forEach(['right', 'left', 'top', 'bottom'], function(side) {
-                me[side].setBox(Ext.apply(from[side], to[side]));
-                me[side].repaint();
-            }, this);
-        }
-    },
-    /**
-     * Removes all the elements for the spotlight
-     */
-    destroy: function() {
-        var me = this;
-        Ext.destroy(me.right, me.left, me.top, me.bottom);
-        delete me.el;
-        delete me.all;
-        me.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/TabCloseMenu.js
+++ b//dev/null
@@ -1,178 +0,0 @@
-/**
- * Plugin for adding a close context menu to tabs. Note that the menu respects
- * the closable configuration on the tab. As such, commands like remove others
- * and remove all will not remove items that are not closable.
- */
-Ext.define('Ext.ux.TabCloseMenu', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.tabclosemenu',
-    mixins: {
-        observable: 'Ext.util.Observable'
-    },
-    /**
-     * @cfg {String} closeTabText
-     * The text for closing the current tab.
-     */
-    closeTabText: 'Close Tab',
-    /**
-     * @cfg {Boolean} showCloseOthers
-     * Indicates whether to show the 'Close Others' option.
-     */
-    showCloseOthers: true,
-    /**
-     * @cfg {String} closeOtherTabsText
-     * The text for closing all tabs except the current one.
-     */
-    closeOtherTabsText: 'Close Other Tabs',
-    /**
-     * @cfg {Boolean} showCloseAll
-     * Indicates whether to show the 'Close All' option.
-     */
-    showCloseAll: true,
-    /**
-     * @cfg {String} closeAllTabsText
-     * The text for closing all tabs.
-     */
-    closeAllTabsText: 'Close All Tabs',
-    /**
-     * @cfg {Array} extraItemsHead
-     * An array of additional context menu items to add to the front of the context menu.
-     */
-    extraItemsHead: null,
-    /**
-     * @cfg {Array} extraItemsTail
-     * An array of additional context menu items to add to the end of the context menu.
-     */
-    extraItemsTail: null,
-    constructor: function(config) {
-        this.callParent([config]);
-        this.mixins.observable.constructor.call(this, config);
-    },
-    init: function(tabpanel) {
-        this.tabPanel = tabpanel;
-        this.tabBar = tabpanel.down("tabbar");
-        this.mon(this.tabPanel, {
-            scope: this,
-            afterlayout: this.onAfterLayout,
-            single: true
-        });
-    },
-    onAfterLayout: function() {
-        this.mon(this.tabBar.el, {
-            scope: this,
-            contextmenu: this.onContextMenu,
-            delegate: '.x-tab'
-        });
-    },
-    destroy: function() {
-        Ext.destroy(this.menu);
-        this.callParent();
-    },
-    /**
-     * @private
-     */
-    onContextMenu: function(event, target) {
-        var me = this,
-            menu = me.createMenu(),
-            disableAll = true,
-            disableOthers = true,
-            tab = me.tabBar.getChildByElement(target),
-            index = me.tabBar.items.indexOf(tab);
-        me.item = me.tabPanel.getComponent(index);
-        menu.child('#close').setDisabled(!me.item.closable);
-        if (me.showCloseAll || me.showCloseOthers) {
-            me.tabPanel.items.each(function(item) {
-                if (item.closable) {
-                    disableAll = false;
-                    if (item !== me.item) {
-                        disableOthers = false;
-                        return false;
-                    }
-                }
-                return true;
-            });
-            if (me.showCloseAll) {
-                menu.child('#closeAll').setDisabled(disableAll);
-            }
-            if (me.showCloseOthers) {
-                menu.child('#closeOthers').setDisabled(disableOthers);
-            }
-        }
-        event.preventDefault();
-        me.fireEvent('beforemenu', menu, me.item, me);
-        menu.showAt(event.getXY());
-    },
-    createMenu: function() {
-        var me = this,
-            items;
-        if (!me.menu) {
-            items = [{
-                itemId: 'close',
-                text: me.closeTabText,
-                scope: me,
-                handler: me.onClose
-            }];
-            if (me.showCloseAll || me.showCloseOthers) {
-                items.push('-');
-            }
-            if (me.showCloseOthers) {
-                items.push({
-                    itemId: 'closeOthers',
-                    text: me.closeOtherTabsText,
-                    scope: me,
-                    handler: me.onCloseOthers
-                });
-            }
-            if (me.showCloseAll) {
-                items.push({
-                    itemId: 'closeAll',
-                    text: me.closeAllTabsText,
-                    scope: me,
-                    handler: me.onCloseAll
-                });
-            }
-            if (me.extraItemsHead) {
-                items = me.extraItemsHead.concat(items);
-            }
-            if (me.extraItemsTail) {
-                items = items.concat(me.extraItemsTail);
-            }
-            me.menu = Ext.create('Ext.menu.Menu', {
-                items: items,
-                listeners: {
-                    hide: me.onHideMenu,
-                    scope: me
-                }
-            });
-        }
-        return me.menu;
-    },
-    onHideMenu: function() {
-        var me = this;
-        me.fireEvent('aftermenu', me.menu, me);
-    },
-    onClose: function() {
-        this.tabPanel.remove(this.item);
-    },
-    onCloseOthers: function() {
-        this.doClose(true);
-    },
-    onCloseAll: function() {
-        this.doClose(false);
-    },
-    doClose: function(excludeActive) {
-        var items = [];
-        this.tabPanel.items.each(function(item) {
-            if (item.closable) {
-                if (!excludeActive || item !== this.item) {
-                    items.push(item);
-                }
-            }
-        }, this);
-        Ext.suspendLayouts();
-        Ext.Array.forEach(items, function(item) {
-            this.tabPanel.remove(item);
-        }, this);
-        Ext.resumeLayouts(true);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/TabMiddleButtonClose.js
+++ b//dev/null
@@ -1,42 +0,0 @@
-/**
- * Plugin for adding a close context menu to tabs. Note that the menu respects
- * the closable configuration on the tab. As such, commands like remove others
- * and remove all will not remove items that are not closable.
- */
-Ext.define('Ext.ux.TabMiddleButtonClose', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.tabmiddlebuttonclose',
-    mixins: {
-        observable: 'Ext.util.Observable'
-    },
-    constructor: function (config) {
-        this.callParent([config]);
-        this.mixins.observable.constructor.call(this, config);
-    },
-    init : function(tabpanel){
-        this.tabPanel = tabpanel;
-        this.tabBar = tabpanel.down("tabbar");
-        this.mon(this.tabPanel, {
-            scope: this,
-            afterlayout: this.onAfterLayout,
-            single: true
-        });
-    },
-    onAfterLayout: function() {
-        this.mon(this.tabBar.el, {
-            scope: this,
-            mousedown: this.onMiddleClick,
-            delegate: '.x-tab'
-        });
-    },
-    /**
-     * @private
-     */
-    onMiddleClick : function(event, target){
-        event.preventDefault();
-        if( target &&  event.browserEvent.button==1  ){
-            var item = this.tabBar.getComponent(target.id);
-            item.onCloseClick();
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/TabReorderer.js
+++ b//dev/null
@@ -1,35 +0,0 @@
-/**
- * This plugin allow you to reorder tabs of a TabPanel.
- */
-Ext.define('Ext.ux.TabReorderer', {
-    extend: 'Ext.ux.BoxReorderer',
-    alias: 'plugin.tabreorderer',
-    itemSelector: '.' + Ext.baseCSSPrefix + 'tab',
-    init: function(tabPanel) {
-        var me = this;
-        me.callParent([tabPanel.getTabBar()]);
-        tabPanel.onAdd = Ext.Function.createSequence(tabPanel.onAdd, me.onAdd);
-    },
-    onBoxReady: function() {
-        var tabs, tab, len,
-            i = 0;
-        this.callParent(arguments);
-        for (tabs = this.container.items.items, len = tabs.length; i < len; i++) {
-            tab = tabs[i];
-            if (tab.card) {
-                tab.reorderable = tab.card.reorderable;
-            }
-        }
-    },
-    onAdd: function(card, index) {
-        card.tab.reorderable = card.reorderable;
-    },
-    afterBoxReflow: function() {
-        var me = this;
-        Ext.ux.BoxReorderer.prototype.afterBoxReflow.apply(me, arguments);
-        if (me.dragCmp) {
-            me.container.tabPanel.setActiveTab(me.dragCmp.card);
-            me.container.tabPanel.move(me.dragCmp.card, me.curIndex);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/TabScrollerMenu.js
+++ b//dev/null
@@ -1,216 +0,0 @@
-Ext.ns('Ext.ux');
-/**
- * Plugin for adding a tab menu to a TabBar is the Tabs overflow.
- */
-Ext.define('Ext.ux.TabScrollerMenu', {
-    alias: 'plugin.tabscrollermenu',
-    requires: ['Ext.menu.Menu'],
-    /**
-     * @cfg {Number} pageSize How many items to allow per submenu.
-     */
-    pageSize: 10,
-    /**
-     * @cfg {Number} maxText How long should the title of each {@link Ext.menu.Item} be.
-     */
-    maxText: 15,
-    /**
-     * @cfg {String} menuPrefixText Text to prefix the submenus.
-     */
-    menuPrefixText: 'Items',
-    /**
-     * Creates new TabScrollerMenu.
-     * @param {Object} config Configuration options
-     */
-    constructor: function(config) {
-        Ext.apply(this, config);
-    },
-    /**
-     * @private
-     */
-    init: function(tabPanel) {
-        var me = this;
-        me.tabPanel = tabPanel;
-        tabPanel.on({
-            render: function() {
-                me.tabBar = tabPanel.tabBar;
-                me.layout = me.tabBar.layout;
-                me.layout.overflowHandler.handleOverflow = me.showButton.bind(me);
-                me.layout.overflowHandler.clearOverflow = Ext.Function.createSequence(
-                    me.layout.overflowHandler.clearOverflow, me.hideButton, me
-                );
-            },
-            destroy: me.destroy,
-            scope: me,
-            single: true
-        });
-    },
-    showButton: function() {
-        var me = this,
-            result, button;
-        result = Ext.getClass(me.layout.overflowHandler).prototype.handleOverflow.apply(
-            me.layout.overflowHandler, arguments
-        );
-        button = me.menuButton;
-        if (me.tabPanel.items.getCount() > 1) {
-            if (!button) {
-                button = me.menuButton = me.tabBar.body.createChild({
-                    cls: Ext.baseCSSPrefix + 'tab-tabmenu-right'
-                }, me.tabBar.body.child('.' + Ext.baseCSSPrefix + 'box-scroller-right'));
-                button.addClsOnOver(Ext.baseCSSPrefix + 'tab-tabmenu-over');
-                button.on('click', me.showTabsMenu, me);
-            }
-            button.setVisibilityMode(Ext.dom.Element.DISPLAY);
-            button.show();
-            result.reservedSpace += button.getWidth();
-        }
-        else {
-            me.hideButton();
-        }
-        return result;
-    },
-    hideButton: function() {
-        var me = this;
-        if (me.menuButton) {
-            me.menuButton.hide();
-        }
-    },
-    /**
-     * Returns an the current page size (this.pageSize);
-     * @return {Number} this.pageSize The current page size.
-     */
-    getPageSize: function() {
-        return this.pageSize;
-    },
-    /**
-     * Sets the number of menu items per submenu "page size".
-     * @param {Number} pageSize The page size
-     */
-    setPageSize: function(pageSize) {
-        this.pageSize = pageSize;
-    },
-    /**
-     * Returns the current maxText length;
-     * @return {Number} this.maxText The current max text length.
-     */
-    getMaxText: function() {
-        return this.maxText;
-    },
-    /**
-     * Sets the maximum text size for each menu item.
-     * @param {Number} t The max text per each menu item.
-     */
-    setMaxText: function(t) {
-        this.maxText = t;
-    },
-    /**
-     * Returns the current menu prefix text String.;
-     * @return {String} this.menuPrefixText The current menu prefix text.
-     */
-    getMenuPrefixText: function() {
-        return this.menuPrefixText;
-    },
-    /**
-     * Sets the menu prefix text String.
-     * @param {String} t The menu prefix text.
-     */
-    setMenuPrefixText: function(t) {
-        this.menuPrefixText = t;
-    },
-    showTabsMenu: function(e) {
-        var me = this,
-            target, xy;
-        if (me.tabsMenu) {
-            me.tabsMenu.removeAll();
-        }
-        else {
-            me.tabsMenu = new Ext.menu.Menu();
-        }
-        me.generateTabMenuItems();
-        target = Ext.get(e.getTarget());
-        xy = target.getXY();
-        xy[1] += 24;
-        me.tabsMenu.showAt(xy);
-    },
-    /**
-     * @private
-     */
-    generateTabMenuItems: function() {
-        var me = this,
-            tabPanel = me.tabPanel,
-            curActive = tabPanel.getActiveTab(),
-            allItems = tabPanel.items.getRange(),
-            pageSize = me.getPageSize(),
-            tabsMenu = me.tabsMenu,
-            totalItems, numSubMenus, remainder,
-            i, curPage, menuItems, x, item, start, index;
-        tabsMenu.suspendLayouts();
-        allItems = Ext.Array.filter(allItems, function(item) {
-            if (item.id === curActive.id) {
-                return false;
-            }
-            return item.hidden ? !!item.hiddenByLayout : true;
-        });
-        totalItems = allItems.length;
-        numSubMenus = Math.floor(totalItems / pageSize);
-        remainder = totalItems % pageSize;
-        if (totalItems > pageSize) {
-            for (i = 0; i < numSubMenus; i++) {
-                curPage = (i + 1) * pageSize;
-                menuItems = [];
-                for (x = 0; x < pageSize; x++) {
-                    index = x + curPage - pageSize;
-                    item = allItems[index];
-                    menuItems.push(me.autoGenMenuItem(item));
-                }
-                tabsMenu.add({
-                    text: me.getMenuPrefixText() + ' ' + (curPage - pageSize + 1) + ' - ' + curPage,
-                    menu: menuItems
-                });
-            }
-            if (remainder > 0) {
-                start = numSubMenus * pageSize;
-                menuItems = [];
-                for (i = start; i < totalItems; i++) {
-                    item = allItems[i];
-                    menuItems.push(me.autoGenMenuItem(item));
-                }
-                me.tabsMenu.add({
-                    text: me.menuPrefixText + ' ' + (start + 1) + ' - ' +
-                          (start + menuItems.length),
-                    menu: menuItems
-                });
-            }
-        }
-        else {
-            for (i = 0; i < totalItems; ++i) {
-                tabsMenu.add(me.autoGenMenuItem(allItems[i]));
-            }
-        }
-        tabsMenu.resumeLayouts(true);
-    },
-    /**
-     * @private
-     */
-    autoGenMenuItem: function(item) {
-        var maxText = this.getMaxText(),
-            text = Ext.util.Format.ellipsis(item.title, maxText);
-        return {
-            text: text,
-            handler: this.showTabFromMenu,
-            scope: this,
-            disabled: item.disabled,
-            tabToShow: item,
-            iconCls: item.iconCls
-        };
-    },
-    /**
-     * @private
-     */
-    showTabFromMenu: function(menuItem) {
-        this.tabPanel.setActiveTab(menuItem.tabToShow);
-    },
-    destroy: function() {
-        Ext.destroy(this.tabsMenu, this.menuButton);
-        this.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/ToolbarDroppable.js
+++ b//dev/null
@@ -1,138 +0,0 @@
-/**
- * Plugin which allows items to be dropped onto a toolbar and be turned into new Toolbar items.
- * To use the plugin, you just need to provide a createItem implementation that takes the drop
- * data as an argument and returns an object that can be placed onto the toolbar. Example:
- * <pre>
- * Ext.create('Ext.ux.ToolbarDroppable', {
- *   createItem: function(data) {
- *     return Ext.create('Ext.Button', {text: data.text});
- *   }
- * });
- * </pre>
- * The afterLayout function can also be overridden, and is called after a new item has been
- * created and inserted into the Toolbar. Use this for any logic that needs to be run after
- * the item has been created.
- */
-Ext.define('Ext.ux.ToolbarDroppable', {
-    /**
-     * Creates new ToolbarDroppable.
-     * @param {Object} config Config options.
-     */
-    constructor: function(config) {
-        Ext.apply(this, config);
-    },
-    /**
-     * Initializes the plugin and saves a reference to the toolbar
-     * @param {Ext.toolbar.Toolbar} toolbar The toolbar instance
-     */
-    init: function(toolbar) {
-        /**
-       * @property toolbar
-       * @type Ext.toolbar.Toolbar
-       * The toolbar instance that this plugin is tied to
-       */
-        this.toolbar = toolbar;
-        this.toolbar.on({
-            scope: this,
-            render: this.createDropTarget
-        });
-    },
-    /**
-     * Creates a drop target on the toolbar
-     */
-    createDropTarget: function() {
-        /**
-         * @property dropTarget
-         * @type Ext.dd.DropTarget
-         * The drop target attached to the toolbar instance
-         */
-        this.dropTarget = Ext.create('Ext.dd.DropTarget', this.toolbar.getEl(), {
-            notifyOver: this.notifyOver.bind(this),
-            notifyDrop: this.notifyDrop.bind(this)
-        });
-    },
-    /**
-     * Adds the given DD Group to the drop target
-     * @param {String} ddGroup The DD Group
-     */
-    addDDGroup: function(ddGroup) {
-        this.dropTarget.addToGroup(ddGroup);
-    },
-    /**
-     * Calculates the location on the toolbar to create the new sorter button based on the XY of the
-     * drag event
-     * @param {Ext.event.Event} e The event object
-     * @return {Number} The index at which to insert the new button
-     */    
-    calculateEntryIndex: function(e) {
-        var entryIndex = 0,
-            toolbar = this.toolbar,
-            items = toolbar.items.items,
-            count = items.length,
-            xHover = e.getXY()[0],
-            index = 0,
-            el, xTotal, width, midpoint;
-        for (; index < count; index++) {
-            el = items[index].getEl();
-            xTotal = el.getXY()[0];
-            width = el.getWidth();
-            midpoint = xTotal + width / 2;
-            if (xHover < midpoint) {
-                entryIndex = index;
-                break;
-            }
-            else {
-                entryIndex = index + 1;
-            }
-        }
-        return entryIndex;
-    },
-    /**
-     * Returns true if the drop is allowed on the drop target. This function can be overridden
-     * and defaults to simply return true
-     * @param {Object} data Arbitrary data from the drag source
-     * @return {Boolean} True if the drop is allowed
-     */
-    canDrop: function(data) {
-        return true;
-    },
-    /**
-     * Custom notifyOver method which will be used in the plugin's internal DropTarget
-     * @return {String} The CSS class to add
-     */
-    notifyOver: function(dragSource, event, data) {
-        return this.canDrop.apply(this, arguments)
-            ? this.dropTarget.dropAllowed
-            : this.dropTarget.dropNotAllowed;
-    },
-    /**
-     * Called when the drop has been made. Creates the new toolbar item, places it
-     * at the correct location and calls the afterLayout callback.
-     */
-    notifyDrop: function(dragSource, event, data) {
-        var canAdd = this.canDrop(dragSource, event, data),
-            tbar = this.toolbar,
-            entryIndex;
-        if (canAdd) {
-            entryIndex = this.calculateEntryIndex(event);
-            tbar.insert(entryIndex, this.createItem(data));
-            this.afterLayout();
-        }
-        return canAdd;
-    },
-    /**
-     * Creates the new toolbar item based on drop data. This method must be implemented
-     * by the plugin instance
-     * @param {Object} data Arbitrary data from the drop
-     * @return {Mixed} An item that can be added to a toolbar
-     */
-    createItem: function(data) {
-        Ext.raise("The createItem method must be implemented in the ToolbarDroppable plugin");
-    },
-    /**
-     * @method
-     * Called after a new button has been created and added to the toolbar. Add any required
-     * cleanup logic here
-     */
-    afterLayout: Ext.emptyFn
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/TreePicker.js
+++ b//dev/null
@@ -1,210 +0,0 @@
-/**
- * A Picker field that contains a tree panel on its popup, enabling selection of tree nodes.
- */
-Ext.define('Ext.ux.TreePicker', {
-    extend: 'Ext.form.field.Picker',
-    xtype: 'treepicker',
-    uses: [
-        'Ext.tree.Panel'
-    ],
-    triggerCls: Ext.baseCSSPrefix + 'form-arrow-trigger',
-    config: {
-        /**
-         * @cfg {Ext.data.TreeStore} store
-         * A tree store that the tree picker will be bound to
-         */
-        store: null,
-        /**
-         * @cfg {String} displayField
-         * The field inside the model that will be used as the node's text.
-         * Defaults to the default value of {@link Ext.tree.Panel}'s `displayField` configuration.
-         */
-        displayField: null,
-        /**
-         * @cfg {Array} columns
-         * An optional array of columns for multi-column trees
-         */
-        columns: null,
-        /**
-         * @cfg {Boolean} selectOnTab
-         * Whether the Tab key should select the currently highlighted item. Defaults to `true`.
-         */
-        selectOnTab: true,
-        /**
-         * @cfg {Number} maxPickerHeight
-         * The maximum height of the tree dropdown. Defaults to 300.
-         */
-        maxPickerHeight: 300,
-        /**
-         * @cfg {Number} minPickerHeight
-         * The minimum height of the tree dropdown. Defaults to 100.
-         */
-        minPickerHeight: 100
-    },
-    editable: false,
-    /**
-     * @event select
-     * Fires when a tree node is selected
-     * @param {Ext.ux.TreePicker} picker        This tree picker
-     * @param {Ext.data.Model} record           The selected record
-     */
-    initComponent: function() {
-        var me = this;
-        me.callParent(arguments);
-        me.mon(me.store, {
-            scope: me,
-            load: me.onLoad,
-            update: me.onUpdate
-        });
-    },
-    /**
-     * Creates and returns the tree panel to be used as this field's picker.
-     */
-    createPicker: function() {
-        var me = this,
-            picker = new Ext.tree.Panel({
-                baseCls: Ext.baseCSSPrefix + 'boundlist',
-                shrinkWrapDock: 2,
-                store: me.store,
-                floating: true,
-                displayField: me.displayField,
-                columns: me.columns,
-                minHeight: me.minPickerHeight,
-                maxHeight: me.maxPickerHeight,
-                manageHeight: false,
-                shadow: false,
-                listeners: {
-                    scope: me,
-                    itemclick: me.onItemClick,
-                    itemkeydown: me.onPickerKeyDown
-                }
-            }),
-            view = picker.getView();
-        if (Ext.isIE9 && Ext.isStrict) {
-            view.on({
-                scope: me,
-                highlightitem: me.repaintPickerView,
-                unhighlightitem: me.repaintPickerView,
-                afteritemexpand: me.repaintPickerView,
-                afteritemcollapse: me.repaintPickerView
-            });
-        }
-        return picker;
-    },
-    /**
-     * repaints the tree view
-     */
-    repaintPickerView: function() {
-        var style = this.picker.getView().getEl().dom.style;
-        style.display = style.display; // eslint-disable-line no-self-assign
-    },
-    /**
-     * Handles a click even on a tree node
-     * @private
-     * @param {Ext.tree.View} view
-     * @param {Ext.data.Model} record
-     * @param {HTMLElement} node
-     * @param {Number} rowIndex
-     * @param {Ext.event.Event} e
-     */
-    onItemClick: function(view, record, node, rowIndex, e) {
-        this.selectItem(record);
-    },
-    /**
-     * Handles a keypress event on the picker element
-     * @private
-     * @param {Ext.tree.View} treeView
-     * @param {Ext.data.Model} record
-     * @param {HTMLElement} item
-     * @param {Number} index
-     * @param {Ext.event.Event} e
-     */
-    onPickerKeyDown: function(treeView, record, item, index, e) {
-        var key = e.getKey();
-        if (key === e.ENTER || (key === e.TAB && this.selectOnTab)) {
-            this.selectItem(record);
-        }
-    },
-    /**
-     * Changes the selection to a given record and closes the picker
-     * @private
-     * @param {Ext.data.Model} record
-     */
-    selectItem: function(record) {
-        var me = this;
-        me.setValue(record.getId());
-        me.fireEvent('select', me, record);
-        me.collapse();
-    },
-    /**
-     * Runs when the picker is expanded.  Selects the appropriate tree node based on the value
-     * of the input element, and focuses the picker so that keyboard navigation will work.
-     * @private
-     */
-    onExpand: function() {
-        var picker = this.picker,
-            store = picker.store,
-            value = this.value,
-            node;
-        if (value) {
-            node = store.getNodeById(value);
-        }
-        if (!node) {
-            node = store.getRoot();
-        }
-        picker.ensureVisible(node, {
-            select: true,
-            focus: true
-        });
-    },
-    /**
-     * Sets the specified value into the field
-     * @param {Mixed} value
-     * @return {Ext.ux.TreePicker} this
-     */
-    setValue: function(value) {
-        var me = this,
-            record;
-        me.value = value;
-        if (me.store.loading) {
-            return me;
-        }
-        record = value ? me.store.getNodeById(value) : me.store.getRoot();
-        if (value === undefined) {
-            record = me.store.getRoot();
-            me.value = record.getId();
-        }
-        else {
-            record = me.store.getNodeById(value);
-        }
-        me.setRawValue(record ? record.get(me.displayField) : '');
-        return me;
-    },
-    getSubmitValue: function() {
-        return this.value;
-    },
-    /**
-     * Returns the current data value of the field (the idProperty of the record)
-     * @return {Number}
-     */
-    getValue: function() {
-        return this.value;
-    },
-    /**
-     * Handles the store's load event.
-     * @private
-     */
-    onLoad: function() {
-        var value = this.value;
-        if (value) {
-            this.setValue(value);
-        }
-    },
-    onUpdate: function(store, rec, type, modifiedFieldNames) {
-        var display = this.displayField;
-        if (type === 'edit' && modifiedFieldNames &&
-            Ext.Array.contains(modifiedFieldNames, display) && this.value === rec.getId()) {
-            this.setRawValue(rec.get(display));
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/Button.js
+++ b//dev/null
@@ -1,94 +0,0 @@
-/**
- * A simple color swatch that can be clicked to bring up the color selector.
- *
- * The selected color is configurable via {@link #value}.
- *
- *     @example
- *     Ext.create('Ext.ux.colorpick.Button', {
- *         value: '993300',  // initial selected color
- *         renderTo: Ext.getBody(),
- *
- *         listeners: {
- *             select: function(picker, selColor) {
- *                 Ext.Msg.alert('Color', selColor);
- *             }
- *         }
- *     });
- */
-Ext.define('Ext.ux.colorpick.Button', {
-    extend: 'Ext.Component',
-    xtype: 'colorbutton',
-    controller: 'colorpick-buttoncontroller',
-    mixins: [
-        'Ext.ux.colorpick.Selection'
-    ],
-    requires: [
-        'Ext.ux.colorpick.ButtonController'
-    ],
-    baseCls: Ext.baseCSSPrefix + 'colorpicker-button',
-    width: 20,
-    height: 20,
-    childEls: [
-        'btnEl', 'filterEl'
-    ],
-    config: {
-        /**
-         * @cfg {Object} popup
-         * This object configures the popup window and colorselector component displayed
-         * when this button is clicked. Applications should not need to configure this.
-         * @private
-         */
-        popup: {
-            lazy: true,
-            $value: {
-                xtype: 'window',
-                closeAction: 'hide',
-                referenceHolder: true,
-                minWidth: 540,
-                minHeight: 200,
-                layout: 'fit',
-                header: false,
-                resizable: true,
-                items: {
-                    xtype: 'colorselector',
-                    reference: 'selector',
-                    showPreviousColor: true,
-                    showOkCancelButtons: true
-                }
-            }
-        }
-    },
-    defaultBindProperty: 'value',
-    twoWayBindable: 'value',
-    /* eslint-disable max-len */
-    renderTpl:
-        '<div id="{id}-filterEl" data-ref="filterEl" style="height:100%; width:100%; position: absolute;"></div>' +
-        '<a id="{id}-btnEl" data-ref="btnEl" style="height:100%; width:100%; position: absolute;"></a>',
-    /* eslint-enable max-len */
-    listeners: {
-        click: 'onClick',
-        element: 'btnEl'
-    },
-    /**
-     * @event change
-     * Fires when a color is selected.
-     * @param {Ext.ux.colorpick.Selector} this
-     * @param {String} color The value of the selected color as per specified {@link #format}.
-     * @param {String} previousColor The previous color value.
-     */
-    updateColor: function(color) {
-        var me = this,
-            cp = me.colorPicker;
-        me.mixins.colorselection.updateColor.call(me, color);
-        Ext.ux.colorpick.ColorUtils.setBackground(me.filterEl, color);
-        if (cp) {
-            cp.setColor(color);
-        }
-    },
-    updateFormat: function(format) {
-        var cp = this.colorPicker;
-        if (cp) {
-            cp.setFormat(format);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/ButtonController.js
+++ b//dev/null
@@ -1,72 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.ButtonController', {
-    extend: 'Ext.app.ViewController',
-    alias: 'controller.colorpick-buttoncontroller',
-    requires: [
-        'Ext.window.Window',
-        'Ext.layout.container.Fit',
-        'Ext.ux.colorpick.Selector',
-        'Ext.ux.colorpick.ColorUtils'
-    ],
-    afterRender: function(view) {
-        view.updateColor(view.getColor());
-    },
-    destroy: function() {
-        var view = this.getView(),
-            colorPickerWindow = view.colorPickerWindow;
-        if (colorPickerWindow) {
-            colorPickerWindow.destroy();
-            view.colorPickerWindow = view.colorPicker = null;
-        }
-        this.callParent();
-    },
-    getPopup: function() {
-        var view = this.getView(),
-            popup = view.colorPickerWindow,
-            selector;
-        if (!popup) {
-            popup = Ext.create(view.getPopup());
-            view.colorPickerWindow = popup;
-            popup.colorPicker = view.colorPicker = selector = popup.lookupReference('selector');
-            selector.setFormat(view.getFormat());
-            selector.on({
-                ok: 'onColorPickerOK',
-                cancel: 'onColorPickerCancel',
-                scope: this
-            });
-            popup.on({
-                close: 'onColorPickerCancel',
-                scope: this
-            });
-        }
-        return popup;
-    },
-    onClick: function() {
-        var me = this,
-            view = me.getView(),
-            color = view.getColor(),
-            popup = me.getPopup(),
-            colorPicker = popup.colorPicker;
-        colorPicker.setColor(color);
-        colorPicker.setPreviousColor(color);
-        popup.showBy(view, 'tl-br?');
-    },
-    onColorPickerOK: function(picker) {
-        var view = this.getView(),
-            color = picker.getColor(),
-            cpWin = view.colorPickerWindow;
-        cpWin.hide();
-        view.setColor(color);
-    },
-    onColorPickerCancel: function() {
-        var view = this.getView(),
-            cpWin = view.colorPickerWindow;
-        cpWin.hide();
-    },
-    syncColor: function(color) {
-        var view = this.getView();
-        Ext.ux.colorpick.ColorUtils.setBackground(view.filterEl, color);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/ColorMap.js
+++ b//dev/null
@@ -1,77 +0,0 @@
-/**
- * The main colorful square for selecting color shades by dragging around the
- * little circle.
- * @private
- */
-Ext.define('Ext.ux.colorpick.ColorMap', {
-    extend: 'Ext.container.Container',
-    alias: 'widget.colorpickercolormap',
-    controller: 'colorpickercolormapcontroller',
-    requires: [
-        'Ext.ux.colorpick.ColorMapController'
-    ],
-    cls: Ext.baseCSSPrefix + 'colorpicker-colormap',
-    items: [{
-        xtype: 'component',
-        cls: Ext.baseCSSPrefix + 'colorpicker-colormap-draghandle-container',
-        itemId: 'dragHandle',
-        width: 1,
-        height: 1,
-        draggable: true,
-        html: '<div class="' + Ext.baseCSSPrefix + 'colorpicker-colormap-draghandle"></div>'
-    }],
-    listeners: {
-        boxready: {
-            single: true,
-            fn: 'onFirstBoxReady',
-            scope: 'controller'
-        },
-        colorbindingchanged: {
-            fn: 'onColorBindingChanged',
-            scope: 'controller'
-        },
-        huebindingchanged: {
-            fn: 'onHueBindingChanged',
-            scope: 'controller'
-        }
-    },
-    afterRender: function() {
-        var me = this,
-            src = me.mapGradientUrl,
-            el = me.el;
-        me.callParent();
-        if (!src) {
-            src = el.getStyle('background-image');
-            src = src.substring(4, src.length - 1);  // strip off outer "url(...)"
-            if (src.indexOf('"') === 0) {
-                src = src.substring(1, src.length - 1);
-            }
-            Ext.ux.colorpick.ColorMap.prototype.mapGradientUrl = src;
-        }
-        el.setStyle('background-image', 'none');
-        el = me.layout.getElementTarget(); // the el for items and html
-        el.createChild({
-            tag: 'img',
-            cls: Ext.baseCSSPrefix + 'colorpicker-colormap-blender',
-            src: src
-        });
-    },
-    setPosition: function(data) {
-        var me = this,
-            dragHandle = me.down('#dragHandle');
-        if (!dragHandle.dd || !dragHandle.dd.constrain) {
-            return;
-        }
-        if (typeof dragHandle.dd.dragEnded !== 'undefined' && !dragHandle.dd.dragEnded) {
-            return;
-        }
-        me.fireEvent('colorbindingchanged', data);
-    },
-    setHue: function(hue) {
-        var me = this;
-        if (!me.getEl()) {
-            return;
-        }
-        me.fireEvent('huebindingchanged', hue);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/ColorMapController.js
+++ b//dev/null
@@ -1,102 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.ColorMapController', {
-    extend: 'Ext.app.ViewController',
-    alias: 'controller.colorpickercolormapcontroller',
-    requires: [
-        'Ext.ux.colorpick.ColorUtils'
-    ],
-    onFirstBoxReady: function() {
-        var me = this,
-            colorMap = me.getView(),
-            dragHandle = colorMap.down('#dragHandle'),
-            dd = dragHandle.dd;
-        dd.constrain = true;
-        dd.constrainTo = colorMap.getEl();
-        dd.initialConstrainTo = dd.constrainTo; // needed otheriwse error EXTJS-13187
-        dd.on('drag', Ext.bind(me.onHandleDrag, me));
-        me.mon(colorMap.getEl(), {
-            mousedown: me.onMouseDown,
-            dragstart: me.onDragStart,
-            scope: me
-        });
-    },
-    onHandleDrag: function(componentDragger, e) {
-        var me = this,
-            container = me.getView(), // the Color Map
-            dragHandle = container.down('#dragHandle'),
-            x = dragHandle.getX() - container.getX(),
-            y = dragHandle.getY() - container.getY(),
-            containerEl = container.getEl(),
-            containerWidth = containerEl.getWidth(),
-            containerHeight = containerEl.getHeight(),
-            xRatio = x / containerWidth,
-            yRatio = y / containerHeight;
-        if (xRatio > 0.99) {
-            xRatio = 1;
-        }
-        if (yRatio > 0.99) {
-            yRatio = 1;
-        }
-        container.fireEvent('handledrag', xRatio, yRatio);
-    },
-    onMouseDown: function(e) {
-        var me = this,
-            container = me.getView(),
-            dragHandle = container.down('#dragHandle');
-        dragHandle.setY(e.getY());
-        dragHandle.setX(e.getX());
-        me.onHandleDrag();
-        dragHandle.dd.onMouseDown(e, dragHandle.dd.el);
-    },
-    onDragStart: function(e) {
-        var me = this,
-            container = me.getView(),
-            dragHandle = container.down('#dragHandle');
-        dragHandle.dd.onDragStart(e, dragHandle.dd.el);
-    },
-    onMapClick: function(e) {
-        var me = this,
-            container = me.getView(), // the Color Map
-            dragHandle = container.down('#dragHandle'),
-            cXY = container.getXY(),
-            eXY = e.getXY(),
-            left, top;
-        left = eXY[0] - cXY[0];
-        top = eXY[1] - cXY[1];
-        dragHandle.getEl().setStyle({
-            left: left + 'px',
-            top: top + 'px'
-        });
-        me.onHandleDrag();
-    },
-    onColorBindingChanged: function(selectedColor) {
-        var me = this,
-            vm = me.getViewModel(),
-            rgba = vm.get('selectedColor'),
-            container = me.getView(), // the Color Map
-            dragHandle = container.down('#dragHandle'),
-            containerEl = container.getEl(),
-            containerWidth = containerEl.getWidth(),
-            containerHeight = containerEl.getHeight(),
-            hsv, xRatio, yRatio, left, top;
-        hsv = Ext.ux.colorpick.ColorUtils.rgb2hsv(rgba.r, rgba.g, rgba.b);
-        xRatio = hsv.s;
-        left = containerWidth * xRatio;
-        yRatio = 1 - hsv.v;
-        top = containerHeight * yRatio;
-        dragHandle.getEl().setStyle({
-            left: left + 'px',
-            top: top + 'px'
-        });
-    },
-    onHueBindingChanged: function(hue) {
-        var me = this,
-            fullColorRGB,
-            hex;
-        fullColorRGB = Ext.ux.colorpick.ColorUtils.hsv2rgb(hue, 1, 1);
-        hex = Ext.ux.colorpick.ColorUtils.rgb2hex(fullColorRGB.r, fullColorRGB.g, fullColorRGB.b);
-        me.getView().getEl().applyStyles({ 'background-color': '#' + hex });
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/ColorPreview.js
+++ b//dev/null
@@ -1,54 +0,0 @@
-/**
- * A basic component that changes background color, with considerations for opacity
- * support (checkered background image and IE8 support).
- */
-Ext.define('Ext.ux.colorpick.ColorPreview', {
-    extend: 'Ext.Component',
-    alias: 'widget.colorpickercolorpreview',
-    requires: [
-        'Ext.util.Format',
-        'Ext.XTemplate'
-    ],
-    style: 'position: relative',
-    /* eslint-disable max-len */
-    html: '<div class="' + Ext.baseCSSPrefix + 'colorpreview-filter" style="height:100%; width:100%; position: absolute;"></div>' +
-          '<a class="btn" style="height:100%; width:100%; position: absolute;"></a>',
-    /* eslint-enable max-len */
-    cls: Ext.baseCSSPrefix + 'colorpreview',
-    height: 256,
-    onRender: function() {
-        var me = this;
-        me.callParent(arguments);
-        me.mon(me.el.down('.btn'), 'click', me.onClick, me);
-    },
-    onClick: function() {
-        this.fireEvent('click', this, this.color);
-    },
-    setColor: function(color) {
-        var me = this,
-            el = me.getEl();
-        if (!el) {
-            return;
-        }
-        me.color = color;
-        me.applyBgStyle(color);
-    },
-    bgStyleTpl: Ext.create(
-        'Ext.XTemplate',
-        Ext.isIE && Ext.ieVersion < 10
-            ? 'filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=\'#{hexAlpha}{hex}\', endColorstr=\'#{hexAlpha}{hex}\');' /* IE6-9 */
-            : 'background: {rgba};'
-    ),
-    applyBgStyle: function(color) {
-        var me = this,
-            colorUtils = Ext.ux.colorpick.ColorUtils,
-            filterSelector = '.' + Ext.baseCSSPrefix + 'colorpreview-filter',
-            el = me.getEl().down(filterSelector),
-            hex, alpha, rgba, bgStyle;
-        hex = colorUtils.rgb2hex(color.r, color.g, color.b);
-        alpha = Ext.util.Format.hex(Math.floor(color.a * 255), 2);
-        rgba = colorUtils.getRGBAString(color);
-        bgStyle = this.bgStyleTpl.apply({ hex: hex, hexAlpha: alpha, rgba: rgba });
-        el.applyStyles(bgStyle);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/ColorUtils.js
+++ b//dev/null
@@ -1,485 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.ColorUtils', function(ColorUtils) {
-    var oldIE = Ext.isIE && Ext.ieVersion < 10;
-    return {
-        singleton: true,
-        constructor: function() {
-            ColorUtils = this;
-        },
-        backgroundTpl: oldIE
-            ? 'filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, ' +
-                'startColorstr=\'#{alpha}{hex}\', endColorstr=\'#{alpha}{hex}\');'
-            : 'background: {rgba};',
-        setBackground: oldIE
-            ? function(el, color) {
-                var tpl, data, bgStyle;
-                if (el) {
-                    tpl = Ext.XTemplate.getTpl(ColorUtils, 'backgroundTpl');
-                    data = {
-                        hex: ColorUtils.rgb2hex(color.r, color.g, color.b),
-                        alpha: Math.floor(color.a * 255).toString(16)
-                    };
-                    bgStyle = tpl.apply(data);
-                    el.applyStyles(bgStyle);
-                }
-            }
-            : function(el, color) {
-                var tpl, data, bgStyle;
-                if (el) {
-                    tpl = Ext.XTemplate.getTpl(ColorUtils, 'backgroundTpl');
-                    data = {
-                        rgba: ColorUtils.getRGBAString(color)
-                    };
-                    bgStyle = tpl.apply(data);
-                    el.applyStyles(bgStyle);
-                }
-            },
-        formats: {
-            RGB: function(colorO) {
-                return ColorUtils.getRGBString(colorO).toUpperCase();
-            },
-            RGBA: function(colorO) {
-                return ColorUtils.getRGBAString(colorO).toUpperCase();
-            },
-            HEX6: function(colorO) {
-                return ColorUtils.rgb2hex(colorO.r, colorO.g, colorO.b);
-            },
-            HEX8: function(colorO) {
-                var hex = ColorUtils.rgb2hex(colorO.r, colorO.g, colorO.b),
-                    opacityHex = Math.round(colorO.a * 255).toString(16);
-                if (opacityHex.length < 2) {
-                    hex += '0';
-                }
-                hex += opacityHex.toUpperCase();
-                return hex;
-            }
-        },
-        /* eslint-disable no-useless-escape */
-        hexRe: /^#?(([0-9a-f]{8})|((?:[0-9a-f]{3}){1,2}))$/i,
-        rgbaAltRe: /^rgba\(\s*([\w#\d]+)\s*,\s*([\d\.]+)\s*\)$/i,
-        rgbaRe: /^rgba\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)$/i,
-        rgbRe: /^rgb\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)$/i,
-        /* eslint-enable no-useless-escape */
-        /**
-         * Turn a string to a color object. Supports these formats:
-         *
-         * - "#ABC" (HEX short)
-         * - "#ABCDEF" (HEX)
-         * - "#ABCDEFDD" (HEX with opacity)
-         * - "red" (named colors - see 
-         * [Web Colors](http://en.wikipedia.org/wiki/Web_colors) for a full list)
-         * - "rgba(r,g,b,a)" i.e "rgba(255,0,0,1)" (a == alpha == 0-1)
-         * - "rgba(red, 0.4)"
-         * - "rgba(#ABC, 0.9)"
-         * - "rgba(#ABCDEF, 0.8)"
-         *
-         * @param {String} color The color string to parse.
-         * @param {String} alphaFormat The format of decimal places for the Alpha channel.
-         * @return {Object} Object with various color properties.
-         * @return {Number} return.r The red component (0-255).
-         * @return {Number} return.g The green component (0-255).
-         * @return {Number} return.b The blue component (0-255).
-         * @return {Number} return.a The red component (0-1).
-         * @return {Number} return.h The hue component (0-1).
-         * @return {Number} return.s The saturation component (0-1).
-         * @return {Number} return.v The value component (0-1).
-         */
-        parseColor: function(color, alphaFormat) {
-            if (!color) {
-                return null;
-            }
-            var me = this,
-                rgb = me.colorMap[color],
-                match, ret, hsv;
-            if (rgb) {
-                ret = {
-                    r: rgb[0],
-                    g: rgb[1],
-                    b: rgb[2],
-                    a: 1
-                };
-            }
-            else if (color === 'transparent') {
-                ret = {
-                    r: 0,
-                    g: 0,
-                    b: 0,
-                    a: 0
-                };
-            }
-            else {
-                match = me.hexRe.exec(color);
-                if (match) {
-                    match = match[1]; // the captured hex
-                    switch (match.length) {
-                        default:
-                            return null;
-                        case 3:
-                            ret = {
-                                r: parseInt(match[0] + match[0], 16),
-                                g: parseInt(match[1] + match[1], 16),
-                                b: parseInt(match[2] + match[2], 16),
-                                a: 1
-                            };
-                            break;
-                        case 6:
-                        case 8:
-                            ret = {
-                                r: parseInt(match.substr(0, 2), 16),
-                                g: parseInt(match.substr(2, 2), 16),
-                                b: parseInt(match.substr(4, 2), 16),
-                                a: parseInt(match.substr(6, 2) || 'ff', 16) / 255
-                            };
-                            break;
-                    }
-                }
-                else {
-                    match = me.rgbaRe.exec(color);
-                    if (match) {
-                        ret = {
-                            r: parseFloat(match[1]),
-                            g: parseFloat(match[2]),
-                            b: parseFloat(match[3]),
-                            a: parseFloat(match[4])
-                        };
-                    }
-                    else {
-                        match = me.rgbaAltRe.exec(color);
-                        if (match) {
-                            ret = me.parseColor(match[1]);
-                            ret.a = parseFloat(match[2]);
-                            return ret;
-                        }
-                        match = me.rgbRe.exec(color);
-                        if (match) {
-                            ret = {
-                                r: parseFloat(match[1]),
-                                g: parseFloat(match[2]),
-                                b: parseFloat(match[3]),
-                                a: 1
-                            };
-                        }
-                        else {
-                            return null;
-                        }
-                    }
-                }
-            }
-            if (alphaFormat) {
-                ret.a = Ext.util.Format.number(ret.a, alphaFormat);
-            }
-            hsv = this.rgb2hsv(ret.r, ret.g, ret.b);
-            return Ext.apply(ret, hsv);
-        },
-        isValid: function(color) {
-            return ColorUtils.parseColor(color) !== null;
-        },
-        /**
-         *
-         * @param rgba
-         * @return {String}
-         */
-        getRGBAString: function(rgba) {
-            return "rgba(" + rgba.r + "," + rgba.g + "," + rgba.b + "," + rgba.a + ")";
-        },
-        /**
-         * Returns a rgb css string whith this color (without the alpha channel)
-         * @param rgb
-         * @return {String}
-         */
-        getRGBString: function(rgb) {
-            return "rgb(" + rgb.r + "," + rgb.g + "," + rgb.b + ")";
-        },
-        /**
-         * Following standard math to convert from hsl to rgb
-         * Check out wikipedia page for more information on how this works
-         * h => [0,1]
-         * s,l => [0,1]
-         * @param h
-         * @param s
-         * @param v
-         * @return {Object} An object with "r", "g" and "b" color properties.
-         */
-        hsv2rgb: function(h, s, v) {
-            h = h * 360;
-            if (h === 360) {
-                h = 0;
-            }
-            var c = v * s,
-                hprime = h / 60,
-                x = c * (1 - Math.abs(hprime % 2 - 1)),
-                rgb = [0, 0, 0],
-                m;
-            switch (Math.floor(hprime)) {
-                case 0:
-                    rgb = [c, x, 0];
-                    break;
-                case 1:
-                    rgb = [x, c, 0];
-                    break;
-                case 2:
-                    rgb = [0, c, x];
-                    break;
-                case 3:
-                    rgb = [0, x, c];
-                    break;
-                case 4:
-                    rgb = [x, 0, c];
-                    break;
-                case 5:
-                    rgb = [c, 0, x];
-                    break;
-                default:
-                    console.error("unknown color " + h + ' ' + s + " " + v);
-                    break;
-            }
-            m = v - c;
-            rgb[0] += m;
-            rgb[1] += m;
-            rgb[2] += m;
-            rgb[0] = Math.round(rgb[0] * 255);
-            rgb[1] = Math.round(rgb[1] * 255);
-            rgb[2] = Math.round(rgb[2] * 255);
-            return {
-                r: rgb[0],
-                g: rgb[1],
-                b: rgb[2]
-            };
-        },
-        /**
-         * http://en.wikipedia.org/wiki/HSL_and_HSV
-         * @param {Number} r The red component (0-255).
-         * @param {Number} g The green component (0-255).
-         * @param {Number} b The blue component (0-255).
-         * @return {Object} An object with "h", "s" and "v" color properties.
-         */
-        rgb2hsv: function(r, g, b) {
-            r = r / 255;
-            g = g / 255;
-            b = b / 255;
-            var M = Math.max(r, g, b),
-                m = Math.min(r, g, b),
-                c = M - m,
-                hprime = 0,
-                s = 0,
-                h, v;
-            if (c !== 0) {
-                if (M === r) {
-                    hprime = ((g - b) / c) % 6;
-                }
-                else if (M === g) {
-                    hprime = ((b - r) / c) + 2;
-                }
-                else if (M === b) {
-                    hprime = ((r - g) / c) + 4;
-                }
-            }
-            h = hprime * 60;
-            if (h === 360) {
-                h = 0;
-            }
-            v = M;
-            if (c !== 0) {
-                s = c / v;
-            }
-            h = h / 360;
-            if (h < 0) {
-                h = h + 1;
-            }
-            return {
-                h: h,
-                s: s,
-                v: v
-            };
-        },
-        /**
-         *
-         * @param r
-         * @param g
-         * @param b
-         * @return {String}
-         */
-        rgb2hex: function(r, g, b) {
-            r = r.toString(16);
-            g = g.toString(16);
-            b = b.toString(16);
-            if (r.length < 2) {
-                r = '0' + r;
-            }
-            if (g.length < 2) {
-                g = '0' + g;
-            }
-            if (b.length < 2) {
-                b = '0' + b;
-            }
-            return (r + g + b).toUpperCase();
-        },
-        colorMap: {
-            aliceblue: [240, 248, 255],
-            antiquewhite: [250, 235, 215],
-            aqua: [0, 255, 255],
-            aquamarine: [127, 255, 212],
-            azure: [240, 255, 255],
-            beige: [245, 245, 220],
-            bisque: [255, 228, 196],
-            black: [0, 0, 0],
-            blanchedalmond: [255, 235, 205],
-            blue: [0, 0, 255],
-            blueviolet: [138, 43, 226],
-            brown: [165, 42, 42],
-            burlywood: [222, 184, 135],
-            cadetblue: [95, 158, 160],
-            chartreuse: [127, 255, 0],
-            chocolate: [210, 105, 30],
-            coral: [255, 127, 80],
-            cornflowerblue: [100, 149, 237],
-            cornsilk: [255, 248, 220],
-            crimson: [220, 20, 60],
-            cyan: [0, 255, 255],
-            darkblue: [0, 0, 139],
-            darkcyan: [0, 139, 139],
-            darkgoldenrod: [184, 132, 11],
-            darkgray: [169, 169, 169],
-            darkgreen: [0, 100, 0],
-            darkgrey: [169, 169, 169],
-            darkkhaki: [189, 183, 107],
-            darkmagenta: [139, 0, 139],
-            darkolivegreen: [85, 107, 47],
-            darkorange: [255, 140, 0],
-            darkorchid: [153, 50, 204],
-            darkred: [139, 0, 0],
-            darksalmon: [233, 150, 122],
-            darkseagreen: [143, 188, 143],
-            darkslateblue: [72, 61, 139],
-            darkslategray: [47, 79, 79],
-            darkslategrey: [47, 79, 79],
-            darkturquoise: [0, 206, 209],
-            darkviolet: [148, 0, 211],
-            deeppink: [255, 20, 147],
-            deepskyblue: [0, 191, 255],
-            dimgray: [105, 105, 105],
-            dimgrey: [105, 105, 105],
-            dodgerblue: [30, 144, 255],
-            firebrick: [178, 34, 34],
-            floralwhite: [255, 255, 240],
-            forestgreen: [34, 139, 34],
-            fuchsia: [255, 0, 255],
-            gainsboro: [220, 220, 220],
-            ghostwhite: [248, 248, 255],
-            gold: [255, 215, 0],
-            goldenrod: [218, 165, 32],
-            gray: [128, 128, 128],
-            green: [0, 128, 0],
-            greenyellow: [173, 255, 47],
-            grey: [128, 128, 128],
-            honeydew: [240, 255, 240],
-            hotpink: [255, 105, 180],
-            indianred: [205, 92, 92],
-            indigo: [75, 0, 130],
-            ivory: [255, 255, 240],
-            khaki: [240, 230, 140],
-            lavender: [230, 230, 250],
-            lavenderblush: [255, 240, 245],
-            lawngreen: [124, 252, 0],
-            lemonchiffon: [255, 250, 205],
-            lightblue: [173, 216, 230],
-            lightcoral: [240, 128, 128],
-            lightcyan: [224, 255, 255],
-            lightgoldenrodyellow: [250, 250, 210],
-            lightgray: [211, 211, 211],
-            lightgreen: [144, 238, 144],
-            lightgrey: [211, 211, 211],
-            lightpink: [255, 182, 193],
-            lightsalmon: [255, 160, 122],
-            lightseagreen: [32, 178, 170],
-            lightskyblue: [135, 206, 250],
-            lightslategray: [119, 136, 153],
-            lightslategrey: [119, 136, 153],
-            lightsteelblue: [176, 196, 222],
-            lightyellow: [255, 255, 224],
-            lime: [0, 255, 0],
-            limegreen: [50, 205, 50],
-            linen: [250, 240, 230],
-            magenta: [255, 0, 255],
-            maroon: [128, 0, 0],
-            mediumaquamarine: [102, 205, 170],
-            mediumblue: [0, 0, 205],
-            mediumorchid: [186, 85, 211],
-            mediumpurple: [147, 112, 219],
-            mediumseagreen: [60, 179, 113],
-            mediumslateblue: [123, 104, 238],
-            mediumspringgreen: [0, 250, 154],
-            mediumturquoise: [72, 209, 204],
-            mediumvioletred: [199, 21, 133],
-            midnightblue: [25, 25, 112],
-            mintcream: [245, 255, 250],
-            mistyrose: [255, 228, 225],
-            moccasin: [255, 228, 181],
-            navajowhite: [255, 222, 173],
-            navy: [0, 0, 128],
-            oldlace: [253, 245, 230],
-            olive: [128, 128, 0],
-            olivedrab: [107, 142, 35],
-            orange: [255, 165, 0],
-            orangered: [255, 69, 0],
-            orchid: [218, 112, 214],
-            palegoldenrod: [238, 232, 170],
-            palegreen: [152, 251, 152],
-            paleturquoise: [175, 238, 238],
-            palevioletred: [219, 112, 147],
-            papayawhip: [255, 239, 213],
-            peachpuff: [255, 218, 185],
-            peru: [205, 133, 63],
-            pink: [255, 192, 203],
-            plum: [221, 160, 203],
-            powderblue: [176, 224, 230],
-            purple: [128, 0, 128],
-            red: [255, 0, 0],
-            rosybrown: [188, 143, 143],
-            royalblue: [65, 105, 225],
-            saddlebrown: [139, 69, 19],
-            salmon: [250, 128, 114],
-            sandybrown: [244, 164, 96],
-            seagreen: [46, 139, 87],
-            seashell: [255, 245, 238],
-            sienna: [160, 82, 45],
-            silver: [192, 192, 192],
-            skyblue: [135, 206, 235],
-            slateblue: [106, 90, 205],
-            slategray: [119, 128, 144],
-            slategrey: [119, 128, 144],
-            snow: [255, 255, 250],
-            springgreen: [0, 255, 127],
-            steelblue: [70, 130, 180],
-            tan: [210, 180, 140],
-            teal: [0, 128, 128],
-            thistle: [216, 191, 216],
-            tomato: [255, 99, 71],
-            turquoise: [64, 224, 208],
-            violet: [238, 130, 238],
-            wheat: [245, 222, 179],
-            white: [255, 255, 255],
-            whitesmoke: [245, 245, 245],
-            yellow: [255, 255, 0],
-            yellowgreen: [154, 205, 5]
-        }
-    };
-}, function(ColorUtils) {
-    var formats = ColorUtils.formats,
-        lowerized = {};
-    formats['#HEX6'] = function(color) {
-        return '#' + formats.HEX6(color);
-    };
-    formats['#HEX8'] = function(color) {
-        return '#' + formats.HEX8(color);
-    };
-    Ext.Object.each(formats, function(name, fn) {
-        lowerized[name.toLowerCase()] = function(color) {
-            var ret = fn(color);
-            return ret.toLowerCase();
-        };
-    });
-    Ext.apply(formats, lowerized);
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/Field.js
+++ b//dev/null
@@ -1,159 +0,0 @@
-/**
- * A field that can be clicked to bring up the color picker.
- * The selected color is configurable via {@link #value}.
- *
- *      @example
- *      Ext.create({
- *          xtype: 'colorfield',
- *          renderTo: Ext.getBody(),
- *
- *          value: '#993300',  // initial selected color
- *
- *          listeners : {
- *              change: function(field, color) {
- *                  console.log('New color: ' + color);
- *              }
- *          }
- *      });
- */
-Ext.define('Ext.ux.colorpick.Field', {
-    extend: 'Ext.form.field.Picker',
-    xtype: 'colorfield',
-    mixins: [
-        'Ext.ux.colorpick.Selection'
-    ],
-    requires: [
-        'Ext.window.Window',
-        'Ext.ux.colorpick.Selector',
-        'Ext.ux.colorpick.ColorUtils',
-        'Ext.layout.container.Fit'
-    ],
-    editable: false,
-    matchFieldWidth: false, // picker is usually wider than field
-    beforeBodyEl: [
-        '<div class="' + Ext.baseCSSPrefix + 'colorpicker-field-swatch">' +
-            '<div id="{id}-swatchEl" data-ref="swatchEl" class="' + Ext.baseCSSPrefix +
-                    'colorpicker-field-swatch-inner"></div>' +
-        '</div>'
-    ],
-    cls: Ext.baseCSSPrefix + 'colorpicker-field',
-    childEls: [
-        'swatchEl'
-    ],
-    checkChangeEvents: ['change'],
-    config: {
-        /**
-         * @cfg {Object} popup
-         * This object configures the popup window and colorselector component displayed
-         * when this button is clicked. Applications should not need to configure this.
-         * @private
-         */
-        popup: {
-            lazy: true,
-            $value: {
-                xtype: 'window',
-                closeAction: 'hide',
-                referenceHolder: true,
-                minWidth: 540,
-                minHeight: 200,
-                layout: 'fit',
-                header: false,
-                resizable: true,
-                items: {
-                    xtype: 'colorselector',
-                    reference: 'selector',
-                    showPreviousColor: true,
-                    showOkCancelButtons: true
-                }
-            }
-        }
-    },
-    /**
-     * @event change
-     * Fires when a color is selected or if the field value is updated (if {@link #editable}).
-     * @param {Ext.ux.colorpick.Field} this
-     * @param {String} color The value of the selected color as per specified {@link #format}.
-     * @param {String} previousColor The previous color value.
-     */
-    initComponent: function() {
-        var me = this;
-        me.callParent();
-        me.on('change', me.onHexChange);
-    },
-    afterRender: function() {
-        this.callParent();
-        this.updateValue(this.value);
-    },
-    createPicker: function() {
-        var me = this,
-            popup = me.getPopup(),
-            picker;
-        me.colorPickerWindow = popup = Ext.create(popup);
-        me.colorPicker = picker = popup.lookupReference('selector');
-        picker.setFormat(me.getFormat());
-        picker.setColor(me.getColor());
-        picker.setHexReadOnly(!me.editable);
-        picker.on({
-            ok: 'onColorPickerOK',
-            cancel: 'onColorPickerCancel',
-            scope: me
-        });
-        popup.on({
-            close: 'onColorPickerCancel',
-            scope: me
-        });
-        return me.colorPickerWindow;
-    },
-    onColorPickerOK: function(colorPicker) {
-        this.setColor(colorPicker.getColor());
-        this.collapse();
-    },
-    onColorPickerCancel: function() {
-        this.collapse();
-    },
-    onExpand: function() {
-        var color = this.getColor();
-        this.colorPicker.setPreviousColor(color);
-    },
-    onHexChange: function(field) {
-        if (field.validate()) {
-            this.setValue(field.getValue());
-        }
-    },
-    setValue: function(color) {
-        var me = this;
-        if (Ext.ux.colorpick.ColorUtils.isValid(color)) {
-            color = me.applyValue(color);
-            me.callParent([color]);
-            me.updateValue(color);
-        }
-    },
-    updateFormat: function(format) {
-        var cp = this.colorPicker;
-        if (cp) {
-            cp.setFormat(format);
-        }
-    },
-    updateValue: function(color) {
-        var me = this,
-            c;
-        if (!me.syncing) {
-            me.syncing = true;
-            me.setColor(color);
-            me.syncing = false;
-        }
-        c = me.getColor();
-        if (c) {
-            Ext.ux.colorpick.ColorUtils.setBackground(me.swatchEl, c);
-            if (me.colorPicker) {
-                me.colorPicker.setColor(c);
-            }
-        }
-    },
-    validator: function(val) {
-        if (!Ext.ux.colorpick.ColorUtils.isValid(val)) {
-            return this.invalidText;
-        }
-        return true;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/Selection.js
+++ b//dev/null
@@ -1,95 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.Selection', {
-    mixinId: 'colorselection',
-    /* eslint-disable max-len */
-    config: {
-        /**
-         * @cfg {"hex6"/"hex8"/"#hex6"/"#hex8"/"rgb"/"rgba"/"HEX6"/"HEX8"/"#HEX6"/"#HEX8"/"RGB"/"RGBA"} [format=hex6]
-         * The color format to for the `value` config. The `value` can be set using any
-         * supported format or named color, but the stored value will always be in this
-         * format.
-         *
-         * Supported formats are:
-         *
-         * - hex6 - For example "ffaa00" (Note: does not preserve transparency).
-         * - hex8 - For example "ffaa00ff" - the last 2 digits represent transparency
-         * - #hex6 - For example "#ffaa00" (same as "hex6" but with a leading "#").
-         * - #hex8 - For example "#ffaa00ff" (same as "hex8" but with a leading "#").
-         * - rgb - For example "rgb(255,255,0)" (Note: does not preserve transparency).
-         * - rgba - For example "rgba(255,255,0,.25)"
-         * - HEX6 - Same as "hex6" but upper case.
-         * - HEX8 - Same as "hex8" but upper case.
-         * - #HEX6 - Same as "#hex6" but upper case.
-         * - #HEX8 - Same as "#hex8" but upper case.
-         * - RGB - Same as "rgb" but upper case.
-         * - RGBA - Same as "rgba" but upper case.
-         */
-        format: 'hex6',
-        /* eslint-enable max-len */
-        /**
-         * @cfg {String} [value=FF0000]
-         * The initial color to highlight; see {@link #format} for supported formats.
-         */
-        value: 'FF0000',
-        /**
-         * @cfg {Object} color
-         * This config property is used internally by the UI to maintain the full color.
-         * Changes to this config are automatically reflected in `value` and vise-versa.
-         * Setting `value` can, however, cause the alpha to be dropped if the new value
-         * does not contain an alpha component.
-         * @private
-         */
-        color: null,
-        previousColor: null,
-        /**
-         * @cfg {String} [alphaDecimalFormat=#.##]
-         * The format used by {@link Ext.util.Format#number} to format the alpha channel's
-         * value.
-         * @since 7.0.0
-         */
-        alphaDecimalFormat: '#.##'
-    },
-    applyColor: function(color) {
-        var c = color;
-        if (Ext.isString(c)) {
-            c = Ext.ux.colorpick.ColorUtils.parseColor(color, this.getAlphaDecimalFormat());
-        }
-        return c;
-    },
-    applyFormat: function(format) {
-        var formats = Ext.ux.colorpick.ColorUtils.formats;
-        if (!formats.hasOwnProperty(format)) {
-            Ext.raise('The specified format "' + format + '" is invalid.');
-            return;
-        }
-        return format;
-    },
-    applyValue: function(color) {
-        var c = Ext.ux.colorpick.ColorUtils.parseColor(
-            color || '#000000', this.getAlphaDecimalFormat()
-        );
-        return this.formatColor(c);
-    },
-    formatColor: function(color) {
-        return Ext.ux.colorpick.ColorUtils.formats[this.getFormat()](color);
-    },
-    updateColor: function(color) {
-        var me = this;
-        if (!me.syncing) {
-            me.syncing = true;
-            me.setValue(me.formatColor(color));
-            me.syncing = false;
-        }
-    },
-    updateValue: function(value, oldValue) {
-        var me = this;
-        if (!me.syncing) {
-            me.syncing = true;
-            me.setColor(value);
-            me.syncing = false;
-        }
-        this.fireEvent('change', me, value, oldValue);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/Selector.js
+++ b//dev/null
@@ -1,440 +0,0 @@
-/**
- * Sencha Pro Services presents xtype "colorselector".
- * API has been kept as close to the regular colorpicker as possible. The Selector can be
- * rendered to any container.
- *
- * The defaul selected color is configurable via {@link #value} config. Usually used in
- * forms via {@link Ext.ux.colorpick.Button} or {@link Ext.ux.colorpick.Field}.
- *
- * Typically you will need to listen for the change event to be notified when the user
- * chooses a color. Alternatively, you can bind to the "value" config
- *
- *     @example
- *     Ext.create('Ext.ux.colorpick.Selector', {
- *         value: '993300',  // initial selected color
- *         renderTo: Ext.getBody(),
- *         listeners: {
- *             change: function (colorselector, color) {
- *                 console.log('New color: ' + color);
- *             }
- *         }
- *     });
- */
-Ext.define('Ext.ux.colorpick.Selector', {
-    extend: 'Ext.container.Container',
-    xtype: 'colorselector',
-    mixins: [
-        'Ext.ux.colorpick.Selection'
-    ],
-    controller: 'colorpick-selectorcontroller',
-    requires: [
-        'Ext.layout.container.HBox',
-        'Ext.form.field.Text',
-        'Ext.form.field.Number',
-        'Ext.ux.colorpick.ColorMap',
-        'Ext.ux.colorpick.SelectorModel',
-        'Ext.ux.colorpick.SelectorController',
-        'Ext.ux.colorpick.ColorPreview',
-        'Ext.ux.colorpick.Slider',
-        'Ext.ux.colorpick.SliderAlpha',
-        'Ext.ux.colorpick.SliderSaturation',
-        'Ext.ux.colorpick.SliderValue',
-        'Ext.ux.colorpick.SliderHue'
-    ],
-    config: {
-        hexReadOnly: true
-    },
-    width: 580, // default width and height gives 255x255 color map in Crisp
-    height: 337,
-    cls: Ext.baseCSSPrefix + 'colorpicker',
-    padding: 10,
-    layout: {
-        type: 'hbox',
-        align: 'stretch'
-    },
-    defaultBindProperty: 'value',
-    twoWayBindable: [
-        'value'
-    ],
-    /**
-     * @cfg fieldWidth {Number} Width of the text fields on the container (excluding HEX);
-     * since the width of the slider containers is the same as the text field under it 
-     * (it's the same vbox column), changing this value will also affect the spacing between
-     * the sliders.
-     */
-    fieldWidth: 50,
-    /**
-     * @cfg fieldPad {Number} padding between the sliders and HEX/R/G/B fields.
-     */    
-    fieldPad: 5,
-    /**
-     * @cfg {Boolean} [showPreviousColor]
-     * Whether "previous color" region (in upper right, below the selected color preview)
-     * should be shown; these are relied upon by the {@link Ext.ux.colorpick.Button} and
-     * the {@link Ext.ux.colorpick.Field}.
-     */
-    showPreviousColor: false,
-    /**
-     * @cfg {Boolean} [showOkCancelButtons]
-     * Whether Ok and Cancel buttons (in upper right, below the selected color preview)
-     * should be shown; these are relied upon by the {@link Ext.ux.colorpick.Button} and
-     * the {@link Ext.ux.colorpick.Field}.
-     */
-    showOkCancelButtons: false,
-    /**
-     * @event change
-     * Fires when a color is selected. Simply dragging sliders around will trigger this.
-     * @param {Ext.ux.colorpick.Selector} this
-     * @param {String} color The value of the selected color as per specified {@link #format}.
-     * @param {String} previousColor The previous color value.
-     */
-    /**
-     * @event ok
-     * Fires when OK button is clicked (see {@link #showOkCancelButtons}).
-     * @param {Ext.ux.colorpick.Selector} this
-     * @param {String} color The value of the selected color as per specified {@link #format}.
-     */
-    /**
-     * @event cancel
-     * Fires when Cancel button is clicked (see {@link #showOkCancelButtons}).
-     * @param {Ext.ux.colorpick.Selector} this
-     */
-    listeners: {
-        resize: 'onResize'
-    },
-    constructor: function(config) {
-        var me = this,
-            childViewModel = Ext.Factory.viewModel('colorpick-selectormodel');
-        me.childViewModel = childViewModel;
-        me.items = [
-            me.getMapAndHexRGBFields(childViewModel),
-            me.getSliderAndHField(childViewModel),
-            me.getSliderAndSField(childViewModel),
-            me.getSliderAndVField(childViewModel),
-            me.getSliderAndAField(childViewModel),
-            me.getPreviewAndButtons(childViewModel, config)
-        ];
-        me.childViewModel.bind('{selectedColor}', function(color) {
-            me.setColor(color);
-        });
-        me.callParent([config]);
-    },
-    updateColor: function(color) {
-        var me = this;
-        me.mixins.colorselection.updateColor.call(me, color);
-        me.childViewModel.set('selectedColor', color);
-    },
-    updatePreviousColor: function(color) {
-        this.childViewModel.set('previousColor', color);
-    },
-    getMapAndHexRGBFields: function(childViewModel) {
-        var me = this,
-            fieldMargin = { top: 0, right: me.fieldPad, bottom: 0, left: 0 },
-            fieldWidth = me.fieldWidth;
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            cls: Ext.baseCSSPrefix + 'colorpicker-escape-overflow',
-            flex: 1,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            },
-            margin: '0 10 0 0',
-            items: [
-                {
-                    xtype: 'colorpickercolormap',
-                    reference: 'colorMap',
-                    flex: 1,
-                    bind: {
-                        position: {
-                            bindTo: '{selectedColor}',
-                            deep: true
-                        },
-                        hue: '{selectedColor.h}'
-                    },
-                    listeners: {
-                        handledrag: 'onColorMapHandleDrag'
-                    }
-                },
-                {
-                    xtype: 'container',
-                    layout: 'hbox',
-                    defaults: {
-                        labelAlign: 'top',
-                        labelSeparator: '',
-                        allowBlank: false,
-                        onChange: function() {
-                            if (this.isValid()) {
-                                Ext.form.field.Base.prototype.onChange.apply(this, arguments);
-                            }
-                        }
-                    },
-                    items: [{
-                        xtype: 'textfield',
-                        fieldLabel: 'HEX',
-                        flex: 1,
-                        bind: '{hex}',
-                        margin: fieldMargin,
-                        regex: /^#[0-9a-f]{6}$/i,
-                        readonly: me.getHexReadOnly()
-                    }, {
-                        xtype: 'numberfield',
-                        fieldLabel: 'R',
-                        bind: '{red}',
-                        width: fieldWidth,
-                        hideTrigger: true,
-                        maxValue: 255,
-                        minValue: 0,
-                        margin: fieldMargin
-                    }, {
-                        xtype: 'numberfield',
-                        fieldLabel: 'G',
-                        bind: '{green}',
-                        width: fieldWidth,
-                        hideTrigger: true,
-                        maxValue: 255,
-                        minValue: 0,
-                        margin: fieldMargin
-                    }, {
-                        xtype: 'numberfield',
-                        fieldLabel: 'B',
-                        bind: '{blue}',
-                        width: fieldWidth,
-                        hideTrigger: true,
-                        maxValue: 255,
-                        minValue: 0,
-                        margin: 0
-                    }]
-                }
-            ]
-        };
-    },
-    getSliderAndHField: function(childViewModel) {
-        var me = this,
-            fieldWidth = me.fieldWidth;
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            cls: Ext.baseCSSPrefix + 'colorpicker-escape-overflow',
-            width: fieldWidth,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            },
-            items: [
-                {
-                    xtype: 'colorpickersliderhue',
-                    reference: 'hueSlider',
-                    flex: 1,
-                    bind: {
-                        hue: '{selectedColor.h}'
-                    },
-                    width: fieldWidth,
-                    listeners: {
-                        handledrag: 'onHueSliderHandleDrag'
-                    }
-                },
-                {
-                    xtype: 'numberfield',
-                    fieldLabel: 'H',
-                    labelAlign: 'top',
-                    labelSeparator: '',
-                    bind: '{hue}',
-                    hideTrigger: true,
-                    maxValue: 360,
-                    minValue: 0,
-                    allowBlank: false,
-                    margin: 0
-                }
-            ]
-        };
-    },
-    getSliderAndSField: function(childViewModel) {
-        var me = this,
-            fieldWidth = me.fieldWidth;
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            cls: Ext.baseCSSPrefix + 'colorpicker-escape-overflow',
-            width: fieldWidth,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            },
-            margin: {
-                right: me.fieldPad,
-                left: me.fieldPad
-            },
-            items: [
-                {
-                    xtype: 'colorpickerslidersaturation',
-                    reference: 'satSlider',
-                    flex: 1,
-                    bind: {
-                        saturation: '{saturation}',
-                        hue: '{selectedColor.h}'
-                    },
-                    width: fieldWidth,
-                    listeners: {
-                        handledrag: 'onSaturationSliderHandleDrag'
-                    }
-                },
-                {
-                    xtype: 'numberfield',
-                    fieldLabel: 'S',
-                    labelAlign: 'top',
-                    labelSeparator: '',
-                    bind: '{saturation}',
-                    hideTrigger: true,
-                    maxValue: 100,
-                    minValue: 0,
-                    allowBlank: false,
-                    margin: 0
-                }
-            ]
-        };
-    },
-    getSliderAndVField: function(childViewModel) {
-        var me = this,
-            fieldWidth = me.fieldWidth;
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            cls: Ext.baseCSSPrefix + 'colorpicker-escape-overflow',
-            width: fieldWidth,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            },
-            items: [
-                {
-                    xtype: 'colorpickerslidervalue',
-                    reference: 'valueSlider',
-                    flex: 1,
-                    bind: {
-                        value: '{value}',
-                        hue: '{selectedColor.h}'
-                    },
-                    width: fieldWidth,
-                    listeners: {
-                        handledrag: 'onValueSliderHandleDrag'
-                    }
-                },
-                {
-                    xtype: 'numberfield',
-                    fieldLabel: 'V',
-                    labelAlign: 'top',
-                    labelSeparator: '',
-                    bind: '{value}',
-                    hideTrigger: true,
-                    maxValue: 100,
-                    minValue: 0,
-                    allowBlank: false,
-                    margin: 0
-                }
-            ]
-        };
-    },
-    getSliderAndAField: function(childViewModel) {
-        var me = this,
-            fieldWidth = me.fieldWidth;
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            cls: Ext.baseCSSPrefix + 'colorpicker-escape-overflow',
-            width: fieldWidth,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            },
-            margin: {
-                left: me.fieldPad
-            },
-            items: [
-                {
-                    xtype: 'colorpickerslideralpha',
-                    reference: 'alphaSlider',
-                    flex: 1,
-                    bind: {
-                        alpha: '{alpha}',
-                        color: {
-                            bindTo: '{selectedColor}',
-                            deep: true
-                        }
-                    },
-                    width: fieldWidth,
-                    listeners: {
-                        handledrag: 'onAlphaSliderHandleDrag'
-                    }
-                },
-                {
-                    xtype: 'numberfield',
-                    fieldLabel: 'A',
-                    labelAlign: 'top',
-                    labelSeparator: '',
-                    bind: '{alpha}',
-                    hideTrigger: true,
-                    maxValue: 100,
-                    minValue: 0,
-                    allowBlank: false,
-                    margin: 0
-                }
-            ]
-        };
-    },
-    getPreviewAndButtons: function(childViewModel, config) {
-        var items = [{
-            xtype: 'colorpickercolorpreview',
-            flex: 1,
-            bind: {
-                color: {
-                    bindTo: '{selectedColor}',
-                    deep: true
-                }
-            }
-        }];
-        if (config.showPreviousColor) {
-            items.push({
-                xtype: 'colorpickercolorpreview',
-                flex: 1,
-                bind: {
-                    color: {
-                        bindTo: '{previousColor}',
-                        deep: true
-                    }
-                },
-                listeners: {
-                    click: 'onPreviousColorSelected'
-                }
-            });
-        }
-        if (config.showOkCancelButtons) {
-            items.push({
-                xtype: 'button',
-                text: 'OK',
-                margin: '10 0 0 0',
-                padding: '10 0 10 0',
-                handler: 'onOK'
-            },
-                       {
-                           xtype: 'button',
-                           text: 'Cancel',
-                           margin: '10 0 0 0',
-                           padding: '10 0 10 0',
-                           handler: 'onCancel'
-                       });
-        }
-        return {
-            xtype: 'container',
-            viewModel: childViewModel,
-            width: 70,
-            margin: '0 0 0 10',
-            items: items,
-            layout: {
-                type: 'vbox',
-                align: 'stretch'
-            }
-        };
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SelectorController.js
+++ b//dev/null
@@ -1,91 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.SelectorController', {
-    extend: 'Ext.app.ViewController',
-    alias: 'controller.colorpick-selectorcontroller',
-    requires: [
-        'Ext.ux.colorpick.ColorUtils'
-    ],
-    destroy: function() {
-        var me = this,
-            view = me.getView(),
-            childViewModel = view.childViewModel;
-        if (childViewModel) {
-            childViewModel.destroy();
-            view.childViewModel = null;
-        }
-        me.callParent();
-    },
-    changeHSV: function(hsv) {
-        var view = this.getView(),
-            color = view.getColor(),
-            rgb;
-        Ext.applyIf(hsv, color);
-        rgb = Ext.ux.colorpick.ColorUtils.hsv2rgb(hsv.h, hsv.s, hsv.v);
-        Ext.apply(hsv, rgb);
-        view.setColor(hsv);
-    },
-    onColorMapHandleDrag: function(xPercent, yPercent) {
-        this.changeHSV({
-            s: xPercent,
-            v: 1 - yPercent
-        });
-    },
-    onValueSliderHandleDrag: function(yPercent) {
-        this.changeHSV({
-            v: 1 - yPercent
-        });
-    },
-    onSaturationSliderHandleDrag: function(yPercent) {
-        this.changeHSV({
-            s: 1 - yPercent
-        });
-    },
-    onHueSliderHandleDrag: function(yPercent) {
-        this.changeHSV({
-            h: 1 - yPercent
-        });
-    },
-    onAlphaSliderHandleDrag: function(yPercent) {
-        var view = this.getView(),
-            color = view.getColor(),
-            newColor = Ext.applyIf({
-                a: 1 - yPercent
-            }, color);
-        view.setColor(newColor);
-        view.el.repaint();
-    },
-    onPreviousColorSelected: function(comp, color) {
-        var view = this.getView();
-        view.setColor(color);
-    },
-    onOK: function() {
-        var me = this,
-            view = me.getView();
-        view.fireEvent('ok', view, view.getValue());
-    },
-    onCancel: function() {
-        this.fireViewEvent('cancel', this.getView());
-    },
-    onResize: function() {
-        var me = this,
-            view = me.getView(),
-            vm = view.childViewModel,
-            refs = me.getReferences(),
-            h, s, v, a;
-        if (!me.hasResizedOnce) {
-            me.hasResizedOnce = true;
-            return;
-        }
-        h = vm.get('hue');
-        s = vm.get('saturation');
-        v = vm.get('value');
-        a = vm.get('alpha');
-        refs.colorMap.setPosition(vm.getData());
-        refs.hueSlider.setHue(h);
-        refs.satSlider.setSaturation(s);
-        refs.valueSlider.setValue(v);
-        refs.alphaSlider.setAlpha(a);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SelectorModel.js
+++ b//dev/null
@@ -1,124 +0,0 @@
-/**
- * View Model that holds the "selectedColor" of the color picker container.
- */
-Ext.define('Ext.ux.colorpick.SelectorModel', {
-    extend: 'Ext.app.ViewModel',
-    alias: 'viewmodel.colorpick-selectormodel',
-    requires: [
-        'Ext.ux.colorpick.ColorUtils'
-    ],
-    data: {
-        selectedColor: {
-            r: 255,  // red
-            g: 255,  // green
-            b: 255,  // blue
-            h: 0,    // hue,
-            s: 1,    // saturation
-            v: 1,    // value
-            a: 1     // alpha (opacity)
-        },
-        previousColor: {
-            r: 0,    // red
-            g: 0,    // green
-            b: 0,    // blue
-            h: 0,    // hue,
-            s: 1,    // saturation
-            v: 1,    // value
-            a: 1     // alpha (opacity)
-        }
-    },
-    formulas: {
-        hex: {
-            get: function(get) {
-                var r = get('selectedColor.r').toString(16),
-                    g = get('selectedColor.g').toString(16),
-                    b = get('selectedColor.b').toString(16),
-                    result;
-                result = Ext.ux.colorpick.ColorUtils.rgb2hex(r, g, b);
-                return '#' + result;
-            },
-            set: function(hex) {
-                var rgb = Ext.ux.colorpick.ColorUtils.parseColor(hex);
-                this.changeRGB(rgb);
-            }
-        },
-        red: {
-            get: function(get) {
-                return get('selectedColor.r');
-            },
-            set: function(r) {
-                this.changeRGB({ r: r });
-            }
-        },
-        green: {
-            get: function(get) {
-                return get('selectedColor.g');
-            },
-            set: function(g) {
-                this.changeRGB({ g: g });
-            }
-        },
-        blue: {
-            get: function(get) {
-                return get('selectedColor.b');
-            },
-            set: function(b) {
-                this.changeRGB({ b: b });
-            }
-        },
-        hue: {
-            get: function(get) {
-                return get('selectedColor.h') * 360;
-            },
-            set: function(hue) {
-                this.changeHSV({ h: hue / 360 });
-            }
-        },
-        saturation: {
-            get: function(get) {
-                return get('selectedColor.s') * 100;
-            },
-            set: function(saturation) {
-                this.changeHSV({ s: saturation / 100 });
-            }
-        },
-        value: {
-            get: function(get) {
-                var v = get('selectedColor.v');
-                return v * 100;
-            },
-            set: function(value) {
-                this.changeHSV({ v: value / 100 });
-            }
-        },
-        alpha: {
-            get: function(data) {
-                var a = data('selectedColor.a');
-                return a * 100;
-            },
-            set: function(alpha) {
-                this.set('selectedColor', Ext.applyIf({
-                    a: alpha / 100
-                }, this.data.selectedColor));
-            }
-        }
-    }, // formulas
-    changeHSV: function(hsv) {
-        var rgb;
-        Ext.applyIf(hsv, this.data.selectedColor);
-        rgb = Ext.ux.colorpick.ColorUtils.hsv2rgb(hsv.h, hsv.s, hsv.v);
-        hsv.r = rgb.r;
-        hsv.g = rgb.g;
-        hsv.b = rgb.b;
-        this.set('selectedColor', hsv);
-    },
-    changeRGB: function(rgb) {
-        var hsv;
-        Ext.applyIf(rgb, this.data.selectedColor);
-        hsv = Ext.ux.colorpick.ColorUtils.rgb2hsv(rgb.r, rgb.g, rgb.b);
-        rgb.h = hsv.h;
-        rgb.s = hsv.s;
-        rgb.v = hsv.v;
-        this.set('selectedColor', rgb);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/Slider.js
+++ b//dev/null
@@ -1,52 +0,0 @@
-/**
- * Parent view for the 4 sliders seen on the color picker window.
- * @private
- */
-Ext.define('Ext.ux.colorpick.Slider', {
-    extend: 'Ext.container.Container',
-    xtype: 'colorpickerslider',
-    controller: 'colorpick-slidercontroller',
-    afterRender: function() {
-        var width, dragCt, dragWidth;
-        this.callParent(arguments);
-        width = this.width;
-        dragCt = this.lookupReference('dragHandleContainer');
-        dragWidth = dragCt.getWidth();
-        dragCt.el.setStyle('left', ((width - dragWidth) / 2) + 'px');
-    },
-    baseCls: Ext.baseCSSPrefix + 'colorpicker-slider',
-    requires: [
-        'Ext.ux.colorpick.SliderController'
-    ],
-    referenceHolder: true,
-    listeners: {
-        element: 'el',
-        mousedown: 'onMouseDown',
-        mouseup: 'onMouseUp',
-        dragstart: 'onDragStart'
-    },
-    items: {
-        xtype: 'container',
-        cls: Ext.baseCSSPrefix + 'colorpicker-draghandle-container',
-        reference: 'dragHandleContainer',
-        height: '100%',
-        items: {
-            xtype: 'component',
-            cls: Ext.baseCSSPrefix + 'colorpicker-draghandle-outer',
-            reference: 'dragHandle',
-            width: '100%',
-            height: 1,
-            draggable: true,
-            html: '<div class="' + Ext.baseCSSPrefix + 'colorpicker-draghandle"></div>'
-        }
-    },
-    setHue: function() {
-        Ext.raise('Must implement setHue() in a child class!');
-    },
-    getDragHandle: function() {
-        return this.lookupReference('dragHandle');
-    },
-    getDragContainer: function() {
-        return this.lookupReference('dragHandleContainer');
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SliderAlpha.js
+++ b//dev/null
@@ -1,54 +0,0 @@
-/**
- * Used for "Alpha" slider.
- * @private
- */
-Ext.define('Ext.ux.colorpick.SliderAlpha', {
-    extend: 'Ext.ux.colorpick.Slider',
-    alias: 'widget.colorpickerslideralpha',
-    cls: Ext.baseCSSPrefix + 'colorpicker-alpha',
-    requires: [
-        'Ext.XTemplate'
-    ],
-    /* eslint-disable max-len */
-    gradientStyleTpl: Ext.create(
-        'Ext.XTemplate',
-        Ext.isIE && Ext.ieVersion < 10
-            ? 'filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=\'#FF{hex}\', endColorstr=\'#00{hex}\');' /* IE6-9 */
-            : 'background: -moz-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);' +   /* FF3.6+ */
-              'background: -webkit-linear-gradient(top,rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);' + /* Chrome10+,Safari5.1+ */
-              'background: -o-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);' +      /* Opera 11.10+ */
-              'background: -ms-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);' +     /* IE10+ */
-              'background: linear-gradient(to bottom, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);'     /* W3C */
-    ),
-    /* eslint-enable max-len */
-    setAlpha: function(value) {
-        var me = this,
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            containerEl = container.getEl(),
-            containerHeight = containerEl.getHeight(),
-            el, top;
-        if (!dragHandle.dd || !dragHandle.dd.constrain) {
-            return;
-        }
-        if (typeof dragHandle.dd.dragEnded !== 'undefined' && !dragHandle.dd.dragEnded) {
-            return;
-        }
-        top = containerHeight * (1 - (value / 100));
-        el = dragHandle.getEl();
-        el.setStyle({
-            top: top + 'px'
-        });
-    },
-    setColor: function(color) {
-        var me = this,
-            container = me.getDragContainer(),
-            hex, el;
-        if (!me.getEl()) {
-            return;
-        }
-        hex = Ext.ux.colorpick.ColorUtils.rgb2hex(color.r, color.g, color.b);
-        el = container.getEl().first();
-        el.applyStyles(me.gradientStyleTpl.apply({ hex: hex, r: color.r, g: color.g, b: color.b }));
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SliderController.js
+++ b//dev/null
@@ -1,55 +0,0 @@
-/**
- * @private
- */
-Ext.define('Ext.ux.colorpick.SliderController', {
-    extend: 'Ext.app.ViewController',
-    alias: 'controller.colorpick-slidercontroller',
-    boxReady: function(view) {
-        var me = this,
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            dd = dragHandle.dd;
-        dd.constrain = true;
-        dd.constrainTo = container.getEl();
-        dd.initialConstrainTo = dd.constrainTo; // needed otherwise error EXTJS-13187
-        dd.on('drag', me.onHandleDrag, me);
-    },
-    getDragHandle: function() {
-        return this.view.lookupReference('dragHandle');
-    },
-    getDragContainer: function() {
-        return this.view.lookupReference('dragHandleContainer');
-    },
-    onHandleDrag: function(e) {
-        var me = this,
-            view = me.getView(),
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            y = dragHandle.getY() - container.getY(),
-            containerEl = container.getEl(),
-            containerHeight = containerEl.getHeight(),
-            yRatio = y / containerHeight;
-        if (yRatio > 0.99) {
-            yRatio = 1;
-        }
-        view.fireEvent('handledrag', yRatio);
-    },
-    onMouseDown: function(e) {
-        var me = this,
-            dragHandle = me.getDragHandle(),
-            y = e.getY();
-        dragHandle.setY(y);
-        me.onHandleDrag();
-        dragHandle.el.repaint();
-        dragHandle.dd.onMouseDown(e, dragHandle.dd.el);
-    },
-    onDragStart: function(e) {
-        var me = this,
-            dragHandle = me.getDragHandle();
-        dragHandle.dd.onDragStart(e, dragHandle.dd.el);
-    },
-    onMouseUp: function() {
-        var dragHandle = this.getDragHandle();
-        dragHandle.dd.dragEnded = true; // work around DragTracker bug
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SliderHue.js
+++ b//dev/null
@@ -1,49 +0,0 @@
-/**
- * Used for "Hue" slider.
- * @private
- */
-Ext.define('Ext.ux.colorpick.SliderHue', {
-    extend: 'Ext.ux.colorpick.Slider',
-    alias: 'widget.colorpickersliderhue',
-    cls: Ext.baseCSSPrefix + 'colorpicker-hue',
-    afterRender: function() {
-        var me = this,
-            src = me.gradientUrl,
-            el = me.el;
-        me.callParent();
-        if (!src) {
-            src = el.getStyle('background-image');
-            src = src.substring(4, src.length - 1);  // strip off outer "url(...)"
-            if (src.indexOf('"') === 0) {
-                src = src.substring(1, src.length - 1);
-            }
-            Ext.ux.colorpick.SliderHue.prototype.gradientUrl = src;
-        }
-        el.setStyle('background-image', 'none');
-        el = me.getDragContainer().layout.getElementTarget(); // the el for items and html
-        el.createChild({
-            tag: 'img',
-            cls: Ext.baseCSSPrefix + 'colorpicker-hue-gradient',
-            src: src
-        });
-    },
-    setHue: function(hue) {
-        var me = this,
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            containerEl = container.getEl(),
-            containerHeight = containerEl.getHeight(),
-            el, top;
-        if (!dragHandle.dd || !dragHandle.dd.constrain) {
-            return;
-        }
-        if (typeof dragHandle.dd.dragEnded !== 'undefined' && !dragHandle.dd.dragEnded) {
-            return;
-        }
-        top = containerHeight * (1 - hue);
-        el = dragHandle.getEl();
-        el.setStyle({
-            top: top + 'px'
-        });
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SliderSaturation.js
+++ b//dev/null
@@ -1,52 +0,0 @@
-/**
- * Used for "Saturation" slider
- * @private
- */
-Ext.define('Ext.ux.colorpick.SliderSaturation', {
-    extend: 'Ext.ux.colorpick.Slider',
-    alias: 'widget.colorpickerslidersaturation',
-    cls: Ext.baseCSSPrefix + 'colorpicker-saturation',
-    /* eslint-disable max-len */
-    gradientStyleTpl: Ext.create(
-        'Ext.XTemplate',
-        Ext.isIE && Ext.ieVersion < 10
-            ? 'filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=\'#{hex}\', endColorstr=\'#ffffff\');' /* IE6-9 */
-            : 'background: -mox-linear-gradient(top, #{hex} 0%, #ffffff 100%);' +   /* FF3.6+ */
-              'background: -webkit-linear-gradient(top, #{hex} 0%,#ffffff 100%);' + /* Chrome10+,Safari5.1+ */
-              'background: -o-linear-gradient(top, #{hex} 0%,#ffffff 100%);' +      /* Opera 11.10+ */
-              'background: -ms-linear-gradient(top, #{hex} 0%,#ffffff 100%);' +     /* IE10+ */
-              'background: linear-gradient(to bottom, #{hex} 0%,#ffffff 100%);'     /* W3C */
-    ),
-    /* eslint-enable max-len */
-    setSaturation: function(saturation) {
-        var me = this,
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            containerEl = container.getEl(),
-            containerHeight = containerEl.getHeight(),
-            yRatio,
-            top;
-        if (!dragHandle.dd || !dragHandle.dd.constrain) {
-            return;
-        }
-        if (typeof dragHandle.dd.dragEnded !== 'undefined' && !dragHandle.dd.dragEnded) {
-            return;
-        }
-        yRatio = 1 - (saturation / 100);
-        top = containerHeight * yRatio;
-        dragHandle.getEl().setStyle({
-            top: top + 'px'
-        });
-    },
-    setHue: function(hue) {
-        var me = this,
-            container = me.getDragContainer(),
-            rgb, hex;
-        if (!me.getEl()) {
-            return;
-        }
-        rgb = Ext.ux.colorpick.ColorUtils.hsv2rgb(hue, 1, 1);
-        hex = Ext.ux.colorpick.ColorUtils.rgb2hex(rgb.r, rgb.g, rgb.b);
-        container.getEl().applyStyles(me.gradientStyleTpl.apply({ hex: hex }));
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/colorpick/SliderValue.js
+++ b//dev/null
@@ -1,55 +0,0 @@
-/**
- * Used for "Value" slider.
- * @private
- */
-Ext.define('Ext.ux.colorpick.SliderValue', {
-    extend: 'Ext.ux.colorpick.Slider',
-    alias: 'widget.colorpickerslidervalue',
-    cls: Ext.baseCSSPrefix + 'colorpicker-value',
-    requires: [
-        'Ext.XTemplate'
-    ],
-    /* eslint-disable max-len */
-    gradientStyleTpl: Ext.create(
-        'Ext.XTemplate',
-        Ext.isIE && Ext.ieVersion < 10
-            ? 'filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0, startColorstr=\'#{hex}\', endColorstr=\'#000000\');' /* IE6-9 */
-            : 'background: -mox-linear-gradient(top, #{hex} 0%, #000000 100%);' +   /* FF3.6+ */
-          'background: -webkit-linear-gradient(top, #{hex} 0%,#000000 100%);' + /* Chrome10+,Safari5.1+ */
-          'background: -o-linear-gradient(top, #{hex} 0%,#000000 100%);' +      /* Opera 11.10+ */
-          'background: -ms-linear-gradient(top, #{hex} 0%,#000000 100%);' +     /* IE10+ */
-          'background: linear-gradient(to bottom, #{hex} 0%,#000000 100%);'     /* W3C */
-    ),
-    /* eslint-enable max-len */
-    setValue: function(value) {
-        var me = this,
-            container = me.getDragContainer(),
-            dragHandle = me.getDragHandle(),
-            containerEl = container.getEl(),
-            containerHeight = containerEl.getHeight(),
-            yRatio,
-            top;
-        if (!dragHandle.dd || !dragHandle.dd.constrain) {
-            return;
-        }
-        if (typeof dragHandle.dd.dragEnded !== 'undefined' && !dragHandle.dd.dragEnded) {
-            return;
-        }
-        yRatio = 1 - (value / 100);
-        top = containerHeight * yRatio;
-        dragHandle.getEl().setStyle({
-            top: top + 'px'
-        });
-    },
-    setHue: function(hue) {
-        var me = this,
-            container = me.getDragContainer(),
-            rgb, hex;
-        if (!me.getEl()) {
-            return;
-        }
-        rgb = Ext.ux.colorpick.ColorUtils.hsv2rgb(hue, 1, 1);
-        hex = Ext.ux.colorpick.ColorUtils.rgb2hex(rgb.r, rgb.g, rgb.b);
-        container.getEl().applyStyles(me.gradientStyleTpl.apply({ hex: hex }));
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/data/PagingMemoryProxy.js
+++ b//dev/null
@@ -1,66 +0,0 @@
-/**
- * Paging Memory Proxy, allows to use paging grid with in memory dataset
- */
-Ext.define('Ext.ux.data.PagingMemoryProxy', {
-    extend: 'Ext.data.proxy.Memory',
-    alias: 'proxy.pagingmemory',
-    alternateClassName: 'Ext.data.PagingMemoryProxy',
-    constructor: function() {
-        Ext.log.warn('Ext.ux.data.PagingMemoryProxy functionality has been merged ' +
-                     'into Ext.data.proxy.Memory by using the enablePaging flag.');
-        this.callParent(arguments);
-    },
-    read: function(operation, callback, scope) {
-        var reader = this.getReader(),
-            result = reader.read(this.data),
-            sorters, filters, sorterFn, records;
-        scope = scope || this;
-        filters = operation.filters;
-        if (filters.length > 0) {
-            records = [];
-            Ext.each(result.records, function(record) {
-                var isMatch = true,
-                    length = filters.length,
-                    filter, fn, scope, i;
-                for (i = 0; i < length; i++) {
-                    filter = filters[i];
-                    fn = filter.filterFn;
-                    scope = filter.scope;
-                    isMatch = isMatch && fn.call(scope, record);
-                }
-                if (isMatch) {
-                    records.push(record);
-                }
-            }, this);
-            result.records = records;
-            result.totalRecords = result.total = records.length;
-        }
-        sorters = operation.sorters;
-        if (sorters.length > 0) {
-            sorterFn = function(r1, r2) {
-                var result = sorters[0].sort(r1, r2),
-                    length = sorters.length,
-                    i;
-                for (i = 1; i < length; i++) {
-                    result = result || sorters[i].sort.call(this, r1, r2);
-                }
-                return result;
-            };
-            result.records.sort(sorterFn);
-        }
-        if (operation.start !== undefined && operation.limit !== undefined) {
-            result.records = result.records.slice(
-                operation.start, operation.start + operation.limit
-            );
-            result.count = result.records.length;
-        }
-        Ext.apply(operation, {
-            resultSet: result
-        });
-        operation.setCompleted();
-        operation.setSuccessful();
-        Ext.defer(function() {
-            Ext.callback(callback, scope, [operation]);
-        }, 10);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/dd/BoxContainerDD.js
+++ b//dev/null
@@ -1,39 +0,0 @@
-/**
- * A DragDrop implementation specialized for use with BoxReorderer.
- */
-Ext.define('Ext.ux.dd.BoxContainerDD', {
-    extend: 'Ext.dd.DD',
-    /**
-     * @method alignElWithMouse
-     * @member Ext.dd.DD
-     * @inheritdoc
-     */
-    alignElWithMouse: function(el, iPageX, iPageY) {
-        var me = this,
-            oCoord = me.getTargetCoord(iPageX, iPageY),
-            x = oCoord.x,
-            y = oCoord.y,
-            fly = el.dom ? el : Ext.fly(el, '_dd'),
-            aCoord, newLeft, newTop;
-        if (!me.deltaSetXY) {
-            aCoord = [
-                Math.max(0, x),
-                Math.max(0, y)
-            ];
-            fly.setXY(aCoord);
-            newLeft = me.getLocalX(fly);
-            newTop = fly.getLocalY();
-            me.deltaSetXY = [newLeft - x, newTop - y];
-        }
-        else {
-            me.setLocalXY(
-                fly,
-                Math.max(0, x + me.deltaSetXY[0]),
-                Math.max(0, y + me.deltaSetXY[1])
-            );
-        }
-        me.cachePosition(x, y);
-        me.autoScroll(x, y, el.offsetHeight, el.offsetWidth);
-        return oCoord;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/dd/CellFieldDropZone.js
+++ b//dev/null
@@ -1,122 +0,0 @@
-/**
- * This class is used as a grid `plugin`. It provides a DropZone which cooperates with
- * DragZones whose dragData contains a "field" property representing a form Field.
- * Fields may be dropped onto grid data cells containing a matching data type.
- */
-Ext.define('Ext.ux.dd.CellFieldDropZone', {
-    /* eslint-disable vars-on-top */
-    extend: 'Ext.dd.DropZone',
-    alias: 'plugin.ux-cellfielddropzone',
-    containerScroll: true,
-    /**
-     * @cfg {Function/String} onCellDrop
-     * The function to call on a cell data drop, or the name of the function on the
-     * corresponding `{@link Ext.app.ViewController controller}`. For details on the
-     * parameters, see `{@link #method!onCellDrop onCellDrop}`.
-     */
-    /**
-     * This method is called when a field is dropped on a cell. This method is normally
-     * replaced by the `{@link #cfg!onCellDrop onCellDrop}` config property passed to the
-     * constructor.
-     * @param {String} fieldName The name of the field.
-     * @param {Mixed} value The value of the field.
-     * @method onCellDrop
-     */
-    onCellDrop: Ext.emptyFn,
-    constructor: function(cfg) {
-        if (cfg) {
-            var me = this,
-                ddGroup = cfg.ddGroup,
-                onCellDrop = cfg.onCellDrop;
-            if (onCellDrop) {
-                if (typeof onCellDrop === 'string') {
-                    me.onCellDropFn = onCellDrop;
-                    me.onCellDrop = me.callCellDrop;
-                }
-                else {
-                    me.onCellDrop = onCellDrop;
-                }
-            }
-            if (ddGroup) {
-                me.ddGroup = ddGroup;
-            }
-        }
-    },
-    init: function(grid) {
-        var me = this;
-        if (grid.rendered) {
-            me.grid = grid;
-            grid.getView().on({
-                render: function(v) {
-                    me.view = v;
-                    Ext.ux.dd.CellFieldDropZone.superclass.constructor.call(me, me.view.el);
-                },
-                single: true
-            });
-        }
-        else {
-            grid.on('render', me.init, me, { single: true });
-        }
-    },
-    getTargetFromEvent: function(e) {
-        var me = this,
-            v = me.view,
-            cell = e.getTarget(v.getCellSelector());
-        if (cell) {
-            var row = v.findItemByChild(cell),
-                columnIndex = cell.cellIndex;
-            if (row && Ext.isDefined(columnIndex)) {
-                return {
-                    node: cell,
-                    record: v.getRecord(row),
-                    fieldName: me.grid.getVisibleColumnManager().getColumns()[columnIndex].dataIndex
-                };
-            }
-        }
-    },
-    onNodeEnter: function(target, dd, e, dragData) {
-        delete this.dropOK;
-        if (!target) {
-            return;
-        }
-        var f = dragData.field;
-        if (!f) {
-            return;
-        }
-        var field = target.record.fieldsMap[target.fieldName];
-        if (field.isNumeric) {
-            if (!f.isXType('numberfield')) {
-                return;
-            }
-        }
-        else if (field.isDateField) {
-            if (!f.isXType('datefield')) {
-                return;
-            }
-        }
-        else if (field.isBooleanField) {
-            if (!f.isXType('checkbox')) {
-                return;
-            }
-        }
-        this.dropOK = true;
-        Ext.fly(target.node).addCls('x-drop-target-active');
-    },
-    onNodeOver: function(target, dd, e, dragData) {
-        return this.dropOK ? this.dropAllowed : this.dropNotAllowed;
-    },
-    onNodeOut: function(target, dd, e, dragData) {
-        Ext.fly(target.node).removeCls('x-drop-target-active');
-    },
-    onNodeDrop: function(target, dd, e, dragData) {
-        if (this.dropOK) {
-            var value = dragData.field.getValue();
-            target.record.set(target.fieldName, value);
-            this.onCellDrop(target.fieldName, value);
-            return true;
-        }
-    },
-    callCellDrop: function(fieldName, value) {
-        Ext.callback(this.onCellDropFn, null, [fieldName, value], 0, this.grid);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/dd/PanelFieldDragZone.js
+++ b//dev/null
@@ -1,54 +0,0 @@
-Ext.define('Ext.ux.dd.PanelFieldDragZone', {
-    extend: 'Ext.dd.DragZone',
-    alias: 'plugin.ux-panelfielddragzone',
-    scroll: false,
-    constructor: function(cfg) {
-        if (cfg) {
-            if (cfg.ddGroup) {
-                this.ddGroup = cfg.ddGroup;
-            }
-        }
-    },
-    init: function(panel) {
-        var el;
-        if (panel.nodeType) {
-            Ext.ux.dd.PanelFieldDragZone.superclass.init.apply(this, arguments);
-        }
-        else {
-            if (panel.rendered) {
-                el = panel.getEl();
-                el.unselectable();
-                Ext.ux.dd.PanelFieldDragZone.superclass.constructor.call(this, el);
-            }
-            else {
-                panel.on('afterrender', this.init, this, { single: true });
-            }
-        }
-    },
-    getDragData: function(e) {
-        var targetLabel = e.getTarget('label', null, true),
-            text, oldMark, field, dragEl;
-        if (targetLabel) {
-            field = Ext.getCmp(targetLabel.up('.' + Ext.form.Labelable.prototype.formItemCls).id);
-            oldMark = field.preventMark;
-            field.preventMark = true;
-            if (field.isValid()) {
-                field.preventMark = oldMark;
-                dragEl = document.createElement('div');
-                dragEl.className = Ext.baseCSSPrefix + 'form-text';
-                text = field.getRawValue();
-                dragEl.innerHTML = Ext.isEmpty(text) ? '&#160;' : text;
-                Ext.fly(dragEl).setWidth(field.getEl().getWidth());
-                return {
-                    field: field,
-                    ddel: dragEl
-                };
-            }
-            e.stopEvent();
-            field.preventMark = oldMark;
-        }
-    },
-    getRepairXY: function() {
-        return this.dragData.field.getEl().getXY();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/App.js
+++ b//dev/null
@@ -1,141 +0,0 @@
-/**
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- * @class Ext.ux.desktop.App
- */
-Ext.define('Ext.ux.desktop.App', {
-    mixins: {
-        observable: 'Ext.util.Observable'
-    },
-    requires: [
-        'Ext.container.Viewport',
-        'Ext.ux.desktop.Desktop'
-    ],
-    isReady: false,
-    modules: null,
-    useQuickTips: true,
-    constructor: function(config) {
-        var me = this;
-        me.mixins.observable.constructor.call(this, config);
-        if (Ext.isReady) {
-            Ext.defer(me.init, 10, me);
-        }
-        else {
-            Ext.onReady(me.init, me);
-        }
-    },
-    init: function() {
-        var me = this,
-            desktopCfg;
-        if (me.useQuickTips) {
-            Ext.QuickTips.init();
-        }
-        me.modules = me.getModules();
-        if (me.modules) {
-            me.initModules(me.modules);
-        }
-        desktopCfg = me.getDesktopConfig();
-        me.desktop = new Ext.ux.desktop.Desktop(desktopCfg);
-        me.viewport = new Ext.container.Viewport({
-            layout: 'fit',
-            items: [ me.desktop ]
-        });
-        Ext.getWin().on('beforeunload', me.onUnload, me);
-        me.isReady = true;
-        me.fireEvent('ready', me);
-    },
-    /**
-     * This method returns the configuration object for the Desktop object. A derived
-     * class can override this method, call the base version to build the config and
-     * then modify the returned object before returning it.
-     */
-    getDesktopConfig: function() {
-        var me = this,
-            cfg = {
-                app: me,
-                taskbarConfig: me.getTaskbarConfig()
-            };
-        Ext.apply(cfg, me.desktopConfig);
-        return cfg;
-    },
-    getModules: Ext.emptyFn,
-    /**
-     * This method returns the configuration object for the Start Button. A derived
-     * class can override this method, call the base version to build the config and
-     * then modify the returned object before returning it.
-     */
-    getStartConfig: function() {
-        var me = this,
-            cfg = {
-                app: me,
-                menu: []
-            },
-            launcher;
-        Ext.apply(cfg, me.startConfig);
-        Ext.each(me.modules, function(module) {
-            launcher = module.launcher;
-            if (launcher) {
-                launcher.handler = launcher.handler || Ext.bind(me.createWindow, me, [module]);
-                cfg.menu.push(module.launcher);
-            }
-        });
-        return cfg;
-    },
-    createWindow: function(module) {
-        var window = module.createWindow();
-        window.show();
-    },
-    /**
-     * This method returns the configuration object for the TaskBar. A derived class
-     * can override this method, call the base version to build the config and then
-     * modify the returned object before returning it.
-     */
-    getTaskbarConfig: function() {
-        var me = this,
-            cfg = {
-                app: me,
-                startConfig: me.getStartConfig()
-            };
-        Ext.apply(cfg, me.taskbarConfig);
-        return cfg;
-    },
-    initModules: function(modules) {
-        var me = this;
-        Ext.each(modules, function(module) {
-            module.app = me;
-        });
-    },
-    getModule: function(name) {
-        var ms = this.modules,
-            i, len, m;
-        for (i = 0, len = ms.length; i < len; i++) {
-            m = ms[i];
-            if (m.id == name || m.appType == name) {
-                return m;
-            }
-        }
-        return null;
-    },
-    onReady: function(fn, scope) {
-        if (this.isReady) {
-            fn.call(scope, this);
-        }
-        else {
-            this.on({
-                ready: fn,
-                scope: scope,
-                single: true
-            });
-        }
-    },
-    getDesktop: function() {
-        return this.desktop;
-    },
-    onUnload: function(e) {
-        if (this.fireEvent('beforeunload', this) === false) {
-            e.stopEvent();
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/Desktop.js
+++ b//dev/null
@@ -1,369 +0,0 @@
-/**
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- *
- * @class Ext.ux.desktop.Desktop
- * @extends Ext.panel.Panel
- * <p>This class manages the wallpaper, shortcuts and taskbar.</p>
- */
-Ext.define('Ext.ux.desktop.Desktop', {
-    extend: 'Ext.panel.Panel',
-    alias: 'widget.desktop',
-    uses: [
-        'Ext.util.MixedCollection',
-        'Ext.menu.Menu',
-        'Ext.view.View', // dataview
-        'Ext.window.Window',
-        'Ext.ux.desktop.TaskBar',
-        'Ext.ux.desktop.Wallpaper'
-    ],
-    activeWindowCls: 'ux-desktop-active-win',
-    inactiveWindowCls: 'ux-desktop-inactive-win',
-    lastActiveWindow: null,
-    border: false,
-    html: '&#160;',
-    layout: 'fit',
-    xTickSize: 1,
-    yTickSize: 1,
-    app: null,
-    /**
-     * @cfg {Array/Ext.data.Store} shortcuts
-     * The items to add to the DataView. This can be a {@link Ext.data.Store Store} or a
-     * simple array. Items should minimally provide the fields in the
-     * {@link Ext.ux.desktop.ShortcutModel Shortcut}.
-     */
-    shortcuts: null,
-    /**
-     * @cfg {String} shortcutItemSelector
-     * This property is passed to the DataView for the desktop to select shortcut items.
-     * If the {@link #shortcutTpl} is modified, this will probably need to be modified as
-     * well.
-     */
-    shortcutItemSelector: 'div.ux-desktop-shortcut',
-    /**
-     * @cfg {String} shortcutTpl
-     * This XTemplate is used to render items in the DataView. If this is changed, the
-     * {@link #shortcutItemSelector} will probably also need to changed.
-     */
-    /* eslint-disable indent */
-    shortcutTpl: [
-        '<tpl for=".">',
-            '<div class="ux-desktop-shortcut" id="{name}-shortcut">',
-                '<div class="ux-desktop-shortcut-icon {iconCls}">',
-                    '<img src="', Ext.BLANK_IMAGE_URL, '" title="{name}">',
-                '</div>',
-                '<span class="ux-desktop-shortcut-text">{name}</span>',
-            '</div>',
-        '</tpl>',
-        '<div class="x-clear"></div>'
-    ],
-    /* eslint-enable indent */
-    /**
-     * @cfg {Object} taskbarConfig
-     * The config object for the TaskBar.
-     */
-    taskbarConfig: null,
-    windowMenu: null,
-    initComponent: function() {
-        var me = this,
-            wallpaper;
-        me.windowMenu = new Ext.menu.Menu(me.createWindowMenu());
-        me.bbar = me.taskbar = new Ext.ux.desktop.TaskBar(me.taskbarConfig);
-        me.taskbar.windowMenu = me.windowMenu;
-        me.windows = new Ext.util.MixedCollection();
-        me.contextMenu = new Ext.menu.Menu(me.createDesktopMenu());
-        me.items = [
-            { xtype: 'wallpaper', id: me.id + '_wallpaper' },
-            me.createDataView()
-        ];
-        me.callParent();
-        me.shortcutsView = me.items.getAt(1);
-        me.shortcutsView.on('itemclick', me.onShortcutItemClick, me);
-        wallpaper = me.wallpaper;
-        me.wallpaper = me.items.getAt(0);
-        if (wallpaper) {
-            me.setWallpaper(wallpaper, me.wallpaperStretch);
-        }
-    },
-    afterRender: function() {
-        var me = this;
-        me.callParent();
-        me.el.on('contextmenu', me.onDesktopMenu, me);
-    },
-    createDataView: function() {
-        var me = this;
-        return {
-            xtype: 'dataview',
-            overItemCls: 'x-view-over',
-            trackOver: true,
-            itemSelector: me.shortcutItemSelector,
-            store: me.shortcuts,
-            style: {
-                position: 'absolute'
-            },
-            x: 0,
-            y: 0,
-            tpl: new Ext.XTemplate(me.shortcutTpl)
-        };
-    },
-    createDesktopMenu: function() {
-        var me = this,
-            ret = {
-                items: me.contextMenuItems || []
-            };
-        if (ret.items.length) {
-            ret.items.push('-');
-        }
-        ret.items.push(
-            { text: 'Tile', handler: me.tileWindows, scope: me, minWindows: 1 },
-            { text: 'Cascade', handler: me.cascadeWindows, scope: me, minWindows: 1 }
-        );
-        return ret;
-    },
-    createWindowMenu: function() {
-        var me = this;
-        return {
-            defaultAlign: 'br-tr',
-            items: [
-                { text: 'Restore', handler: me.onWindowMenuRestore, scope: me },
-                { text: 'Minimize', handler: me.onWindowMenuMinimize, scope: me },
-                { text: 'Maximize', handler: me.onWindowMenuMaximize, scope: me },
-                '-',
-                { text: 'Close', handler: me.onWindowMenuClose, scope: me }
-            ],
-            listeners: {
-                beforeshow: me.onWindowMenuBeforeShow,
-                hide: me.onWindowMenuHide,
-                scope: me
-            }
-        };
-    },
-    onDesktopMenu: function(e) {
-        var me = this,
-            menu = me.contextMenu;
-        e.stopEvent();
-        if (!menu.rendered) {
-            menu.on('beforeshow', me.onDesktopMenuBeforeShow, me);
-        }
-        menu.showAt(e.getXY());
-        menu.doConstrain();
-    },
-    onDesktopMenuBeforeShow: function(menu) {
-        var me = this,
-            count = me.windows.getCount();
-        menu.items.each(function(item) {
-            var min = item.minWindows || 0;
-            item.setDisabled(count < min);
-        });
-    },
-    onShortcutItemClick: function(dataView, record) {
-        var me = this,
-            module = me.app.getModule(record.data.module),
-            win = module && module.createWindow();
-        if (win) {
-            me.restoreWindow(win);
-        }
-    },
-    onWindowClose: function(win) {
-        var me = this;
-        me.windows.remove(win);
-        me.taskbar.removeTaskButton(win.taskButton);
-        me.updateActiveWindow();
-    },
-    onWindowMenuBeforeShow: function(menu) {
-        var items = menu.items.items,
-            win = menu.theWin;
-        items[0].setDisabled(win.maximized !== true && win.hidden !== true); // Restore
-        items[1].setDisabled(win.minimized === true); // Minimize
-        items[2].setDisabled(win.maximized === true || win.hidden === true); // Maximize
-    },
-    onWindowMenuClose: function() {
-        var me = this,
-            win = me.windowMenu.theWin;
-        win.close();
-    },
-    onWindowMenuHide: function(menu) {
-        Ext.defer(function() {
-            menu.theWin = null;
-        }, 1);
-    },
-    onWindowMenuMaximize: function() {
-        var me = this,
-            win = me.windowMenu.theWin;
-        win.maximize();
-        win.toFront();
-    },
-    onWindowMenuMinimize: function() {
-        var me = this,
-            win = me.windowMenu.theWin;
-        win.minimize();
-    },
-    onWindowMenuRestore: function() {
-        var me = this,
-            win = me.windowMenu.theWin;
-        me.restoreWindow(win);
-    },
-    getWallpaper: function() {
-        return this.wallpaper.wallpaper;
-    },
-    setTickSize: function(xTickSize, yTickSize) {
-        var me = this,
-            xt = me.xTickSize = xTickSize,
-            yt = me.yTickSize = (arguments.length > 1) ? yTickSize : xt;
-        me.windows.each(function(win) {
-            var dd = win.dd,
-                resizer = win.resizer;
-            dd.xTickSize = xt;
-            dd.yTickSize = yt;
-            resizer.widthIncrement = xt;
-            resizer.heightIncrement = yt;
-        });
-    },
-    setWallpaper: function(wallpaper, stretch) {
-        this.wallpaper.setWallpaper(wallpaper, stretch);
-        return this;
-    },
-    cascadeWindows: function() {
-        var x = 0,
-            y = 0,
-            zmgr = this.getDesktopZIndexManager();
-        zmgr.eachBottomUp(function(win) {
-            if (win.isWindow && win.isVisible() && !win.maximized) {
-                win.setPosition(x, y);
-                x += 20;
-                y += 20;
-            }
-        });
-    },
-    createWindow: function(config, cls) {
-        var me = this,
-            win,
-            cfg = Ext.applyIf(config || {}, {
-                stateful: false,
-                isWindow: true,
-                constrainHeader: true,
-                minimizable: true,
-                maximizable: true
-            });
-        cls = cls || Ext.window.Window;
-        win = me.add(new cls(cfg));
-        me.windows.add(win);
-        win.taskButton = me.taskbar.addTaskButton(win);
-        win.animateTarget = win.taskButton.el;
-        win.on({
-            activate: me.updateActiveWindow,
-            beforeshow: me.updateActiveWindow,
-            deactivate: me.updateActiveWindow,
-            minimize: me.minimizeWindow,
-            destroy: me.onWindowClose,
-            scope: me
-        });
-        win.on({
-            boxready: function() {
-                win.dd.xTickSize = me.xTickSize;
-                win.dd.yTickSize = me.yTickSize;
-                if (win.resizer) {
-                    win.resizer.widthIncrement = me.xTickSize;
-                    win.resizer.heightIncrement = me.yTickSize;
-                }
-            },
-            single: true
-        });
-        win.doClose = function() {
-            win.doClose = Ext.emptyFn; // dblclick can call again...
-            win.el.disableShadow();
-            win.el.fadeOut({
-                listeners: {
-                    afteranimate: function() {
-                        win.destroy();
-                    }
-                }
-            });
-        };
-        return win;
-    },
-    getActiveWindow: function() {
-        var win = null,
-            zmgr = this.getDesktopZIndexManager();
-        if (zmgr) {
-            zmgr.eachTopDown(function(comp) {
-                if (comp.isWindow && !comp.hidden) {
-                    win = comp;
-                    return false;
-                }
-                return true;
-            });
-        }
-        return win;
-    },
-    getDesktopZIndexManager: function() {
-        var windows = this.windows;
-        return (windows.getCount() && windows.getAt(0).zIndexManager) || null;
-    },
-    getWindow: function(id) {
-        return this.windows.get(id);
-    },
-    minimizeWindow: function(win) {
-        win.minimized = true;
-        win.hide();
-    },
-    restoreWindow: function(win) {
-        if (win.isVisible()) {
-            win.restore();
-            win.toFront();
-        }
-        else {
-            win.show();
-        }
-        return win;
-    },
-    tileWindows: function() {
-        var me = this,
-            availWidth = me.body.getWidth(true),
-            x = me.xTickSize,
-            y = me.yTickSize,
-            nextY = y;
-        me.windows.each(function(win) {
-            var w;
-            if (win.isVisible() && !win.maximized) {
-                w = win.el.getWidth();
-                if (x > me.xTickSize && x + w > availWidth) {
-                    x = me.xTickSize;
-                    y = nextY;
-                }
-                win.setPosition(x, y);
-                x += w + me.xTickSize;
-                nextY = Math.max(nextY, y + win.el.getHeight() + me.yTickSize);
-            }
-        });
-    },
-    updateActiveWindow: function() {
-        var me = this,
-            activeWindow = me.getActiveWindow(),
-            last = me.lastActiveWindow;
-        if (last && last.destroyed) {
-            me.lastActiveWindow = null;
-            return;
-        }
-        if (activeWindow === last) {
-            return;
-        }
-        if (last) {
-            if (last.el.dom) {
-                last.addCls(me.inactiveWindowCls);
-                last.removeCls(me.activeWindowCls);
-            }
-            last.active = false;
-        }
-        me.lastActiveWindow = activeWindow;
-        if (activeWindow) {
-            activeWindow.addCls(me.activeWindowCls);
-            activeWindow.removeCls(me.inactiveWindowCls);
-            activeWindow.minimized = false;
-            activeWindow.active = true;
-        }
-        me.taskbar.setActiveButton(activeWindow && activeWindow.taskButton);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/Module.js
+++ b//dev/null
@@ -1,16 +0,0 @@
-/*
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- */
-Ext.define('Ext.ux.desktop.Module', {
-    mixins: {
-        observable: 'Ext.util.Observable'
-    },
-    constructor: function(config) {
-        this.mixins.observable.constructor.call(this, config);
-        this.init();
-    },
-    init: Ext.emptyFn
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/ShortcutModel.js
+++ b//dev/null
@@ -1,22 +0,0 @@
-/*
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- */
-/**
- * @class Ext.ux.desktop.ShortcutModel
- * @extends Ext.data.Model
- * This model defines the minimal set of fields for desktop shortcuts.
- */
-Ext.define('Ext.ux.desktop.ShortcutModel', {
-    extend: 'Ext.data.Model',
-    fields: [{
-        name: 'name',
-        convert: Ext.String.createVarName
-    }, {
-        name: 'iconCls'
-    }, {
-        name: 'module'
-    }]
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/StartMenu.js
+++ b//dev/null
@@ -1,42 +0,0 @@
-/**
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- * @class Ext.ux.desktop.StartMenu
- */
-Ext.define('Ext.ux.desktop.StartMenu', {
-    extend: 'Ext.menu.Menu',
-    baseCls: Ext.baseCSSPrefix + 'panel',
-    cls: 'x-menu ux-start-menu',
-    bodyCls: 'ux-start-menu-body',
-    defaultAlign: 'bl-tl',
-    iconCls: 'user',
-    bodyBorder: true,
-    width: 300,
-    initComponent: function() {
-        var me = this;
-        me.layout.align = 'stretch';
-        me.items = me.menu;
-        me.callParent();
-        me.toolbar = new Ext.toolbar.Toolbar(Ext.apply({
-            dock: 'right',
-            cls: 'ux-start-menu-toolbar',
-            vertical: true,
-            width: 100,
-            layout: {
-                align: 'stretch'
-            }
-        }, me.toolConfig));
-        me.addDocked(me.toolbar);
-        delete me.toolItems;
-    },
-    addMenuItem: function() {
-        var cmp = this.menu;
-        cmp.add.apply(cmp, arguments);
-    },
-    addToolItem: function() {
-        var cmp = this.toolbar;
-        cmp.add.apply(cmp, arguments);
-    }
-}); // StartMenu

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/TaskBar.js
+++ b//dev/null
@@ -1,224 +0,0 @@
-/*
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- */
-/**
- * @class Ext.ux.desktop.TaskBar
- * @extends Ext.toolbar.Toolbar
- */
-Ext.define('Ext.ux.desktop.TaskBar', {
-    extend: 'Ext.toolbar.Toolbar',
-    requires: [
-        'Ext.button.Button',
-        'Ext.resizer.Splitter',
-        'Ext.menu.Menu',
-        'Ext.ux.desktop.StartMenu'
-    ],
-    alias: 'widget.taskbar',
-    cls: 'ux-taskbar',
-    /**
-     * @cfg {String} startBtnText
-     * The text for the Start Button.
-     */
-    startBtnText: 'Start',
-    initComponent: function() {
-        var me = this;
-        me.startMenu = new Ext.ux.desktop.StartMenu(me.startConfig);
-        me.quickStart = new Ext.toolbar.Toolbar(me.getQuickStart());
-        me.windowBar = new Ext.toolbar.Toolbar(me.getWindowBarConfig());
-        me.tray = new Ext.toolbar.Toolbar(me.getTrayConfig());
-        me.items = [{
-            xtype: 'button',
-            cls: 'ux-start-button',
-            iconCls: 'ux-start-button-icon',
-            menu: me.startMenu,
-            menuAlign: 'bl-tl',
-            text: me.startBtnText
-        }, me.quickStart, {
-            xtype: 'splitter', html: '&#160;',
-            height: 14, width: 2, // TODO - there should be a CSS way here
-            cls: 'x-toolbar-separator x-toolbar-separator-horizontal'
-        }, me.windowBar, '-', me.tray];
-        me.callParent();
-    },
-    afterLayout: function() {
-        var me = this;
-        me.callParent();
-        me.windowBar.el.on('contextmenu', me.onButtonContextMenu, me);
-    },
-    /**
-     * This method returns the configuration object for the Quick Start toolbar. A derived
-     * class can override this method, call the base version to build the config and
-     * then modify the returned object before returning it.
-     */
-    getQuickStart: function() {
-        var me = this,
-            ret = {
-                minWidth: 20,
-                width: Ext.themeName === 'neptune' ? 70 : 60,
-                items: [],
-                enableOverflow: true
-            };
-        Ext.each(this.quickStart, function(item) {
-            ret.items.push({
-                tooltip: { text: item.name, align: 'bl-tl' },
-                overflowText: item.name,
-                iconCls: item.iconCls,
-                module: item.module,
-                handler: me.onQuickStartClick,
-                scope: me
-            });
-        });
-        return ret;
-    },
-    /**
-     * This method returns the configuration object for the Tray toolbar. A derived
-     * class can override this method, call the base version to build the config and
-     * then modify the returned object before returning it.
-     */
-    getTrayConfig: function() {
-        var ret = {
-            items: this.trayItems
-        };
-        delete this.trayItems;
-        return ret;
-    },
-    getWindowBarConfig: function() {
-        return {
-            flex: 1,
-            cls: 'ux-desktop-windowbar',
-            items: [ '&#160;' ],
-            layout: { overflowHandler: 'Scroller' }
-        };
-    },
-    getWindowBtnFromEl: function(el) {
-        var c = this.windowBar.getChildByElement(el);
-        return c || null;
-    },
-    onQuickStartClick: function(btn) {
-        var module = this.app.getModule(btn.module),
-            window;
-        if (module) {
-            window = module.createWindow();
-            window.show();
-        }
-    },
-    onButtonContextMenu: function(e) {
-        var me = this,
-            t = e.getTarget(),
-            btn = me.getWindowBtnFromEl(t);
-        if (btn) {
-            e.stopEvent();
-            me.windowMenu.theWin = btn.win;
-            me.windowMenu.showBy(t);
-        }
-    },
-    onWindowBtnClick: function(btn) {
-        var win = btn.win;
-        if (win.minimized || win.hidden) {
-            btn.disable();
-            win.show(null, function() {
-                btn.enable();
-            });
-        }
-        else if (win.active) {
-            btn.disable();
-            win.on('hide', function() {
-                btn.enable();
-            }, null, { single: true });
-            win.minimize();
-        }
-        else {
-            win.toFront();
-        }
-    },
-    addTaskButton: function(win) {
-        var config = {
-                iconCls: win.iconCls,
-                enableToggle: true,
-                toggleGroup: 'all',
-                width: 140,
-                margin: '0 2 0 3',
-                text: Ext.util.Format.ellipsis(win.title, 20),
-                listeners: {
-                    click: this.onWindowBtnClick,
-                    scope: this
-                },
-                win: win
-            },
-            cmp = this.windowBar.add(config);
-        cmp.toggle(true);
-        return cmp;
-    },
-    removeTaskButton: function(btn) {
-        var found,
-            me = this;
-        me.windowBar.items.each(function(item) {
-            if (item === btn) {
-                found = item;
-            }
-            return !found;
-        });
-        if (found) {
-            me.windowBar.remove(found);
-        }
-        return found;
-    },
-    setActiveButton: function(btn) {
-        if (btn) {
-            btn.toggle(true);
-        }
-        else {
-            this.windowBar.items.each(function(item) {
-                if (item.isButton) {
-                    item.toggle(false);
-                }
-            });
-        }
-    }
-});
-/**
- * @class Ext.ux.desktop.TrayClock
- * @extends Ext.toolbar.TextItem
- * This class displays a clock on the toolbar.
- */
-Ext.define('Ext.ux.desktop.TrayClock', {
-    extend: 'Ext.toolbar.TextItem',
-    alias: 'widget.trayclock',
-    cls: 'ux-desktop-trayclock',
-    html: '&#160;',
-    timeFormat: 'g:i A',
-    tpl: '{time}',
-    initComponent: function() {
-        var me = this;
-        me.callParent();
-        if (typeof(me.tpl) === 'string') {
-            me.tpl = new Ext.XTemplate(me.tpl);
-        }
-    },
-    afterRender: function() {
-        var me = this;
-        Ext.defer(me.updateTime, 100, me);
-        me.callParent();
-    },
-    doDestroy: function() {
-        var me = this;
-        if (me.timer) {
-            window.clearTimeout(me.timer);
-            me.timer = null;
-        }
-        me.callParent();
-    },
-    updateTime: function() {
-        var me = this,
-            time = Ext.Date.format(new Date(), me.timeFormat),
-            text = me.tpl.apply({ time: time });
-        if (me.lastText !== text) {
-            me.setText(text);
-            me.lastText = text;
-        }
-        me.timer = Ext.defer(me.updateTime, 10000, me);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/Video.js
+++ b//dev/null
@@ -1,118 +0,0 @@
-/*
- * Ext JS Library
- * Copyright(c) 2006-2015 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- */
-/**
- * From code originally written by David Davis
- *
- * For HTML5 video to work, your server must
- * send the right content type, for more info see:
- * <http://developer.mozilla.org/En/HTML/Element/Video>
- * @class Ext.ux.desktop.Video
- */
-Ext.define('Ext.ux.desktop.Video', {
-    extend: 'Ext.panel.Panel',
-    alias: 'widget.video',
-    layout: 'fit',
-    autoplay: false,
-    controls: true,
-    bodyStyle: 'background-color:#000;color:#fff',
-    html: '',
-    /* eslint-disable max-len, indent */
-    tpl: [
-        '<video id="{id}-video" autoPlay="{autoplay}" controls="{controls}" poster="{poster}" start="{start}" loopstart="{loopstart}" loopend="{loopend}" autobuffer="{autobuffer}" loop="{loop}" style="width:100%;height:100%">',
-            '<tpl for="src">',
-                '<source src="{src}" type="{type}"/>',
-            '</tpl>',
-            '{html}',
-        '</video>'
-    ],
-    /* eslint-enable max-len, indent */
-    initComponent: function() {
-        var me = this,
-            fallback, cfg, chrome;
-        if (me.fallbackHTML) {
-            fallback = me.fallbackHTML;
-        }
-        else {
-            fallback = "Your browser does not support HTML5 Video. ";
-            if (Ext.isChrome) {
-                fallback += 'Upgrade Chrome.';
-            }
-            else if (Ext.isGecko) {
-                fallback += 'Upgrade to Firefox 3.5 or newer.';
-            }
-            else {
-                chrome = '<a href="http://www.google.com/chrome">Chrome</a>';
-                fallback += 'Please try <a href="http://www.mozilla.com">Firefox</a>';
-                if (Ext.isIE) {
-                    fallback += ', ' + chrome +
-                        ' or <a href="http://www.apple.com/safari/">Safari</a>.';
-                }
-                else {
-                    fallback += ' or ' + chrome + '.';
-                }
-            }
-        }
-        me.fallbackHTML = fallback;
-        cfg = me.data =
-            Ext.copyTo(
-                {
-                    tag: 'video',
-                    html: fallback
-                },
-                me,
-                'id,poster,start,loopstart,loopend,playcount,autobuffer,loop'
-            );
-        if (me.autoplay) {
-            cfg.autoplay = 1;
-        }
-        if (me.controls) {
-            cfg.controls = 1;
-        }
-        if (Ext.isArray(me.src)) {
-            cfg.src = me.src;
-        }
-        else {
-            cfg.src = [{ src: me.src }];
-        }
-        me.callParent();
-    },
-    afterRender: function() {
-        var me = this,
-            el;
-        me.callParent();
-        me.video = me.body.getById(me.id + '-video');
-        el = me.video.dom;
-        me.supported = (el && el.tagName.toLowerCase() === 'video');
-        if (me.supported) {
-            me.video.on('error', me.onVideoError, me);
-        }
-    },
-    getFallback: function() {
-        return '<h1 style="background-color:#ff4f4f;padding: 10px;">' + this.fallbackHTML + '</h1>';
-    },
-    onVideoError: function() {
-        var me = this;
-        me.video.remove();
-        me.supported = false;
-        me.body.createChild(me.getFallback());
-    },
-    doDestroy: function() {
-        var me = this,
-            video = me.video,
-            videoDom;
-        video = me.video;
-        if (me.supported && video) {
-            videoDom = video.dom;
-            if (videoDom && videoDom.pause) {
-                videoDom.pause();
-            }
-            video.remove();
-            me.video = null;
-        }
-        me.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/desktop/Wallpaper.js
+++ b//dev/null
@@ -1,69 +0,0 @@
-/*
- * Ext JS Library
- * Copyright(c) 2006-2014 Sencha Inc.
- * licensing@sencha.com
- * http://www.sencha.com/license
- */
-/**
- * @class Ext.ux.desktop.Wallpaper
- * @extends Ext.Component
- * <p>This component renders an image that stretches to fill the component.</p>
- */
-Ext.define('Ext.ux.desktop.Wallpaper', {
-    extend: 'Ext.Component',
-    alias: 'widget.wallpaper',
-    cls: 'ux-wallpaper',
-    html: '<img src="' + Ext.BLANK_IMAGE_URL + '">',
-    stretch: false,
-    wallpaper: null,
-    stateful: true,
-    stateId: 'desk-wallpaper',
-    afterRender: function() {
-        var me = this;
-        me.callParent();
-        me.setWallpaper(me.wallpaper, me.stretch);
-    },
-    applyState: function() {
-        var me = this,
-            old = me.wallpaper;
-        me.callParent(arguments);
-        if (old !== me.wallpaper) {
-            me.setWallpaper(me.wallpaper);
-        }
-    },
-    getState: function() {
-        return this.wallpaper && { wallpaper: this.wallpaper };
-    },
-    setWallpaper: function(wallpaper, stretch) {
-        var me = this,
-            imgEl, bkgnd;
-        me.stretch = (stretch !== false);
-        me.wallpaper = wallpaper;
-        if (me.rendered) {
-            imgEl = me.el.dom.firstChild;
-            if (!wallpaper || wallpaper === Ext.BLANK_IMAGE_URL) {
-                Ext.fly(imgEl).hide();
-            }
-            else if (me.stretch) {
-                imgEl.src = wallpaper;
-                me.el.removeCls('ux-wallpaper-tiled');
-                Ext.fly(imgEl).setStyle({
-                    width: '100%',
-                    height: '100%'
-                }).show();
-            }
-            else {
-                Ext.fly(imgEl).hide();
-                bkgnd = 'url(' + wallpaper + ')';
-                me.el.addCls('ux-wallpaper-tiled');
-            }
-            me.el.setStyle({
-                backgroundImage: bkgnd || ''
-            });
-            if (me.stateful) {
-                me.saveState();
-            }
-        }
-        return me;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/event/RecorderManager.js
+++ b//dev/null
@@ -1,244 +0,0 @@
-/**
- * Recorder manager.
- * Used as a bookmarklet:
- *
- *     javascript:void(window.open("../ux/event/RecorderManager.html","recmgr"))
- */
-Ext.define('Ext.ux.event.RecorderManager', {
-    extend: 'Ext.panel.Panel',
-    alias: 'widget.eventrecordermanager',
-    uses: [
-        'Ext.ux.event.Recorder',
-        'Ext.ux.event.Player'
-    ],
-    layout: 'fit',
-    buttonAlign: 'left',
-    eventsToIgnore: {
-        mousemove: 1,
-        mouseover: 1,
-        mouseout: 1
-    },
-    bodyBorder: false,
-    playSpeed: 1,
-    initComponent: function() {
-        var me = this,
-            events;
-        me.recorder = new Ext.ux.event.Recorder({
-            attachTo: me.attachTo,
-            listeners: {
-                add: me.updateEvents,
-                coalesce: me.updateEvents,
-                buffer: 200,
-                scope: me
-            }
-        });
-        me.recorder.eventsToRecord = Ext.apply({}, me.recorder.eventsToRecord);
-        function speed(text, value) {
-            return {
-                text: text,
-                speed: value,
-                group: 'speed',
-                checked: value === me.playSpeed,
-                handler: me.onPlaySpeed,
-                scope: me
-            };
-        }
-        me.tbar = [
-            {
-                text: 'Record',
-                xtype: 'splitbutton',
-                whenIdle: true,
-                handler: me.onRecord,
-                scope: me,
-                menu: me.makeRecordButtonMenu()
-            },
-            {
-                text: 'Play',
-                xtype: 'splitbutton',
-                whenIdle: true,
-                handler: me.onPlay,
-                scope: me,
-                menu: [
-                    speed('Qarter Speed (0.25x)', 0.25),
-                    speed('Half Speed (0.5x)', 0.5),
-                    speed('3/4 Speed (0.75x)', 0.75),
-                    '-',
-                    speed('Recorded Speed (1x)', 1),
-                    speed('Double Speed (2x)', 2),
-                    speed('Quad Speed (4x)', 4),
-                    '-',
-                    speed('Full Speed', 1000)
-                ]
-            },
-            {
-                text: 'Clear',
-                whenIdle: true,
-                handler: me.onClear,
-                scope: me
-            },
-            '->',
-            {
-                text: 'Stop',
-                whenActive: true,
-                disabled: true,
-                handler: me.onStop,
-                scope: me
-            }
-        ];
-        events = me.attachTo && me.attachTo.testEvents;
-        me.items = [
-            {
-                xtype: 'textarea',
-                itemId: 'eventView',
-                fieldStyle: 'font-family: monospace',
-                selectOnFocus: true,
-                emptyText: 'Events go here!',
-                value: events ? me.stringifyEvents(events) : '',
-                scrollToBottom: function() {
-                    var inputEl = this.inputEl.dom;
-                    inputEl.scrollTop = inputEl.scrollHeight;
-                }
-            }
-        ];
-        me.fbar = [
-            {
-                xtype: 'tbtext',
-                text: 'Attached To: ' + (me.attachTo && me.attachTo.location.href)
-            }
-        ];
-        me.callParent();
-    },
-    makeRecordButtonMenu: function() {
-        var ret = [],
-            subs = {},
-            eventsToRec = this.recorder.eventsToRecord,
-            ignoredEvents = this.eventsToIgnore;
-        Ext.Object.each(eventsToRec, function(name, value) {
-            var sub = subs[value.kind];
-            if (!sub) {
-                subs[value.kind] = sub = [];
-                ret.push({
-                    text: value.kind,
-                    menu: sub
-                });
-            }
-            sub.push({
-                text: name,
-                checked: true,
-                handler: function(menuItem) {
-                    if (menuItem.checked) {
-                        eventsToRec[name] = value;
-                    }
-                    else {
-                        delete eventsToRec[name];
-                    }
-                }
-            });
-            if (ignoredEvents[name]) {
-                sub[sub.length - 1].checked = false;
-                Ext.defer(function() {
-                    delete eventsToRec[name];
-                }, 1);
-            }
-        });
-        function less(lhs, rhs) {
-            return (lhs.text < rhs.text) ? -1 : ((rhs.text < lhs.text) ? 1 : 0);
-        }
-        ret.sort(less);
-        Ext.Array.each(ret, function(sub) {
-            sub.menu.sort(less);
-        });
-        return ret;
-    },
-    getEventView: function() {
-        return this.down('#eventView');
-    },
-    onClear: function() {
-        var view = this.getEventView();
-        view.setValue('');
-    },
-    onPlay: function() {
-        var me = this,
-            view = me.getEventView(),
-            events = view.getValue();
-        if (events) {
-            events = Ext.decode(events);
-            if (events.length) {
-                me.player = Ext.create('Ext.ux.event.Player', {
-                    attachTo: window.opener,
-                    eventQueue: events,
-                    speed: me.playSpeed,
-                    listeners: {
-                        stop: me.onPlayStop,
-                        scope: me
-                    }
-                });
-                me.player.start();
-                me.syncBtnUI();
-            }
-        }
-    },
-    onPlayStop: function() {
-        this.player = null;
-        this.syncBtnUI();
-    },
-    onPlaySpeed: function(menuitem) {
-        this.playSpeed = menuitem.speed;
-    },
-    onRecord: function() {
-        this.recorder.start();
-        this.syncBtnUI();
-    },
-    onStop: function() {
-        var me = this;
-        if (me.player) {
-            me.player.stop();
-            me.player = null;
-        }
-        else {
-            me.recorder.stop();
-        }
-        me.syncBtnUI();
-        me.updateEvents();
-    },
-    syncBtnUI: function() {
-        var me = this,
-            idle = !me.player && !me.recorder.active,
-            view;
-        Ext.each(me.query('[whenIdle]'), function(btn) {
-            btn.setDisabled(!idle);
-        });
-        Ext.each(me.query('[whenActive]'), function(btn) {
-            btn.setDisabled(idle);
-        });
-        view = me.getEventView();
-        view.setReadOnly(!idle);
-    },
-    stringifyEvents: function(events) {
-        var line,
-            lines = [];
-        Ext.each(events, function(ev) {
-            line = [];
-            Ext.Object.each(ev, function(name, value) {
-                if (line.length) {
-                    line.push(', ');
-                }
-                else {
-                    line.push('  { ');
-                }
-                line.push(name, ': ');
-                line.push(Ext.encode(value));
-            });
-            line.push(' }');
-            lines.push(line.join(''));
-        });
-        return '[\n' + lines.join(',\n') + '\n]';
-    },
-    updateEvents: function() {
-        var me = this,
-            text = me.stringifyEvents(me.recorder.getRecordedEvents()),
-            view = me.getEventView();
-        view.setValue(text);
-        view.scrollToBottom();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/form/ItemSelector.js
+++ b//dev/null
@@ -1,333 +0,0 @@
-/*
- * Note that this control will most likely remain as an example, and not as a core Ext form
- * control.  However, the API will be changing in a future release and so should not yet be
- * treated as a final, stable API at this time.
- */
-/**
- * A control that allows selection of between two Ext.ux.form.MultiSelect controls.
- */
-Ext.define('Ext.ux.form.ItemSelector', {
-    extend: 'Ext.ux.form.MultiSelect',
-    alias: ['widget.itemselectorfield', 'widget.itemselector'],
-    alternateClassName: ['Ext.ux.ItemSelector'],
-    requires: [
-        'Ext.button.Button',
-        'Ext.ux.form.MultiSelect'
-    ],
-    /**
-     * @cfg {Boolean} [hideNavIcons=false] True to hide the navigation icons
-     */
-    hideNavIcons: false,
-    /**
-     * @cfg {Array} buttons Defines the set of buttons that should be displayed in between
-     * the ItemSelector fields. Defaults to `['top', 'up', 'add', 'remove', 'down', 'bottom']`.
-     * These names are used to build the button CSS class names, and to look up the button text
-     * labels in {@link #buttonsText}. This can be overridden with a custom Array to change
-     * which buttons are displayed or their order.
-     */
-    buttons: ['top', 'up', 'add', 'remove', 'down', 'bottom'],
-    /**
-     * @cfg {Object} buttonsText The tooltips for the {@link #buttons}.
-     * Labels for buttons.
-     */
-    buttonsText: {
-        top: "Move to Top",
-        up: "Move Up",
-        add: "Add to Selected",
-        remove: "Remove from Selected",
-        down: "Move Down",
-        bottom: "Move to Bottom"
-    },
-    layout: {
-        type: 'hbox',
-        align: 'stretch'
-    },
-    ariaRole: 'group',
-    initComponent: function() {
-        var me = this;
-        me.ddGroup = me.id + '-dd';
-        me.ariaRenderAttributes = me.ariaRenderAttributes || {};
-        me.ariaRenderAttributes['aria-labelledby'] = me.id + '-labelEl';
-        me.callParent();
-        me.bindStore(me.store);
-    },
-    createList: function(title) {
-        var me = this;
-        return Ext.create('Ext.ux.form.MultiSelect', {
-            submitValue: false,
-            getSubmitData: function() {
-                return null;
-            },
-            getModelData: function() {
-                return null;
-            },
-            flex: 1,
-            dragGroup: me.ddGroup,
-            dropGroup: me.ddGroup,
-            title: title,
-            store: {
-                model: me.store.model,
-                data: []
-            },
-            displayField: me.displayField,
-            valueField: me.valueField,
-            disabled: me.disabled,
-            listeners: {
-                boundList: {
-                    scope: me,
-                    itemdblclick: me.onItemDblClick,
-                    drop: me.syncValue
-                }
-            }
-        });
-    },
-    setupItems: function() {
-        var me = this;
-        me.fromField = me.createList(me.fromTitle);
-        me.toField = me.createList(me.toTitle);
-        return [
-            me.fromField,
-            {
-                xtype: 'toolbar',
-                margin: '0 4',
-                padding: 0,
-                layout: {
-                    type: 'vbox',
-                    pack: 'center'
-                },
-                items: me.createButtons()
-            },
-            me.toField
-        ];
-    },
-    createButtons: function() {
-        var me = this,
-            buttons = [];
-        if (!me.hideNavIcons) {
-            Ext.Array.forEach(me.buttons, function(name) {
-                buttons.push({
-                    xtype: 'button',
-                    ui: 'default',
-                    tooltip: me.buttonsText[name],
-                    ariaLabel: me.buttonsText[name],
-                    handler: me['on' + Ext.String.capitalize(name) + 'BtnClick'],
-                    cls: Ext.baseCSSPrefix + 'form-itemselector-btn',
-                    iconCls: Ext.baseCSSPrefix + 'form-itemselector-' + name,
-                    navBtn: true,
-                    scope: me,
-                    margin: '4 0 0 0'
-                });
-            });
-        }
-        return buttons;
-    },
-    /**
-     * Get the selected records from the specified list.
-     * 
-     * Records will be returned *in store order*, not in order of selection.
-     * @param {Ext.view.BoundList} list The list to read selections from.
-     * @return {Ext.data.Model[]} The selected records in store order.
-     * 
-     */
-    getSelections: function(list) {
-        var store = list.getStore();
-        return Ext.Array.sort(list.getSelectionModel().getSelection(), function(a, b) {
-            a = store.indexOf(a);
-            b = store.indexOf(b);
-            if (a < b) {
-                return -1;
-            }
-            else if (a > b) {
-                return 1;
-            }
-            return 0;
-        });
-    },
-    onTopBtnClick: function() {
-        var list = this.toField.boundList,
-            store = list.getStore(),
-            selected = this.getSelections(list);
-        store.suspendEvents();
-        store.remove(selected, true);
-        store.insert(0, selected);
-        store.resumeEvents();
-        list.refresh();
-        this.syncValue();
-        list.getSelectionModel().select(selected);
-    },
-    onBottomBtnClick: function() {
-        var list = this.toField.boundList,
-            store = list.getStore(),
-            selected = this.getSelections(list);
-        store.suspendEvents();
-        store.remove(selected, true);
-        store.add(selected);
-        store.resumeEvents();
-        list.refresh();
-        this.syncValue();
-        list.getSelectionModel().select(selected);
-    },
-    onUpBtnClick: function() {
-        var list = this.toField.boundList,
-            store = list.getStore(),
-            selected = this.getSelections(list),
-            rec,
-            i = 0,
-            len = selected.length,
-            index = 0;
-        store.suspendEvents();
-        for (; i < len; ++i, index++) {
-            rec = selected[i];
-            index = Math.max(index, store.indexOf(rec) - 1);
-            store.remove(rec, true);
-            store.insert(index, rec);
-        }
-        store.resumeEvents();
-        list.refresh();
-        this.syncValue();
-        list.getSelectionModel().select(selected);
-    },
-    onDownBtnClick: function() {
-        var list = this.toField.boundList,
-            store = list.getStore(),
-            selected = this.getSelections(list),
-            rec,
-            i = selected.length - 1,
-            index = store.getCount() - 1;
-        store.suspendEvents();
-        for (; i > -1; --i, index--) {
-            rec = selected[i];
-            index = Math.min(index, store.indexOf(rec) + 1);
-            store.remove(rec, true);
-            store.insert(index, rec);
-        }
-        store.resumeEvents();
-        list.refresh();
-        this.syncValue();
-        list.getSelectionModel().select(selected);
-    },
-    onAddBtnClick: function() {
-        var me = this,
-            selected = me.getSelections(me.fromField.boundList);
-        me.moveRec(true, selected);
-        me.toField.boundList.getSelectionModel().select(selected);
-    },
-    onRemoveBtnClick: function() {
-        var me = this,
-            selected = me.getSelections(me.toField.boundList);
-        me.moveRec(false, selected);
-        me.fromField.boundList.getSelectionModel().select(selected);
-    },
-    moveRec: function(add, recs) {
-        var me = this,
-            fromField = me.fromField,
-            toField = me.toField,
-            fromStore = add ? fromField.store : toField.store,
-            toStore = add ? toField.store : fromField.store;
-        fromStore.suspendEvents();
-        toStore.suspendEvents();
-        fromStore.remove(recs);
-        toStore.add(recs);
-        fromStore.resumeEvents();
-        toStore.resumeEvents();
-        if (fromField.boundList.containsFocus) {
-            fromField.boundList.focus();
-        }
-        fromField.boundList.refresh();
-        toField.boundList.refresh();
-        me.syncValue();
-    },
-    syncValue: function() {
-        var me = this;
-        me.mixins.field.setValue.call(me, me.setupValue(me.toField.store.getRange()));
-    },
-    onItemDblClick: function(view, rec) {
-        this.moveRec(view === this.fromField.boundList, rec);
-    },
-    setValue: function(value) {
-        var me = this,
-            fromField = me.fromField,
-            toField = me.toField,
-            fromStore = fromField.store,
-            toStore = toField.store,
-            selected;
-        if (!me.fromStorePopulated) {
-            me.fromField.store.on({
-                load: Ext.Function.bind(me.setValue, me, [value]),
-                single: true
-            });
-            return;
-        }
-        value = me.setupValue(value);
-        me.mixins.field.setValue.call(me, value);
-        selected = me.getRecordsForValue(value);
-        fromStore.suspendEvents();
-        toStore.suspendEvents();
-        fromStore.removeAll();
-        toStore.removeAll();
-        me.populateFromStore(me.store);
-        Ext.Array.forEach(selected, function(rec) {
-            if (fromStore.indexOf(rec) > -1) {
-                fromStore.remove(rec);
-            }
-            toStore.add(rec);
-        });
-        fromStore.resumeEvents();
-        toStore.resumeEvents();
-        Ext.suspendLayouts();
-        fromField.boundList.refresh();
-        toField.boundList.refresh();
-        Ext.resumeLayouts(true);
-    },
-    onBindStore: function(store, initial) {
-        var me = this,
-            fromField = me.fromField,
-            toField = me.toField;
-        if (fromField) {
-            fromField.store.removeAll();
-            toField.store.removeAll();
-            if (store.autoCreated) {
-                fromField.resolveDisplayField();
-                toField.resolveDisplayField();
-                me.resolveDisplayField();
-            }
-            if (!Ext.isDefined(me.valueField)) {
-                me.valueField = me.displayField;
-            }
-            if (store.getCount()) {
-                me.populateFromStore(store);
-            }
-            else {
-                me.store.on('load', me.populateFromStore, me);
-            }
-        }
-    },
-    populateFromStore: function(store) {
-        var fromStore = this.fromField.store;
-        this.fromStorePopulated = true;
-        fromStore.add(store.getRange());
-        fromStore.fireEvent('load', fromStore);
-    },
-    onEnable: function() {
-        var me = this;
-        me.callParent();
-        me.fromField.enable();
-        me.toField.enable();
-        Ext.Array.forEach(me.query('[navBtn]'), function(btn) {
-            btn.enable();
-        });
-    },
-    onDisable: function() {
-        var me = this;
-        me.callParent();
-        me.fromField.disable();
-        me.toField.disable();
-        Ext.Array.forEach(me.query('[navBtn]'), function(btn) {
-            btn.disable();
-        });
-    },
-    doDestroy: function() {
-        this.bindStore(null);
-        this.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/form/MultiSelect.js
+++ b//dev/null
@@ -1,472 +0,0 @@
-/**
- * A control that allows selection of multiple items in a list.
- */
-Ext.define('Ext.ux.form.MultiSelect', {
-    extend: 'Ext.form.FieldContainer',
-    mixins: [
-        'Ext.util.StoreHolder',
-        'Ext.form.field.Field'
-    ],
-    alternateClassName: 'Ext.ux.Multiselect',
-    alias: ['widget.multiselectfield', 'widget.multiselect'],
-    requires: ['Ext.panel.Panel', 'Ext.view.BoundList', 'Ext.layout.container.Fit'],
-    uses: ['Ext.view.DragZone', 'Ext.view.DropZone'],
-    layout: 'anchor',
-    /**
-     * @cfg {String} [dragGroup=""] The ddgroup name for the MultiSelect DragZone.
-     */
-    /**
-     * @cfg {String} [dropGroup=""] The ddgroup name for the MultiSelect DropZone.
-     */
-    /**
-     * @cfg {String} [title=""] A title for the underlying panel.
-     */
-    /**
-     * @cfg {Boolean} [ddReorder=false] Whether the items in the MultiSelect list are drag/drop
-     * reorderable.
-     */
-    ddReorder: false,
-    /**
-     * @cfg {Object/Array} tbar An optional toolbar to be inserted at the top of the control's
-     * selection list. This can be a {@link Ext.toolbar.Toolbar} object, a toolbar config,
-     * or an array of buttons/button configs to be added to the toolbar.
-     * See {@link Ext.panel.Panel#tbar}.
-     */
-    /**
-     * @cfg {String} [appendOnly=false] `true` if the list should only allow append drops
-     * when drag/drop is enabled. This is useful for lists which are sorted.
-     */
-    appendOnly: false,
-    /**
-     * @cfg {String} [displayField="text"] Name of the desired display field in the dataset.
-     */
-    displayField: 'text',
-    /**
-     * @cfg {String} [valueField="text"] Name of the desired value field in the dataset.
-     */
-    /**
-     * @cfg {Boolean} [allowBlank=true] `false` to require at least one item in the list
-     * to be selected, `true` to allow no selection.
-     */
-    allowBlank: true,
-    /**
-     * @cfg {Number} [minSelections=0] Minimum number of selections allowed.
-     */
-    minSelections: 0,
-    /**
-     * @cfg {Number} [maxSelections=Number.MAX_VALUE] Maximum number of selections allowed.
-     */
-    maxSelections: Number.MAX_VALUE,
-    /**
-     * @cfg {String} [blankText="This field is required"] Default text displayed when the control
-     * contains no items.
-     */
-    blankText: 'This field is required',
-    /**
-     * @cfg {String} [minSelectionsText="Minimum {0}item(s) required"] 
-     * Validation message displayed when {@link #minSelections} is not met. 
-     * The {0} token will be replaced by the value of {@link #minSelections}.
-     */
-    minSelectionsText: 'Minimum {0} item(s) required',
-    /**
-     * @cfg {String} [maxSelectionsText="Maximum {0}item(s) allowed"] 
-     * Validation message displayed when {@link #maxSelections} is not met
-     * The {0} token will be replaced by the value of {@link #maxSelections}.
-     */
-    maxSelectionsText: 'Maximum {0} item(s) required',
-    /**
-     * @cfg {String} [delimiter=","] The string used to delimit the selected values when
-     * {@link #getSubmitValue submitting} the field as part of a form. If you wish to have
-     * the selected values submitted as separate parameters rather than a single
-     * delimited parameter, set this to `null`.
-     */
-    delimiter: ',',
-    /**
-     * @cfg {String} [dragText="{0} Item{1}"] The text to show while dragging items.
-     * {0} will be replaced by the number of items. {1} will be replaced by the plural
-     * form if there is more than 1 item.
-     */
-    dragText: '{0} Item{1}',
-    /**
-     * @cfg {Ext.data.Store/Array} store The data source to which this MultiSelect is bound
-     * (defaults to `undefined`).
-     * Acceptable values for this property are:
-     * <div class="mdetail-params"><ul>
-     * <li><b>any {@link Ext.data.Store Store} subclass</b></li>
-     * <li><b>an Array</b> : Arrays will be converted to a {@link Ext.data.ArrayStore} internally.
-     * <div class="mdetail-params"><ul>
-     * <li><b>1-dimensional array</b> : (e.g., <tt>['Foo','Bar']</tt>)<div class="sub-desc">
-     * A 1-dimensional array will automatically be expanded (each array item will be the combo
-     * {@link #valueField value} and {@link #displayField text})</div></li>
-     * <li><b>2-dimensional array</b> : (e.g., `[['f','Foo'],['b','Bar']]`)<div class="sub-desc">
-     * For a multi-dimensional array, the value in index 0 of each item will be assumed to be
-     * the combo {@link #valueField value}, while the value at index 1 is assumed to be the combo
-     * {@link #displayField text}.
-     * </div></li></ul></div></li></ul></div>
-     */
-    ignoreSelectChange: 0,
-    /**
-     * @cfg {Object} listConfig
-     * An optional set of configuration properties that will be passed to the
-     * {@link Ext.view.BoundList}'s constructor. Any configuration that is valid for BoundList
-     * can be included.
-     */
-    /**
-     * @cfg {Number} [pageSize=10] The number of items to advance on pageUp and pageDown
-     */
-    pageSize: 10,
-    initComponent: function() {
-        var me = this;
-        me.items = me.setupItems();
-        me.bindStore(me.store, true);
-        me.callParent();
-        me.initField();
-    },
-    setupItems: function() {
-        var me = this;
-        me.boundList = new Ext.view.BoundList(Ext.apply({
-            anchor: 'none 100%',
-            border: 1,
-            multiSelect: true,
-            store: me.store,
-            displayField: me.displayField,
-            disabled: me.disabled,
-            tabIndex: 0,
-            navigationModel: {
-                type: 'default'
-            }
-        }, me.listConfig));
-        me.boundList.getNavigationModel().addKeyBindings({
-            pageUp: me.onKeyPageUp,
-            pageDown: me.onKeyPageDown,
-            scope: me
-        });
-        me.boundList.getSelectionModel().on('selectionchange', me.onSelectChange, me);
-        me.boundList.pickerField = me;
-        if (!me.title) {
-            return me.boundList;
-        }
-        me.boundList.border = false;
-        return {
-            xtype: 'panel',
-            isAriaRegion: false,
-            border: true,
-            anchor: 'none 100%',
-            layout: 'anchor',
-            title: me.title,
-            tbar: me.tbar,
-            items: me.boundList
-        };
-    },
-    onSelectChange: function(selModel, selections) {
-        if (!this.ignoreSelectChange) {
-            this.setValue(selections);
-        }
-    },
-    getSelected: function() {
-        return this.boundList.getSelectionModel().getSelection();
-    },
-    isEqual: function(v1, v2) {
-        var fromArray = Ext.Array.from,
-            i = 0,
-            len;
-        v1 = fromArray(v1);
-        v2 = fromArray(v2);
-        len = v1.length;
-        if (len !== v2.length) {
-            return false;
-        }
-        for (; i < len; i++) {
-            if (v2[i] !== v1[i]) {
-                return false;
-            }
-        }
-        return true;
-    },
-    afterRender: function() {
-        var me = this,
-            boundList, scrollable, records, panel;
-        me.callParent();
-        boundList = me.boundList;
-        scrollable = boundList && boundList.getScrollable();
-        if (me.selectOnRender) {
-            records = me.getRecordsForValue(me.value);
-            if (records.length) {
-                ++me.ignoreSelectChange;
-                boundList.getSelectionModel().select(records);
-                --me.ignoreSelectChange;
-            }
-            delete me.toSelect;
-        }
-        if (me.ddReorder && !me.dragGroup && !me.dropGroup) {
-            me.dragGroup = me.dropGroup = 'MultiselectDD-' + Ext.id();
-        }
-        if (me.draggable || me.dragGroup) {
-            me.dragZone = Ext.create('Ext.view.DragZone', {
-                view: boundList,
-                ddGroup: me.dragGroup,
-                dragText: me.dragText,
-                containerScroll: !!scrollable,
-                scrollEl: scrollable && scrollable.getElement()
-            });
-        }
-        if (me.droppable || me.dropGroup) {
-            me.dropZone = Ext.create('Ext.view.DropZone', {
-                view: boundList,
-                ddGroup: me.dropGroup,
-                handleNodeDrop: function(data, dropRecord, position) {
-                    var view = this.view,
-                        store = view.getStore(),
-                        records = data.records,
-                        index;
-                    data.view.store.remove(records);
-                    index = store.indexOf(dropRecord);
-                    if (position === 'after') {
-                        index++;
-                    }
-                    store.insert(index, records);
-                    view.getSelectionModel().select(records);
-                    me.fireEvent('drop', me, records);
-                }
-            });
-        }
-        panel = me.down('panel');
-        if (panel && boundList) {
-            boundList.ariaEl.dom.setAttribute('aria-labelledby', panel.header.id + '-title-textEl');
-        }
-    },
-    onKeyPageUp: function(e) {
-        var me = this,
-            pageSize = me.pageSize,
-            boundList = me.boundList,
-            nm = boundList.getNavigationModel(),
-            oldIdx, newIdx;
-        oldIdx = nm.recordIndex;
-        newIdx = oldIdx > pageSize ? oldIdx - pageSize : 0;
-        nm.setPosition(newIdx, e);
-    },
-    onKeyPageDown: function(e) {
-        var me = this,
-            pageSize = me.pageSize,
-            boundList = me.boundList,
-            nm = boundList.getNavigationModel(),
-            count, oldIdx, newIdx;
-        count = boundList.getStore().getCount();
-        oldIdx = nm.recordIndex;
-        newIdx = oldIdx < (count - pageSize) ? oldIdx + pageSize : count - 1;
-        nm.setPosition(newIdx, e);
-    },
-    isValid: function() {
-        var me = this,
-            disabled = me.disabled,
-            validate = me.forceValidation || !disabled;
-        return validate ? me.validateValue(me.value) : disabled;
-    },
-    validateValue: function(value) {
-        var me = this,
-            errors = me.getErrors(value),
-            isValid = Ext.isEmpty(errors);
-        if (!me.preventMark) {
-            if (isValid) {
-                me.clearInvalid();
-            }
-            else {
-                me.markInvalid(errors);
-            }
-        }
-        return isValid;
-    },
-    markInvalid: function(errors) {
-        var me = this,
-            oldMsg = me.getActiveError();
-        me.setActiveErrors(Ext.Array.from(errors));
-        if (oldMsg !== me.getActiveError()) {
-            me.updateLayout();
-        }
-    },
-    /**
-     * Clear any invalid styles/messages for this field.
-     *
-     * __Note:__ this method does not cause the Field's {@link #validate} or {@link #isValid}
-     * methods to return `true` if the value does not _pass_ validation. So simply clearing
-     * a field's errors will not necessarily allow submission of forms submitted with the
-     * {@link Ext.form.action.Submit#clientValidation} option set.
-     */
-    clearInvalid: function() {
-        var me = this,
-            hadError = me.hasActiveError();
-        me.unsetActiveError();
-        if (hadError) {
-            me.updateLayout();
-        }
-    },
-    getSubmitData: function() {
-        var me = this,
-            data = null,
-            val;
-        if (!me.disabled && me.submitValue && !me.isFileUpload()) {
-            val = me.getSubmitValue();
-            if (val !== null) {
-                data = {};
-                data[me.getName()] = val;
-            }
-        }
-        return data;
-    },
-    /**
-     * Returns the value that would be included in a standard form submit for this field.
-     *
-     * @return {String} The value to be submitted, or `null`.
-     */
-    getSubmitValue: function() {
-        var me = this,
-            delimiter = me.delimiter,
-            val = me.getValue();
-        return Ext.isString(delimiter) ? val.join(delimiter) : val;
-    },
-    getValue: function() {
-        return this.value || [];
-    },
-    getRecordsForValue: function(value) {
-        var me = this,
-            records = [],
-            all = me.store.getRange(),
-            valueField = me.valueField,
-            i = 0,
-            allLen = all.length,
-            rec,
-            j,
-            valueLen;
-        for (valueLen = value.length; i < valueLen; ++i) {
-            for (j = 0; j < allLen; ++j) {
-                rec = all[j];
-                if (rec.get(valueField) === value[i]) {
-                    records.push(rec);
-                }
-            }
-        }
-        return records;
-    },
-    setupValue: function(value) {
-        var delimiter = this.delimiter,
-            valueField = this.valueField,
-            i = 0,
-            out,
-            len,
-            item;
-        if (Ext.isDefined(value)) {
-            if (delimiter && Ext.isString(value)) {
-                value = value.split(delimiter);
-            }
-            else if (!Ext.isArray(value)) {
-                value = [value];
-            }
-            for (len = value.length; i < len; ++i) {
-                item = value[i];
-                if (item && item.isModel) {
-                    value[i] = item.get(valueField);
-                }
-            }
-            out = Ext.Array.unique(value);
-        }
-        else {
-            out = [];
-        }
-        return out;
-    },
-    setValue: function(value) {
-        var me = this,
-            selModel = me.boundList.getSelectionModel(),
-            store = me.store;
-        if (!store.getCount()) {
-            store.on({
-                load: Ext.Function.bind(me.setValue, me, [value]),
-                single: true
-            });
-            return;
-        }
-        value = me.setupValue(value);
-        me.mixins.field.setValue.call(me, value);
-        if (me.rendered) {
-            ++me.ignoreSelectChange;
-            selModel.deselectAll();
-            if (value.length) {
-                selModel.select(me.getRecordsForValue(value));
-            }
-            --me.ignoreSelectChange;
-        }
-        else {
-            me.selectOnRender = true;
-        }
-    },
-    clearValue: function() {
-        this.setValue([]);
-    },
-    onEnable: function() {
-        var list = this.boundList;
-        this.callParent();
-        if (list) {
-            list.enable();
-        }
-    },
-    onDisable: function() {
-        var list = this.boundList;
-        this.callParent();
-        if (list) {
-            list.disable();
-        }
-    },
-    getErrors: function(value) {
-        var me = this,
-            format = Ext.String.format,
-            errors = [],
-            numSelected;
-        value = Ext.Array.from(value || me.getValue());
-        numSelected = value.length;
-        if (!me.allowBlank && numSelected < 1) {
-            errors.push(me.blankText);
-        }
-        if (numSelected < me.minSelections) {
-            errors.push(format(me.minSelectionsText, me.minSelections));
-        }
-        if (numSelected > me.maxSelections) {
-            errors.push(format(me.maxSelectionsText, me.maxSelections));
-        }
-        return errors;
-    },
-    doDestroy: function() {
-        var me = this;
-        me.bindStore(null);
-        Ext.destroy(me.dragZone, me.dropZone, me.keyNav);
-        me.callParent();
-    },
-    onBindStore: function(store) {
-        var me = this,
-            boundList = this.boundList;
-        if (store.autoCreated) {
-            me.resolveDisplayField();
-        }
-        if (!Ext.isDefined(me.valueField)) {
-            me.valueField = me.displayField;
-        }
-        if (boundList) {
-            boundList.bindStore(store);
-        }
-    },
-    /**
-     * Applies auto-created store fields to field and boundlist
-     * @private
-     */
-    resolveDisplayField: function() {
-        var me = this,
-            boundList = me.boundList,
-            store = me.getStore();
-        me.valueField = me.displayField = 'field1';
-        if (!store.expanded) {
-            me.displayField = 'field2';
-        }
-        if (boundList) {
-            boundList.setDisplayField(me.displayField);
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/form/SearchField.js
+++ b//dev/null
@@ -1,68 +0,0 @@
-/**
- *
- */
-Ext.define('Ext.ux.form.SearchField', {
-    extend: 'Ext.form.field.Text',
-    alias: 'widget.searchfield',
-    triggers: {
-        clear: {
-            weight: 0,
-            cls: Ext.baseCSSPrefix + 'form-clear-trigger',
-            hidden: true,
-            handler: 'onClearClick',
-            scope: 'this'
-        },
-        search: {
-            weight: 1,
-            cls: Ext.baseCSSPrefix + 'form-search-trigger',
-            handler: 'onSearchClick',
-            scope: 'this'
-        }
-    },
-    hasSearch: false,
-    paramName: 'query',
-    initComponent: function() {
-        var me = this,
-            store = me.store,
-            proxy;
-        me.callParent(arguments);
-        me.on('specialkey', function(f, e) {
-            if (e.getKey() === e.ENTER) {
-                me.onSearchClick();
-            }
-        });
-        if (!store || !store.isStore) {
-            store = me.store = Ext.data.StoreManager.lookup(store);
-        }
-        store.setRemoteFilter(true);
-        proxy = me.store.getProxy();
-        proxy.setFilterParam(me.paramName);
-        proxy.encodeFilters = function(filters) {
-            return filters[0].getValue();
-        };
-    },
-    onClearClick: function() {
-        var me = this,
-            activeFilter = me.activeFilter;
-        if (activeFilter) {
-            me.setValue('');
-            me.store.getFilters().remove(activeFilter);
-            me.activeFilter = null;
-            me.getTrigger('clear').hide();
-            me.updateLayout();
-        }
-    },
-    onSearchClick: function() {
-        var me = this,
-            value = me.getValue();
-        if (value.length > 0) {
-            me.activeFilter = new Ext.util.Filter({
-                property: me.paramName,
-                value: value
-            });
-            me.store.getFilters().add(me.activeFilter);
-            me.getTrigger('clear').show();
-            me.updateLayout();
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/grid/SubTable.js
+++ b//dev/null
@@ -1,99 +0,0 @@
-/**
- * A small grid nested within a parent grid's row. 
- *
- * See the [Kitchen Sink](http://dev.sencha.com/extjs/5.0.1/examples/kitchensink/#customer-grid)
- * for example usage.
- */
-Ext.define('Ext.ux.grid.SubTable', {
-    extend: 'Ext.grid.plugin.RowExpander',
-    alias: 'plugin.subtable',
-    /* eslint-disable indent */
-    rowBodyTpl: [
-        '<table class="' + Ext.baseCSSPrefix + 'grid-subtable">',
-            '{%',
-                'this.owner.renderTable(out, values);',
-            '%}',
-        '</table>'
-    ],
-    /* eslint-enable indent */
-    init: function(grid) {
-        var me = this,
-            columns = me.columns,
-            len, i, columnCfg;
-        me.callParent(arguments);
-        me.columns = [];
-        if (columns) {
-            for (i = 0, len = columns.length; i < len; ++i) {
-                columnCfg = Ext.apply({
-                    preventRegister: true
-                }, columns[i]);
-                columnCfg.xtype = columnCfg.xtype || 'gridcolumn';
-                me.columns.push(Ext.widget(columnCfg));
-            }
-        }
-    },
-    destroy: function() {
-        var columns = this.columns,
-            len, i;
-        if (columns) {
-            for (i = 0, len = columns.length; i < len; ++i) {
-                columns[i].destroy();
-            }
-        }
-        this.columns = null;
-        this.callParent();
-    },
-    getRowBodyFeatureData: function(record, idx, rowValues) {
-        this.callParent(arguments);
-        rowValues.rowBodyCls += ' ' + Ext.baseCSSPrefix + 'grid-subtable-row';
-    },
-    renderTable: function(out, rowValues) {
-        var me = this,
-            columns = me.columns,
-            numColumns = columns.length,
-            associatedRecords = me.getAssociatedRecords(rowValues.record),
-            recCount = associatedRecords.length,
-            rec, column, i, j, value;
-        out.push('<thead>');
-        for (j = 0; j < numColumns; j++) {
-            out.push(
-                '<th class="' + Ext.baseCSSPrefix + 'grid-subtable-header">',
-                columns[j].text,
-                '</th>'
-            );
-        }
-        out.push('</thead><tbody>');
-        for (i = 0; i < recCount; i++) {
-            rec = associatedRecords[i];
-            out.push('<tr>');
-            for (j = 0; j < numColumns; j++) {
-                column = columns[j];
-                value = rec.get(column.dataIndex);
-                if (column.renderer && column.renderer.call) {
-                    value = column.renderer.call(column.scope || me, value, {}, rec);
-                }
-                out.push('<td class="' + Ext.baseCSSPrefix + 'grid-subtable-cell"');
-                if (column.width != null) {
-                    out.push(' style="width:' + column.width + 'px"');
-                }
-                out.push(
-                    '><div class="' + Ext.baseCSSPrefix + 'grid-cell-inner">',
-                    value,
-                    '</div></td>'
-                );
-            }
-            out.push('</tr>');
-        }
-        out.push('</tbody>');
-    },
-    getRowBodyContentsFn: function(rowBodyTpl) {
-        var me = this;
-        return function(rowValues) {
-            rowBodyTpl.owner = me;
-            return rowBodyTpl.applyTemplate(rowValues);
-        };
-    },
-    getAssociatedRecords: function(record) {
-        return record[this.association]().getRange();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/grid/TransformGrid.js
+++ b//dev/null
@@ -1,78 +0,0 @@
-/**
- * A Grid which creates itself from an existing HTML table element.
- */
-Ext.define('Ext.ux.grid.TransformGrid', {
-    extend: 'Ext.grid.Panel',
-    /**
-     * Creates the grid from HTML table element.
-     * @param {String/HTMLElement/Ext.Element} table The table element from which this grid
-     * will be created - The table MUST have some type of size defined for the grid to fill.
-     * The container will be automatically set to position relative if it isn't already.
-     * @param {Object} [config] A config object that sets properties on this grid and has two
-     * additional (optional) properties: fields and columns which allow for customizing data fields
-     * and columns for this grid.
-     */
-    constructor: function(table, config) {
-        config = Ext.apply({}, config);
-        table = this.table = Ext.get(table);
-        var configFields = config.fields || [],
-            configColumns = config.columns || [],
-            fields = [],
-            cols = [],
-            headers = table.query("thead th"),
-            i = 0,
-            len = headers.length,
-            data = table.dom,
-            width, height, col, text, name;
-        for (; i < len; ++i) {
-            col = headers[i];
-            text = col.innerHTML;
-            name = 'tcol-' + i;
-            fields.push(Ext.applyIf(configFields[i] || {}, {
-                name: name,
-                mapping: 'td:nth(' + (i + 1) + ')/@innerHTML'
-            }));
-            cols.push(Ext.applyIf(configColumns[i] || {}, {
-                text: text,
-                dataIndex: name,
-                width: col.offsetWidth,
-                tooltip: col.title,
-                sortable: true
-            }));
-        }
-        if (config.width) {
-            width = config.width;
-        }
-        else {
-            width = table.getWidth() + 1;
-        }
-        if (config.height) {
-            height = config.height;
-        }
-        Ext.applyIf(config, {
-            store: {
-                data: data,
-                fields: fields,
-                proxy: {
-                    type: 'memory',
-                    reader: {
-                        record: 'tbody tr',
-                        type: 'xml'
-                    }
-                }
-            },
-            columns: cols,
-            width: width,
-            height: height
-        });
-        this.callParent([config]);
-        if (config.remove !== false) {
-            data.parentNode.removeChild(data);
-        }
-    },
-    doDestroy: function() {
-        this.table.remove();
-        this.tabl = null;
-        this.callParent();
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/grid/plugin/AutoSelector.js
+++ b//dev/null
@@ -1,54 +0,0 @@
-/**
- * This plugin ensures that its associated grid or tree always has a selection record. The
- * only exception is, of course, when there are no records in the store.
- * @since 6.0.2
- */
-Ext.define('Ext.ux.grid.plugin.AutoSelector', {
-    extend: 'Ext.plugin.Abstract',
-    alias: 'plugin.gridautoselector',
-    config: {
-        store: null
-    },
-    init: function(grid) {
-        var me = this;
-        if (!grid.isXType('tablepanel')) {
-            Ext.raise('The gridautoselector plugin is designed only for grids and trees');
-        }
-        me.grid = grid;
-        me.watchGrid();
-        grid.on({
-            reconfigure: me.watchGrid,
-            scope: me
-        });
-    },
-    destroy: function() {
-        this.setStore(null);
-        this.grid = null;
-        this.callParent();
-    },
-    ensureSelection: function() {
-        var grid = this.grid,
-            store = grid.getStore(),
-            selection;
-        if (store.getCount()) {
-            selection = grid.getSelection();
-            if (!selection || !selection.length) {
-                grid.getSelectionModel().select(0);
-            }
-        }
-    },
-    watchGrid: function() {
-        this.setStore(this.grid.getStore());
-        this.ensureSelection();
-    },
-    updateStore: function(store) {
-        var me = this;
-        Ext.destroy(me.storeListeners);
-        me.storeListeners = store && store.on({
-            add: me.ensureSelection,
-            remove: me.ensureSelection,
-            destroyable: true,
-            scope: me
-        });
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/layout/ResponsiveColumn.js
+++ b//dev/null
@@ -1,169 +0,0 @@
-/**
- * A simple grid-like layout for proportionally dividing container space and allocating it
- * to each item. All items in this layout are given one or more percentage sizes and CSS
- * `float:left` is used to provide the wrapping.
- *
- * To select which of the percentage sizes an item uses, this layout adds a viewport
- * {@link #states size-dependent} class name to the container. The style sheet must
- * provide the rules to select the desired size using the {@link #responsivecolumn-item}
- * mixin.
- *
- * For example, a panel in a responsive column layout might add the following styles:
- *
- *      .my-panel {
- *          // consume 50% of the available space inside the container by default
- *          @include responsivecolumn-item(50%);
- *
- *          .x-responsivecolumn-small & {
- *              // consume 100% of available space in "small" mode
- *              // (viewport width < 1000 by default)
- *              @include responsivecolumn-item(100%);
- *          }
- *      }
- *
- * Alternatively, instead of targeting specific panels in CSS, you can create reusable
- * classes:
- *
- *      .big-50 {
- *          // consume 50% of the available space inside the container by default
- *          @include responsivecolumn-item(50%);
- *      }
- *
- *      .x-responsivecolumn-small {
- *          > .small-100 {
- *              @include responsivecolumn-item(100%);
- *          }
- *      }
- *
- * These can be added to components in the layout using the `responsiveCls` config:
- *
- *      items: [{
- *          xtype: 'my-panel',
- *
- *          // Use 50% of space when viewport is "big" and 100% when viewport
- *          // is "small":
- *          responsiveCls: 'big-50 small-100'
- *      }]
- *
- * The `responsiveCls` config is provided by this layout to avoid overwriting classes
- * specified using `cls` or other standard configs.
- *
- * Internally, this layout simply uses `float:left` and CSS `calc()` (except on IE8) to
- * "flex" each item. The calculation is always based on a percentage with a spacing taken
- * into account to separate the items from each other.
- */
-Ext.define('Ext.ux.layout.ResponsiveColumn', {
-    extend: 'Ext.layout.container.Auto',
-    alias: 'layout.responsivecolumn',
-    /**
-     * @cfg {Object} states
-     *
-     * A set of layout state names corresponding to viewport size thresholds. One of the
-     * states will be used to assign the responsive column CSS class to the container to
-     * trigger appropriate item sizing.
-     *
-     * For example:
-     *
-     *      layout: {
-     *          type: 'responsivecolumn',
-     *          states: {
-     *              small: 800,
-     *              medium: 1200,
-     *              large: 0
-     *          }
-     *      }
-     *
-     * Given the above set of responsive states, one of the following CSS classes will be
-     * added to the container:
-     *
-     *   - `x-responsivecolumn-small` - If the viewport is <= 800px
-     *   - `x-responsivecolumn-medium` - If the viewport is > 800px and <= 1200px
-     *   - `x-responsivecolumn-large` - If the viewport is > 1200px
-     *
-     * For sake of efficiency these classes are based on the size of the browser viewport
-     * (the browser window) and not on the container size. As the size of the viewport
-     * changes, this layout will maintain the appropriate CSS class on the container which
-     * will then activate the appropriate CSS rules to size the child items.
-     */
-    states: {
-        small: 1000,
-        large: 0
-    },
-    _responsiveCls: Ext.baseCSSPrefix + 'responsivecolumn',
-    initLayout: function() {
-        this.innerCtCls += ' ' + this._responsiveCls;
-        this.callParent();
-    },
-    beginLayout: function(ownerContext) {
-        var me = this,
-            viewportWidth = Ext.Element.getViewportWidth(),
-            states = me.states,
-            activeThreshold = Infinity,
-            innerCt = me.innerCt,
-            currentState = me._currentState,
-            name, threshold, newState;
-        for (name in states) {
-            threshold = states[name] || Infinity;
-            if (viewportWidth <= threshold && threshold <= activeThreshold) {
-                activeThreshold = threshold;
-                newState = name;
-            }
-        }
-        if (newState !== currentState) {
-            innerCt.replaceCls(currentState, newState, me._responsiveCls);
-            me._currentState = newState;
-        }
-        me.callParent(arguments);
-    },
-    onAdd: function(item) {
-        var responsiveCls;
-        this.callParent([item]);
-        responsiveCls = item.responsiveCls;
-        if (responsiveCls) {
-            item.addCls(responsiveCls);
-        }
-    }
-}, function(Responsive) {
-    if (Ext.isIE8) {
-        Responsive.override({
-            responsiveSizePolicy: {
-                readsWidth: 0,
-                readsHeight: 0,
-                setsWidth: 1,
-                setsHeight: 0
-            },
-            setsItemSize: true,
-            calculateItems: function(ownerContext, containerSize) {
-                var me = this,
-                    targetContext = ownerContext.targetContext,
-                    items = ownerContext.childItems,
-                    len = items.length,
-                    gotWidth = containerSize.gotWidth,
-                    contentWidth = containerSize.width,
-                    i, itemContext, itemMarginWidth, itemWidth;
-                if (gotWidth === false) {
-                    targetContext.domBlock(me, 'width');
-                    return false;
-                }
-                if (!gotWidth) {
-                    return true;
-                }
-                for (i = 0; i < len; ++i) {
-                    itemContext = items[i];
-                    itemWidth = parseInt(itemContext.el.getStyle('background-position-x'), 10);
-                    itemMarginWidth =
-                        parseInt(itemContext.el.getStyle('background-position-y'), 10);
-                    itemContext.setWidth(
-                        (itemWidth / 100 * (contentWidth - itemMarginWidth)) - itemMarginWidth
-                    );
-                }
-                ownerContext.setContentWidth(contentWidth +
-                    ownerContext.paddingContext.getPaddingInfo().width);
-                return true;
-            },
-            getItemSizePolicy: function() {
-                return this.responsiveSizePolicy;
-            }
-        });
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/statusbar/StatusBar.js
+++ b//dev/null
@@ -1,398 +0,0 @@
-/**
- * Basic status bar component that can be used as the bottom toolbar of any {@link Ext.Panel}.
- * In addition to supporting the standard {@link Ext.toolbar.Toolbar} interface for adding buttons,
- * menus and other items, the StatusBar provides a greedy status element that can be aligned
- * to either side and has convenient methods for setting the status text and icon. You can also
- * indicate that something is processing using the {@link #showBusy} method.
- *
- *     Ext.create('Ext.Panel', {
- *         title: 'StatusBar',
- *         // etc.
- *         bbar: Ext.create('Ext.ux.StatusBar', {
- *             id: 'my-status',
- *      
- *             // defaults to use when the status is cleared:
- *             defaultText: 'Default status text',
- *             defaultIconCls: 'default-icon',
- *      
- *             // values to set initially:
- *             text: 'Ready',
- *             iconCls: 'ready-icon',
- *      
- *             // any standard Toolbar items:
- *             items: [{
- *                 text: 'A Button'
- *             }, '-', 'Plain Text']
- *         })
- *     });
- *
- *     // Update the status bar later in code:
- *     var sb = Ext.getCmp('my-status');
- *     sb.setStatus({
- *         text: 'OK',
- *         iconCls: 'ok-icon',
- *         clear: true // auto-clear after a set interval
- *     });
- *
- *     // Set the status bar to show that something is processing:
- *     sb.showBusy();
- *
- *     // processing....
- *
- *     sb.clearStatus(); // once completeed
- *
- */
-Ext.define('Ext.ux.statusbar.StatusBar', {
-    extend: 'Ext.toolbar.Toolbar',
-    xtype: 'statusbar',
-    alternateClassName: 'Ext.ux.StatusBar',
-    requires: ['Ext.toolbar.TextItem'],
-    /**
-     * @cfg {String} statusAlign
-     * The alignment of the status element within the overall StatusBar layout. When the StatusBar
-     * is rendered, it creates an internal div containing the status text and icon. Any additional
-     * Toolbar items added in the StatusBar's {@link #cfg-items} config, or added via
-     * {@link #method-add} or any of the supported add* methods, will be rendered, in added order,
-     * to the opposite side.  The status element is greedy, so it will automatically expand
-     * to take up all sapce left over by any other items.  Example usage:
-     *
-     *     // Create a left-aligned status bar containing a button,
-     *     // separator and text item that will be right-aligned (default):
-     *     Ext.create('Ext.Panel', {
-     *         title: 'StatusBar',
-     *         // etc.
-     *         bbar: Ext.create('Ext.ux.statusbar.StatusBar', {
-     *             defaultText: 'Default status text',
-     *             id: 'status-id',
-     *             items: [{
-     *                 text: 'A Button'
-     *             }, '-', 'Plain Text']
-     *         })
-     *     });
-     *
-     *     // By adding the statusAlign config, this will create the
-     *     // exact same toolbar, except the status and toolbar item
-     *     // layout will be reversed from the previous example:
-     *     Ext.create('Ext.Panel', {
-     *         title: 'StatusBar',
-     *         // etc.
-     *         bbar: Ext.create('Ext.ux.statusbar.StatusBar', {
-     *             defaultText: 'Default status text',
-     *             id: 'status-id',
-     *             statusAlign: 'right',
-     *             items: [{
-     *                 text: 'A Button'
-     *             }, '-', 'Plain Text']
-     *         })
-     *     });
-     */
-    /**
-     * @cfg {String} [defaultText='']
-     * The default {@link #text} value.  This will be used anytime the status bar is cleared
-     * with the `useDefaults:true` option.
-     */
-    /**
-     * @cfg {String} [defaultIconCls='']
-     * The default {@link #iconCls} value (see the iconCls docs for additional details about
-     * customizing the icon). This will be used anytime the status bar is cleared with the
-     * `useDefaults:true` option.
-     */
-    /**
-     * @cfg {String} text
-     * A string that will be <b>initially</b> set as the status message.  This string
-     * will be set as innerHTML (html tags are accepted) for the toolbar item.
-     * If not specified, the value set for {@link #defaultText} will be used.
-     */
-    /**
-     * @cfg [iconCls='']
-     * @inheritdoc Ext.panel.Header#cfg-iconCls
-     * @localdoc **Note:** This CSS class will be **initially** set as the status bar 
-     * icon.  See also {@link #defaultIconCls} and {@link #busyIconCls}.
-     *
-     * Example usage:
-     *
-     *     // Example CSS rule:
-     *     .x-statusbar .x-status-custom {
-     *         padding-left: 25px;
-     *         background: transparent url(images/custom-icon.gif) no-repeat 3px 2px;
-     *     }
-     *
-     *     // Setting a default icon:
-     *     var sb = Ext.create('Ext.ux.statusbar.StatusBar', {
-     *         defaultIconCls: 'x-status-custom'
-     *     });
-     *
-     *     // Changing the icon:
-     *     sb.setStatus({
-     *         text: 'New status',
-     *         iconCls: 'x-status-custom'
-     *     });
-     */
-    /**
-     * @cfg {String} cls
-     * The base class applied to the containing element for this component on render.
-     */
-    cls: 'x-statusbar',
-    /**
-     * @cfg {String} busyIconCls
-     * The default {@link #iconCls} applied when calling {@link #showBusy}.
-     * It can be overridden at any time by passing the `iconCls` argument into {@link #showBusy}.
-     */
-    busyIconCls: 'x-status-busy',
-    /**
-     * @cfg {String} busyText
-     * The default {@link #text} applied when calling {@link #showBusy}.
-     * It can be overridden at any time by passing the `text` argument into {@link #showBusy}.
-     */
-    busyText: 'Loading...',
-    /**
-     * @cfg {Number} autoClear
-     * The number of milliseconds to wait after setting the status via
-     * {@link #setStatus} before automatically clearing the status text and icon.
-     * Note that this only applies when passing the `clear` argument to {@link #setStatus}
-     * since that is the only way to defer clearing the status.  This can
-     * be overridden by specifying a different `wait` value in {@link #setStatus}.
-     * Calls to {@link #clearStatus} always clear the status bar immediately and ignore this value.
-     */
-    autoClear: 5000,
-    /**
-     * @cfg {String} emptyText
-     * The text string to use if no text has been set. If there are no other items in
-     * the toolbar using an empty string (`''`) for this value would end up in the toolbar
-     * height collapsing since the empty string will not maintain the toolbar height.
-     * Use `''` if the toolbar should collapse in height vertically when no text is
-     * specified and there are no other items in the toolbar.
-     */
-    emptyText: '&#160;',
-    /**
-     * @private
-     */
-    activeThreadId: 0,
-    initComponent: function() {
-        var right = this.statusAlign === 'right';
-        this.callParent(arguments);
-        this.currIconCls = this.iconCls || this.defaultIconCls;
-        this.statusEl = Ext.create('Ext.toolbar.TextItem', {
-            cls: 'x-status-text ' + (this.currIconCls || ''),
-            text: this.text || this.defaultText || ''
-        });
-        if (right) {
-            this.cls += ' x-status-right';
-            this.add('->');
-            this.add(this.statusEl);
-        }
-        else {
-            this.insert(0, this.statusEl);
-            this.insert(1, '->');
-        }
-    },
-    /**
-     * Sets the status {@link #text} and/or {@link #iconCls}. Also supports automatically clearing
-     * the status that was set after a specified interval.
-     *
-     * Example usage:
-     *
-     *     // Simple call to update the text
-     *     statusBar.setStatus('New status');
-     *
-     *     // Set the status and icon, auto-clearing with default options:
-     *     statusBar.setStatus({
-     *         text: 'New status',
-     *         iconCls: 'x-status-custom',
-     *         clear: true
-     *     });
-     *
-     *     // Auto-clear with custom options:
-     *     statusBar.setStatus({
-     *         text: 'New status',
-     *         iconCls: 'x-status-custom',
-     *         clear: {
-     *             wait: 8000,
-     *             anim: false,
-     *             useDefaults: false
-     *         }
-     *     });
-     *
-     * @param {Object/String} config A config object specifying what status to set, or a string
-     * assumed to be the status text (and all other options are defaulted as explained below).
-     * A config object containing any or all of the following properties can be passed:
-     *
-     * @param {String} config.text The status text to display.  If not specified, any current
-     * status text will remain unchanged.
-     *
-     * @param {String} config.iconCls The CSS class used to customize the status icon (see
-     * {@link #iconCls} for details). If not specified, any current iconCls will remain unchanged.
-     *
-     * @param {Boolean/Number/Object} config.clear Allows you to set an internal callback that will
-     * automatically clear the status text and iconCls after a specified amount of time has passed.
-     * If clear is not specified, the new status will not be auto-cleared and will stay until
-     * updated again or cleared using {@link #clearStatus}. If `true` is passed, the status will be
-     * cleared using {@link #autoClear}, {@link #defaultText} and {@link #defaultIconCls} via
-     * a fade out animation. If a numeric value is passed, it will be used as the callback interval
-     * (in milliseconds), overriding the {@link #autoClear} value. All other options will be
-     * defaulted as with the boolean option. To customize any other options, you can pass an object
-     * in the format:
-     * 
-     * @param {Number} config.clear.wait The number of milliseconds to wait before clearing
-     * (defaults to {@link #autoClear}).
-     * @param {Boolean} config.clear.anim False to clear the status immediately once the callback
-     * executes (defaults to true which fades the status out).
-     * @param {Boolean} config.clear.useDefaults False to completely clear the status text
-     * and iconCls (defaults to true which uses {@link #defaultText} and {@link #defaultIconCls}).
-     *
-     * @return {Ext.ux.statusbar.StatusBar} this
-     */
-    setStatus: function(config) {
-        var me = this,
-            c, wait, defaults;
-        config = config || {};
-        Ext.suspendLayouts();
-        if (Ext.isString(config)) {
-            config = { text: config };
-        }
-        if (config.text !== undefined) {
-            me.setText(config.text);
-        }
-        if (config.iconCls !== undefined) {
-            me.setIcon(config.iconCls);
-        }
-        if (config.clear) {
-            c = config.clear;
-            wait = me.autoClear;
-            defaults = { useDefaults: true, anim: true };
-            if (Ext.isObject(c)) {
-                c = Ext.applyIf(c, defaults);
-                if (c.wait) {
-                    wait = c.wait;
-                }
-            }
-            else if (Ext.isNumber(c)) {
-                wait = c;
-                c = defaults;
-            }
-            else if (Ext.isBoolean(c)) {
-                c = defaults;
-            }
-            c.threadId = this.activeThreadId;
-            Ext.defer(me.clearStatus, wait, me, [c]);
-        }
-        Ext.resumeLayouts(true);
-        return me;
-    },
-    /**
-     * Clears the status {@link #text} and {@link #iconCls}. Also supports clearing via an optional
-     * fade out animation.
-     *
-     * @param {Object} [config] A config object containing any or all of the following properties.
-     * If this object is not specified the status will be cleared using the defaults below:
-     * @param {Boolean} config.anim True to clear the status by fading out the status element
-     * (defaults to false which clears immediately).
-     * @param {Boolean} config.useDefaults True to reset the text and icon using
-     * {@link #defaultText} and {@link #defaultIconCls} (defaults to false which sets the text
-     * to '' and removes any existing icon class).
-     *
-     * @return {Ext.ux.statusbar.StatusBar} this
-     */
-    clearStatus: function(config) {
-        var me = this,
-            statusEl = me.statusEl,
-            text, iconCls;
-        config = config || {};
-        if (me.destroyed || config.threadId && config.threadId !== me.activeThreadId) {
-            return me;
-        }
-        text = config.useDefaults ? me.defaultText : me.emptyText;
-        iconCls = config.useDefaults ? (me.defaultIconCls ? me.defaultIconCls : '') : '';
-        if (config.anim) {
-            statusEl.el.puff({
-                remove: false,
-                useDisplay: true,
-                callback: function() {
-                    statusEl.el.show();
-                    me.setStatus({
-                        text: text,
-                        iconCls: iconCls
-                    });
-                }
-            });
-        }
-        else {
-            me.setStatus({
-                text: text,
-                iconCls: iconCls
-            });
-        }
-        return me;
-    },
-    /**
-     * Convenience method for setting the status text directly. For more flexible options see
-     * {@link #setStatus}.
-     * @param {String} text (optional) The text to set (defaults to '')
-     * @return {Ext.ux.statusbar.StatusBar} this
-     */
-    setText: function(text) {
-        var me = this;
-        me.activeThreadId++;
-        me.text = text || '';
-        if (me.rendered) {
-            me.statusEl.setText(me.text);
-        }
-        return me;
-    },
-    /**
-     * Returns the current status text.
-     * @return {String} The status text
-     */
-    getText: function() {
-        return this.text;
-    },
-    /**
-     * Convenience method for setting the status icon directly. For more flexible options see
-     * {@link #setStatus}.
-     * See {@link #iconCls} for complete details about customizing the icon.
-     * @param {String} cls (optional) The icon class to set (defaults to '', and any current
-     * icon class is removed)
-     * @return {Ext.ux.statusbar.StatusBar} this
-     */
-    setIcon: function(cls) {
-        var me = this;
-        me.activeThreadId++;
-        cls = cls || '';
-        if (me.rendered) {
-            if (me.currIconCls) {
-                me.statusEl.removeCls(me.currIconCls);
-                me.currIconCls = null;
-            }
-            if (cls.length > 0) {
-                me.statusEl.addCls(cls);
-                me.currIconCls = cls;
-            }
-        }
-        else {
-            me.currIconCls = cls;
-        }
-        return me;
-    },
-    /**
-     * Convenience method for setting the status text and icon to special values that are
-     * pre-configured to indicate a "busy" state, usually for loading or processing activities.
-     *
-     * @param {Object/String} config (optional) A config object in the same format supported by
-     * {@link #setStatus}, or a string to use as the status text (in which case all other options
-     * for setStatus will be defaulted). Use the `text` and/or `iconCls` properties on the config
-     * to override the default {@link #busyText} and {@link #busyIconCls} settings. If the config
-     * argument is not specified, {@link #busyText} and {@link #busyIconCls} will be used
-     * in conjunction with all of the default options for {@link #setStatus}.
-     * @return {Ext.ux.statusbar.StatusBar} this
-     */
-    showBusy: function(config) {
-        if (Ext.isString(config)) {
-            config = { text: config };
-        }
-        config = Ext.applyIf(config || {}, {
-            text: this.busyText,
-            iconCls: this.busyIconCls
-        });
-        return this.setStatus(config);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/classic/src/statusbar/ValidationStatus.js
+++ b//dev/null
@@ -1,222 +0,0 @@
-/**
- * A {@link Ext.ux.statusbar.StatusBar} plugin that provides automatic error
- * notification when the associated form contains validation errors.
- */
-Ext.define('Ext.ux.statusbar.ValidationStatus', {
-    extend: 'Ext.Component',
-    alias: 'plugin.validationstatus',
-    requires: ['Ext.util.MixedCollection'],
-    /**
-     * @cfg {String} errorIconCls
-     * The {@link Ext.ux.statusbar.StatusBar#iconCls iconCls} value to be applied
-     * to the status message when there is a validation error.
-     */
-    errorIconCls: 'x-status-error',
-    /**
-     * @cfg {String} errorListCls
-     * The css class to be used for the error list when there are validation errors.
-     */
-    errorListCls: 'x-status-error-list',
-    /**
-     * @cfg {String} validIconCls
-     * The {@link Ext.ux.statusbar.StatusBar#iconCls iconCls} value to be applied
-     * to the status message when the form validates.
-     */
-    validIconCls: 'x-status-valid',
-    /**
-     * @cfg {String} showText
-     * The {@link Ext.ux.statusbar.StatusBar#text text} value to be applied when
-     * there is a form validation error.
-     */
-    showText: 'The form has errors (click for details...)',
-    /**
-     * @cfg {String} hideText
-     * The {@link Ext.ux.statusbar.StatusBar#text text} value to display when
-     * the error list is displayed.
-     */
-    hideText: 'Click again to hide the error list',
-    /**
-     * @cfg {String} submitText
-     * The {@link Ext.ux.statusbar.StatusBar#text text} value to be applied when
-     * the form is being submitted.
-     */
-    submitText: 'Saving...',
-    /**
-     * @private
-     */
-    init: function(sb) {
-        var me = this;
-        me.statusBar = sb;
-        sb.on({
-            single: true,
-            scope: me,
-            render: me.onStatusbarRender
-        });
-        sb.on({
-            click: {
-                element: 'el',
-                fn: me.onStatusClick,
-                scope: me,
-                buffer: 200
-            }
-        });
-    },
-    onStatusbarRender: function(sb) {
-        var me = this,
-            startMonitor = function() {
-                me.monitor = true;
-            };
-        me.monitor = true;
-        me.errors = Ext.create('Ext.util.MixedCollection');
-        me.listAlign = (sb.statusAlign === 'right' ? 'br-tr?' : 'bl-tl?');
-        if (me.form) {
-            me.formPanel = Ext.getCmp(me.form) ||
-                           me.statusBar.lookupController().lookupReference(me.form);
-            me.basicForm = me.formPanel.getForm();
-            me.startMonitoring();
-            me.basicForm.on({
-                beforeaction: function(f, action) {
-                    if (action.type === 'submit') {
-                        me.monitor = false;
-                    }
-                }
-            });
-            me.formPanel.on({
-                beforedestroy: me.destroy,
-                scope: me
-            });
-            me.basicForm.on('actioncomplete', startMonitor);
-            me.basicForm.on('actionfailed', startMonitor);
-        }
-    },
-    /**
-     * @private
-     */
-    startMonitoring: function() {
-        this.basicForm.getFields().each(function(f) {
-            f.on('validitychange', this.onFieldValidation, this);
-        }, this);
-    },
-    /**
-     * @private
-     */
-    stopMonitoring: function() {
-        var form = this.basicForm;
-        if (!form.destroyed) {
-            form.getFields().each(function(f) {
-                f.un('validitychange', this.onFieldValidation, this);
-            }, this);
-        }
-    },
-    doDestroy: function() {
-        Ext.destroy(this.msgEl);
-        this.stopMonitoring();
-        this.statusBar.statusEl.un('click', this.onStatusClick, this);
-        this.callParent();
-    },
-    /**
-     * @private
-     */
-    onFieldValidation: function(f, isValid) {
-        var me = this,
-            msg;
-        if (!me.monitor) {
-            return false;
-        }
-        msg = f.getErrors()[0];
-        if (msg) {
-            me.errors.add(f.id, { field: f, msg: msg });
-        }
-        else {
-            me.errors.removeAtKey(f.id);
-        }
-        this.updateErrorList();
-        if (me.errors.getCount() > 0) {
-            if (me.statusBar.getText() !== me.showText) {
-                me.statusBar.setStatus({
-                    text: me.showText,
-                    iconCls: me.errorIconCls
-                });
-            }
-        }
-        else {
-            me.statusBar.clearStatus().setIcon(me.validIconCls);
-        }
-    },
-    /**
-     * @private
-     */
-    updateErrorList: function() {
-        var me = this,
-            msg,
-            msgEl = me.getMsgEl();
-        if (me.errors.getCount() > 0) {
-            msg = ['<ul>'];
-            this.errors.each(function(err) {
-                msg.push('<li id="x-err-', err.field.id, '"><a href="#">', err.msg, '</a></li>');
-            });
-            msg.push('</ul>');
-            msgEl.update(msg.join(''));
-        }
-        else {
-            msgEl.update('');
-        }
-        msgEl.setSize('auto', 'auto');
-    },
-    /**
-     * @private
-     */
-    getMsgEl: function() {
-        var me = this,
-            msgEl = me.msgEl,
-            t;
-        if (!msgEl) {
-            msgEl = me.msgEl = Ext.DomHelper.append(Ext.getBody(), {
-                cls: me.errorListCls
-            }, true);
-            msgEl.hide();
-            msgEl.on('click', function(e) {
-                t = e.getTarget('li', 10, true);
-                if (t) {
-                    Ext.getCmp(t.id.split('x-err-')[1]).focus();
-                    me.hideErrors();
-                }
-            }, null, { stopEvent: true }); // prevent anchor click navigation
-        }
-        return msgEl;
-    },
-    /**
-     * @private
-     */
-    showErrors: function() {
-        var me = this;
-        me.updateErrorList();
-        me.getMsgEl().alignTo(me.statusBar.getEl(), me.listAlign).slideIn(
-            'b', { duration: 300, easing: 'easeOut' }
-        );
-        me.statusBar.setText(me.hideText);
-        me.formPanel.body.on('click', me.hideErrors, me, { single: true });
-    },
-    /**
-     * @private
-     */
-    hideErrors: function() {
-        var el = this.getMsgEl();
-        if (el.isVisible()) {
-            el.slideOut('b', { duration: 300, easing: 'easeIn' });
-            this.statusBar.setText(this.showText);
-        }
-        this.formPanel.body.un('click', this.hideErrors, this);
-    },
-    /**
-     * @private
-     */
-    onStatusClick: function() {
-        if (this.getMsgEl().isVisible()) {
-            this.hideErrors();
-        }
-        else if (this.errors.getCount() > 0) {
-            this.showErrors();
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/event/Driver.js
+++ b//dev/null
@@ -1,85 +0,0 @@
-/**
- * This is the base class for {@link Ext.ux.event.Recorder} and {@link Ext.ux.event.Player}.
- */
-Ext.define('Ext.ux.event.Driver', {
-    extend: 'Ext.util.Observable',
-    active: null,
-    specialKeysByName: {
-        PGUP: 33,
-        PGDN: 34,
-        END: 35,
-        HOME: 36,
-        LEFT: 37,
-        UP: 38,
-        RIGHT: 39,
-        DOWN: 40
-    },
-    specialKeysByCode: {
-    },
-    /**
-     * @event start
-     * Fires when this object is started.
-     * @param {Ext.ux.event.Driver} this
-     */
-    /**
-     * @event stop
-     * Fires when this object is stopped.
-     * @param {Ext.ux.event.Driver} this
-     */
-    getTextSelection: function(el) {
-        var doc = el.ownerDocument,
-            range, range2, start, end;
-        if (typeof el.selectionStart === "number") {
-            start = el.selectionStart;
-            end = el.selectionEnd;
-        }
-        else if (doc.selection) {
-            range = doc.selection.createRange();
-            range2 = el.createTextRange();
-            range2.setEndPoint('EndToStart', range);
-            start = range2.text.length;
-            end = start + range.text.length;
-        }
-        return [ start, end ];
-    },
-    getTime: function() {
-        return new Date().getTime();
-    },
-    /**
-     * Returns the number of milliseconds since start was called.
-     */
-    getTimestamp: function() {
-        var d = this.getTime();
-        return d - this.startTime;
-    },
-    onStart: function() {},
-    onStop: function() {},
-    /**
-     * Starts this object. If this object is already started, nothing happens.
-     */
-    start: function() {
-        var me = this;
-        if (!me.active) {
-            me.active = new Date();
-            me.startTime = me.getTime();
-            me.onStart();
-            me.fireEvent('start', me);
-        }
-    },
-    /**
-     * Stops this object. If this object is not started, nothing happens.
-     */
-    stop: function() {
-        var me = this;
-        if (me.active) {
-            me.active = null;
-            me.onStop();
-            me.fireEvent('stop', me);
-        }
-    }
-}, function() {
-    var proto = this.prototype;
-    Ext.Object.each(proto.specialKeysByName, function(name, value) {
-        proto.specialKeysByCode[value] = name;
-    });
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/event/Maker.js
+++ b//dev/null
@@ -1,42 +0,0 @@
-/**
- * Event maker.
- */
-Ext.define('Ext.ux.event.Maker', {
-    eventQueue: [],
-    startAfter: 500,
-    timerIncrement: 500,
-    currentTiming: 0,
-    constructor: function(config) {
-        var me = this;
-        me.currentTiming = me.startAfter;
-        if (!Ext.isArray(config)) {
-            config = [config];
-        }
-        Ext.Array.each(config, function(item) {
-            item.el = item.el || 'el';
-            Ext.Array.each(Ext.ComponentQuery.query(item.cmpQuery), function(cmp) {
-                var event = {},
-                    x, y, el;
-                if (!item.domQuery) {
-                    el = cmp[item.el];
-                }
-                else {
-                    el = cmp.el.down(item.domQuery);
-                }
-                event.target = '#' + el.dom.id;
-                event.type = item.type;
-                event.button = config.button || 0;
-                x = el.getX() + (el.getWidth() / 2);
-                y = el.getY() + (el.getHeight() / 2);
-                event.xy = [x, y];
-                event.ts = me.currentTiming;
-                me.currentTiming += me.timerIncrement;
-                me.eventQueue.push(event);
-            });
-            if (item.screenshot) {
-                me.eventQueue[me.eventQueue.length - 1].screenshot = true;
-            }
-        });
-        return me.eventQueue;
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/event/Player.js
+++ b//dev/null
@@ -1,887 +0,0 @@
-/**
- * @extends Ext.ux.event.Driver
- * This class manages the playback of an array of "event descriptors". For details on the
- * contents of an "event descriptor", see {@link Ext.ux.event.Recorder}. The events recorded by the
- * {@link Ext.ux.event.Recorder} class are designed to serve as input for this class.
- * 
- * The simplest use of this class is to instantiate it with an {@link #eventQueue} and call
- * {@link #method-start}. Like so:
- *
- *      var player = Ext.create('Ext.ux.event.Player', {
- *          eventQueue: [ ... ],
- *          speed: 2,  // play at 2x speed
- *          listeners: {
- *              stop: function() {
- *                  player = null; // all done
- *              }
- *          }
- *      });
- *
- *      player.start();
- *
- * A more complex use would be to incorporate keyframe generation after playing certain
- * events.
- *
- *      var player = Ext.create('Ext.ux.event.Player', {
- *          eventQueue: [ ... ],
- *          keyFrameEvents: {
- *              click: true
- *          },
- *          listeners: {
- *              stop: function() {
- *                  // play has completed... probably time for another keyframe...
- *                  player = null;
- *              },
- *              keyframe: onKeyFrame
- *          }
- *      });
- *
- *      player.start();
- *
- * If a keyframe can be handled immediately (synchronously), the listener would be:
- *
- *      function onKeyFrame () {
- *          handleKeyFrame();
- *      }
- *
- *  If the keyframe event is always handled asynchronously, then the event listener is only
- *  a bit more:
- *
- *      function onKeyFrame (p, eventDescriptor) {
- *          eventDescriptor.defer(); // pause event playback...
- *
- *          handleKeyFrame(function() {
- *              eventDescriptor.finish(); // ...resume event playback
- *          });
- *      }
- *
- * Finally, if the keyframe could be either handled synchronously or asynchronously (perhaps
- * differently by browser), a slightly more complex listener is required.
- *
- *      function onKeyFrame (p, eventDescriptor) {
- *          var async;
- *
- *          handleKeyFrame(function() {
- *              // either this callback is being called immediately by handleKeyFrame (in
- *              // which case async is undefined) or it is being called later (in which case
- *              // async will be true).
- *
- *              if (async) {
- *                  eventDescriptor.finish();
- *              }
- *              else {
- *                  async = false;
- *              }
- *          });
- *
- *          // either the callback was called (and async is now false) or it was not
- *          // called (and async remains undefined).
- *
- *          if (async !== false) {
- *              eventDescriptor.defer();
- *              async = true; // let the callback know that we have gone async
- *          }
- *      }
- */
-Ext.define('Ext.ux.event.Player', function(Player) {
-/* eslint-disable indent, vars-on-top, one-var */
-var defaults = {},
-    mouseEvents = {},
-    keyEvents = {},
-    doc,
-    uiEvents = {},
-    bubbleEvents = {
-        resize: 1,
-        reset: 1,
-        submit: 1,
-        change: 1,
-        select: 1,
-        error: 1,
-        abort: 1
-    };
-Ext.each([ 'click', 'dblclick', 'mouseover', 'mouseout', 'mousedown', 'mouseup', 'mousemove' ],
-    function(type) {
-        bubbleEvents[type] = defaults[type] = mouseEvents[type] = {
-            bubbles: true,
-            cancelable: (type !== "mousemove"), // mousemove cannot be cancelled
-            detail: 1,
-            screenX: 0,
-            screenY: 0,
-            clientX: 0,
-            clientY: 0,
-            ctrlKey: false,
-            altKey: false,
-            shiftKey: false,
-            metaKey: false,
-            button: 0
-        };
-    });
-Ext.each([ 'keydown', 'keyup', 'keypress' ],
-    function(type) {
-        bubbleEvents[type] = defaults[type] = keyEvents[type] = {
-            bubbles: true,
-            cancelable: true,
-            ctrlKey: false,
-            altKey: false,
-            shiftKey: false,
-            metaKey: false,
-            keyCode: 0,
-            charCode: 0
-        };
-    });
-Ext.each([ 'blur', 'change', 'focus', 'resize', 'scroll', 'select' ],
-    function(type) {
-        defaults[type] = uiEvents[type] = {
-            bubbles: (type in bubbleEvents),
-            cancelable: false,
-            detail: 1
-        };
-    });
-var inputSpecialKeys = {
-        8: function(target, start, end) { // backspace: 8,
-            if (start < end) {
-                target.value = target.value.substring(0, start) +
-                               target.value.substring(end);
-            }
-            else if (start > 0) {
-                target.value = target.value.substring(0, --start) +
-                               target.value.substring(end);
-            }
-            this.setTextSelection(target, start, start);
-        },
-        46: function(target, start, end) { // delete: 46
-            if (start < end) {
-                target.value = target.value.substring(0, start) +
-                               target.value.substring(end);
-            }
-            else if (start < target.value.length - 1) {
-                target.value = target.value.substring(0, start) +
-                               target.value.substring(start + 1);
-            }
-            this.setTextSelection(target, start, start);
-        }
-    };
-return {
-    extend: 'Ext.ux.event.Driver',
-    /**
-     * @cfg {Array} eventQueue The event queue to playback. This must be provided before
-     * the {@link #method-start} method is called.
-     */
-    /**
-     * @cfg {Object} keyFrameEvents An object that describes the events that should generate
-     * keyframe events. For example, `{ click: true }` would generate keyframe events after
-     * each `click` event.
-     */
-    keyFrameEvents: {
-        click: true
-    },
-    /**
-     * @cfg {Boolean} pauseForAnimations True to pause event playback during animations, false
-     * to ignore animations. Default is true.
-     */
-    pauseForAnimations: true,
-    /**
-     * @cfg {Number} speed The playback speed multiplier. Default is 1.0 (to playback at the
-     * recorded speed). A value of 2 would playback at 2x speed.
-     */
-    speed: 1.0,
-    stallTime: 0,
-    _inputSpecialKeys: {
-        INPUT: inputSpecialKeys,
-        TEXTAREA: Ext.apply({
-        }, inputSpecialKeys)
-    },
-    tagPathRegEx: /(\w+)(?:\[(\d+)\])?/,
-    /**
-     * @event beforeplay
-     * Fires before an event is played.
-     * @param {Ext.ux.event.Player} this
-     * @param {Object} eventDescriptor The event descriptor about to be played.
-     */
-    /**
-     * @event keyframe
-     * Fires when this player reaches a keyframe. Typically, this is after events
-     * like `click` are injected and any resulting animations have been completed.
-     * @param {Ext.ux.event.Player} this
-     * @param {Object} eventDescriptor The keyframe event descriptor.
-     */
-    constructor: function(config) {
-        var me = this;
-        me.callParent(arguments);
-        me.timerFn = function() {
-            me.onTick();
-        };
-        me.attachTo = me.attachTo || window;
-        doc = me.attachTo.document;
-    },
-    /**
-     * Returns the element given is XPath-like description.
-     * @param {String} xpath The XPath-like description of the element.
-     * @return {HTMLElement}
-     */
-    getElementFromXPath: function(xpath) {
-        var me = this,
-            parts = xpath.split('/'),
-            regex = me.tagPathRegEx,
-            i, n, m, count, tag, child,
-            el = me.attachTo.document;
-        el = (parts[0] === '~') ? el.body : el.getElementById(parts[0].substring(1)); // remove '#'
-        for (i = 1, n = parts.length; el && i < n; ++i) {
-            m = regex.exec(parts[i]);
-            count = m[2] ? parseInt(m[2], 10) : 1;
-            tag = m[1].toUpperCase();
-            for (child = el.firstChild; child; child = child.nextSibling) {
-                if (child.tagName === tag) {
-                    if (count === 1) {
-                        break;
-                    }
-                    --count;
-                }
-            }
-            el = child;
-        }
-        return el;
-    },
-    offsetToRangeCharacterMove: function(el, offset) {
-        return offset - (el.value.slice(0, offset).split("\r\n").length - 1);
-    },
-    setTextSelection: function(el, startOffset, endOffset) {
-        var range, startCharMove;
-        if (startOffset < 0) {
-            startOffset += el.value.length;
-        }
-        if (endOffset == null) {
-            endOffset = startOffset;
-        }
-        if (endOffset < 0) {
-            endOffset += el.value.length;
-        }
-        if (typeof el.selectionStart === "number") {
-            el.selectionStart = startOffset;
-            el.selectionEnd = endOffset;
-        }
-        else {
-            range = el.createTextRange();
-            startCharMove = this.offsetToRangeCharacterMove(el, startOffset);
-            range.collapse(true);
-            if (startOffset === endOffset) {
-                range.move("character", startCharMove);
-            }
-            else {
-                range.moveEnd("character", this.offsetToRangeCharacterMove(el, endOffset));
-                range.moveStart("character", startCharMove);
-            }
-            range.select();
-        }
-    },
-    getTimeIndex: function() {
-        var t = this.getTimestamp() - this.stallTime;
-        return t * this.speed;
-    },
-    makeToken: function(eventDescriptor, signal) {
-        var me = this,
-            t0;
-        eventDescriptor[signal] = true;
-        eventDescriptor.defer = function() {
-            eventDescriptor[signal] = false;
-            t0 = me.getTime();
-        };
-        eventDescriptor.finish = function() {
-            eventDescriptor[signal] = true;
-            me.stallTime += me.getTime() - t0;
-            me.schedule();
-        };
-    },
-    /**
-     * This method is called after an event has been played to prepare for the next event.
-     * @param {Object} eventDescriptor The descriptor of the event just played.
-     */
-    nextEvent: function(eventDescriptor) {
-        var me = this,
-            index = ++me.queueIndex;
-        if (me.keyFrameEvents[eventDescriptor.type]) {
-            Ext.Array.insert(me.eventQueue, index, [
-                { keyframe: true, ts: eventDescriptor.ts }
-            ]);
-        }
-    },
-    /**
-     * This method returns the event descriptor at the front of the queue. This does not
-     * dequeue the event. Repeated calls return the same object (until {@link #nextEvent}
-     * is called).
-     */
-    peekEvent: function() {
-        return this.eventQueue[this.queueIndex] || null;
-    },
-    /**
-     * Replaces an event in the queue with an array of events. This is often used to roll
-     * up a multi-step pseudo-event and expand it just-in-time to be played. The process
-     * for doing this in a derived class would be this:
-     * 
-     *      Ext.define('My.Player', {
-     *          extend: 'Ext.ux.event.Player',
-     *
-     *          peekEvent: function() {
-     *              var event = this.callParent();
-     *
-     *              if (event.multiStepSpecial) {
-     *                  this.replaceEvent(null, [
-     *                      ... expand to actual events
-     *                  ]);
-     *
-     *                  event = this.callParent(); // get the new next event
-     *              }
-     *
-     *              return event;
-     *          }
-     *      });
-     * 
-     * This method ensures that the `beforeplay` hook (if any) from the replaced event is
-     * placed on the first new event and the `afterplay` hook (if any) is placed on the
-     * last new event.
-     * 
-     * @param {Number} index The queue index to replace. Pass `null` to replace the event
-     * at the current `queueIndex`.
-     * @param {Event[]} events The array of events with which to replace the specified
-     * event.
-     */
-    replaceEvent: function(index, events) {
-        for (var t, i = 0, n = events.length; i < n; ++i) {
-            if (i) {
-                t = events[i - 1];
-                delete t.afterplay;
-                delete t.screenshot;
-                delete events[i].beforeplay;
-            }
-        }
-        Ext.Array.replace(this.eventQueue, (index == null) ? this.queueIndex : index, 1, events);
-    },
-    /**
-     * This method dequeues and injects events until it has arrived at the time index. If
-     * no events are ready (based on the time index), this method does nothing.
-     * @return {Boolean} True if there is more to do; false if not (at least for now).
-     */
-    processEvents: function() {
-        var me = this,
-            animations = me.pauseForAnimations && me.attachTo.Ext.fx.Manager.items,
-            eventDescriptor;
-        while ((eventDescriptor = me.peekEvent()) !== null) {
-            if (animations && animations.getCount()) {
-                return true;
-            }
-            if (eventDescriptor.keyframe) {
-                if (!me.processKeyFrame(eventDescriptor)) {
-                    return false;
-                }
-                me.nextEvent(eventDescriptor);
-            }
-            else if (eventDescriptor.ts <= me.getTimeIndex() &&
-                       me.fireEvent('beforeplay', me, eventDescriptor) !== false &&
-                       me.playEvent(eventDescriptor)) {
-                me.nextEvent(eventDescriptor);
-            }
-            else {
-                return true;
-            }
-        }
-        me.stop();
-        return false;
-    },
-    /**
-     * This method is called when a keyframe is reached. This will fire the keyframe event.
-     * If the keyframe has been handled, true is returned. Otherwise, false is returned.
-     * @param {Object} eventDescriptor The event descriptor of the keyframe.
-     * @return {Boolean} True if the keyframe was handled, false if not.
-     */
-    processKeyFrame: function(eventDescriptor) {
-        var me = this;
-        if (!eventDescriptor.defer) {
-            me.makeToken(eventDescriptor, 'done');
-            me.fireEvent('keyframe', me, eventDescriptor);
-        }
-        return eventDescriptor.done;
-    },
-    /**
-     * Called to inject the given event on the specified target.
-     * @param {HTMLElement} target The target of the event.
-     * @param {Object} event The event to inject. The properties of this object should be
-     * those of standard DOM events but vary based on the `type` property. For details on
-     * event types and their properties, see the class documentation.
-     */
-    injectEvent: function(target, event) {
-        var me = this,
-            type = event.type,
-            options = Ext.apply({}, event, defaults[type]),
-            handler;
-        if (type === 'type') {
-            handler = me._inputSpecialKeys[target.tagName];
-            if (handler) {
-                return me.injectTypeInputEvent(target, event, handler);
-            }
-            return me.injectTypeEvent(target, event);
-        }
-        if (type === 'focus' && target.focus) {
-            target.focus();
-            return true;
-        }
-        if (type === 'blur' && target.blur) {
-            target.blur();
-            return true;
-        }
-        if (type === 'scroll') {
-            target.scrollLeft = event.pos[0];
-            target.scrollTop = event.pos[1];
-            return true;
-        }
-        if (type === 'mduclick') {
-            return me.injectEvent(target, Ext.applyIf({ type: 'mousedown' }, event)) &&
-                   me.injectEvent(target, Ext.applyIf({ type: 'mouseup' }, event)) &&
-                   me.injectEvent(target, Ext.applyIf({ type: 'click' }, event));
-        }
-        if (mouseEvents[type]) {
-            return Player.injectMouseEvent(target, options, me.attachTo);
-        }
-        if (keyEvents[type]) {
-            return Player.injectKeyEvent(target, options, me.attachTo);
-        }
-        if (uiEvents[type]) {
-            return Player.injectUIEvent(target, type,
-                options.bubbles,
-                options.cancelable,
-                options.view || me.attachTo,
-                options.detail);
-        }
-        return false;
-    },
-    injectTypeEvent: function(target, event) {
-        var me = this,
-            text = event.text,
-            xlat = [],
-            ch, chUp, i, n, upper;
-        if (text) {
-            delete event.text;
-            upper = text.toUpperCase();
-            for (i = 0, n = text.length; i < n; ++i) {
-                ch = text.charCodeAt(i);
-                chUp = upper.charCodeAt(i);
-                xlat.push(
-                    Ext.applyIf({ type: 'keydown', charCode: chUp, keyCode: chUp }, event),
-                    Ext.applyIf({ type: 'keypress', charCode: ch, keyCode: ch }, event),
-                    Ext.applyIf({ type: 'keyup', charCode: chUp, keyCode: chUp }, event)
-                );
-            }
-        }
-        else {
-            xlat.push(
-                Ext.applyIf({ type: 'keydown', charCode: event.keyCode }, event),
-                Ext.applyIf({ type: 'keyup', charCode: event.keyCode }, event)
-            );
-        }
-        for (i = 0, n = xlat.length; i < n; ++i) {
-            me.injectEvent(target, xlat[i]);
-        }
-        return true;
-    },
-    injectTypeInputEvent: function(target, event, handler) {
-        var me = this,
-            text = event.text,
-            sel, n;
-        if (handler) {
-            sel = me.getTextSelection(target);
-            if (text) {
-                n = sel[0];
-                target.value = target.value.substring(0, n) + text +
-                               target.value.substring(sel[1]);
-                n += text.length;
-                me.setTextSelection(target, n, n);
-            }
-            else {
-                if (!(handler = handler[event.keyCode])) {
-                    if ('caret' in event) {
-                        me.setTextSelection(target, event.caret, event.caret);
-                    }
-                    else if (event.selection) {
-                        me.setTextSelection(target, event.selection[0], event.selection[1]);
-                    }
-                    return me.injectTypeEvent(target, event);
-                }
-                handler.call(this, target, sel[0], sel[1]);
-                return true;
-            }
-        }
-        return true;
-    },
-    playEvent: function(eventDescriptor) {
-        var me = this,
-            target = me.getElementFromXPath(eventDescriptor.target),
-            event;
-        if (!target) {
-            return false;
-        }
-        if (!me.playEventHook(eventDescriptor, 'beforeplay')) {
-            return false;
-        }
-        if (!eventDescriptor.injected) {
-            eventDescriptor.injected = true;
-            event = me.translateEvent(eventDescriptor, target);
-            me.injectEvent(target, event);
-        }
-        return me.playEventHook(eventDescriptor, 'afterplay');
-    },
-    playEventHook: function(eventDescriptor, hookName) {
-        var me = this,
-            doneName = hookName + '.done',
-            firedName = hookName + '.fired',
-            hook = eventDescriptor[hookName];
-        if (hook && !eventDescriptor[doneName]) {
-            if (!eventDescriptor[firedName]) {
-                eventDescriptor[firedName] = true;
-                me.makeToken(eventDescriptor, doneName);
-                if (me.eventScope && Ext.isString(hook)) {
-                    hook = me.eventScope[hook];
-                }
-                if (hook) {
-                    hook.call(me.eventScope || me, eventDescriptor);
-                }
-            }
-            return false;
-        }
-        return true;
-    },
-    schedule: function() {
-        var me = this;
-        if (!me.timer) {
-            me.timer = Ext.defer(me.timerFn, 10);
-        }
-    },
-    _translateAcross: [
-        'type',
-        'button',
-        'charCode',
-        'keyCode',
-        'caret',
-        'pos',
-        'text',
-        'selection'
-    ],
-    translateEvent: function(eventDescriptor, target) {
-        var me = this,
-            event = {},
-            modKeys = eventDescriptor.modKeys || '',
-            names = me._translateAcross,
-            i = names.length,
-            name, xy;
-        while (i--) {
-            name = names[i];
-            if (name in eventDescriptor) {
-                event[name] = eventDescriptor[name];
-            }
-        }
-        event.altKey = modKeys.indexOf('A') > 0;
-        event.ctrlKey = modKeys.indexOf('C') > 0;
-        event.metaKey = modKeys.indexOf('M') > 0;
-        event.shiftKey = modKeys.indexOf('S') > 0;
-        if (target && 'x' in eventDescriptor) {
-            xy = Ext.fly(target).getXY();
-            xy[0] += eventDescriptor.x;
-            xy[1] += eventDescriptor.y;
-        }
-        else if ('x' in eventDescriptor) {
-            xy = [ eventDescriptor.x, eventDescriptor.y ];
-        }
-        else if ('px' in eventDescriptor) {
-            xy = [ eventDescriptor.px, eventDescriptor.py ];
-        }
-        if (xy) {
-            event.clientX = event.screenX = xy[0];
-            event.clientY = event.screenY = xy[1];
-        }
-        if (eventDescriptor.key) {
-            event.keyCode = me.specialKeysByName[eventDescriptor.key];
-        }
-        if (eventDescriptor.type === 'wheel') {
-            if ('onwheel' in me.attachTo.document) {
-                event.wheelX = eventDescriptor.dx;
-                event.wheelY = eventDescriptor.dy;
-            }
-            else {
-                event.type = 'mousewheel';
-                event.wheelDeltaX = -40 * eventDescriptor.dx;
-                event.wheelDeltaY = event.wheelDelta = -40 * eventDescriptor.dy;
-            }
-        }
-        return event;
-    },
-    onStart: function() {
-        var me = this;
-        me.queueIndex = 0;
-        me.schedule();
-    },
-    onStop: function() {
-        var me = this;
-        if (me.timer) {
-            Ext.undefer(me.timer);
-            me.timer = null;
-        }
-    },
-    onTick: function() {
-        var me = this;
-        me.timer = null;
-        if (me.processEvents()) {
-            me.schedule();
-        }
-    },
-    statics: {
-        ieButtonCodeMap: {
-            0: 1,
-            1: 4,
-            2: 2
-        },
-        /**
-         * Injects a key event using the given event information to populate the event
-         * object.
-         * 
-         * **Note:** `keydown` causes Safari 2.x to crash.
-         * 
-         * @param {HTMLElement} target The target of the given event.
-         * @param {Object} options Object object containing all of the event injection
-         * options.
-         * @param {String} options.type The type of event to fire. This can be any one of
-         * the following: `keyup`, `keydown` and `keypress`.
-         * @param {Boolean} [options.bubbles=true] `tru` if the event can be bubbled up.
-         * DOM Level 3 specifies that all key events bubble by default.
-         * @param {Boolean} [options.cancelable=true] `true` if the event can be canceled
-         * using `preventDefault`. DOM Level 3 specifies that all key events can be
-         * cancelled.
-         * @param {Boolean} [options.ctrlKey=false] `true` if one of the CTRL keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.altKey=false] `true` if one of the ALT keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.shiftKey=false] `true` if one of the SHIFT keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.metaKey=false] `true` if one of the META keys is
-         * pressed while the event is firing.
-         * @param {Number} [options.keyCode=0] The code for the key that is in use.
-         * @param {Number} [options.charCode=0] The Unicode code for the character 
-         * associated with the key being used.
-         * @param {Window} [view=window] The view containing the target. This is typically
-         * the window object.
-         * @private
-         */
-        injectKeyEvent: function(target, options, view) {
-            var type = options.type,
-                customEvent = null;
-            if (type === 'textevent') {
-                type = 'keypress';
-            }
-            view = view || window;
-            if (doc.createEvent) {
-                try {
-                    customEvent = doc.createEvent("KeyEvents");
-                    customEvent.initKeyEvent(type, options.bubbles, options.cancelable,
-                            view, options.ctrlKey, options.altKey, options.shiftKey,
-                            options.metaKey, options.keyCode, options.charCode);
-                }
-                catch (ex) {
-                    try {
-                        customEvent = doc.createEvent("Events");
-                    }
-                    catch (uierror) {
-                        customEvent = doc.createEvent("UIEvents");
-                    }
-                    finally {
-                        customEvent.initEvent(type, options.bubbles, options.cancelable);
-                        customEvent.view = view;
-                        customEvent.altKey = options.altKey;
-                        customEvent.ctrlKey = options.ctrlKey;
-                        customEvent.shiftKey = options.shiftKey;
-                        customEvent.metaKey = options.metaKey;
-                        customEvent.keyCode = options.keyCode;
-                        customEvent.charCode = options.charCode;
-                    }
-                }
-                target.dispatchEvent(customEvent);
-            }
-            else if (doc.createEventObject) { // IE
-                customEvent = doc.createEventObject();
-                customEvent.bubbles = options.bubbles;
-                customEvent.cancelable = options.cancelable;
-                customEvent.view = view;
-                customEvent.ctrlKey = options.ctrlKey;
-                customEvent.altKey = options.altKey;
-                customEvent.shiftKey = options.shiftKey;
-                customEvent.metaKey = options.metaKey;
-                customEvent.keyCode = (options.charCode > 0) ? options.charCode : options.keyCode;
-                target.fireEvent("on" + type, customEvent);
-            }
-            else {
-                return false;
-            }
-            return true;
-        },
-        /**
-         * Injects a mouse event using the given event information to populate the event
-         * object.
-         *
-         * @param {HTMLElement} target The target of the given event.
-         * @param {Object} options Object object containing all of the event injection
-         * options.
-         * @param {String} options.type The type of event to fire. This can be any one of
-         * the following: `click`, `dblclick`, `mousedown`, `mouseup`, `mouseout`,
-         * `mouseover` and `mousemove`.
-         * @param {Boolean} [options.bubbles=true] `tru` if the event can be bubbled up.
-         * DOM Level 2 specifies that all mouse events bubble by default.
-         * @param {Boolean} [options.cancelable=true] `true` if the event can be canceled
-         * using `preventDefault`. DOM Level 2 specifies that all mouse events except
-         * `mousemove` can be cancelled. This defaults to `false` for `mousemove`.
-         * @param {Boolean} [options.ctrlKey=false] `true` if one of the CTRL keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.altKey=false] `true` if one of the ALT keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.shiftKey=false] `true` if one of the SHIFT keys is
-         * pressed while the event is firing.
-         * @param {Boolean} [options.metaKey=false] `true` if one of the META keys is
-         * pressed while the event is firing.
-         * @param {Number} [options.detail=1] The number of times the mouse button has 
-         * been used.
-         * @param {Number} [options.screenX=0] The x-coordinate on the screen at which point
-         * the event occurred.
-         * @param {Number} [options.screenY=0] The y-coordinate on the screen at which point
-         * the event occurred.
-         * @param {Number} [options.clientX=0] The x-coordinate on the client at which point
-         * the event occurred.
-         * @param {Number} [options.clientY=0] The y-coordinate on the client at which point
-         * the event occurred.
-         * @param {Number} [options.button=0] The button being pressed while the event is
-         * executing. The value should be 0 for the primary mouse button (typically the
-         * left button), 1 for the tertiary mouse button (typically the middle button),
-         * and 2 for the secondary mouse button (typically the right button).
-         * @param {HTMLElement} [options.relatedTarget=null] For `mouseout` events, this
-         * is the element that the mouse has moved to. For `mouseover` events, this is
-         * the element that the mouse has moved from. This argument is ignored for all
-         * other events.
-         * @param {Window} [view=window] The view containing the target. This is typically
-         * the window object.
-         * @private
-         */
-        injectMouseEvent: function(target, options, view) {
-            var type = options.type,
-                customEvent = null;
-            view = view || window;
-            if (doc.createEvent) {
-                customEvent = doc.createEvent("MouseEvents");
-                if (customEvent.initMouseEvent) {
-                    customEvent.initMouseEvent(type, options.bubbles, options.cancelable,
-                            view, options.detail, options.screenX, options.screenY,
-                            options.clientX, options.clientY, options.ctrlKey,
-                            options.altKey, options.shiftKey, options.metaKey,
-                            options.button, options.relatedTarget);
-                }
-                else { // Safari
-                    customEvent = doc.createEvent("UIEvents");
-                    customEvent.initEvent(type, options.bubbles, options.cancelable);
-                    customEvent.view = view;
-                    customEvent.detail = options.detail;
-                    customEvent.screenX = options.screenX;
-                    customEvent.screenY = options.screenY;
-                    customEvent.clientX = options.clientX;
-                    customEvent.clientY = options.clientY;
-                    customEvent.ctrlKey = options.ctrlKey;
-                    customEvent.altKey = options.altKey;
-                    customEvent.metaKey = options.metaKey;
-                    customEvent.shiftKey = options.shiftKey;
-                    customEvent.button = options.button;
-                    customEvent.relatedTarget = options.relatedTarget;
-                }
-                /*
-                 * Check to see if relatedTarget has been assigned. Firefox
-                 * versions less than 2.0 don't allow it to be assigned via
-                 * initMouseEvent() and the property is readonly after event
-                 * creation, so in order to keep YAHOO.util.getRelatedTarget()
-                 * working, assign to the IE proprietary toElement property
-                 * for mouseout event and fromElement property for mouseover
-                 * event.
-                 */
-                if (options.relatedTarget && !customEvent.relatedTarget) {
-                    if (type === "mouseout") {
-                        customEvent.toElement = options.relatedTarget;
-                    }
-                    else if (type === "mouseover") {
-                        customEvent.fromElement = options.relatedTarget;
-                    }
-                }
-                target.dispatchEvent(customEvent);
-            }
-            else if (doc.createEventObject) { // IE
-                customEvent = doc.createEventObject();
-                customEvent.bubbles = options.bubbles;
-                customEvent.cancelable = options.cancelable;
-                customEvent.view = view;
-                customEvent.detail = options.detail;
-                customEvent.screenX = options.screenX;
-                customEvent.screenY = options.screenY;
-                customEvent.clientX = options.clientX;
-                customEvent.clientY = options.clientY;
-                customEvent.ctrlKey = options.ctrlKey;
-                customEvent.altKey = options.altKey;
-                customEvent.metaKey = options.metaKey;
-                customEvent.shiftKey = options.shiftKey;
-                customEvent.button = Player.ieButtonCodeMap[options.button] || 0;
-                /*
-                 * Have to use relatedTarget because IE won't allow assignment
-                 * to toElement or fromElement on generic events. This keeps
-                 * YAHOO.util.customEvent.getRelatedTarget() functional.
-                 */
-                customEvent.relatedTarget = options.relatedTarget;
-                target.fireEvent('on' + type, customEvent);
-            }
-            else {
-                return false;
-            }
-            return true;
-        },
-        /**
-         * Injects a UI event using the given event information to populate the event
-         * object.
-         * 
-         * @param {HTMLElement} target The target of the given event.
-         * @param {Object} options
-         * @param {String} options.type The type of event to fire. This can be any one of
-         * the following: `click`, `dblclick`, `mousedown`, `mouseup`, `mouseout`,
-         * `mouseover` and `mousemove`.
-         * @param {Boolean} [options.bubbles=true] `tru` if the event can be bubbled up.
-         * DOM Level 2 specifies that all mouse events bubble by default.
-         * @param {Boolean} [options.cancelable=true] `true` if the event can be canceled
-         * using `preventDefault`. DOM Level 2 specifies that all mouse events except
-         * `mousemove` can be canceled. This defaults to `false` for `mousemove`.
-         * @param {Number} [options.detail=1] The number of times the mouse button has been
-         * used.
-         * @param {Window} [view=window] The view containing the target. This is typically
-         * the window object.
-         * @private
-         */
-        injectUIEvent: function(target, options, view) {
-            var customEvent = null;
-            view = view || window;
-            if (doc.createEvent) {
-                customEvent = doc.createEvent("UIEvents");
-                customEvent.initUIEvent(options.type, options.bubbles, options.cancelable,
-                        view, options.detail);
-                target.dispatchEvent(customEvent);
-            }
-            else if (doc.createEventObject) { // IE
-                customEvent = doc.createEventObject();
-                customEvent.bubbles = options.bubbles;
-                customEvent.cancelable = options.cancelable;
-                customEvent.view = view;
-                customEvent.detail = options.detail;
-                target.fireEvent("on" + options.type, customEvent);
-            }
-            else {
-                return false;
-            }
-            return true;
-        }
-    } // statics
-};
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/event/Recorder.js
+++ b//dev/null
@@ -1,408 +0,0 @@
-/**
- * @extends Ext.ux.event.Driver
- * Event recorder.
- */
-Ext.define('Ext.ux.event.Recorder', function(Recorder) {
-    var eventsToRecord, eventKey;
-    function apply() {
-        var a = arguments,
-            n = a.length,
-            obj = { kind: 'other' },
-            i;
-        for (i = 0; i < n; ++i) {
-            Ext.apply(obj, arguments[i]);
-        }
-        if (obj.alt && !obj.event) {
-            obj.event = obj.alt;
-        }
-        return obj;
-    }
-    function key(extra) {
-        return apply({
-            kind: 'keyboard',
-            modKeys: true,
-            key: true
-        }, extra);
-    }
-    function mouse(extra) {
-        return apply({
-            kind: 'mouse',
-            button: true,
-            modKeys: true,
-            xy: true
-        }, extra);
-    }
-    eventsToRecord = {
-        keydown: key(),
-        keypress: key(),
-        keyup: key(),
-        dragmove: mouse({ alt: 'mousemove', pageCoords: true, whileDrag: true }),
-        mousemove: mouse({ pageCoords: true }),
-        mouseover: mouse(),
-        mouseout: mouse(),
-        click: mouse(),
-        wheel: mouse({ wheel: true }),
-        mousedown: mouse({ press: true }),
-        mouseup: mouse({ release: true }),
-        scroll: apply({ listen: false }),
-        focus: apply(),
-        blur: apply()
-    };
-    for (eventKey in eventsToRecord) {
-        if (!eventsToRecord[eventKey].event) {
-            eventsToRecord[eventKey].event = eventKey;
-        }
-    }
-    eventsToRecord.wheel.event = null; // must detect later
-    return {
-        extend: 'Ext.ux.event.Driver',
-        /**
-         * @event add
-         * Fires when an event is added to the recording.
-         * @param {Ext.ux.event.Recorder} this
-         * @param {Object} eventDescriptor The event descriptor.
-         */
-        /**
-         * @event coalesce
-         * Fires when an event is coalesced. This edits the tail of the recorded
-         * event list.
-         * @param {Ext.ux.event.Recorder} this
-         * @param {Object} eventDescriptor The event descriptor that was coalesced.
-         */
-        eventsToRecord: eventsToRecord,
-        ignoreIdRegEx: /ext-gen(?:\d+)/,
-        inputRe: /^(input|textarea)$/i,
-        constructor: function(config) {
-            var me = this,
-                events = config && config.eventsToRecord;
-            if (events) {
-                me.eventsToRecord = Ext.apply(Ext.apply({}, me.eventsToRecord), // duplicate
-                                              events); // and merge
-                delete config.eventsToRecord; // don't smash
-            }
-            me.callParent(arguments);
-            me.clear();
-            me.modKeys = [];
-            me.attachTo = me.attachTo || window;
-        },
-        clear: function() {
-            this.eventsRecorded = [];
-        },
-        listenToEvent: function(event) {
-            var me = this,
-                el = me.attachTo.document.body,
-                fn = function() {
-                    return me.onEvent.apply(me, arguments);
-                },
-                cleaner = {};
-            if (el.attachEvent && el.ownerDocument.documentMode < 10) {
-                event = 'on' + event;
-                el.attachEvent(event, fn);
-                cleaner.destroy = function() {
-                    if (fn) {
-                        el.detachEvent(event, fn);
-                        fn = null;
-                    }
-                };
-            }
-            else {
-                el.addEventListener(event, fn, true);
-                cleaner.destroy = function() {
-                    if (fn) {
-                        el.removeEventListener(event, fn, true);
-                        fn = null;
-                    }
-                };
-            }
-            return cleaner;
-        },
-        coalesce: function(rec, ev) {
-            var me = this,
-                events = me.eventsRecorded,
-                length = events.length,
-                tail = length && events[length - 1],
-                tail2 = (length > 1) && events[length - 2],
-                tail3 = (length > 2) && events[length - 3];
-            if (!tail) {
-                return false;
-            }
-            if (rec.type === 'mousemove') {
-                if (tail.type === 'mousemove' && rec.ts - tail.ts < 200) {
-                    rec.ts = tail.ts;
-                    events[length - 1] = rec;
-                    return true;
-                }
-            }
-            else if (rec.type === 'click') {
-                if (tail2 && tail.type === 'mouseup' && tail2.type === 'mousedown') {
-                    if (rec.button === tail.button && rec.button === tail2.button &&
-                            rec.target === tail.target && rec.target === tail2.target &&
-                            me.samePt(rec, tail) && me.samePt(rec, tail2)) {
-                        events.pop(); // remove mouseup
-                        tail2.type = 'mduclick';
-                        return true;
-                    }
-                }
-            }
-            else if (rec.type === 'keyup') {
-                if (tail2 && tail.type === 'keypress' && tail2.type === 'keydown') {
-                    if (rec.target === tail.target && rec.target === tail2.target) {
-                        events.pop(); // remove keypress
-                        tail2.type = 'type';
-                        tail2.text = String.fromCharCode(tail.charCode);
-                        delete tail2.charCode;
-                        delete tail2.keyCode;
-                        if (tail3 && tail3.type === 'type') {
-                            if (tail3.text && tail3.target === tail2.target) {
-                                tail3.text += tail2.text;
-                                events.pop();
-                            }
-                        }
-                        return true;
-                    }
-                }
-                else if (me.completeKeyStroke(tail, rec)) {
-                    tail.type = 'type';
-                    me.completeSpecialKeyStroke(ev.target, tail, rec);
-                    return true;
-                }
-                else if (tail.type === 'scroll' && me.completeKeyStroke(tail2, rec)) {
-                    tail2.type = 'type';
-                    me.completeSpecialKeyStroke(ev.target, tail2, rec);
-                    events.pop();
-                    events.pop();
-                    events.push(tail, tail2);
-                    return true;
-                }
-            }
-            return false;
-        },
-        completeKeyStroke: function(down, up) {
-            if (down && down.type === 'keydown' && down.keyCode === up.keyCode) {
-                delete down.charCode;
-                return true;
-            }
-            return false;
-        },
-        completeSpecialKeyStroke: function(target, down, up) {
-            var key = this.specialKeysByCode[up.keyCode];
-            if (key && this.inputRe.test(target.tagName)) {
-                delete down.keyCode;
-                down.key = key;
-                down.selection = this.getTextSelection(target);
-                if (down.selection[0] === down.selection[1]) {
-                    down.caret = down.selection[0];
-                    delete down.selection;
-                }
-                return true;
-            }
-            return false;
-        },
-        getElementXPath: function(el) {
-            var me = this,
-                good = false,
-                xpath = [],
-                count,
-                sibling,
-                t,
-                tag;
-            for (t = el; t; t = t.parentNode) {
-                if (t === me.attachTo.document.body) {
-                    xpath.unshift('~');
-                    good = true;
-                    break;
-                }
-                if (t.id && !me.ignoreIdRegEx.test(t.id)) {
-                    xpath.unshift('#' + t.id);
-                    good = true;
-                    break;
-                }
-                for (count = 1, sibling = t; !!(sibling = sibling.previousSibling);) {
-                    if (sibling.tagName === t.tagName) {
-                        ++count;
-                    }
-                }
-                tag = t.tagName.toLowerCase();
-                if (count < 2) {
-                    xpath.unshift(tag);
-                }
-                else {
-                    xpath.unshift(tag + '[' + count + ']');
-                }
-            }
-            return good ? xpath.join('/') : null;
-        },
-        getRecordedEvents: function() {
-            return this.eventsRecorded;
-        },
-        onEvent: function(ev) {
-            var me = this,
-                e = new Ext.event.Event(ev),
-                info = me.eventsToRecord[e.type],
-                root,
-                modKeys, elXY,
-                rec = {
-                    type: e.type,
-                    ts: me.getTimestamp(),
-                    target: me.getElementXPath(e.target)
-                },
-                xy;
-            if (!info || !rec.target) {
-                return;
-            }
-            root = e.target.ownerDocument;
-            root = root.defaultView || root.parentWindow; // Standards || IE
-            if (root !== me.attachTo) {
-                return;
-            }
-            if (me.eventsToRecord.scroll) {
-                me.syncScroll(e.target);
-            }
-            if (info.xy) {
-                xy = e.getXY();
-                if (info.pageCoords || !rec.target) {
-                    rec.px = xy[0];
-                    rec.py = xy[1];
-                }
-                else {
-                    elXY = Ext.fly(e.getTarget()).getXY();
-                    xy[0] -= elXY[0];
-                    xy[1] -= elXY[1];
-                    rec.x = xy[0];
-                    rec.y = xy[1];
-                }
-            }
-            if (info.button) {
-                if ('buttons' in ev) {
-                    rec.button = ev.buttons; // LEFT=1, RIGHT=2, MIDDLE=4, etc.
-                }
-                else {
-                    rec.button = ev.button;
-                }
-                if (!rec.button && info.whileDrag) {
-                    return;
-                }
-            }
-            if (info.wheel) {
-                rec.type = 'wheel';
-                if (info.event === 'wheel') {
-                    rec.dx = ev.deltaX;
-                    rec.dy = ev.deltaY;
-                }
-                else if (typeof ev.wheelDeltaX === 'number') {
-                    rec.dx = -1 / 40 * ev.wheelDeltaX;
-                    rec.dy = -1 / 40 * ev.wheelDeltaY;
-                }
-                else if (ev.wheelDelta) {
-                    rec.dy = -1 / 40 * ev.wheelDelta;
-                }
-                else if (ev.detail) {
-                    rec.dy = ev.detail;
-                }
-            }
-            if (info.modKeys) {
-                me.modKeys[0] = e.altKey ? 'A' : '';
-                me.modKeys[1] = e.ctrlKey ? 'C' : '';
-                me.modKeys[2] = e.metaKey ? 'M' : '';
-                me.modKeys[3] = e.shiftKey ? 'S' : '';
-                modKeys = me.modKeys.join('');
-                if (modKeys) {
-                    rec.modKeys = modKeys;
-                }
-            }
-            if (info.key) {
-                rec.charCode = e.getCharCode();
-                rec.keyCode = e.getKey();
-            }
-            if (me.coalesce(rec, e)) {
-                me.fireEvent('coalesce', me, rec);
-            }
-            else {
-                me.eventsRecorded.push(rec);
-                me.fireEvent('add', me, rec);
-            }
-        },
-        onStart: function() {
-            var me = this,
-                ddm = me.attachTo.Ext.dd.DragDropManager,
-                evproto = me.attachTo.Ext.EventObjectImpl.prototype,
-                special = [];
-            Recorder.prototype.eventsToRecord.wheel.event =
-                    ('onwheel' in me.attachTo.document) ? 'wheel' : 'mousewheel';
-            me.listeners = [];
-            Ext.Object.each(me.eventsToRecord, function(name, value) {
-                if (value && value.listen !== false) {
-                    if (!value.event) {
-                        value.event = name;
-                    }
-                    if (value.alt && value.alt !== name) {
-                        if (!me.eventsToRecord[value.alt]) {
-                            special.push(value);
-                        }
-                    }
-                    else {
-                        me.listeners.push(me.listenToEvent(value.event));
-                    }
-                }
-            });
-            Ext.each(special, function(info) {
-                me.eventsToRecord[info.alt] = info;
-                me.listeners.push(me.listenToEvent(info.alt));
-            });
-            me.ddmStopEvent = ddm.stopEvent;
-            ddm.stopEvent = Ext.Function.createSequence(ddm.stopEvent, function(e) {
-                me.onEvent(e);
-            });
-            me.evStopEvent = evproto.stopEvent;
-            evproto.stopEvent = Ext.Function.createSequence(evproto.stopEvent, function() {
-                me.onEvent(this);
-            });
-        },
-        onStop: function() {
-            var me = this;
-            Ext.destroy(me.listeners);
-            me.listeners = null;
-            me.attachTo.Ext.dd.DragDropManager.stopEvent = me.ddmStopEvent;
-            me.attachTo.Ext.EventObjectImpl.prototype.stopEvent = me.evStopEvent;
-        },
-        samePt: function(pt1, pt2) {
-            return pt1.x === pt2.x && pt1.y === pt2.y;
-        },
-        syncScroll: function(el) {
-            var me = this,
-                ts = me.getTimestamp(),
-                oldX, oldY, x, y, scrolled, rec, p;
-            for (p = el; p; p = p.parentNode) {
-                oldX = p.$lastScrollLeft;
-                oldY = p.$lastScrollTop;
-                x = p.scrollLeft;
-                y = p.scrollTop;
-                scrolled = false;
-                if (oldX !== x) {
-                    if (x) {
-                        scrolled = true;
-                    }
-                    p.$lastScrollLeft = x;
-                }
-                if (oldY !== y) {
-                    if (y) {
-                        scrolled = true;
-                    }
-                    p.$lastScrollTop = y;
-                }
-                if (scrolled) {
-                    me.eventsRecorded.push(rec = {
-                        type: 'scroll',
-                        target: me.getElementXPath(p),
-                        ts: ts,
-                        pos: [ x, y ]
-                    });
-                    me.fireEvent('add', me, rec);
-                }
-                if (p.tagName === 'BODY') {
-                    break;
-                }
-            }
-        }
-    };
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/Gauge.js
+++ b//dev/null
@@ -1,1045 +0,0 @@
-/**
- * Displays a value within the given interval as a gauge. For example:
- *
- *     @example
- *     Ext.create({
- *         xtype: 'panel',
- *         renderTo: document.body,
- *         width: 200,
- *         height: 200,
- *         layout: 'fit',
- *         items: {
- *             xtype: 'gauge',
- *             padding: 20,
- *             value: 55,
- *             minValue: 40,
- *             maxValue: 80
- *         }
- *     });
- *
- * It's also possible to use gauges to create loading indicators:
- *
- *     @example
- *     Ext.create({
- *         xtype: 'panel',
- *         renderTo: document.body,
- *         width: 200,
- *         height: 200,
- *         layout: 'fit',
- *         items: {
- *             xtype: 'gauge',
- *             padding: 20,
- *             trackStart: 0,
- *             trackLength: 360,
- *             value: 20,
- *             valueStyle: {
- *                 round: true
- *             },
- *             textTpl: 'Loading...',
- *             animation: {
- *                 easing: 'linear',
- *                 duration: 100000
- *             }
- *         }
- *     }).items.first().setAngleOffset(360 * 100);
- * 
- * Gauges can contain needles as well.
- * 
- *      @example
- *      Ext.create({
- *         xtype: 'panel',
- *         renderTo: document.body,
- *         width: 200,
- *         height: 200,
- *         layout: 'fit',
- *         items: {
- *             xtype: 'gauge',
- *             padding: 20,
- *             value: 55,
- *             minValue: 40,
- *             maxValue: 80,
- *             needle: 'wedge'
- *         }
- *     });
- * 
- */
-Ext.define('Ext.ux.gauge.Gauge', {
-    alternateClassName: 'Ext.ux.Gauge',
-    extend: 'Ext.Gadget',
-    xtype: 'gauge',
-    requires: [
-        'Ext.ux.gauge.needle.Abstract',
-        'Ext.util.Region'
-    ],
-    config: {
-        /**
-         * @cfg {Number/String} padding
-         * Gauge sector padding in pixels or percent of width/height, whichever is smaller.
-         */
-        padding: 10,
-        /**
-         * @cfg {Number} trackStart
-         * The angle in the [0, 360) interval at which the gauge's track sector starts.
-         * E.g. 0 for 3 o-clock, 90 for 6 o-clock, 180 for 9 o-clock, 270 for noon.
-         */
-        trackStart: 135,
-        /**
-         * @cfg {Number} trackLength
-         * The angle in the (0, 360] interval to add to the {@link #trackStart} angle
-         * to determine the angle at which the track ends.
-         */
-        trackLength: 270,
-        /**
-         * @cfg {Number} angleOffset
-         * The angle at which the {@link #minValue} starts in case of a circular gauge.
-         */
-        angleOffset: 0,
-        /**
-         * @cfg {Number} minValue
-         * The minimum value that the gauge can represent.
-         */
-        minValue: 0,
-        /**
-         * @cfg {Number} maxValue
-         * The maximum value that the gauge can represent.
-         */
-        maxValue: 100,
-        /**
-         * @cfg {Number} value
-         * The current value of the gauge.
-         */
-        value: 50,
-        /**
-         * @cfg {Ext.ux.gauge.needle.Abstract} needle
-         * A config object for the needle to be used by the gauge.
-         * The needle will track the current {@link #value}.
-         * The default needle type is 'diamond', so if a config like
-         *
-         *     needle: {
-         *         outerRadius: '100%'
-         *     }
-         *
-         * is used, the app/view still has to require
-         * the `Ext.ux.gauge.needle.Diamond` class.
-         * If a type is specified explicitly
-         *
-         *     needle: {
-         *         type: 'arrow'
-         *     }
-         *
-         * it's straightforward which class should be required.
-         */
-        needle: null,
-        needleDefaults: {
-            cached: true,
-            $value: {
-                type: 'diamond'
-            }
-        },
-        /**
-         * @cfg {Boolean} [clockwise=true]
-         * `true` - {@link #cfg!value} increments in a clockwise fashion
-         * `false` - {@link #cfg!value} increments in an anticlockwise fashion
-         */
-        clockwise: true,
-        /**
-         * @cfg {Ext.XTemplate} textTpl
-         * The template for the text in the center of the gauge.
-         * The available data values are:
-         * - `value` - The {@link #cfg!value} of the gauge.
-         * - `percent` - The value as a percentage between 0 and 100.
-         * - `minValue` - The value of the {@link #cfg!minValue} config.
-         * - `maxValue` - The value of the {@link #cfg!maxValue} config.
-         * - `delta` - The delta between the {@link #cfg!minValue} and {@link #cfg!maxValue}.
-         */
-        textTpl: ['<tpl>{value:number("0.00")}%</tpl>'],
-        /**
-         * @cfg {String} [textAlign='c-c']
-         * If the gauge has a donut hole, the text will be centered inside it.
-         * Otherwise, the text will be centered in the middle of the gauge's
-         * bounding box. This config allows to alter the position of the text
-         * in the latter case. See the docs for the `align` option to the
-         * {@link Ext.util.Region#alignTo} method for possible ways of alignment
-         * of the text to the guage's bounding box.
-         */
-        textAlign: 'c-c',
-        /**
-         * @cfg {Object} textOffset
-         * This config can be used to displace the {@link #textTpl text} from its default
-         * position in the center of the gauge by providing values for horizontal and
-         * vertical displacement.
-         * @cfg {Number} textOffset.dx Horizontal displacement.
-         * @cfg {Number} textOffset.dy Vertical displacement.
-         */
-        textOffset: {
-            dx: 0,
-            dy: 0
-        },
-        /**
-         * @cfg {Object} trackStyle
-         * Track sector styles.
-         * @cfg {String/Object[]} trackStyle.fill Track sector fill color. Defaults to CSS value.
-         * It's also possible to have a linear gradient fill that starts at the top-left corner
-         * of the gauge and ends at its bottom-right corner, by providing an array of color stop
-         * objects. For example:
-         *
-         *     trackStyle: {
-         *         fill: [{
-         *             offset: 0,
-         *             color: 'green',
-         *             opacity: 0.8
-         *         }, {
-         *             offset: 1,
-         *             color: 'gold'
-         *         }]
-         *     }
-         *
-         * @cfg {Number} trackStyle.fillOpacity Track sector fill opacity. Defaults to CSS value.
-         * @cfg {String} trackStyle.stroke Track sector stroke color. Defaults to CSS value.
-         * @cfg {Number} trackStyle.strokeOpacity Track sector stroke opacity.
-         * Defaults to CSS value.
-         * @cfg {Number} trackStyle.strokeWidth Track sector stroke width. Defaults to CSS value.
-         * @cfg {Number/String} [trackStyle.outerRadius='100%'] The outer radius of the track
-         * sector.
-         * For example:
-         *
-         *     outerRadius: '90%',      // 90% of the maximum radius
-         *     outerRadius: 100,        // radius of 100 pixels
-         *     outerRadius: '70% + 5',  // 70% of the maximum radius plus 5 pixels
-         *     outerRadius: '80% - 10', // 80% of the maximum radius minus 10 pixels
-         *
-         * @cfg {Number/String} [trackStyle.innerRadius='50%'] The inner radius of the track sector.
-         * See the `trackStyle.outerRadius` config documentation for more information.
-         * @cfg {Boolean} [trackStyle.round=false] Whether to round the track sector edges or not.
-         */
-        trackStyle: {
-            outerRadius: '100%',
-            innerRadius: '100% - 20',
-            round: false
-        },
-        /**
-         * @cfg {Object} valueStyle
-         * Value sector styles.
-         * @cfg {String/Object[]} valueStyle.fill Value sector fill color. Defaults to CSS value.
-         * See the `trackStyle.fill` config documentation for more information.
-         * @cfg {Number} valueStyle.fillOpacity Value sector fill opacity. Defaults to CSS value.
-         * @cfg {String} valueStyle.stroke Value sector stroke color. Defaults to CSS value.
-         * @cfg {Number} valueStyle.strokeOpacity Value sector stroke opacity. Defaults to
-         * CSS value.
-         * @cfg {Number} valueStyle.strokeWidth Value sector stroke width. Defaults to CSS value.
-         * @cfg {Number/String} [valueStyle.outerRadius='100% - 4'] The outer radius of the value
-         * sector.
-         * See the `trackStyle.outerRadius` config documentation for more information.
-         * @cfg {Number/String} [valueStyle.innerRadius='50% + 4'] The inner radius of the value
-         * sector.
-         * See the `trackStyle.outerRadius` config documentation for more information.
-         * @cfg {Boolean} [valueStyle.round=false] Whether to round the value sector edges or not.
-         */
-        valueStyle: {
-            outerRadius: '100% - 2',
-            innerRadius: '100% - 18',
-            round: false
-        },
-        /**
-         * @cfg {Object/Boolean} [animation=true]
-         * The animation applied to the gauge on changes to the {@link #value}
-         * and the {@link #angleOffset} configs. Defaults to 1 second animation
-         * with the  'out' easing.
-         * @cfg {Number} animation.duration The duraction of the animation.
-         * @cfg {String} animation.easing The easing function to use for the animation.
-         * Possible values are:
-         * - `linear` - no easing, no acceleration
-         * - `in` - accelerating from zero velocity
-         * - `out` - (default) decelerating to zero velocity
-         * - `inOut` - acceleration until halfway, then deceleration
-         */
-        animation: true
-    },
-    baseCls: Ext.baseCSSPrefix + 'gauge',
-    template: [{
-        reference: 'bodyElement',
-        children: [{
-            reference: 'textElement',
-            cls: Ext.baseCSSPrefix + 'gauge-text'
-        }]
-    }],
-    defaultBindProperty: 'value',
-    pathAttributes: {
-        fill: true,
-        fillOpacity: true,
-        stroke: true,
-        strokeOpacity: true,
-        strokeWidth: true
-    },
-    easings: {
-        linear: Ext.identityFn,
-        'in': function(t) {
-            return t * t * t;
-        },
-        out: function(t) {
-            return (--t) * t * t + 1;
-        },
-        inOut: function(t) {
-            return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;
-        }
-    },
-    resizeDelay: 0,   // in milliseconds
-    resizeTimerId: 0,
-    size: null,       // cached size
-    svgNS: 'http://www.w3.org/2000/svg',
-    svg: null,        // SVG document
-    defs: null,       // the `defs` section of the SVG document
-    trackArc: null,
-    valueArc: null,
-    trackGradient: null,
-    valueGradient: null,
-    fx: null,         // either the `value` or the `angleOffset` animation
-    fxValue: 0,       // the actual value rendered/animated
-    fxAngleOffset: 0,
-    constructor: function(config) {
-        var me = this;
-        me.fitSectorInRectCache = {
-            startAngle: null,
-            lengthAngle: null,
-            minX: null,
-            maxX: null,
-            minY: null,
-            maxY: null
-        };
-        me.interpolator = me.createInterpolator();
-        me.callParent([config]);
-        me.el.on('resize', 'onElementResize', me);
-    },
-    doDestroy: function() {
-        var me = this;
-        Ext.undefer(me.resizeTimerId);
-        me.el.un('resize', 'onElementResize', me);
-        me.stopAnimation();
-        me.setNeedle(null);
-        me.trackGradient = Ext.destroy(me.trackGradient);
-        me.valueGradient = Ext.destroy(me.valueGradient);
-        me.defs = Ext.destroy(me.defs);
-        me.svg = Ext.destroy(me.svg);
-        me.callParent();
-    },
-    afterComponentLayout: function(width, height, oldWidth, oldHeight) {
-        this.callParent([width, height, oldWidth, oldHeight]);
-        if (Ext.isIE9) {
-            this.handleResize();
-        }
-    },
-    onElementResize: function(element, size) {
-        this.handleResize(size);
-    },
-    handleResize: function(size, instantly) {
-        var me = this,
-            el = me.element;
-        if (!(el && (size = size || el.getSize()) && size.width && size.height)) {
-            return;
-        }
-        me.resizeTimerId = Ext.undefer(me.resizeTimerId);
-        if (!instantly && me.resizeDelay) {
-            me.resizeTimerId = Ext.defer(me.handleResize, me.resizeDelay, me, [size, true]);
-            return;
-        }
-        me.size = size;
-        me.resizeHandler(size);
-    },
-    updateMinValue: function(minValue) {
-        var me = this;
-        me.interpolator.setDomain(minValue, me.getMaxValue());
-        if (!me.isConfiguring) {
-            me.render();
-        }
-    },
-    updateMaxValue: function(maxValue) {
-        var me = this;
-        me.interpolator.setDomain(me.getMinValue(), maxValue);
-        if (!me.isConfiguring) {
-            me.render();
-        }
-    },
-    updateAngleOffset: function(angleOffset, oldAngleOffset) {
-        var me = this,
-            animation = me.getAnimation();
-        me.fxAngleOffset = angleOffset;
-        if (me.isConfiguring) {
-            return;
-        }
-        if (animation.duration) {
-            me.animate(
-                oldAngleOffset, angleOffset,
-                animation.duration, me.easings[animation.easing],
-                function(angleOffset) {
-                    me.fxAngleOffset = angleOffset;
-                    me.render();
-                }
-            );
-        }
-        else {
-            me.render();
-        }
-    },
-    applyTrackStart: function(trackStart) {
-        if (trackStart < 0 || trackStart >= 360) {
-            Ext.raise("'trackStart' should be within [0, 360).");
-        }
-        return trackStart;
-    },
-    applyTrackLength: function(trackLength) {
-        if (trackLength <= 0 || trackLength > 360) {
-            Ext.raise("'trackLength' should be within (0, 360].");
-        }
-        return trackLength;
-    },
-    updateTrackStart: function(trackStart) {
-        var me = this;
-        if (!me.isConfiguring) {
-            me.render();
-        }
-    },
-    updateTrackLength: function(trackLength) {
-        var me = this;
-        me.interpolator.setRange(0, trackLength);
-        if (!me.isConfiguring) {
-            me.render();
-        }
-    },
-    applyPadding: function(padding) {
-        var ratio;
-        if (typeof padding === 'string') {
-            ratio = parseFloat(padding) / 100;
-            return function(x) {
-                return x * ratio;
-            };
-        }
-        return function() {
-            return padding;
-        };
-    },
-    updatePadding: function() {
-        if (!this.isConfiguring) {
-            this.render();
-        }
-    },
-    applyValue: function(value) {
-        var minValue = this.getMinValue(),
-            maxValue = this.getMaxValue();
-        return Math.min(Math.max(value, minValue), maxValue);
-    },
-    updateValue: function(value, oldValue) {
-        var me = this,
-            animation = me.getAnimation();
-        me.fxValue = value;
-        if (me.isConfiguring) {
-            return;
-        }
-        me.writeText();
-        if (animation.duration) {
-            me.animate(
-                oldValue, value,
-                animation.duration, me.easings[animation.easing],
-                function(value) {
-                    me.fxValue = value;
-                    me.render();
-                }
-            );
-        }
-        else {
-            me.render();
-        }
-    },
-    applyTextTpl: function(textTpl) {
-        if (textTpl && !textTpl.isTemplate) {
-            textTpl = new Ext.XTemplate(textTpl);
-        }
-        return textTpl;
-    },
-    applyTextOffset: function(offset) {
-        offset = offset || {};
-        offset.dx = offset.dx || 0;
-        offset.dy = offset.dy || 0;
-        return offset;
-    },
-    updateTextTpl: function() {
-        this.writeText();
-        if (!this.isConfiguring) {
-            this.centerText(); // text will be centered on first size
-        }
-    },
-    writeText: function(options) {
-        var me = this,
-            value = me.getValue(),
-            minValue = me.getMinValue(),
-            maxValue = me.getMaxValue(),
-            delta = maxValue - minValue,
-            textTpl = me.getTextTpl();
-        textTpl.overwrite(me.textElement, {
-            value: value,
-            percent: (value - minValue) / delta * 100,
-            minValue: minValue,
-            maxValue: maxValue,
-            delta: delta
-        });
-    },
-    centerText: function(cx, cy, sectorRegion, innerRadius, outerRadius) {
-        var textElement = this.textElement,
-            textAlign = this.getTextAlign(),
-            alignedRegion, textBox;
-        if (Ext.Number.isEqual(innerRadius, 0, 0.1) ||
-            sectorRegion.isOutOfBound({ x: cx, y: cy })) {
-            alignedRegion = textElement.getRegion().alignTo({
-                align: textAlign, // align text region's center to sector region's center
-                target: sectorRegion
-            });
-            textElement.setLeft(alignedRegion.left);
-            textElement.setTop(alignedRegion.top);
-        }
-        else {
-            textBox = textElement.getBox();
-            textElement.setLeft(cx - textBox.width / 2);
-            textElement.setTop(cy - textBox.height / 2);
-        }
-    },
-    camelCaseRe: /([a-z])([A-Z])/g,
-    /**
-     * @private
-     */
-    camelToHyphen: function(name) {
-        return name.replace(this.camelCaseRe, '$1-$2').toLowerCase();
-    },
-    applyTrackStyle: function(trackStyle) {
-        var me = this,
-            trackGradient;
-        trackStyle.innerRadius = me.getRadiusFn(trackStyle.innerRadius);
-        trackStyle.outerRadius = me.getRadiusFn(trackStyle.outerRadius);
-        if (Ext.isArray(trackStyle.fill)) {
-            trackGradient = me.getTrackGradient();
-            me.setGradientStops(trackGradient, trackStyle.fill);
-            trackStyle.fill = 'url(#' + trackGradient.dom.getAttribute('id') + ')';
-        }
-        return trackStyle;
-    },
-    updateTrackStyle: function(trackStyle) {
-        var me = this,
-            trackArc = Ext.fly(me.getTrackArc()),
-            name;
-        for (name in trackStyle) {
-            if (name in me.pathAttributes) {
-                trackArc.setStyle(me.camelToHyphen(name), trackStyle[name]);
-            }
-            else {
-                trackArc.setStyle(name, trackStyle[name]);
-            }
-        }
-    },
-    applyValueStyle: function(valueStyle) {
-        var me = this,
-            valueGradient;
-        valueStyle.innerRadius = me.getRadiusFn(valueStyle.innerRadius);
-        valueStyle.outerRadius = me.getRadiusFn(valueStyle.outerRadius);
-        if (Ext.isArray(valueStyle.fill)) {
-            valueGradient = me.getValueGradient();
-            me.setGradientStops(valueGradient, valueStyle.fill);
-            valueStyle.fill = 'url(#' + valueGradient.dom.getAttribute('id') + ')';
-        }
-        return valueStyle;
-    },
-    updateValueStyle: function(valueStyle) {
-        var me = this,
-            valueArc = Ext.fly(me.getValueArc()),
-            name;
-        for (name in valueStyle) {
-            if (name in me.pathAttributes) {
-                valueArc.setStyle(me.camelToHyphen(name), valueStyle[name]);
-            }
-            else {
-                valueArc.setStyle(name, valueStyle[name]);
-            }
-        }
-    },
-    /**
-     * @private
-     */
-    getRadiusFn: function(radius) {
-        var result, pos, ratio,
-            increment = 0;
-        if (Ext.isNumber(radius)) {
-            result = function() {
-                return radius;
-            };
-        }
-        else if (Ext.isString(radius)) {
-            radius = radius.replace(/ /g, '');
-            ratio = parseFloat(radius) / 100;
-            pos = radius.search('%'); // E.g. '100% - 4'
-            if (pos < radius.length - 1) {
-                increment = parseFloat(radius.substr(pos + 1));
-            }
-            result = function(radius) {
-                return radius * ratio + increment;
-            };
-            result.ratio = ratio;
-        }
-        return result;
-    },
-    getSvg: function() {
-        var me = this,
-            svg = me.svg;
-        if (!svg) {
-            svg = me.svg = Ext.get(document.createElementNS(me.svgNS, 'svg'));
-            me.bodyElement.append(svg);
-        }
-        return svg;
-    },
-    getTrackArc: function() {
-        var me = this,
-            trackArc = me.trackArc;
-        if (!trackArc) {
-            trackArc = me.trackArc = document.createElementNS(me.svgNS, 'path');
-            me.getSvg().append(trackArc, true);
-            trackArc.setAttribute('class', Ext.baseCSSPrefix + 'gauge-track');
-        }
-        return trackArc;
-    },
-    getValueArc: function() {
-        var me = this,
-            valueArc = me.valueArc;
-        me.getTrackArc(); // make sure the track arc is created first for proper draw order
-        if (!valueArc) {
-            valueArc = me.valueArc = document.createElementNS(me.svgNS, 'path');
-            me.getSvg().append(valueArc, true);
-            valueArc.setAttribute('class', Ext.baseCSSPrefix + 'gauge-value');
-        }
-        return valueArc;
-    },
-    applyNeedle: function(needle, oldNeedle) {
-        this.getValueArc();
-        return Ext.Factory.gaugeNeedle.update(oldNeedle, needle,
-                                              this, 'createNeedle', 'needleDefaults');
-    },
-    createNeedle: function(config) {
-        return Ext.apply({
-            gauge: this
-        }, config);
-    },
-    getDefs: function() {
-        var me = this,
-            defs = me.defs;
-        if (!defs) {
-            defs = me.defs = Ext.get(document.createElementNS(me.svgNS, 'defs'));
-            me.getSvg().appendChild(defs);
-        }
-        return defs;
-    },
-    /**
-     * @private
-     */
-    setGradientSize: function(gradient, x1, y1, x2, y2) {
-        gradient.setAttribute('x1', x1);
-        gradient.setAttribute('y1', y1);
-        gradient.setAttribute('x2', x2);
-        gradient.setAttribute('y2', y2);
-    },
-    /**
-     * @private
-     */
-    resizeGradients: function(size) {
-        var me = this,
-            trackGradient = me.getTrackGradient(),
-            valueGradient = me.getValueGradient(),
-            x1 = 0,
-            y1 = size.height / 2,
-            x2 = size.width,
-            y2 = size.height / 2;
-        me.setGradientSize(trackGradient.dom, x1, y1, x2, y2);
-        me.setGradientSize(valueGradient.dom, x1, y1, x2, y2);
-    },
-    /**
-     * @private
-     */
-    setGradientStops: function(gradient, stops) {
-        var ln = stops.length,
-            i, stopCfg, stopEl;
-        while (gradient.firstChild) {
-            gradient.removeChild(gradient.firstChild);
-        }
-        for (i = 0; i < ln; i++) {
-            stopCfg = stops[i];
-            stopEl = document.createElementNS(this.svgNS, 'stop');
-            gradient.appendChild(stopEl);
-            stopEl.setAttribute('offset', stopCfg.offset);
-            stopEl.setAttribute('stop-color', stopCfg.color);
-            if ('opacity' in stopCfg) {
-                stopEl.setAttribute('stop-opacity', stopCfg.opacity);
-            }
-        }
-    },
-    getTrackGradient: function() {
-        var me = this,
-            trackGradient = me.trackGradient;
-        if (!trackGradient) {
-            trackGradient = me.trackGradient =
-                Ext.get(document.createElementNS(me.svgNS, 'linearGradient'));
-            trackGradient.dom.setAttribute('gradientUnits', 'userSpaceOnUse');
-            me.getDefs().appendChild(trackGradient);
-            Ext.get(trackGradient); // assign unique ID
-        }
-        return trackGradient;
-    },
-    getValueGradient: function() {
-        var me = this,
-            valueGradient = me.valueGradient;
-        if (!valueGradient) {
-            valueGradient = me.valueGradient =
-                Ext.get(document.createElementNS(me.svgNS, 'linearGradient'));
-            valueGradient.dom.setAttribute('gradientUnits', 'userSpaceOnUse');
-            me.getDefs().appendChild(valueGradient);
-            Ext.get(valueGradient); // assign unique ID
-        }
-        return valueGradient;
-    },
-    getArcPoint: function(centerX, centerY, radius, degrees) {
-        var radians = degrees / 180 * Math.PI;
-        return [
-            centerX + radius * Math.cos(radians),
-            centerY + radius * Math.sin(radians)
-        ];
-    },
-    isCircle: function(startAngle, endAngle) {
-        return Ext.Number.isEqual(Math.abs(endAngle - startAngle), 360, 0.001);
-    },
-    getArcPath: function(centerX, centerY, innerRadius, outerRadius, startAngle, endAngle, round) {
-        var me = this,
-            isCircle = me.isCircle(startAngle, endAngle),
-            endAngle = endAngle - 0.01, // eslint-disable-line no-redeclare
-            innerStartPoint = me.getArcPoint(centerX, centerY, innerRadius, startAngle),
-            innerEndPoint = me.getArcPoint(centerX, centerY, innerRadius, endAngle),
-            outerStartPoint = me.getArcPoint(centerX, centerY, outerRadius, startAngle),
-            outerEndPoint = me.getArcPoint(centerX, centerY, outerRadius, endAngle),
-            large = endAngle - startAngle <= 180 ? 0 : 1,
-            path = [
-                'M', innerStartPoint[0], innerStartPoint[1],
-                'A', innerRadius, innerRadius, 0, large, 1, innerEndPoint[0], innerEndPoint[1]
-            ],
-            capRadius = (outerRadius - innerRadius) / 2;
-        if (isCircle) {
-            path.push('M', outerEndPoint[0], outerEndPoint[1]);
-        }
-        else {
-            if (round) {
-                path.push('A', capRadius, capRadius, 0, 0, 0, outerEndPoint[0], outerEndPoint[1]);
-            }
-            else {
-                path.push('L', outerEndPoint[0], outerEndPoint[1]);
-            }
-        }
-        path.push('A', outerRadius, outerRadius, 0, large, 0, outerStartPoint[0],
-                  outerStartPoint[1]);
-        if (round && !isCircle) {
-            path.push('A', capRadius, capRadius, 0, 0, 0, innerStartPoint[0], innerStartPoint[1]);
-        }
-        path.push('Z');
-        return path.join(' ');
-    },
-    resizeHandler: function(size) {
-        var me = this,
-            svg = me.getSvg();
-        svg.setSize(size);
-        me.resizeGradients(size);
-        me.render();
-    },
-    /**
-     * @private
-     * Creates a linear interpolator function that itself has a few methods:
-     * - `setDomain(from, to)`
-     * - `setRange(from, to)`
-     * - `getDomain` - returns the domain as a [from, to] array
-     * - `getRange` - returns the range as a [from, to] array
-     * @param {Boolean} [rangeCheck=false]
-     * Whether to allow out of bounds values for domain and range.
-     * @return {Function} The interpolator function:
-     * `interpolator(domainValue, isInvert)`.
-     * If the `isInvert` parameter is `true`, the start of domain will correspond
-     * to the end of range. This is useful, for example, when you want to render
-     * increasing domain values counter-clockwise instead of clockwise.
-     */
-    createInterpolator: function(rangeCheck) {
-        var domainStart = 0,
-            domainDelta = 1,
-            rangeStart = 0,
-            rangeEnd = 1,
-            interpolator = function(x, invert) {
-                var t = 0;
-                if (domainDelta) {
-                    t = (x - domainStart) / domainDelta;
-                    if (rangeCheck) {
-                        t = Math.max(0, t);
-                        t = Math.min(1, t);
-                    }
-                    if (invert) {
-                        t = 1 - t;
-                    }
-                }
-                return (1 - t) * rangeStart + t * rangeEnd;
-            };
-        interpolator.setDomain = function(a, b) {
-            domainStart = a;
-            domainDelta = b - a;
-            return this;
-        };
-        interpolator.setRange = function(a, b) {
-            rangeStart = a;
-            rangeEnd = b;
-            return this;
-        };
-        interpolator.getDomain = function() {
-            return [domainStart, domainStart + domainDelta];
-        };
-        interpolator.getRange = function() {
-            return [rangeStart, rangeEnd];
-        };
-        return interpolator;
-    },
-    applyAnimation: function(animation) {
-        if (true === animation) {
-            animation = {};
-        }
-        else if (false === animation) {
-            animation = {
-                duration: 0
-            };
-        }
-        if (!('duration' in animation)) {
-            animation.duration = 1000;
-        }
-        if (!(animation.easing in this.easings)) {
-            animation.easing = 'out';
-        }
-        return animation;
-    },
-    updateAnimation: function() {
-        this.stopAnimation();
-    },
-    /**
-     * @private
-     * @param {Number} from
-     * @param {Number} to
-     * @param {Number} duration
-     * @param {Function} easing
-     * @param {Function} fn Function to execute on every frame of animation.
-     * The function takes a single parameter - the value in the [from, to]
-     * range, interpolated based on current time and easing function.
-     * With certain easings, the value may overshoot the range slighly.
-     * @param {Object} scope
-     */
-    animate: function(from, to, duration, easing, fn, scope) {
-        var me = this,
-            start = Ext.now(),
-            interpolator = me.createInterpolator().setRange(from, to);
-        function frame() {
-            var now = Ext.AnimationQueue.frameStartTime,
-                t = Math.min(now - start, duration) / duration,
-                value = interpolator(easing(t));
-            if (scope) {
-                if (typeof fn === 'string') {
-                    scope[fn].call(scope, value);
-                }
-                else {
-                    fn.call(scope, value);
-                }
-            }
-            else {
-                fn(value);
-            }
-            if (t >= 1) {
-                Ext.AnimationQueue.stop(frame, scope);
-                me.fx = null;
-            }
-        }
-        me.stopAnimation();
-        Ext.AnimationQueue.start(frame, scope);
-        me.fx = {
-            frame: frame,
-            scope: scope
-        };
-    },
-    /**
-     * Stops the current {@link #value} or {@link #angleOffset} animation.
-     */
-    stopAnimation: function() {
-        var me = this;
-        if (me.fx) {
-            Ext.AnimationQueue.stop(me.fx.frame, me.fx.scope);
-            me.fx = null;
-        }
-    },
-    unitCircleExtrema: {
-        0: [1, 0],
-        90: [0, 1],
-        180: [-1, 0],
-        270: [0, -1],
-        360: [1, 0],
-        450: [0, 1],
-        540: [-1, 0],
-        630: [0, -1]
-    },
-    /**
-     * @private
-     */
-    getUnitSectorExtrema: function(startAngle, lengthAngle) {
-        var extrema = this.unitCircleExtrema,
-            points = [],
-            angle;
-        for (angle in extrema) {
-            if (angle > startAngle && angle < startAngle + lengthAngle) {
-                points.push(extrema[angle]);
-            }
-        }
-        return points;
-    },
-    /**
-     * @private
-     * Given a rect with a known width and height, find the maximum radius of the donut
-     * sector that can fit into it, as well as the center point of such a sector.
-     * The end and start angles of the sector are also known, as well as the relationship
-     * between the inner and outer radii.
-     */
-    fitSectorInRect: function(width, height, startAngle, lengthAngle, ratio) {
-        if (Ext.Number.isEqual(lengthAngle, 360, 0.001)) {
-            return {
-                cx: width / 2,
-                cy: height / 2,
-                radius: Math.min(width, height) / 2,
-                region: new Ext.util.Region(0, width, height, 0)
-            };
-        }
-        var me = this,
-            points, xx, yy, minX, maxX, minY, maxY,
-            cache = me.fitSectorInRectCache,
-            sameAngles = cache.startAngle === startAngle && cache.lengthAngle === lengthAngle;
-        if (sameAngles) {
-            minX = cache.minX;
-            maxX = cache.maxX;
-            minY = cache.minY;
-            maxY = cache.maxY;
-        }
-        else {
-            points = me.getUnitSectorExtrema(startAngle, lengthAngle).concat([
-                me.getArcPoint(0, 0, 1, startAngle),
-                me.getArcPoint(0, 0, ratio, startAngle),
-                me.getArcPoint(0, 0, 1, startAngle + lengthAngle),
-                me.getArcPoint(0, 0, ratio, startAngle + lengthAngle)
-            ]);
-            xx = points.map(function(point) {
-                return point[0];
-            });
-            yy = points.map(function(point) {
-                return point[1];
-            });
-            minX = Math.min.apply(null, xx);
-            maxX = Math.max.apply(null, xx);
-            minY = Math.min.apply(null, yy);
-            maxY = Math.max.apply(null, yy);
-            cache.startAngle = startAngle;
-            cache.lengthAngle = lengthAngle;
-            cache.minX = minX;
-            cache.maxX = maxX;
-            cache.minY = minY;
-            cache.maxY = maxY;
-        }
-        var sectorWidth = maxX - minX,
-            sectorHeight = maxY - minY,
-            scaleX = width / sectorWidth,
-            scaleY = height / sectorHeight,
-            scale = Math.min(scaleX, scaleY),
-            sectorRegion = new Ext.util.Region(minY * scale, maxX * scale, maxY * scale,
-                                               minX * scale),
-            rectRegion = new Ext.util.Region(0, width, height, 0),
-            alignedRegion = sectorRegion.alignTo({
-                align: 'c-c', // align sector region's center to rect region's center
-                target: rectRegion
-            }),
-            dx = alignedRegion.left - minX * scale,
-            dy = alignedRegion.top - minY * scale;
-        return {
-            cx: dx,
-            cy: dy,
-            radius: scale,
-            region: alignedRegion
-        };
-    },
-    /**
-     * @private
-     */
-    fitSectorInPaddedRect: function(width, height, padding, startAngle, lengthAngle, ratio) {
-        var result = this.fitSectorInRect(
-            width - padding * 2,
-            height - padding * 2,
-            startAngle, lengthAngle, ratio
-        );
-        result.cx += padding;
-        result.cy += padding;
-        result.region.translateBy(padding, padding);
-        return result;
-    },
-    /**
-     * @private
-     */
-    normalizeAngle: function(angle) {
-        return (angle % 360 + 360) % 360;
-    },
-    render: function() {
-        if (!this.size) {
-            return;
-        }
-        var me = this,
-            textOffset = me.getTextOffset(),
-            trackArc = me.getTrackArc(),
-            valueArc = me.getValueArc(),
-            needle = me.getNeedle(),
-            clockwise = me.getClockwise(),
-            value = me.fxValue,
-            angleOffset = me.fxAngleOffset,
-            trackLength = me.getTrackLength(),
-            width = me.size.width,
-            height = me.size.height,
-            paddingFn = me.getPadding(),
-            padding = paddingFn(Math.min(width, height)),
-            trackStart = me.normalizeAngle(me.getTrackStart() + angleOffset),
-            trackEnd = trackStart + trackLength,
-            valueLength = me.interpolator(value),
-            trackStyle = me.getTrackStyle(),
-            valueStyle = me.getValueStyle(),
-            sector = me.fitSectorInPaddedRect(
-                width, height, padding, trackStart, trackLength, trackStyle.innerRadius.ratio
-            ),
-            cx = sector.cx,
-            cy = sector.cy,
-            radius = sector.radius,
-            trackInnerRadius = Math.max(0, trackStyle.innerRadius(radius)),
-            trackOuterRadius = Math.max(0, trackStyle.outerRadius(radius)),
-            valueInnerRadius = Math.max(0, valueStyle.innerRadius(radius)),
-            valueOuterRadius = Math.max(0, valueStyle.outerRadius(radius)),
-            trackPath = me.getArcPath(
-                cx, cy, trackInnerRadius, trackOuterRadius, trackStart, trackEnd, trackStyle.round
-            ),
-            valuePath = me.getArcPath(
-                cx, cy, valueInnerRadius, valueOuterRadius,
-                clockwise ? trackStart : trackEnd - valueLength,
-                clockwise ? trackStart + valueLength : trackEnd,
-                valueStyle.round
-            );
-        me.centerText(
-            cx + textOffset.dx, cy + textOffset.dy,
-            sector.region, trackInnerRadius, trackOuterRadius
-        );
-        trackArc.setAttribute('d', trackPath);
-        valueArc.setAttribute('d', valuePath);
-        if (needle) {
-            needle.setRadius(radius);
-            needle.setTransform(cx, cy, -90 + trackStart + valueLength);
-        }
-        me.fireEvent('render', me);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Abstract.js
+++ b//dev/null
@@ -1,170 +0,0 @@
-/**
- * Describes a gauge needle as a shape defined in SVG path syntax.
- *
- * Note: this class and its subclasses are not supposed to be instantiated directly
- * - an object should be passed the gauge's {@link Ext.ux.gauge.Gauge#needle}
- * config instead. Needle instances are also not supposed to be moved
- * between gauges.
- */
-Ext.define('Ext.ux.gauge.needle.Abstract', {
-    mixins: [
-        'Ext.mixin.Factoryable'
-    ],
-    alias: 'gauge.needle.abstract',
-    isNeedle: true,
-    config: {
-        /**
-         * The generator function for the needle's shape.
-         * Because the gauge component is resizable, and it is generally
-         * desirable to resize the needle along with the gauge, the needle's
-         * shape should have an ability to grow, typically non-uniformly,
-         * which necessitates a generator function that will update the needle's
-         * path, so that its proportions are appropriate for the current gauge size.
-         *
-         * The generator function is given two parameters: the inner and outer
-         * radius of the needle. For example, for a straight arrow, the path
-         * definition is expected to have the base of the needle at the origin
-         * - (0, 0) coordinates - and point downwards. The needle will be automatically
-         * translated to the center of the gauge and rotated to represent the current
-         * gauge {@link Ext.ux.gauge.Gauge#value value}.
-         *
-         * @param {Function} path The path generator function.
-         * @param {Number} path.innerRadius The function's first parameter.
-         * @param {Number} path.outerRadius The function's second parameter.
-         * @return {String} path.return The shape of the needle in the SVG path syntax returned by
-         * the generator function.
-         */
-        path: null,
-        /**
-         * The inner radius of the needle. This works just like the `innerRadius`
-         * config of the {@link Ext.ux.gauge.Gauge#trackStyle}.
-         * The default value is `25` to make sure the needle doesn't overlap with
-         * the value of the gauge shown at its center by default.
-         *
-         * @param {Number/String} [innerRadius=25]
-         */
-        innerRadius: 25,
-        /**
-         * The outer radius of the needle. This works just like the `outerRadius`
-         * config of the {@link Ext.ux.gauge.Gauge#trackStyle}.
-         *
-         * @param {Number/String} [outerRadius='100% - 20']
-         */
-        outerRadius: '100% - 20',
-        /**
-         * The shape generated by the {@link #path} function is used as the value
-         * for the `d` attribute of the SVG `<path>` element. This element
-         * has the default class name of `.x-gauge-needle`, so that CSS can be used
-         * to give all gauge needles some common styling. To style a particular needle,
-         * one can use this config to add styles to the needle's `<path>` element directly,
-         * or use a custom {@link Ext.ux.gauge.Gauge#cls class} for the needle's gauge
-         * and style the needle from there.
-         *
-         * This config is not supposed to be updated manually, the styles should
-         * always be updated by the means of the `setStyle` call. For example,
-         * this is not allowed:
-         *
-         *     gauge.getStyle().fill = 'red';      // WRONG!
-         *     gauge.setStyle({ 'fill': 'red' });  // correct
-         *
-         * Subsequent calls to the `setStyle` will add to the styles set previously
-         * or overwrite their values, but won't remove them. If you'd like to style
-         * from a clean slate, setting the style to `null` first will remove the styles
-         * previously set:
-         *
-         *     gauge.getNeedle().setStyle(null);
-         *
-         * If an SVG shape was produced by a designer rather than programmatically,
-         * in other words, the {@link #path} function returns the same shape regardless
-         * of the parameters it was given, the uniform scaling of said shape is the only
-         * option, if one wants to use gauges of different sizes. In this case,
-         * it's possible to specify the desired scale by using the `transform` style,
-         * for example:
-         *
-         *     transform: 'scale(0.35)'
-         *
-         * @param {Object} style
-         */
-        style: null,
-        /**
-         * @private
-         * @param {Number} radius
-         */
-        radius: 0,
-        /**
-         * @private
-         * Expected in the initial config, required during construction.
-         * @param {Ext.ux.gauge.Gauge} gauge
-         */
-        gauge: null
-    },
-    constructor: function(config) {
-        this.initConfig(config);
-    },
-    applyInnerRadius: function(innerRadius) {
-        return this.getGauge().getRadiusFn(innerRadius);
-    },
-    applyOuterRadius: function(outerRadius) {
-        return this.getGauge().getRadiusFn(outerRadius);
-    },
-    updateRadius: function() {
-        this.regeneratePath();
-    },
-    setTransform: function(centerX, centerY, rotation) {
-        var needleGroup = this.getNeedleGroup();
-        needleGroup.setStyle(
-            'transform',
-            'translate(' + centerX + 'px,' + centerY + 'px) ' + 'rotate(' + rotation + 'deg)'
-        );
-    },
-    applyPath: function(path) {
-        return Ext.isFunction(path) ? path : null;
-    },
-    updatePath: function(path) {
-        this.regeneratePath(path);
-    },
-    regeneratePath: function(path) {
-        path = path || this.getPath();
-        var me = this,
-            radius = me.getRadius(),
-            inner = me.getInnerRadius()(radius),
-            outer = me.getOuterRadius()(radius),
-            d = outer > inner ? path(inner, outer) : '';
-        me.getNeedlePath().dom.setAttribute('d', d);
-    },
-    getNeedleGroup: function() {
-        var gauge = this.getGauge(),
-            group = this.needleGroup;
-        if (!group) {
-            group = this.needleGroup = Ext.get(document.createElementNS(gauge.svgNS, 'g'));
-            gauge.getSvg().appendChild(group);
-        }
-        return group;
-    },
-    getNeedlePath: function() {
-        var me = this,
-            pathElement = me.pathElement;
-        if (!pathElement) {
-            pathElement = me.pathElement =
-                Ext.get(document.createElementNS(me.getGauge().svgNS, 'path'));
-            pathElement.dom.setAttribute('class', Ext.baseCSSPrefix + 'gauge-needle');
-            me.getNeedleGroup().appendChild(pathElement);
-        }
-        return pathElement;
-    },
-    updateStyle: function(style) {
-        var pathElement = this.getNeedlePath();
-        if (Ext.isObject(style)) {
-            pathElement.setStyle(style);
-        }
-        else {
-            pathElement.dom.removeAttribute('style');
-        }
-    },
-    destroy: function() {
-        var me = this;
-        me.pathElement = Ext.destroy(me.pathElement);
-        me.needleGroup = Ext.destroy(me.needleGroup);
-        me.setGauge(null);
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Arrow.js
+++ b//dev/null
@@ -1,14 +0,0 @@
-Ext.define('Ext.ux.gauge.needle.Arrow', {
-    extend: 'Ext.ux.gauge.needle.Abstract',
-    alias: 'gauge.needle.arrow',
-    config: {
-        path: function(ir, or) {
-            return or - ir > 30
-                ? "M0," + (ir + 5) + " L-4," + ir + " L-4," + (ir + 10) + " L-1," +
-                  (ir + 15) + " L-1," + (or - 7) + " L-5," + (or - 10) + " L0," + or +
-                  " L5," + (or - 10) + " L1," + (or - 7) + " L1," + (ir + 15) +
-                  " L4," + (ir + 10) + " L4," + ir + " Z"
-                : '';
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Diamond.js
+++ b//dev/null
@@ -1,11 +0,0 @@
-Ext.define('Ext.ux.gauge.needle.Diamond', {
-    extend: 'Ext.ux.gauge.needle.Abstract',
-    alias: 'gauge.needle.diamond',
-    config: {
-        path: function(ir, or) {
-            return or - ir > 10
-                ? 'M0,' + ir + ' L-4,' + (ir + 5) + ' L0,' + or + ' L4,' + (ir + 5) + ' Z'
-                : '';
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Rectangle.js
+++ b//dev/null
@@ -1,11 +0,0 @@
-Ext.define('Ext.ux.gauge.needle.Rectangle', {
-    extend: 'Ext.ux.gauge.needle.Abstract',
-    alias: 'gauge.needle.rectangle',
-    config: {
-        path: function(ir, or) {
-            return or - ir > 10
-                ? "M-2," + ir + " L2," + ir + " L2," + or + " L-2," + or + " Z"
-                : '';
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Spike.js
+++ b//dev/null
@@ -1,11 +0,0 @@
-Ext.define('Ext.ux.gauge.needle.Spike', {
-    extend: 'Ext.ux.gauge.needle.Abstract',
-    alias: 'gauge.needle.spike',
-    config: {
-        path: function(ir, or) {
-            return or - ir > 10
-                ? "M0," + (ir + 5) + " L-4," + ir + " L0," + or + " L4," + ir + " Z"
-                : '';
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/gauge/needle/Wedge.js
+++ b//dev/null
@@ -1,9 +0,0 @@
-Ext.define('Ext.ux.gauge.needle.Wedge', {
-    extend: 'Ext.ux.gauge.needle.Abstract',
-    alias: 'gauge.needle.wedge',
-    config: {
-        path: function(ir, or) {
-            return or - ir > 10 ? "M-4," + ir + " L0," + or + " L4," + ir + " Z" : '';
-        }
-    }
-});

--- a/bundles/AdminBundle/Resources/public/extjs/ext-ux/src/rating/Picker.js
+++ b//dev/null
@@ -1,414 +0,0 @@
-/**
- * A ratings picker based on `Ext.Gadget`.
- *
- *      @example
- *      Ext.create({
- *          xtype: 'rating',
- *          renderTo: Ext.getBody(),
- *          listeners: {
- *              change: function (picker, value) {
- *                 console.log('Rating ' + value);
- *              }
- *          }
- *      });
- */
-Ext.define('Ext.ux.rating.Picker', {
-    extend: 'Ext.Gadget',
-    xtype: 'rating',
-    focusable: true,
-    /*
-     * The "cachedConfig" block is basically the same as "config" except that these
-     * values are applied specially to the first instance of the class. After processing
-     * these configs, the resulting values are stored on the class `prototype` and the
-     * template DOM element also reflects these default values.
-     */
-    cachedConfig: {
-        /**
-         * @cfg {String} [family]
-         * The CSS `font-family` to use for displaying the `{@link #glyphs}`.
-         */
-        family: 'monospace',
-        /**
-         * @cfg {String/String[]/Number[]} [glyphs]
-         * Either a string containing the two glyph characters, or an array of two strings
-         * containing the individual glyph characters or an array of two numbers with the
-         * character codes for the individual glyphs.
-         *
-         * For example:
-         *
-         *      @example
-         *      Ext.create({
-         *          xtype: 'rating',
-         *          renderTo: Ext.getBody(),
-         *          glyphs: [ 9671, 9670 ], // '',
-         *          listeners: {
-         *              change: function (picker, value) {
-         *                 console.log('Rating ' + value);
-         *              }
-         *          }
-         *      });
-         */
-        glyphs: '',
-        /**
-         * @cfg {Number} [minimum=1]
-         * The minimum allowed `{@link #value}` (rating).
-         */
-        minimum: 1,
-        /**
-         * @cfg {Number} [limit]
-         * The maximum allowed `{@link #value}` (rating).
-         */
-        limit: 5,
-        /**
-         * @cfg {String/Object} [overStyle]
-         * Optional styles to apply to the rating glyphs when `{@link #trackOver}` is
-         * enabled.
-         */
-        overStyle: null,
-        /**
-         * @cfg {Number} [rounding=1]
-         * The rounding to apply to values. Common choices are 0.5 (for half-steps) or
-         * 0.25 (for quarter steps).
-         */
-        rounding: 1,
-        /**
-         * @cfg {String} [scale="125%"]
-         * The CSS `font-size` to apply to the glyphs. This value defaults to 125% because
-         * glyphs in the stock font tend to be too small. When using specially designed
-         * "icon fonts" you may want to set this to 100%.
-         */
-        scale: '125%',
-        /**
-         * @cfg {String/Object} [selectedStyle]
-         * Optional styles to apply to the rating value glyphs.
-         */
-        selectedStyle: null,
-        /**
-         * @cfg {Object/String/String[]/Ext.XTemplate/Function} tip
-         * A template or a function that produces the tooltip text. The `Object`, `String`
-         * and `String[]` forms are converted to an `Ext.XTemplate`. If a function is given,
-         * it will be called with an object parameter and should return the tooltip text.
-         * The object contains these properties:
-         *
-         *   - component: The rating component requesting the tooltip.
-         *   - tracking: The current value under the mouse cursor.
-         *   - trackOver: The value of the `{@link #trackOver}` config.
-         *   - value: The current value.
-         *
-         * Templates can use these properties to generate the proper text.
-         */
-        tip: null,
-        /**
-         * @cfg {Boolean} [trackOver=true]
-         * Determines if mouse movements should temporarily update the displayed value.
-         * The actual `value` is only updated on `click` but this rather acts as the
-         * "preview" of the value prior to click.
-         */
-        trackOver: true,
-        /**
-         * @cfg {Number} value
-         * The rating value. This value is bounded by `minimum` and `limit` and is also
-         * adjusted by the `rounding`.
-         */
-        value: null,
-        /**
-         * @cfg {String} tooltipText
-         * The current tooltip text. This value is set into the DOM by the updater (hence
-         * only when it changes). This is intended for use by the tip manager
-         * (`{@link Ext.tip.QuickTipManager}`). Developers should never need to set this
-         * config since it is handled by virtue of setting other configs (such as the
-         * {@link #tooltip} or the {@link #value}.).
-         * @private
-         */
-        tooltipText: null,
-        /**
-         * @cfg {Number} trackingValue
-         * This config is used to when `trackOver` is `true` and represents the tracked
-         * value. This config is maintained by our `mousemove` handler. This should not
-         * need to be set directly by user code.
-         * @private
-         */
-        trackingValue: null
-    },
-    config: {
-        /**
-         * @cfg {Boolean/Object} [animate=false]
-         * Specifies an animation to use when changing the `{@link #value}`. When setting
-         * this config, it is probably best to set `{@link #trackOver}` to `false`.
-         */
-        animate: null
-    },
-    element: {
-        cls: 'u' + Ext.baseCSSPrefix + 'rating-picker',
-        reference: 'element',
-        children: [{
-            reference: 'innerEl',
-            cls: 'u' + Ext.baseCSSPrefix + 'rating-picker-inner',
-            listeners: {
-                click: 'onClick',
-                mousemove: 'onMouseMove',
-                mouseenter: 'onMouseEnter',
-                mouseleave: 'onMouseLeave'
-            },
-            children: [{
-                reference: 'valueEl',
-                cls: 'u' + Ext.baseCSSPrefix + 'rating-picker-value'
-            }, {
-                reference: 'trackerEl',
-                cls: 'u' + Ext.baseCSSPrefix + 'rating-picker-tracker'
-            }]
-        }]
-    },
-    defaultBindProperty: 'value',
-    twoWayBindable: 'value',
-    overCls: 'u' + Ext.baseCSSPrefix + 'rating-picker-over',
-    trackOverCls: 'u' + Ext.baseCSSPrefix + 'rating-picker-track-over',
-    applyGlyphs: function(value) {
-        if (typeof value === 'string') {
-            if (value.length !== 2) {
-                Ext.raise('Expected 2 characters for "glyphs" not "' + value + '".');
-            }
-            value = [ value.charAt(0), value.charAt(1) ];
-        }
-        else if (typeof value[0] === 'number') {
-            value = [
-                String.fromCharCode(value[0]),
-                String.fromCharCode(value[1])
-            ];
-        }
-        return value;
-    },
-    applyOverStyle: function(style) {
-        this.trackerEl.applyStyles(style);
-    },
-    applySelectedStyle: function(style) {
-        this.valueEl.applyStyles(style);
-    },
-    applyTip: function(tip) {
-        if (tip && typeof tip !== 'function') {
-            if (!tip.isTemplate) {
-                tip = new Ext.XTemplate(tip);
-            }
-            tip = tip.apply.bind(tip);
-        }
-        return tip;
-    },
-    applyTrackingValue: function(value) {
-        return this.applyValue(value); // same rounding as normal value
-    },
-    applyValue: function(v) {
-        var rounding, limit, min;
-        if (v !== null) {
-            rounding = this.getRounding();
-            limit = this.getLimit();
-            min = this.getMinimum();
-            v = Math.round(Math.round(v / rounding) * rounding * 1000) / 1000;
-            v = (v < min) ? min : (v > limit ? limit : v);
-        }
-        return v;
-    },
-    onClick: function(event) {
-        var value = this.valueFromEvent(event);
-        this.setValue(value);
-    },
-    onMouseEnter: function() {
-        this.element.addCls(this.overCls);
-    },
-    onMouseLeave: function() {
-        this.element.removeCls(this.overCls);
-    },
-    onMouseMove: function(event) {
-        var value = this.valueFromEvent(event);
-        this.setTrackingValue(value);
-    },
-    updateFamily: function(family) {
-        this.element.setStyle('fontFamily', "'" + family + "'");
-    },
-    updateGlyphs: function() {
-        this.refreshGlyphs();
-    },
-    updateLimit: function() {
-        this.refreshGlyphs();
-    },
-    updateScale: function(size) {
-        this.element.setStyle('fontSize', size);
-    },
-    updateTip: function() {
-        this.refreshTip();
-    },
-    updateTooltipText: function(text) {
-        this.setTooltip(text);  // modern only (replaced by classic override)
-    },
-    updateTrackingValue: function(value) {
-        var me = this,
-            trackerEl = me.trackerEl,
-            newWidth = me.valueToPercent(value);
-        trackerEl.setStyle('width', newWidth);
-        me.refreshTip();
-    },
-    updateTrackOver: function(trackOver) {
-        this.element.toggleCls(this.trackOverCls, trackOver);
-    },
-    updateValue: function(value, oldValue) {
-        var me = this,
-            animate = me.getAnimate(),
-            valueEl = me.valueEl,
-            newWidth = me.valueToPercent(value),
-            column, record;
-        if (me.isConfiguring || !animate) {
-            valueEl.setStyle('width', newWidth);
-        }
-        else {
-            valueEl.stopAnimation();
-            valueEl.animate(Ext.merge({
-                from: { width: me.valueToPercent(oldValue) },
-                to: { width: newWidth }
-            }, animate));
-        }
-        me.refreshTip();
-        if (!me.isConfiguring) {
-            if (me.hasListeners.change) {
-                me.fireEvent('change', me, value, oldValue);
-            }
-            column = me.getWidgetColumn && me.getWidgetColumn();
-            record = column && me.getWidgetRecord && me.getWidgetRecord();
-            if (record && column.dataIndex) {
-                record.set(column.dataIndex, value);
-            }
-        }
-    },
-    afterCachedConfig: function() {
-        this.refresh();
-        return this.callParent(arguments);
-    },
-    initConfig: function(instanceConfig) {
-        this.isConfiguring = true;
-        this.callParent([ instanceConfig ]);
-        this.refresh();
-    },
-    setConfig: function() {
-        var me = this;
-        me.isReconfiguring = true;
-        me.callParent(arguments);
-        me.isReconfiguring = false;
-        me.refresh();
-        return me;
-    },
-    privates: {
-        /**
-         * This method returns the DOM text node into which glyphs are placed.
-         * @param {HTMLElement} dom The DOM node parent of the text node.
-         * @return {HTMLElement} The text node.
-         * @private
-         */
-        getGlyphTextNode: function(dom) {
-            var node = dom.lastChild;
-            if (!node || node.nodeType !== 3) {
-                node = dom.ownerDocument.createTextNode('');
-                dom.appendChild(node);
-            }
-            return node;
-        },
-        getTooltipData: function() {
-            var me = this;
-            return {
-                component: me,
-                tracking: me.getTrackingValue(),
-                trackOver: me.getTrackOver(),
-                value: me.getValue()
-            };
-        },
-        /**
-         * Forcibly refreshes both glyph and tooltip rendering.
-         * @private
-         */
-        refresh: function() {
-            var me = this;
-            if (me.invalidGlyphs) {
-                me.refreshGlyphs(true);
-            }
-            if (me.invalidTip) {
-                me.refreshTip(true);
-            }
-        },
-        /**
-         * Refreshes the glyph text rendering unless we are currently performing a
-         * bulk config change (initConfig or setConfig).
-         * @param {Boolean} now Pass `true` to force the refresh to happen now.
-         * @private
-         */
-        refreshGlyphs: function(now) {
-            var me = this,
-                later = !now && (me.isConfiguring || me.isReconfiguring),
-                el, glyphs, limit, on, off, trackerEl, valueEl;
-            if (!later) {
-                el = me.getGlyphTextNode(me.innerEl.dom);
-                valueEl = me.getGlyphTextNode(me.valueEl.dom);
-                trackerEl = me.getGlyphTextNode(me.trackerEl.dom);
-                glyphs = me.getGlyphs();
-                limit = me.getLimit();
-                for (on = off = ''; limit--;) {
-                    off += glyphs[0];
-                    on += glyphs[1];
-                }
-                el.nodeValue = off;
-                valueEl.nodeValue = on;
-                trackerEl.nodeValue = on;
-            }
-            me.invalidGlyphs = later;
-        },
-        /**
-         * Refreshes the tooltip text rendering unless we are currently performing a
-         * bulk config change (initConfig or setConfig).
-         * @param {Boolean} now Pass `true` to force the refresh to happen now.
-         * @private
-         */
-        refreshTip: function(now) {
-            var me = this,
-                later = !now && (me.isConfiguring || me.isReconfiguring),
-                data, text, tooltip;
-            if (!later) {
-                tooltip = me.getTip();
-                if (tooltip) {
-                    data = me.getTooltipData();
-                    text = tooltip(data);
-                    me.setTooltipText(text);
-                }
-            }
-            me.invalidTip = later;
-        },
-        /**
-         * Convert the coordinates of the given `Event` into a rating value.
-         * @param {Ext.event.Event} event The event.
-         * @return {Number} The rating based on the given event coordinates.
-         * @private
-         */
-        valueFromEvent: function(event) {
-            var me = this,
-                el = me.innerEl,
-                ex = event.getX(),
-                rounding = me.getRounding(),
-                cx = el.getX(),
-                x = ex - cx,
-                w = el.getWidth(),
-                limit = me.getLimit(),
-                v;
-            if (me.getInherited().rtl) {
-                x = w - x;
-            }
-            v = x / w * limit;
-            v = Math.ceil(v / rounding) * rounding;
-            return v;
-        },
-        /**
-         * Convert the given rating into a width percentage.
-         * @param {Number} value The rating value to convert.
-         * @return {String} The width percentage to represent the given value.
-         * @private
-         */
-        valueToPercent: function(value) {
-            value = (value / this.getLimit()) * 100;
-            return value + '%';
-        }
-    }
-});
