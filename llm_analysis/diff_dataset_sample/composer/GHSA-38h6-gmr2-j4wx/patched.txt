# ====================================================================
# FILE: code/CapturedFormSubmission.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 45-84 ---
    45| 	public function getCMSFields()
    46| 	{
    47| 		$fields = parent::getCMSFields();
    48| 		$fields->removeByName(['CapturedFields', 'Type']);
    49| 		$fields->addFieldToTab("Root.Main", LiteralField::create('SubmissionName', '<h2>'. $this->Type . '</h2>'));
    50| 		$submittedFields = GridField::create('CapturedFields', 'Form Fields', $this->CapturedFields()->sort('Created', 'ASC'));
    51| 		$conf = GridFieldConfig::create();
    52| 		$conf->addComponent(new GridFieldDataColumns());
    53|         $conf->addComponent(new GridFieldExportButton());
    54|         $conf->addComponent(new GridFieldPrintButton());
    55| 		$submittedFields->setConfig($conf);
    56| 		$fields->addFieldToTab("Root.Main", $submittedFields);
    57| 		$fields->fieldByName('Root.Main')->setTitle($this->Type);
    58| 		return $fields;
    59| 	}
    60| 	public function Details() {
    61| 		$html = HTMLText::create();
    62| 		$toAdd = [];
    63| 		foreach($this->CapturedFields()->filter(['IsInDetails' => '1']) as $field) {
    64| 			if(!$field->Value) continue;
    65| 			$htmlEnt = '<strong>'. $field->Title .'</strong>: '. $field->dbObject('Value')->XML();
    66| 			array_push($toAdd, $htmlEnt);
    67| 		}
    68| 		$html->setValue(join('<br />', $toAdd));
    69| 		return $html;
    70| 	}
    71| 	/**
    72| 	 * Ensure that all linked fields are deleted
    73| 	 * so we don't leave any stale data behind
    74| 	 */
    75| 	 public function onBeforeDelete()
    76| 	 {
    77| 		 if($this->CapturedFields()) {
    78| 			 foreach($this->CapturedFields() as $field) {
    79| 				 $field->delete();
    80| 			 }
    81| 		 }
    82| 		 parent::onBeforeDelete();
    83| 	 }
    84| }

