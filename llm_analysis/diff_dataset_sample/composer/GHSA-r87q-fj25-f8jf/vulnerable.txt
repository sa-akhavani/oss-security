# ====================================================================
# FILE: src/SimpleXLSXEx.php
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 105-148 ---
   105|     public $worksheetIndex;
   106|     public function __construct(SimpleXLSX $xlsx)
   107|     {
   108|         $this->xlsx = $xlsx;
   109|         $this->readThemeColors();
   110|         $this->readFonts();
   111|         $this->readFills();
   112|         $this->readBorders();
   113|         $this->readXfs();
   114|         $this->readHyperlinks();
   115|         $this->readComments();
   116|     }
   117|     public function readThemeColors()
   118|     {
   119|         $this->themeColors = [];
   120|         if (isset($this->xlsx->theme->themeElements->clrScheme)) {
   121|             $colors12 = ['lt1', 'dk1', 'lt2', 'dk2','accent1','accent2','accent3','accent4','accent5',
   122|                 'accent6','hlink','folHlink'];
   123|             foreach ($colors12 as $c) {
   124|                 $v = $this->xlsx->theme->themeElements->clrScheme->{$c};
   125|                 if (isset($v->sysClr)) {
   126|                     $this->themeColors[] = substr((string) $v->sysClr['lastClr'], 0, 6);
   127|                 } elseif (isset($v->srgbClr)) {
   128|                     $this->themeColors[] = substr((string) $v->srgbClr['val'], 0, 6);
   129|                 } else {
   130|                     $this->themeColors[] = null;
   131|                 }
   132|             }
   133|         }
   134|     }
   135|     public function readFonts()
   136|     {
   137|         $this->fonts = [];
   138|         if (isset($this->xlsx->styles->fonts->font)) {
   139|             foreach ($this->xlsx->styles->fonts->font as $v) {
   140|                 $u = '';
   141|                 if (isset($v->u)) {
   142|                     $u = isset($v->u['val']) ? htmlspecialchars((string) $v->u['val'], ENT_QUOTES) : 'single';
   143|                 }
   144|                 $f = [
   145|                     'b' => isset($v->b) && ($v->b['val'] === null || $v->b['val']),
   146|                     'i' => isset($v->i) && ($v->i['val'] === null || $v->i['val']),
   147|                     'u' => $u,
   148|                     'strike' => isset($v->strike) && ($v->strike['val'] === null || $v->strike['val']),

# --- HUNK 2: Lines 548-588 ---
   548|             $r['css'] .= 'text-align: right;';
   549|         }
   550|         if (!$r['name']) {
   551|             $c = '';
   552|             for ($k = $x; $k >= 0; $k = (int)($k / 26) - 1) {
   553|                 $c = chr($k % 26 + 65) . $c;
   554|             }
   555|             $r['name'] = $c . ($y + 1);
   556|             $r['r'] = $y+1;
   557|         }
   558|         $r['href'] = isset($this->hyperlinks[$this->worksheetIndex][$r['name']]) ? $this->hyperlinks[$this->worksheetIndex][$r['name']] : '';
   559|         $r['comment'] = isset($this->comments[$this->worksheetIndex][$r['name']]) ? $this->comments[$this->worksheetIndex][$r['name']] : '';
   560|         return $r;
   561|     }
   562|     public function getColorValue(SimpleXMLElement $a = null, $default = '')
   563|     {
   564|         if ($a === null) {
   565|             return $default;
   566|         }
   567|         $c = $default; // auto
   568|         if ($a['rgb'] !== null) {
   569|             $c = substr((string) $a['rgb'], 2, 6); // FFCCBBAA -> CCBBAA
   570|         } elseif ($a['indexed'] !== null && isset(static::$IC[ (int) $a['indexed'] ])) {
   571|             $c = static::$IC[ (int) $a['indexed'] ];
   572|         } elseif ($a['theme'] !== null && isset($this->themeColors[ (int) $a['theme'] ])) {
   573|             $c = $this->themeColors[ (int) $a['theme'] ];
   574|         }
   575|         if ($a['tint'] !== null) {
   576|             list($r,$g,$b) = array_map('hexdec', str_split($c, 2));
   577|             $tint = (float) $a['tint'];
   578|             if ($tint > 0) {
   579|                 $r += (255 - $r) * $tint;
   580|                 $g += (255 - $g) * $tint;
   581|                 $b += (255 - $b) * $tint;
   582|             } else {
   583|                 $r += $r * $tint;
   584|                 $g += $g * $tint;
   585|                 $b += $b * $tint;
   586|             }
   587|             $c = strtoupper(
   588|                 str_pad(dechex((int) $r), 2, '0', 0) .

