--- a//dev/null
+++ b/GPL_LIB/AutoComplete/autocomplete-1.js
@@ -0,0 +1,107 @@
+function getXMLHTTP(){
+  var xhr=null;
+  if(window.XMLHttpRequest) // Firefox et autres
+  xhr = new XMLHttpRequest();
+  else if(window.ActiveXObject){ // Internet Explorer
+    try {
+      xhr = new ActiveXObject("Msxml2.XMLHTTP");
+    } catch (e) {
+      try {
+        xhr = new ActiveXObject("Microsoft.XMLHTTP");
+      } catch (e1) {
+        xhr = null;
+      }
+    }
+  }
+  else { // XMLHttpRequest non support� par le navigateur
+    alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
+  }
+  return xhr;
+}
+var _documentForm=null; // le formulaire contenant notre champ texte
+var _inputField=null; // le champ texte lui-m�me
+var _submitButton=null; // le bouton submit de notre formulaire
+function initAutoComplete(form,field,submit){
+  _documentForm=form;
+  _inputField=field;
+  _submitButton=submit;
+  _inputField.autocomplete="off";
+  creeAutocompletionListe();
+  _currentInputFieldValue=_inputField.value;
+  _oldInputFieldValue=_currentInputFieldValue;
+  cacheResults("",new Array())
+  setTimeout("mainLoop()",200)
+}
+var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
+var _currentInputFieldValue=""; // valeur actuelle du champ texte
+var _resultCache=new Object(); // m�canisme de cache des requetes
+function mainLoop(){
+  _currentInputFieldValue = _inputField.value;
+  if(_oldInputFieldValue!=_currentInputFieldValue){
+    var valeur=escapeURI(_currentInputFieldValue);
+    var suggestions=_resultCache[_currentInputFieldValue];
+    if(suggestions){ // la r�ponse �tait encore dans le cache
+      metsEnPlace(valeur,suggestions)
+    }else{
+      callSuggestions(valeur) // appel distant
+    }
+    _inputField.focus()
+  }
+  _oldInputFieldValue=_currentInputFieldValue;
+  setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
+  return true
+}
+function escapeURI(La){
+  if(encodeURIComponent) {
+    return encodeURIComponent(La);
+  }
+  if(escape) {
+    return escape(La)
+  }
+}
+var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
+var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
+function callSuggestions(valeur){
+  if(_xmlHttp&&_xmlHttp.readyState!=0){
+    _xmlHttp.abort()
+  }
+  _xmlHttp=getXMLHTTP();
+  if(_xmlHttp){
+    _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
+    _xmlHttp.onreadystatechange=function() {
+      if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
+        var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
+        cacheResults(valeur,liste)
+        metsEnPlace(valeur,liste)
+      }
+    };
+    _xmlHttp.send(null)
+  }
+}
+function cacheResults(debut,suggestions){
+  _resultCache[debut]=suggestions
+}
+function traiteXmlSuggestions(xmlDoc) {
+  var options = xmlDoc.getElementsByTagName('option');
+  var optionsListe = new Array();
+  for (var i=0; i < options.length; ++i) {
+    optionsListe.push(options[i].firstChild.data);
+  }
+  return optionsListe;
+}
+var _completeListe=null; // la liste contenant les suggestions
+function creeAutocompletionListe(){
+  _completeListe=document.createElement("UL");
+  _completeListe.id="completeDiv";
+  document.body.appendChild(_completeListe);
+}
+function metsEnPlace(valeur, liste) {
+  while(_completeListe.childNodes.length>0) {
+    _completeListe.removeChild(_completeListe.childNodes[0]);
+  }
+  for (var i=0; i < liste.length; ++i) {
+    var nouveauElmt = document.createElement("LI")
+    nouveauElmt.innerHTML = liste[i]
+    _completeListe.appendChild(nouveauElmt)
+  }
+}

--- a//dev/null
+++ b/GPL_LIB/AutoComplete/autocomplete-2.js
@@ -0,0 +1,176 @@
+function getXMLHTTP(){
+  var xhr=null;
+  if(window.XMLHttpRequest) // Firefox et autres
+  xhr = new XMLHttpRequest();
+  else if(window.ActiveXObject){ // Internet Explorer
+    try {
+      xhr = new ActiveXObject("Msxml2.XMLHTTP");
+    } catch (e) {
+      try {
+        xhr = new ActiveXObject("Microsoft.XMLHTTP");
+      } catch (e1) {
+        xhr = null;
+      }
+    }
+  }
+  else { // XMLHttpRequest non support� par le navigateur
+    alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
+  }
+  return xhr;
+}
+var _documentForm=null; // le formulaire contenant notre champ texte
+var _inputField=null; // le champ texte lui-m�me
+var _submitButton=null; // le bouton submit de notre formulaire
+function initAutoComplete(form,field,submit){
+  _documentForm=form;
+  _inputField=field;
+  _submitButton=submit;
+  _inputField.autocomplete="off";
+  creeAutocompletionDiv();
+  _currentInputFieldValue=_inputField.value;
+  _oldInputFieldValue=_currentInputFieldValue;
+  cacheResults("",new Array())
+  setTimeout("mainLoop()",200)
+}
+var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
+var _currentInputFieldValue=""; // valeur actuelle du champ texte
+var _resultCache=new Object(); // m�canisme de cache des requetes
+function mainLoop(){
+  _currentInputFieldValue = _inputField.value;
+  if(_oldInputFieldValue!=_currentInputFieldValue){
+    var valeur=escapeURI(_currentInputFieldValue);
+    var suggestions=_resultCache[_currentInputFieldValue];
+    if(suggestions){ // la r�ponse �tait encore dans le cache
+      metsEnPlace(valeur,suggestions)
+    }else{
+      callSuggestions(valeur) // appel distant
+    }
+    _inputField.focus()
+  }
+  _oldInputFieldValue=_currentInputFieldValue;
+  setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
+  return true
+}
+function escapeURI(La){
+  if(encodeURIComponent) {
+    return encodeURIComponent(La);
+  }
+  if(escape) {
+    return escape(La)
+  }
+}
+var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
+var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
+function callSuggestions(valeur){
+  if(_xmlHttp&&_xmlHttp.readyState!=0){
+    _xmlHttp.abort()
+  }
+  _xmlHttp=getXMLHTTP();
+  if(_xmlHttp){
+    _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
+    _xmlHttp.onreadystatechange=function() {
+      if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
+        var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
+        cacheResults(valeur,liste)
+        metsEnPlace(valeur,liste)
+      }
+    };
+    _xmlHttp.send(null)
+  }
+}
+function cacheResults(debut,suggestions){
+  _resultCache[debut]=suggestions
+}
+function traiteXmlSuggestions(xmlDoc) {
+  var options = xmlDoc.getElementsByTagName('option');
+  var optionsListe = new Array();
+  for (var i=0; i < options.length; ++i) {
+    optionsListe.push(options[i].firstChild.data);
+  }
+  return optionsListe;
+}
+function insereCSS(nom,regle){
+  if (document.styleSheets) {
+    var I=document.styleSheets[0];
+    if(I.addRule){ // m�thode IE
+      I.addRule(nom,regle)
+    }else if(I.insertRule){ // m�thode DOM
+      I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
+    }
+  }
+}
+function initStyle(){
+  var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
+  var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
+  var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
+  insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
+  insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
+  insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
+}
+function setStylePourElement(c,name){
+  c.className=name;
+}
+function calculateOffsetLeft(r){
+  return calculateOffset(r,"offsetLeft")
+}
+function calculateOffsetTop(r){
+  return calculateOffset(r,"offsetTop")
+}
+function calculateOffset(r,attr){
+  var kb=0;
+  while(r){
+    kb+=r[attr];
+    r=r.offsetParent
+  }
+  return kb
+}
+function calculateWidth(){
+  return _inputField.offsetWidth-2*1
+}
+function setCompleteDivSize(){
+  if(_completeDiv){
+    _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
+    _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
+    _completeDiv.style.width=calculateWidth()+"px"
+  }
+}
+function creeAutocompletionDiv() {
+  initStyle();
+  _completeDiv=document.createElement("DIV");
+  _completeDiv.id="completeDiv";
+  var borderLeftRight=1;
+  var borderTopBottom=1;
+  _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
+  _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
+  _completeDiv.style.zIndex="1";
+  _completeDiv.style.paddingRight="0";
+  _completeDiv.style.paddingLeft="0";
+  _completeDiv.style.paddingTop="0";
+  _completeDiv.style.paddingBottom="0";
+  setCompleteDivSize();
+  _completeDiv.style.visibility="visible";
+  _completeDiv.style.position="absolute";
+  _completeDiv.style.backgroundColor="white";
+  document.body.appendChild(_completeDiv);
+  setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
+}
+function metsEnPlace(valeur, liste){
+  while(_completeDiv.childNodes.length>0) {
+    _completeDiv.removeChild(_completeDiv.childNodes[0]);
+  }
+  for(var f=0; f<liste.length; ++f){
+    var nouveauDiv=document.createElement("DIV");
+    setStylePourElement(nouveauDiv,"AutoCompleteDiv");
+    var nouveauSpan=document.createElement("SPAN");
+    nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
+    nouveauDiv.appendChild(nouveauSpan);
+    _completeDiv.appendChild(nouveauDiv)
+  }
+  if(_completeDivRows>0) {
+    _completeDiv.height=16*_completeDivRows+4;
+  } else {
+    hideCompleteDiv();
+  }
+}

--- a//dev/null
+++ b/GPL_LIB/AutoComplete/autocomplete-3-1.js
@@ -0,0 +1,398 @@
+function getXMLHTTP(){
+  var xhr=null;
+  if(window.XMLHttpRequest) // Firefox et autres
+  xhr = new XMLHttpRequest();
+  else if(window.ActiveXObject){ // Internet Explorer
+    try {
+      xhr = new ActiveXObject("Msxml2.XMLHTTP");
+    } catch (e) {
+      try {
+        xhr = new ActiveXObject("Microsoft.XMLHTTP");
+      } catch (e1) {
+        xhr = null;
+      }
+    }
+  }
+  else { // XMLHttpRequest non support� par le navigateur
+    alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
+  }
+  return xhr;
+}
+var _documentForm=null; // le formulaire contenant notre champ texte
+var _inputField=null; // le champ texte lui-m�me
+var _submitButton=null; // le bouton submit de notre formulaire
+function initAutoComplete(form,field,submit){
+  _documentForm=form;
+  _inputField=field;
+  _submitButton=submit;
+  _inputField.autocomplete="off";
+  creeAutocompletionDiv();
+  _currentInputFieldValue=_inputField.value;
+  _oldInputFieldValue=_currentInputFieldValue;
+  cacheResults("",new Array())
+  document.onkeydown=onKeyDownHandler;
+  _inputField.onkeyup=onKeyUpHandler;
+  setTimeout("mainLoop()",200)
+}
+var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
+var _currentInputFieldValue=""; // valeur actuelle du champ texte
+var _resultCache=new Object(); // m�canisme de cache des requetes
+function mainLoop(){
+  if(_oldInputFieldValue!=_currentInputFieldValue){
+    var valeur=escapeURI(_currentInputFieldValue);
+    var suggestions=_resultCache[_currentInputFieldValue];
+    if(suggestions){ // la r�ponse �tait encore dans le cache
+      metsEnPlace(valeur,suggestions)
+    }else{
+      callSuggestions(valeur) // appel distant
+    }
+    _inputField.focus()
+  }
+  _oldInputFieldValue=_currentInputFieldValue;
+  setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
+  return true
+}
+function escapeURI(La){
+  if(encodeURIComponent) {
+    return encodeURIComponent(La);
+  }
+  if(escape) {
+    return escape(La)
+  }
+}
+var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
+var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
+function callSuggestions(valeur){
+  if(_xmlHttp&&_xmlHttp.readyState!=0){
+    _xmlHttp.abort()
+  }
+  _xmlHttp=getXMLHTTP();
+  if(_xmlHttp){
+    _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
+    _xmlHttp.onreadystatechange=function() {
+      if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
+        var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
+        cacheResults(valeur,liste)
+        metsEnPlace(valeur,liste)
+      }
+    };
+    _xmlHttp.send(null)
+  }
+}
+function cacheResults(debut,suggestions){
+  _resultCache[debut]=suggestions
+}
+function traiteXmlSuggestions(xmlDoc) {
+  var options = xmlDoc.getElementsByTagName('option');
+  var optionsListe = new Array();
+  for (var i=0; i < options.length; ++i) {
+    optionsListe.push(options[i].firstChild.data);
+  }
+  return optionsListe;
+}
+function insereCSS(nom,regle){
+  if (document.styleSheets) {
+    var I=document.styleSheets[0];
+    if(I.addRule){ // m�thode IE
+      I.addRule(nom,regle)
+    }else if(I.insertRule){ // m�thode DOM
+      I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
+    }
+  }
+}
+function initStyle(){
+  var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
+  var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
+  var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
+  insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
+  insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
+  insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
+}
+function setStylePourElement(c,name){
+  c.className=name;
+}
+function calculateOffsetLeft(r){
+  return calculateOffset(r,"offsetLeft")
+}
+function calculateOffsetTop(r){
+  return calculateOffset(r,"offsetTop")
+}
+function calculateOffset(r,attr){
+  var kb=0;
+  while(r){
+    kb+=r[attr];
+    r=r.offsetParent
+  }
+  return kb
+}
+function calculateWidth(){
+  return _inputField.offsetWidth-2*1
+}
+function setCompleteDivSize(){
+  if(_completeDiv){
+    _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
+    _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
+    _completeDiv.style.width=calculateWidth()+"px"
+  }
+}
+function creeAutocompletionDiv() {
+  initStyle();
+  _completeDiv=document.createElement("DIV");
+  _completeDiv.id="completeDiv";
+  var borderLeftRight=1;
+  var borderTopBottom=1;
+  _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
+  _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
+  _completeDiv.style.zIndex="1";
+  _completeDiv.style.paddingRight="0";
+  _completeDiv.style.paddingLeft="0";
+  _completeDiv.style.paddingTop="0";
+  _completeDiv.style.paddingBottom="0";
+  setCompleteDivSize();
+  _completeDiv.style.visibility="hidden";
+  _completeDiv.style.position="absolute";
+  _completeDiv.style.backgroundColor="white";
+  document.body.appendChild(_completeDiv);
+  setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
+}
+function metsEnPlace(valeur, liste){
+  while(_completeDiv.childNodes.length>0) {
+    _completeDiv.removeChild(_completeDiv.childNodes[0]);
+  }
+  for(var f=0; f<liste.length; ++f){
+    var nouveauDiv=document.createElement("DIV");
+    setStylePourElement(nouveauDiv,"AutoCompleteDiv");
+    var nouveauSpan=document.createElement("SPAN");
+    nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
+    nouveauDiv.appendChild(nouveauSpan);
+    _completeDiv.appendChild(nouveauDiv)
+  }
+  PressAction();
+  if(_completeDivRows>0) {
+    _completeDiv.height=16*_completeDivRows+4;
+  } else {
+    hideCompleteDiv();
+  }
+}
+var _lastKeyCode=null;
+var onKeyDownHandler=function(event){
+  if(!event&&window.event) {
+    event=window.event;
+  }
+  if(event) {
+    _lastKeyCode=event.keyCode;
+  }
+}
+var _eventKeycode = null;
+var onKeyUpHandler=function(event){
+  if(!event&&window.event) {
+    event=window.event;
+  }
+  _eventKeycode=event.keyCode;
+  if(_eventKeycode==40||_eventKeycode==38) {
+    blurThenGetFocus();
+  }
+  var N=rangeSize(_inputField);
+  var v=beforeRangeSize(_inputField);
+  var V=_inputField.value;
+  if(_eventKeycode!=0){
+    if(N>0&&v!=-1) {
+      V=V.substring(0,v);
+    }
+    if(_eventKeycode==13||_eventKeycode==3){
+      var d=_inputField;
+      if(_inputField.createTextRange){
+        var t=_inputField.createTextRange();
+        t.moveStart("character",_inputField.value.length);
+        _inputField.select()
+      } else if (d.setSelectionRange){
+        _inputField.setSelectionRange(_inputField.value.length,_inputField.value.length)
+      }
+    } else {
+      if(_inputField.value!=V) {
+        _inputField.value=V
+      }
+    }
+  }
+  if(_eventKeycode!=40&&_eventKeycode!=38) {
+  	_currentInputFieldValue=V;
+  }
+  if(handleCursorUpDownEnter(_eventKeycode)&&_eventKeycode!=0) {
+    PressAction();
+  }
+}
+function handleCursorUpDownEnter(eventCode){
+  if(eventCode==40){
+    highlightNewValue(_highlightedSuggestionIndex+1);
+    return false
+  }else if(eventCode==38){
+    highlightNewValue(_highlightedSuggestionIndex-1);
+    return false
+  }else if(eventCode==13||eventCode==3){
+    return false
+  }
+  return true
+}
+var _completeDivRows = 0;
+var _completeDivDivList = null;
+var _highlightedSuggestionIndex = -1;
+var _highlightedSuggestionDiv = null;
+function PressAction(){
+  _highlightedSuggestionIndex=-1;
+  var suggestionList=_completeDiv.getElementsByTagName("div");
+  var suggestionLongueur=suggestionList.length;
+  _completeDivRows=suggestionLongueur;
+  _completeDivDivList=suggestionList;
+  if(_currentInputFieldValue==""||suggestionLongueur==0){
+    hideCompleteDiv()
+  }else{
+    showCompleteDiv()
+  }
+  var trouve=false;
+  if(_currentInputFieldValue.length>0){
+    var indice;
+    for(indice=0; indice<suggestionLongueur; indice++){
+      if(getSuggestion(suggestionList.item(indice)).toUpperCase().indexOf(_currentInputFieldValue.toUpperCase())==0) {
+        trouve=true;
+        break
+      }
+    }
+  }
+  for(var i=0; i<suggestionLongueur; i++) {
+    setStylePourElement(suggestionList.item(i),"AutoCompleteDiv");
+  }
+  if(trouve){
+    _highlightedSuggestionIndex=indice;
+    _highlightedSuggestionDiv=suggestionList.item(_highlightedSuggestionIndex);
+  }else{
+    _highlightedSuggestionIndex=-1;
+    _highlightedSuggestionDiv=null
+  }
+  var supprSelection=false;
+  switch(_eventKeycode){
+    case 8:
+    case 33:
+    case 34:
+    case 35:
+    case 35:
+    case 36:
+    case 37:
+    case 39:
+    case 45:
+    case 46:
+      supprSelection=true;
+      break;
+    default:
+      break
+  }
+  if(!supprSelection&&_highlightedSuggestionDiv){
+    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
+    var z;
+    if(trouve) {
+      z=getSuggestion(_highlightedSuggestionDiv).substr(0);
+    } else {
+      z=_currentInputFieldValue;
+    }
+    if(z!=_inputField.value){
+      if(_inputField.value!=_currentInputFieldValue) {
+        return;
+      }
+      if(_inputField.createTextRange||_inputField.setSelectionRange) {
+        _inputField.value=z;
+      }
+      if(_inputField.createTextRange){
+        var t=_inputField.createTextRange();
+        t.moveStart("character",_currentInputFieldValue.length);
+        t.select()
+      }else if(_inputField.setSelectionRange){
+        _inputField.setSelectionRange(_currentInputFieldValue.length,_inputField.value.length)
+      }
+    }
+  }else{
+    _highlightedSuggestionIndex=-1;
+  }
+}
+var _cursorUpDownPressed = null;
+function blurThenGetFocus(){
+  _cursorUpDownPressed=true;
+  _inputField.blur();
+  setTimeout("_inputField.focus();",10);
+  return
+}
+function rangeSize(n){
+  var N=-1;
+  if(n.createTextRange){
+    var fa=document.selection.createRange().duplicate();
+    N=fa.text.length
+  }else if(n.setSelectionRange){
+    N=n.selectionEnd-n.selectionStart
+  }
+  return N
+}
+function beforeRangeSize(n){
+  var v=0;
+  if(n.createTextRange){
+    var fa=document.selection.createRange().duplicate();
+    fa.moveEnd("textedit",1);
+    v=n.value.length-fa.text.length
+  }else if(n.setSelectionRange){
+    v=n.selectionStart
+  }else{
+    v=-1
+  }
+  return v
+}
+function cursorAfterValue(n){
+  if(n.createTextRange){
+    var t=n.createTextRange();
+    t.moveStart("character",n.value.length);
+    t.select()
+  } else if(n.setSelectionRange) {
+    n.setSelectionRange(n.value.length,n.value.length)
+  }
+}
+function getSuggestion(uneDiv){
+  if(!uneDiv) {
+    return null;
+  }
+  return trimCR(uneDiv.getElementsByTagName('span')[0].firstChild.data)
+}
+function trimCR(chaine){
+  for(var f=0,nChaine="",zb="\n\r"; f<chaine.length; f++) {
+    if (zb.indexOf(chaine.charAt(f))==-1) {
+      nChaine+=chaine.charAt(f);
+    }
+  }
+  return nChaine
+}
+function hideCompleteDiv(){
+  _completeDiv.style.visibility="hidden"
+}
+function showCompleteDiv(){
+  _completeDiv.style.visibility="visible";
+  setCompleteDivSize()
+}
+function highlightNewValue(C){
+  if(!_completeDivDivList||_completeDivRows<=0) {
+    return;
+  }
+  showCompleteDiv();
+  if(C>=_completeDivRows){
+    C=_completeDivRows-1
+  }
+  if(_highlightedSuggestionIndex!=-1&&C!=_highlightedSuggestionIndex){
+    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
+    _highlightedSuggestionIndex=-1
+  }
+  if(C<0){
+    _highlightedSuggestionIndex=-1;
+    _inputField.focus();
+    return
+  }
+  _highlightedSuggestionIndex=C;
+  _highlightedSuggestionDiv=_completeDivDivList.item(C);
+  setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
+  _inputField.value=getSuggestion(_highlightedSuggestionDiv);
+}

--- a//dev/null
+++ b/GPL_LIB/AutoComplete/autocomplete-3-2.js
@@ -0,0 +1,429 @@
+function getXMLHTTP(){
+  var xhr=null;
+  if(window.XMLHttpRequest) // Firefox et autres
+  xhr = new XMLHttpRequest();
+  else if(window.ActiveXObject){ // Internet Explorer
+    try {
+      xhr = new ActiveXObject("Msxml2.XMLHTTP");
+    } catch (e) {
+      try {
+        xhr = new ActiveXObject("Microsoft.XMLHTTP");
+      } catch (e1) {
+        xhr = null;
+      }
+    }
+  }
+  else { // XMLHttpRequest non support� par le navigateur
+    alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
+  }
+  return xhr;
+}
+var _documentForm=null; // le formulaire contenant notre champ texte
+var _inputField=null; // le champ texte lui-m�me
+var _submitButton=null; // le bouton submit de notre formulaire
+function initAutoComplete(form,field,submit){
+  _documentForm=form;
+  _inputField=field;
+  _submitButton=submit;
+  _inputField.autocomplete="off";
+  creeAutocompletionDiv();
+  _currentInputFieldValue=_inputField.value;
+  _oldInputFieldValue=_currentInputFieldValue;
+  cacheResults("",new Array())
+  document.onkeydown=onKeyDownHandler;
+  _inputField.onkeyup=onKeyUpHandler;
+  _inputField.onblur=onBlurHandler;
+  window.onresize=onResizeHandler;
+  setTimeout("mainLoop()",200)
+}
+var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
+var _currentInputFieldValue=""; // valeur actuelle du champ texte
+var _resultCache=new Object(); // m�canisme de cache des requetes
+function mainLoop(){
+  if(_oldInputFieldValue!=_currentInputFieldValue){
+    var valeur=escapeURI(_currentInputFieldValue);
+    var suggestions=_resultCache[_currentInputFieldValue];
+    if(suggestions){ // la r�ponse �tait encore dans le cache
+      metsEnPlace(valeur,suggestions)
+    }else{
+      callSuggestions(valeur) // appel distant
+    }
+    _inputField.focus()
+  }
+  _oldInputFieldValue=_currentInputFieldValue;
+  setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
+  return true
+}
+function escapeURI(La){
+  if(encodeURIComponent) {
+    return encodeURIComponent(La);
+  }
+  if(escape) {
+    return escape(La)
+  }
+}
+var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
+var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
+function callSuggestions(valeur){
+  if(_xmlHttp&&_xmlHttp.readyState!=0){
+    _xmlHttp.abort()
+  }
+  _xmlHttp=getXMLHTTP();
+  if(_xmlHttp){
+    _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
+    _xmlHttp.onreadystatechange=function() {
+      if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
+        var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
+        cacheResults(valeur,liste)
+        metsEnPlace(valeur,liste)
+      }
+    };
+    _xmlHttp.send(null)
+  }
+}
+function cacheResults(debut,suggestions){
+  _resultCache[debut]=suggestions
+}
+function traiteXmlSuggestions(xmlDoc) {
+  var options = xmlDoc.getElementsByTagName('option');
+  var optionsListe = new Array();
+  for (var i=0; i < options.length; ++i) {
+    optionsListe.push(options[i].firstChild.data);
+  }
+  return optionsListe;
+}
+function insereCSS(nom,regle){
+  if (document.styleSheets) {
+    var I=document.styleSheets[0];
+    if(I.addRule){ // m�thode IE
+      I.addRule(nom,regle)
+    }else if(I.insertRule){ // m�thode DOM
+      I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
+    }
+  }
+}
+function initStyle(){
+  var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
+  var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
+  var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
+  insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
+  insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
+  insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
+}
+function setStylePourElement(c,name){
+  c.className=name;
+}
+function calculateOffsetLeft(r){
+  return calculateOffset(r,"offsetLeft")
+}
+function calculateOffsetTop(r){
+  return calculateOffset(r,"offsetTop")
+}
+function calculateOffset(r,attr){
+  var kb=0;
+  while(r){
+    kb+=r[attr];
+    r=r.offsetParent
+  }
+  return kb
+}
+function calculateWidth(){
+  return _inputField.offsetWidth-2*1
+}
+function setCompleteDivSize(){
+  if(_completeDiv){
+    _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
+    _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
+    _completeDiv.style.width=calculateWidth()+"px"
+  }
+}
+function creeAutocompletionDiv() {
+  initStyle();
+  _completeDiv=document.createElement("DIV");
+  _completeDiv.id="completeDiv";
+  var borderLeftRight=1;
+  var borderTopBottom=1;
+  _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
+  _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
+  _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
+  _completeDiv.style.zIndex="1";
+  _completeDiv.style.paddingRight="0";
+  _completeDiv.style.paddingLeft="0";
+  _completeDiv.style.paddingTop="0";
+  _completeDiv.style.paddingBottom="0";
+  setCompleteDivSize();
+  _completeDiv.style.visibility="hidden";
+  _completeDiv.style.position="absolute";
+  _completeDiv.style.backgroundColor="white";
+  document.body.appendChild(_completeDiv);
+  setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
+}
+function metsEnPlace(valeur, liste){
+  while(_completeDiv.childNodes.length>0) {
+    _completeDiv.removeChild(_completeDiv.childNodes[0]);
+  }
+  for(var f=0; f<liste.length; ++f){
+    var nouveauDiv=document.createElement("DIV");
+    nouveauDiv.onmousedown=divOnMouseDown;
+    nouveauDiv.onmouseover=divOnMouseOver;
+    nouveauDiv.onmouseout=divOnMouseOut;
+    setStylePourElement(nouveauDiv,"AutoCompleteDiv");
+    var nouveauSpan=document.createElement("SPAN");
+    nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
+    nouveauDiv.appendChild(nouveauSpan);
+    _completeDiv.appendChild(nouveauDiv)
+  }
+  PressAction();
+  if(_completeDivRows>0) {
+    _completeDiv.height=16*_completeDivRows+4;
+  } else {
+    hideCompleteDiv();
+  }
+}
+var _lastKeyCode=null;
+var onKeyDownHandler=function(event){
+  if(!event&&window.event) {
+    event=window.event;
+  }
+  if(event) {
+    _lastKeyCode=event.keyCode;
+  }
+}
+var _eventKeycode = null;
+var onKeyUpHandler=function(event){
+  if(!event&&window.event) {
+    event=window.event;
+  }
+  _eventKeycode=event.keyCode;
+  if(_eventKeycode==40||_eventKeycode==38) {
+    blurThenGetFocus();
+  }
+  var N=rangeSize(_inputField);
+  var v=beforeRangeSize(_inputField);
+  var V=_inputField.value;
+  if(_eventKeycode!=0){
+    if(N>0&&v!=-1) {
+      V=V.substring(0,v);
+    }
+    if(_eventKeycode==13||_eventKeycode==3){
+      var d=_inputField;
+      if(_inputField.createTextRange){
+        var t=_inputField.createTextRange();
+        t.moveStart("character",_inputField.value.length);
+        _inputField.select()
+      } else if (d.setSelectionRange){
+        _inputField.setSelectionRange(_inputField.value.length,_inputField.value.length)
+      }
+    } else {
+      if(_inputField.value!=V) {
+        _inputField.value=V
+      }
+    }
+  }
+  if(_eventKeycode!=40&&_eventKeycode!=38) {
+  	_currentInputFieldValue=V;
+  }
+  if(handleCursorUpDownEnter(_eventKeycode)&&_eventKeycode!=0) {
+    PressAction();
+  }
+}
+function handleCursorUpDownEnter(eventCode){
+  if(eventCode==40){
+    highlightNewValue(_highlightedSuggestionIndex+1);
+    return false
+  }else if(eventCode==38){
+    highlightNewValue(_highlightedSuggestionIndex-1);
+    return false
+  }else if(eventCode==13||eventCode==3){
+    return false
+  }
+  return true
+}
+var _completeDivRows = 0;
+var _completeDivDivList = null;
+var _highlightedSuggestionIndex = -1;
+var _highlightedSuggestionDiv = null;
+function PressAction(){
+  _highlightedSuggestionIndex=-1;
+  var suggestionList=_completeDiv.getElementsByTagName("div");
+  var suggestionLongueur=suggestionList.length;
+  _completeDivRows=suggestionLongueur;
+  _completeDivDivList=suggestionList;
+  if(_currentInputFieldValue==""||suggestionLongueur==0){
+    hideCompleteDiv()
+  }else{
+    showCompleteDiv()
+  }
+  var trouve=false;
+  if(_currentInputFieldValue.length>0){
+    var indice;
+    for(indice=0; indice<suggestionLongueur; indice++){
+      if(getSuggestion(suggestionList.item(indice)).toUpperCase().indexOf(_currentInputFieldValue.toUpperCase())==0) {
+        trouve=true;
+        break
+      }
+    }
+  }
+  for(var i=0; i<suggestionLongueur; i++) {
+    setStylePourElement(suggestionList.item(i),"AutoCompleteDiv");
+  }
+  if(trouve){
+    _highlightedSuggestionIndex=indice;
+    _highlightedSuggestionDiv=suggestionList.item(_highlightedSuggestionIndex);
+  }else{
+    _highlightedSuggestionIndex=-1;
+    _highlightedSuggestionDiv=null
+  }
+  var supprSelection=false;
+  switch(_eventKeycode){
+    case 8:
+    case 33:
+    case 34:
+    case 35:
+    case 35:
+    case 36:
+    case 37:
+    case 39:
+    case 45:
+    case 46:
+      supprSelection=true;
+      break;
+    default:
+      break
+  }
+  if(!supprSelection&&_highlightedSuggestionDiv){
+    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
+    var z;
+    if(trouve) {
+      z=getSuggestion(_highlightedSuggestionDiv).substr(0);
+    } else {
+      z=_currentInputFieldValue;
+    }
+    if(z!=_inputField.value){
+      if(_inputField.value!=_currentInputFieldValue) {
+        return;
+      }
+      if(_inputField.createTextRange||_inputField.setSelectionRange) {
+        _inputField.value=z;
+      }
+      if(_inputField.createTextRange){
+        var t=_inputField.createTextRange();
+        t.moveStart("character",_currentInputFieldValue.length);
+        t.select()
+      }else if(_inputField.setSelectionRange){
+        _inputField.setSelectionRange(_currentInputFieldValue.length,_inputField.value.length)
+      }
+    }
+  }else{
+    _highlightedSuggestionIndex=-1;
+  }
+}
+var _cursorUpDownPressed = null;
+function blurThenGetFocus(){
+  _cursorUpDownPressed=true;
+  _inputField.blur();
+  setTimeout("_inputField.focus();",10);
+  return
+}
+function rangeSize(n){
+  var N=-1;
+  if(n.createTextRange){
+    var fa=document.selection.createRange().duplicate();
+    N=fa.text.length
+  }else if(n.setSelectionRange){
+    N=n.selectionEnd-n.selectionStart
+  }
+  return N
+}
+function beforeRangeSize(n){
+  var v=0;
+  if(n.createTextRange){
+    var fa=document.selection.createRange().duplicate();
+    fa.moveEnd("textedit",1);
+    v=n.value.length-fa.text.length
+  }else if(n.setSelectionRange){
+    v=n.selectionStart
+  }else{
+    v=-1
+  }
+  return v
+}
+function cursorAfterValue(n){
+  if(n.createTextRange){
+    var t=n.createTextRange();
+    t.moveStart("character",n.value.length);
+    t.select()
+  } else if(n.setSelectionRange) {
+    n.setSelectionRange(n.value.length,n.value.length)
+  }
+}
+function getSuggestion(uneDiv){
+  if(!uneDiv) {
+    return null;
+  }
+  return trimCR(uneDiv.getElementsByTagName('span')[0].firstChild.data)
+}
+function trimCR(chaine){
+  for(var f=0,nChaine="",zb="\n\r"; f<chaine.length; f++) {
+    if (zb.indexOf(chaine.charAt(f))==-1) {
+      nChaine+=chaine.charAt(f);
+    }
+  }
+  return nChaine
+}
+function hideCompleteDiv(){
+  _completeDiv.style.visibility="hidden"
+}
+function showCompleteDiv(){
+  _completeDiv.style.visibility="visible";
+  setCompleteDivSize()
+}
+function highlightNewValue(C){
+  if(!_completeDivDivList||_completeDivRows<=0) {
+    return;
+  }
+  showCompleteDiv();
+  if(C>=_completeDivRows){
+    C=_completeDivRows-1
+  }
+  if(_highlightedSuggestionIndex!=-1&&C!=_highlightedSuggestionIndex){
+    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
+    _highlightedSuggestionIndex=-1
+  }
+  if(C<0){
+    _highlightedSuggestionIndex=-1;
+    _inputField.focus();
+    return
+  }
+  _highlightedSuggestionIndex=C;
+  _highlightedSuggestionDiv=_completeDivDivList.item(C);
+  setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
+  _inputField.value=getSuggestion(_highlightedSuggestionDiv);
+}
+var onResizeHandler=function(event){
+  setCompleteDivSize();
+}
+var onBlurHandler=function(event){
+  if(!_cursorUpDownPressed){
+    hideCompleteDiv();
+    if(_lastKeyCode==9){
+      _submitButton.focus();
+      _lastKeyCode=-1
+    }
+  }
+  _cursorUpDownPressed=false
+};
+var divOnMouseDown=function(){
+  _inputField.value=getSuggestion(this);
+  _documentForm.submit()
+};
+var divOnMouseOver=function(){
+  if(_highlightedSuggestionDiv) {
+    setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
+  }
+  setStylePourElement(this,"AutoCompleteDivAct")
+};
+var divOnMouseOut = function(){
+  setStylePourElement(this,"AutoCompleteDiv");
+};

--- a//dev/null
+++ b/GPL_LIB/AutoComplete/options.php
@@ -0,0 +1,23 @@
+<?php
+header('Content-Type: text/xml;charset=utf-8');
+echo(utf8_encode("<?xml version='1.0' encoding='UTF-8' ?><options>"));
+if (isset($_GET['debut'])) {
+    $debut = utf8_decode($_GET['debut']);
+} else {
+    $debut = "";
+}
+$debut = strtolower($debut);
+$liste = array("abeille","abricot","acheter","acheteur","adjectif","adroit","adroitement","agent","aigle","aile","air","amour","�ne","approcher","ardoise","ar�te","arracher","asperge","astre","aujourd'hui","au lieu de","aussi","autobus","autocar","autruche","avant","avertir","aviation","avril","bain","bal","balcon","balle","ballon","banc","bande","banque","barque","bas","basse","bassin","bataille","b�ton","bavarder","baver","bavette","bazar","beau","belle","bec","b�ler","b�te","bidon","bien","bille","billet","biscuit","bise","blanc","blancheur","blanchir","bleu","bord","bordure","borne","botte","bottine","boucher","bouchon","boucle","boue","boulanger","boulangerie","bouquet","bouteille","boutique","bras","brioche","briquet","brise","briser","brochet","brosse","brosser","brouette","bureau","cachette","cadre","campagne","canal","canard","capitaine","carnaval","carnet","case","castor","chacun","chameau","chant","chapeau","chapelle","chaque","chaton","chaud","chaudement","chef","chenille","chevalier","cheville","chocolat","chose","choucroute","cidre","ciel","cinq","cirque","clocher","clochette","clou","combien","comment","compagne","compagnie","compagnon","compliment","conduire","conduite","confortable","conjuguer","contenir","continuer","coq","coquin","corbeau","corbeille","corde","corne","cornet","corniche","coton","cou","couchette","coudre","coupant","cour","courir","course","couverture","couvrir","craie","cr�ne","crier","croire","croix","cuire","cuisine","cuisson","cuit","cuivre","cuve","date","d�cembre","d�couverte","demi","d�monter","dent","depuis","dernier","derri�re","dessin","dessiner","dessous","devant","dire","direct","directement","diriger","disque","diviser","division","dix","docteur","domestique","donner","dos","double","douloureux","doux","douce","douze","dragon","dur","dur�e","durer","eau","�caille","�chapper","�charpe","�chelle","�colier","�couter","�crevisse","�crire","�criteau","�curie","�l�mentaire","�leveur","en bas","encore","encrier","encre","endormir","enfantin","enfermer","enfin","en haut","ensuite","entier","entr�e","�picerie","�pine","�pingle","�plucher","escalier","escargot","estrade","�trange","fabrique","fabriquer","fatigue","f�minin","fen�tre","fer","fermer","feuille","feutre","fid�le","film","fils","fin","fleuriste","foin","folie","fondre","fontaine","force","forme","formidable","fort","fortement","fourche","franc","franche","fr�re","frileux","fruit","fuite","fumer","gamin","garage","garde","garde","garder","gardien","garnir","gauche","genre","gerbe","gibier","gilet","girafe","gomme","grammaire","grandeur","grandir","gras","grasse","grave","grenouille","gris","grossir","groupe","haut","hauteur","herbe","heure","hibou","hier","histoire","hiver","ici","id�e","injuste","insecte","inspecteur","instrument","invisible","jambe","janvier","jaune","jeune","joie","joue","jouet","joueur","juillet","juin","jument","jusqu'�","labourer","lac","langue","larme","lavage","laver","l�cher","le�on","l�ger","l�gume","lettre","l�vre","li�vre","linge","liquide","litre","livret","loin","long","longue","lorsque","loup","lueur","lunettes","lutte","machine","mademoiselle","magasin","mai","maintenant","maisonnette","ma�tre","ma�tresse","majuscule","malin","mari","masculin","mati�re","matinal","mauve","m�lange","m�langer","m�moire","m�nagerie","menteur","menu","mer","merci","mercredi","merle","merveille","messe","m�tier","mie","miel","le mien","miette","mine","minuit","miracle","moderne","moineau","mois","moment","monstre","montagne","montre","montrer","morue","moteur","motif","moucheron","mouchoir","moudre","mouette","moutarde","mouvement","muraille","murmure","murmurer","nappe","n�","neuf","nez","nid","no�l","noir","nom","nombre","nouer","nuageux","nuit","nul","odeur","oie","oncle","ongle","or","orage","orageux","oreille","ours","ourson","ouvert","ouvrage","ouvrier","paille","pain","paire","panier","pantalon","papier","papillon","parcourir","pardon","parent","parfait","parole","partage","partager","partie","partir","partout","parvenir","pass�","passer","pastille","p�te","patron","patte","pays","peau","p�che","p�cher","p�cheur","peine","pendant","pendre","p�pin","perche","perdant","perdre","perte","peureux","pie","pi�ce","pied","pi�ge","pierre","pi�ton","pioche","piocher","piquet","place","plage","plaine","plaisir","planter","plaque","plat","pleurer","plonger","pluie","pluriel","pochette","point","pointe","poirier","poitrine","pompe","pomper","pondre","porter","pot","pouce","poudre","pourquoi","pourtant","prairie","pratique","presque","prince","princesse","probl�me","produire","produit","promenade","promeneur","propre","proprement","provenir","puis","puisque","punir","pur","pur�e","quatre","quoi","racine","radis","rage","raie","raisin","rame","ramener","raquette","rare","rarement","rebord","recopier","recoudre","recouper","reculer","redevenir","r�duire","regard","r�gime","renard","rencontre","rencontrer","repartir","repasser","r�pondre","r�ponse","reprendre","reproduire","requin","respiration","respirer","r�union","richesse","ride","risque","rivage","rivi�re","robinet","robot","rocher","rond","rondelle","ros�e","roue","rude","ruelle","rugir","salle","saluer","s'amuser","sans","sardine","sauvage","sauver","savoir","secouer","se fatiguer","sel","semelle","se moquer","se munir","s'envoler","se rendormir","se souvenir","seul","si�ge","signe","singulier","soie","soir�e","soldat","solidement","sombre","somme","sonner","sonnerie","sorci�re","sorte","sot","sotte","sottise","souper","soupi�re","sous","souvent","spectateur","sport","sportif","sucrier","sueur","suivant","sujet","superbe","surprise","surtout","tableau","tablier","tabouret","tache","taupe","taille","tante","tapage","taper","taureau","tenir","tenue","tigre","timbre","tirer","tissage","tisser","titre","toile","tondre","tordre","train","traire","tranche","traverser","tr�fle","tr�sor","tresse","tricher","tricheur","tristement","trompe","trou","truite","unit�","usage","us�","utile","utilit�","vague","valeur","valoir","vanille","vapeur","vendeur","vendre","vent","vente","ventre","verger","vernir","vert","verte","veste","viande","victoire","vide","vider","vieux","vif","vive","villa","vinaigre","violette","vip�re","virgule","visible","vitesse","vitre","vitrine","vivement","vivre","vocabulaire","voile","voile","voisin","voisinage","vouloir","voyage","voyageur","z�bre","z�ro");
+function generateOptions($debut,$liste) {
+    $MAX_RETURN = 10;
+    $i = 0;
+    foreach ($liste as $element) {
+        if ($i<$MAX_RETURN && substr($element, 0, strlen($debut))==$debut) {
+            echo(utf8_encode("<option>".$element."</option>"));
+            $i++;
+        }
+    }
+}
+generateOptions($debut,$liste);
+echo("</options>");
+?>

--- a//dev/null
+++ b/GPL_LIB/Color_Picker/color_picker.php
@@ -0,0 +1,150 @@
+<?php
+$n ="";
+$name ="";
+$title ="";
+$n = $_GET['n'];
+$name = $_GET['name'];
+$title = $_GET['title'];
+$name1 = $n."";
+$name2 = $n."_color";
+?>
+<html>
+<head>
+	<title>Color Picker</title>
+	<style type="text/css">
+		body	{ font-size: 12px; font-family: Verdana, Sans-Serif; text-align:center; background-color:#FFFFFF; color:navy;}
+		td  { font-size: 12px; font-family: Verdana, Sans-Serif; text-align:center; background-color:#FFFFFF}
+		.table_black_border {border-style:solid; border-width:1px; border-color:#000000;}
+   </style>
+	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
+	<script type="text/javascript">
+		/*****************************************************************
+		* Script Color Picker �crit par Frosty (Maxime Pacary) - Mai 2003
+		******************************************************************/
+		var detail = 50; // nombre de nuances de couleurs dans la barre de droite
+		var strhex = "0123456789ABCDEF";
+		var i;
+		var is_mouse_down = false;
+		var is_mouse_over = false;
+		function dechex(n) {
+			return strhex.charAt(Math.floor(n/16)) + strhex.charAt(n%16);
+		}
+		function compute_color(e)
+		{
+			x = e.offsetX ? e.offsetX : (e.target ? e.clientX-e.target.x : 0);
+			y = e.offsetY ? e.offsetY : (e.target ? e.clientY-e.target.y : 0);
+			var part_width = document.all ? document.all.color_picker.width/6 : document.getElementById('color_picker').width/6;
+			var part_detail = detail/2;
+			var im_height = document.all ? document.all.color_picker.height : document.getElementById('color_picker').height;
+			var red = (x >= 0)*(x < part_width)*255
+					+ (x >= part_width)*(x < 2*part_width)*(2*255 - x * 255 / part_width)
+					+ (x >= 4*part_width)*(x < 5*part_width)*(-4*255 + x * 255 / part_width)
+					+ (x >= 5*part_width)*(x < 6*part_width)*255;
+			var blue = (x >= 2*part_width)*(x < 3*part_width)*(-2*255 + x * 255 / part_width)
+					+ (x >= 3*part_width)*(x < 5*part_width)*255
+					+ (x >= 5*part_width)*(x < 6*part_width)*(6*255 - x * 255 / part_width);
+			var green = (x >= 0)*(x < part_width)*(x * 255 / part_width)
+					+ (x >= part_width)*(x < 3*part_width)*255
+					+ (x >= 3*part_width)*(x < 4*part_width)*(4*255 - x * 255 / part_width);
+			var coef = (im_height-y)/im_height;
+			red = 128+(red-128)*coef;
+			green = 128+(green-128)*coef;
+			blue = 128+(blue-128)*coef;
+			changeFinalColor('#' + dechex(red) + dechex(green) + dechex(blue));
+			for(i = 0; i < detail; i++)
+			{
+				if ((i >= 0) && (i < part_detail))
+				{
+					var final_coef = i/part_detail ;
+					var final_red = dechex(255 - (255 - red) * final_coef);
+					var final_green = dechex(255 - (255 - green) * final_coef);
+					var final_blue = dechex(255 - (255 - blue) * final_coef);
+				}
+				else
+				{
+					var final_coef = 2 - i/part_detail ;
+					var final_red = dechex(red * final_coef);
+					var final_green = dechex(green * final_coef);
+					var final_blue = dechex(blue * final_coef);
+				}
+				color = final_red + final_green + final_blue ;
+				document.all ? document.all('gs'+i).style.backgroundColor = '#'+color : document.getElementById('gs'+i).style.backgroundColor = '#'+color;
+			}
+		}
+		function changeFinalColor(color)
+		{
+			document.forms['colpick_form'].elements['btn_choose_color'].style.backgroundColor = color;
+			document.forms['colpick_form'].elements['btn_choose_color'].style.borderColor = color;
+		}
+		function send_color()
+		{
+			if (window.opener)
+			{
+			   var new_color = document.forms['colpick_form'].elements['btn_choose_color'].style.backgroundColor;
+			   exp_rgb = new RegExp("rgb","g");
+			   if (exp_rgb.test(new_color))
+			   {
+			   	exp_extract = new RegExp("[0-9]+","g");
+			   	var tab_rgb = new_color.match(exp_extract);
+			      new_color = '#'+dechex(parseInt(tab_rgb[0]))+dechex(parseInt(tab_rgb[1]))+dechex(parseInt(tab_rgb[2]));
+			   }
+                window.opener.document.forms['Form'].elements['<?php echo $name1; ?>'].value = new_color;
+        	     window.opener.document.forms['Form'].elements['<?php echo $name2;?>'].style.borderColor = new_color;
+			   window.opener.document.forms['Form'].elements['<?php echo $name2; ?>'].style.backgroundColor = new_color;
+				window.opener.focus();
+				window.close();
+			}
+		}
+		window.focus();
+	</script>
+</head>
+<body>
+   <form name="colpick_form" action="#" method="post">
+	<h2><?php echo $title; ?></h2>
+	<h3><?php echo $name; ?></h3>
+	<table border="0" cellspacing="0" cellpadding="0" align="center">
+		<tr>
+			<td>
+				<table border="1" cellspacing="0" cellpadding="0" class="table_black_border">
+					<tr>
+						<td style="padding:0px; border-width:0px; border-style:none;">
+							<img id="color_picker" src="colpick.jpg" onclick="compute_color(event)"
+							   onmousedown="is_mouse_down = true; return false;"
+							   onmouseup="is_mouse_down = false;"
+							   onmousemove="if (is_mouse_down && is_mouse_over) compute_color(event); return false;"
+							   onmouseover="is_mouse_over = true;"
+							   onmouseout="is_mouse_over = false;"
+                        style="cursor:crosshair;" /></td>
+						</td>
+					</tr>
+				</table>
+			<td style="background-color:#ffffff; width:20px; height:2px; padding:0px;"></td>
+			<td>
+				<table border="1" cellspacing="0" cellpadding="0" class="table_black_border" style="cursor:crosshair">
+					<script type="text/javascript">
+						for(i = 0; i < detail; i++)
+						{
+							document.write('<tr><td id="gs'+i+'" style="background-color:#000000; width:20px; height:3px; border-style:none; border-width:0px;"'
+                        + ' onclick="changeFinalColor(this.style.backgroundColor)"'
+                        + ' onmousedown="is_mouse_down = true; return false;"'
+                        + ' onmouseup="is_mouse_down = false;"'
+                        + ' onmousemove="if (is_mouse_down && is_mouse_over) changeFinalColor(this.style.backgroundColor); return false;"'
+                        + ' onmouseover="is_mouse_over = true;"'
+				   + ' onmouseout="is_mouse_over = false;"'
+                        + '></td></tr>');
+						}
+					</script>
+				</table>
+			</td>
+		</tr>
+	</table>
+	<br />
+	<table align="center">
+		<tr valign="center">
+			<td><input type="button" name="btn_choose_color" value="&nbsp;" style="background-color:#000000; border-color:#000000; width:100px; height:35px;"></td>
+			<td><input type="button" name="btn_ok" value="Ok" style="width:70px" onclick="send_color();"></td>
+		</tr>
+	</table>
+	</form>
+</body>
+</html>

--- a//dev/null
+++ b/GPL_LIB/Smarty/demo/index.php
@@ -0,0 +1,17 @@
+<?php
+require '../libs/Smarty.class.php';
+$smarty = new Smarty;
+$smarty->compile_check = true;
+$smarty->debugging = true;
+$smarty->assign("Name","Fred Irving Johnathan Bradley Peppergill");
+$smarty->assign("FirstName",array("John","Mary","James","Henry"));
+$smarty->assign("LastName",array("Doe","Smith","Johnson","Case"));
+$smarty->assign("Class",array(array("A","B","C","D"), array("E", "F", "G", "H"),
+	  array("I", "J", "K", "L"), array("M", "N", "O", "P")));
+$smarty->assign("contacts", array(array("phone" => "1", "fax" => "2", "cell" => "3"),
+	  array("phone" => "555-4444", "fax" => "555-3333", "cell" => "760-1234")));
+$smarty->assign("option_values", array("NY","NE","KS","IA","OK","TX"));
+$smarty->assign("option_output", array("New York","Nebraska","Kansas","Iowa","Oklahoma","Texas"));
+$smarty->assign("option_selected", "NE");
+$smarty->display('index.tpl');
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/Config_File.class.php
@@ -0,0 +1,343 @@
+<?php
+/**
+ * Config_File class.
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * @link http://smarty.php.net/
+ * @version 2.6.18
+ * @copyright Copyright: 2001-2005 New Digital Group, Inc.
+ * @author Andrei Zmievski <andrei@php.net>
+ * @access public
+ * @package Smarty
+ */
+/* $Id$ */
+/**
+ * Config file reading class
+ * @package Smarty
+ */
+class Config_File {
+    /**#@+
+     * Options
+     * @var boolean
+     */
+    /**
+     * Controls whether variables with the same name overwrite each other.
+     */
+    var $overwrite        =    true;
+    /**
+     * Controls whether config values of on/true/yes and off/false/no get
+     * converted to boolean values automatically.
+     */
+    var $booleanize        =    true;
+    /**
+     * Controls whether hidden config sections/vars are read from the file.
+     */
+    var $read_hidden     =    true;
+    /**
+     * Controls whether or not to fix mac or dos formatted newlines.
+     * If set to true, \r or \r\n will be changed to \n.
+     */
+    var $fix_newlines =    true;
+    /**#@-*/
+    /** @access private */
+    var $_config_path    = "";
+    var $_config_data    = array();
+    /**#@-*/
+    /**
+     * Constructs a new config file class.
+     *
+     * @param string $config_path (optional) path to the config files
+     */
+    function Config_File($config_path = NULL)
+    {
+        if (isset($config_path))
+            $this->set_path($config_path);
+    }
+    /**
+     * Set the path where configuration files can be found.
+     *
+     * @param string $config_path path to the config files
+     */
+    function set_path($config_path)
+    {
+        if (!empty($config_path)) {
+            if (!is_string($config_path) || !file_exists($config_path) || !is_dir($config_path)) {
+                $this->_trigger_error_msg("Bad config file path '$config_path'");
+                return;
+            }
+            if(substr($config_path, -1) != DIRECTORY_SEPARATOR) {
+                $config_path .= DIRECTORY_SEPARATOR;
+            }
+            $this->_config_path = $config_path;
+        }
+    }
+    /**
+     * Retrieves config info based on the file, section, and variable name.
+     *
+     * @param string $file_name config file to get info for
+     * @param string $section_name (optional) section to get info for
+     * @param string $var_name (optional) variable to get info for
+     * @return string|array a value or array of values
+     */
+    function get($file_name, $section_name = NULL, $var_name = NULL)
+    {
+        if (empty($file_name)) {
+            $this->_trigger_error_msg('Empty config file name');
+            return;
+        } else {
+            $file_name = $this->_config_path . $file_name;
+            if (!isset($this->_config_data[$file_name]))
+                $this->load_file($file_name, false);
+        }
+        if (!empty($var_name)) {
+            if (empty($section_name)) {
+                return $this->_config_data[$file_name]["vars"][$var_name];
+            } else {
+                if(isset($this->_config_data[$file_name]["sections"][$section_name]["vars"][$var_name]))
+                    return $this->_config_data[$file_name]["sections"][$section_name]["vars"][$var_name];
+                else
+                    return array();
+            }
+        } else {
+            if (empty($section_name)) {
+                return (array)$this->_config_data[$file_name]["vars"];
+            } else {
+                if(isset($this->_config_data[$file_name]["sections"][$section_name]["vars"]))
+                    return (array)$this->_config_data[$file_name]["sections"][$section_name]["vars"];
+                else
+                    return array();
+            }
+        }
+    }
+    /**
+     * Retrieves config info based on the key.
+     *
+     * @param $file_name string config key (filename/section/var)
+     * @return string|array same as get()
+     * @uses get() retrieves information from config file and returns it
+     */
+    function &get_key($config_key)
+    {
+        list($file_name, $section_name, $var_name) = explode('/', $config_key, 3);
+        $result = &$this->get($file_name, $section_name, $var_name);
+        return $result;
+    }
+    /**
+     * Get all loaded config file names.
+     *
+     * @return array an array of loaded config file names
+     */
+    function get_file_names()
+    {
+        return array_keys($this->_config_data);
+    }
+    /**
+     * Get all section names from a loaded file.
+     *
+     * @param string $file_name config file to get section names from
+     * @return array an array of section names from the specified file
+     */
+    function get_section_names($file_name)
+    {
+        $file_name = $this->_config_path . $file_name;
+        if (!isset($this->_config_data[$file_name])) {
+            $this->_trigger_error_msg("Unknown config file '$file_name'");
+            return;
+        }
+        return array_keys($this->_config_data[$file_name]["sections"]);
+    }
+    /**
+     * Get all global or section variable names.
+     *
+     * @param string $file_name config file to get info for
+     * @param string $section_name (optional) section to get info for
+     * @return array an array of variables names from the specified file/section
+     */
+    function get_var_names($file_name, $section = NULL)
+    {
+        if (empty($file_name)) {
+            $this->_trigger_error_msg('Empty config file name');
+            return;
+        } else if (!isset($this->_config_data[$file_name])) {
+            $this->_trigger_error_msg("Unknown config file '$file_name'");
+            return;
+        }
+        if (empty($section))
+            return array_keys($this->_config_data[$file_name]["vars"]);
+        else
+            return array_keys($this->_config_data[$file_name]["sections"][$section]["vars"]);
+    }
+    /**
+     * Clear loaded config data for a certain file or all files.
+     *
+     * @param string $file_name file to clear config data for
+     */
+    function clear($file_name = NULL)
+    {
+        if ($file_name === NULL)
+            $this->_config_data = array();
+        else if (isset($this->_config_data[$file_name]))
+            $this->_config_data[$file_name] = array();
+    }
+    /**
+     * Load a configuration file manually.
+     *
+     * @param string $file_name file name to load
+     * @param boolean $prepend_path whether current config path should be
+     *                              prepended to the filename
+     */
+    function load_file($file_name, $prepend_path = true)
+    {
+        if ($prepend_path && $this->_config_path != "")
+            $config_file = $this->_config_path . $file_name;
+        else
+            $config_file = $file_name;
+        ini_set('track_errors', true);
+        $fp = @fopen($config_file, "r");
+        if (!is_resource($fp)) {
+            $this->_trigger_error_msg("Could not open config file '$config_file'");
+            return false;
+        }
+        $contents = ($size = filesize($config_file)) ? fread($fp, $size) : '';
+        fclose($fp);
+        $this->_config_data[$config_file] = $this->parse_contents($contents);
+        return true;
+    }
+    /**
+     * Store the contents of a file manually.
+     *
+     * @param string $config_file file name of the related contents
+     * @param string $contents the file-contents to parse
+     */
+    function set_file_contents($config_file, $contents)
+    {
+        $this->_config_data[$config_file] = $this->parse_contents($contents);
+        return true;
+    }
+    /**
+     * parse the source of a configuration file manually.
+     *
+     * @param string $contents the file-contents to parse
+     */
+    function parse_contents($contents)
+    {
+        if($this->fix_newlines) {
+            $contents = preg_replace('!\r\n?!', "\n", $contents);
+        }
+        $config_data = array();
+        $config_data['sections'] = array();
+        $config_data['vars'] = array();
+        /* reference to fill with data */
+        $vars =& $config_data['vars'];
+        /* parse file line by line */
+        preg_match_all('!^.*\r?\n?!m', $contents, $match);
+        $lines = $match[0];
+        for ($i=0, $count=count($lines); $i<$count; $i++) {
+            $line = $lines[$i];
+            if (empty($line)) continue;
+            if ( substr($line, 0, 1) == '[' && preg_match('!^\[(.*?)\]!', $line, $match) ) {
+                /* section found */
+                if (substr($match[1], 0, 1) == '.') {
+                    /* hidden section */
+                    if ($this->read_hidden) {
+                        $section_name = substr($match[1], 1);
+                    } else {
+                        /* break reference to $vars to ignore hidden section */
+                        unset($vars);
+                        $vars = array();
+                        continue;
+                    }
+                } else {                    
+                    $section_name = $match[1];
+                }
+                if (!isset($config_data['sections'][$section_name]))
+                    $config_data['sections'][$section_name] = array('vars' => array());
+                $vars =& $config_data['sections'][$section_name]['vars'];
+                continue;
+            }
+            if (preg_match('/^\s*(\.?\w+)\s*=\s*(.*)/s', $line, $match)) {
+                /* variable found */
+                $var_name = rtrim($match[1]);
+                if (strpos($match[2], '"""') === 0) {
+                    /* handle multiline-value */
+                    $lines[$i] = substr($match[2], 3);
+                    $var_value = '';
+                    while ($i<$count) {
+                        if (($pos = strpos($lines[$i], '"""')) === false) {
+                            $var_value .= $lines[$i++];
+                        } else {
+                            /* end of multiline-value */
+                            $var_value .= substr($lines[$i], 0, $pos);
+                            break;
+                        }
+                    }
+                    $booleanize = false;
+                } else {
+                    /* handle simple value */
+                    $var_value = preg_replace('/^([\'"])(.*)\1$/', '\2', rtrim($match[2]));
+                    $booleanize = $this->booleanize;
+                }
+                $this->_set_config_var($vars, $var_name, $var_value, $booleanize);
+            }
+            /* else unparsable line / means it is a comment / means ignore it */
+        }
+        return $config_data;
+    }
+    /**#@+ @access private */
+    /**
+     * @param array &$container
+     * @param string $var_name
+     * @param mixed $var_value
+     * @param boolean $booleanize determines whether $var_value is converted to
+     *                            to true/false
+     */
+    function _set_config_var(&$container, $var_name, $var_value, $booleanize)
+    {
+        if (substr($var_name, 0, 1) == '.') {
+            if (!$this->read_hidden)
+                return;
+            else
+                $var_name = substr($var_name, 1);
+        }
+        if (!preg_match("/^[a-zA-Z_]\w*$/", $var_name)) {
+            $this->_trigger_error_msg("Bad variable name '$var_name'");
+            return;
+        }
+        if ($booleanize) {
+            if (preg_match("/^(on|true|yes)$/i", $var_value))
+                $var_value = true;
+            else if (preg_match("/^(off|false|no)$/i", $var_value))
+                $var_value = false;
+        }
+        if (!isset($container[$var_name]) || $this->overwrite)
+            $container[$var_name] = $var_value;
+        else {
+            settype($container[$var_name], 'array');
+            $container[$var_name][] = $var_value;
+        }
+    }
+    /**
+     * @uses trigger_error() creates a PHP warning/error
+     * @param string $error_msg
+     * @param integer $error_type one of
+     */
+    function _trigger_error_msg($error_msg, $error_type = E_USER_WARNING)
+    {
+        trigger_error("Config_File error: $error_msg", $error_type);
+    }
+    /**#@-*/
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/Smarty.class.php
@@ -0,0 +1,1680 @@
+<?php
+/**
+ * Project:     Smarty: the PHP compiling template engine
+ * File:        Smarty.class.php
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * For questions, help, comments, discussion, etc., please join the
+ * Smarty mailing list. Send a blank e-mail to
+ * smarty-general-subscribe@lists.php.net
+ *
+ * @link http://smarty.php.net/
+ * @copyright 2001-2005 New Digital Group, Inc.
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @author Andrei Zmievski <andrei@php.net>
+ * @package Smarty
+ * @version 2.6.18
+ */
+/* $Id$ */
+/**
+ * DIR_SEP isn't used anymore, but third party apps might
+ */
+if(!defined('DIR_SEP')) {
+    define('DIR_SEP', DIRECTORY_SEPARATOR);
+}
+/**
+ * set SMARTY_DIR to absolute path to Smarty library files.
+ * if not defined, include_path will be used. Sets SMARTY_DIR only if user
+ * application has not already defined it.
+ */
+if (!defined('SMARTY_DIR')) {
+    define('SMARTY_DIR', dirname(__FILE__) . DIRECTORY_SEPARATOR);
+}
+if (!defined('SMARTY_CORE_DIR')) {
+    define('SMARTY_CORE_DIR', SMARTY_DIR . 'internals' . DIRECTORY_SEPARATOR);
+}
+define('SMARTY_PHP_PASSTHRU',   0);
+define('SMARTY_PHP_QUOTE',      1);
+define('SMARTY_PHP_REMOVE',     2);
+define('SMARTY_PHP_ALLOW',      3);
+/**
+ * @package Smarty
+ */
+class Smarty
+{
+    /**#@+
+     * Smarty Configuration Section
+     */
+    /**
+     * The name of the directory where templates are located.
+     *
+     * @var string
+     */
+    var $template_dir    =  'templates';
+    /**
+     * The directory where compiled templates are located.
+     *
+     * @var string
+     */
+    var $compile_dir     =  'templates_c';
+    /**
+     * The directory where config files are located.
+     *
+     * @var string
+     */
+    var $config_dir      =  'configs';
+    /**
+     * An array of directories searched for plugins.
+     *
+     * @var array
+     */
+    var $plugins_dir     =  array('plugins');
+    /**
+     * If debugging is enabled, a debug console window will display
+     * when the page loads (make sure your browser allows unrequested
+     * popup windows)
+     *
+     * @var boolean
+     */
+    var $debugging       =  false;
+    /**
+     * When set, smarty does uses this value as error_reporting-level.
+     *
+     * @var boolean
+     */
+    var $error_reporting  =  null;
+    /**
+     * This is the path to the debug console template. If not set,
+     * the default one will be used.
+     *
+     * @var string
+     */
+    var $debug_tpl       =  '';
+    /**
+     * This determines if debugging is enable-able from the browser.
+     * <ul>
+     *  <li>NONE => no debugging control allowed</li>
+     *  <li>URL => enable debugging when SMARTY_DEBUG is found in the URL.</li>
+     * </ul>
+     * @link http://www.foo.dom/index.php?SMARTY_DEBUG
+     * @var string
+     */
+    var $debugging_ctrl  =  'NONE';
+    /**
+     * This tells Smarty whether to check for recompiling or not. Recompiling
+     * does not need to happen unless a template or config file is changed.
+     * Typically you enable this during development, and disable for
+     * production.
+     *
+     * @var boolean
+     */
+    var $compile_check   =  true;
+    /**
+     * This forces templates to compile every time. Useful for development
+     * or debugging.
+     *
+     * @var boolean
+     */
+    var $force_compile   =  false;
+    /**
+     * This enables template caching.
+     * <ul>
+     *  <li>0 = no caching</li>
+     *  <li>1 = use class cache_lifetime value</li>
+     *  <li>2 = use cache_lifetime in cache file</li>
+     * </ul>
+     * @var integer
+     */
+    var $caching         =  0;
+    /**
+     * The name of the directory for cache files.
+     *
+     * @var string
+     */
+    var $cache_dir       =  'cache';
+    /**
+     * This is the number of seconds cached content will persist.
+     * <ul>
+     *  <li>0 = always regenerate cache</li>
+     *  <li>-1 = never expires</li>
+     * </ul>
+     *
+     * @var integer
+     */
+    var $cache_lifetime  =  3600;
+    /**
+     * Only used when $caching is enabled. If true, then If-Modified-Since headers
+     * are respected with cached content, and appropriate HTTP headers are sent.
+     * This way repeated hits to a cached page do not send the entire page to the
+     * client every time.
+     *
+     * @var boolean
+     */
+    var $cache_modified_check = false;
+    /**
+     * This determines how Smarty handles "<?php ... ?>" tags in templates.
+     * possible values:
+     * <ul>
+     *  <li>SMARTY_PHP_PASSTHRU -> print tags as plain text</li>
+     *  <li>SMARTY_PHP_QUOTE    -> escape tags as entities</li>
+     *  <li>SMARTY_PHP_REMOVE   -> remove php tags</li>
+     *  <li>SMARTY_PHP_ALLOW    -> execute php tags</li>
+     * </ul>
+     *
+     * @var integer
+     */
+    var $php_handling    =  SMARTY_PHP_PASSTHRU;
+    /**
+     * This enables template security. When enabled, many things are restricted
+     * in the templates that normally would go unchecked. This is useful when
+     * untrusted parties are editing templates and you want a reasonable level
+     * of security. (no direct execution of PHP in templates for example)
+     *
+     * @var boolean
+     */
+    var $security       =   false;
+    /**
+     * This is the list of template directories that are considered secure. This
+     * is used only if {@link $security} is enabled. One directory per array
+     * element.  {@link $template_dir} is in this list implicitly.
+     *
+     * @var array
+     */
+    var $secure_dir     =   array();
+    /**
+     * These are the security settings for Smarty. They are used only when
+     * {@link $security} is enabled.
+     *
+     * @var array
+     */
+    var $security_settings  = array(
+                                    'PHP_HANDLING'    => false,
+                                    'IF_FUNCS'        => array('array', 'list',
+                                                               'isset', 'empty',
+                                                               'count', 'sizeof',
+                                                               'in_array', 'is_array',
+                                                               'true', 'false', 'null'),
+                                    'INCLUDE_ANY'     => false,
+                                    'PHP_TAGS'        => false,
+                                    'MODIFIER_FUNCS'  => array('count'),
+                                    'ALLOW_CONSTANTS'  => false
+                                   );
+    /**
+     * This is an array of directories where trusted php scripts reside.
+     * {@link $security} is disabled during their inclusion/execution.
+     *
+     * @var array
+     */
+    var $trusted_dir        = array();
+    /**
+     * The left delimiter used for the template tags.
+     *
+     * @var string
+     */
+    var $left_delimiter  =  '{';
+    /**
+     * The right delimiter used for the template tags.
+     *
+     * @var string
+     */
+    var $right_delimiter =  '}';
+    /**
+     * The order in which request variables are registered, similar to
+     * variables_order in php.ini E = Environment, G = GET, P = POST,
+     * C = Cookies, S = Server
+     *
+     * @var string
+     */
+    var $request_vars_order    = 'EGPCS';
+    /**
+     * Indicates wether $HTTP_*_VARS[] (request_use_auto_globals=false)
+     * are uses as request-vars or $_*[]-vars. note: if
+     * request_use_auto_globals is true, then $request_vars_order has
+     * no effect, but the php-ini-value "gpc_order"
+     *
+     * @var boolean
+     */
+    var $request_use_auto_globals      = true;
+    /**
+     * Set this if you want different sets of compiled files for the same
+     * templates. This is useful for things like different languages.
+     * Instead of creating separate sets of templates per language, you
+     * set different compile_ids like 'en' and 'de'.
+     *
+     * @var string
+     */
+    var $compile_id            = null;
+    /**
+     * This tells Smarty whether or not to use sub dirs in the cache/ and
+     * templates_c/ directories. sub directories better organized, but
+     * may not work well with PHP safe mode enabled.
+     *
+     * @var boolean
+     *
+     */
+    var $use_sub_dirs          = false;
+    /**
+     * This is a list of the modifiers to apply to all template variables.
+     * Put each modifier in a separate array element in the order you want
+     * them applied. example: <code>array('escape:"htmlall"');</code>
+     *
+     * @var array
+     */
+    var $default_modifiers        = array();
+    /**
+     * This is the resource type to be used when not specified
+     * at the beginning of the resource path. examples:
+     * $smarty->display('file:index.tpl');
+     * $smarty->display('db:index.tpl');
+     * $smarty->display('index.tpl'); // will use default resource type
+     * {include file="file:index.tpl"}
+     * {include file="db:index.tpl"}
+     * {include file="index.tpl"} {* will use default resource type *}
+     *
+     * @var array
+     */
+    var $default_resource_type    = 'file';
+    /**
+     * The function used for cache file handling. If not set, built-in caching is used.
+     *
+     * @var null|string function name
+     */
+    var $cache_handler_func   = null;
+    /**
+     * This indicates which filters are automatically loaded into Smarty.
+     *
+     * @var array array of filter names
+     */
+    var $autoload_filters = array();
+    /**#@+
+     * @var boolean
+     */
+    /**
+     * This tells if config file vars of the same name overwrite each other or not.
+     * if disabled, same name variables are accumulated in an array.
+     */
+    var $config_overwrite = true;
+    /**
+     * This tells whether or not to automatically booleanize config file variables.
+     * If enabled, then the strings "on", "true", and "yes" are treated as boolean
+     * true, and "off", "false" and "no" are treated as boolean false.
+     */
+    var $config_booleanize = true;
+    /**
+     * This tells whether hidden sections [.foobar] are readable from the
+     * tempalates or not. Normally you would never allow this since that is
+     * the point behind hidden sections: the application can access them, but
+     * the templates cannot.
+     */
+    var $config_read_hidden = false;
+    /**
+     * This tells whether or not automatically fix newlines in config files.
+     * It basically converts \r (mac) or \r\n (dos) to \n
+     */
+    var $config_fix_newlines = true;
+    /**#@-*/
+    /**
+     * If a template cannot be found, this PHP function will be executed.
+     * Useful for creating templates on-the-fly or other special action.
+     *
+     * @var string function name
+     */
+    var $default_template_handler_func = '';
+    /**
+     * The file that contains the compiler class. This can a full
+     * pathname, or relative to the php_include path.
+     *
+     * @var string
+     */
+    var $compiler_file        =    'Smarty_Compiler.class.php';
+    /**
+     * The class used for compiling templates.
+     *
+     * @var string
+     */
+    var $compiler_class        =   'Smarty_Compiler';
+    /**
+     * The class used to load config vars.
+     *
+     * @var string
+     */
+    var $config_class          =   'Config_File';
+/**#@+
+ * END Smarty Configuration Section
+ * There should be no need to touch anything below this line.
+ * @access private
+ */
+    /**
+     * where assigned template vars are kept
+     *
+     * @var array
+     */
+    var $_tpl_vars             = array();
+    /**
+     * stores run-time $smarty.* vars
+     *
+     * @var null|array
+     */
+    var $_smarty_vars          = null;
+    /**
+     * keeps track of sections
+     *
+     * @var array
+     */
+    var $_sections             = array();
+    /**
+     * keeps track of foreach blocks
+     *
+     * @var array
+     */
+    var $_foreach              = array();
+    /**
+     * keeps track of tag hierarchy
+     *
+     * @var array
+     */
+    var $_tag_stack            = array();
+    /**
+     * configuration object
+     *
+     * @var Config_file
+     */
+    var $_conf_obj             = null;
+    /**
+     * loaded configuration settings
+     *
+     * @var array
+     */
+    var $_config               = array(array('vars'  => array(), 'files' => array()));
+    /**
+     * md5 checksum of the string 'Smarty'
+     *
+     * @var string
+     */
+    var $_smarty_md5           = 'f8d698aea36fcbead2b9d5359ffca76f';
+    /**
+     * Smarty version number
+     *
+     * @var string
+     */
+    var $_version              = '2.6.18';
+    /**
+     * current template inclusion depth
+     *
+     * @var integer
+     */
+    var $_inclusion_depth      = 0;
+    /**
+     * for different compiled templates
+     *
+     * @var string
+     */
+    var $_compile_id           = null;
+    /**
+     * text in URL to enable debug mode
+     *
+     * @var string
+     */
+    var $_smarty_debug_id      = 'SMARTY_DEBUG';
+    /**
+     * debugging information for debug console
+     *
+     * @var array
+     */
+    var $_smarty_debug_info    = array();
+    /**
+     * info that makes up a cache file
+     *
+     * @var array
+     */
+    var $_cache_info           = array();
+    /**
+     * default file permissions
+     *
+     * @var integer
+     */
+    var $_file_perms           = 0644;
+    /**
+     * default dir permissions
+     *
+     * @var integer
+     */
+    var $_dir_perms               = 0771;
+    /**
+     * registered objects
+     *
+     * @var array
+     */
+    var $_reg_objects           = array();
+    /**
+     * table keeping track of plugins
+     *
+     * @var array
+     */
+    var $_plugins              = array(
+                                       'modifier'      => array(),
+                                       'function'      => array(),
+                                       'block'         => array(),
+                                       'compiler'      => array(),
+                                       'prefilter'     => array(),
+                                       'postfilter'    => array(),
+                                       'outputfilter'  => array(),
+                                       'resource'      => array(),
+                                       'insert'        => array());
+    /**
+     * cache serials
+     *
+     * @var array
+     */
+    var $_cache_serials = array();
+    /**
+     * name of optional cache include file
+     *
+     * @var string
+     */
+    var $_cache_include = null;
+    /**
+     * indicate if the current code is used in a compiled
+     * include
+     *
+     * @var string
+     */
+    var $_cache_including = false;
+    /**#@-*/
+    /**
+     * The class constructor.
+     */
+    function Smarty()
+    {
+      $this->assign('SCRIPT_NAME', isset($_SERVER['SCRIPT_NAME']) ? $_SERVER['SCRIPT_NAME']
+                    : @$GLOBALS['HTTP_SERVER_VARS']['SCRIPT_NAME']);
+    }
+    /**
+     * assigns values to template variables
+     *
+     * @param array|string $tpl_var the template variable name(s)
+     * @param mixed $value the value to assign
+     */
+    function assign($tpl_var, $value = null)
+    {
+        if (is_array($tpl_var)){
+            foreach ($tpl_var as $key => $val) {
+                if ($key != '') {
+                    $this->_tpl_vars[$key] = $val;
+                }
+            }
+        } else {
+            if ($tpl_var != '')
+                $this->_tpl_vars[$tpl_var] = $value;
+        }
+    }
+    /**
+     * assigns values to template variables by reference
+     *
+     * @param string $tpl_var the template variable name
+     * @param mixed $value the referenced value to assign
+     */
+    function assign_by_ref($tpl_var, &$value)
+    {
+        if ($tpl_var != '')
+            $this->_tpl_vars[$tpl_var] = &$value;
+    }
+    /**
+     * appends values to template variables
+     *
+     * @param array|string $tpl_var the template variable name(s)
+     * @param mixed $value the value to append
+     */
+    function append($tpl_var, $value=null, $merge=false)
+    {
+        if (is_array($tpl_var)) {
+            foreach ($tpl_var as $_key => $_val) {
+                if ($_key != '') {
+                    if(!@is_array($this->_tpl_vars[$_key])) {
+                        settype($this->_tpl_vars[$_key],'array');
+                    }
+                    if($merge && is_array($_val)) {
+                        foreach($_val as $_mkey => $_mval) {
+                            $this->_tpl_vars[$_key][$_mkey] = $_mval;
+                        }
+                    } else {
+                        $this->_tpl_vars[$_key][] = $_val;
+                    }
+                }
+            }
+        } else {
+            if ($tpl_var != '' && isset($value)) {
+                if(!@is_array($this->_tpl_vars[$tpl_var])) {
+                    settype($this->_tpl_vars[$tpl_var],'array');
+                }
+                if($merge && is_array($value)) {
+                    foreach($value as $_mkey => $_mval) {
+                        $this->_tpl_vars[$tpl_var][$_mkey] = $_mval;
+                    }
+                } else {
+                    $this->_tpl_vars[$tpl_var][] = $value;
+                }
+            }
+        }
+    }
+    /**
+     * appends values to template variables by reference
+     *
+     * @param string $tpl_var the template variable name
+     * @param mixed $value the referenced value to append
+     */
+    function append_by_ref($tpl_var, &$value, $merge=false)
+    {
+        if ($tpl_var != '' && isset($value)) {
+            if(!@is_array($this->_tpl_vars[$tpl_var])) {
+             settype($this->_tpl_vars[$tpl_var],'array');
+            }
+            if ($merge && is_array($value)) {
+                foreach($value as $_key => $_val) {
+                    $this->_tpl_vars[$tpl_var][$_key] = &$value[$_key];
+                }
+            } else {
+                $this->_tpl_vars[$tpl_var][] = &$value;
+            }
+        }
+    }
+    /**
+     * clear the given assigned template variable.
+     *
+     * @param string $tpl_var the template variable to clear
+     */
+    function clear_assign($tpl_var)
+    {
+        if (is_array($tpl_var))
+            foreach ($tpl_var as $curr_var)
+                unset($this->_tpl_vars[$curr_var]);
+        else
+            unset($this->_tpl_vars[$tpl_var]);
+    }
+    /**
+     * Registers custom function to be used in templates
+     *
+     * @param string $function the name of the template function
+     * @param string $function_impl the name of the PHP function to register
+     */
+    function register_function($function, $function_impl, $cacheable=true, $cache_attrs=null)
+    {
+        $this->_plugins['function'][$function] =
+            array($function_impl, null, null, false, $cacheable, $cache_attrs);
+    }
+    /**
+     * Unregisters custom function
+     *
+     * @param string $function name of template function
+     */
+    function unregister_function($function)
+    {
+        unset($this->_plugins['function'][$function]);
+    }
+    /**
+     * Registers object to be used in templates
+     *
+     * @param string $object name of template object
+     * @param object &$object_impl the referenced PHP object to register
+     * @param null|array $allowed list of allowed methods (empty = all)
+     * @param boolean $smarty_args smarty argument format, else traditional
+     * @param null|array $block_functs list of methods that are block format
+     */
+    function register_object($object, &$object_impl, $allowed = array(), $smarty_args = true, $block_methods = array())
+    {
+        settype($allowed, 'array');
+        settype($smarty_args, 'boolean');
+        $this->_reg_objects[$object] =
+            array(&$object_impl, $allowed, $smarty_args, $block_methods);
+    }
+    /**
+     * Unregisters object
+     *
+     * @param string $object name of template object
+     */
+    function unregister_object($object)
+    {
+        unset($this->_reg_objects[$object]);
+    }
+    /**
+     * Registers block function to be used in templates
+     *
+     * @param string $block name of template block
+     * @param string $block_impl PHP function to register
+     */
+    function register_block($block, $block_impl, $cacheable=true, $cache_attrs=null)
+    {
+        $this->_plugins['block'][$block] =
+            array($block_impl, null, null, false, $cacheable, $cache_attrs);
+    }
+    /**
+     * Unregisters block function
+     *
+     * @param string $block name of template function
+     */
+    function unregister_block($block)
+    {
+        unset($this->_plugins['block'][$block]);
+    }
+    /**
+     * Registers compiler function
+     *
+     * @param string $function name of template function
+     * @param string $function_impl name of PHP function to register
+     */
+    function register_compiler_function($function, $function_impl, $cacheable=true)
+    {
+        $this->_plugins['compiler'][$function] =
+            array($function_impl, null, null, false, $cacheable);
+    }
+    /**
+     * Unregisters compiler function
+     *
+     * @param string $function name of template function
+     */
+    function unregister_compiler_function($function)
+    {
+        unset($this->_plugins['compiler'][$function]);
+    }
+    /**
+     * Registers modifier to be used in templates
+     *
+     * @param string $modifier name of template modifier
+     * @param string $modifier_impl name of PHP function to register
+     */
+    function register_modifier($modifier, $modifier_impl)
+    {
+        $this->_plugins['modifier'][$modifier] =
+            array($modifier_impl, null, null, false);
+    }
+    /**
+     * Unregisters modifier
+     *
+     * @param string $modifier name of template modifier
+     */
+    function unregister_modifier($modifier)
+    {
+        unset($this->_plugins['modifier'][$modifier]);
+    }
+    /**
+     * Registers a resource to fetch a template
+     *
+     * @param string $type name of resource
+     * @param array $functions array of functions to handle resource
+     */
+    function register_resource($type, $functions)
+    {
+        if (count($functions)==4) {
+            $this->_plugins['resource'][$type] =
+                array($functions, false);
+        } elseif (count($functions)==5) {
+            $this->_plugins['resource'][$type] =
+                array(array(array(&$functions[0], $functions[1])
+                            ,array(&$functions[0], $functions[2])
+                            ,array(&$functions[0], $functions[3])
+                            ,array(&$functions[0], $functions[4]))
+                      ,false);
+        } else {
+            $this->trigger_error("malformed function-list for '$type' in register_resource");
+        }
+    }
+    /**
+     * Unregisters a resource
+     *
+     * @param string $type name of resource
+     */
+    function unregister_resource($type)
+    {
+        unset($this->_plugins['resource'][$type]);
+    }
+    /**
+     * Registers a prefilter function to apply
+     * to a template before compiling
+     *
+     * @param string $function name of PHP function to register
+     */
+    function register_prefilter($function)
+    {
+    $_name = (is_array($function)) ? $function[1] : $function;
+        $this->_plugins['prefilter'][$_name]
+            = array($function, null, null, false);
+    }
+    /**
+     * Unregisters a prefilter function
+     *
+     * @param string $function name of PHP function
+     */
+    function unregister_prefilter($function)
+    {
+        unset($this->_plugins['prefilter'][$function]);
+    }
+    /**
+     * Registers a postfilter function to apply
+     * to a compiled template after compilation
+     *
+     * @param string $function name of PHP function to register
+     */
+    function register_postfilter($function)
+    {
+    $_name = (is_array($function)) ? $function[1] : $function;
+        $this->_plugins['postfilter'][$_name]
+            = array($function, null, null, false);
+    }
+    /**
+     * Unregisters a postfilter function
+     *
+     * @param string $function name of PHP function
+     */
+    function unregister_postfilter($function)
+    {
+        unset($this->_plugins['postfilter'][$function]);
+    }
+    /**
+     * Registers an output filter function to apply
+     * to a template output
+     *
+     * @param string $function name of PHP function
+     */
+    function register_outputfilter($function)
+    {
+    $_name = (is_array($function)) ? $function[1] : $function;
+        $this->_plugins['outputfilter'][$_name]
+            = array($function, null, null, false);
+    }
+    /**
+     * Unregisters an outputfilter function
+     *
+     * @param string $function name of PHP function
+     */
+    function unregister_outputfilter($function)
+    {
+        unset($this->_plugins['outputfilter'][$function]);
+    }
+    /**
+     * load a filter of specified type and name
+     *
+     * @param string $type filter type
+     * @param string $name filter name
+     */
+    function load_filter($type, $name)
+    {
+        switch ($type) {
+            case 'output':
+                $_params = array('plugins' => array(array($type . 'filter', $name, null, null, false)));
+                require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
+                smarty_core_load_plugins($_params, $this);
+                break;
+            case 'pre':
+            case 'post':
+                if (!isset($this->_plugins[$type . 'filter'][$name]))
+                    $this->_plugins[$type . 'filter'][$name] = false;
+                break;
+        }
+    }
+    /**
+     * clear cached content for the given template and cache id
+     *
+     * @param string $tpl_file name of template file
+     * @param string $cache_id name of cache_id
+     * @param string $compile_id name of compile_id
+     * @param string $exp_time expiration time
+     * @return boolean
+     */
+    function clear_cache($tpl_file = null, $cache_id = null, $compile_id = null, $exp_time = null)
+    {
+        if (!isset($compile_id))
+            $compile_id = $this->compile_id;
+        if (!isset($tpl_file))
+            $compile_id = null;
+        $_auto_id = $this->_get_auto_id($cache_id, $compile_id);
+        if (!empty($this->cache_handler_func)) {
+            return call_user_func_array($this->cache_handler_func,
+                                  array('clear', &$this, &$dummy, $tpl_file, $cache_id, $compile_id, $exp_time));
+        } else {
+            $_params = array('auto_base' => $this->cache_dir,
+                            'auto_source' => $tpl_file,
+                            'auto_id' => $_auto_id,
+                            'exp_time' => $exp_time);
+            require_once(SMARTY_CORE_DIR . 'core.rm_auto.php');
+            return smarty_core_rm_auto($_params, $this);
+        }
+    }
+    /**
+     * clear the entire contents of cache (all templates)
+     *
+     * @param string $exp_time expire time
+     * @return boolean results of {@link smarty_core_rm_auto()}
+     */
+    function clear_all_cache($exp_time = null)
+    {
+        return $this->clear_cache(null, null, null, $exp_time);
+    }
+    /**
+     * test to see if valid cache exists for this template
+     *
+     * @param string $tpl_file name of template file
+     * @param string $cache_id
+     * @param string $compile_id
+     * @return string|false results of {@link _read_cache_file()}
+     */
+    function is_cached($tpl_file, $cache_id = null, $compile_id = null)
+    {
+        if (!$this->caching)
+            return false;
+        if (!isset($compile_id))
+            $compile_id = $this->compile_id;
+        $_params = array(
+            'tpl_file' => $tpl_file,
+            'cache_id' => $cache_id,
+            'compile_id' => $compile_id
+        );
+        require_once(SMARTY_CORE_DIR . 'core.read_cache_file.php');
+        return smarty_core_read_cache_file($_params, $this);
+    }
+    /**
+     * clear all the assigned template variables.
+     *
+     */
+    function clear_all_assign()
+    {
+        $this->_tpl_vars = array();
+    }
+    /**
+     * clears compiled version of specified template resource,
+     * or all compiled template files if one is not specified.
+     * This function is for advanced use only, not normally needed.
+     *
+     * @param string $tpl_file
+     * @param string $compile_id
+     * @param string $exp_time
+     * @return boolean results of {@link smarty_core_rm_auto()}
+     */
+    function clear_compiled_tpl($tpl_file = null, $compile_id = null, $exp_time = null)
+    {
+        if (!isset($compile_id)) {
+            $compile_id = $this->compile_id;
+        }
+        $_params = array('auto_base' => $this->compile_dir,
+                        'auto_source' => $tpl_file,
+                        'auto_id' => $compile_id,
+                        'exp_time' => $exp_time,
+                        'extensions' => array('.inc', '.php'));
+        require_once(SMARTY_CORE_DIR . 'core.rm_auto.php');
+        return smarty_core_rm_auto($_params, $this);
+    }
+    /**
+     * Checks whether requested template exists.
+     *
+     * @param string $tpl_file
+     * @return boolean
+     */
+    function template_exists($tpl_file)
+    {
+        $_params = array('resource_name' => $tpl_file, 'quiet'=>true, 'get_source'=>false);
+        return $this->_fetch_resource_info($_params);
+    }
+    /**
+     * Returns an array containing template variables
+     *
+     * @param string $name
+     * @param string $type
+     * @return array
+     */
+    function &get_template_vars($name=null)
+    {
+        if(!isset($name)) {
+            return $this->_tpl_vars;
+        } elseif(isset($this->_tpl_vars[$name])) {
+            return $this->_tpl_vars[$name];
+        } else {
+            $_tmp = null;
+            return $_tmp;   
+        }
+    }
+    /**
+     * Returns an array containing config variables
+     *
+     * @param string $name
+     * @param string $type
+     * @return array
+     */
+    function &get_config_vars($name=null)
+    {
+        if(!isset($name) && is_array($this->_config[0])) {
+            return $this->_config[0]['vars'];
+        } else if(isset($this->_config[0]['vars'][$name])) {
+            return $this->_config[0]['vars'][$name];
+        } else {
+            $_tmp = null;
+            return $_tmp;
+        }
+    }
+    /**
+     * trigger Smarty error
+     *
+     * @param string $error_msg
+     * @param integer $error_type
+     */
+    function trigger_error($error_msg, $error_type = E_USER_WARNING)
+    {
+        trigger_error("Smarty error: $error_msg", $error_type);
+    }
+    /**
+     * executes & displays the template results
+     *
+     * @param string $resource_name
+     * @param string $cache_id
+     * @param string $compile_id
+     */
+    function display($resource_name, $cache_id = null, $compile_id = null)
+    {
+        $this->fetch($resource_name, $cache_id, $compile_id, true);
+    }
+    /**
+     * executes & returns or displays the template results
+     *
+     * @param string $resource_name
+     * @param string $cache_id
+     * @param string $compile_id
+     * @param boolean $display
+     */
+    function fetch($resource_name, $cache_id = null, $compile_id = null, $display = false)
+    {
+        static $_cache_info = array();
+        $_smarty_old_error_level = $this->debugging ? error_reporting() : error_reporting(isset($this->error_reporting)
+               ? $this->error_reporting : error_reporting() & ~E_NOTICE);
+        if (!$this->debugging && $this->debugging_ctrl == 'URL') {
+            $_query_string = $this->request_use_auto_globals ? $_SERVER['QUERY_STRING'] : $GLOBALS['HTTP_SERVER_VARS']['QUERY_STRING'];
+            if (@strstr($_query_string, $this->_smarty_debug_id)) {
+                if (@strstr($_query_string, $this->_smarty_debug_id . '=on')) {
+                    @setcookie('SMARTY_DEBUG', true);
+                    $this->debugging = true;
+                } elseif (@strstr($_query_string, $this->_smarty_debug_id . '=off')) {
+                    @setcookie('SMARTY_DEBUG', false);
+                    $this->debugging = false;
+                } else {
+                    $this->debugging = true;
+                }
+            } else {
+                $this->debugging = (bool)($this->request_use_auto_globals ? @$_COOKIE['SMARTY_DEBUG'] : @$GLOBALS['HTTP_COOKIE_VARS']['SMARTY_DEBUG']);
+            }
+        }
+        if ($this->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $_debug_start_time = smarty_core_get_microtime($_params, $this);
+            $this->_smarty_debug_info[] = array('type'      => 'template',
+                                                'filename'  => $resource_name,
+                                                'depth'     => 0);
+            $_included_tpls_idx = count($this->_smarty_debug_info) - 1;
+        }
+        if (!isset($compile_id)) {
+            $compile_id = $this->compile_id;
+        }
+        $this->_compile_id = $compile_id;
+        $this->_inclusion_depth = 0;
+        if ($this->caching) {
+            array_push($_cache_info, $this->_cache_info);
+            $this->_cache_info = array();
+            $_params = array(
+                'tpl_file' => $resource_name,
+                'cache_id' => $cache_id,
+                'compile_id' => $compile_id,
+                'results' => null
+            );
+            require_once(SMARTY_CORE_DIR . 'core.read_cache_file.php');
+            if (smarty_core_read_cache_file($_params, $this)) {
+                $_smarty_results = $_params['results'];
+                if (!empty($this->_cache_info['insert_tags'])) {
+                    $_params = array('plugins' => $this->_cache_info['insert_tags']);
+                    require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
+                    smarty_core_load_plugins($_params, $this);
+                    $_params = array('results' => $_smarty_results);
+                    require_once(SMARTY_CORE_DIR . 'core.process_cached_inserts.php');
+                    $_smarty_results = smarty_core_process_cached_inserts($_params, $this);
+                }
+                if (!empty($this->_cache_info['cache_serials'])) {
+                    $_params = array('results' => $_smarty_results);
+                    require_once(SMARTY_CORE_DIR . 'core.process_compiled_include.php');
+                    $_smarty_results = smarty_core_process_compiled_include($_params, $this);
+                }
+                if ($display) {
+                    if ($this->debugging)
+                    {
+                        $_params = array();
+                        require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+                        $this->_smarty_debug_info[$_included_tpls_idx]['exec_time'] = smarty_core_get_microtime($_params, $this) - $_debug_start_time;
+                        require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
+                        $_smarty_results .= smarty_core_display_debug_console($_params, $this);
+                    }
+                    if ($this->cache_modified_check) {
+                        $_server_vars = ($this->request_use_auto_globals) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];
+                        $_last_modified_date = @substr($_server_vars['HTTP_IF_MODIFIED_SINCE'], 0, strpos($_server_vars['HTTP_IF_MODIFIED_SINCE'], 'GMT') + 3);
+                        $_gmt_mtime = gmdate('D, d M Y H:i:s', $this->_cache_info['timestamp']).' GMT';
+                        if (@count($this->_cache_info['insert_tags']) == 0
+                            && !$this->_cache_serials
+                            && $_gmt_mtime == $_last_modified_date) {
+                            if (php_sapi_name()=='cgi')
+                                header('Status: 304 Not Modified');
+                            else
+                                header('HTTP/1.1 304 Not Modified');
+                        } else {
+                            header('Last-Modified: '.$_gmt_mtime);
+                            echo $_smarty_results;
+                        }
+                    } else {
+                            echo $_smarty_results;
+                    }
+                    error_reporting($_smarty_old_error_level);
+                    $this->_cache_info = array_pop($_cache_info);
+                    return true;
+                } else {
+                    error_reporting($_smarty_old_error_level);
+                    $this->_cache_info = array_pop($_cache_info);
+                    return $_smarty_results;
+                }
+            } else {
+                $this->_cache_info['template'][$resource_name] = true;
+                if ($this->cache_modified_check && $display) {
+                    header('Last-Modified: '.gmdate('D, d M Y H:i:s', time()).' GMT');
+                }
+            }
+        }
+        if (count($this->autoload_filters)) {
+            foreach ($this->autoload_filters as $_filter_type => $_filters) {
+                foreach ($_filters as $_filter) {
+                    $this->load_filter($_filter_type, $_filter);
+                }
+            }
+        }
+        $_smarty_compile_path = $this->_get_compile_path($resource_name);
+        $_cache_including = $this->_cache_including;
+        $this->_cache_including = false;
+        if ($display && !$this->caching && count($this->_plugins['outputfilter']) == 0) {
+            if ($this->_is_compiled($resource_name, $_smarty_compile_path)
+                    || $this->_compile_resource($resource_name, $_smarty_compile_path))
+            {
+                include($_smarty_compile_path);
+            }
+        } else {
+            ob_start();
+            if ($this->_is_compiled($resource_name, $_smarty_compile_path)
+                    || $this->_compile_resource($resource_name, $_smarty_compile_path))
+            {
+                include($_smarty_compile_path);
+            }
+            $_smarty_results = ob_get_contents();
+            ob_end_clean();
+            foreach ((array)$this->_plugins['outputfilter'] as $_output_filter) {
+                $_smarty_results = call_user_func_array($_output_filter[0], array($_smarty_results, &$this));
+            }
+        }
+        if ($this->caching) {
+            $_params = array('tpl_file' => $resource_name,
+                        'cache_id' => $cache_id,
+                        'compile_id' => $compile_id,
+                        'results' => $_smarty_results);
+            require_once(SMARTY_CORE_DIR . 'core.write_cache_file.php');
+            smarty_core_write_cache_file($_params, $this);
+            require_once(SMARTY_CORE_DIR . 'core.process_cached_inserts.php');
+            $_smarty_results = smarty_core_process_cached_inserts($_params, $this);
+            if ($this->_cache_serials) {
+                $_smarty_results = preg_replace('!(\{/?nocache\:[0-9a-f]{32}#\d+\})!s'
+                                                ,''
+                                                ,$_smarty_results);
+            }
+            $this->_cache_info = array_pop($_cache_info);
+        }
+        $this->_cache_including = $_cache_including;
+        if ($display) {
+            if (isset($_smarty_results)) { echo $_smarty_results; }
+            if ($this->debugging) {
+                $_params = array();
+                require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+                $this->_smarty_debug_info[$_included_tpls_idx]['exec_time'] = (smarty_core_get_microtime($_params, $this) - $_debug_start_time);
+                require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
+                echo smarty_core_display_debug_console($_params, $this);
+            }
+            error_reporting($_smarty_old_error_level);
+            return;
+        } else {
+            error_reporting($_smarty_old_error_level);
+            if (isset($_smarty_results)) { return $_smarty_results; }
+        }
+    }
+    /**
+     * load configuration values
+     *
+     * @param string $file
+     * @param string $section
+     * @param string $scope
+     */
+    function config_load($file, $section = null, $scope = 'global')
+    {
+        require_once($this->_get_plugin_filepath('function', 'config_load'));
+        smarty_function_config_load(array('file' => $file, 'section' => $section, 'scope' => $scope), $this);
+    }
+    /**
+     * return a reference to a registered object
+     *
+     * @param string $name
+     * @return object
+     */
+    function &get_registered_object($name) {
+        if (!isset($this->_reg_objects[$name]))
+        $this->_trigger_fatal_error("'$name' is not a registered object");
+        if (!is_object($this->_reg_objects[$name][0]))
+        $this->_trigger_fatal_error("registered '$name' is not an object");
+        return $this->_reg_objects[$name][0];
+    }
+    /**
+     * clear configuration values
+     *
+     * @param string $var
+     */
+    function clear_config($var = null)
+    {
+        if(!isset($var)) {
+            $this->_config = array(array('vars'  => array(),
+                                         'files' => array()));
+        } else {
+            unset($this->_config[0]['vars'][$var]);
+        }
+    }
+    /**
+     * get filepath of requested plugin
+     *
+     * @param string $type
+     * @param string $name
+     * @return string|false
+     */
+    function _get_plugin_filepath($type, $name)
+    {
+        $_params = array('type' => $type, 'name' => $name);
+        require_once(SMARTY_CORE_DIR . 'core.assemble_plugin_filepath.php');
+        return smarty_core_assemble_plugin_filepath($_params, $this);
+    }
+   /**
+     * test if resource needs compiling
+     *
+     * @param string $resource_name
+     * @param string $compile_path
+     * @return boolean
+     */
+    function _is_compiled($resource_name, $compile_path)
+    {
+        if (!$this->force_compile && file_exists($compile_path)) {
+            if (!$this->compile_check) {
+                return true;
+            } else {
+                $_params = array('resource_name' => $resource_name, 'get_source'=>false);
+                if (!$this->_fetch_resource_info($_params)) {
+                    return false;
+                }
+                if ($_params['resource_timestamp'] <= filemtime($compile_path)) {
+                    return true;
+                } else {
+                    return false;
+                }
+            }
+        } else {
+            return false;
+        }
+    }
+   /**
+     * compile the template
+     *
+     * @param string $resource_name
+     * @param string $compile_path
+     * @return boolean
+     */
+    function _compile_resource($resource_name, $compile_path)
+    {
+        $_params = array('resource_name' => $resource_name);
+        if (!$this->_fetch_resource_info($_params)) {
+            return false;
+        }
+        $_source_content = $_params['source_content'];
+        $_cache_include    = substr($compile_path, 0, -4).'.inc';
+        if ($this->_compile_source($resource_name, $_source_content, $_compiled_content, $_cache_include)) {
+            if ($this->_cache_include_info) {
+                require_once(SMARTY_CORE_DIR . 'core.write_compiled_include.php');
+                smarty_core_write_compiled_include(array_merge($this->_cache_include_info, array('compiled_content'=>$_compiled_content, 'resource_name'=>$resource_name)),  $this);
+            }
+            $_params = array('compile_path'=>$compile_path, 'compiled_content' => $_compiled_content);
+            require_once(SMARTY_CORE_DIR . 'core.write_compiled_resource.php');
+            smarty_core_write_compiled_resource($_params, $this);
+            return true;
+        } else {
+            return false;
+        }
+    }
+   /**
+     * compile the given source
+     *
+     * @param string $resource_name
+     * @param string $source_content
+     * @param string $compiled_content
+     * @return boolean
+     */
+    function _compile_source($resource_name, &$source_content, &$compiled_content, $cache_include_path=null)
+    {
+        if (file_exists(SMARTY_DIR . $this->compiler_file)) {
+            require_once(SMARTY_DIR . $this->compiler_file);
+        } else {
+            require_once($this->compiler_file);
+        }
+        $smarty_compiler = new $this->compiler_class;
+        $smarty_compiler->template_dir      = $this->template_dir;
+        $smarty_compiler->compile_dir       = $this->compile_dir;
+        $smarty_compiler->plugins_dir       = $this->plugins_dir;
+        $smarty_compiler->config_dir        = $this->config_dir;
+        $smarty_compiler->force_compile     = $this->force_compile;
+        $smarty_compiler->caching           = $this->caching;
+        $smarty_compiler->php_handling      = $this->php_handling;
+        $smarty_compiler->left_delimiter    = $this->left_delimiter;
+        $smarty_compiler->right_delimiter   = $this->right_delimiter;
+        $smarty_compiler->_version          = $this->_version;
+        $smarty_compiler->security          = $this->security;
+        $smarty_compiler->secure_dir        = $this->secure_dir;
+        $smarty_compiler->security_settings = $this->security_settings;
+        $smarty_compiler->trusted_dir       = $this->trusted_dir;
+        $smarty_compiler->use_sub_dirs      = $this->use_sub_dirs;
+        $smarty_compiler->_reg_objects      = &$this->_reg_objects;
+        $smarty_compiler->_plugins          = &$this->_plugins;
+        $smarty_compiler->_tpl_vars         = &$this->_tpl_vars;
+        $smarty_compiler->default_modifiers = $this->default_modifiers;
+        $smarty_compiler->compile_id        = $this->_compile_id;
+        $smarty_compiler->_config            = $this->_config;
+        $smarty_compiler->request_use_auto_globals  = $this->request_use_auto_globals;
+        if (isset($cache_include_path) && isset($this->_cache_serials[$cache_include_path])) {
+            $smarty_compiler->_cache_serial = $this->_cache_serials[$cache_include_path];
+        }
+        $smarty_compiler->_cache_include = $cache_include_path;
+        $_results = $smarty_compiler->_compile_file($resource_name, $source_content, $compiled_content);
+        if ($smarty_compiler->_cache_serial) {
+            $this->_cache_include_info = array(
+                'cache_serial'=>$smarty_compiler->_cache_serial
+                ,'plugins_code'=>$smarty_compiler->_plugins_code
+                ,'include_file_path' => $cache_include_path);
+        } else {
+            $this->_cache_include_info = null;
+        }
+        return $_results;
+    }
+    /**
+     * Get the compile path for this resource
+     *
+     * @param string $resource_name
+     * @return string results of {@link _get_auto_filename()}
+     */
+    function _get_compile_path($resource_name)
+    {
+        return $this->_get_auto_filename($this->compile_dir, $resource_name,
+                                         $this->_compile_id) . '.php';
+    }
+    /**
+     * fetch the template info. Gets timestamp, and source
+     * if get_source is true
+     *
+     * sets $source_content to the source of the template, and
+     * $resource_timestamp to its time stamp
+     * @param string $resource_name
+     * @param string $source_content
+     * @param integer $resource_timestamp
+     * @param boolean $get_source
+     * @param boolean $quiet
+     * @return boolean
+     */
+    function _fetch_resource_info(&$params)
+    {
+        if(!isset($params['get_source'])) { $params['get_source'] = true; }
+        if(!isset($params['quiet'])) { $params['quiet'] = false; }
+        $_return = false;
+        $_params = array('resource_name' => $params['resource_name']) ;
+        if (isset($params['resource_base_path']))
+            $_params['resource_base_path'] = $params['resource_base_path'];
+        else
+            $_params['resource_base_path'] = $this->template_dir;
+        if ($this->_parse_resource_name($_params)) {
+            $_resource_type = $_params['resource_type'];
+            $_resource_name = $_params['resource_name'];
+            switch ($_resource_type) {
+                case 'file':
+                    if ($params['get_source']) {
+                        $params['source_content'] = $this->_read_file($_resource_name);
+                    }
+                    $params['resource_timestamp'] = filemtime($_resource_name);
+                    $_return = is_file($_resource_name);
+                    break;
+                default:
+                    if ($params['get_source']) {
+                        $_source_return = isset($this->_plugins['resource'][$_resource_type]) &&
+                            call_user_func_array($this->_plugins['resource'][$_resource_type][0][0],
+                                                 array($_resource_name, &$params['source_content'], &$this));
+                    } else {
+                        $_source_return = true;
+                    }
+                    $_timestamp_return = isset($this->_plugins['resource'][$_resource_type]) &&
+                        call_user_func_array($this->_plugins['resource'][$_resource_type][0][1],
+                                             array($_resource_name, &$params['resource_timestamp'], &$this));
+                    $_return = $_source_return && $_timestamp_return;
+                    break;
+            }
+        }
+        if (!$_return) {
+            if (!empty($this->default_template_handler_func)) {
+                if (!is_callable($this->default_template_handler_func)) {
+                    $this->trigger_error("default template handler function \"$this->default_template_handler_func\" doesn't exist.");
+                } else {
+                    $_return = call_user_func_array(
+                        $this->default_template_handler_func,
+                        array($_params['resource_type'], $_params['resource_name'], &$params['source_content'], &$params['resource_timestamp'], &$this));
+                }
+            }
+        }
+        if (!$_return) {
+            if (!$params['quiet']) {
+                $this->trigger_error('unable to read resource: "' . $params['resource_name'] . '"');
+            }
+        } else if ($_return && $this->security) {
+            require_once(SMARTY_CORE_DIR . 'core.is_secure.php');
+            if (!smarty_core_is_secure($_params, $this)) {
+                if (!$params['quiet'])
+                    $this->trigger_error('(secure mode) accessing "' . $params['resource_name'] . '" is not allowed');
+                $params['source_content'] = null;
+                $params['resource_timestamp'] = null;
+                return false;
+            }
+        }
+        return $_return;
+    }
+    /**
+     * parse out the type and name from the resource
+     *
+     * @param string $resource_base_path
+     * @param string $resource_name
+     * @param string $resource_type
+     * @param string $resource_name
+     * @return boolean
+     */
+    function _parse_resource_name(&$params)
+    {
+        $_resource_name_parts = explode(':', $params['resource_name'], 2);
+        if (count($_resource_name_parts) == 1) {
+            $params['resource_type'] = $this->default_resource_type;
+            $params['resource_name'] = $_resource_name_parts[0];
+        } else {
+            if(strlen($_resource_name_parts[0]) == 1) {
+                $params['resource_type'] = $this->default_resource_type;
+                $params['resource_name'] = $params['resource_name'];
+            } else {
+                $params['resource_type'] = $_resource_name_parts[0];
+                $params['resource_name'] = $_resource_name_parts[1];
+            }
+        }
+        if ($params['resource_type'] == 'file') {
+            if (!preg_match('/^([\/\\\\]|[a-zA-Z]:[\/\\\\])/', $params['resource_name'])) {
+                foreach ((array)$params['resource_base_path'] as $_curr_path) {
+                    $_fullpath = $_curr_path . DIRECTORY_SEPARATOR . $params['resource_name'];
+                    if (file_exists($_fullpath) && is_file($_fullpath)) {
+                        $params['resource_name'] = $_fullpath;
+                        return true;
+                    }
+                    $_params = array('file_path' => $_fullpath);
+                    require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
+                    if(smarty_core_get_include_path($_params, $this)) {
+                        $params['resource_name'] = $_params['new_file_path'];
+                        return true;
+                    }
+                }
+                return false;
+            } else {
+                /* absolute path */
+                return file_exists($params['resource_name']);
+            }
+        } elseif (empty($this->_plugins['resource'][$params['resource_type']])) {
+            $_params = array('type' => $params['resource_type']);
+            require_once(SMARTY_CORE_DIR . 'core.load_resource_plugin.php');
+            smarty_core_load_resource_plugin($_params, $this);
+        }
+        return true;
+    }
+    /**
+     * Handle modifiers
+     *
+     * @param string|null $modifier_name
+     * @param array|null $map_array
+     * @return string result of modifiers
+     */
+    function _run_mod_handler()
+    {
+        $_args = func_get_args();
+        list($_modifier_name, $_map_array) = array_splice($_args, 0, 2);
+        list($_func_name, $_tpl_file, $_tpl_line) =
+            $this->_plugins['modifier'][$_modifier_name];
+        $_var = $_args[0];
+        foreach ($_var as $_key => $_val) {
+            $_args[0] = $_val;
+            $_var[$_key] = call_user_func_array($_func_name, $_args);
+        }
+        return $_var;
+    }
+    /**
+     * Remove starting and ending quotes from the string
+     *
+     * @param string $string
+     * @return string
+     */
+    function _dequote($string)
+    {
+        if ((substr($string, 0, 1) == "'" || substr($string, 0, 1) == '"') &&
+            substr($string, -1) == substr($string, 0, 1))
+            return substr($string, 1, -1);
+        else
+            return $string;
+    }
+    /**
+     * read in a file
+     *
+     * @param string $filename
+     * @return string
+     */
+    function _read_file($filename)
+    {
+        if ( file_exists($filename) && ($fd = @fopen($filename, 'rb')) ) {
+            $contents = '';
+            while (!feof($fd)) {
+                $contents .= fread($fd, 8192);
+            }
+            fclose($fd);
+            return $contents;
+        } else {
+            return false;
+        }
+    }
+    /**
+     * get a concrete filename for automagically created content
+     *
+     * @param string $auto_base
+     * @param string $auto_source
+     * @param string $auto_id
+     * @return string
+     * @staticvar string|null
+     * @staticvar string|null
+     */
+    function _get_auto_filename($auto_base, $auto_source = null, $auto_id = null)
+    {
+        $_compile_dir_sep =  $this->use_sub_dirs ? DIRECTORY_SEPARATOR : '^';
+        $_return = $auto_base . DIRECTORY_SEPARATOR;
+        if(isset($auto_id)) {
+            $auto_id = str_replace('%7C',$_compile_dir_sep,(urlencode($auto_id)));
+            $_return .= $auto_id . $_compile_dir_sep;
+        }
+        if(isset($auto_source)) {
+            $_filename = urlencode(basename($auto_source));
+            $_crc32 = sprintf('%08X', crc32($auto_source));
+            $_crc32 = substr($_crc32, 0, 2) . $_compile_dir_sep .
+                      substr($_crc32, 0, 3) . $_compile_dir_sep . $_crc32;
+            $_return .= '%%' . $_crc32 . '%%' . $_filename;
+        }
+        return $_return;
+    }
+    /**
+     * unlink a file, possibly using expiration time
+     *
+     * @param string $resource
+     * @param integer $exp_time
+     */
+    function _unlink($resource, $exp_time = null)
+    {
+        if(isset($exp_time)) {
+            if(time() - @filemtime($resource) >= $exp_time) {
+                return @unlink($resource);
+            }
+        } else {
+            return @unlink($resource);
+        }
+    }
+    /**
+     * returns an auto_id for auto-file-functions
+     *
+     * @param string $cache_id
+     * @param string $compile_id
+     * @return string|null
+     */
+    function _get_auto_id($cache_id=null, $compile_id=null) {
+    if (isset($cache_id))
+        return (isset($compile_id)) ? $cache_id . '|' . $compile_id  : $cache_id;
+    elseif(isset($compile_id))
+        return $compile_id;
+    else
+        return null;
+    }
+    /**
+     * trigger Smarty plugin error
+     *
+     * @param string $error_msg
+     * @param string $tpl_file
+     * @param integer $tpl_line
+     * @param string $file
+     * @param integer $line
+     * @param integer $error_type
+     */
+    function _trigger_fatal_error($error_msg, $tpl_file = null, $tpl_line = null,
+            $file = null, $line = null, $error_type = E_USER_ERROR)
+    {
+        if(isset($file) && isset($line)) {
+            $info = ' ('.basename($file).", line $line)";
+        } else {
+            $info = '';
+        }
+        if (isset($tpl_line) && isset($tpl_file)) {
+            $this->trigger_error('[in ' . $tpl_file . ' line ' . $tpl_line . "]: $error_msg$info", $error_type);
+        } else {
+            $this->trigger_error($error_msg . $info, $error_type);
+        }
+    }
+    /**
+     * callback function for preg_replace, to call a non-cacheable block
+     * @return string
+     */
+    function _process_compiled_include_callback($match) {
+        $_func = '_smarty_tplfunc_'.$match[2].'_'.$match[3];
+        ob_start();
+        $_func($this);
+        $_ret = ob_get_contents();
+        ob_end_clean();
+        return $_ret;
+    }
+    /**
+     * called for included templates
+     *
+     * @param string $_smarty_include_tpl_file
+     * @param string $_smarty_include_vars
+     */
+    function _smarty_include($params)
+    {
+        if ($this->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $debug_start_time = smarty_core_get_microtime($_params, $this);
+            $this->_smarty_debug_info[] = array('type'      => 'template',
+                                                  'filename'  => $params['smarty_include_tpl_file'],
+                                                  'depth'     => ++$this->_inclusion_depth);
+            $included_tpls_idx = count($this->_smarty_debug_info) - 1;
+        }
+        $this->_tpl_vars = array_merge($this->_tpl_vars, $params['smarty_include_vars']);
+        array_unshift($this->_config, $this->_config[0]);
+        $_smarty_compile_path = $this->_get_compile_path($params['smarty_include_tpl_file']);
+        if ($this->_is_compiled($params['smarty_include_tpl_file'], $_smarty_compile_path)
+            || $this->_compile_resource($params['smarty_include_tpl_file'], $_smarty_compile_path))
+        {
+            include($_smarty_compile_path);
+        }
+        array_shift($this->_config);
+        $this->_inclusion_depth--;
+        if ($this->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $this->_smarty_debug_info[$included_tpls_idx]['exec_time'] = smarty_core_get_microtime($_params, $this) - $debug_start_time;
+        }
+        if ($this->caching) {
+            $this->_cache_info['template'][$params['smarty_include_tpl_file']] = true;
+        }
+    }
+    /**
+     * get or set an array of cached attributes for function that is
+     * not cacheable
+     * @return array
+     */
+    function &_smarty_cache_attrs($cache_serial, $count) {
+        $_cache_attrs =& $this->_cache_info['cache_attrs'][$cache_serial][$count];
+        if ($this->_cache_including) {
+            /* return next set of cache_attrs */
+            $_return = current($_cache_attrs);
+            next($_cache_attrs);
+            return $_return;
+        } else {
+            /* add a reference to a new set of cache_attrs */
+            $_cache_attrs[] = array();
+            return $_cache_attrs[count($_cache_attrs)-1];
+        }
+    }
+    /**
+     * wrapper for include() retaining $this
+     * @return mixed
+     */
+    function _include($filename, $once=false, $params=null)
+    {
+        if ($once) {
+            return include_once($filename);
+        } else {
+            return include($filename);
+        }
+    }
+    /**
+     * wrapper for eval() retaining $this
+     * @return mixed
+     */
+    function _eval($code, $params=null)
+    {
+        return eval($code);
+    }
+    /**#@-*/
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/Smarty_Compiler.class.php
@@ -0,0 +1,1894 @@
+<?php
+/**
+ * Project:     Smarty: the PHP compiling template engine
+ * File:        Smarty_Compiler.class.php
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * @link http://smarty.php.net/
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @author Andrei Zmievski <andrei@php.net>
+ * @version 2.6.18
+ * @copyright 2001-2005 New Digital Group, Inc.
+ * @package Smarty
+ */
+/* $Id$ */
+/**
+ * Template compiling class
+ * @package Smarty
+ */
+class Smarty_Compiler extends Smarty {
+    /**#@+
+     * @access private
+     */
+    var $_folded_blocks         =   array();    // keeps folded template blocks
+    var $_current_file          =   null;       // the current template being compiled
+    var $_current_line_no       =   1;          // line number for error messages
+    var $_capture_stack         =   array();    // keeps track of nested capture buffers
+    var $_plugin_info           =   array();    // keeps track of plugins to load
+    var $_init_smarty_vars      =   false;
+    var $_permitted_tokens      =   array('true','false','yes','no','on','off','null');
+    var $_db_qstr_regexp        =   null;        // regexps are setup in the constructor
+    var $_si_qstr_regexp        =   null;
+    var $_qstr_regexp           =   null;
+    var $_func_regexp           =   null;
+    var $_reg_obj_regexp        =   null;
+    var $_var_bracket_regexp    =   null;
+    var $_num_const_regexp      =   null;
+    var $_dvar_guts_regexp      =   null;
+    var $_dvar_regexp           =   null;
+    var $_cvar_regexp           =   null;
+    var $_svar_regexp           =   null;
+    var $_avar_regexp           =   null;
+    var $_mod_regexp            =   null;
+    var $_var_regexp            =   null;
+    var $_parenth_param_regexp  =   null;
+    var $_func_call_regexp      =   null;
+    var $_obj_ext_regexp        =   null;
+    var $_obj_start_regexp      =   null;
+    var $_obj_params_regexp     =   null;
+    var $_obj_call_regexp       =   null;
+    var $_cacheable_state       =   0;
+    var $_cache_attrs_count     =   0;
+    var $_nocache_count         =   0;
+    var $_cache_serial          =   null;
+    var $_cache_include         =   null;
+    var $_strip_depth           =   0;
+    var $_additional_newline    =   "\n";
+    /**#@-*/
+    /**
+     * The class constructor.
+     */
+    function Smarty_Compiler()
+    {
+        $this->_db_qstr_regexp = '"[^"\\\\]*(?:\\\\.[^"\\\\]*)*"';
+        $this->_si_qstr_regexp = '\'[^\'\\\\]*(?:\\\\.[^\'\\\\]*)*\'';
+        $this->_qstr_regexp = '(?:' . $this->_db_qstr_regexp . '|' . $this->_si_qstr_regexp . ')';
+        $this->_var_bracket_regexp = '\[\$?[\w\.]+\]';
+        $this->_num_const_regexp = '(?:\-?\d+(?:\.\d+)?)';
+        $this->_dvar_math_regexp = '(?:[\+\*\/\%]|(?:-(?!>)))';
+        $this->_dvar_math_var_regexp = '[\$\w\.\+\-\*\/\%\d\>\[\]]';
+        $this->_dvar_guts_regexp = '\w+(?:' . $this->_var_bracket_regexp
+                . ')*(?:\.\$?\w+(?:' . $this->_var_bracket_regexp . ')*)*(?:' . $this->_dvar_math_regexp . '(?:' . $this->_num_const_regexp . '|' . $this->_dvar_math_var_regexp . ')*)?';
+        $this->_dvar_regexp = '\$' . $this->_dvar_guts_regexp;
+        $this->_cvar_regexp = '\#\w+\#';
+        $this->_svar_regexp = '\%\w+\.\w+\%';
+        $this->_avar_regexp = '(?:' . $this->_dvar_regexp . '|'
+           . $this->_cvar_regexp . '|' . $this->_svar_regexp . ')';
+        $this->_var_regexp = '(?:' . $this->_avar_regexp . '|' . $this->_qstr_regexp . ')';
+        $this->_obj_ext_regexp = '\->(?:\$?' . $this->_dvar_guts_regexp . ')';
+        $this->_obj_restricted_param_regexp = '(?:'
+                . '(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . ')(?:' . $this->_obj_ext_regexp . '(?:\((?:(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . ')'
+                . '(?:\s*,\s*(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . '))*)?\))?)*)';
+        $this->_obj_single_param_regexp = '(?:\w+|' . $this->_obj_restricted_param_regexp . '(?:\s*,\s*(?:(?:\w+|'
+                . $this->_var_regexp . $this->_obj_restricted_param_regexp . ')))*)';
+        $this->_obj_params_regexp = '\((?:' . $this->_obj_single_param_regexp
+                . '(?:\s*,\s*' . $this->_obj_single_param_regexp . ')*)?\)';
+        $this->_obj_start_regexp = '(?:' . $this->_dvar_regexp . '(?:' . $this->_obj_ext_regexp . ')+)';
+        $this->_obj_call_regexp = '(?:' . $this->_obj_start_regexp . '(?:' . $this->_obj_params_regexp . ')?(?:' . $this->_dvar_math_regexp . '(?:' . $this->_num_const_regexp . '|' . $this->_dvar_math_var_regexp . ')*)?)';
+        $this->_mod_regexp = '(?:\|@?\w+(?::(?:\w+|' . $this->_num_const_regexp . '|'
+           . $this->_obj_call_regexp . '|' . $this->_avar_regexp . '|' . $this->_qstr_regexp .'))*)';
+        $this->_func_regexp = '[a-zA-Z_]\w*';
+        $this->_reg_obj_regexp = '[a-zA-Z_]\w*->[a-zA-Z_]\w*';
+        $this->_param_regexp = '(?:\s*(?:' . $this->_obj_call_regexp . '|'
+           . $this->_var_regexp . '|' . $this->_num_const_regexp  . '|\w+)(?>' . $this->_mod_regexp . '*)\s*)';
+        $this->_parenth_param_regexp = '(?:\((?:\w+|'
+                . $this->_param_regexp . '(?:\s*,\s*(?:(?:\w+|'
+                . $this->_param_regexp . ')))*)?\))';
+        $this->_func_call_regexp = '(?:' . $this->_func_regexp . '\s*(?:'
+           . $this->_parenth_param_regexp . '))';
+    }
+    /**
+     * compile a resource
+     *
+     * sets $compiled_content to the compiled source
+     * @param string $resource_name
+     * @param string $source_content
+     * @param string $compiled_content
+     * @return true
+     */
+    function _compile_file($resource_name, $source_content, &$compiled_content)
+    {
+        if ($this->security) {
+            if ($this->php_handling == SMARTY_PHP_ALLOW &&
+                !$this->security_settings['PHP_HANDLING']) {
+                $this->php_handling = SMARTY_PHP_PASSTHRU;
+            }
+        }
+        $this->_load_filters();
+        $this->_current_file = $resource_name;
+        $this->_current_line_no = 1;
+        $ldq = preg_quote($this->left_delimiter, '~');
+        $rdq = preg_quote($this->right_delimiter, '~');
+        if (count($this->_plugins['prefilter']) > 0) {
+            foreach ($this->_plugins['prefilter'] as $filter_name => $prefilter) {
+                if ($prefilter === false) continue;
+                if ($prefilter[3] || is_callable($prefilter[0])) {
+                    $source_content = call_user_func_array($prefilter[0],
+                                                            array($source_content, &$this));
+                    $this->_plugins['prefilter'][$filter_name][3] = true;
+                } else {
+                    $this->_trigger_fatal_error("[plugin] prefilter '$filter_name' is not implemented");
+                }
+            }
+        }
+        /* fetch all special blocks */
+        $search = "~{$ldq}\*(.*?)\*{$rdq}|{$ldq}\s*literal\s*{$rdq}(.*?){$ldq}\s*/literal\s*{$rdq}|{$ldq}\s*php\s*{$rdq}(.*?){$ldq}\s*/php\s*{$rdq}~s";
+        preg_match_all($search, $source_content, $match,  PREG_SET_ORDER);
+        $this->_folded_blocks = $match;
+        reset($this->_folded_blocks);
+        /* replace special blocks by "{php}" */
+        $source_content = preg_replace($search.'e', "'"
+                                       . $this->_quote_replace($this->left_delimiter) . 'php'
+                                       . "' . str_repeat(\"\n\", substr_count('\\0', \"\n\")) .'"
+                                       . $this->_quote_replace($this->right_delimiter)
+                                       . "'"
+                                       , $source_content);
+        /* Gather all template tags. */
+        preg_match_all("~{$ldq}\s*(.*?)\s*{$rdq}~s", $source_content, $_match);
+        $template_tags = $_match[1];
+        /* preg_split content by template tags to obtain non-template content. */
+        $text_blocks = preg_split("~{$ldq}.*?{$rdq}~s", $source_content);
+        /* loop through text blocks */
+        for ($curr_tb = 0, $for_max = count($text_blocks); $curr_tb < $for_max; $curr_tb++) {
+            /* match anything resembling php tags */
+            if (preg_match_all('~(<\?(?:\w+|=)?|\?>|language\s*=\s*[\"\']?\s*php\s*[\"\']?)~is', $text_blocks[$curr_tb], $sp_match)) {
+                /* replace tags with placeholders to prevent recursive replacements */
+                $sp_match[1] = array_unique($sp_match[1]);
+                usort($sp_match[1], '_smarty_sort_length');
+                for ($curr_sp = 0, $for_max2 = count($sp_match[1]); $curr_sp < $for_max2; $curr_sp++) {
+                    $text_blocks[$curr_tb] = str_replace($sp_match[1][$curr_sp],'%%%SMARTYSP'.$curr_sp.'%%%',$text_blocks[$curr_tb]);
+                }
+                /* process each one */
+                for ($curr_sp = 0, $for_max2 = count($sp_match[1]); $curr_sp < $for_max2; $curr_sp++) {
+                    if ($this->php_handling == SMARTY_PHP_PASSTHRU) {
+                        /* echo php contents */
+                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '<?php echo \''.str_replace("'", "\'", $sp_match[1][$curr_sp]).'\'; ?>'."\n", $text_blocks[$curr_tb]);
+                    } else if ($this->php_handling == SMARTY_PHP_QUOTE) {
+                        /* quote php tags */
+                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', htmlspecialchars($sp_match[1][$curr_sp]), $text_blocks[$curr_tb]);
+                    } else if ($this->php_handling == SMARTY_PHP_REMOVE) {
+                        /* remove php tags */
+                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '', $text_blocks[$curr_tb]);
+                    } else {
+                        /* SMARTY_PHP_ALLOW, but echo non php starting tags */
+                        $sp_match[1][$curr_sp] = preg_replace('~(<\?(?!php|=|$))~i', '<?php echo \'\\1\'?>'."\n", $sp_match[1][$curr_sp]);
+                        $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', $sp_match[1][$curr_sp], $text_blocks[$curr_tb]);
+                    }
+                }
+            }
+        }
+        /* Compile the template tags into PHP code. */
+        $compiled_tags = array();
+        for ($i = 0, $for_max = count($template_tags); $i < $for_max; $i++) {
+            $this->_current_line_no += substr_count($text_blocks[$i], "\n");
+            $compiled_tags[] = $this->_compile_tag($template_tags[$i]);
+            $this->_current_line_no += substr_count($template_tags[$i], "\n");
+        }
+        if (count($this->_tag_stack)>0) {
+            list($_open_tag, $_line_no) = end($this->_tag_stack);
+            $this->_syntax_error("unclosed tag \{$_open_tag} (opened line $_line_no).", E_USER_ERROR, __FILE__, __LINE__);
+            return;
+        }
+        /* Reformat $text_blocks between 'strip' and '/strip' tags,
+           removing spaces, tabs and newlines. */
+        $strip = false;
+        for ($i = 0, $for_max = count($compiled_tags); $i < $for_max; $i++) {
+            if ($compiled_tags[$i] == '{strip}') {
+                $compiled_tags[$i] = '';
+                $strip = true;
+                /* remove leading whitespaces */
+                $text_blocks[$i + 1] = ltrim($text_blocks[$i + 1]);
+            }
+            if ($strip) {
+                /* strip all $text_blocks before the next '/strip' */
+                for ($j = $i + 1; $j < $for_max; $j++) {
+                    /* remove leading and trailing whitespaces of each line */
+                    $text_blocks[$j] = preg_replace('![\t ]*[\r\n]+[\t ]*!', '', $text_blocks[$j]);
+                    if ($compiled_tags[$j] == '{/strip}') {
+                        /* remove trailing whitespaces from the last text_block */
+                        $text_blocks[$j] = rtrim($text_blocks[$j]);
+                    }
+                    $text_blocks[$j] = "<?php echo '" . strtr($text_blocks[$j], array("'"=>"\'", "\\"=>"\\\\")) . "'; ?>";
+                    if ($compiled_tags[$j] == '{/strip}') {
+                        $compiled_tags[$j] = "\n"; /* slurped by php, but necessary
+                                    if a newline is following the closing strip-tag */
+                        $strip = false;
+                        $i = $j;
+                        break;
+                    }
+                }
+            }
+        }
+        $compiled_content = '';
+        $tag_guard = '%%%SMARTYOTG' . md5(uniqid(rand(), true)) . '%%%';
+        /* Interleave the compiled contents and text blocks to get the final result. */
+        for ($i = 0, $for_max = count($compiled_tags); $i < $for_max; $i++) {
+            if ($compiled_tags[$i] == '') {
+                $text_blocks[$i+1] = preg_replace('~^(\r\n|\r|\n)~', '', $text_blocks[$i+1]);
+            }
+            $text_blocks[$i] = str_replace('<?', $tag_guard, $text_blocks[$i]);
+            $compiled_tags[$i] = str_replace('<?', $tag_guard, $compiled_tags[$i]);
+            $compiled_content .= $text_blocks[$i] . $compiled_tags[$i];
+        }
+        $compiled_content .= str_replace('<?', $tag_guard, $text_blocks[$i]);
+        $compiled_content = str_replace('<?', "<?php echo '<?' ?>\n", $compiled_content);
+        $compiled_content = preg_replace("~(?<!')language\s*=\s*[\"\']?\s*php\s*[\"\']?~", "<?php echo 'language=php' ?>\n", $compiled_content);
+        $compiled_content = str_replace($tag_guard, '<?', $compiled_content);
+        if (strlen($compiled_content) && (substr($compiled_content, -1) == "\n") ) {
+            $compiled_content = substr($compiled_content, 0, -1);
+        }
+        if (!empty($this->_cache_serial)) {
+            $compiled_content = "<?php \$this->_cache_serials['".$this->_cache_include."'] = '".$this->_cache_serial."'; ?>" . $compiled_content;
+        }
+        if (count($this->_plugins['postfilter']) > 0) {
+            foreach ($this->_plugins['postfilter'] as $filter_name => $postfilter) {
+                if ($postfilter === false) continue;
+                if ($postfilter[3] || is_callable($postfilter[0])) {
+                    $compiled_content = call_user_func_array($postfilter[0],
+                                                              array($compiled_content, &$this));
+                    $this->_plugins['postfilter'][$filter_name][3] = true;
+                } else {
+                    $this->_trigger_fatal_error("Smarty plugin error: postfilter '$filter_name' is not implemented");
+                }
+            }
+        }
+        $template_header = "<?php /* Smarty version ".$this->_version.", created on ".strftime("%Y-%m-%d %H:%M:%S")."\n";
+        $template_header .= "         compiled from ".strtr(urlencode($resource_name), array('%2F'=>'/', '%3A'=>':'))." */ ?>\n";
+        /* Emit code to load needed plugins. */
+        $this->_plugins_code = '';
+        if (count($this->_plugin_info)) {
+            $_plugins_params = "array('plugins' => array(";
+            foreach ($this->_plugin_info as $plugin_type => $plugins) {
+                foreach ($plugins as $plugin_name => $plugin_info) {
+                    $_plugins_params .= "array('$plugin_type', '$plugin_name', '" . strtr($plugin_info[0], array("'" => "\\'", "\\" => "\\\\")) . "', $plugin_info[1], ";
+                    $_plugins_params .= $plugin_info[2] ? 'true),' : 'false),';
+                }
+            }
+            $_plugins_params .= '))';
+            $plugins_code = "<?php require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');\nsmarty_core_load_plugins($_plugins_params, \$this); ?>\n";
+            $template_header .= $plugins_code;
+            $this->_plugin_info = array();
+            $this->_plugins_code = $plugins_code;
+        }
+        if ($this->_init_smarty_vars) {
+            $template_header .= "<?php require_once(SMARTY_CORE_DIR . 'core.assign_smarty_interface.php');\nsmarty_core_assign_smarty_interface(null, \$this); ?>\n";
+            $this->_init_smarty_vars = false;
+        }
+        $compiled_content = $template_header . $compiled_content;
+        return true;
+    }
+    /**
+     * Compile a template tag
+     *
+     * @param string $template_tag
+     * @return string
+     */
+    function _compile_tag($template_tag)
+    {
+        /* Matched comment. */
+        if (substr($template_tag, 0, 1) == '*' && substr($template_tag, -1) == '*')
+            return '';
+        /* preg_split tag into two three parts: command, command modifiers and the arguments. */
+        if(! preg_match('~^(?:(' . $this->_num_const_regexp . '|' . $this->_obj_call_regexp . '|' . $this->_var_regexp
+                . '|\/?' . $this->_reg_obj_regexp . '|\/?' . $this->_func_regexp . ')(' . $this->_mod_regexp . '*))
+                      (?:\s+(.*))?$
+                    ~xs', $template_tag, $match)) {
+            $this->_syntax_error("unrecognized tag: $template_tag", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $tag_command = $match[1];
+        $tag_modifier = isset($match[2]) ? $match[2] : null;
+        $tag_args = isset($match[3]) ? $match[3] : null;
+        if (preg_match('~^' . $this->_num_const_regexp . '|' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '$~', $tag_command)) {
+            /* tag name is a variable or object */
+            $_return = $this->_parse_var_props($tag_command . $tag_modifier);
+            return "<?php echo $_return; ?>" . $this->_additional_newline;
+        }
+        /* If the tag name is a registered object, we process it. */
+        if (preg_match('~^\/?' . $this->_reg_obj_regexp . '$~', $tag_command)) {
+            return $this->_compile_registered_object_tag($tag_command, $this->_parse_attrs($tag_args), $tag_modifier);
+        }
+        switch ($tag_command) {
+            case 'include':
+                return $this->_compile_include_tag($tag_args);
+            case 'include_php':
+                return $this->_compile_include_php_tag($tag_args);
+            case 'if':
+                $this->_push_tag('if');
+                return $this->_compile_if_tag($tag_args);
+            case 'else':
+                list($_open_tag) = end($this->_tag_stack);
+                if ($_open_tag != 'if' && $_open_tag != 'elseif')
+                    $this->_syntax_error('unexpected {else}', E_USER_ERROR, __FILE__, __LINE__);
+                else
+                    $this->_push_tag('else');
+                return '<?php else: ?>';
+            case 'elseif':
+                list($_open_tag) = end($this->_tag_stack);
+                if ($_open_tag != 'if' && $_open_tag != 'elseif')
+                    $this->_syntax_error('unexpected {elseif}', E_USER_ERROR, __FILE__, __LINE__);
+                if ($_open_tag == 'if')
+                    $this->_push_tag('elseif');
+                return $this->_compile_if_tag($tag_args, true);
+            case '/if':
+                $this->_pop_tag('if');
+                return '<?php endif; ?>';
+            case 'capture':
+                return $this->_compile_capture_tag(true, $tag_args);
+            case '/capture':
+                return $this->_compile_capture_tag(false);
+            case 'ldelim':
+                return $this->left_delimiter;
+            case 'rdelim':
+                return $this->right_delimiter;
+            case 'section':
+                $this->_push_tag('section');
+                return $this->_compile_section_start($tag_args);
+            case 'sectionelse':
+                $this->_push_tag('sectionelse');
+                return "<?php endfor; else: ?>";
+                break;
+            case '/section':
+                $_open_tag = $this->_pop_tag('section');
+                if ($_open_tag == 'sectionelse')
+                    return "<?php endif; ?>";
+                else
+                    return "<?php endfor; endif; ?>";
+            case 'foreach':
+                $this->_push_tag('foreach');
+                return $this->_compile_foreach_start($tag_args);
+                break;
+            case 'foreachelse':
+                $this->_push_tag('foreachelse');
+                return "<?php endforeach; else: ?>";
+            case '/foreach':
+                $_open_tag = $this->_pop_tag('foreach');
+                if ($_open_tag == 'foreachelse')
+                    return "<?php endif; unset(\$_from); ?>";
+                else
+                    return "<?php endforeach; endif; unset(\$_from); ?>";
+                break;
+            case 'strip':
+            case '/strip':
+                if (substr($tag_command, 0, 1)=='/') {
+                    $this->_pop_tag('strip');
+                    if (--$this->_strip_depth==0) { /* outermost closing {/strip} */
+                        $this->_additional_newline = "\n";
+                        return '{' . $tag_command . '}';
+                    }
+                } else {
+                    $this->_push_tag('strip');
+                    if ($this->_strip_depth++==0) { /* outermost opening {strip} */
+                        $this->_additional_newline = "";
+                        return '{' . $tag_command . '}';
+                    }
+                }
+                return '';
+            case 'php':
+                /* handle folded tags replaced by {php} */
+                list(, $block) = each($this->_folded_blocks);
+                $this->_current_line_no += substr_count($block[0], "\n");
+                /* the number of matched elements in the regexp in _compile_file()
+                   determins the type of folded tag that was found */
+                switch (count($block)) {
+                    case 2: /* comment */
+                        return '';
+                    case 3: /* literal */
+                        return "<?php echo '" . strtr($block[2], array("'"=>"\'", "\\"=>"\\\\")) . "'; ?>" . $this->_additional_newline;
+                    case 4: /* php */
+                        if ($this->security && !$this->security_settings['PHP_TAGS']) {
+                            $this->_syntax_error("(secure mode) php tags not permitted", E_USER_WARNING, __FILE__, __LINE__);
+                            return;
+                        }
+                        return '<?php ' . $block[3] .' ?>';
+                }
+                break;
+            case 'insert':
+                return $this->_compile_insert_tag($tag_args);
+            default:
+                if ($this->_compile_compiler_tag($tag_command, $tag_args, $output)) {
+                    return $output;
+                } else if ($this->_compile_block_tag($tag_command, $tag_args, $tag_modifier, $output)) {
+                    return $output;
+                } else if ($this->_compile_custom_tag($tag_command, $tag_args, $tag_modifier, $output)) {
+                    return $output;
+                } else {
+                    $this->_syntax_error("unrecognized tag '$tag_command'", E_USER_ERROR, __FILE__, __LINE__);
+                }
+        }
+    }
+    /**
+     * compile the custom compiler tag
+     *
+     * sets $output to the compiled custom compiler tag
+     * @param string $tag_command
+     * @param string $tag_args
+     * @param string $output
+     * @return boolean
+     */
+    function _compile_compiler_tag($tag_command, $tag_args, &$output)
+    {
+        $found = false;
+        $have_function = true;
+        /*
+         * First we check if the compiler function has already been registered
+         * or loaded from a plugin file.
+         */
+        if (isset($this->_plugins['compiler'][$tag_command])) {
+            $found = true;
+            $plugin_func = $this->_plugins['compiler'][$tag_command][0];
+            if (!is_callable($plugin_func)) {
+                $message = "compiler function '$tag_command' is not implemented";
+                $have_function = false;
+            }
+        }
+        /*
+         * Otherwise we need to load plugin file and look for the function
+         * inside it.
+         */
+        else if ($plugin_file = $this->_get_plugin_filepath('compiler', $tag_command)) {
+            $found = true;
+            include_once $plugin_file;
+            $plugin_func = 'smarty_compiler_' . $tag_command;
+            if (!is_callable($plugin_func)) {
+                $message = "plugin function $plugin_func() not found in $plugin_file\n";
+                $have_function = false;
+            } else {
+                $this->_plugins['compiler'][$tag_command] = array($plugin_func, null, null, null, true);
+            }
+        }
+        /*
+         * True return value means that we either found a plugin or a
+         * dynamically registered function. False means that we didn't and the
+         * compiler should now emit code to load custom function plugin for this
+         * tag.
+         */
+        if ($found) {
+            if ($have_function) {
+                $output = call_user_func_array($plugin_func, array($tag_args, &$this));
+                if($output != '') {
+                $output = '<?php ' . $this->_push_cacheable_state('compiler', $tag_command)
+                                   . $output
+                                   . $this->_pop_cacheable_state('compiler', $tag_command) . ' ?>';
+                }
+            } else {
+                $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
+            }
+            return true;
+        } else {
+            return false;
+        }
+    }
+    /**
+     * compile block function tag
+     *
+     * sets $output to compiled block function tag
+     * @param string $tag_command
+     * @param string $tag_args
+     * @param string $tag_modifier
+     * @param string $output
+     * @return boolean
+     */
+    function _compile_block_tag($tag_command, $tag_args, $tag_modifier, &$output)
+    {
+        if (substr($tag_command, 0, 1) == '/') {
+            $start_tag = false;
+            $tag_command = substr($tag_command, 1);
+        } else
+            $start_tag = true;
+        $found = false;
+        $have_function = true;
+        /*
+         * First we check if the block function has already been registered
+         * or loaded from a plugin file.
+         */
+        if (isset($this->_plugins['block'][$tag_command])) {
+            $found = true;
+            $plugin_func = $this->_plugins['block'][$tag_command][0];
+            if (!is_callable($plugin_func)) {
+                $message = "block function '$tag_command' is not implemented";
+                $have_function = false;
+            }
+        }
+        /*
+         * Otherwise we need to load plugin file and look for the function
+         * inside it.
+         */
+        else if ($plugin_file = $this->_get_plugin_filepath('block', $tag_command)) {
+            $found = true;
+            include_once $plugin_file;
+            $plugin_func = 'smarty_block_' . $tag_command;
+            if (!function_exists($plugin_func)) {
+                $message = "plugin function $plugin_func() not found in $plugin_file\n";
+                $have_function = false;
+            } else {
+                $this->_plugins['block'][$tag_command] = array($plugin_func, null, null, null, true);
+            }
+        }
+        if (!$found) {
+            return false;
+        } else if (!$have_function) {
+            $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
+            return true;
+        }
+        /*
+         * Even though we've located the plugin function, compilation
+         * happens only once, so the plugin will still need to be loaded
+         * at runtime for future requests.
+         */
+        $this->_add_plugin('block', $tag_command);
+        if ($start_tag)
+            $this->_push_tag($tag_command);
+        else
+            $this->_pop_tag($tag_command);
+        if ($start_tag) {
+            $output = '<?php ' . $this->_push_cacheable_state('block', $tag_command);
+            $attrs = $this->_parse_attrs($tag_args);
+            $_cache_attrs='';
+            $arg_list = $this->_compile_arg_list('block', $tag_command, $attrs, $_cache_attrs);
+            $output .= "$_cache_attrs\$this->_tag_stack[] = array('$tag_command', array(".implode(',', $arg_list).')); ';
+            $output .= '$_block_repeat=true;' . $this->_compile_plugin_call('block', $tag_command).'($this->_tag_stack[count($this->_tag_stack)-1][1], null, $this, $_block_repeat);';
+            $output .= 'while ($_block_repeat) { ob_start(); ?>';
+        } else {
+            $output = '<?php $_block_content = ob_get_contents(); ob_end_clean(); ';
+            $_out_tag_text = $this->_compile_plugin_call('block', $tag_command).'($this->_tag_stack[count($this->_tag_stack)-1][1], $_block_content, $this, $_block_repeat)';
+            if ($tag_modifier != '') {
+                $this->_parse_modifiers($_out_tag_text, $tag_modifier);
+            }
+            $output .= '$_block_repeat=false;echo ' . $_out_tag_text . '; } ';
+            $output .= " array_pop(\$this->_tag_stack); " . $this->_pop_cacheable_state('block', $tag_command) . '?>';
+        }
+        return true;
+    }
+    /**
+     * compile custom function tag
+     *
+     * @param string $tag_command
+     * @param string $tag_args
+     * @param string $tag_modifier
+     * @return string
+     */
+    function _compile_custom_tag($tag_command, $tag_args, $tag_modifier, &$output)
+    {
+        $found = false;
+        $have_function = true;
+        /*
+         * First we check if the custom function has already been registered
+         * or loaded from a plugin file.
+         */
+        if (isset($this->_plugins['function'][$tag_command])) {
+            $found = true;
+            $plugin_func = $this->_plugins['function'][$tag_command][0];
+            if (!is_callable($plugin_func)) {
+                $message = "custom function '$tag_command' is not implemented";
+                $have_function = false;
+            }
+        }
+        /*
+         * Otherwise we need to load plugin file and look for the function
+         * inside it.
+         */
+        else if ($plugin_file = $this->_get_plugin_filepath('function', $tag_command)) {
+            $found = true;
+            include_once $plugin_file;
+            $plugin_func = 'smarty_function_' . $tag_command;
+            if (!function_exists($plugin_func)) {
+                $message = "plugin function $plugin_func() not found in $plugin_file\n";
+                $have_function = false;
+            } else {
+                $this->_plugins['function'][$tag_command] = array($plugin_func, null, null, null, true);
+            }
+        }
+        if (!$found) {
+            return false;
+        } else if (!$have_function) {
+            $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
+            return true;
+        }
+        /* declare plugin to be loaded on display of the template that
+           we compile right now */
+        $this->_add_plugin('function', $tag_command);
+        $_cacheable_state = $this->_push_cacheable_state('function', $tag_command);
+        $attrs = $this->_parse_attrs($tag_args);
+        $_cache_attrs = '';
+        $arg_list = $this->_compile_arg_list('function', $tag_command, $attrs, $_cache_attrs);
+        $output = $this->_compile_plugin_call('function', $tag_command).'(array('.implode(',', $arg_list)."), \$this)";
+        if($tag_modifier != '') {
+            $this->_parse_modifiers($output, $tag_modifier);
+        }
+        if($output != '') {
+            $output =  '<?php ' . $_cacheable_state . $_cache_attrs . 'echo ' . $output . ';'
+                . $this->_pop_cacheable_state('function', $tag_command) . "?>" . $this->_additional_newline;
+        }
+        return true;
+    }
+    /**
+     * compile a registered object tag
+     *
+     * @param string $tag_command
+     * @param array $attrs
+     * @param string $tag_modifier
+     * @return string
+     */
+    function _compile_registered_object_tag($tag_command, $attrs, $tag_modifier)
+    {
+        if (substr($tag_command, 0, 1) == '/') {
+            $start_tag = false;
+            $tag_command = substr($tag_command, 1);
+        } else {
+            $start_tag = true;
+        }
+        list($object, $obj_comp) = explode('->', $tag_command);
+        $arg_list = array();
+        if(count($attrs)) {
+            $_assign_var = false;
+            foreach ($attrs as $arg_name => $arg_value) {
+                if($arg_name == 'assign') {
+                    $_assign_var = $arg_value;
+                    unset($attrs['assign']);
+                    continue;
+                }
+                if (is_bool($arg_value))
+                    $arg_value = $arg_value ? 'true' : 'false';
+                $arg_list[] = "'$arg_name' => $arg_value";
+            }
+        }
+        if($this->_reg_objects[$object][2]) {
+            $args = "array(".implode(',', (array)$arg_list)."), \$this";
+        } else {
+            $args = implode(',', array_values($attrs));
+            if (empty($args)) {
+                $args = 'null';
+            }
+        }
+        $prefix = '';
+        $postfix = '';
+        $newline = '';
+        if(!is_object($this->_reg_objects[$object][0])) {
+            $this->_trigger_fatal_error("registered '$object' is not an object" , $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
+        } elseif(!empty($this->_reg_objects[$object][1]) && !in_array($obj_comp, $this->_reg_objects[$object][1])) {
+            $this->_trigger_fatal_error("'$obj_comp' is not a registered component of object '$object'", $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
+        } elseif(method_exists($this->_reg_objects[$object][0], $obj_comp)) {
+            if(in_array($obj_comp, $this->_reg_objects[$object][3])) {
+                if ($start_tag) {
+                    $prefix = "\$this->_tag_stack[] = array('$obj_comp', $args); ";
+                    $prefix .= "\$_block_repeat=true; \$this->_reg_objects['$object'][0]->$obj_comp(\$this->_tag_stack[count(\$this->_tag_stack)-1][1], null, \$this, \$_block_repeat); ";
+                    $prefix .= "while (\$_block_repeat) { ob_start();";
+                    $return = null;
+                    $postfix = '';
+                } else {
+                    $prefix = "\$_obj_block_content = ob_get_contents(); ob_end_clean(); \$_block_repeat=false;";
+                    $return = "\$this->_reg_objects['$object'][0]->$obj_comp(\$this->_tag_stack[count(\$this->_tag_stack)-1][1], \$_obj_block_content, \$this, \$_block_repeat)";
+                    $postfix = "} array_pop(\$this->_tag_stack);";
+                }
+            } else {
+                $return = "\$this->_reg_objects['$object'][0]->$obj_comp($args)";
+            }
+        } else {
+            $return = "\$this->_reg_objects['$object'][0]->$obj_comp";
+        }
+        if($return != null) {
+            if($tag_modifier != '') {
+                $this->_parse_modifiers($return, $tag_modifier);
+            }
+            if(!empty($_assign_var)) {
+                $output = "\$this->assign('" . $this->_dequote($_assign_var) ."',  $return);";
+            } else {
+                $output = 'echo ' . $return . ';';
+                $newline = $this->_additional_newline;
+            }
+        } else {
+            $output = '';
+        }
+        return '<?php ' . $prefix . $output . $postfix . "?>" . $newline;
+    }
+    /**
+     * Compile {insert ...} tag
+     *
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_insert_tag($tag_args)
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        $name = $this->_dequote($attrs['name']);
+        if (empty($name)) {
+            return $this->_syntax_error("missing insert name", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        if (!preg_match('~^\w+$~', $name)) {
+            return $this->_syntax_error("'insert: 'name' must be an insert function name", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        if (!empty($attrs['script'])) {
+            $delayed_loading = true;
+        } else {
+            $delayed_loading = false;
+        }
+        foreach ($attrs as $arg_name => $arg_value) {
+            if (is_bool($arg_value))
+                $arg_value = $arg_value ? 'true' : 'false';
+            $arg_list[] = "'$arg_name' => $arg_value";
+        }
+        $this->_add_plugin('insert', $name, $delayed_loading);
+        $_params = "array('args' => array(".implode(', ', (array)$arg_list)."))";
+        return "<?php require_once(SMARTY_CORE_DIR . 'core.run_insert_handler.php');\necho smarty_core_run_insert_handler($_params, \$this); ?>" . $this->_additional_newline;
+    }
+    /**
+     * Compile {include ...} tag
+     *
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_include_tag($tag_args)
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        $arg_list = array();
+        if (empty($attrs['file'])) {
+            $this->_syntax_error("missing 'file' attribute in include tag", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        foreach ($attrs as $arg_name => $arg_value) {
+            if ($arg_name == 'file') {
+                $include_file = $arg_value;
+                continue;
+            } else if ($arg_name == 'assign') {
+                $assign_var = $arg_value;
+                continue;
+            }
+            if (is_bool($arg_value))
+                $arg_value = $arg_value ? 'true' : 'false';
+            $arg_list[] = "'$arg_name' => $arg_value";
+        }
+        $output = '<?php ';
+        if (isset($assign_var)) {
+            $output .= "ob_start();\n";
+        }
+        $output .=
+            "\$_smarty_tpl_vars = \$this->_tpl_vars;\n";
+        $_params = "array('smarty_include_tpl_file' => " . $include_file . ", 'smarty_include_vars' => array(".implode(',', (array)$arg_list)."))";
+        $output .= "\$this->_smarty_include($_params);\n" .
+        "\$this->_tpl_vars = \$_smarty_tpl_vars;\n" .
+        "unset(\$_smarty_tpl_vars);\n";
+        if (isset($assign_var)) {
+            $output .= "\$this->assign(" . $assign_var . ", ob_get_contents()); ob_end_clean();\n";
+        }
+        $output .= ' ?>';
+        return $output;
+    }
+    /**
+     * Compile {include ...} tag
+     *
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_include_php_tag($tag_args)
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        if (empty($attrs['file'])) {
+            $this->_syntax_error("missing 'file' attribute in include_php tag", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $assign_var = (empty($attrs['assign'])) ? '' : $this->_dequote($attrs['assign']);
+        $once_var = (empty($attrs['once']) || $attrs['once']=='false') ? 'false' : 'true';
+        $arg_list = array();
+        foreach($attrs as $arg_name => $arg_value) {
+            if($arg_name != 'file' AND $arg_name != 'once' AND $arg_name != 'assign') {
+                if(is_bool($arg_value))
+                    $arg_value = $arg_value ? 'true' : 'false';
+                $arg_list[] = "'$arg_name' => $arg_value";
+            }
+        }
+        $_params = "array('smarty_file' => " . $attrs['file'] . ", 'smarty_assign' => '$assign_var', 'smarty_once' => $once_var, 'smarty_include_vars' => array(".implode(',', $arg_list)."))";
+        return "<?php require_once(SMARTY_CORE_DIR . 'core.smarty_include_php.php');\nsmarty_core_smarty_include_php($_params, \$this); ?>" . $this->_additional_newline;
+    }
+    /**
+     * Compile {section ...} tag
+     *
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_section_start($tag_args)
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        $arg_list = array();
+        $output = '<?php ';
+        $section_name = $attrs['name'];
+        if (empty($section_name)) {
+            $this->_syntax_error("missing section name", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $output .= "unset(\$this->_sections[$section_name]);\n";
+        $section_props = "\$this->_sections[$section_name]";
+        foreach ($attrs as $attr_name => $attr_value) {
+            switch ($attr_name) {
+                case 'loop':
+                    $output .= "{$section_props}['loop'] = is_array(\$_loop=$attr_value) ? count(\$_loop) : max(0, (int)\$_loop); unset(\$_loop);\n";
+                    break;
+                case 'show':
+                    if (is_bool($attr_value))
+                        $show_attr_value = $attr_value ? 'true' : 'false';
+                    else
+                        $show_attr_value = "(bool)$attr_value";
+                    $output .= "{$section_props}['show'] = $show_attr_value;\n";
+                    break;
+                case 'name':
+                    $output .= "{$section_props}['$attr_name'] = $attr_value;\n";
+                    break;
+                case 'max':
+                case 'start':
+                    $output .= "{$section_props}['$attr_name'] = (int)$attr_value;\n";
+                    break;
+                case 'step':
+                    $output .= "{$section_props}['$attr_name'] = ((int)$attr_value) == 0 ? 1 : (int)$attr_value;\n";
+                    break;
+                default:
+                    $this->_syntax_error("unknown section attribute - '$attr_name'", E_USER_ERROR, __FILE__, __LINE__);
+                    break;
+            }
+        }
+        if (!isset($attrs['show']))
+            $output .= "{$section_props}['show'] = true;\n";
+        if (!isset($attrs['loop']))
+            $output .= "{$section_props}['loop'] = 1;\n";
+        if (!isset($attrs['max']))
+            $output .= "{$section_props}['max'] = {$section_props}['loop'];\n";
+        else
+            $output .= "if ({$section_props}['max'] < 0)\n" .
+                       "    {$section_props}['max'] = {$section_props}['loop'];\n";
+        if (!isset($attrs['step']))
+            $output .= "{$section_props}['step'] = 1;\n";
+        if (!isset($attrs['start']))
+            $output .= "{$section_props}['start'] = {$section_props}['step'] > 0 ? 0 : {$section_props}['loop']-1;\n";
+        else {
+            $output .= "if ({$section_props}['start'] < 0)\n" .
+                       "    {$section_props}['start'] = max({$section_props}['step'] > 0 ? 0 : -1, {$section_props}['loop'] + {$section_props}['start']);\n" .
+                       "else\n" .
+                       "    {$section_props}['start'] = min({$section_props}['start'], {$section_props}['step'] > 0 ? {$section_props}['loop'] : {$section_props}['loop']-1);\n";
+        }
+        $output .= "if ({$section_props}['show']) {\n";
+        if (!isset($attrs['start']) && !isset($attrs['step']) && !isset($attrs['max'])) {
+            $output .= "    {$section_props}['total'] = {$section_props}['loop'];\n";
+        } else {
+            $output .= "    {$section_props}['total'] = min(ceil(({$section_props}['step'] > 0 ? {$section_props}['loop'] - {$section_props}['start'] : {$section_props}['start']+1)/abs({$section_props}['step'])), {$section_props}['max']);\n";
+        }
+        $output .= "    if ({$section_props}['total'] == 0)\n" .
+                   "        {$section_props}['show'] = false;\n" .
+                   "} else\n" .
+                   "    {$section_props}['total'] = 0;\n";
+        $output .= "if ({$section_props}['show']):\n";
+        $output .= "
+            for ({$section_props}['index'] = {$section_props}['start'], {$section_props}['iteration'] = 1;
+                 {$section_props}['iteration'] <= {$section_props}['total'];
+                 {$section_props}['index'] += {$section_props}['step'], {$section_props}['iteration']++):\n";
+        $output .= "{$section_props}['rownum'] = {$section_props}['iteration'];\n";
+        $output .= "{$section_props}['index_prev'] = {$section_props}['index'] - {$section_props}['step'];\n";
+        $output .= "{$section_props}['index_next'] = {$section_props}['index'] + {$section_props}['step'];\n";
+        $output .= "{$section_props}['first']      = ({$section_props}['iteration'] == 1);\n";
+        $output .= "{$section_props}['last']       = ({$section_props}['iteration'] == {$section_props}['total']);\n";
+        $output .= "?>";
+        return $output;
+    }
+    /**
+     * Compile {foreach ...} tag.
+     *
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_foreach_start($tag_args)
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        $arg_list = array();
+        if (empty($attrs['from'])) {
+            return $this->_syntax_error("foreach: missing 'from' attribute", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $from = $attrs['from'];
+        if (empty($attrs['item'])) {
+            return $this->_syntax_error("foreach: missing 'item' attribute", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $item = $this->_dequote($attrs['item']);
+        if (!preg_match('~^\w+$~', $item)) {
+            return $this->_syntax_error("'foreach: 'item' must be a variable name (literal string)", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        if (isset($attrs['key'])) {
+            $key  = $this->_dequote($attrs['key']);
+            if (!preg_match('~^\w+$~', $key)) {
+                return $this->_syntax_error("foreach: 'key' must to be a variable name (literal string)", E_USER_ERROR, __FILE__, __LINE__);
+            }
+            $key_part = "\$this->_tpl_vars['$key'] => ";
+        } else {
+            $key = null;
+            $key_part = '';
+        }
+        if (isset($attrs['name'])) {
+            $name = $attrs['name'];
+        } else {
+            $name = null;
+        }
+        $output = '<?php ';
+        $output .= "\$_from = $from; if (!is_array(\$_from) && !is_object(\$_from)) { settype(\$_from, 'array'); }";
+        if (isset($name)) {
+            $foreach_props = "\$this->_foreach[$name]";
+            $output .= "{$foreach_props} = array('total' => count(\$_from), 'iteration' => 0);\n";
+            $output .= "if ({$foreach_props}['total'] > 0):\n";
+            $output .= "    foreach (\$_from as $key_part\$this->_tpl_vars['$item']):\n";
+            $output .= "        {$foreach_props}['iteration']++;\n";
+        } else {
+            $output .= "if (count(\$_from)):\n";
+            $output .= "    foreach (\$_from as $key_part\$this->_tpl_vars['$item']):\n";
+        }
+        $output .= '?>';
+        return $output;
+    }
+    /**
+     * Compile {capture} .. {/capture} tags
+     *
+     * @param boolean $start true if this is the {capture} tag
+     * @param string $tag_args
+     * @return string
+     */
+    function _compile_capture_tag($start, $tag_args = '')
+    {
+        $attrs = $this->_parse_attrs($tag_args);
+        if ($start) {
+            if (isset($attrs['name']))
+                $buffer = $attrs['name'];
+            else
+                $buffer = "'default'";
+            if (isset($attrs['assign']))
+                $assign = $attrs['assign'];
+            else
+                $assign = null;
+            $output = "<?php ob_start(); ?>";
+            $this->_capture_stack[] = array($buffer, $assign);
+        } else {
+            list($buffer, $assign) = array_pop($this->_capture_stack);
+            $output = "<?php \$this->_smarty_vars['capture'][$buffer] = ob_get_contents(); ";
+            if (isset($assign)) {
+                $output .= " \$this->assign($assign, ob_get_contents());";
+            }
+            $output .= "ob_end_clean(); ?>";
+        }
+        return $output;
+    }
+    /**
+     * Compile {if ...} tag
+     *
+     * @param string $tag_args
+     * @param boolean $elseif if true, uses elseif instead of if
+     * @return string
+     */
+    function _compile_if_tag($tag_args, $elseif = false)
+    {
+        /* Tokenize args for 'if' tag. */
+        preg_match_all('~(?>
+                ' . $this->_obj_call_regexp . '(?:' . $this->_mod_regexp . '*)? | # valid object call
+                ' . $this->_var_regexp . '(?:' . $this->_mod_regexp . '*)?    | # var or quoted string
+                \-?0[xX][0-9a-fA-F]+|\-?\d+(?:\.\d+)?|\.\d+|!==|===|==|!=|<>|<<|>>|<=|>=|\&\&|\|\||\(|\)|,|\!|\^|=|\&|\~|<|>|\||\%|\+|\-|\/|\*|\@    | # valid non-word token
+                \b\w+\b                                                        | # valid word token
+                \S+                                                           # anything else
+                )~x', $tag_args, $match);
+        $tokens = $match[0];
+        if(empty($tokens)) {
+            $_error_msg = $elseif ? "'elseif'" : "'if'";
+            $_error_msg .= ' statement requires arguments';
+            $this->_syntax_error($_error_msg, E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $token_count = array_count_values($tokens);
+        if(isset($token_count['(']) && $token_count['('] != $token_count[')']) {
+            $this->_syntax_error("unbalanced parenthesis in if statement", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        $is_arg_stack = array();
+        for ($i = 0; $i < count($tokens); $i++) {
+            $token = &$tokens[$i];
+            switch (strtolower($token)) {
+                case '!':
+                case '%':
+                case '!==':
+                case '==':
+                case '===':
+                case '>':
+                case '<':
+                case '!=':
+                case '<>':
+                case '<<':
+                case '>>':
+                case '<=':
+                case '>=':
+                case '&&':
+                case '||':
+                case '|':
+                case '^':
+                case '&':
+                case '~':
+                case ')':
+                case ',':
+                case '+':
+                case '-':
+                case '*':
+                case '/':
+                case '@':
+                    break;
+                case 'eq':
+                    $token = '==';
+                    break;
+                case 'ne':
+                case 'neq':
+                    $token = '!=';
+                    break;
+                case 'lt':
+                    $token = '<';
+                    break;
+                case 'le':
+                case 'lte':
+                    $token = '<=';
+                    break;
+                case 'gt':
+                    $token = '>';
+                    break;
+                case 'ge':
+                case 'gte':
+                    $token = '>=';
+                    break;
+                case 'and':
+                    $token = '&&';
+                    break;
+                case 'or':
+                    $token = '||';
+                    break;
+                case 'not':
+                    $token = '!';
+                    break;
+                case 'mod':
+                    $token = '%';
+                    break;
+                case '(':
+                    array_push($is_arg_stack, $i);
+                    break;
+                case 'is':
+                    /* If last token was a ')', we operate on the parenthesized
+                       expression. The start of the expression is on the stack.
+                       Otherwise, we operate on the last encountered token. */
+                    if ($tokens[$i-1] == ')')
+                        $is_arg_start = array_pop($is_arg_stack);
+                    else
+                        $is_arg_start = $i-1;
+                    /* Construct the argument for 'is' expression, so it knows
+                       what to operate on. */
+                    $is_arg = implode(' ', array_slice($tokens, $is_arg_start, $i - $is_arg_start));
+                    /* Pass all tokens from next one until the end to the
+                       'is' expression parsing function. The function will
+                       return modified tokens, where the first one is the result
+                       of the 'is' expression and the rest are the tokens it
+                       didn't touch. */
+                    $new_tokens = $this->_parse_is_expr($is_arg, array_slice($tokens, $i+1));
+                    /* Replace the old tokens with the new ones. */
+                    array_splice($tokens, $is_arg_start, count($tokens), $new_tokens);
+                    /* Adjust argument start so that it won't change from the
+                       current position for the next iteration. */
+                    $i = $is_arg_start;
+                    break;
+                default:
+                    if(preg_match('~^' . $this->_func_regexp . '$~', $token) ) {
+                            if($this->security &&
+                               !in_array($token, $this->security_settings['IF_FUNCS'])) {
+                                $this->_syntax_error("(secure mode) '$token' not allowed in if statement", E_USER_ERROR, __FILE__, __LINE__);
+                            }
+                    } elseif(preg_match('~^' . $this->_var_regexp . '$~', $token) && (strpos('+-*/^%&|', substr($token, -1)) === false) && isset($tokens[$i+1]) && $tokens[$i+1] == '(') {
+                        $this->_syntax_error("variable function call '$token' not allowed in if statement", E_USER_ERROR, __FILE__, __LINE__);
+                    } elseif(preg_match('~^' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '(?:' . $this->_mod_regexp . '*)$~', $token)) {
+                        $token = $this->_parse_var_props($token);
+                    } elseif(is_numeric($token)) {
+                    } else {
+                        $this->_syntax_error("unidentified token '$token'", E_USER_ERROR, __FILE__, __LINE__);
+                    }
+                    break;
+            }
+        }
+        if ($elseif)
+            return '<?php elseif ('.implode(' ', $tokens).'): ?>';
+        else
+            return '<?php if ('.implode(' ', $tokens).'): ?>';
+    }
+    function _compile_arg_list($type, $name, $attrs, &$cache_code) {
+        $arg_list = array();
+        if (isset($type) && isset($name)
+            && isset($this->_plugins[$type])
+            && isset($this->_plugins[$type][$name])
+            && empty($this->_plugins[$type][$name][4])
+            && is_array($this->_plugins[$type][$name][5])
+            ) {
+            /* we have a list of parameters that should be cached */
+            $_cache_attrs = $this->_plugins[$type][$name][5];
+            $_count = $this->_cache_attrs_count++;
+            $cache_code = "\$_cache_attrs =& \$this->_smarty_cache_attrs('$this->_cache_serial','$_count');";
+        } else {
+            /* no parameters are cached */
+            $_cache_attrs = null;
+        }
+        foreach ($attrs as $arg_name => $arg_value) {
+            if (is_bool($arg_value))
+                $arg_value = $arg_value ? 'true' : 'false';
+            if (is_null($arg_value))
+                $arg_value = 'null';
+            if ($_cache_attrs && in_array($arg_name, $_cache_attrs)) {
+                $arg_list[] = "'$arg_name' => (\$this->_cache_including) ? \$_cache_attrs['$arg_name'] : (\$_cache_attrs['$arg_name']=$arg_value)";
+            } else {
+                $arg_list[] = "'$arg_name' => $arg_value";
+            }
+        }
+        return $arg_list;
+    }
+    /**
+     * Parse is expression
+     *
+     * @param string $is_arg
+     * @param array $tokens
+     * @return array
+     */
+    function _parse_is_expr($is_arg, $tokens)
+    {
+        $expr_end = 0;
+        $negate_expr = false;
+        if (($first_token = array_shift($tokens)) == 'not') {
+            $negate_expr = true;
+            $expr_type = array_shift($tokens);
+        } else
+            $expr_type = $first_token;
+        switch ($expr_type) {
+            case 'even':
+                if (isset($tokens[$expr_end]) && $tokens[$expr_end] == 'by') {
+                    $expr_end++;
+                    $expr_arg = $tokens[$expr_end++];
+                    $expr = "!(1 & ($is_arg / " . $this->_parse_var_props($expr_arg) . "))";
+                } else
+                    $expr = "!(1 & $is_arg)";
+                break;
+            case 'odd':
+                if (isset($tokens[$expr_end]) && $tokens[$expr_end] == 'by') {
+                    $expr_end++;
+                    $expr_arg = $tokens[$expr_end++];
+                    $expr = "(1 & ($is_arg / " . $this->_parse_var_props($expr_arg) . "))";
+                } else
+                    $expr = "(1 & $is_arg)";
+                break;
+            case 'div':
+                if (@$tokens[$expr_end] == 'by') {
+                    $expr_end++;
+                    $expr_arg = $tokens[$expr_end++];
+                    $expr = "!($is_arg % " . $this->_parse_var_props($expr_arg) . ")";
+                } else {
+                    $this->_syntax_error("expecting 'by' after 'div'", E_USER_ERROR, __FILE__, __LINE__);
+                }
+                break;
+            default:
+                $this->_syntax_error("unknown 'is' expression - '$expr_type'", E_USER_ERROR, __FILE__, __LINE__);
+                break;
+        }
+        if ($negate_expr) {
+            $expr = "!($expr)";
+        }
+        array_splice($tokens, 0, $expr_end, $expr);
+        return $tokens;
+    }
+    /**
+     * Parse attribute string
+     *
+     * @param string $tag_args
+     * @return array
+     */
+    function _parse_attrs($tag_args)
+    {
+        /* Tokenize tag attributes. */
+        preg_match_all('~(?:' . $this->_obj_call_regexp . '|' . $this->_qstr_regexp . ' | (?>[^"\'=\s]+)
+                         )+ |
+                         [=]
+                        ~x', $tag_args, $match);
+        $tokens       = $match[0];
+        $attrs = array();
+        /* Parse state:
+            0 - expecting attribute name
+            1 - expecting '='
+            2 - expecting attribute value (not '=') */
+        $state = 0;
+        foreach ($tokens as $token) {
+            switch ($state) {
+                case 0:
+                    /* If the token is a valid identifier, we set attribute name
+                       and go to state 1. */
+                    if (preg_match('~^\w+$~', $token)) {
+                        $attr_name = $token;
+                        $state = 1;
+                    } else
+                        $this->_syntax_error("invalid attribute name: '$token'", E_USER_ERROR, __FILE__, __LINE__);
+                    break;
+                case 1:
+                    /* If the token is '=', then we go to state 2. */
+                    if ($token == '=') {
+                        $state = 2;
+                    } else
+                        $this->_syntax_error("expecting '=' after attribute name '$last_token'", E_USER_ERROR, __FILE__, __LINE__);
+                    break;
+                case 2:
+                    /* If token is not '=', we set the attribute value and go to
+                       state 0. */
+                    if ($token != '=') {
+                        /* We booleanize the token if it's a non-quoted possible
+                           boolean value. */
+                        if (preg_match('~^(on|yes|true)$~', $token)) {
+                            $token = 'true';
+                        } else if (preg_match('~^(off|no|false)$~', $token)) {
+                            $token = 'false';
+                        } else if ($token == 'null') {
+                            $token = 'null';
+                        } else if (preg_match('~^' . $this->_num_const_regexp . '|0[xX][0-9a-fA-F]+$~', $token)) {
+                            /* treat integer literally */
+                        } else if (!preg_match('~^' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '(?:' . $this->_mod_regexp . ')*$~', $token)) {
+                            /* treat as a string, double-quote it escaping quotes */
+                            $token = '"'.addslashes($token).'"';
+                        }
+                        $attrs[$attr_name] = $token;
+                        $state = 0;
+                    } else
+                        $this->_syntax_error("'=' cannot be an attribute value", E_USER_ERROR, __FILE__, __LINE__);
+                    break;
+            }
+            $last_token = $token;
+        }
+        if($state != 0) {
+            if($state == 1) {
+                $this->_syntax_error("expecting '=' after attribute name '$last_token'", E_USER_ERROR, __FILE__, __LINE__);
+            } else {
+                $this->_syntax_error("missing attribute value", E_USER_ERROR, __FILE__, __LINE__);
+            }
+        }
+        $this->_parse_vars_props($attrs);
+        return $attrs;
+    }
+    /**
+     * compile multiple variables and section properties tokens into
+     * PHP code
+     *
+     * @param array $tokens
+     */
+    function _parse_vars_props(&$tokens)
+    {
+        foreach($tokens as $key => $val) {
+            $tokens[$key] = $this->_parse_var_props($val);
+        }
+    }
+    /**
+     * compile single variable and section properties token into
+     * PHP code
+     *
+     * @param string $val
+     * @param string $tag_attrs
+     * @return string
+     */
+    function _parse_var_props($val)
+    {
+        $val = trim($val);
+        if(preg_match('~^(' . $this->_obj_call_regexp . '|' . $this->_dvar_regexp . ')(' . $this->_mod_regexp . '*)$~', $val, $match)) {
+            $return = $this->_parse_var($match[1]);
+            $modifiers = $match[2];
+            if (!empty($this->default_modifiers) && !preg_match('~(^|\|)smarty:nodefaults($|\|)~',$modifiers)) {
+                $_default_mod_string = implode('|',(array)$this->default_modifiers);
+                $modifiers = empty($modifiers) ? $_default_mod_string : $_default_mod_string . '|' . $modifiers;
+            }
+            $this->_parse_modifiers($return, $modifiers);
+            return $return;
+        } elseif (preg_match('~^' . $this->_db_qstr_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
+                preg_match('~^(' . $this->_db_qstr_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
+                $return = $this->_expand_quoted_text($match[1]);
+                if($match[2] != '') {
+                    $this->_parse_modifiers($return, $match[2]);
+                }
+                return $return;
+            }
+        elseif(preg_match('~^' . $this->_num_const_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
+                preg_match('~^(' . $this->_num_const_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
+                if($match[2] != '') {
+                    $this->_parse_modifiers($match[1], $match[2]);
+                    return $match[1];
+                }
+            }
+        elseif(preg_match('~^' . $this->_si_qstr_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
+                preg_match('~^(' . $this->_si_qstr_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
+                if($match[2] != '') {
+                    $this->_parse_modifiers($match[1], $match[2]);
+                    return $match[1];
+                }
+            }
+        elseif(preg_match('~^' . $this->_cvar_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
+                return $this->_parse_conf_var($val);
+            }
+        elseif(preg_match('~^' . $this->_svar_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
+                return $this->_parse_section_prop($val);
+            }
+        elseif(!in_array($val, $this->_permitted_tokens) && !is_numeric($val)) {
+            return $this->_expand_quoted_text('"' . strtr($val, array('\\' => '\\\\', '"' => '\\"')) .'"');
+        }
+        return $val;
+    }
+    /**
+     * expand quoted text with embedded variables
+     *
+     * @param string $var_expr
+     * @return string
+     */
+    function _expand_quoted_text($var_expr)
+    {
+        if(preg_match_all('~(?:\`(?<!\\\\)\$' . $this->_dvar_guts_regexp . '(?:' . $this->_obj_ext_regexp . ')*\`)|(?:(?<!\\\\)\$\w+(\[[a-zA-Z0-9]+\])*)~', $var_expr, $_match)) {
+            $_match = $_match[0];
+            $_replace = array();
+            foreach($_match as $_var) {
+                $_replace[$_var] = '".(' . $this->_parse_var(str_replace('`','',$_var)) . ')."';
+            }
+            $var_expr = strtr($var_expr, $_replace);
+            $_return = preg_replace('~\.""|(?<!\\\\)""\.~', '', $var_expr);
+        } else {
+            $_return = $var_expr;
+        }
+        $_return = preg_replace('~^"([\s\w]+)"$~',"'\\1'",$_return);
+        return $_return;
+    }
+    /**
+     * parse variable expression into PHP code
+     *
+     * @param string $var_expr
+     * @param string $output
+     * @return string
+     */
+    function _parse_var($var_expr)
+    {
+        $_has_math = false;
+        $_math_vars = preg_split('~('.$this->_dvar_math_regexp.'|'.$this->_qstr_regexp.')~', $var_expr, -1, PREG_SPLIT_DELIM_CAPTURE);
+        if(count($_math_vars) > 1) {
+            $_first_var = "";
+            $_complete_var = "";
+            $_output = "";
+            foreach($_math_vars as $_k => $_math_var) {
+                $_math_var = $_math_vars[$_k];
+                if(!empty($_math_var) || is_numeric($_math_var)) {
+                    if(preg_match('~^' . $this->_dvar_math_regexp . '$~', $_math_var)) {
+                        $_has_math = true;
+                        if(!empty($_complete_var) || is_numeric($_complete_var)) {
+                            $_output .= $this->_parse_var($_complete_var);
+                        }
+                        $_output .= $_math_var;
+                        if(empty($_first_var))
+                            $_first_var = $_complete_var;
+                        $_complete_var = "";
+                    } else {
+                        $_complete_var .= $_math_var;
+                    }
+                }
+            }
+            if($_has_math) {
+                if(!empty($_complete_var) || is_numeric($_complete_var))
+                    $_output .= $this->_parse_var($_complete_var);
+                $var_expr = $_complete_var;
+            }
+        }
+        if(is_numeric(substr($var_expr, 0, 1)))
+            $_var_ref = $var_expr;
+        else
+            $_var_ref = substr($var_expr, 1);
+        if(!$_has_math) {
+            preg_match_all('~(?:^\w+)|' . $this->_obj_params_regexp . '|(?:' . $this->_var_bracket_regexp . ')|->\$?\w+|\.\$?\w+|\S+~', $_var_ref, $match);
+            $_indexes = $match[0];
+            $_var_name = array_shift($_indexes);
+            /* Handle $smarty.* variable references as a special case. */
+            if ($_var_name == 'smarty') {
+                /*
+                 * If the reference could be compiled, use the compiled output;
+                 * otherwise, fall back on the $smarty variable generated at
+                 * run-time.
+                 */
+                if (($smarty_ref = $this->_compile_smarty_ref($_indexes)) !== null) {
+                    $_output = $smarty_ref;
+                } else {
+                    $_var_name = substr(array_shift($_indexes), 1);
+                    $_output = "\$this->_smarty_vars['$_var_name']";
+                }
+            } elseif(is_numeric($_var_name) && is_numeric(substr($var_expr, 0, 1))) {
+                if(count($_indexes) > 0)
+                {
+                    $_var_name .= implode("", $_indexes);
+                    $_indexes = array();
+                }
+                $_output = $_var_name;
+            } else {
+                $_output = "\$this->_tpl_vars['$_var_name']";
+            }
+            foreach ($_indexes as $_index) {
+                if (substr($_index, 0, 1) == '[') {
+                    $_index = substr($_index, 1, -1);
+                    if (is_numeric($_index)) {
+                        $_output .= "[$_index]";
+                    } elseif (substr($_index, 0, 1) == '$') {
+                        if (strpos($_index, '.') !== false) {
+                            $_output .= '[' . $this->_parse_var($_index) . ']';
+                        } else {
+                            $_output .= "[\$this->_tpl_vars['" . substr($_index, 1) . "']]";
+                        }
+                    } else {
+                        $_var_parts = explode('.', $_index);
+                        $_var_section = $_var_parts[0];
+                        $_var_section_prop = isset($_var_parts[1]) ? $_var_parts[1] : 'index';
+                        $_output .= "[\$this->_sections['$_var_section']['$_var_section_prop']]";
+                    }
+                } else if (substr($_index, 0, 1) == '.') {
+                    if (substr($_index, 1, 1) == '$')
+                        $_output .= "[\$this->_tpl_vars['" . substr($_index, 2) . "']]";
+                    else
+                        $_output .= "['" . substr($_index, 1) . "']";
+                } else if (substr($_index,0,2) == '->') {
+                    if(substr($_index,2,2) == '__') {
+                        $this->_syntax_error('call to internal object members is not allowed', E_USER_ERROR, __FILE__, __LINE__);
+                    } elseif($this->security && substr($_index, 2, 1) == '_') {
+                        $this->_syntax_error('(secure) call to private object member is not allowed', E_USER_ERROR, __FILE__, __LINE__);
+                    } elseif (substr($_index, 2, 1) == '$') {
+                        if ($this->security) {
+                            $this->_syntax_error('(secure) call to dynamic object member is not allowed', E_USER_ERROR, __FILE__, __LINE__);
+                        } else {
+                            $_output .= '->{(($_var=$this->_tpl_vars[\''.substr($_index,3).'\']) && substr($_var,0,2)!=\'__\') ? $_var : $this->trigger_error("cannot access property \\"$_var\\"")}';
+                        }
+                    } else {
+                        $_output .= $_index;
+                    }
+                } elseif (substr($_index, 0, 1) == '(') {
+                    $_index = $this->_parse_parenth_args($_index);
+                    $_output .= $_index;
+                } else {
+                    $_output .= $_index;
+                }
+            }
+        }
+        return $_output;
+    }
+    /**
+     * parse arguments in function call parenthesis
+     *
+     * @param string $parenth_args
+     * @return string
+     */
+    function _parse_parenth_args($parenth_args)
+    {
+        preg_match_all('~' . $this->_param_regexp . '~',$parenth_args, $match);
+        $orig_vals = $match = $match[0];
+        $this->_parse_vars_props($match);
+        $replace = array();
+        for ($i = 0, $count = count($match); $i < $count; $i++) {
+            $replace[$orig_vals[$i]] = $match[$i];
+        }
+        return strtr($parenth_args, $replace);
+    }
+    /**
+     * parse configuration variable expression into PHP code
+     *
+     * @param string $conf_var_expr
+     */
+    function _parse_conf_var($conf_var_expr)
+    {
+        $parts = explode('|', $conf_var_expr, 2);
+        $var_ref = $parts[0];
+        $modifiers = isset($parts[1]) ? $parts[1] : '';
+        $var_name = substr($var_ref, 1, -1);
+        $output = "\$this->_config[0]['vars']['$var_name']";
+        $this->_parse_modifiers($output, $modifiers);
+        return $output;
+    }
+    /**
+     * parse section property expression into PHP code
+     *
+     * @param string $section_prop_expr
+     * @return string
+     */
+    function _parse_section_prop($section_prop_expr)
+    {
+        $parts = explode('|', $section_prop_expr, 2);
+        $var_ref = $parts[0];
+        $modifiers = isset($parts[1]) ? $parts[1] : '';
+        preg_match('!%(\w+)\.(\w+)%!', $var_ref, $match);
+        $section_name = $match[1];
+        $prop_name = $match[2];
+        $output = "\$this->_sections['$section_name']['$prop_name']";
+        $this->_parse_modifiers($output, $modifiers);
+        return $output;
+    }
+    /**
+     * parse modifier chain into PHP code
+     *
+     * sets $output to parsed modified chain
+     * @param string $output
+     * @param string $modifier_string
+     */
+    function _parse_modifiers(&$output, $modifier_string)
+    {
+        preg_match_all('~\|(@?\w+)((?>:(?:'. $this->_qstr_regexp . '|[^|]+))*)~', '|' . $modifier_string, $_match);
+        list(, $_modifiers, $modifier_arg_strings) = $_match;
+        for ($_i = 0, $_for_max = count($_modifiers); $_i < $_for_max; $_i++) {
+            $_modifier_name = $_modifiers[$_i];
+            if($_modifier_name == 'smarty') {
+                continue;
+            }
+            preg_match_all('~:(' . $this->_qstr_regexp . '|[^:]+)~', $modifier_arg_strings[$_i], $_match);
+            $_modifier_args = $_match[1];
+            if (substr($_modifier_name, 0, 1) == '@') {
+                $_map_array = false;
+                $_modifier_name = substr($_modifier_name, 1);
+            } else {
+                $_map_array = true;
+            }
+            if (empty($this->_plugins['modifier'][$_modifier_name])
+                && !$this->_get_plugin_filepath('modifier', $_modifier_name)
+                && function_exists($_modifier_name)) {
+                if ($this->security && !in_array($_modifier_name, $this->security_settings['MODIFIER_FUNCS'])) {
+                    $this->_trigger_fatal_error("[plugin] (secure mode) modifier '$_modifier_name' is not allowed" , $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
+                } else {
+                    $this->_plugins['modifier'][$_modifier_name] = array($_modifier_name,  null, null, false);
+                }
+            }
+            $this->_add_plugin('modifier', $_modifier_name);
+            $this->_parse_vars_props($_modifier_args);
+            if($_modifier_name == 'default') {
+                if(substr($output, 0, 1) == '$') {
+                    $output = '@' . $output;
+                }
+                if(isset($_modifier_args[0]) && substr($_modifier_args[0], 0, 1) == '$') {
+                    $_modifier_args[0] = '@' . $_modifier_args[0];
+                }
+            }
+            if (count($_modifier_args) > 0)
+                $_modifier_args = ', '.implode(', ', $_modifier_args);
+            else
+                $_modifier_args = '';
+            if ($_map_array) {
+                $output = "((is_array(\$_tmp=$output)) ? \$this->_run_mod_handler('$_modifier_name', true, \$_tmp$_modifier_args) : " . $this->_compile_plugin_call('modifier', $_modifier_name) . "(\$_tmp$_modifier_args))";
+            } else {
+                $output = $this->_compile_plugin_call('modifier', $_modifier_name)."($output$_modifier_args)";
+            }
+        }
+    }
+    /**
+     * add plugin
+     *
+     * @param string $type
+     * @param string $name
+     * @param boolean? $delayed_loading
+     */
+    function _add_plugin($type, $name, $delayed_loading = null)
+    {
+        if (!isset($this->_plugin_info[$type])) {
+            $this->_plugin_info[$type] = array();
+        }
+        if (!isset($this->_plugin_info[$type][$name])) {
+            $this->_plugin_info[$type][$name] = array($this->_current_file,
+                                                      $this->_current_line_no,
+                                                      $delayed_loading);
+        }
+    }
+    /**
+     * Compiles references of type $smarty.foo
+     *
+     * @param string $indexes
+     * @return string
+     */
+    function _compile_smarty_ref(&$indexes)
+    {
+        /* Extract the reference name. */
+        $_ref = substr($indexes[0], 1);
+        foreach($indexes as $_index_no=>$_index) {
+            if (substr($_index, 0, 1) != '.' && $_index_no<2 || !preg_match('~^(\.|\[|->)~', $_index)) {
+                $this->_syntax_error('$smarty' . implode('', array_slice($indexes, 0, 2)) . ' is an invalid reference', E_USER_ERROR, __FILE__, __LINE__);
+            }
+        }
+        switch ($_ref) {
+            case 'now':
+                $compiled_ref = 'time()';
+                $_max_index = 1;
+                break;
+            case 'foreach':
+                array_shift($indexes);
+                $_var = $this->_parse_var_props(substr($indexes[0], 1));
+                $_propname = substr($indexes[1], 1);
+                $_max_index = 1;
+                switch ($_propname) {
+                    case 'index':
+                        array_shift($indexes);
+                        $compiled_ref = "(\$this->_foreach[$_var]['iteration']-1)";
+                        break;
+                    case 'first':
+                        array_shift($indexes);
+                        $compiled_ref = "(\$this->_foreach[$_var]['iteration'] <= 1)";
+                        break;
+                    case 'last':
+                        array_shift($indexes);
+                        $compiled_ref = "(\$this->_foreach[$_var]['iteration'] == \$this->_foreach[$_var]['total'])";
+                        break;
+                    case 'show':
+                        array_shift($indexes);
+                        $compiled_ref = "(\$this->_foreach[$_var]['total'] > 0)";
+                        break;
+                    default:
+                        unset($_max_index);
+                        $compiled_ref = "\$this->_foreach[$_var]";
+                }
+                break;
+            case 'section':
+                array_shift($indexes);
+                $_var = $this->_parse_var_props(substr($indexes[0], 1));
+                $compiled_ref = "\$this->_sections[$_var]";
+                break;
+            case 'get':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_GET' : "\$GLOBALS['HTTP_GET_VARS']";
+                break;
+            case 'post':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_POST' : "\$GLOBALS['HTTP_POST_VARS']";
+                break;
+            case 'cookies':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_COOKIE' : "\$GLOBALS['HTTP_COOKIE_VARS']";
+                break;
+            case 'env':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_ENV' : "\$GLOBALS['HTTP_ENV_VARS']";
+                break;
+            case 'server':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_SERVER' : "\$GLOBALS['HTTP_SERVER_VARS']";
+                break;
+            case 'session':
+                $compiled_ref = ($this->request_use_auto_globals) ? '$_SESSION' : "\$GLOBALS['HTTP_SESSION_VARS']";
+                break;
+            /*
+             * These cases are handled either at run-time or elsewhere in the
+             * compiler.
+             */
+            case 'request':
+                if ($this->request_use_auto_globals) {
+                    $compiled_ref = '$_REQUEST';
+                    break;
+                } else {
+                    $this->_init_smarty_vars = true;
+                }
+                return null;
+            case 'capture':
+                return null;
+            case 'template':
+                $compiled_ref = "'$this->_current_file'";
+                $_max_index = 1;
+                break;
+            case 'version':
+                $compiled_ref = "'$this->_version'";
+                $_max_index = 1;
+                break;
+            case 'const':
+                if ($this->security && !$this->security_settings['ALLOW_CONSTANTS']) {
+                    $this->_syntax_error("(secure mode) constants not permitted",
+                                         E_USER_WARNING, __FILE__, __LINE__);
+                    return;
+                }
+                array_shift($indexes);
+                if (preg_match('!^\.\w+$!', $indexes[0])) {
+                    $compiled_ref = '@' . substr($indexes[0], 1);
+                } else {
+                    $_val = $this->_parse_var_props(substr($indexes[0], 1));
+                    $compiled_ref = '@constant(' . $_val . ')';
+                }
+                $_max_index = 1;
+                break;
+            case 'config':
+                $compiled_ref = "\$this->_config[0]['vars']";
+                $_max_index = 3;
+                break;
+            case 'ldelim':
+                $compiled_ref = "'$this->left_delimiter'";
+                break;
+            case 'rdelim':
+                $compiled_ref = "'$this->right_delimiter'";
+                break;
+            default:
+                $this->_syntax_error('$smarty.' . $_ref . ' is an unknown reference', E_USER_ERROR, __FILE__, __LINE__);
+                break;
+        }
+        if (isset($_max_index) && count($indexes) > $_max_index) {
+            $this->_syntax_error('$smarty' . implode('', $indexes) .' is an invalid reference', E_USER_ERROR, __FILE__, __LINE__);
+        }
+        array_shift($indexes);
+        return $compiled_ref;
+    }
+    /**
+     * compiles call to plugin of type $type with name $name
+     * returns a string containing the function-name or method call
+     * without the paramter-list that would have follow to make the
+     * call valid php-syntax
+     *
+     * @param string $type
+     * @param string $name
+     * @return string
+     */
+    function _compile_plugin_call($type, $name) {
+        if (isset($this->_plugins[$type][$name])) {
+            /* plugin loaded */
+            if (is_array($this->_plugins[$type][$name][0])) {
+                return ((is_object($this->_plugins[$type][$name][0][0])) ?
+                        "\$this->_plugins['$type']['$name'][0][0]->"    /* method callback */
+                        : (string)($this->_plugins[$type][$name][0][0]).'::'    /* class callback */
+                       ). $this->_plugins[$type][$name][0][1];
+            } else {
+                /* function callback */
+                return $this->_plugins[$type][$name][0];
+            }
+        } else {
+            /* plugin not loaded -> auto-loadable-plugin */
+            return 'smarty_'.$type.'_'.$name;
+        }
+    }
+    /**
+     * load pre- and post-filters
+     */
+    function _load_filters()
+    {
+        if (count($this->_plugins['prefilter']) > 0) {
+            foreach ($this->_plugins['prefilter'] as $filter_name => $prefilter) {
+                if ($prefilter === false) {
+                    unset($this->_plugins['prefilter'][$filter_name]);
+                    $_params = array('plugins' => array(array('prefilter', $filter_name, null, null, false)));
+                    require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
+                    smarty_core_load_plugins($_params, $this);
+                }
+            }
+        }
+        if (count($this->_plugins['postfilter']) > 0) {
+            foreach ($this->_plugins['postfilter'] as $filter_name => $postfilter) {
+                if ($postfilter === false) {
+                    unset($this->_plugins['postfilter'][$filter_name]);
+                    $_params = array('plugins' => array(array('postfilter', $filter_name, null, null, false)));
+                    require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
+                    smarty_core_load_plugins($_params, $this);
+                }
+            }
+        }
+    }
+    /**
+     * Quote subpattern references
+     *
+     * @param string $string
+     * @return string
+     */
+    function _quote_replace($string)
+    {
+        return strtr($string, array('\\' => '\\\\', '$' => '\\$'));
+    }
+    /**
+     * display Smarty syntax error
+     *
+     * @param string $error_msg
+     * @param integer $error_type
+     * @param string $file
+     * @param integer $line
+     */
+    function _syntax_error($error_msg, $error_type = E_USER_ERROR, $file=null, $line=null)
+    {
+        $this->_trigger_fatal_error("syntax error: $error_msg", $this->_current_file, $this->_current_line_no, $file, $line, $error_type);
+    }
+    /**
+     * check if the compilation changes from cacheable to
+     * non-cacheable state with the beginning of the current
+     * plugin. return php-code to reflect the transition.
+     * @return string
+     */
+    function _push_cacheable_state($type, $name) {
+        $_cacheable = !isset($this->_plugins[$type][$name]) || $this->_plugins[$type][$name][4];
+        if ($_cacheable
+            || 0<$this->_cacheable_state++) return '';
+        if (!isset($this->_cache_serial)) $this->_cache_serial = md5(uniqid('Smarty'));
+        $_ret = 'if ($this->caching && !$this->_cache_including): echo \'{nocache:'
+            . $this->_cache_serial . '#' . $this->_nocache_count
+            . '}\'; endif;';
+        return $_ret;
+    }
+    /**
+     * check if the compilation changes from non-cacheable to
+     * cacheable state with the end of the current plugin return
+     * php-code to reflect the transition.
+     * @return string
+     */
+    function _pop_cacheable_state($type, $name) {
+        $_cacheable = !isset($this->_plugins[$type][$name]) || $this->_plugins[$type][$name][4];
+        if ($_cacheable
+            || --$this->_cacheable_state>0) return '';
+        return 'if ($this->caching && !$this->_cache_including): echo \'{/nocache:'
+            . $this->_cache_serial . '#' . ($this->_nocache_count++)
+            . '}\'; endif;';
+    }
+    /**
+     * push opening tag-name, file-name and line-number on the tag-stack
+     * @param string the opening tag's name
+     */
+    function _push_tag($open_tag)
+    {
+        array_push($this->_tag_stack, array($open_tag, $this->_current_line_no));
+    }
+    /**
+     * pop closing tag-name
+     * raise an error if this stack-top doesn't match with the closing tag
+     * @param string the closing tag's name
+     * @return string the opening tag's name
+     */
+    function _pop_tag($close_tag)
+    {
+        $message = '';
+        if (count($this->_tag_stack)>0) {
+            list($_open_tag, $_line_no) = array_pop($this->_tag_stack);
+            if ($close_tag == $_open_tag) {
+                return $_open_tag;
+            }
+            if ($close_tag == 'if' && ($_open_tag == 'else' || $_open_tag == 'elseif' )) {
+                return $this->_pop_tag($close_tag);
+            }
+            if ($close_tag == 'section' && $_open_tag == 'sectionelse') {
+                $this->_pop_tag($close_tag);
+                return $_open_tag;
+            }
+            if ($close_tag == 'foreach' && $_open_tag == 'foreachelse') {
+                $this->_pop_tag($close_tag);
+                return $_open_tag;
+            }
+            if ($_open_tag == 'else' || $_open_tag == 'elseif') {
+                $_open_tag = 'if';
+            } elseif ($_open_tag == 'sectionelse') {
+                $_open_tag = 'section';
+            } elseif ($_open_tag == 'foreachelse') {
+                $_open_tag = 'foreach';
+            }
+            $message = " expected {/$_open_tag} (opened line $_line_no).";
+        }
+        $this->_syntax_error("mismatched tag {/$close_tag}.$message",
+                             E_USER_ERROR, __FILE__, __LINE__);
+    }
+}
+/**
+ * compare to values by their string length
+ *
+ * @access private
+ * @param string $a
+ * @param string $b
+ * @return 0|-1|1
+ */
+function _smarty_sort_length($a, $b)
+{
+    if($a == $b)
+        return 0;
+    if(strlen($a) == strlen($b))
+        return ($a > $b) ? -1 : 1;
+    return (strlen($a) > strlen($b)) ? -1 : 1;
+}
+/* vim: set et: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.assemble_plugin_filepath.php
@@ -0,0 +1,53 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * assemble filepath of requested plugin
+ *
+ * @param string $type
+ * @param string $name
+ * @return string|false
+ */
+function smarty_core_assemble_plugin_filepath($params, &$smarty)
+{
+    static $_filepaths_cache = array();
+    $_plugin_filename = $params['type'] . '.' . $params['name'] . '.php';
+    if (isset($_filepaths_cache[$_plugin_filename])) {
+        return $_filepaths_cache[$_plugin_filename];
+    }
+    $_return = false;
+    foreach ((array)$smarty->plugins_dir as $_plugin_dir) {
+        $_plugin_filepath = $_plugin_dir . DIRECTORY_SEPARATOR . $_plugin_filename;
+        if (!preg_match("/^([\/\\\\]|[a-zA-Z]:[\/\\\\])/", $_plugin_dir)) {
+            $_relative_paths[] = $_plugin_dir;
+            if (@is_readable(SMARTY_DIR . $_plugin_filepath)) {
+                $_return = SMARTY_DIR . $_plugin_filepath;
+                break;
+            }
+        }
+        if (@is_readable($_plugin_filepath)) {
+            $_return = $_plugin_filepath;
+            break;
+        }
+    }
+    if($_return === false) {
+        if(isset($_relative_paths)) {
+            foreach ((array)$_relative_paths as $_plugin_dir) {
+                $_plugin_filepath = $_plugin_dir . DIRECTORY_SEPARATOR . $_plugin_filename;
+                $_params = array('file_path' => $_plugin_filepath);
+                require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
+                if(smarty_core_get_include_path($_params, $smarty)) {
+                    $_return = $_params['new_file_path'];
+                    break;
+                }
+            }
+        }
+    }
+    $_filepaths_cache[$_plugin_filename] = $_return;
+    return $_return;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.assign_smarty_interface.php
@@ -0,0 +1,36 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty assign_smarty_interface core plugin
+ *
+ * Type:     core<br />
+ * Name:     assign_smarty_interface<br />
+ * Purpose:  assign the $smarty interface variable
+ * @param array Format: null
+ * @param Smarty
+ */
+function smarty_core_assign_smarty_interface($params, &$smarty)
+{
+        if (isset($smarty->_smarty_vars) && isset($smarty->_smarty_vars['request'])) {
+            return;
+        }
+        $_globals_map = array('g'  => 'HTTP_GET_VARS',
+                             'p'  => 'HTTP_POST_VARS',
+                             'c'  => 'HTTP_COOKIE_VARS',
+                             's'  => 'HTTP_SERVER_VARS',
+                             'e'  => 'HTTP_ENV_VARS');
+        $_smarty_vars_request  = array();
+        foreach (preg_split('!!', strtolower($smarty->request_vars_order)) as $_c) {
+            if (isset($_globals_map[$_c])) {
+                $_smarty_vars_request = array_merge($_smarty_vars_request, $GLOBALS[$_globals_map[$_c]]);
+            }
+        }
+        $_smarty_vars_request = @array_merge($_smarty_vars_request, $GLOBALS['HTTP_SESSION_VARS']);
+        $smarty->_smarty_vars['request'] = $_smarty_vars_request;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.create_dir_structure.php
@@ -0,0 +1,63 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * create full directory structure
+ *
+ * @param string $dir
+ */
+function smarty_core_create_dir_structure($params, &$smarty)
+{
+    if (!file_exists($params['dir'])) {
+        $_open_basedir_ini = ini_get('open_basedir');
+        if (DIRECTORY_SEPARATOR=='/') {
+            /* unix-style paths */
+            $_dir = $params['dir'];
+            $_dir_parts = preg_split('!/+!', $_dir, -1, preg_split_NO_EMPTY);
+            $_new_dir = (substr($_dir, 0, 1)=='/') ? '/' : getcwd().'/';
+            if($_use_open_basedir = !empty($_open_basedir_ini)) {
+                $_open_basedirs = explode(':', $_open_basedir_ini);
+            }
+        } else {
+            /* other-style paths */
+            $_dir = str_replace('\\','/', $params['dir']);
+            $_dir_parts = preg_split('!/+!', $_dir, -1, preg_split_NO_EMPTY);
+            if (preg_match('!^((//)|([a-zA-Z]:/))!', $_dir, $_root_dir)) {
+                /* leading "//" for network volume, or "[letter]:/" for full path */
+                $_new_dir = $_root_dir[1];
+                /* remove drive-letter from _dir_parts */
+                if (isset($_root_dir[3])) array_shift($_dir_parts);
+            } else {
+                $_new_dir = str_replace('\\', '/', getcwd()).'/';
+            }
+            if($_use_open_basedir = !empty($_open_basedir_ini)) {
+                $_open_basedirs = explode(';', str_replace('\\', '/', $_open_basedir_ini));
+            }
+        }
+        /* all paths use "/" only from here */
+        foreach ($_dir_parts as $_dir_part) {
+            $_new_dir .= $_dir_part;
+            if ($_use_open_basedir) {
+                $_make_new_dir = false;
+                foreach ($_open_basedirs as $_open_basedir) {
+                    if (substr($_new_dir, 0, strlen($_open_basedir)) == $_open_basedir) {
+                        $_make_new_dir = true;
+                        break;
+                    }
+                }
+            } else {
+                $_make_new_dir = true;
+            }
+            if ($_make_new_dir && !file_exists($_new_dir) && !@mkdir($_new_dir, $smarty->_dir_perms) && !is_dir($_new_dir)) {
+                $smarty->trigger_error("problem creating directory '" . $_new_dir . "'");
+                return false;
+            }
+            $_new_dir .= '/';
+        }
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.display_debug_console.php
@@ -0,0 +1,47 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty debug_console function plugin
+ *
+ * Type:     core<br />
+ * Name:     display_debug_console<br />
+ * Purpose:  display the javascript debug console window
+ * @param array Format: null
+ * @param Smarty
+ */
+function smarty_core_display_debug_console($params, &$smarty)
+{
+    if(empty($smarty->debug_tpl)) {
+        $smarty->debug_tpl = SMARTY_DIR . 'debug.tpl';
+        if($smarty->security && is_file($smarty->debug_tpl)) {
+            $smarty->secure_dir[] = realpath($smarty->debug_tpl);
+        }
+        $smarty->debug_tpl = 'file:' . SMARTY_DIR . 'debug.tpl';
+    }
+    $_ldelim_orig = $smarty->left_delimiter;
+    $_rdelim_orig = $smarty->right_delimiter;
+    $smarty->left_delimiter = '{';
+    $smarty->right_delimiter = '}';
+    $_compile_id_orig = $smarty->_compile_id;
+    $smarty->_compile_id = null;
+    $_compile_path = $smarty->_get_compile_path($smarty->debug_tpl);
+    if ($smarty->_compile_resource($smarty->debug_tpl, $_compile_path))
+    {
+        ob_start();
+        $smarty->_include($_compile_path);
+        $_results = ob_get_contents();
+        ob_end_clean();
+    } else {
+        $_results = '';
+    }
+    $smarty->_compile_id = $_compile_id_orig;
+    $smarty->left_delimiter = $_ldelim_orig;
+    $smarty->right_delimiter = $_rdelim_orig;
+    return $_results;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.get_include_path.php
@@ -0,0 +1,35 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Get path to file from include_path
+ *
+ * @param string $file_path
+ * @param string $new_file_path
+ * @return boolean
+ * @staticvar array|null
+ */
+function smarty_core_get_include_path(&$params, &$smarty)
+{
+    static $_path_array = null;
+    if(!isset($_path_array)) {
+        $_ini_include_path = ini_get('include_path');
+        if(strstr($_ini_include_path,';')) {
+            $_path_array = explode(';',$_ini_include_path);
+        } else {
+            $_path_array = explode(':',$_ini_include_path);
+        }
+    }
+    foreach ($_path_array as $_include_path) {
+        if (@is_readable($_include_path . DIRECTORY_SEPARATOR . $params['file_path'])) {
+               $params['new_file_path'] = $_include_path . DIRECTORY_SEPARATOR . $params['file_path'];
+            return true;
+        }
+    }
+    return false;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.get_microtime.php
@@ -0,0 +1,19 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Get seconds and microseconds
+ * @return double
+ */
+function smarty_core_get_microtime($params, &$smarty)
+{
+    $mtime = microtime();
+    $mtime = explode(" ", $mtime);
+    $mtime = (double)($mtime[1]) + (double)($mtime[0]);
+    return ($mtime);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.get_php_resource.php
@@ -0,0 +1,69 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Retrieves PHP script resource
+ *
+ * sets $php_resource to the returned resource
+ * @param string $resource
+ * @param string $resource_type
+ * @param  $php_resource
+ * @return boolean
+ */
+function smarty_core_get_php_resource(&$params, &$smarty)
+{
+    $params['resource_base_path'] = $smarty->trusted_dir;
+    $smarty->_parse_resource_name($params, $smarty);
+    /*
+     * Find out if the resource exists.
+     */
+    if ($params['resource_type'] == 'file') {
+        $_readable = false;
+        if(file_exists($params['resource_name']) && is_readable($params['resource_name'])) {
+            $_readable = true;
+        } else {
+            $_params = array('file_path' => $params['resource_name']);
+            require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
+            if(smarty_core_get_include_path($_params, $smarty)) {
+                $_include_path = $_params['new_file_path'];
+                $_readable = true;
+            }
+        }
+    } else if ($params['resource_type'] != 'file') {
+        $_template_source = null;
+        $_readable = is_callable($smarty->_plugins['resource'][$params['resource_type']][0][0])
+            && call_user_func_array($smarty->_plugins['resource'][$params['resource_type']][0][0],
+                                    array($params['resource_name'], &$_template_source, &$smarty));
+    }
+    /*
+     * Set the error function, depending on which class calls us.
+     */
+    if (method_exists($smarty, '_syntax_error')) {
+        $_error_funcc = '_syntax_error';
+    } else {
+        $_error_funcc = 'trigger_error';
+    }
+    if ($_readable) {
+        if ($smarty->security) {
+            require_once(SMARTY_CORE_DIR . 'core.is_trusted.php');
+            if (!smarty_core_is_trusted($params, $smarty)) {
+                $smarty->$_error_funcc('(secure mode) ' . $params['resource_type'] . ':' . $params['resource_name'] . ' is not trusted');
+                return false;
+            }
+        }
+    } else {
+        $smarty->$_error_funcc($params['resource_type'] . ':' . $params['resource_name'] . ' is not readable');
+        return false;
+    }
+    if ($params['resource_type'] == 'file') {
+        $params['php_resource'] = $params['resource_name'];
+    } else {
+        $params['php_resource'] = $_template_source;
+    }
+    return true;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.is_secure.php
@@ -0,0 +1,50 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * determines if a resource is secure or not.
+ *
+ * @param string $resource_type
+ * @param string $resource_name
+ * @return boolean
+ */
+function smarty_core_is_secure($params, &$smarty)
+{
+    if (!$smarty->security || $smarty->security_settings['INCLUDE_ANY']) {
+        return true;
+    }
+    if ($params['resource_type'] == 'file') {
+        $_rp = realpath($params['resource_name']);
+        if (isset($params['resource_base_path'])) {
+            foreach ((array)$params['resource_base_path'] as $curr_dir) {
+                if ( ($_cd = realpath($curr_dir)) !== false &&
+                     strncmp($_rp, $_cd, strlen($_cd)) == 0 &&
+                     substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR ) {
+                    return true;
+                }
+            }
+        }
+        if (!empty($smarty->secure_dir)) {
+            foreach ((array)$smarty->secure_dir as $curr_dir) {
+                if ( ($_cd = realpath($curr_dir)) !== false) {
+                    if($_cd == $_rp) {
+                        return true;
+                    } elseif (strncmp($_rp, $_cd, strlen($_cd)) == 0 &&
+                        substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR) {
+                        return true;
+                    }
+                }
+            }
+        }
+    } else {
+        return call_user_func_array(
+            $smarty->_plugins['resource'][$params['resource_type']][0][2],
+            array($params['resource_name'], &$smarty));
+    }
+    return false;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.is_trusted.php
@@ -0,0 +1,38 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * determines if a resource is trusted or not
+ *
+ * @param string $resource_type
+ * @param string $resource_name
+ * @return boolean
+ */
+function smarty_core_is_trusted($params, &$smarty)
+{
+    $_smarty_trusted = false;
+    if ($params['resource_type'] == 'file') {
+        if (!empty($smarty->trusted_dir)) {
+            $_rp = realpath($params['resource_name']);
+            foreach ((array)$smarty->trusted_dir as $curr_dir) {
+                if (!empty($curr_dir) && is_readable ($curr_dir)) {
+                    $_cd = realpath($curr_dir);
+                    if (strncmp($_rp, $_cd, strlen($_cd)) == 0
+                        && substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR ) {
+                        $_smarty_trusted = true;
+                        break;
+                    }
+                }
+            }
+        }
+    } else {
+        $_smarty_trusted = call_user_func_array($smarty->_plugins['resource'][$params['resource_type']][0][3],
+                                                array($params['resource_name'], $smarty));
+    }
+    return $_smarty_trusted;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.load_plugins.php
@@ -0,0 +1,110 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Load requested plugins
+ *
+ * @param array $plugins
+ */
+function smarty_core_load_plugins($params, &$smarty)
+{
+    foreach ($params['plugins'] as $_plugin_info) {
+        list($_type, $_name, $_tpl_file, $_tpl_line, $_delayed_loading) = $_plugin_info;
+        $_plugin = &$smarty->_plugins[$_type][$_name];
+        /*
+         * We do not load plugin more than once for each instance of Smarty.
+         * The following code checks for that. The plugin can also be
+         * registered dynamically at runtime, in which case template file
+         * and line number will be unknown, so we fill them in.
+         *
+         * The final element of the info array is a flag that indicates
+         * whether the dynamically registered plugin function has been
+         * checked for existence yet or not.
+         */
+        if (isset($_plugin)) {
+            if (empty($_plugin[3])) {
+                if (!is_callable($_plugin[0])) {
+                    $smarty->_trigger_fatal_error("[plugin] $_type '$_name' is not implemented", $_tpl_file, $_tpl_line, __FILE__, __LINE__);
+                } else {
+                    $_plugin[1] = $_tpl_file;
+                    $_plugin[2] = $_tpl_line;
+                    $_plugin[3] = true;
+                    if (!isset($_plugin[4])) $_plugin[4] = true; /* cacheable */
+                }
+            }
+            continue;
+        } else if ($_type == 'insert') {
+            /*
+             * For backwards compatibility, we check for insert functions in
+             * the symbol table before trying to load them as a plugin.
+             */
+            $_plugin_func = 'insert_' . $_name;
+            if (function_exists($_plugin_func)) {
+                $_plugin = array($_plugin_func, $_tpl_file, $_tpl_line, true, false);
+                continue;
+            }
+        }
+        $_plugin_file = $smarty->_get_plugin_filepath($_type, $_name);
+        if (! $_found = ($_plugin_file != false)) {
+            $_message = "could not load plugin file '$_type.$_name.php'\n";
+        }
+        /*
+         * If plugin file is found, it -must- provide the properly named
+         * plugin function. In case it doesn't, simply output the error and
+         * do not fall back on any other method.
+         */
+        if ($_found) {
+            include_once $_plugin_file;
+            $_plugin_func = 'smarty_' . $_type . '_' . $_name;
+            if (!function_exists($_plugin_func)) {
+                $smarty->_trigger_fatal_error("[plugin] function $_plugin_func() not found in $_plugin_file", $_tpl_file, $_tpl_line, __FILE__, __LINE__);
+                continue;
+            }
+        }
+        /*
+         * In case of insert plugins, their code may be loaded later via
+         * 'script' attribute.
+         */
+        else if ($_type == 'insert' && $_delayed_loading) {
+            $_plugin_func = 'smarty_' . $_type . '_' . $_name;
+            $_found = true;
+        }
+        /*
+         * Plugin specific processing and error checking.
+         */
+        if (!$_found) {
+            if ($_type == 'modifier') {
+                /*
+                 * In case modifier falls back on using PHP functions
+                 * directly, we only allow those specified in the security
+                 * context.
+                 */
+                if ($smarty->security && !in_array($_name, $smarty->security_settings['MODIFIER_FUNCS'])) {
+                    $_message = "(secure mode) modifier '$_name' is not allowed";
+                } else {
+                    if (!function_exists($_name)) {
+                        $_message = "modifier '$_name' is not implemented";
+                    } else {
+                        $_plugin_func = $_name;
+                        $_found = true;
+                    }
+                }
+            } else if ($_type == 'function') {
+                /*
+                 * This is a catch-all situation.
+                 */
+                $_message = "unknown tag - '$_name'";
+            }
+        }
+        if ($_found) {
+            $smarty->_plugins[$_type][$_name] = array($_plugin_func, $_tpl_file, $_tpl_line, true, true);
+        } else {
+            $smarty->_trigger_fatal_error('[plugin] ' . $_message, $_tpl_file, $_tpl_line, __FILE__, __LINE__);
+        }
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.load_resource_plugin.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * load a resource plugin
+ *
+ * @param string $type
+ */
+function smarty_core_load_resource_plugin($params, &$smarty)
+{
+    /*
+     * Resource plugins are not quite like the other ones, so they are
+     * handled differently. The first element of plugin info is the array of
+     * functions provided by the plugin, the second one indicates whether
+     * all of them exist or not.
+     */
+    $_plugin = &$smarty->_plugins['resource'][$params['type']];
+    if (isset($_plugin)) {
+        if (!$_plugin[1] && count($_plugin[0])) {
+            $_plugin[1] = true;
+            foreach ($_plugin[0] as $_plugin_func) {
+                if (!is_callable($_plugin_func)) {
+                    $_plugin[1] = false;
+                    break;
+                }
+            }
+        }
+        if (!$_plugin[1]) {
+            $smarty->_trigger_fatal_error("[plugin] resource '" . $params['type'] . "' is not implemented", null, null, __FILE__, __LINE__);
+        }
+        return;
+    }
+    $_plugin_file = $smarty->_get_plugin_filepath('resource', $params['type']);
+    $_found = ($_plugin_file != false);
+    if ($_found) {            /*
+         * If the plugin file is found, it -must- provide the properly named
+         * plugin functions.
+         */
+        include_once($_plugin_file);
+        /*
+         * Locate functions that we require the plugin to provide.
+         */
+        $_resource_ops = array('source', 'timestamp', 'secure', 'trusted');
+        $_resource_funcs = array();
+        foreach ($_resource_ops as $_op) {
+            $_plugin_func = 'smarty_resource_' . $params['type'] . '_' . $_op;
+            if (!function_exists($_plugin_func)) {
+                $smarty->_trigger_fatal_error("[plugin] function $_plugin_func() not found in $_plugin_file", null, null, __FILE__, __LINE__);
+                return;
+            } else {
+                $_resource_funcs[] = $_plugin_func;
+            }
+        }
+        $smarty->_plugins['resource'][$params['type']] = array($_resource_funcs, true);
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.process_cached_inserts.php
@@ -0,0 +1,60 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Replace cached inserts with the actual results
+ *
+ * @param string $results
+ * @return string
+ */
+function smarty_core_process_cached_inserts($params, &$smarty)
+{
+    preg_match_all('!'.$smarty->_smarty_md5.'{insert_cache (.*)}'.$smarty->_smarty_md5.'!Uis',
+                   $params['results'], $match);
+    list($cached_inserts, $insert_args) = $match;
+    for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
+        if ($smarty->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $debug_start_time = smarty_core_get_microtime($_params, $smarty);
+        }
+        $args = unserialize($insert_args[$i]);
+        $name = $args['name'];
+        if (isset($args['script'])) {
+            $_params = array('resource_name' => $smarty->_dequote($args['script']));
+            require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
+            if(!smarty_core_get_php_resource($_params, $smarty)) {
+                return false;
+            }
+            $resource_type = $_params['resource_type'];
+            $php_resource = $_params['php_resource'];
+            if ($resource_type == 'file') {
+                $smarty->_include($php_resource, true);
+            } else {
+                $smarty->_eval($php_resource);
+            }
+        }
+        $function_name = $smarty->_plugins['insert'][$name][0];
+        if (empty($args['assign'])) {
+            $replace = $function_name($args, $smarty);
+        } else {
+            $smarty->assign($args['assign'], $function_name($args, $smarty));
+            $replace = '';
+        }
+        $params['results'] = substr_replace($params['results'], $replace, strpos($params['results'], $cached_inserts[$i]), strlen($cached_inserts[$i]));
+        if ($smarty->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $smarty->_smarty_debug_info[] = array('type'      => 'insert',
+                                                'filename'  => 'insert_'.$name,
+                                                'depth'     => $smarty->_inclusion_depth,
+                                                'exec_time' => smarty_core_get_microtime($_params, $smarty) - $debug_start_time);
+        }
+    }
+    return $params['results'];
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.process_compiled_include.php
@@ -0,0 +1,31 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Replace nocache-tags by results of the corresponding non-cacheable
+ * functions and return it
+ *
+ * @param string $compiled_tpl
+ * @param string $cached_source
+ * @return string
+ */
+function smarty_core_process_compiled_include($params, &$smarty)
+{
+    $_cache_including = $smarty->_cache_including;
+    $smarty->_cache_including = true;
+    $_return = $params['results'];
+    foreach ($smarty->_cache_info['cache_serials'] as $_include_file_path=>$_cache_serial) {
+        $smarty->_include($_include_file_path, true);
+    }
+    foreach ($smarty->_cache_serials as $_include_file_path=>$_cache_serial) {
+        $_return = preg_replace_callback('!(\{nocache\:('.$_cache_serial.')#(\d+)\})!s',
+                                         array(&$smarty, '_process_compiled_include_callback'),
+                                         $_return);
+    }
+    $smarty->_cache_including = $_cache_including;
+    return $_return;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.read_cache_file.php
@@ -0,0 +1,75 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * read a cache file, determine if it needs to be
+ * regenerated or not
+ *
+ * @param string $tpl_file
+ * @param string $cache_id
+ * @param string $compile_id
+ * @param string $results
+ * @return boolean
+ */
+function smarty_core_read_cache_file(&$params, &$smarty)
+{
+    static  $content_cache = array();
+    if ($smarty->force_compile) {
+        return false;
+    }
+    if (isset($content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']])) {
+        list($params['results'], $smarty->_cache_info) = $content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']];
+        return true;
+    }
+    if (!empty($smarty->cache_handler_func)) {
+        call_user_func_array($smarty->cache_handler_func,
+                             array('read', &$smarty, &$params['results'], $params['tpl_file'], $params['cache_id'], $params['compile_id'], null));
+    } else {
+        $_auto_id = $smarty->_get_auto_id($params['cache_id'], $params['compile_id']);
+        $_cache_file = $smarty->_get_auto_filename($smarty->cache_dir, $params['tpl_file'], $_auto_id);
+        $params['results'] = $smarty->_read_file($_cache_file);
+    }
+    if (empty($params['results'])) {
+        return false;
+    }
+    $_contents = $params['results'];
+    $_info_start = strpos($_contents, "\n") + 1;
+    $_info_len = (int)substr($_contents, 0, $_info_start - 1);
+    $_cache_info = unserialize(substr($_contents, $_info_start, $_info_len));
+    $params['results'] = substr($_contents, $_info_start + $_info_len);
+    if ($smarty->caching == 2 && isset ($_cache_info['expires'])){
+        if ($_cache_info['expires'] > -1 && (time() > $_cache_info['expires'])) {
+            return false;
+        }
+    } else {
+        if ($smarty->cache_lifetime > -1 && (time() - $_cache_info['timestamp'] > $smarty->cache_lifetime)) {
+            return false;
+        }
+    }
+    if ($smarty->compile_check) {
+        $_params = array('get_source' => false, 'quiet'=>true);
+        foreach (array_keys($_cache_info['template']) as $_template_dep) {
+            $_params['resource_name'] = $_template_dep;
+            if (!$smarty->_fetch_resource_info($_params) || $_cache_info['timestamp'] < $_params['resource_timestamp']) {
+                return false;
+            }
+        }
+        if (isset($_cache_info['config'])) {
+            $_params = array('resource_base_path' => $smarty->config_dir, 'get_source' => false, 'quiet'=>true);
+            foreach (array_keys($_cache_info['config']) as $_config_dep) {
+                $_params['resource_name'] = $_config_dep;
+                if (!$smarty->_fetch_resource_info($_params) || $_cache_info['timestamp'] < $_params['resource_timestamp']) {
+                    return false;
+                }
+            }
+        }
+    }
+    $content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']] = array($params['results'], $_cache_info);
+    $smarty->_cache_info = $_cache_info;
+    return true;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.rm_auto.php
@@ -0,0 +1,61 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * delete an automagically created file by name and id
+ *
+ * @param string $auto_base
+ * @param string $auto_source
+ * @param string $auto_id
+ * @param integer $exp_time
+ * @return boolean
+ */
+function smarty_core_rm_auto($params, &$smarty)
+{
+    if (!@is_dir($params['auto_base']))
+      return false;
+    if(!isset($params['auto_id']) && !isset($params['auto_source'])) {
+        $_params = array(
+            'dirname' => $params['auto_base'],
+            'level' => 0,
+            'exp_time' => $params['exp_time']
+        );
+        require_once(SMARTY_CORE_DIR . 'core.rmdir.php');
+        $_res = smarty_core_rmdir($_params, $smarty);
+    } else {
+        $_tname = $smarty->_get_auto_filename($params['auto_base'], $params['auto_source'], $params['auto_id']);
+        if(isset($params['auto_source'])) {
+            if (isset($params['extensions'])) {
+                $_res = false;
+                foreach ((array)$params['extensions'] as $_extension)
+                    $_res |= $smarty->_unlink($_tname.$_extension, $params['exp_time']);
+            } else {
+                $_res = $smarty->_unlink($_tname, $params['exp_time']);
+            }
+        } elseif ($smarty->use_sub_dirs) {
+            $_params = array(
+                'dirname' => $_tname,
+                'level' => 1,
+                'exp_time' => $params['exp_time']
+            );
+            require_once(SMARTY_CORE_DIR . 'core.rmdir.php');
+            $_res = smarty_core_rmdir($_params, $smarty);
+        } else {
+            $_handle = opendir($params['auto_base']);
+            $_res = true;
+            while (false !== ($_filename = readdir($_handle))) {
+                if($_filename == '.' || $_filename == '..') {
+                    continue;
+                } elseif (substr($params['auto_base'] . DIRECTORY_SEPARATOR . $_filename, 0, strlen($_tname)) == $_tname) {
+                    $_res &= (bool)$smarty->_unlink($params['auto_base'] . DIRECTORY_SEPARATOR . $_filename, $params['exp_time']);
+                }
+            }
+        }
+    }
+    return $_res;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.rmdir.php
@@ -0,0 +1,44 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * delete a dir recursively (level=0 -> keep root)
+ * WARNING: no tests, it will try to remove what you tell it!
+ *
+ * @param string $dirname
+ * @param integer $level
+ * @param integer $exp_time
+ * @return boolean
+ */
+function smarty_core_rmdir($params, &$smarty)
+{
+   if(!isset($params['level'])) { $params['level'] = 1; }
+   if(!isset($params['exp_time'])) { $params['exp_time'] = null; }
+   if($_handle = @opendir($params['dirname'])) {
+        while (false !== ($_entry = readdir($_handle))) {
+            if ($_entry != '.' && $_entry != '..') {
+                if (@is_dir($params['dirname'] . DIRECTORY_SEPARATOR . $_entry)) {
+                    $_params = array(
+                        'dirname' => $params['dirname'] . DIRECTORY_SEPARATOR . $_entry,
+                        'level' => $params['level'] + 1,
+                        'exp_time' => $params['exp_time']
+                    );
+                    smarty_core_rmdir($_params, $smarty);
+                }
+                else {
+                    $smarty->_unlink($params['dirname'] . DIRECTORY_SEPARATOR . $_entry, $params['exp_time']);
+                }
+            }
+        }
+        closedir($_handle);
+   }
+   if ($params['level']) {
+       return @rmdir($params['dirname']);
+   }
+   return (bool)$_handle;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.run_insert_handler.php
@@ -0,0 +1,63 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Handle insert tags
+ *
+ * @param array $args
+ * @return string
+ */
+function smarty_core_run_insert_handler($params, &$smarty)
+{
+    require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+    if ($smarty->debugging) {
+        $_params = array();
+        $_debug_start_time = smarty_core_get_microtime($_params, $smarty);
+    }
+    if ($smarty->caching) {
+        $_arg_string = serialize($params['args']);
+        $_name = $params['args']['name'];
+        if (!isset($smarty->_cache_info['insert_tags'][$_name])) {
+            $smarty->_cache_info['insert_tags'][$_name] = array('insert',
+                                                             $_name,
+                                                             $smarty->_plugins['insert'][$_name][1],
+                                                             $smarty->_plugins['insert'][$_name][2],
+                                                             !empty($params['args']['script']) ? true : false);
+        }
+        return $smarty->_smarty_md5."{insert_cache $_arg_string}".$smarty->_smarty_md5;
+    } else {
+        if (isset($params['args']['script'])) {
+            $_params = array('resource_name' => $smarty->_dequote($params['args']['script']));
+            require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
+            if(!smarty_core_get_php_resource($_params, $smarty)) {
+                return false;
+            }
+            if ($_params['resource_type'] == 'file') {
+                $smarty->_include($_params['php_resource'], true);
+            } else {
+                $smarty->_eval($_params['php_resource']);
+            }
+            unset($params['args']['script']);
+        }
+        $_funcname = $smarty->_plugins['insert'][$params['args']['name']][0];
+        $_content = $_funcname($params['args'], $smarty);
+        if ($smarty->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $smarty->_smarty_debug_info[] = array('type'      => 'insert',
+                                                'filename'  => 'insert_'.$params['args']['name'],
+                                                'depth'     => $smarty->_inclusion_depth,
+                                                'exec_time' => smarty_core_get_microtime($_params, $smarty) - $_debug_start_time);
+        }
+        if (!empty($params['args']["assign"])) {
+            $smarty->assign($params['args']["assign"], $_content);
+        } else {
+            return $_content;
+        }
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.smarty_include_php.php
@@ -0,0 +1,42 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * called for included php files within templates
+ *
+ * @param string $smarty_file
+ * @param string $smarty_assign variable to assign the included template's
+ *               output into
+ * @param boolean $smarty_once uses include_once if this is true
+ * @param array $smarty_include_vars associative array of vars from
+ *              {include file="blah" var=$var}
+ */
+function smarty_core_smarty_include_php($params, &$smarty)
+{
+    $_params = array('resource_name' => $params['smarty_file']);
+    require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
+    smarty_core_get_php_resource($_params, $smarty);
+    $_smarty_resource_type = $_params['resource_type'];
+    $_smarty_php_resource = $_params['php_resource'];
+    if (!empty($params['smarty_assign'])) {
+        ob_start();
+        if ($_smarty_resource_type == 'file') {
+            $smarty->_include($_smarty_php_resource, $params['smarty_once'], $params['smarty_include_vars']);
+        } else {
+            $smarty->_eval($_smarty_php_resource, $params['smarty_include_vars']);
+        }
+        $smarty->assign($params['smarty_assign'], ob_get_contents());
+        ob_end_clean();
+    } else {
+        if ($_smarty_resource_type == 'file') {
+            $smarty->_include($_smarty_php_resource, $params['smarty_once'], $params['smarty_include_vars']);
+        } else {
+            $smarty->_eval($_smarty_php_resource, $params['smarty_include_vars']);
+        }
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.write_cache_file.php
@@ -0,0 +1,69 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Prepend the cache information to the cache file
+ * and write it
+ *
+ * @param string $tpl_file
+ * @param string $cache_id
+ * @param string $compile_id
+ * @param string $results
+ * @return true|null
+ */
+function smarty_core_write_cache_file($params, &$smarty)
+{
+    $smarty->_cache_info['timestamp'] = time();
+    if ($smarty->cache_lifetime > -1){
+        $smarty->_cache_info['expires'] = $smarty->_cache_info['timestamp'] + $smarty->cache_lifetime;
+    } else {
+        $smarty->_cache_info['expires'] = -1;
+    }
+    if (preg_match_all('!\{(/?)nocache\:[0-9a-f]{32}#\d+\}!', $params['results'], $match, PREG_PATTERN_ORDER)) {
+        $match_count = count($match[0]);
+        $results = preg_split('!(\{/?nocache\:[0-9a-f]{32}#\d+\})!', $params['results'], -1, preg_split_DELIM_CAPTURE);
+        $level = 0;
+        $j = 0;
+        for ($i=0, $results_count = count($results); $i < $results_count && $j < $match_count; $i++) {
+            if ($results[$i] == $match[0][$j]) {
+                if ($match[1][$j]) { // closing tag
+                    $level--;
+                    unset($results[$i]);
+                } else { // opening tag
+                    if ($level++ > 0) unset($results[$i]);
+                }
+                $j++;
+            } elseif ($level > 0) {
+                unset($results[$i]);
+            }
+        }
+        $params['results'] = implode('', $results);
+    }
+    $smarty->_cache_info['cache_serials'] = $smarty->_cache_serials;
+    $_cache_info = serialize($smarty->_cache_info);
+    $params['results'] = strlen($_cache_info) . "\n" . $_cache_info . $params['results'];
+    if (!empty($smarty->cache_handler_func)) {
+        call_user_func_array($smarty->cache_handler_func,
+                             array('write', &$smarty, &$params['results'], $params['tpl_file'], $params['cache_id'], $params['compile_id'], null));
+    } else {
+        if(!@is_writable($smarty->cache_dir)) {
+            if(!@is_dir($smarty->cache_dir)) {
+                $smarty->trigger_error('the $cache_dir \'' . $smarty->cache_dir . '\' does not exist, or is not a directory.', E_USER_ERROR);
+                return false;
+            }
+            $smarty->trigger_error('unable to write to $cache_dir \'' . realpath($smarty->cache_dir) . '\'. Be sure $cache_dir is writable by the web server user.', E_USER_ERROR);
+            return false;
+        }
+        $_auto_id = $smarty->_get_auto_id($params['cache_id'], $params['compile_id']);
+        $_cache_file = $smarty->_get_auto_filename($smarty->cache_dir, $params['tpl_file'], $_auto_id);
+        $_params = array('filename' => $_cache_file, 'contents' => $params['results'], 'create_dirs' => true);
+        require_once(SMARTY_CORE_DIR . 'core.write_file.php');
+        smarty_core_write_file($_params, $smarty);
+        return true;
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.write_compiled_include.php
@@ -0,0 +1,72 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Extract non-cacheable parts out of compiled template and write it
+ *
+ * @param string $compile_path
+ * @param string $template_compiled
+ * @return boolean
+ */
+function smarty_core_write_compiled_include($params, &$smarty)
+{
+    $_tag_start = 'if \(\$this->caching && \!\$this->_cache_including\)\: echo \'\{nocache\:('.$params['cache_serial'].')#(\d+)\}\'; endif;';
+    $_tag_end   = 'if \(\$this->caching && \!\$this->_cache_including\)\: echo \'\{/nocache\:(\\2)#(\\3)\}\'; endif;';
+    preg_match_all('!('.$_tag_start.'(.*)'.$_tag_end.')!Us',
+                   $params['compiled_content'], $_match_source, PREG_SET_ORDER);
+    if (count($_match_source)==0) return;
+    $_include_compiled =  "<?php /* Smarty version ".$smarty->_version.", created on ".strftime("%Y-%m-%d %H:%M:%S")."\n";
+    $_include_compiled .= "         compiled from " . strtr(urlencode($params['resource_name']), array('%2F'=>'/', '%3A'=>':')) . " */\n\n";
+    $_compile_path = $params['include_file_path'];
+    $smarty->_cache_serials[$_compile_path] = $params['cache_serial'];
+    $_include_compiled .= "\$this->_cache_serials['".$_compile_path."'] = '".$params['cache_serial']."';\n\n?>";
+    $_include_compiled .= $params['plugins_code'];
+    $_include_compiled .= "<?php";
+    $this_varname = ((double)phpversion() >= 5.0) ? '_smarty' : 'this';
+    for ($_i = 0, $_for_max = count($_match_source); $_i < $_for_max; $_i++) {
+        $_match =& $_match_source[$_i];
+        $source = $_match[4];
+        if ($this_varname == '_smarty') {
+            /* rename $this to $_smarty in the sourcecode */
+            $tokens = token_get_all('<?php ' . $_match[4]);
+            /* remove trailing <?php */
+            $open_tag = '';
+            while ($tokens) {
+                $token = array_shift($tokens);
+                if (is_array($token)) {
+                    $open_tag .= $token[1];
+                } else {
+                    $open_tag .= $token;
+                }
+                if ($open_tag == '<?php ') break;
+            }
+            for ($i=0, $count = count($tokens); $i < $count; $i++) {
+                if (is_array($tokens[$i])) {
+                    if ($tokens[$i][0] == T_VARIABLE && $tokens[$i][1] == '$this') {
+                        $tokens[$i] = '$' . $this_varname;
+                    } else {
+                        $tokens[$i] = $tokens[$i][1];
+                    }                   
+                }
+            }
+            $source = implode('', $tokens);
+        }
+        /* add function to compiled include */
+        $_include_compiled .= "
+function _smarty_tplfunc_$_match[2]_$_match[3](&\$$this_varname)
+{
+$source
+}
+";
+    }
+    $_include_compiled .= "\n\n?>\n";
+    $_params = array('filename' => $_compile_path,
+                     'contents' => $_include_compiled, 'create_dirs' => true);
+    require_once(SMARTY_CORE_DIR . 'core.write_file.php');
+    smarty_core_write_file($_params, $smarty);
+    return true;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.write_compiled_resource.php
@@ -0,0 +1,30 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * write the compiled resource
+ *
+ * @param string $compile_path
+ * @param string $compiled_content
+ * @return true
+ */
+function smarty_core_write_compiled_resource($params, &$smarty)
+{
+    if(!@is_writable($smarty->compile_dir)) {
+        if(!@is_dir($smarty->compile_dir)) {
+            $smarty->trigger_error('the $compile_dir \'' . $smarty->compile_dir . '\' does not exist, or is not a directory.', E_USER_ERROR);
+            return false;
+        }
+        $smarty->trigger_error('unable to write to $compile_dir \'' . realpath($smarty->compile_dir) . '\'. Be sure $compile_dir is writable by the web server user.', E_USER_ERROR);
+        return false;
+    }
+    $_params = array('filename' => $params['compile_path'], 'contents' => $params['compiled_content'], 'create_dirs' => true);
+    require_once(SMARTY_CORE_DIR . 'core.write_file.php');
+    smarty_core_write_file($_params, $smarty);
+    return true;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/internals/core.write_file.php
@@ -0,0 +1,41 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * write out a file to disk
+ *
+ * @param string $filename
+ * @param string $contents
+ * @param boolean $create_dirs
+ * @return boolean
+ */
+function smarty_core_write_file($params, &$smarty)
+{
+    $_dirname = dirname($params['filename']);
+    if ($params['create_dirs']) {
+        $_params = array('dir' => $_dirname);
+        require_once(SMARTY_CORE_DIR . 'core.create_dir_structure.php');
+        smarty_core_create_dir_structure($_params, $smarty);
+    }
+    $_tmp_file = tempnam($_dirname, 'wrt');
+    if (!($fd = @fopen($_tmp_file, 'wb'))) {
+        $_tmp_file = $_dirname . DIRECTORY_SEPARATOR . uniqid('wrt');
+        if (!($fd = @fopen($_tmp_file, 'wb'))) {
+            $smarty->trigger_error("problem writing temporary file '$_tmp_file'");
+            return false;
+        }
+    }
+    fwrite($fd, $params['contents']);
+    fclose($fd);
+    if (DIRECTORY_SEPARATOR == '\\' || !@rename($_tmp_file, $params['filename'])) {
+        @unlink($params['filename']);
+        @rename($_tmp_file, $params['filename']);
+    }
+    @chmod($params['filename'], $smarty->_file_perms);
+    return true;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/block.t.php
@@ -0,0 +1,106 @@
+<?php
+/**
+ * block.t.php - Smarty gettext block plugin
+ *
+ * ------------------------------------------------------------------------- *
+ * This library is free software; you can redistribute it and/or             *
+ * modify it under the terms of the GNU Lesser General Public                *
+ * License as published by the Free Software Foundation; either              *
+ * version 2.1 of the License, or (at your option) any later version.        *
+ *                                                                           *
+ * This library is distributed in the hope that it will be useful,           *
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of            *
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU         *
+ * Lesser General Public License for more details.                           *
+ *                                                                           *
+ * You should have received a copy of the GNU Lesser General Public          *
+ * License along with this library; if not, write to the Free Software       *
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA *
+ * ------------------------------------------------------------------------- *
+ *
+ * Installation: simply copy this file to the smarty plugins directory.
+ *
+ * @package	smarty-gettext
+ * @version	$Id: block.t.php,v 1.1 2005/07/27 17:58:56 sagi Exp $
+ * @link	http://smarty-gettext.sourceforge.net/
+ * @author	Sagi Bashari <sagi@boom.org.il>
+ * @copyright 2004-2005 Sagi Bashari
+ */
+/**
+ * Replaces arguments in a string with their values.
+ * Arguments are represented by % followed by their number.
+ *
+ * @param	string	Source string
+ * @param	mixed	Arguments, can be passed in an array or through single variables.
+ * @returns	string	Modified string
+ */
+function smarty_gettext_strarg($str)
+{
+	$tr = array();
+	$p = 0;
+	for ($i=1; $i < func_num_args(); $i++) {
+		$arg = func_get_arg($i);
+		if (is_array($arg)) {
+			foreach ($arg as $aarg) {
+				$tr['%'.++$p] = $aarg;
+			}
+		} else {
+			$tr['%'.++$p] = $arg;
+		}
+	}
+	return strtr($str, $tr);
+}
+/**
+ * Smarty block function, provides gettext support for smarty.
+ *
+ * The block content is the text that should be translated.
+ *
+ * Any parameter that is sent to the function will be represented as %n in the translation text, 
+ * where n is 1 for the first parameter. The following parameters are reserved:
+ *   - escape - sets escape mode:
+ *       - 'html' for HTML escaping, this is the default.
+ *       - 'js' for javascript escaping.
+ *       - 'url' for url escaping.
+ *       - 'no'/'off'/0 - turns off escaping
+ *   - plural - The plural version of the text (2nd parameter of ngettext())
+ *   - count - The item count for plural mode (3rd parameter of ngettext())
+ */
+function smarty_block_t($params, $text, &$smarty)
+{
+	$text = stripslashes($text);
+	if (isset($params['escape'])) {
+		$escape = $params['escape'];
+		unset($params['escape']);
+	}
+	if (isset($params['plural'])) {
+		$plural = $params['plural'];
+		unset($params['plural']);
+		if (isset($params['count'])) {
+			$count = $params['count'];
+			unset($params['count']);
+		}
+	}
+	if (isset($count) && isset($plural)) {
+		$text = ngettext($text, $plural, $count);
+	} else { // use normal
+		$text = gettext($text);
+	}
+	if (count($params)) {
+		$text = smarty_gettext_strarg($text, $params);
+	}
+	if (!isset($escape) || $escape == 'html') { // html escape, default
+	   $text = nl2br(htmlspecialchars($text));
+   } elseif (isset($escape)) {
+		switch ($escape) {
+			case 'javascript':
+			case 'js':
+				$text = str_replace('\'', '\\\'', stripslashes($text));
+				break;
+			case 'url':
+				$text = urlencode($text);
+				break;
+		}
+	}
+	return $text;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/block.textformat.php
@@ -0,0 +1,85 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {textformat}{/textformat} block plugin
+ *
+ * Type:     block function<br />
+ * Name:     textformat<br />
+ * Purpose:  format text a certain way with preset styles
+ *           or custom wrap/indent settings<br />
+ * @link http://smarty.php.net/manual/en/language.function.textformat.php {textformat}
+ *       (Smarty online manual)
+ * @param array
+ * <pre>
+ * Params:   style: string (email)
+ *           indent: integer (0)
+ *           wrap: integer (80)
+ *           wrap_char string ("\n")
+ *           indent_char: string (" ")
+ *           wrap_boundary: boolean (true)
+ * </pre>
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param string contents of the block
+ * @param Smarty clever simulation of a method
+ * @return string string $content re-formatted
+ */
+function smarty_block_textformat($params, $content, &$smarty)
+{
+    if (is_null($content)) {
+        return;
+    }
+    $style = null;
+    $indent = 0;
+    $indent_first = 0;
+    $indent_char = ' ';
+    $wrap = 80;
+    $wrap_char = "\n";
+    $wrap_cut = false;
+    $assign = null;
+    foreach ($params as $_key => $_val) {
+        switch ($_key) {
+            case 'style':
+            case 'indent_char':
+            case 'wrap_char':
+            case 'assign':
+                $$_key = (string)$_val;
+                break;
+            case 'indent':
+            case 'indent_first':
+            case 'wrap':
+                $$_key = (int)$_val;
+                break;
+            case 'wrap_cut':
+                $$_key = (bool)$_val;
+                break;
+            default:
+                $smarty->trigger_error("textformat: unknown attribute '$_key'");
+        }
+    }
+    if ($style == 'email') {
+        $wrap = 72;
+    }
+    $_paragraphs = preg_split('![\r\n][\r\n]!',$content);
+    $_output = '';
+    for($_x = 0, $_y = count($_paragraphs); $_x < $_y; $_x++) {
+        if ($_paragraphs[$_x] == '') {
+            continue;
+        }
+        $_paragraphs[$_x] = preg_replace(array('!\s+!','!(^\s+)|(\s+$)!'), array(' ',''), $_paragraphs[$_x]);
+        if($indent_first > 0) {
+            $_paragraphs[$_x] = str_repeat($indent_char, $indent_first) . $_paragraphs[$_x];
+        }
+        $_paragraphs[$_x] = wordwrap($_paragraphs[$_x], $wrap - $indent, $wrap_char, $wrap_cut);
+        if($indent > 0) {
+            $_paragraphs[$_x] = preg_replace('!^!m', str_repeat($indent_char, $indent), $_paragraphs[$_x]);
+        }
+    }
+    $_output = implode($wrap_char . $wrap_char, $_paragraphs);
+    return $assign ? $smarty->assign($assign, $_output) : $_output;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/compiler.assign.php
@@ -0,0 +1,34 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {assign} compiler function plugin
+ *
+ * Type:     compiler function<br />
+ * Name:     assign<br />
+ * Purpose:  assign a value to a template variable
+ * @link http://smarty.php.net/manual/en/language.custom.functions.php#LANGUAGE.FUNCTION.ASSIGN {assign}
+ *       (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com> (initial author)
+ * @auther messju mohr <messju at lammfellpuschen dot de> (conversion to compiler function)
+ * @param string containing var-attribute and value-attribute
+ * @param Smarty_Compiler
+ */
+function smarty_compiler_assign($tag_attrs, &$compiler)
+{
+    $_params = $compiler->_parse_attrs($tag_attrs);
+    if (!isset($_params['var'])) {
+        $compiler->_syntax_error("assign: missing 'var' parameter", E_USER_WARNING);
+        return;
+    }
+    if (!isset($_params['value'])) {
+        $compiler->_syntax_error("assign: missing 'value' parameter", E_USER_WARNING);
+        return;
+    }
+    return "\$this->assign({$_params['var']}, {$_params['value']});";
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.assign_debug_info.php
@@ -0,0 +1,34 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {assign_debug_info} function plugin
+ *
+ * Type:     function<br />
+ * Name:     assign_debug_info<br />
+ * Purpose:  assign debug info to the template<br />
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param array unused in this plugin, this plugin uses {@link Smarty::$_config},
+ *              {@link Smarty::$_tpl_vars} and {@link Smarty::$_smarty_debug_info}
+ * @param Smarty
+ */
+function smarty_function_assign_debug_info($params, &$smarty)
+{
+    $assigned_vars = $smarty->_tpl_vars;
+    ksort($assigned_vars);
+    if (@is_array($smarty->_config[0])) {
+        $config_vars = $smarty->_config[0];
+        ksort($config_vars);
+        $smarty->assign("_debug_config_keys", array_keys($config_vars));
+        $smarty->assign("_debug_config_vals", array_values($config_vars));
+    }
+    $included_templates = $smarty->_smarty_debug_info;
+    $smarty->assign("_debug_keys", array_keys($assigned_vars));
+    $smarty->assign("_debug_vals", array_values($assigned_vars));
+    $smarty->assign("_debug_tpls", $included_templates);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.config_load.php
@@ -0,0 +1,126 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {config_load} function plugin
+ *
+ * Type:     function<br />
+ * Name:     config_load<br />
+ * Purpose:  load config file vars
+ * @link http://smarty.php.net/manual/en/language.function.config.load.php {config_load}
+ *       (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @author messju mohr <messju at lammfellpuschen dot de> (added use of resources)
+ * @param array Format:
+ * <pre>
+ * array('file' => required config file name,
+ *       'section' => optional config file section to load
+ *       'scope' => local/parent/global
+ *       'global' => overrides scope, setting to parent if true)
+ * </pre>
+ * @param Smarty
+ */
+function smarty_function_config_load($params, &$smarty)
+{
+        if ($smarty->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $_debug_start_time = smarty_core_get_microtime($_params, $smarty);
+        }
+        $_file = isset($params['file']) ? $smarty->_dequote($params['file']) : null;
+        $_section = isset($params['section']) ? $smarty->_dequote($params['section']) : null;
+        $_scope = isset($params['scope']) ? $smarty->_dequote($params['scope']) : 'global';
+        $_global = isset($params['global']) ? $smarty->_dequote($params['global']) : false;
+        if (!isset($_file) || strlen($_file) == 0) {
+            $smarty->trigger_error("missing 'file' attribute in config_load tag", E_USER_ERROR, __FILE__, __LINE__);
+        }
+        if (isset($_scope)) {
+            if ($_scope != 'local' &&
+                $_scope != 'parent' &&
+                $_scope != 'global') {
+                $smarty->trigger_error("invalid 'scope' attribute value", E_USER_ERROR, __FILE__, __LINE__);
+            }
+        } else {
+            if ($_global) {
+                $_scope = 'parent';
+            } else {
+                $_scope = 'local';
+            }
+        }
+        $_params = array('resource_name' => $_file,
+                         'resource_base_path' => $smarty->config_dir,
+                         'get_source' => false);
+        $smarty->_parse_resource_name($_params);
+        $_file_path = $_params['resource_type'] . ':' . $_params['resource_name'];
+        if (isset($_section))
+            $_compile_file = $smarty->_get_compile_path($_file_path.'|'.$_section);
+        else
+            $_compile_file = $smarty->_get_compile_path($_file_path);
+        if($smarty->force_compile || !file_exists($_compile_file)) {
+            $_compile = true;
+        } elseif ($smarty->compile_check) {
+            $_params = array('resource_name' => $_file,
+                             'resource_base_path' => $smarty->config_dir,
+                             'get_source' => false);
+            $_compile = $smarty->_fetch_resource_info($_params) &&
+                $_params['resource_timestamp'] > filemtime($_compile_file);
+        } else {
+            $_compile = false;
+        }
+        if($_compile) {
+            if(!is_object($smarty->_conf_obj)) {
+                require_once SMARTY_DIR . $smarty->config_class . '.class.php';
+                $smarty->_conf_obj = new $smarty->config_class();
+                $smarty->_conf_obj->overwrite = $smarty->config_overwrite;
+                $smarty->_conf_obj->booleanize = $smarty->config_booleanize;
+                $smarty->_conf_obj->read_hidden = $smarty->config_read_hidden;
+                $smarty->_conf_obj->fix_newlines = $smarty->config_fix_newlines;
+            }
+            $_params = array('resource_name' => $_file,
+                             'resource_base_path' => $smarty->config_dir,
+                             $_params['get_source'] = true);
+            if (!$smarty->_fetch_resource_info($_params)) {
+                return;
+            }
+            $smarty->_conf_obj->set_file_contents($_file, $_params['source_content']);
+            $_config_vars = array_merge($smarty->_conf_obj->get($_file),
+                    $smarty->_conf_obj->get($_file, $_section));
+            if(function_exists('var_export')) {
+                $_output = '<?php $_config_vars = ' . var_export($_config_vars, true) . '; ?>';
+            } else {
+                $_output = '<?php $_config_vars = unserialize(\'' . strtr(serialize($_config_vars),array('\''=>'\\\'', '\\'=>'\\\\')) . '\'); ?>';
+            }
+            $_params = (array('compile_path' => $_compile_file, 'compiled_content' => $_output, 'resource_timestamp' => $_params['resource_timestamp']));
+            require_once(SMARTY_CORE_DIR . 'core.write_compiled_resource.php');
+            smarty_core_write_compiled_resource($_params, $smarty);
+        } else {
+            include($_compile_file);
+        }
+        if ($smarty->caching) {
+            $smarty->_cache_info['config'][$_file] = true;
+        }
+        $smarty->_config[0]['vars'] = @array_merge($smarty->_config[0]['vars'], $_config_vars);
+        $smarty->_config[0]['files'][$_file] = true;
+        if ($_scope == 'parent') {
+                $smarty->_config[1]['vars'] = @array_merge($smarty->_config[1]['vars'], $_config_vars);
+                $smarty->_config[1]['files'][$_file] = true;
+        } else if ($_scope == 'global') {
+            for ($i = 1, $for_max = count($smarty->_config); $i < $for_max; $i++) {
+                $smarty->_config[$i]['vars'] = @array_merge($smarty->_config[$i]['vars'], $_config_vars);
+                $smarty->_config[$i]['files'][$_file] = true;
+            }
+        }
+        if ($smarty->debugging) {
+            $_params = array();
+            require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
+            $smarty->_smarty_debug_info[] = array('type'      => 'config',
+                                                'filename'  => $_file.' ['.$_section.'] '.$_scope,
+                                                'depth'     => $smarty->_inclusion_depth,
+                                                'exec_time' => smarty_core_get_microtime($_params, $smarty) - $_debug_start_time);
+        }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.counter.php
@@ -0,0 +1,65 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {counter} function plugin
+ *
+ * Type:     function<br />
+ * Name:     counter<br />
+ * Purpose:  print out a counter value
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @link http://smarty.php.net/manual/en/language.function.counter.php {counter}
+ *       (Smarty online manual)
+ * @param array parameters
+ * @param Smarty
+ * @return string|null
+ */
+function smarty_function_counter($params, &$smarty)
+{
+    static $counters = array();
+    $name = (isset($params['name'])) ? $params['name'] : 'default';
+    if (!isset($counters[$name])) {
+        $counters[$name] = array(
+            'start'=>1,
+            'skip'=>1,
+            'direction'=>'up',
+            'count'=>1
+            );
+    }
+    $counter =& $counters[$name];
+    if (isset($params['start'])) {
+        $counter['start'] = $counter['count'] = (int)$params['start'];
+    }
+    if (!empty($params['assign'])) {
+        $counter['assign'] = $params['assign'];
+    }
+    if (isset($counter['assign'])) {
+        $smarty->assign($counter['assign'], $counter['count']);
+    }
+    if (isset($params['print'])) {
+        $print = (bool)$params['print'];
+    } else {
+        $print = empty($counter['assign']);
+    }
+    if ($print) {
+        $retval = $counter['count'];
+    } else {
+        $retval = null;
+    }
+    if (isset($params['skip'])) {
+        $counter['skip'] = $params['skip'];
+    }
+    if (isset($params['direction'])) {
+        $counter['direction'] = $params['direction'];
+    }
+    if ($counter['direction'] == "down")
+        $counter['count'] -= $counter['skip'];
+    else
+        $counter['count'] += $counter['skip'];
+    return $retval;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.cycle.php
@@ -0,0 +1,90 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {cycle} function plugin
+ *
+ * Type:     function<br />
+ * Name:     cycle<br />
+ * Date:     May 3, 2002<br />
+ * Purpose:  cycle through given values<br />
+ * Input:
+ *         - name = name of cycle (optional)
+ *         - values = comma separated list of values to cycle,
+ *                    or an array of values to cycle
+ *                    (this can be left out for subsequent calls)
+ *         - reset = boolean - resets given var to true
+ *         - print = boolean - print var or not. default is true
+ *         - advance = boolean - whether or not to advance the cycle
+ *         - delimiter = the value delimiter, default is ","
+ *         - assign = boolean, assigns to template var instead of
+ *                    printed.
+ *
+ * Examples:<br />
+ * <pre>
+ * {cycle values="#eeeeee,#d0d0d0d"}
+ * {cycle name=row values="one,two,three" reset=true}
+ * {cycle name=row}
+ * </pre>
+ * @link http://smarty.php.net/manual/en/language.function.cycle.php {cycle}
+ *       (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @author credit to Mark Priatel <mpriatel@rogers.com>
+ * @author credit to Gerard <gerard@interfold.com>
+ * @author credit to Jason Sweat <jsweat_php@yahoo.com>
+ * @version  1.3
+ * @param array
+ * @param Smarty
+ * @return string|null
+ */
+function smarty_function_cycle($params, &$smarty)
+{
+    static $cycle_vars;
+    $name = (empty($params['name'])) ? 'default' : $params['name'];
+    $print = (isset($params['print'])) ? (bool)$params['print'] : true;
+    $advance = (isset($params['advance'])) ? (bool)$params['advance'] : true;
+    $reset = (isset($params['reset'])) ? (bool)$params['reset'] : false;
+    if (!in_array('values', array_keys($params))) {
+        if(!isset($cycle_vars[$name]['values'])) {
+            $smarty->trigger_error("cycle: missing 'values' parameter");
+            return;
+        }
+    } else {
+        if(isset($cycle_vars[$name]['values'])
+            && $cycle_vars[$name]['values'] != $params['values'] ) {
+            $cycle_vars[$name]['index'] = 0;
+        }
+        $cycle_vars[$name]['values'] = $params['values'];
+    }
+    $cycle_vars[$name]['delimiter'] = (isset($params['delimiter'])) ? $params['delimiter'] : ',';
+    if(is_array($cycle_vars[$name]['values'])) {
+        $cycle_array = $cycle_vars[$name]['values'];
+    } else {
+        $cycle_array = explode($cycle_vars[$name]['delimiter'],$cycle_vars[$name]['values']);
+    }
+    if(!isset($cycle_vars[$name]['index']) || $reset ) {
+        $cycle_vars[$name]['index'] = 0;
+    }
+    if (isset($params['assign'])) {
+        $print = false;
+        $smarty->assign($params['assign'], $cycle_array[$cycle_vars[$name]['index']]);
+    }
+    if($print) {
+        $retval = $cycle_array[$cycle_vars[$name]['index']];
+    } else {
+        $retval = null;
+    }
+    if($advance) {
+        if ( $cycle_vars[$name]['index'] >= count($cycle_array) -1 ) {
+            $cycle_vars[$name]['index'] = 0;
+        } else {
+            $cycle_vars[$name]['index']++;
+        }
+    }
+    return $retval;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.debug.php
@@ -0,0 +1,31 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {debug} function plugin
+ *
+ * Type:     function<br />
+ * Name:     debug<br />
+ * Date:     July 1, 2002<br />
+ * Purpose:  popup debug window
+ * @link http://smarty.php.net/manual/en/language.function.debug.php {debug}
+ *       (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @version  1.0
+ * @param array
+ * @param Smarty
+ * @return string output from {@link Smarty::_generate_debug_output()}
+ */
+function smarty_function_debug($params, &$smarty)
+{
+    if (isset($params['output'])) {
+        $smarty->assign('_smarty_debug_output', $params['output']);
+    }
+    require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
+    return smarty_core_display_debug_console(null, $smarty);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.eval.php
@@ -0,0 +1,40 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {eval} function plugin
+ *
+ * Type:     function<br />
+ * Name:     eval<br />
+ * Purpose:  evaluate a template variable as a template<br />
+ * @link http://smarty.php.net/manual/en/language.function.eval.php {eval}
+ *       (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ */
+function smarty_function_eval($params, &$smarty)
+{
+    if (!isset($params['var'])) {
+        $smarty->trigger_error("eval: missing 'var' parameter");
+        return;
+    }
+    if($params['var'] == '') {
+        return;
+    }
+    $smarty->_compile_source('evaluated template', $params['var'], $_var_compiled);
+    ob_start();
+    $smarty->_eval('?>' . $_var_compiled);
+    $_contents = ob_get_contents();
+    ob_end_clean();
+    if (!empty($params['assign'])) {
+        $smarty->assign($params['assign'], $_contents);
+    } else {
+        return $_contents;
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.fetch.php
@@ -0,0 +1,202 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {fetch} plugin
+ *
+ * Type:     function<br />
+ * Name:     fetch<br />
+ * Purpose:  fetch file, web or ftp data and display results
+ * @link http://smarty.php.net/manual/en/language.function.fetch.php {fetch}
+ *       (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string|null if the assign parameter is passed, Smarty assigns the
+ *                     result to a template variable
+ */
+function smarty_function_fetch($params, &$smarty)
+{
+    if (empty($params['file'])) {
+        $smarty->_trigger_fatal_error("[plugin] parameter 'file' cannot be empty");
+        return;
+    }
+    $content = '';
+    if ($smarty->security && !preg_match('!^(http|ftp)://!i', $params['file'])) {
+        $_params = array('resource_type' => 'file', 'resource_name' => $params['file']);
+        require_once(SMARTY_CORE_DIR . 'core.is_secure.php');
+        if(!smarty_core_is_secure($_params, $smarty)) {
+            $smarty->_trigger_fatal_error('[plugin] (secure mode) fetch \'' . $params['file'] . '\' is not allowed');
+            return;
+        }
+        if($fp = @fopen($params['file'],'r')) {
+            while(!feof($fp)) {
+                $content .= fgets ($fp,4096);
+            }
+            fclose($fp);
+        } else {
+            $smarty->_trigger_fatal_error('[plugin] fetch cannot read file \'' . $params['file'] . '\'');
+            return;
+        }
+    } else {
+        if(preg_match('!^http://!i',$params['file'])) {
+            if($uri_parts = parse_url($params['file'])) {
+                $host = $server_name = $uri_parts['host'];
+                $timeout = 30;
+                $accept = "image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*";
+                $agent = "Smarty Template Engine ".$smarty->_version;
+                $referer = "";
+                $uri = !empty($uri_parts['path']) ? $uri_parts['path'] : '/';
+                $uri .= !empty($uri_parts['query']) ? '?' . $uri_parts['query'] : '';
+                $_is_proxy = false;
+                if(empty($uri_parts['port'])) {
+                    $port = 80;
+                } else {
+                    $port = $uri_parts['port'];
+                }
+                if(!empty($uri_parts['user'])) {
+                    $user = $uri_parts['user'];
+                }
+                if(!empty($uri_parts['pass'])) {
+                    $pass = $uri_parts['pass'];
+                }
+                foreach($params as $param_key => $param_value) {
+                    switch($param_key) {
+                        case "file":
+                        case "assign":
+                        case "assign_headers":
+                            break;
+                        case "user":
+                            if(!empty($param_value)) {
+                                $user = $param_value;
+                            }
+                            break;
+                        case "pass":
+                            if(!empty($param_value)) {
+                                $pass = $param_value;
+                            }
+                            break;
+                        case "accept":
+                            if(!empty($param_value)) {
+                                $accept = $param_value;
+                            }
+                            break;
+                        case "header":
+                            if(!empty($param_value)) {
+                                if(!preg_match('![\w\d-]+: .+!',$param_value)) {
+                                    $smarty->_trigger_fatal_error("[plugin] invalid header format '".$param_value."'");
+                                    return;
+                                } else {
+                                    $extra_headers[] = $param_value;
+                                }
+                            }
+                            break;
+                        case "proxy_host":
+                            if(!empty($param_value)) {
+                                $proxy_host = $param_value;
+                            }
+                            break;
+                        case "proxy_port":
+                            if(!preg_match('!\D!', $param_value)) {
+                                $proxy_port = (int) $param_value;
+                            } else {
+                                $smarty->_trigger_fatal_error("[plugin] invalid value for attribute '".$param_key."'");
+                                return;
+                            }
+                            break;
+                        case "agent":
+                            if(!empty($param_value)) {
+                                $agent = $param_value;
+                            }
+                            break;
+                        case "referer":
+                            if(!empty($param_value)) {
+                                $referer = $param_value;
+                            }
+                            break;
+                        case "timeout":
+                            if(!preg_match('!\D!', $param_value)) {
+                                $timeout = (int) $param_value;
+                            } else {
+                                $smarty->_trigger_fatal_error("[plugin] invalid value for attribute '".$param_key."'");
+                                return;
+                            }
+                            break;
+                        default:
+                            $smarty->_trigger_fatal_error("[plugin] unrecognized attribute '".$param_key."'");
+                            return;
+                    }
+                }
+                if(!empty($proxy_host) && !empty($proxy_port)) {
+                    $_is_proxy = true;
+                    $fp = fsockopen($proxy_host,$proxy_port,$errno,$errstr,$timeout);
+                } else {
+                    $fp = fsockopen($server_name,$port,$errno,$errstr,$timeout);
+                }
+                if(!$fp) {
+                    $smarty->_trigger_fatal_error("[plugin] unable to fetch: $errstr ($errno)");
+                    return;
+                } else {
+                    if($_is_proxy) {
+                        fputs($fp, 'GET ' . $params['file'] . " HTTP/1.0\r\n");
+                    } else {
+                        fputs($fp, "GET $uri HTTP/1.0\r\n");
+                    }
+                    if(!empty($host)) {
+                        fputs($fp, "Host: $host\r\n");
+                    }
+                    if(!empty($accept)) {
+                        fputs($fp, "Accept: $accept\r\n");
+                    }
+                    if(!empty($agent)) {
+                        fputs($fp, "User-Agent: $agent\r\n");
+                    }
+                    if(!empty($referer)) {
+                        fputs($fp, "Referer: $referer\r\n");
+                    }
+                    if(isset($extra_headers) && is_array($extra_headers)) {
+                        foreach($extra_headers as $curr_header) {
+                            fputs($fp, $curr_header."\r\n");
+                        }
+                    }
+                    if(!empty($user) && !empty($pass)) {
+                        fputs($fp, "Authorization: BASIC ".base64_encode("$user:$pass")."\r\n");
+                    }
+                    fputs($fp, "\r\n");
+                    while(!feof($fp)) {
+                        $content .= fgets($fp,4096);
+                    }
+                    fclose($fp);
+                    $csplit = split("\r\n\r\n",$content,2);
+                    $content = $csplit[1];
+                    if(!empty($params['assign_headers'])) {
+                        $smarty->assign($params['assign_headers'],split("\r\n",$csplit[0]));
+                    }
+                }
+            } else {
+                $smarty->_trigger_fatal_error("[plugin] unable to parse URL, check syntax");
+                return;
+            }
+        } else {
+            if($fp = @fopen($params['file'],'r')) {
+                while(!feof($fp)) {
+                    $content .= fgets ($fp,4096);
+                }
+                fclose($fp);
+            } else {
+                $smarty->_trigger_fatal_error('[plugin] fetch cannot read file \'' . $params['file'] .'\'');
+                return;
+            }
+        }
+    }
+    if (!empty($params['assign'])) {
+        $smarty->assign($params['assign'],$content);
+    } else {
+        return $content;
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_checkboxes.php
@@ -0,0 +1,118 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_checkboxes} function plugin
+ *
+ * File:       function.html_checkboxes.php<br />
+ * Type:       function<br />
+ * Name:       html_checkboxes<br />
+ * Date:       24.Feb.2003<br />
+ * Purpose:    Prints out a list of checkbox input types<br />
+ * Input:<br />
+ *           - name       (optional) - string default "checkbox"
+ *           - values     (required) - array
+ *           - options    (optional) - associative array
+ *           - checked    (optional) - array default not set
+ *           - separator  (optional) - ie <br /> or &nbsp;
+ *           - output     (optional) - the output next to each checkbox
+ *           - assign     (optional) - assign the output as an array to this variable
+ * Examples:
+ * <pre>
+ * {html_checkboxes values=$ids output=$names}
+ * {html_checkboxes values=$ids name='box' separator='<br />' output=$names}
+ * {html_checkboxes values=$ids checked=$checked separator='<br />' output=$names}
+ * </pre>
+ * @link http://smarty.php.net/manual/en/language.function.html.checkboxes.php {html_checkboxes}
+ *      (Smarty online manual)
+ * @author     Christopher Kvarme <christopher.kvarme@flashjab.com>
+ * @author credits to Monte Ohrt <monte at ohrt dot com>
+ * @version    1.0
+ * @param array
+ * @param Smarty
+ * @return string
+ * @uses smarty_function_escape_special_chars()
+ */
+function smarty_function_html_checkboxes($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
+    $name = 'checkbox';
+    $values = null;
+    $options = null;
+    $selected = null;
+    $separator = '';
+    $labels = true;
+    $output = null;
+    $extra = '';
+    foreach($params as $_key => $_val) {
+        switch($_key) {
+            case 'name':
+            case 'separator':
+                $$_key = $_val;
+                break;
+            case 'labels':
+                $$_key = (bool)$_val;
+                break;
+            case 'options':
+                $$_key = (array)$_val;
+                break;
+            case 'values':
+            case 'output':
+                $$_key = array_values((array)$_val);
+                break;
+            case 'checked':
+            case 'selected':
+                $selected = array_map('strval', array_values((array)$_val));
+                break;
+            case 'checkboxes':
+                $smarty->trigger_error('html_checkboxes: the use of the "checkboxes" attribute is deprecated, use "options" instead', E_USER_WARNING);
+                $options = (array)$_val;
+                break;
+            case 'assign':
+                break;
+            default:
+                if(!is_array($_val)) {
+                    $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
+                } else {
+                    $smarty->trigger_error("html_checkboxes: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+        }
+    }
+    if (!isset($options) && !isset($values))
+        return ''; /* raise error here? */
+    settype($selected, 'array');
+    $_html_result = array();
+    if (isset($options)) {
+        foreach ($options as $_key=>$_val)
+            $_html_result[] = smarty_function_html_checkboxes_output($name, $_key, $_val, $selected, $extra, $separator, $labels);
+    } else {
+        foreach ($values as $_i=>$_key) {
+            $_val = isset($output[$_i]) ? $output[$_i] : '';
+            $_html_result[] = smarty_function_html_checkboxes_output($name, $_key, $_val, $selected, $extra, $separator, $labels);
+        }
+    }
+    if(!empty($params['assign'])) {
+        $smarty->assign($params['assign'], $_html_result);
+    } else {
+        return implode("\n",$_html_result);
+    }
+}
+function smarty_function_html_checkboxes_output($name, $value, $output, $selected, $extra, $separator, $labels) {
+    $_output = '';
+    if ($labels) $_output .= '<label>';
+    $_output .= '<input type="checkbox" name="'
+        . smarty_function_escape_special_chars($name) . '[]" value="'
+        . smarty_function_escape_special_chars($value) . '"';
+    if (in_array((string)$value, $selected)) {
+        $_output .= ' checked="checked"';
+    }
+    $_output .= $extra . ' />' . $output;
+    if ($labels) $_output .= '</label>';
+    $_output .=  $separator;
+    return $_output;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_image.php
@@ -0,0 +1,127 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_image} function plugin
+ *
+ * Type:     function<br />
+ * Name:     html_image<br />
+ * Date:     Feb 24, 2003<br />
+ * Purpose:  format HTML tags for the image<br />
+ * Input:<br />
+ *         - file = file (and path) of image (required)
+ *         - height = image height (optional, default actual height)
+ *         - width = image width (optional, default actual width)
+ *         - basedir = base directory for absolute paths, default
+ *                     is environment variable DOCUMENT_ROOT
+ *         - path_prefix = prefix for path output (optional, default empty)
+ *
+ * Examples: {html_image file="/images/masthead.gif"}
+ * Output:   <img src="/images/masthead.gif" width=400 height=23>
+ * @link http://smarty.php.net/manual/en/language.function.html.image.php {html_image}
+ *      (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @author credits to Duda <duda@big.hu> - wrote first image function
+ *           in repository, helped with lots of functionality
+ * @version  1.0
+ * @param array
+ * @param Smarty
+ * @return string
+ * @uses smarty_function_escape_special_chars()
+ */
+function smarty_function_html_image($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
+    $alt = '';
+    $file = '';
+    $height = '';
+    $width = '';
+    $extra = '';
+    $prefix = '';
+    $suffix = '';
+    $path_prefix = '';
+    $server_vars = ($smarty->request_use_auto_globals) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];
+    $basedir = isset($server_vars['DOCUMENT_ROOT']) ? $server_vars['DOCUMENT_ROOT'] : '';
+    foreach($params as $_key => $_val) {
+        switch($_key) {
+            case 'file':
+            case 'height':
+            case 'width':
+            case 'dpi':
+            case 'path_prefix':
+            case 'basedir':
+                $$_key = $_val;
+                break;
+            case 'alt':
+                if(!is_array($_val)) {
+                    $$_key = smarty_function_escape_special_chars($_val);
+                } else {
+                    $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+            case 'link':
+            case 'href':
+                $prefix = '<a href="' . $_val . '">';
+                $suffix = '</a>';
+                break;
+            default:
+                if(!is_array($_val)) {
+                    $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
+                } else {
+                    $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+        }
+    }
+    if (empty($file)) {
+        $smarty->trigger_error("html_image: missing 'file' parameter", E_USER_NOTICE);
+        return;
+    }
+    if (substr($file,0,1) == '/') {
+        $_image_path = $basedir . $file;
+    } else {
+        $_image_path = $file;
+    }
+    if(!isset($params['width']) || !isset($params['height'])) {
+        if(!$_image_data = @getimagesize($_image_path)) {
+            if(!file_exists($_image_path)) {
+                $smarty->trigger_error("html_image: unable to find '$_image_path'", E_USER_NOTICE);
+                return;
+            } else if(!is_readable($_image_path)) {
+                $smarty->trigger_error("html_image: unable to read '$_image_path'", E_USER_NOTICE);
+                return;
+            } else {
+                $smarty->trigger_error("html_image: '$_image_path' is not a valid image file", E_USER_NOTICE);
+                return;
+            }
+        }
+        if ($smarty->security &&
+            ($_params = array('resource_type' => 'file', 'resource_name' => $_image_path)) &&
+            (require_once(SMARTY_CORE_DIR . 'core.is_secure.php')) &&
+            (!smarty_core_is_secure($_params, $smarty)) ) {
+            $smarty->trigger_error("html_image: (secure) '$_image_path' not in secure directory", E_USER_NOTICE);
+        }        
+        if(!isset($params['width'])) {
+            $width = $_image_data[0];
+        }
+        if(!isset($params['height'])) {
+            $height = $_image_data[1];
+        }
+    }
+    if(isset($params['dpi'])) {
+        if(strstr($server_vars['HTTP_USER_AGENT'], 'Mac')) {
+            $dpi_default = 72;
+        } else {
+            $dpi_default = 96;
+        }
+        $_resize = $dpi_default/$params['dpi'];
+        $width = round($width * $_resize);
+        $height = round($height * $_resize);
+    }
+    return $prefix . '<img src="'.$path_prefix.$file.'" alt="'.$alt.'" width="'.$width.'" height="'.$height.'"'.$extra.' />' . $suffix;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_options.php
@@ -0,0 +1,99 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_options} function plugin
+ *
+ * Type:     function<br />
+ * Name:     html_options<br />
+ * Input:<br />
+ *           - name       (optional) - string default "select"
+ *           - values     (required if no options supplied) - array
+ *           - options    (required if no values supplied) - associative array
+ *           - selected   (optional) - string default not set
+ *           - output     (required if not options supplied) - array
+ * Purpose:  Prints the list of <option> tags generated from
+ *           the passed parameters
+ * @link http://smarty.php.net/manual/en/language.function.html.options.php {html_image}
+ *      (Smarty online manual)
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string
+ * @uses smarty_function_escape_special_chars()
+ */
+function smarty_function_html_options($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
+    $name = null;
+    $values = null;
+    $options = null;
+    $selected = array();
+    $output = null;
+    $extra = '';
+    foreach($params as $_key => $_val) {
+        switch($_key) {
+            case 'name':
+                $$_key = (string)$_val;
+                break;
+            case 'options':
+                $$_key = (array)$_val;
+                break;
+            case 'values':
+            case 'output':
+                $$_key = array_values((array)$_val);
+                break;
+            case 'selected':
+                $$_key = array_map('strval', array_values((array)$_val));
+                break;
+            default:
+                if(!is_array($_val)) {
+                    $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
+                } else {
+                    $smarty->trigger_error("html_options: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+        }
+    }
+    if (!isset($options) && !isset($values))
+        return ''; /* raise error here? */
+    $_html_result = '';
+    if (isset($options)) {
+        foreach ($options as $_key=>$_val)
+            $_html_result .= smarty_function_html_options_optoutput($_key, $_val, $selected);
+    } else {
+        foreach ($values as $_i=>$_key) {
+            $_val = isset($output[$_i]) ? $output[$_i] : '';
+            $_html_result .= smarty_function_html_options_optoutput($_key, $_val, $selected);
+        }
+    }
+    if(!empty($name)) {
+        $_html_result = '<select name="' . $name . '"' . $extra . '>' . "\n" . $_html_result . '</select>' . "\n";
+    }
+    return $_html_result;
+}
+function smarty_function_html_options_optoutput($key, $value, $selected) {
+    if(!is_array($value)) {
+        $_html_result = '<option label="' . smarty_function_escape_special_chars($value) . '" value="' .
+            smarty_function_escape_special_chars($key) . '"';
+        if (in_array((string)$key, $selected))
+            $_html_result .= ' selected="selected"';
+        $_html_result .= '>' . smarty_function_escape_special_chars($value) . '</option>' . "\n";
+    } else {
+        $_html_result = smarty_function_html_options_optgroup($key, $value, $selected);
+    }
+    return $_html_result;
+}
+function smarty_function_html_options_optgroup($key, $values, $selected) {
+    $optgroup_html = '<optgroup label="' . smarty_function_escape_special_chars($key) . '">' . "\n";
+    foreach ($values as $key => $value) {
+        $optgroup_html .= smarty_function_html_options_optoutput($key, $value, $selected);
+    }
+    $optgroup_html .= "</optgroup>\n";
+    return $optgroup_html;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_radios.php
@@ -0,0 +1,131 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_radios} function plugin
+ *
+ * File:       function.html_radios.php<br />
+ * Type:       function<br />
+ * Name:       html_radios<br />
+ * Date:       24.Feb.2003<br />
+ * Purpose:    Prints out a list of radio input types<br />
+ * Input:<br />
+ *           - name       (optional) - string default "radio"
+ *           - values     (required) - array
+ *           - options    (optional) - associative array
+ *           - checked    (optional) - array default not set
+ *           - separator  (optional) - ie <br /> or &nbsp;
+ *           - output     (optional) - the output next to each radio button
+ *           - assign     (optional) - assign the output as an array to this variable
+ * Examples:
+ * <pre>
+ * {html_radios values=$ids output=$names}
+ * {html_radios values=$ids name='box' separator='<br />' output=$names}
+ * {html_radios values=$ids checked=$checked separator='<br />' output=$names}
+ * </pre>
+ * @link http://smarty.php.net/manual/en/language.function.html.radios.php {html_radios}
+ *      (Smarty online manual)
+ * @author     Christopher Kvarme <christopher.kvarme@flashjab.com>
+ * @author credits to Monte Ohrt <monte at ohrt dot com>
+ * @version    1.0
+ * @param array
+ * @param Smarty
+ * @return string
+ * @uses smarty_function_escape_special_chars()
+ */
+function smarty_function_html_radios($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
+    $name = 'radio';
+    $values = null;
+    $options = null;
+    $selected = null;
+    $separator = '';
+    $labels = true;
+    $label_ids = false;
+    $output = null;
+    $extra = '';
+    foreach($params as $_key => $_val) {
+        switch($_key) {
+            case 'name':
+            case 'separator':
+                $$_key = (string)$_val;
+                break;
+            case 'checked':
+            case 'selected':
+                if(is_array($_val)) {
+                    $smarty->trigger_error('html_radios: the "' . $_key . '" attribute cannot be an array', E_USER_WARNING);
+                } else {
+                    $selected = (string)$_val;
+                }
+                break;
+            case 'labels':
+            case 'label_ids':
+                $$_key = (bool)$_val;
+                break;
+            case 'options':
+                $$_key = (array)$_val;
+                break;
+            case 'values':
+            case 'output':
+                $$_key = array_values((array)$_val);
+                break;
+            case 'radios':
+                $smarty->trigger_error('html_radios: the use of the "radios" attribute is deprecated, use "options" instead', E_USER_WARNING);
+                $options = (array)$_val;
+                break;
+            case 'assign':
+                break;
+            default:
+                if(!is_array($_val)) {
+                    $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
+                } else {
+                    $smarty->trigger_error("html_radios: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+        }
+    }
+    if (!isset($options) && !isset($values))
+        return ''; /* raise error here? */
+    $_html_result = array();
+    if (isset($options)) {
+        foreach ($options as $_key=>$_val)
+            $_html_result[] = smarty_function_html_radios_output($name, $_key, $_val, $selected, $extra, $separator, $labels, $label_ids);
+    } else {
+        foreach ($values as $_i=>$_key) {
+            $_val = isset($output[$_i]) ? $output[$_i] : '';
+            $_html_result[] = smarty_function_html_radios_output($name, $_key, $_val, $selected, $extra, $separator, $labels, $label_ids);
+        }
+    }
+    if(!empty($params['assign'])) {
+        $smarty->assign($params['assign'], $_html_result);
+    } else {
+        return implode("\n",$_html_result);
+    }
+}
+function smarty_function_html_radios_output($name, $value, $output, $selected, $extra, $separator, $labels, $label_ids) {
+    $_output = '';
+    if ($labels) {
+      if($label_ids) {
+          $_id = smarty_function_escape_special_chars(preg_replace('![^\w\-\.]!', '_', $name . '_' . $value));
+          $_output .= '<label for="' . $_id . '">';
+      } else {
+          $_output .= '<label>';           
+      }
+   }
+   $_output .= '<input type="radio" name="'
+        . smarty_function_escape_special_chars($name) . '" value="'
+        . smarty_function_escape_special_chars($value) . '"';
+   if ($labels && $label_ids) $_output .= ' id="' . $_id . '"';
+    if ((string)$value==$selected) {
+        $_output .= ' checked="checked"';
+    }
+    $_output .= $extra . ' />' . $output;
+    if ($labels) $_output .= '</label>';
+    $_output .=  $separator;
+    return $_output;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_select_date.php
@@ -0,0 +1,300 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_select_date} plugin
+ *
+ * Type:     function<br />
+ * Name:     html_select_date<br />
+ * Purpose:  Prints the dropdowns for date selection.
+ *
+ * ChangeLog:<br />
+ *           - 1.0 initial release
+ *           - 1.1 added support for +/- N syntax for begin
+ *                and end year values. (Monte)
+ *           - 1.2 added support for yyyy-mm-dd syntax for
+ *                time value. (Jan Rosier)
+ *           - 1.3 added support for choosing format for
+ *                month values (Gary Loescher)
+ *           - 1.3.1 added support for choosing format for
+ *                day values (Marcus Bointon)
+ *           - 1.3.2 support negative timestamps, force year
+ *             dropdown to include given date unless explicitly set (Monte)
+ *           - 1.3.4 fix behaviour of 0000-00-00 00:00:00 dates to match that
+ *             of 0000-00-00 dates (cybot, boots)
+ * @link http://smarty.php.net/manual/en/language.function.html.select.date.php {html_select_date}
+ *      (Smarty online manual)
+ * @version 1.3.4
+ * @author Andrei Zmievski
+ * @author Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string
+ */
+function smarty_function_html_select_date($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
+    require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
+    require_once $smarty->_get_plugin_filepath('function','html_options');
+    /* Default values. */
+    $prefix          = "Date_";
+    $start_year      = strftime("%Y");
+    $end_year        = $start_year;
+    $display_days    = true;
+    $display_months  = true;
+    $display_years   = true;
+    $month_format    = "%B";
+    /* Write months as numbers by default  GL */
+    $month_value_format = "%m";
+    $day_format      = "%02d";
+    /* Write day values using this format MB */
+    $day_value_format = "%d";
+    $year_as_text    = false;
+    /* Display years in reverse order? Ie. 2000,1999,.... */
+    $reverse_years   = false;
+    /* Should the select boxes be part of an array when returned from PHP?
+       e.g. setting it to "birthday", would create "birthday[Day]",
+       "birthday[Month]" & "birthday[Year]". Can be combined with prefix */
+    $field_array     = null;
+    /* <select size>'s of the different <select> tags.
+       If not set, uses default dropdown. */
+    $day_size        = null;
+    $month_size      = null;
+    $year_size       = null;
+    /* Unparsed attributes common to *ALL* the <select>/<input> tags.
+       An example might be in the template: all_extra ='class ="foo"'. */
+    $all_extra       = null;
+    /* Separate attributes for the tags. */
+    $day_extra       = null;
+    $month_extra     = null;
+    $year_extra      = null;
+    /* Order in which to display the fields.
+       "D" -> day, "M" -> month, "Y" -> year. */
+    $field_order     = 'MDY';
+    /* String printed between the different fields. */
+    $field_separator = "\n";
+    $time = time();
+    $all_empty       = null;
+    $day_empty       = null;
+    $month_empty     = null;
+    $year_empty      = null;
+    $extra_attrs     = '';
+    foreach ($params as $_key=>$_value) {
+        switch ($_key) {
+            case 'prefix':
+            case 'time':
+            case 'start_year':
+            case 'end_year':
+            case 'month_format':
+            case 'day_format':
+            case 'day_value_format':
+            case 'field_array':
+            case 'day_size':
+            case 'month_size':
+            case 'year_size':
+            case 'all_extra':
+            case 'day_extra':
+            case 'month_extra':
+            case 'year_extra':
+            case 'field_order':
+            case 'field_separator':
+            case 'month_value_format':
+            case 'month_empty':
+            case 'day_empty':
+            case 'year_empty':
+                $$_key = (string)$_value;
+                break;
+            case 'all_empty':
+                $$_key = (string)$_value;
+                $day_empty = $month_empty = $year_empty = $all_empty;
+                break;
+            case 'display_days':
+            case 'display_months':
+            case 'display_years':
+            case 'year_as_text':
+            case 'reverse_years':
+                $$_key = (bool)$_value;
+                break;
+            default:
+                if(!is_array($_value)) {
+                    $extra_attrs .= ' '.$_key.'="'.smarty_function_escape_special_chars($_value).'"';
+                } else {
+                    $smarty->trigger_error("html_select_date: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
+                }
+                break;
+        }
+    }
+    if (preg_match('!^-\d+$!', $time)) {
+        $time = date('Y-m-d', $time);
+    }
+    if (preg_match('/^(\d{0,4}-\d{0,2}-\d{0,2})/', $time, $found)) {
+        $time = $found[1];
+    } else {
+        $time = strftime('%Y-%m-%d', smarty_make_timestamp($time));
+    }
+    $time = explode("-", $time);
+    if (preg_match('!^(\+|\-)\s*(\d+)$!', $end_year, $match)) {
+        if ($match[1] == '+') {
+            $end_year = strftime('%Y') + $match[2];
+        } else {
+            $end_year = strftime('%Y') - $match[2];
+        }
+    }
+    if (preg_match('!^(\+|\-)\s*(\d+)$!', $start_year, $match)) {
+        if ($match[1] == '+') {
+            $start_year = strftime('%Y') + $match[2];
+        } else {
+            $start_year = strftime('%Y') - $match[2];
+        }
+    }
+    if (strlen($time[0]) > 0) {
+        if ($start_year > $time[0] && !isset($params['start_year'])) {
+            $start_year = $time[0];
+        }
+        if($end_year < $time[0] && !isset($params['end_year'])) {
+            $end_year = $time[0];
+        }
+    }
+    $field_order = strtoupper($field_order);
+    $html_result = $month_result = $day_result = $year_result = "";
+    $field_separator_count = -1;
+    if ($display_months) {
+    	$field_separator_count++;
+        $month_names = array();
+        $month_values = array();
+        if(isset($month_empty)) {
+            $month_names[''] = $month_empty;
+            $month_values[''] = '';
+        }
+        for ($i = 1; $i <= 12; $i++) {
+            $month_names[$i] = strftime($month_format, mktime(0, 0, 0, $i, 1, 2000));
+            $month_values[$i] = strftime($month_value_format, mktime(0, 0, 0, $i, 1, 2000));
+        }
+        $month_result .= '<select name=';
+        if (null !== $field_array){
+            $month_result .= '"' . $field_array . '[' . $prefix . 'Month]"';
+        } else {
+            $month_result .= '"' . $prefix . 'Month"';
+        }
+        if (null !== $month_size){
+            $month_result .= ' size="' . $month_size . '"';
+        }
+        if (null !== $month_extra){
+            $month_result .= ' ' . $month_extra;
+        }
+        if (null !== $all_extra){
+            $month_result .= ' ' . $all_extra;
+        }
+        $month_result .= $extra_attrs . '>'."\n";
+        $month_result .= smarty_function_html_options(array('output'     => $month_names,
+                                                            'values'     => $month_values,
+                                                            'selected'   => (int)$time[1] ? strftime($month_value_format, mktime(0, 0, 0, (int)$time[1], 1, 2000)) : '',
+                                                            'print_result' => false),
+                                                      $smarty);
+        $month_result .= '</select>';
+    }
+    if ($display_days) {
+    	$field_separator_count++;
+        $days = array();
+        if (isset($day_empty)) {
+            $days[''] = $day_empty;
+            $day_values[''] = '';
+        }
+        for ($i = 1; $i <= 31; $i++) {
+            $days[] = sprintf($day_format, $i);
+            $day_values[] = sprintf($day_value_format, $i);
+        }
+        $day_result .= '<select name=';
+        if (null !== $field_array){
+            $day_result .= '"' . $field_array . '[' . $prefix . 'Day]"';
+        } else {
+            $day_result .= '"' . $prefix . 'Day"';
+        }
+        if (null !== $day_size){
+            $day_result .= ' size="' . $day_size . '"';
+        }
+        if (null !== $all_extra){
+            $day_result .= ' ' . $all_extra;
+        }
+        if (null !== $day_extra){
+            $day_result .= ' ' . $day_extra;
+        }
+        $day_result .= $extra_attrs . '>'."\n";
+        $day_result .= smarty_function_html_options(array('output'     => $days,
+                                                          'values'     => $day_values,
+                                                          'selected'   => $time[2],
+                                                          'print_result' => false),
+                                                    $smarty);
+        $day_result .= '</select>';
+    }
+    if ($display_years) {
+    	$field_separator_count++;
+        if (null !== $field_array){
+            $year_name = $field_array . '[' . $prefix . 'Year]';
+        } else {
+            $year_name = $prefix . 'Year';
+        }
+        if ($year_as_text) {
+            $year_result .= '<input type="text" name="' . $year_name . '" value="' . $time[0] . '" size="4" maxlength="4"';
+            if (null !== $all_extra){
+                $year_result .= ' ' . $all_extra;
+            }
+            if (null !== $year_extra){
+                $year_result .= ' ' . $year_extra;
+            }
+            $year_result .= ' />';
+        } else {
+            $years = range((int)$start_year, (int)$end_year);
+            if ($reverse_years) {
+                rsort($years, SORT_NUMERIC);
+            } else {
+                sort($years, SORT_NUMERIC);
+            }
+            $yearvals = $years;
+            if(isset($year_empty)) {
+                array_unshift($years, $year_empty);
+                array_unshift($yearvals, '');
+            }
+            $year_result .= '<select name="' . $year_name . '"';
+            if (null !== $year_size){
+                $year_result .= ' size="' . $year_size . '"';
+            }
+            if (null !== $all_extra){
+                $year_result .= ' ' . $all_extra;
+            }
+            if (null !== $year_extra){
+                $year_result .= ' ' . $year_extra;
+            }
+            $year_result .= $extra_attrs . '>'."\n";
+            $year_result .= smarty_function_html_options(array('output' => $years,
+                                                               'values' => $yearvals,
+                                                               'selected'   => $time[0],
+                                                               'print_result' => false),
+                                                         $smarty);
+            $year_result .= '</select>';
+        }
+    }
+    for ($i = 0; $i <= 2; $i++){
+        $c = substr($field_order, $i, 1);
+        switch ($c){
+            case 'D':
+                $html_result .= $day_result;
+                break;
+            case 'M':
+                $html_result .= $month_result;
+                break;
+            case 'Y':
+                $html_result .= $year_result;
+                break;
+        }
+        if($i < $field_separator_count) {
+            $html_result .= $field_separator;
+        }
+    }
+    return $html_result;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_select_time.php
@@ -0,0 +1,174 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_select_time} function plugin
+ *
+ * Type:     function<br />
+ * Name:     html_select_time<br />
+ * Purpose:  Prints the dropdowns for time selection
+ * @link http://smarty.php.net/manual/en/language.function.html.select.time.php {html_select_time}
+ *          (Smarty online manual)
+ * @author Roberto Berto <roberto@berto.net>
+ * @credits Monte Ohrt <monte AT ohrt DOT com>
+ * @param array
+ * @param Smarty
+ * @return string
+ * @uses smarty_make_timestamp()
+ */
+function smarty_function_html_select_time($params, &$smarty)
+{
+    require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
+    require_once $smarty->_get_plugin_filepath('function','html_options');
+    /* Default values. */
+    $prefix             = "Time_";
+    $time               = time();
+    $display_hours      = true;
+    $display_minutes    = true;
+    $display_seconds    = true;
+    $display_meridian   = true;
+    $use_24_hours       = true;
+    $minute_interval    = 1;
+    $second_interval    = 1;
+    /* Should the select boxes be part of an array when returned from PHP?
+       e.g. setting it to "birthday", would create "birthday[Hour]",
+       "birthday[Minute]", "birthday[Seconds]" & "birthday[Meridian]".
+       Can be combined with prefix. */
+    $field_array        = null;
+    $all_extra          = null;
+    $hour_extra         = null;
+    $minute_extra       = null;
+    $second_extra       = null;
+    $meridian_extra     = null;
+    foreach ($params as $_key=>$_value) {
+        switch ($_key) {
+            case 'prefix':
+            case 'time':
+            case 'field_array':
+            case 'all_extra':
+            case 'hour_extra':
+            case 'minute_extra':
+            case 'second_extra':
+            case 'meridian_extra':
+                $$_key = (string)$_value;
+                break;
+            case 'display_hours':
+            case 'display_minutes':
+            case 'display_seconds':
+            case 'display_meridian':
+            case 'use_24_hours':
+                $$_key = (bool)$_value;
+                break;
+            case 'minute_interval':
+            case 'second_interval':
+                $$_key = (int)$_value;
+                break;
+            default:
+                $smarty->trigger_error("[html_select_time] unknown parameter $_key", E_USER_WARNING);
+        }
+    }
+    $time = smarty_make_timestamp($time);
+    $html_result = '';
+    if ($display_hours) {
+        $hours       = $use_24_hours ? range(0, 23) : range(1, 12);
+        $hour_fmt = $use_24_hours ? '%H' : '%I';
+        for ($i = 0, $for_max = count($hours); $i < $for_max; $i++)
+            $hours[$i] = sprintf('%02d', $hours[$i]);
+        $html_result .= '<select name=';
+        if (null !== $field_array) {
+            $html_result .= '"' . $field_array . '[' . $prefix . 'Hour]"';
+        } else {
+            $html_result .= '"' . $prefix . 'Hour"';
+        }
+        if (null !== $hour_extra){
+            $html_result .= ' ' . $hour_extra;
+        }
+        if (null !== $all_extra){
+            $html_result .= ' ' . $all_extra;
+        }
+        $html_result .= '>'."\n";
+        $html_result .= smarty_function_html_options(array('output'          => $hours,
+                                                           'values'          => $hours,
+                                                           'selected'      => strftime($hour_fmt, $time),
+                                                           'print_result' => false),
+                                                     $smarty);
+        $html_result .= "</select>\n";
+    }
+    if ($display_minutes) {
+        $all_minutes = range(0, 59);
+        for ($i = 0, $for_max = count($all_minutes); $i < $for_max; $i+= $minute_interval)
+            $minutes[] = sprintf('%02d', $all_minutes[$i]);
+        $selected = intval(floor(strftime('%M', $time) / $minute_interval) * $minute_interval);
+        $html_result .= '<select name=';
+        if (null !== $field_array) {
+            $html_result .= '"' . $field_array . '[' . $prefix . 'Minute]"';
+        } else {
+            $html_result .= '"' . $prefix . 'Minute"';
+        }
+        if (null !== $minute_extra){
+            $html_result .= ' ' . $minute_extra;
+        }
+        if (null !== $all_extra){
+            $html_result .= ' ' . $all_extra;
+        }
+        $html_result .= '>'."\n";
+        $html_result .= smarty_function_html_options(array('output'          => $minutes,
+                                                           'values'          => $minutes,
+                                                           'selected'      => $selected,
+                                                           'print_result' => false),
+                                                     $smarty);
+        $html_result .= "</select>\n";
+    }
+    if ($display_seconds) {
+        $all_seconds = range(0, 59);
+        for ($i = 0, $for_max = count($all_seconds); $i < $for_max; $i+= $second_interval)
+            $seconds[] = sprintf('%02d', $all_seconds[$i]);
+        $selected = intval(floor(strftime('%S', $time) / $second_interval) * $second_interval);
+        $html_result .= '<select name=';
+        if (null !== $field_array) {
+            $html_result .= '"' . $field_array . '[' . $prefix . 'Second]"';
+        } else {
+            $html_result .= '"' . $prefix . 'Second"';
+        }
+        if (null !== $second_extra){
+            $html_result .= ' ' . $second_extra;
+        }
+        if (null !== $all_extra){
+            $html_result .= ' ' . $all_extra;
+        }
+        $html_result .= '>'."\n";
+        $html_result .= smarty_function_html_options(array('output'          => $seconds,
+                                                           'values'          => $seconds,
+                                                           'selected'      => $selected,
+                                                           'print_result' => false),
+                                                     $smarty);
+        $html_result .= "</select>\n";
+    }
+    if ($display_meridian && !$use_24_hours) {
+        $html_result .= '<select name=';
+        if (null !== $field_array) {
+            $html_result .= '"' . $field_array . '[' . $prefix . 'Meridian]"';
+        } else {
+            $html_result .= '"' . $prefix . 'Meridian"';
+        }
+        if (null !== $meridian_extra){
+            $html_result .= ' ' . $meridian_extra;
+        }
+        if (null !== $all_extra){
+            $html_result .= ' ' . $all_extra;
+        }
+        $html_result .= '>'."\n";
+        $html_result .= smarty_function_html_options(array('output'          => array('AM', 'PM'),
+                                                           'values'          => array('am', 'pm'),
+                                                           'selected'      => strtolower(strftime('%p', $time)),
+                                                           'print_result' => false),
+                                                     $smarty);
+        $html_result .= "</select>\n";
+    }
+    return $html_result;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.html_table.php
@@ -0,0 +1,155 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {html_table} function plugin
+ *
+ * Type:     function<br />
+ * Name:     html_table<br />
+ * Date:     Feb 17, 2003<br />
+ * Purpose:  make an html table from an array of data<br />
+ * Input:<br />
+ *         - loop = array to loop through
+ *         - cols = number of columns, comma separated list of column names
+ *                  or array of column names
+ *         - rows = number of rows
+ *         - table_attr = table attributes
+ *         - th_attr = table heading attributes (arrays are cycled)
+ *         - tr_attr = table row attributes (arrays are cycled)
+ *         - td_attr = table cell attributes (arrays are cycled)
+ *         - trailpad = value to pad trailing cells with
+ *         - caption = text for caption element 
+ *         - vdir = vertical direction (default: "down", means top-to-bottom)
+ *         - hdir = horizontal direction (default: "right", means left-to-right)
+ *         - inner = inner loop (default "cols": print $loop line by line,
+ *                   $loop will be printed column by column otherwise)
+ *
+ *
+ * Examples:
+ * <pre>
+ * {table loop=$data}
+ * {table loop=$data cols=4 tr_attr='"bgcolor=red"'}
+ * {table loop=$data cols="first,second,third" tr_attr=$colors}
+ * </pre>
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @author credit to Messju Mohr <messju at lammfellpuschen dot de>
+ * @author credit to boots <boots dot smarty at yahoo dot com>
+ * @version  1.1
+ * @link http://smarty.php.net/manual/en/language.function.html.table.php {html_table}
+ *          (Smarty online manual)
+ * @param array
+ * @param Smarty
+ * @return string
+ */
+function smarty_function_html_table($params, &$smarty)
+{
+    $table_attr = 'border="1"';
+    $tr_attr = '';
+    $th_attr = '';
+    $td_attr = '';
+    $cols = $cols_count = 3;
+    $rows = 3;
+    $trailpad = '&nbsp;';
+    $vdir = 'down';
+    $hdir = 'right';
+    $inner = 'cols';
+    $caption = '';
+    if (!isset($params['loop'])) {
+        $smarty->trigger_error("html_table: missing 'loop' parameter");
+        return;
+    }
+    foreach ($params as $_key=>$_value) {
+        switch ($_key) {
+            case 'loop':
+                $$_key = (array)$_value;
+                break;
+            case 'cols':
+                if (is_array($_value) && !empty($_value)) {
+                    $cols = $_value;
+                    $cols_count = count($_value);
+                } elseif (!is_numeric($_value) && is_string($_value) && !empty($_value)) {
+                    $cols = explode(',', $_value);
+                    $cols_count = count($cols);
+                } elseif (!empty($_value)) {
+                    $cols_count = (int)$_value;
+                } else {
+                    $cols_count = $cols;
+                }
+                break;
+            case 'rows':
+                $$_key = (int)$_value;
+                break;
+            case 'table_attr':
+            case 'trailpad':
+            case 'hdir':
+            case 'vdir':
+            case 'inner':
+            case 'caption':
+                $$_key = (string)$_value;
+                break;
+            case 'tr_attr':
+            case 'td_attr':
+            case 'th_attr':
+                $$_key = $_value;
+                break;
+        }
+    }
+    $loop_count = count($loop);
+    if (empty($params['rows'])) {
+        /* no rows specified */
+        $rows = ceil($loop_count/$cols_count);
+    } elseif (empty($params['cols'])) {
+        if (!empty($params['rows'])) {
+            /* no cols specified, but rows */
+            $cols_count = ceil($loop_count/$rows);
+        }
+    }
+    $output = "<table $table_attr>\n";
+    if (!empty($caption)) {
+        $output .= '<caption>' . $caption . "</caption>\n";
+    }
+    if (is_array($cols)) {
+        $cols = ($hdir == 'right') ? $cols : array_reverse($cols);
+        $output .= "<thead><tr>\n";
+        for ($r=0; $r<$cols_count; $r++) {
+            $output .= '<th' . smarty_function_html_table_cycle('th', $th_attr, $r) . '>';
+            $output .= $cols[$r];
+            $output .= "</th>\n";
+        }
+        $output .= "</tr></thead>\n";
+    }
+    $output .= "<tbody>\n";
+    for ($r=0; $r<$rows; $r++) {
+        $output .= "<tr" . smarty_function_html_table_cycle('tr', $tr_attr, $r) . ">\n";
+        $rx =  ($vdir == 'down') ? $r*$cols_count : ($rows-1-$r)*$cols_count;
+        for ($c=0; $c<$cols_count; $c++) {
+            $x =  ($hdir == 'right') ? $rx+$c : $rx+$cols_count-1-$c;
+            if ($inner!='cols') {
+                /* shuffle x to loop over rows*/
+                $x = floor($x/$cols_count) + ($x%$cols_count)*$rows;
+            }
+            if ($x<$loop_count) {
+                $output .= "<td" . smarty_function_html_table_cycle('td', $td_attr, $c) . ">" . $loop[$x] . "</td>\n";
+            } else {
+                $output .= "<td" . smarty_function_html_table_cycle('td', $td_attr, $c) . ">$trailpad</td>\n";
+            }
+        }
+        $output .= "</tr>\n";
+    }
+    $output .= "</tbody>\n";
+    $output .= "</table>\n";
+    return $output;
+}
+function smarty_function_html_table_cycle($name, $var, $no) {
+    if(!is_array($var)) {
+        $ret = $var;
+    } else {
+        $ret = $var[$no % count($var)];
+    }
+    return ($ret) ? ' '.$ret : '';
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.mailto.php
@@ -0,0 +1,136 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {mailto} function plugin
+ *
+ * Type:     function<br />
+ * Name:     mailto<br />
+ * Date:     May 21, 2002
+ * Purpose:  automate mailto address link creation, and optionally
+ *           encode them.<br />
+ * Input:<br />
+ *         - address = e-mail address
+ *         - text = (optional) text to display, default is address
+ *         - encode = (optional) can be one of:
+ *                * none : no encoding (default)
+ *                * javascript : encode with javascript
+ *                * javascript_charcode : encode with javascript charcode
+ *                * hex : encode with hexidecimal (no javascript)
+ *         - cc = (optional) address(es) to carbon copy
+ *         - bcc = (optional) address(es) to blind carbon copy
+ *         - subject = (optional) e-mail subject
+ *         - newsgroups = (optional) newsgroup(s) to post to
+ *         - followupto = (optional) address(es) to follow up to
+ *         - extra = (optional) extra tags for the href link
+ *
+ * Examples:
+ * <pre>
+ * {mailto address="me@domain.com"}
+ * {mailto address="me@domain.com" encode="javascript"}
+ * {mailto address="me@domain.com" encode="hex"}
+ * {mailto address="me@domain.com" subject="Hello to you!"}
+ * {mailto address="me@domain.com" cc="you@domain.com,they@domain.com"}
+ * {mailto address="me@domain.com" extra='class="mailto"'}
+ * </pre>
+ * @link http://smarty.php.net/manual/en/language.function.mailto.php {mailto}
+ *          (Smarty online manual)
+ * @version  1.2
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @author   credits to Jason Sweat (added cc, bcc and subject functionality)
+ * @param    array
+ * @param    Smarty
+ * @return   string
+ */
+function smarty_function_mailto($params, &$smarty)
+{
+    $extra = '';
+    if (empty($params['address'])) {
+        $smarty->trigger_error("mailto: missing 'address' parameter");
+        return;
+    } else {
+        $address = $params['address'];
+    }
+    $text = $address;
+    $search = array('%40', '%2C');
+    $replace  = array('@', ',');
+    $mail_parms = array();
+    foreach ($params as $var=>$value) {
+        switch ($var) {
+            case 'cc':
+            case 'bcc':
+            case 'followupto':
+                if (!empty($value))
+                    $mail_parms[] = $var.'='.str_replace($search,$replace,rawurlencode($value));
+                break;
+            case 'subject':
+            case 'newsgroups':
+                $mail_parms[] = $var.'='.rawurlencode($value);
+                break;
+            case 'extra':
+            case 'text':
+                $$var = $value;
+            default:
+        }
+    }
+    $mail_parm_vals = '';
+    for ($i=0; $i<count($mail_parms); $i++) {
+        $mail_parm_vals .= (0==$i) ? '?' : '&';
+        $mail_parm_vals .= $mail_parms[$i];
+    }
+    $address .= $mail_parm_vals;
+    $encode = (empty($params['encode'])) ? 'none' : $params['encode'];
+    if (!in_array($encode,array('javascript','javascript_charcode','hex','none')) ) {
+        $smarty->trigger_error("mailto: 'encode' parameter must be none, javascript or hex");
+        return;
+    }
+    if ($encode == 'javascript' ) {
+        $string = 'document.write(\'<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>\');';
+        $js_encode = '';
+        for ($x=0; $x < strlen($string); $x++) {
+            $js_encode .= '%' . bin2hex($string[$x]);
+        }
+        return '<script type="text/javascript">eval(unescape(\''.$js_encode.'\'))</script>';
+    } elseif ($encode == 'javascript_charcode' ) {
+        $string = '<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>';
+        for($x = 0, $y = strlen($string); $x < $y; $x++ ) {
+            $ord[] = ord($string[$x]);   
+        }
+        $_ret = "<script type=\"text/javascript\" language=\"javascript\">\n";
+        $_ret .= "<!--\n";
+        $_ret .= "{document.write(String.fromCharCode(";
+        $_ret .= implode(',',$ord);
+        $_ret .= "))";
+        $_ret .= "}\n";
+        $_ret .= "//-->\n";
+        $_ret .= "</script>\n";
+        return $_ret;
+    } elseif ($encode == 'hex') {
+        preg_match('!^(.*)(\?.*)$!',$address,$match);
+        if(!empty($match[2])) {
+            $smarty->trigger_error("mailto: hex encoding does not work with extra attributes. Try javascript.");
+            return;
+        }
+        $address_encode = '';
+        for ($x=0; $x < strlen($address); $x++) {
+            if(preg_match('!\w!',$address[$x])) {
+                $address_encode .= '%' . bin2hex($address[$x]);
+            } else {
+                $address_encode .= $address[$x];
+            }
+        }
+        $text_encode = '';
+        for ($x=0; $x < strlen($text); $x++) {
+            $text_encode .= '&#x' . bin2hex($text[$x]).';';
+        }
+        $mailto = "&#109;&#97;&#105;&#108;&#116;&#111;&#58;";
+        return '<a href="'.$mailto.$address_encode.'" '.$extra.'>'.$text_encode.'</a>';
+    } else {
+        return '<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>';
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.math.php
@@ -0,0 +1,69 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {math} function plugin
+ *
+ * Type:     function<br />
+ * Name:     math<br />
+ * Purpose:  handle math computations in template<br />
+ * @link http://smarty.php.net/manual/en/language.function.math.php {math}
+ *          (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string
+ */
+function smarty_function_math($params, &$smarty)
+{
+    if (empty($params['equation'])) {
+        $smarty->trigger_error("math: missing equation parameter");
+        return;
+    }
+    $equation = $params['equation'];
+    if (substr_count($equation,"(") != substr_count($equation,")")) {
+        $smarty->trigger_error("math: unbalanced parenthesis");
+        return;
+    }
+    preg_match_all("!(?:0x[a-fA-F0-9]+)|([a-zA-Z][a-zA-Z0-9_]+)!",$equation, $match);
+    $allowed_funcs = array('int','abs','ceil','cos','exp','floor','log','log10',
+                           'max','min','pi','pow','rand','round','sin','sqrt','srand','tan');
+    foreach($match[1] as $curr_var) {
+        if ($curr_var && !in_array($curr_var, array_keys($params)) && !in_array($curr_var, $allowed_funcs)) {
+            $smarty->trigger_error("math: function call $curr_var not allowed");
+            return;
+        }
+    }
+    foreach($params as $key => $val) {
+        if ($key != "equation" && $key != "format" && $key != "assign") {
+            if (strlen($val)==0) {
+                $smarty->trigger_error("math: parameter $key is empty");
+                return;
+            }
+            if (!is_numeric($val)) {
+                $smarty->trigger_error("math: parameter $key: is not numeric");
+                return;
+            }
+            $equation = preg_replace("/\b$key\b/", " \$params['$key'] ", $equation);
+        }
+    }
+    eval("\$smarty_math_result = ".$equation.";");
+    if (empty($params['format'])) {
+        if (empty($params['assign'])) {
+            return $smarty_math_result;
+        } else {
+            $smarty->assign($params['assign'],$smarty_math_result);
+        }
+    } else {
+        if (empty($params['assign'])){
+            printf($params['format'],$smarty_math_result);
+        } else {
+            $smarty->assign($params['assign'],sprintf($params['format'],$smarty_math_result));
+        }
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.popup.php
@@ -0,0 +1,105 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {popup} function plugin
+ *
+ * Type:     function<br />
+ * Name:     popup<br />
+ * Purpose:  make text pop up in windows via overlib
+ * @link http://smarty.php.net/manual/en/language.function.popup.php {popup}
+ *          (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string
+ */
+function smarty_function_popup($params, &$smarty)
+{
+    $append = '';
+    foreach ($params as $_key=>$_value) {
+        switch ($_key) {
+            case 'text':
+            case 'trigger':
+            case 'function':
+            case 'inarray':
+                $$_key = (string)$_value;
+                if ($_key == 'function' || $_key == 'inarray')
+                    $append .= ',' . strtoupper($_key) . ",'$_value'";
+                break;
+            case 'caption':
+            case 'closetext':
+            case 'status':
+                $append .= ',' . strtoupper($_key) . ",'" . str_replace("'","\'",$_value) . "'";
+                break;
+            case 'fgcolor':
+            case 'bgcolor':
+            case 'textcolor':
+            case 'capcolor':
+            case 'closecolor':
+            case 'textfont':
+            case 'captionfont':
+            case 'closefont':
+            case 'fgbackground':
+            case 'bgbackground':
+            case 'caparray':
+            case 'capicon':
+            case 'background':
+            case 'frame':
+                $append .= ',' . strtoupper($_key) . ",'$_value'";
+                break;
+            case 'textsize':
+            case 'captionsize':
+            case 'closesize':
+            case 'width':
+            case 'height':
+            case 'border':
+            case 'offsetx':
+            case 'offsety':
+            case 'snapx':
+            case 'snapy':
+            case 'fixx':
+            case 'fixy':
+            case 'padx':
+            case 'pady':
+            case 'timeout':
+            case 'delay':
+                $append .= ',' . strtoupper($_key) . ",$_value";
+                break;
+            case 'sticky':
+            case 'left':
+            case 'right':
+            case 'center':
+            case 'above':
+            case 'below':
+            case 'noclose':
+            case 'autostatus':
+            case 'autostatuscap':
+            case 'fullhtml':
+            case 'hauto':
+            case 'vauto':
+            case 'mouseoff':
+            case 'followmouse':
+            case 'closeclick':
+                if ($_value) $append .= ',' . strtoupper($_key);
+                break;
+            default:
+                $smarty->trigger_error("[popup] unknown parameter $_key", E_USER_WARNING);
+        }
+    }
+    if (empty($text) && !isset($inarray) && empty($function)) {
+        $smarty->trigger_error("overlib: attribute 'text' or 'inarray' or 'function' required");
+        return false;
+    }
+    if (empty($trigger)) { $trigger = "onmouseover"; }
+    $retval = $trigger . '="return overlib(\''.preg_replace(array("!'!","![\r\n]!"),array("\'",'\r'),$text).'\'';
+    $retval .= $append . ');"';
+    if ($trigger == 'onmouseover')
+       $retval .= ' onmouseout="nd();"';
+    return $retval;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/function.popup_init.php
@@ -0,0 +1,34 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty {popup_init} function plugin
+ *
+ * Type:     function<br />
+ * Name:     popup_init<br />
+ * Purpose:  initialize overlib
+ * @link http://smarty.php.net/manual/en/language.function.popup.init.php {popup_init}
+ *          (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param array
+ * @param Smarty
+ * @return string
+ */
+function smarty_function_popup_init($params, &$smarty)
+{
+    $zindex = 1000;
+    if (!empty($params['zindex'])) {
+        $zindex = $params['zindex'];
+    }
+    if (!empty($params['src'])) {
+        return '<div id="overDiv" style="position:absolute; visibility:hidden; z-index:'.$zindex.';"></div>' . "\n"
+         . '<script type="text/javascript" language="JavaScript" src="'.$params['src'].'"></script>' . "\n";
+    } else {
+        $smarty->trigger_error("popup_init: missing src parameter");
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.capitalize.php
@@ -0,0 +1,36 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty capitalize modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     capitalize<br />
+ * Purpose:  capitalize words in the string
+ * @link http://smarty.php.net/manual/en/language.modifiers.php#LANGUAGE.MODIFIER.CAPITALIZE
+ *      capitalize (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_modifier_capitalize($string, $uc_digits = false)
+{
+    smarty_modifier_capitalize_ucfirst(null, $uc_digits);
+    return preg_replace_callback('!\'?\b\w(\w|\')*\b!', 'smarty_modifier_capitalize_ucfirst', $string);
+}
+function smarty_modifier_capitalize_ucfirst($string, $uc_digits = null)
+{
+    static $_uc_digits = false;
+    if(isset($uc_digits)) {
+        $_uc_digits = $uc_digits;
+        return;
+    }
+    if(substr($string[0],0,1) != "'" && !preg_match("!\d!",$string[0]) || $_uc_digits)
+        return ucfirst($string[0]);
+    else
+        return $string[0];
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.cat.php
@@ -0,0 +1,29 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty cat modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     cat<br />
+ * Date:     Feb 24, 2003
+ * Purpose:  catenate a value to a variable
+ * Input:    string to catenate
+ * Example:  {$var|cat:"foo"}
+ * @link http://smarty.php.net/manual/en/language.modifier.cat.php cat
+ *          (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @version 1.0
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_cat($string, $cat)
+{
+    return $string . $cat;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.count_characters.php
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty count_characters modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     count_characteres<br />
+ * Purpose:  count the number of characters in a text
+ * @link http://smarty.php.net/manual/en/language.modifier.count.characters.php
+ *          count_characters (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param boolean include whitespace in the character count
+ * @return integer
+ */
+function smarty_modifier_count_characters($string, $include_spaces = false)
+{
+    if ($include_spaces)
+       return(strlen($string));
+    return preg_match_all("/[^\s]/",$string, $match);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.count_paragraphs.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty count_paragraphs modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     count_paragraphs<br />
+ * Purpose:  count the number of paragraphs in a text
+ * @link http://smarty.php.net/manual/en/language.modifier.count.paragraphs.php
+ *          count_paragraphs (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return integer
+ */
+function smarty_modifier_count_paragraphs($string)
+{
+    return count(preg_split('/[\r\n]+/', $string));
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.count_sentences.php
@@ -0,0 +1,24 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty count_sentences modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     count_sentences
+ * Purpose:  count the number of sentences in a text
+ * @link http://smarty.php.net/manual/en/language.modifier.count.paragraphs.php
+ *          count_sentences (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return integer
+ */
+function smarty_modifier_count_sentences($string)
+{
+    return preg_match_all('/[^\s]\.(?!\w)/', $string, $match);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.count_words.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty count_words modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     count_words<br />
+ * Purpose:  count the number of words in a text
+ * @link http://smarty.php.net/manual/en/language.modifier.count.words.php
+ *          count_words (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return integer
+ */
+function smarty_modifier_count_words($string)
+{
+    $preg_split_array = preg_split('/\s+/',$string);
+    $word_count = preg_grep('/[a-zA-Z0-9\\x80-\\xff]/', $preg_split_array);
+    return count($word_count);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.date_format.php
@@ -0,0 +1,55 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Include the {@link shared.make_timestamp.php} plugin
+ */
+require_once $smarty->_get_plugin_filepath('shared', 'make_timestamp');
+/**
+ * Smarty date_format modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     date_format<br />
+ * Purpose:  format datestamps via strftime<br />
+ * Input:<br />
+ *         - string: input date string
+ *         - format: strftime format for output
+ *         - default_date: default date if $string is empty
+ * @link http://smarty.php.net/manual/en/language.modifier.date.format.php
+ *          date_format (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string
+ * @param string
+ * @return string|void
+ * @uses smarty_make_timestamp()
+ */
+function smarty_modifier_date_format($string, $format = '%b %e, %Y', $default_date = '')
+{
+    if ($string != '') {
+        $timestamp = smarty_make_timestamp($string);
+    } elseif ($default_date != '') {
+        $timestamp = smarty_make_timestamp($default_date);
+    } else {
+        return;
+    }
+    if (DIRECTORY_SEPARATOR == '\\') {
+        $_win_from = array('%D',       '%h', '%n', '%r',          '%R',    '%t', '%T');
+        $_win_to   = array('%m/%d/%y', '%b', "\n", '%I:%M:%S %p', '%H:%M', "\t", '%H:%M:%S');
+        if (strpos($format, '%e') !== false) {
+            $_win_from[] = '%e';
+            $_win_to[]   = sprintf('%\' 2d', date('j', $timestamp));
+        }
+        if (strpos($format, '%l') !== false) {
+            $_win_from[] = '%l';
+            $_win_to[]   = sprintf('%\' 2d', date('h', $timestamp));
+        }
+        $format = str_replace($_win_from, $_win_to, $format);
+    }
+    return strftime($format, $timestamp);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.debug_print_var.php
@@ -0,0 +1,84 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty debug_print_var modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     debug_print_var<br />
+ * Purpose:  formats variable contents for display in the console
+ * @link http://smarty.php.net/manual/en/language.modifier.debug.print.var.php
+ *          debug_print_var (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param array|object
+ * @param integer
+ * @param integer
+ * @return string
+ */
+function smarty_modifier_debug_print_var($var, $depth = 0, $length = 40)
+{
+    $_replace = array(
+        "\n" => '<i>\n</i>',
+        "\r" => '<i>\r</i>',
+        "\t" => '<i>\t</i>'
+    );
+    switch (gettype($var)) {
+        case 'array' :
+            $results = '<b>Array (' . count($var) . ')</b>';
+            foreach ($var as $curr_key => $curr_val) {
+                $results .= '<br />' . str_repeat('&nbsp;', $depth * 2)
+                    . '<b>' . strtr($curr_key, $_replace) . '</b> =&gt; '
+                    . smarty_modifier_debug_print_var($curr_val, ++$depth, $length);
+                    $depth--;
+            }
+            break;
+        case 'object' :
+            $object_vars = get_object_vars($var);
+            $results = '<b>' . get_class($var) . ' Object (' . count($object_vars) . ')</b>';
+            foreach ($object_vars as $curr_key => $curr_val) {
+                $results .= '<br />' . str_repeat('&nbsp;', $depth * 2)
+                    . '<b> -&gt;' . strtr($curr_key, $_replace) . '</b> = '
+                    . smarty_modifier_debug_print_var($curr_val, ++$depth, $length);
+                    $depth--;
+            }
+            break;
+        case 'boolean' :
+        case 'NULL' :
+        case 'resource' :
+            if (true === $var) {
+                $results = 'true';
+            } elseif (false === $var) {
+                $results = 'false';
+            } elseif (null === $var) {
+                $results = 'null';
+            } else {
+                $results = htmlspecialchars((string) $var);
+            }
+            $results = '<i>' . $results . '</i>';
+            break;
+        case 'integer' :
+        case 'float' :
+            $results = htmlspecialchars((string) $var);
+            break;
+        case 'string' :
+            $results = strtr($var, $_replace);
+            if (strlen($var) > $length ) {
+                $results = substr($var, 0, $length - 3) . '...';
+            }
+            $results = htmlspecialchars('"' . $results . '"');
+            break;
+        case 'unknown type' :
+        default :
+            $results = strtr((string) $var, $_replace);
+            if (strlen($results) > $length ) {
+                $results = substr($results, 0, $length - 3) . '...';
+            }
+            $results = htmlspecialchars($results);
+    }
+    return $results;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.default.php
@@ -0,0 +1,28 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty default modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     default<br />
+ * Purpose:  designate default value for empty variables
+ * @link http://smarty.php.net/manual/en/language.modifier.default.php
+ *          default (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_default($string, $default = '')
+{
+    if (!isset($string) || $string === '')
+        return $default;
+    else
+        return $string;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.escape.php
@@ -0,0 +1,72 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty escape modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     escape<br />
+ * Purpose:  Escape the string according to escapement type
+ * @link http://smarty.php.net/manual/en/language.modifier.escape.php
+ *          escape (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param html|htmlall|url|quotes|hex|hexentity|javascript
+ * @return string
+ */
+function smarty_modifier_escape($string, $esc_type = 'html', $char_set = 'ISO-8859-1')
+{
+    switch ($esc_type) {
+        case 'html':
+            return htmlspecialchars($string, ENT_QUOTES, $char_set);
+        case 'htmlall':
+            return htmlentities($string, ENT_QUOTES, $char_set);
+        case 'url':
+            return rawurlencode($string);
+        case 'urlpathinfo':
+            return str_replace('%2F','/',rawurlencode($string));
+        case 'quotes':
+            return preg_replace("%(?<!\\\\)'%", "\\'", $string);
+        case 'hex':
+            $return = '';
+            for ($x=0; $x < strlen($string); $x++) {
+                $return .= '%' . bin2hex($string[$x]);
+            }
+            return $return;
+        case 'hexentity':
+            $return = '';
+            for ($x=0; $x < strlen($string); $x++) {
+                $return .= '&#x' . bin2hex($string[$x]) . ';';
+            }
+            return $return;
+        case 'decentity':
+            $return = '';
+            for ($x=0; $x < strlen($string); $x++) {
+                $return .= '&#' . ord($string[$x]) . ';';
+            }
+            return $return;
+        case 'javascript':
+            return strtr($string, array('\\'=>'\\\\',"'"=>"\\'",'"'=>'\\"',"\r"=>'\\r',"\n"=>'\\n','</'=>'<\/'));
+        case 'mail':
+            return str_replace(array('@', '.'),array(' [AT] ', ' [DOT] '), $string);
+        case 'nonstd':
+           $_res = '';
+           for($_i = 0, $_len = strlen($string); $_i < $_len; $_i++) {
+               $_ord = ord(substr($string, $_i, 1));
+               if($_ord >= 126){
+                   $_res .= '&#' . $_ord . ';';
+               }
+               else {
+                   $_res .= substr($string, $_i, 1);
+               }
+           }
+           return $_res;
+        default:
+            return $string;
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.indent.php
@@ -0,0 +1,25 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty indent modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     indent<br />
+ * Purpose:  indent lines of text
+ * @link http://smarty.php.net/manual/en/language.modifier.indent.php
+ *          indent (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param integer
+ * @param string
+ * @return string
+ */
+function smarty_modifier_indent($string,$chars=4,$char=" ")
+{
+    return preg_replace('!^!m',str_repeat($char,$chars),$string);
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.lower.php
@@ -0,0 +1,23 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty lower modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     lower<br />
+ * Purpose:  convert string to lowercase
+ * @link http://smarty.php.net/manual/en/language.modifier.lower.php
+ *          lower (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_modifier_lower($string)
+{
+    return strtolower($string);
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.nl2br.php
@@ -0,0 +1,31 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty plugin
+ *
+ * Type:     modifier<br />
+ * Name:     nl2br<br />
+ * Date:     Feb 26, 2003
+ * Purpose:  convert \r\n, \r or \n to <<br />>
+ * Input:<br />
+ *         - contents = contents to replace
+ *         - preceed_test = if true, includes preceeding break tags
+ *           in replacement
+ * Example:  {$text|nl2br}
+ * @link http://smarty.php.net/manual/en/language.modifier.nl2br.php
+ *          nl2br (Smarty online manual)
+ * @version  1.0
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_modifier_nl2br($string)
+{
+    return nl2br($string);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.regex_replace.php
@@ -0,0 +1,30 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty regex_replace modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     regex_replace<br />
+ * Purpose:  regular expression search/replace
+ * @link http://smarty.php.net/manual/en/language.modifier.regex.replace.php
+ *          regex_replace (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string|array
+ * @param string|array
+ * @return string
+ */
+function smarty_modifier_regex_replace($string, $search, $replace)
+{
+    if (preg_match('!([a-zA-Z\s]+)$!s', $search, $match) && (strpos($match[1], 'e') !== false)) {
+        /* remove eval-modifier from $search */
+        $search = substr($search, 0, -strlen($match[1])) . preg_replace('![e\s]+!', '', $match[1]);
+    }
+    return preg_replace($search, $replace, $string);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.replace.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty replace modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     replace<br />
+ * Purpose:  simple search/replace
+ * @link http://smarty.php.net/manual/en/language.modifier.replace.php
+ *          replace (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_replace($string, $search, $replace)
+{
+    return str_replace($search, $replace, $string);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.spacify.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty spacify modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     spacify<br />
+ * Purpose:  add spaces between characters in a string
+ * @link http://smarty.php.net/manual/en/language.modifier.spacify.php
+ *          spacify (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_spacify($string, $spacify_char = ' ')
+{
+    return implode($spacify_char,
+                   preg_split('//', $string, -1, preg_split_NO_EMPTY));
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.string_format.php
@@ -0,0 +1,25 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty string_format modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     string_format<br />
+ * Purpose:  format strings via sprintf
+ * @link http://smarty.php.net/manual/en/language.modifier.string.format.php
+ *          string_format (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_string_format($string, $format)
+{
+    return sprintf($format, $string);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.strip.php
@@ -0,0 +1,29 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty strip modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     strip<br />
+ * Purpose:  Replace all repeated spaces, newlines, tabs
+ *           with a single space or supplied replacement string.<br />
+ * Example:  {$var|strip} {$var|strip:"&nbsp;"}
+ * Date:     September 25th, 2002
+ * @link http://smarty.php.net/manual/en/language.modifier.strip.php
+ *          strip (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @version  1.0
+ * @param string
+ * @param string
+ * @return string
+ */
+function smarty_modifier_strip($text, $replace = ' ')
+{
+    return preg_replace('!\s+!', $replace, $text);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.strip_tags.php
@@ -0,0 +1,28 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty strip_tags modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     strip_tags<br />
+ * Purpose:  strip html tags from text
+ * @link http://smarty.php.net/manual/en/language.modifier.strip.tags.php
+ *          strip_tags (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param boolean
+ * @return string
+ */
+function smarty_modifier_strip_tags($string, $replace_with_space = true)
+{
+    if ($replace_with_space)
+        return preg_replace('!<[^>]*?>!', ' ', $string);
+    else
+        return strip_tags($string);
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.truncate.php
@@ -0,0 +1,45 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty truncate modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     truncate<br />
+ * Purpose:  Truncate a string to a certain length if necessary,
+ *           optionally preg_splitting in the middle of a word, and
+ *           appending the $etc string or inserting $etc into the middle.
+ * @link http://smarty.php.net/manual/en/language.modifier.truncate.php
+ *          truncate (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param integer
+ * @param string
+ * @param boolean
+ * @param boolean
+ * @return string
+ */
+function smarty_modifier_truncate($string, $length = 80, $etc = '...',
+                                  $break_words = false, $middle = false)
+{
+    if ($length == 0)
+        return '';
+    if (strlen($string) > $length) {
+        $length -= min($length, strlen($etc));
+        if (!$break_words && !$middle) {
+            $string = preg_replace('/\s+?(\S+)?$/', '', substr($string, 0, $length+1));
+        }
+        if(!$middle) {
+            return substr($string, 0, $length) . $etc;
+        } else {
+            return substr($string, 0, $length/2) . $etc . substr($string, -$length/2);
+        }
+    } else {
+        return $string;
+    }
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.upper.php
@@ -0,0 +1,23 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty upper modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     upper<br />
+ * Purpose:  convert string to uppercase
+ * @link http://smarty.php.net/manual/en/language.modifier.upper.php
+ *          upper (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_modifier_upper($string)
+{
+    return strtoupper($string);
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/modifier.wordwrap.php
@@ -0,0 +1,26 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty wordwrap modifier plugin
+ *
+ * Type:     modifier<br />
+ * Name:     wordwrap<br />
+ * Purpose:  wrap a string of text at a given length
+ * @link http://smarty.php.net/manual/en/language.modifier.wordwrap.php
+ *          wordwrap (Smarty online manual)
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @param integer
+ * @param string
+ * @param boolean
+ * @return string
+ */
+function smarty_modifier_wordwrap($string,$length=80,$break="\n",$cut=false)
+{
+    return wordwrap($string,$length,$break,$cut);
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/outputfilter.trimwhitespace.php
@@ -0,0 +1,56 @@
+<?php
+/**
+ * Smarty plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Smarty trimwhitespace outputfilter plugin
+ *
+ * File:     outputfilter.trimwhitespace.php<br />
+ * Type:     outputfilter<br />
+ * Name:     trimwhitespace<br />
+ * Date:     Jan 25, 2003<br />
+ * Purpose:  trim leading white space and blank lines from
+ *           template source after it gets interpreted, cleaning
+ *           up code and saving bandwidth. Does not affect
+ *           <<PRE>></PRE> and <SCRIPT></SCRIPT> blocks.<br />
+ * Install:  Drop into the plugin directory, call
+ *           <code>$smarty->load_filter('output','trimwhitespace');</code>
+ *           from application.
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @author Contributions from Lars Noschinski <lars@usenet.noschinski.de>
+ * @version  1.3
+ * @param string
+ * @param Smarty
+ */
+function smarty_outputfilter_trimwhitespace($source, &$smarty)
+{
+    preg_match_all("!<script[^>]+>.*?</script>!is", $source, $match);
+    $_script_blocks = $match[0];
+    $source = preg_replace("!<script[^>]+>.*?</script>!is",
+                           '@@@SMARTY:TRIM:SCRIPT@@@', $source);
+    preg_match_all("!<pre>.*?</pre>!is", $source, $match);
+    $_pre_blocks = $match[0];
+    $source = preg_replace("!<pre>.*?</pre>!is",
+                           '@@@SMARTY:TRIM:PRE@@@', $source);
+    preg_match_all("!<textarea[^>]+>.*?</textarea>!is", $source, $match);
+    $_textarea_blocks = $match[0];
+    $source = preg_replace("!<textarea[^>]+>.*?</textarea>!is",
+                           '@@@SMARTY:TRIM:TEXTAREA@@@', $source);
+    $source = trim(preg_replace('/((?<!\?>)\n)[\s]+/m', '\1', $source));
+    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:TEXTAREA@@@",$_textarea_blocks, $source);
+    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:PRE@@@",$_pre_blocks, $source);
+    smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:SCRIPT@@@",$_script_blocks, $source);
+    return $source;
+}
+function smarty_outputfilter_trimwhitespace_replace($search_str, $replace, &$subject) {
+    $_len = strlen($search_str);
+    $_pos = 0;
+    for ($_i=0, $_count=count($replace); $_i<$_count; $_i++)
+        if (($_pos=strpos($subject, $search_str, $_pos))!==false)
+            $subject = substr_replace($subject, $replace[$_i], $_pos, $_len);
+        else
+            break;
+}
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/shared.escape_special_chars.php
@@ -0,0 +1,27 @@
+<?php
+/**
+ * Smarty shared plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * escape_special_chars common function
+ *
+ * Function: smarty_function_escape_special_chars<br />
+ * Purpose:  used by other smarty functions to escape
+ *           special chars except for already escaped ones
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_function_escape_special_chars($string)
+{
+    if(!is_array($string)) {
+        $string = preg_replace('!&(#?\w+);!', '%%%SMARTY_START%%%\\1%%%SMARTY_END%%%', $string);
+        $string = htmlspecialchars($string);
+        $string = str_replace(array('%%%SMARTY_START%%%','%%%SMARTY_END%%%'), array('&',';'), $string);
+    }
+    return $string;
+}
+/* vim: set expandtab: */
+?>

--- a//dev/null
+++ b/GPL_LIB/Smarty/libs/plugins/shared.make_timestamp.php
@@ -0,0 +1,33 @@
+<?php
+/**
+ * Smarty shared plugin
+ * @package Smarty
+ * @subpackage plugins
+ */
+/**
+ * Function: smarty_make_timestamp<br />
+ * Purpose:  used by other smarty functions to make a timestamp
+ *           from a string.
+ * @author   Monte Ohrt <monte at ohrt dot com>
+ * @param string
+ * @return string
+ */
+function smarty_make_timestamp($string)
+{
+    if(empty($string)) {
+        $time = time();
+    } elseif (preg_match('/^\d{14}$/', $string)) {
+        $time = mktime(substr($string, 8, 2),substr($string, 10, 2),substr($string, 12, 2),
+                       substr($string, 4, 2),substr($string, 6, 2),substr($string, 0, 4));
+    } elseif (is_numeric($string)) {
+        $time = (int)$string;
+    } else {
+        $time = strtotime($string);
+        if ($time == -1 || $time === false) {
+            $time = time();
+        }
+    }
+    return $time;
+}
+/* vim: set expandtab: */
+?>

--- a/bin/centreond/centreon/centreond/clientzmq.pm
+++ b//dev/null
@@ -1,145 +0,0 @@
-package centreon::centreond::clientzmq;
-use strict;
-use warnings;
-use centreon::centreond::common;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-my $connectors = {};
-my $callbacks = {};
-my $sockets = {};
-my $polls = {};
-sub new {
-    my ($class, %options) = @_;
-    my $connector  = {};
-    $connector->{logger} = $options{logger};
-    $connector->{identity} = $options{identity};
-    $connector->{cipher} = $options{cipher};
-    $connector->{vector} = $options{vector};
-    $connector->{symkey} = undef;
-    $connector->{pubkey} = centreon::centreond::common::loadpubkey(pubkey => $options{pubkey});
-    $connector->{target_type} = $options{target_type};
-    $connector->{target_path} = $options{target_path};
-    $connector->{ping} = defined($options{ping}) ? $options{ping} : -1;
-    $connector->{ping_timeout} = defined($options{ping_timeout}) ? $options{ping_timeout} : 30;
-    $connector->{ping_progress} = 0; 
-    $connector->{ping_time} = time();
-    $connector->{ping_timeout_time} = time();
-    $connectors->{$options{identity}} = $connector;
-    bless $connector, $class;
-    return $connector;
-}
-sub init {
-    my ($self, %options) = @_;
-    $self->{handshake} = 0;
-    $sockets->{$self->{identity}} = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => $self->{identity},
-                                                                             logger => $self->{logger},
-                                                                             type => $self->{target_type},
-                                                                             path => $self->{target_path});
-    $callbacks->{$self->{identity}} = $options{callback} if (defined($options{callback}));
-}
-sub close {
-    my ($self, %options) = @_;
-    zmq_close($sockets->{$self->{identity}});
-}
-sub is_connected {
-    my ($self, %options) = @_;
-    if ($self->{handshake} == 2) {
-        return (0, $self->{ping_time});
-    }
-    return -1;
-}
-sub ping {
-    my ($self, %options) = @_;
-    my $status = 0;
-    if ($self->{ping} > 0 && $self->{ping_progress} == 0 && 
-        time() - $self->{ping_time} > $self->{ping}) {
-        $self->{ping_progress} = 1;
-        $self->{ping_timeout_time} = time();
-        my $action = defined($options{action}) ? $options{action} : 'PING';
-        $self->send_message(action => $action, data => $options{data}, json_encode => $options{json_encode});
-        $status = 1;
-    }
-    if ($self->{ping_progress} == 1 && 
-        time() - $self->{ping_timeout_time} > $self->{ping_timeout}) {
-        $self->{logger}->writeLogError("no ping response") if (defined($self->{logger}));
-        $self->{ping_progress} = 0;
-        zmq_close($sockets->{$self->{identity}});
-        $self->init();
-        push @{$options{poll}}, $self->get_poll();
-        $status = 1;
-    }
-    push @{$options{poll}}, $self->get_poll();
-    return $status;
-}
-sub get_poll {
-    my ($self, %options) = @_;
-    $polls->{$sockets->{$self->{identity}}} = {
-            socket  => $sockets->{$self->{identity}},
-            events  => ZMQ_POLLIN,
-            callback => sub {
-                event(identity => $self->{identity});
-            }
-    };
-    return $polls->{$sockets->{$self->{identity}}};
-}
-sub event {
-    my (%options) = @_;
-    if ($connectors->{$options{identity}}->{ping_progress} == 1) {
-        $connectors->{$options{identity}}->{ping_progress} = 0;
-    }
-    $connectors->{$options{identity}}->{ping_time} = time();
-    while (1) {
-        my $message = centreon::centreond::common::zmq_dealer_read_message(socket => $sockets->{$options{identity}});
-        if ($connectors->{$options{identity}}->{handshake} == 0 || $connectors->{$options{identity}}->{handshake} == 1) {
-            my ($status, $symkey, $hostname) = centreon::centreond::common::client_get_secret(pubkey => $connectors->{$options{identity}}->{pubkey},
-                                                                                              message => $message);
-            if ($status == -1) {
-                $connectors->{$options{identity}}->{handshake} = 0;
-                return ;
-            }
-            $connectors->{$options{identity}}->{symkey} = $symkey;
-            $connectors->{$options{identity}}->{handshake} = 2;
-            if (defined($connectors->{$options{identity}}->{logger})) {
-                $connectors->{$options{identity}}->{logger}->writeLogInfo("Client connected successfuly to '" . $connectors->{$options{identity}}->{target_type} . '//' . $connectors->{$options{identity}}->{target_path});
-            }
-        } else {
-            my ($status, $data) = centreon::centreond::common::uncrypt_message(message => $message, 
-                                                                               cipher => $connectors->{$options{identity}}->{cipher}, 
-                                                                               vector => $connectors->{$options{identity}}->{vector}, symkey => $connectors->{$options{identity}}->{symkey});            
-            if ($status == -1 || $data !~ /^\[(.+?)\]\s+\[(.*?)\]\s+(?:\[(.*?)\]\s*(.*)|(.*))$/m) {
-                $connectors->{$options{identity}}->{handshake} = 0;
-                return ;
-            }
-            if (defined($callbacks->{$options{identity}})) {
-                $callbacks->{$options{identity}}->(identity => $options{identity}, data => $data);
-            }
-        }
-        last unless (centreon::centreond::common::zmq_still_read(socket => $sockets->{$options{identity}}));
-    }
-}
-sub send_message {
-    my ($self, %options) = @_;
-    if ($self->{handshake} == 0) {
-        my $message = '[HELO] [' . $self->{identity} . ']';
-        my ($status, $ciphertext) = centreon::centreond::common::client_helo_encrypt(pubkey => $self->{pubkey},
-                                                                                     message => $message);
-        if ($status == -1) {
-            return (-1, 'crypt handshake issue'); 
-        }
-        $self->{handshake} = 1;
-        zmq_sendmsg($sockets->{$self->{identity}}, $ciphertext);
-        zmq_poll([$self->get_poll()], 10000);
-    }
-    if ($self->{handshake} == 1) {
-        $self->{handshake} = 0;
-        return (-1, 'Handshake timeout');
-    }
-    if ($self->{handshake} == 0) {
-        return (-1, 'Handshake issue');
-    }
-    centreon::centreond::common::zmq_send_message(socket => $sockets->{$self->{identity}},
-        cipher => $self->{cipher}, symkey => $self->{symkey}, vector => $self->{vector},
-        %options);
-    return 0;
-}
-1;

--- a/bin/centreond/centreon/centreond/common.pm
+++ b//dev/null
@@ -1,406 +0,0 @@
-package centreon::centreond::common;
-use strict;
-use warnings;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-use JSON;
-use File::Basename;
-use Config::IniFiles;
-use Crypt::OpenSSL::RSA;
-use Crypt::OpenSSL::Random;
-use Crypt::CBC;
-use Data::Dumper;
-my %zmq_type = ('ZMQ_ROUTER' => ZMQ_ROUTER, 'ZMQ_DEALER' => ZMQ_DEALER);
-my $privkey;
-sub read_config {
-    my (%options) = @_;
-    my %config;
-    tie %config, 'Config::IniFiles', (-file => $options{config_file});
-    if (defined(@Config::IniFiles::errors)) {
-        $options{logger}->writeLogError("Parsinig extra config file error:");
-        $options{logger}->writeLogError(join("\n", @Config::IniFiles::errors));
-        exit(1);
-    }
-    return \%config;
-}
-sub loadpubkey {
-    my (%options) = @_;
-    my $string_key = '';
-    if (!open FILE, "<" . $options{pubkey}) {
-        $options{logger}->writeLogError("Cannot read file '$options{pubkey}': $!");
-        exit(1);
-    }
-    while (<FILE>) {
-        $string_key .= $_;
-    }
-    close FILE;
-    my $pubkey;
-    eval {
-        $pubkey = Crypt::OpenSSL::RSA->new_public_key($string_key);
-        $pubkey->use_pkcs1_padding();
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot load privkey '$options{pubkey}': $@");
-        exit(1);
-    }
-    return $pubkey;
-}
-sub loadprivkey {
-    my (%options) = @_;
-    my $string_key = '';
-    if (!open FILE, "<" . $options{privkey}) {
-        $options{logger}->writeLogError("Cannot read file '$options{privkey}': $!");
-        exit(1);
-    }
-    while (<FILE>) {
-        $string_key .= $_;
-    }
-    close FILE;
-    eval {
-        $privkey = Crypt::OpenSSL::RSA->new_private_key($string_key);
-        $privkey->use_pkcs1_padding();
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot load privkey '$options{privkey}': $@");
-        exit(1);
-    }
-}
-sub zmq_core_key_response {
-    my (%options) = @_;
-    if (defined($options{identity})) {
-        zmq_sendmsg($options{socket}, pack('H*', $options{identity}), ZMQ_NOBLOCK | ZMQ_SNDMORE);
-    }
-    my $crypttext;
-    eval {
-        $crypttext = $privkey->private_encrypt("[KEY] [$options{hostname}] [" . $options{symkey} . "]");
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Encoding issue: " .  $@);
-        return -1;
-    }
-    zmq_sendmsg($options{socket}, $crypttext, ZMQ_NOBLOCK);
-    return 0;
-}
-sub zmq_core_response {
-    my (%options) = @_;
-    my $msg;
-    my $response_type = defined($options{response_type}) ? $options{response_type} : 'ACK';
-    if (defined($options{identity})) {
-        zmq_sendmsg($options{socket}, pack('H*', $options{identity}), ZMQ_NOBLOCK | ZMQ_SNDMORE);
-    }
-    my $data = json_encode(data => { code => $options{code}, data => $options{data} });
-    $msg = '[' . $response_type . '] [' . (defined($options{token}) ? $options{token} : '') . '] ' . ($response_type eq 'PONG' ? '[] ' : '') . $data;
-    if (defined($options{cipher})) {
-        my $cipher = Crypt::CBC->new(-key    => $options{symkey},
-                                     -keysize => length($options{symkey}),
-                                     -cipher => $options{cipher},
-                                     -iv => $options{vector},
-                                     -header => 'none',
-                                     -literal_key => 1
-                                     );
-        $msg = $cipher->encrypt($msg);
-    }
-    zmq_sendmsg($options{socket}, $msg, ZMQ_NOBLOCK);
-}
-sub uncrypt_message {
-    my (%options) = @_;
-    my $plaintext;
-    my $cipher = Crypt::CBC->new(-key    => $options{symkey},
-                                 -keysize => length($options{symkey}),
-                                 -cipher => $options{cipher},
-                                 -iv => $options{vector},
-                                 -header => 'none',
-                                 -literal_key => 1
-                                );
-    eval {
-        $plaintext = $cipher->decrypt($options{message});
-    };
-    if ($@) {
-        if (defined($options{logger})) {
-            $options{logger}->writeLogError("Sym encrypt issue: " .  $@);
-        }
-        return (-1, $@);
-    }
-    return (0, $plaintext);
-}
-sub generate_token {
-    my (%options) = @_;
-    my $token = Crypt::OpenSSL::Random::random_bytes(256);
-    return unpack('H*', $token);
-}
-sub generate_symkey {
-    my (%options) = @_;
-    my $random_key = Crypt::OpenSSL::Random::random_bytes($options{keysize});
-    return (0, $random_key);
-}
-sub client_get_secret {
-    my (%options) = @_;
-    my $plaintext;
-    eval {
-        $plaintext = $options{pubkey}->public_decrypt($options{message});
-    };
-    if ($@) {
-        return (-1, "Decoding issue: $@");
-    }
-    $plaintext = unpack('H*', $plaintext);
-    if ($plaintext !~ /^5b(.*?)5d(.*?)5b(.*?)5d(.*?)5b(.*)5d$/i) {
-        return (-1, 'Wrong protocol');
-    }
-    my $hostname = pack('H*', $3);
-    my $symkey = pack('H*', $5);
-    return (0, $symkey, $hostname);
-}
-sub client_helo_encrypt {
-    my (%options) = @_;
-    my $ciphertext;
-    eval {
-        $ciphertext = $options{pubkey}->encrypt($options{message});
-    };
-    if ($@) {
-        return (-1, "Decoding issue: $@");
-    }
-    return (0, $ciphertext);
-}
-sub is_client_can_connect {
-    my (%options) = @_;
-    my $plaintext;
-    eval {
-        $plaintext = $privkey->decrypt($options{message});
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Decoding issue: " .  $@);
-        return -1;
-    }
-    if ($plaintext !~ /\[HELO\]\s+\[(.+)\]/) {
-        $options{logger}->writeLogError("Decoding issue. Protocol not good");
-        return -1;
-    }
-    $options{logger}->writeLogError("Connection from $1");
-    return 0;
-}
-sub is_handshake_done {
-    my (%options) = @_;
-    my ($status, $sth) = $options{dbh}->query("SELECT `key` FROM centreond_identity WHERE identity = " . $options{dbh}->quote($options{identity}) . " ORDER BY id DESC");
-    return if ($status == -1);
-    if (my $row = $sth->fetchrow_hashref()) {
-        return (1, pack('H*', $row->{key}));
-    }
-    return 0;
-}
-sub constatus {
-    my (%options) = @_;
-    if (defined($options{centreond}->{modules_register}->{ $options{centreond}->{modules_id}->{$options{centreond_config}->{centreondcore}{proxy_name}} })) {
-        my $name = $options{centreond_config}->{$options{centreond_config}->{centreondcore}{proxy_name}}{module};
-        my $method;
-        if (defined($name) && ($method = $name->can('get_constatus_result'))) {
-            return (0, { action => 'constatus', mesage => 'ok', data => $method->() }, 'CONSTATUS');
-        }
-    }
-    return (1, { action => 'constatus', mesage => 'cannot get value' }, 'CONSTATUS');
-}
-sub ping {
-    my (%options) = @_;
-    return (0, { action => 'ping', mesage => 'ping ok', id => $options{id} }, 'PONG');
-}
-sub putlog {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        return (1, { mesage => 'request not well formatted' });
-    }
-    my $status = add_history(dbh => $options{centreond}->{db_centreond}, 
-                             etime => $data->{etime}, token => $data->{token}, data => json_encode(data => $data->{data}, logger => $options{logger}), code => $data->{code});
-    if ($status == -1) {
-        return (1, { mesage => 'database issue' });
-    }
-    return (0, { mesage => 'message inserted' });
-}
-sub getlog {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        return (1, { mesage => 'request not well formatted' });
-    }
-    my %filters = ();
-    my ($filter, $filter_append) = ('', '');
-    foreach ((['id', '>'], ['token', '='], ['ctime', '>='], ['etime', '>'], ['code', '='])) {
-        if (defined($data->{${$_}[0]}) && $data->{${$_}[0]} ne '') {
-            $filter .= $filter_append . ${$_}[0] . ' ' . ${$_}[1] . ' ' . $options{centreond}->{db_centreond}->quote($data->{${$_}[0]});
-            $filter_append = ' AND ';
-        }
-    }
-    if ($filter eq '') {
-        return (1, { mesage => 'need at least one filter' });
-    }
-    my ($status, $sth) = $options{centreond}->{db_centreond}->query("SELECT * FROM centreond_history WHERE " . $filter);
-    if ($status == -1) {
-        return (1, { mesage => 'database issue' });
-    }
-    return (0, { action => 'getlog', result => $sth->fetchall_hashref('id'), id => $options{centreond}->{id} });
-}
-sub kill {
-    my (%options) = @_;
-}
-sub update_identity {
-    my (%options) = @_;
-    my ($status, $sth) = $options{dbh}->query("UPDATE centreond_identity SET `ctime` = " . $options{dbh}->quote(time()) . " WHERE `identity` = " . $options{dbh}->quote($options{identity}));
-    return $status;
-}
-sub add_identity {
-    my (%options) = @_;
-    my ($status, $sth) = $options{dbh}->query("INSERT INTO centreond_identity (`ctime`, `identity`, `key`) VALUES (" . 
-                  $options{dbh}->quote(time()) . ", " . $options{dbh}->quote($options{identity}) . ", " . $options{dbh}->quote(unpack('H*', $options{symkey})) . ")");
-    return $status;
-}
-sub add_history {
-    my (%options) = @_;
-    if (defined($options{data}) && defined($options{json_encode})) {
-        return -1 if (!($options{data} = json_encode(data => $options{data}, logger => $options{logger})));
-    }
-    if (!defined($options{ctime})) {
-        $options{ctime} = time();
-    }
-    if (!defined($options{etime})) {
-        $options{etime} = time();
-    }
-    my @names = ();
-    my @values = ();
-    foreach (('data', 'token', 'ctime', 'etime', 'code')) {
-        if (defined($options{$_})) {
-            push @names, $_;
-            push @values, $options{dbh}->quote($options{$_});
-        }
-    }
-    my ($status, $sth) = $options{dbh}->query("INSERT INTO centreond_history (" . join(',', @names) . ") VALUES (" . 
-                 join(',', @values) . ")");
-    return $status;
-}
-sub json_encode {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->encode($options{data});
-    };
-    if ($@) {
-        if (defined($options{logger})) {
-            $options{logger}->writeLogError("Cannot encode json data: $@");
-        }
-        return undef;
-    }
-    return $data;
-}
-sub connect_com {
-    my (%options) = @_;
-    my $context = zmq_init();
-    my $socket = zmq_socket($context, $zmq_type{$options{zmq_type}});
-    if (!defined($socket)) {
-        $options{logger}->writeLogError("Can't setup server: $!");
-        exit(1);
-    }
-    zmq_setsockopt($socket, ZMQ_IDENTITY, $options{name});
-    zmq_setsockopt($socket, ZMQ_LINGER, defined($options{linger}) ? $options{linger} : 0); # 0 we discard
-    zmq_connect($socket, $options{type} . '://' . $options{path});
-    return $socket;
-}
-sub create_com {
-    my (%options) = @_;
-    my $context = zmq_init();
-    my $socket = zmq_socket($context, $zmq_type{$options{zmq_type}});
-    if (!defined($socket)) {
-        $options{logger}->writeLogError("Can't setup server: $!");
-        exit(1);
-    }
-    zmq_setsockopt($socket, ZMQ_IDENTITY, $options{name});
-    zmq_setsockopt($socket, ZMQ_LINGER, 0); # we discard    
-    if ($options{type} eq 'tcp') {
-        zmq_bind($socket, 'tcp://' . $options{path});
-    } elsif ($options{type} eq 'ipc') {
-        if (zmq_bind($socket, 'ipc://' . $options{path}) == -1) {
-            $options{logger}->writeLogError("Cannot bind ipc '$options{path}': $!");
-            $options{logger}->writeLogError("Maybe directory not exist. We try to create it!!!");
-            if (!mkdir(dirname($options{path}))) {
-                zmq_close($socket);
-                exit(1);
-            }
-            if (zmq_bind($socket, 'ipc://' . $options{path}) == -1) {
-                $options{logger}->writeLogError("Cannot bind ipc '$options{path}': $!");
-                zmq_close($socket);
-                exit(1);
-            }
-        }
-    } else {
-        $options{logger}->writeLogError("zmq type '$options{type}' not managed");
-        zmq_close($socket);
-        exit(1);
-    }
-    return $socket;
-}
-sub build_protocol {
-    my (%options) = @_;
-    my $data = $options{data};
-    my $token = defined($options{token}) ? $options{token} : '';
-    my $action = defined($options{action}) ? $options{action} : '';
-    my $target = defined($options{target}) ? $options{target} : '';
-    if (defined($data)) {
-        if (defined($options{json_encode})) {
-            $data = json_encode(data => $data, logger => $options{logger});
-        }
-    } else {
-        $data = json_encode(data => {}, logger => $options{logger});
-    }
-    return '[' . $action . '] [' . $token . '] [' . $target . '] ' . $data;
-}
-sub zmq_send_message {
-    my (%options) = @_;
-    my $message = $options{message};
-    if (!defined($message)) {
-        $message = build_protocol(%options);
-    }
-    if (defined($options{identity})) {
-        zmq_sendmsg($options{socket}, $options{identity}, ZMQ_NOBLOCK | ZMQ_SNDMORE);
-    }    
-    if (defined($options{cipher})) {
-        my $cipher = Crypt::CBC->new(-key    => $options{symkey},
-                                     -keysize => length($options{symkey}),
-                                     -cipher => $options{cipher},
-                                     -iv => $options{vector},
-                                     -header => 'none',
-                                     -literal_key => 1
-                                     );
-        $message = $cipher->encrypt($message);
-    }
-    zmq_sendmsg($options{socket}, $message, ZMQ_NOBLOCK);
-}
-sub zmq_dealer_read_message {
-    my (%options) = @_;
-    my $message = zmq_recvmsg($options{socket});
-    my $data = zmq_msg_data($message);
-    return $data;
-}
-sub zmq_read_message {
-    my (%options) = @_;
-    my $message = zmq_recvmsg($options{socket});
-    my $identity = zmq_msg_data($message);
-    $message = zmq_recvmsg($options{socket});
-    my $data = zmq_msg_data($message);
-    return (unpack('H*', $identity), $data);
-}
-sub zmq_still_read {
-    my (%options) = @_;
-    return zmq_getsockopt($options{socket}, ZMQ_RCVMORE);        
-}
-sub add_zmq_pollin {
-    my (%options) = @_;
-    push @{$options{poll}}, {
-            socket  => $options{socket},
-            events  => ZMQ_POLLIN,
-            callback => $options{callback},
-    };
-}
-1;

--- a/bin/centreond/centreon/common/db.pm
+++ b//dev/null
@@ -1,222 +0,0 @@
-package centreon::common::db;
-use strict;
-use warnings;
-use DBI;
-sub new {
-    my ($class, %options) = @_;
-    my %defaults =
-      (
-       logger => undef,
-       db => undef,
-       host => "localhost",
-       user => undef,
-       password => undef,
-       port => 3306,
-       force => 0,
-       type => "mysql"
-      );
-    my $self = {%defaults, %options};
-    $self->{type} = 'mysql' if (!defined($self->{type}));
-    $self->{instance} = undef;
-    $self->{args} = [];
-    bless $self, $class;
-    return $self;
-}
-sub type {
-    my $self = shift;
-    if (@_) {
-        $self->{type} = shift;
-    }
-    return $self->{type};
-}
-sub db {
-    my $self = shift;
-    if (@_) {
-        $self->{db} = shift;
-    }
-    return $self->{db};
-}
-sub host {
-    my $self = shift;
-    if (@_) {
-        $self->{host} = shift;
-    }
-    return $self->{host};
-}
-sub port {
-    my $self = shift;
-    if (@_) {
-        $self->{port} = shift;
-    }
-    return $self->{port};
-}
-sub user {
-    my $self = shift;
-    if (@_) {
-        $self->{user} = shift;
-    }
-    return $self->{user};
-}
-sub force {
-    my $self = shift;
-    if (@_) {
-        $self->{force} = shift;
-    }
-    return $self->{force};
-}
-sub password {
-    my $self = shift;
-    if (@_) {
-        $self->{password} = shift;
-    }
-    return $self->{password};
-}
-sub last_insert_id {
-    my $self = shift;
-    return $self->{instance}->last_insert_id(undef, undef, undef, undef);
-}
-sub quote {
-    my $self = shift;
-    if (defined($self->{instance})) {
-        return $self->{instance}->quote($_[0]);
-    }
-    my $num = scalar(@{$self->{args}});
-    push @{$self->{args}}, $_[0];
-    return "##__ARG__$num##";
-}
-sub set_inactive_destroy {
-    my $self = shift;
-    if (defined($self->{instance})) {
-        $self->{instance}->{InactiveDestroy} = 1;
-    }
-}
-sub transaction_mode {
-    my ($self, $status) = @_;
-    if ($status) {
-        $self->{instance}->begin_work;
-    } else {
-        $self->{instance}->{AutoCommit} = 1;
-    }
-}
-sub commit { shift->{instance}->commit; }
-sub rollback { shift->{instance}->rollback; }
-sub kill {
-    my $self = shift;
-    if (defined($self->{instance})) {
-        $self->{logger}->writeLogInfo("KILL QUERY\n");
-        my $rv = $self->{instance}->do("KILL QUERY " . $self->{instance}->{'mysql_thread_id'});
-        if (!$rv) {
-            my ($package, $filename, $line) = caller;
-            $self->{logger}->writeLogError("MySQL error : " . $self->{instance}->errstr . " (caller: $package:$filename:$line)");
-        }
-    }
-}
-sub connect() {
-    my $self = shift;
-    my ($status, $count) = (0, 0);
-    while (1) {
-        $self->{port} = 3306 if (!defined($self->{port}) && $self->{type} eq 'mysql');
-        if ($self->{type} =~ /SQLite/i) {
-            $self->{instance} = DBI->connect(
-                "DBI:".$self->{type} 
-                    .":".$self->{db},
-                $self->{user},
-                $self->{password},
-                { RaiseError => 0, PrintError => 0, AutoCommit => 1 }
-            );
-        } else {
-            $self->{instance} = DBI->connect(
-                "DBI:".$self->{type} 
-                    .":".$self->{db}
-                    .":".$self->{host}
-                    .":".$self->{port},
-                $self->{user},
-                $self->{password},
-                { RaiseError => 0, PrintError => 0, AutoCommit => 1 }
-            );
-        }
-        if (defined($self->{instance})) {
-            last;
-        }
-        my ($package, $filename, $line) = caller;
-        $self->{logger}->writeLogError("MySQL error : cannot connect to database " . $self->{db} . ": " . $DBI::errstr . " (caller: $package:$filename:$line) (try: $count)");
-        if ($self->{force} == 0 || ($self->{force} == 2 && $count == 1)) {
-            $status = -1;
-            last;
-        }
-        sleep(1);
-        $count++;
-    }
-    return $status;
-}
-sub disconnect {
-    my $self = shift;
-    my $instance = $self->{instance};
-    if (defined($instance)) {
-        $instance->disconnect;
-        $self->{instance} = undef;
-    }
-}
-sub do {
-    my ($self, $query) = @_;
-    if (!defined $self->{instance}) {
-        if ($self->connect() == -1) {
-            $self->{logger}->writeLogError("Can't connect to the database");
-            return -1;
-        }
-    }
-    my $numrows = $self->{instance}->do($query);
-    die $self->{instance}->errstr if !defined $numrows;
-    return $numrows;
-}
-sub error {
-    my ($self, $error, $query) = @_;
-    my ($package, $filename, $line) = caller 1;
-    chomp($query);
-    $self->{logger}->writeLogError(<<"EOE");
-MySQL error: $error (caller: $package:$filename:$line)
-Query: $query
-EOE
-    $self->disconnect();
-    $self->{instance} = undef;
-}
-sub query {
-    my $self = shift;
-    my $query = shift;
-    my ($status, $count) = (0, -1);
-    my $statement_handle;
-    while (1) {
-        if (!defined($self->{instance})) {
-            $status = $self->connect();
-            if ($status != -1) {
-                for (my $i = 0; $i < scalar(@{$self->{args}}); $i++) {
-                    my $str_quoted = $self->quote(${$self->{args}}[0]);
-                    $query =~ s/##__ARG__$i##/$str_quoted/;
-                }
-                $self->{args} = [];
-            }
-            if ($status == -1 && $self->{force} != 1) {
-                $self->{args} = [];
-                last;
-            }
-        }
-        $count++;
-        $statement_handle = $self->{instance}->prepare($query);
-        if (!defined $statement_handle) {
-            $self->error($self->{instance}->errstr, $query);
-            $status = -1;
-            last if ($self->{force} == 0 || ($self->{force} == 2 && $count == 1));
-            next;
-        }
-        my $rv = $statement_handle->execute;
-        if (!$rv) {
-            $self->error($statement_handle->errstr, $query);
-            $status = -1;
-            last if ($self->{force} == 0 || ($self->{force} == 2 && $count == 1));
-            next;
-        }
-        last;
-    }
-    return ($status, $statement_handle);
-}
-1;

--- a/bin/centreond/centreon/common/lock.pm
+++ b//dev/null
@@ -1,119 +0,0 @@
-package centreon::common::lock;
-use strict;
-use warnings;
-sub new {
-    my ($class, $name, %options) = @_;
-    my %defaults = (name => $name, pid => $$, timeout => 10);
-    my $self = {%defaults, %options};
-    bless $self, $class;
-    return $self;
-}
-sub is_set {
-    die "Not implemented";
-}
-sub set {
-    my $self = shift;
-    for (my $i = 0; $self->is_set() && $i < $self->{timeout}; $i++) {
-        sleep 1;
-    }
-    die "Failed to set lock for $self->{name}" if $self->is_set();
-}
-package centreon::common::lock::file;
-use base qw(centreon::common::lock);
-sub new {
-    my $class = shift;
-    my $self = $class->SUPER::new(@_);
-    if (!defined $self->{storagedir}) {
-        die "Can't build lock, required arguments not provided";
-    }
-    bless $self, $class;
-    $self->{pidfile} = "$self->{storagedir}/$self->{name}.lock";
-    return $self;
-}
-sub is_set {
-    return -e shift->{pidfile};
-}
-sub set {
-    my $self = shift;
-    $self->SUPER::set();
-    open LOCK, ">", $self->{pidfile};
-    print LOCK $self->{pid};
-    close LOCK;
-}
-sub DESTROY {
-    my $self = shift;
-    if (defined $self->{pidfile} && -e $self->{pidfile}) {
-        unlink $self->{pidfile};
-    }
-}
-package centreon::common::lock::sql;
-use base qw(centreon::common::lock);
-sub new {
-    my $class = shift;
-    my $self = $class->SUPER::new(@_);
-    if (!defined $self->{dbc}) {
-        die "Can't build lock, required arguments not provided";
-    }
-    bless $self, $class;
-    $self->{launch_time} = time();
-    return $self;
-}
-sub is_set {
-    my $self = shift;
-    my ($status, $sth) = $self->{dbc}->query(
-        "SELECT id,running,pid,time_launch FROM cron_operation WHERE name LIKE '$self->{name}'"
-    );
-    return 1 if ($status == -1);
-    my $data = $sth->fetchrow_hashref();
-    if (!defined $data->{id}) {
-        $self->{not_created_yet} = 1;
-        $self->{previous_launch_time} = 0;
-        return 0;
-    }
-    $self->{id} = $data->{id};
-    $data->{pid} = -1 if (!defined($data->{pid}));
-    $self->{pid} = $data->{pid};
-    $self->{previous_launch_time} = $data->{time_launch};
-    if (defined $data->{running} && $data->{running} == 1) {
-        my $line = `ps -ef | grep -v grep | grep $self->{pid} | grep $self->{name}`;
-        return 0 if !length $line;
-        return 1;
-    }
-    return 0;
-}
-sub set {
-    my $self = shift;
-    my $status;
-    $self->SUPER::set();
-    if (defined $self->{not_created_yet}) {
-        $status = $self->{dbc}->do(<<"EOQ");
-INSERT INTO cron_operation
-(name, system, activate)
-VALUES ('$self->{name}', '1', '1')
-EOQ
-        goto error if $status == -1;
-        $self->{id} = $self->{dbc}->last_insert_id();
-        return;
-    }
-    $status = $self->{dbc}->do(<<"EOQ");
-UPDATE cron_operation
-SET running = '1', time_launch = '$self->{launch_time}', pid = '$self->{pid}'
-WHERE id = '$self->{id}'
-EOQ
-    goto error if $status == -1;
-    return;
-  error:
-    die "Failed to set lock for $self->{name}";
-}
-sub DESTROY {
-    my $self = shift;
-    if (defined $self->{dbc}) {
-        my $exectime = time() - $self->{launch_time};
-        $self->{dbc}->do(<<"EOQ");
-UPDATE cron_operation
-SET running = '0', last_execution_time = '$exectime', pid = '-1'
-WHERE id = '$self->{id}'
-EOQ
-    }
-}
-1;

--- a/bin/centreond/centreon/common/logger.pm
+++ b//dev/null
@@ -1,145 +0,0 @@
-package centreon::common::logger;
-=head1 NOM
-centreon::common::logger - Simple logging module
-=head1 SYNOPSIS
- use strict;
- use warnings;
- use centreon::polling;
- my $logger = new centreon::common::logger();
- $logger->writeLogInfo("information");
-=head1 DESCRIPTION
-This module offers a simple interface to write log messages to various output:
-* standard output
-* file
-* syslog
-=cut
-use strict;
-use warnings;
-use Sys::Syslog qw(:standard :macros);
-use IO::Handle;
-my %severities = (1 => LOG_INFO,
-                  2 => LOG_ERR,
-                  4 => LOG_DEBUG);
-sub new {
-    my $class = shift;
-    my $self = bless
-      {
-       file => 0,
-       filehandler => undef,
-       severity => 3,
-       old_severity => 3,
-       log_mode => 0,
-       log_facility => undef,
-       log_option => LOG_PID,
-      }, $class;
-    return $self;
-}
-sub file_mode($$) {
-    my ($self, $file) = @_;
-    if (defined($self->{filehandler})) {
-        $self->{filehandler}->close();
-    }
-    if (open($self->{filehandler}, ">>", $file)){
-        $self->{log_mode} = 1;
-        $self->{filehandler}->autoflush(1);
-        $self->{file_name} = $file;
-        return 1;
-    }
-    $self->{filehandler} = undef;
-    print STDERR "Cannot open file $file: $!\n";
-    return 0;
-}
-sub is_file_mode {
-    my $self = shift;
-    if ($self->{log_mode} == 1) {
-        return 1;
-    }
-    return 0;
-}
-sub is_debug {
-    my $self = shift;
-    if (($self->{severity} & 4) == 0) {
-        return 0;
-    }
-    return 1;
-}
-sub syslog_mode($$$) {
-    my ($self, $logopt, $facility) = @_;
-    $self->{log_mode} = 2;
-    openlog($0, $logopt, $facility);
-    return 1;
-}
-sub redirect_output {
-    my $self = shift;
-    if ($self->is_file_mode()) {
-        open my $lfh, '>>', $self->{file_name};
-        open STDOUT, '>&', $lfh;
-        open STDERR, '>&', $lfh;
-    }
-}
-sub set_default_severity {
-    my $self = shift;
-    $self->{"severity"} = $self->{"old_severity"};
-}
-sub severity {
-    my $self = shift;
-    if (@_) {
-        my $save_severity = $self->{"severity"};
-        if ($_[0] =~ /^[012347]$/) {
-            $self->{"severity"} = $_[0];
-        } elsif ($_[0] eq "none") {
-            $self->{"severity"} = 0;
-        } elsif ($_[0] eq "error") {
-            $self->{"severity"} = 1;
-        } elsif ($_[0] eq "info") {
-            $self->{"severity"} = 3;
-        } elsif ($_[0] eq "debug") {
-            $self->{"severity"} = 7;
-        } else {
-            $self->writeLogError("Wrong severity value set.");
-            return -1;
-        }
-        $self->{"old_severity"} = $save_severity;
-    }
-    return $self->{"severity"};
-}
-sub get_date {
-    my $self = shift;
-    my ($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime(time());
-    return sprintf("%04d-%02d-%02d %02d:%02d:%02d", 
-                   $year+1900, $mon+1, $mday, $hour, $min, $sec);
-}
-sub writeLog($$$%) {
-    my ($self, $severity, $msg, %options) = @_;
-    my $withdate = (defined $options{withdate}) ? $options{withdate} : 1;
-    my $newmsg = ($withdate) 
-      ? $self->get_date . " - $msg" : $msg;
-    if (($self->{severity} & $severity) == 0) {
-        return;
-    }
-    if ($self->{log_mode} == 0) {
-        print "$newmsg\n";
-    } elsif ($self->{log_mode} == 1) {
-        if (defined $self->{filehandler}) {
-            print { $self->{filehandler} } "$newmsg\n";
-        }
-    } elsif ($self->{log_mode} == 2) {
-        syslog($severities{$severity}, $msg);
-    }
-}
-sub writeLogDebug {
-    shift->writeLog(4, @_);
-}
-sub writeLogInfo {
-    shift->writeLog(2, @_);
-}
-sub writeLogError {
-    shift->writeLog(1, @_);
-}
-sub DESTROY {
-    my $self = shift;
-    if (defined $self->{filehandler}) {
-        $self->{filehandler}->close();
-    }
-}
-1;

--- a/bin/centreond/centreon/common/misc.pm
+++ b//dev/null
@@ -1,213 +0,0 @@
-package centreon::common::misc;
-use strict;
-use warnings;
-use vars qw($centreon_config);
-use POSIX ":sys_wait_h";
-my $read_size = 1*1024*1024*10; # 10Mo
-sub reload_db_config {
-    my ($logger, $config_file, $cdb, $csdb) = @_;
-    my ($cdb_mod, $csdb_mod) = (0, 0);
-    unless (my $return = do $config_file) {
-        $logger->writeLogError("couldn't parse $config_file: $@") if $@;
-        $logger->writeLogError("couldn't do $config_file: $!") unless defined $return;
-        $logger->writeLogError("couldn't run $config_file") unless $return;
-        return -1;
-    }
-    if (defined($cdb)) {
-        if ($centreon_config->{centreon_db} ne $cdb->db() ||
-            $centreon_config->{db_host} ne $cdb->host() ||
-            $centreon_config->{db_user} ne $cdb->user() ||
-            $centreon_config->{db_passwd} ne $cdb->password() ||
-            $centreon_config->{db_port} ne $cdb->port()) {
-            $logger->writeLogInfo("Database centreon config had been modified");
-            $cdb->db($centreon_config->{centreon_db});
-            $cdb->host($centreon_config->{db_host});
-            $cdb->user($centreon_config->{db_user});
-            $cdb->password($centreon_config->{db_passwd});
-            $cdb->port($centreon_config->{db_port});
-            $cdb_mod = 1;
-        }
-    }
-    if (defined($csdb)) {
-        if ($centreon_config->{centstorage_db} ne $csdb->db() ||
-            $centreon_config->{db_host} ne $csdb->host() ||
-            $centreon_config->{db_user} ne $csdb->user() ||
-            $centreon_config->{db_passwd} ne $csdb->password() ||
-            $centreon_config->{db_port} ne $csdb->port()) {
-            $logger->writeLogInfo("Database centstorage config had been modified");
-            $csdb->db($centreon_config->{centstorage_db});
-            $csdb->host($centreon_config->{db_host});
-            $csdb->user($centreon_config->{db_user});
-            $csdb->password($centreon_config->{db_passwd});
-            $csdb->port($centreon_config->{db_port});
-            $csdb_mod = 1;
-        }
-    }
-    return (0, $cdb_mod, $csdb_mod);
-}
-sub get_all_options_config {
-    my ($extra_config, $centreon_db_centreon, $prefix) = @_;
-    my $save_force = $centreon_db_centreon->force();
-    $centreon_db_centreon->force(0);
-    my ($status, $stmt) = $centreon_db_centreon->query("SELECT `key`, `value` FROM options WHERE `key` LIKE " . $centreon_db_centreon->quote($prefix . "_%") . " LIMIT 1");
-    if ($status == -1) {
-        $centreon_db_centreon->force($save_force);
-        return ;
-    }
-    while ((my $data = $stmt->fetchrow_hashref())) {
-        if (defined($data->{value}) && length($data->{value}) > 0) {
-            $data->{key} =~ s/^${prefix}_//;
-            $extra_config->{$data->{key}} = $data->{value};
-        }
-    }
-    $centreon_db_centreon->force($save_force);
-}
-sub get_option_config {
-    my ($extra_config, $centreon_db_centreon, $prefix, $key) = @_;
-    my $data;
-    my $save_force = $centreon_db_centreon->force();
-    $centreon_db_centreon->force(0);
-    my ($status, $stmt) = $centreon_db_centreon->query("SELECT value FROM options WHERE `key` = " . $centreon_db_centreon->quote($prefix . "_" . $key) . " LIMIT 1");
-    if ($status == -1) {
-        $centreon_db_centreon->force($save_force);
-        return ;
-    }
-    if (($data = $stmt->fetchrow_hashref()) && defined($data->{value})) {
-        $extra_config->{$key} = $data->{value};
-    }
-    $centreon_db_centreon->force($save_force);
-}
-sub check_debug {
-    my ($logger, $key, $cdb, $name) = @_;
-    my $request = "SELECT value FROM options WHERE `key` = " . $cdb->quote($key);
-    my ($status, $sth) =  $cdb->query($request);
-    return -1 if ($status == -1);
-    my $data = $sth->fetchrow_hashref();
-    if (defined($data->{'value'}) && $data->{'value'} == 1) {
-        if (!$logger->is_debug()) {
-            $logger->severity("debug");
-            $logger->writeLogInfo("Enable Debug in $name");
-        }
-    } else {
-        if ($logger->is_debug()) {
-            $logger->set_default_severity();
-            $logger->writeLogInfo("Disable Debug in $name");
-        }
-    }
-    return 0;
-}
-sub get_line_file {
-    my ($fh, $datas, $readed) = @_;
-    my $line;
-    my $size = scalar(@$datas);
-    return (1, shift(@$datas)) if ($size > 1);
-    while ((my $eof = sysread($fh, $line, $read_size))) {
-        my @result = split("\n", $line);
-        if ($line =~ /\n$/) {
-            push @result, "";
-        }
-        if ($size == 1) {
-            $$datas[0] .= shift(@result);
-        }
-        push @$datas, @result;
-        $$readed += $eof;
-        $size = scalar(@$datas);
-        if ($size > 1) {
-            return (1, shift(@$datas));
-        }
-    }
-    return (1, shift(@$datas)) if ($size > 1);
-    return -1;
-}
-sub get_line_pipe {
-    my ($fh, $datas, $read_done) = @_;
-    my $line;
-    my $size = scalar(@$datas);
-    if ($size > 1) {
-        return (1, shift(@$datas));
-    } elsif ($size == 1 && $$read_done == 1) {
-        return 0;
-    }
-    while ((my $eof = sysread($fh, $line, 10000))) {
-        $$read_done = 1;
-        my @result = split("\n", $line);
-        if ($line =~ /\n$/) {
-            push @result, "";
-        }
-        if ($size == 1) {
-            $$datas[0] .= shift(@result);
-        }
-        push @$datas, @result;
-        $size = scalar(@$datas);
-        if ($size > 1) {
-            return (1, shift(@$datas));
-        } else {
-            return 0;
-        }
-    }
-    return -1;
-}
-sub backtick {
-    my %arg = (
-        command => undef,
-        arguments => [],
-        timeout => 30,
-        wait_exit => 0,
-        redirect_stderr => 0,
-        @_,
-    );
-    my @output;
-    my $pid;
-    my $return_code;
-    my $sig_do;
-    if ($arg{wait_exit} == 0) {
-        $sig_do = 'IGNORE';
-        $return_code = undef;
-    } else {
-        $sig_do = 'DEFAULT';
-    }
-    local $SIG{CHLD} = $sig_do;
-    $SIG{TTOU} = 'IGNORE';
-    $| = 1;
-    if (!defined($pid = open( KID, "-|" ))) {
-        $arg{logger}->writeLogError("Cant fork: $!");
-        return (-1000, "cant fork: $!");
-    }
-    if ($pid) {  
-        eval {
-           local $SIG{ALRM} = sub { die "Timeout by signal ALARM\n"; };
-           alarm( $arg{timeout} );
-           while (<KID>) {
-               chomp;
-               push @output, $_;
-           }
-           alarm(0);
-        };
-        if ($@) {
-            if ($pid != -1) {
-                kill -9, $pid;
-            }
-            alarm(0);
-            return (-1000, "Command too long to execute (timeout)...", -1);
-        } else {
-            if ($arg{wait_exit} == 1) {
-                waitpid($pid, 0);
-                $return_code = ($? >> 8);
-            }
-            close KID;
-        }
-    } else {
-        setpgrp(0, 0);
-        if ($arg{redirect_stderr} == 1) {
-            open STDERR, ">&STDOUT";
-        }
-        if (scalar(@{$arg{arguments}}) <= 0) {
-            exec($arg{command});
-        } else {
-            exec($arg{command}, @{$arg{arguments}});
-        }
-        exit(127);
-    }
-    return (0, join("\n", @output), $return_code);
-}
-1;

--- a/bin/centreond/centreon/script.pm
+++ b//dev/null
@@ -1,99 +0,0 @@
-package centreon::script;
-use strict;
-use warnings;
-use FindBin;
-use Getopt::Long;
-use Pod::Usage;
-use centreon::common::logger;
-use centreon::common::db;
-use centreon::common::lock;
-use vars qw($centreon_config);
-$SIG{__DIE__} = sub {
-    my $error = shift;
-    print "Error: $error";
-    exit 1;
-};
-sub new {
-    my ($class, $name, %options) = @_;
-    my %defaults = 
-      (
-       config_file => "/etc/centreon/centreon-config.pm",
-       log_file => undef,
-       centreon_db_conn => 0,
-       centstorage_db_conn => 0,
-       severity => "info",
-       noconfig => 0,
-       noroot => 0
-      );
-    my $self = {%defaults, %options};
-    bless $self, $class;
-    $self->{name} = $name;
-    $self->{logger} = centreon::common::logger->new();
-    $self->{options} = {
-        "config=s" => \$self->{config_file},
-        "logfile=s" => \$self->{log_file},
-        "severity=s" => \$self->{severity},
-        "help|?" => \$self->{help}
-    };
-    return $self;
-}
-sub init {
-    my $self = shift;
-    if (defined $self->{log_file}) {
-        $self->{logger}->file_mode($self->{log_file});
-    }
-    $self->{logger}->severity($self->{severity});
-    if ($self->{noroot} == 1) {
-        if ($< == 0) {
-            $self->{logger}->writeLogError("Can't execute script as root.");
-            die("Quit");
-        }
-    }
-    if ($self->{centreon_db_conn}) {
-        $self->{cdb} = centreon::common::db->new
-          (db => $self->{centreon_config}->{centreon_db},
-           host => $self->{centreon_config}->{db_host},
-           user => $self->{centreon_config}->{db_user},
-           password => $self->{centreon_config}->{db_passwd},
-           logger => $self->{logger});
-        $self->{lock} = centreon::common::lock::sql->new($self->{name}, dbc => $self->{cdb});
-        $self->{lock}->set();
-    }
-    if ($self->{centstorage_db_conn}) {
-        $self->{csdb} = centreon::common::db->new
-          (db => $self->{centreon_config}->{centstorage_db},
-           host => $self->{centreon_config}->{db_host},
-           user => $self->{centreon_config}->{db_user},
-           password => $self->{centreon_config}->{db_passwd},
-           logger => $self->{logger});
-    }
-}
-sub DESTROY {
-    my $self = shift;
-    if (defined $self->{cdb}) {
-        $self->{cdb}->disconnect();
-    }
-    if (defined $self->{csdb}) {
-        $self->{csdb}->disconnect();
-    }
-}
-sub add_options {
-    my ($self, %options) = @_;
-    $self->{options} = {%{$self->{options}}, %options};
-}
-sub parse_options {
-    my $self = shift;
-    Getopt::Long::Configure('bundling');
-    die "Command line error" if !GetOptions(%{$self->{options}});
-    pod2usage(-exitval => 1, -input => $FindBin::Bin . "/" . $FindBin::Script) if $self->{help};
-    if ($self->{noconfig} == 0) {
-        require $self->{config_file};
-        $self->{centreon_config} = $centreon_config;
-    }
-}
-sub run {
-    my $self = shift;
-    $self->parse_options();
-    $self->init();
-}
-1;

--- a/bin/centreond/centreon/script/centreondcore.pm
+++ b//dev/null
@@ -1,385 +0,0 @@
-package centreon::script::centreondcore;
-use strict;
-use warnings;
-use POSIX ":sys_wait_h";
-use Sys::Hostname;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-use centreon::centreond::common;
-use centreon::script;
-my ($centreond, $centreond_config);
-use base qw(centreon::script);
-my $VERSION = "1.0";
-my %handlers = (TERM => {}, HUP => {}, CHLD => {});
-sub new {
-    my $class = shift;
-    my $self = $class->SUPER::new("centreond",
-        centreon_db_conn => 0,
-        centstorage_db_conn => 0,
-        noconfig => 1
-    );
-    bless $self, $class;
-    $self->add_options(
-        "config-extra:s" => \$self->{opt_extra},
-    );
-    $self->{opt_extra} = '';
-    $self->{return_child} = {};
-    $self->{stop} = 0;
-    $self->{internal_register} = {};
-    $self->{modules_register} = {};
-    $self->{modules_events} = {};
-    $self->{modules_id} = {};
-    $self->{sessions_timer} = time();
-    $self->{kill_timer} = undef;
-    return $self;
-}
-sub init {
-    my $self = shift;
-    $self->SUPER::init();
-    $SIG{__DIE__} = undef;
-    if (! -f $self->{opt_extra}) {
-        $self->{logger}->writeLogError("Can't find extra config file '$self->{opt_extra}'");
-        exit(1);
-    }
-    $centreond_config = centreon::centreond::common::read_config(config_file => $self->{opt_extra},
-                                                                 logger => $self->{logger});
-    if (defined($centreond_config->{centreondcore}{external_com_type}) && $centreond_config->{centreondcore}{external_com_type} ne '') {
-        centreon::centreond::common::loadprivkey(logger => $self->{logger}, privkey => $centreond_config->{centreondcore}{privkey});
-    }
-    $centreond->{db_centreond} = centreon::common::db->new(type => $centreond_config->{centreondcore}{centreond_db_type},
-                                                           db => $centreond_config->{centreondcore}{centreond_db_name},
-                                                           host => $centreond_config->{centreondcore}{centreond_db_host},
-                                                           port => $centreond_config->{centreondcore}{centreond_db_port},
-                                                           user => $centreond_config->{centreondcore}{centreond_db_user},
-                                                           password => $centreond_config->{centreondcore}{centreond_db_password},
-                                                           force => 2,
-                                                           logger => $centreond->{logger});
-    $centreond->{db_centreond}->set_inactive_destroy();
-    if ($centreond->{db_centreond}->connect() == -1) {
-        $centreond->{logger}->writeLogInfo("Cannot connect. We quit!!");
-        exit(1);
-    }
-    $self->{hostname} = $centreond_config->{centreondcore}{hostname};
-    if (!defined($self->{hostname}) || $self->{hostname} eq '') {
-        $self->{hostname} = hostname();
-    }
-    $self->{id} = $centreond_config->{centreondcore}{id};
-    if (!defined($self->{hostname}) || $self->{hostname} eq '') {
-    }
-    $self->load_modules();
-    $self->set_signal_handlers;
-}
-sub set_signal_handlers {
-    my $self = shift;
-    $SIG{TERM} = \&class_handle_TERM;
-    $handlers{TERM}->{$self} = sub { $self->handle_TERM() };
-    $SIG{HUP} = \&class_handle_HUP;
-    $handlers{HUP}->{$self} = sub { $self->handle_HUP() };
-    $SIG{CHLD} = \&class_handle_CHLD;
-    $handlers{CHLD}->{$self} = sub { $self->handle_CHLD() };
-}
-sub class_handle_TERM {
-    foreach (keys %{$handlers{TERM}}) {
-        &{$handlers{TERM}->{$_}}();
-    }
-}
-sub class_handle_HUP {
-    foreach (keys %{$handlers{HUP}}) {
-        &{$handlers{HUP}->{$_}}();
-    }
-}
-sub class_handle_CHLD {
-    foreach (keys %{$handlers{CHLD}}) {
-        &{$handlers{CHLD}->{$_}}();
-    }
-}
-sub handle_TERM {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("$$ Receiving order to stop...");
-    $self->{stop} = 1;
-    foreach my $name (keys %{$self->{modules_register}}) {
-        $self->{modules_register}->{$name}->{gently}->(logger => $self->{logger});
-    }
-    $self->{kill_timer} = time();
-}
-sub handle_HUP {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("$$ Receiving order to reload...");
-}
-sub handle_CHLD {
-    my $self = shift;
-    my $child_pid;
-    while (($child_pid = waitpid(-1, &WNOHANG)) > 0) {
-        $self->{return_child}->{$child_pid} = time();
-    }
-    $SIG{CHLD} = \&class_handle_CHLD;
-}
-sub load_modules {
-    my $self = shift;
-    foreach my $section (keys %{$centreond_config}) {
-        next if (!defined($centreond_config->{$section}{module}));
-        my $name = $centreond_config->{$section}{module};
-        (my $file = "$name.pm") =~ s{::}{/}g;
-        require $file;
-        $self->{logger}->writeLogInfo("Module '$section' is loading");
-        $self->{modules_register}->{$name} = {};
-        foreach my $method_name (('register', 'routing', 'kill', 'kill_internal', 'gently', 'check', 'init')) {
-            unless ($self->{modules_register}->{$name}->{$method_name} = $name->can($method_name)) {
-                $self->{logger}->writeLogError("No function '$method_name' for module '$section'");
-                exit(1);
-            }
-        }
-        my ($events, $id) = $self->{modules_register}->{$name}->{register}->(config => $centreond_config->{$section},
-                                                                             config_core => $centreond_config->{centreondcore});
-        $self->{modules_id}->{$id} = $name;
-        foreach my $event (@{$events}) {
-            $self->{modules_events}->{$event} = [] if (!defined($self->{modules_events}->{$event}));
-            push @{$self->{modules_events}->{$event}}, $name;
-        }
-        $self->{logger}->writeLogInfo("Module '$section' is loaded");
-    }    
-    foreach my $method_name (('putlog', 'getlog', 'kill', 'ping', 'constatus')) {
-        unless ($self->{internal_register}->{$method_name} = centreon::centreond::common->can($method_name)) {
-            $self->{logger}->writeLogError("No function '$method_name'");
-            exit(1);
-        }
-    }
-}
-sub message_run {
-    my ($self, %options) = @_;
-    if ($options{message} !~ /^\[(.+?)\]\s+\[(.*?)\]\s+\[(.*?)\]\s+(.*)$/) {
-        return (undef, 1, { mesage => 'request not well formatted' });
-    }
-    my ($action, $token, $target, $data) = ($1, $2, $3, $4);
-    if ($action !~ /^(PUTLOG|GETLOG|KILL|PING|CONSTATUS)$/ && !defined($self->{modules_events}->{$action})) {
-        centreon::centreond::common::add_history(dbh => $self->{db_centreond},
-                                                 code => 1, token => $token,
-                                                 data => { msg => "action '$action' is not known" },
-                                                 json_encode => 1);
-        return (undef, 1, { message => "action '$action' is not known" });
-    }
-    if (!defined($token) || $token eq '') {
-        $token = centreon::centreond::common::generate_token();
-    }
-    if ($self->{stop} == 1) {
-        centreon::centreond::common::add_history(dbh => $self->{db_centreond},
-                                                 code => 1, token => $token,
-                                                 data => { msg => 'centreond is stopping/restarting. Not proceed request.' },
-                                                 json_encode => 1);
-        return ($token, 1, { message => "centreond is stopping/restarting. Not proceed request." });
-    }
-    if (defined($target) && $target ne '') {
-        if ($target ne $self->{id}) {
-            $self->{modules_register}->{ $self->{modules_id}->{$centreond_config->{centreondcore}{proxy_name}}  }->{routing}->(socket => $self->{internal_socket}, dbh => $self->{db_centreond}, logger => $self->{logger}, 
-                                                                                            action => $1, token => $token, target => $target, data => $data,
-                                                                                            hostname => $self->{hostname});
-            return ($token, 0);
-        }
-    }
-    if ($action =~ /^(PUTLOG|GETLOG|KILL|PING|CONSTATUS)$/) {
-        my ($code, $response, $response_type) = $self->{internal_register}->{lc($action)}->(centreond => $self,
-                                                                            centreond_config => $centreond_config,
-                                                                            id => $self->{id},
-                                                                            data => $data,
-                                                                            token => $token,
-                                                                            logger => $self->{logger});
-        return ($token, $code, $response, $response_type);
-    } else {
-        foreach (@{$self->{modules_events}->{$action}}) {
-            $self->{modules_register}->{$_}->{routing}->(socket => $self->{internal_socket}, 
-                                                         dbh => $self->{db_centreond}, logger => $self->{logger},
-                                                         action => $1, token => $token, target => $target, data => $data,
-                                                         hostname => $self->{hostname});
-        }
-    }
-    return ($token, 0);
-}
-sub router_internal_event {
-    while (1) {
-        my ($identity, $message) = centreon::centreond::common::zmq_read_message(socket => $centreond->{internal_socket});
-        my ($token, $code, $response, $response_type) = $centreond->message_run(message => $message);
-        centreon::centreond::common::zmq_core_response(socket => $centreond->{internal_socket},
-                                                       identity => $identity, response_type => $response_type,
-                                                       data => $response, code => $code,
-                                                       token => $token);
-        last unless (centreon::centreond::common::zmq_still_read(socket => $centreond->{internal_socket}));
-    }
-}
-sub handshake {
-    my ($self, %options) = @_;
-    my ($identity, $message) = centreon::centreond::common::zmq_read_message(socket => $self->{external_socket});
-    my ($status, $key) = centreon::centreond::common::is_handshake_done(dbh => $self->{db_centreond}, identity => $identity);
-    if ($status == 1) {
-        ($status, my $response) = centreon::centreond::common::uncrypt_message(cipher => $centreond_config->{centreondcore}{cipher}, 
-                                                        message => $message,
-                                                        symkey => $key,
-                                                        vector => $centreond_config->{centreondcore}{vector}
-                                                        );
-        if ($status == 0 && $response =~ /^\[.*\]/) {
-            centreon::centreond::common::update_identity(dbh => $self->{db_centreond}, identity => $identity);
-            return ($identity, $key, $response);
-        }
-        $status = 0;    
-    }
-    if ($status == -1) {
-        centreon::centreond::common::zmq_core_response(socket => $self->{external_socket}, identity => $identity,
-                                                       code => 1, data => { message => 'Database issue' });
-        return undef;
-    } elsif ($status == 0) {
-        if (centreon::centreond::common::is_client_can_connect(message => $message,
-                                                               logger => $self->{logger}) == -1) {
-            centreon::centreond::common::zmq_core_response(socket => $self->{external_socket}, identity => $identity,
-                                                           code => 1, data => { message => 'handshake issue' } );
-        }
-        my ($status, $symkey) = centreon::centreond::common::generate_symkey(logger => $self->{logger},
-                                                                             cipher => $centreond_config->{centreondcore}{cipher},
-                                                                             keysize => $centreond_config->{centreondcore}{keysize});
-        if ($status == -1) {
-            centreon::centreond::common::zmq_core_response(socket => $self->{external_socket}, identity => $identity,
-                                                           code => 1, data => { message => 'handshake issue' });
-        }
-        if (centreon::centreond::common::add_identity(dbh => $self->{db_centreond}, identity => $identity, symkey => $symkey) == -1) {
-            centreon::centreond::common::zmq_core_response(socket => $self->{external_socket}, identity => $identity,
-                                                           code => 1, data => { message => 'handshake issue' });
-        }
-        if (centreon::centreond::common::zmq_core_key_response(logger => $self->{logger}, socket => $self->{external_socket}, identity => $identity,
-                                                               hostname => $self->{hostname}, symkey => $symkey) == -1) {
-            centreon::centreond::common::zmq_core_response(socket => $self->{external_socket}, identity => $identity,
-                                                           code => 1, data => { message => 'handshake issue' });
-        }
-        return undef;
-    }    
-}
-sub router_external_event {
-    while (1) {
-        my ($identity, $key, $message) = $centreond->handshake();
-        if (defined($message)) {
-            my ($token, $code, $response, $response_type) = $centreond->message_run(message => $message);
-            centreon::centreond::common::zmq_core_response(socket => $centreond->{external_socket},
-                                                           identity => $identity, response_type => $response_type,
-                                                           cipher => $centreond_config->{centreondcore}{cipher},
-                                                           vector => $centreond_config->{centreondcore}{vector},
-                                                           symkey => $key,
-                                                           token => $token, code => $code,
-                                                           data => $response);
-        }
-        last unless (centreon::centreond::common::zmq_still_read(socket => $centreond->{external_socket}));
-    }
-}
-sub waiting_ready_pool {
-    my (%options) = @_;
-    my $time = time();
-    while (time() - $time < 10) {
-        foreach my $pool_id (keys %{$options{pool}})  {
-            return 1 if ($options{pool}->{$pool_id}->{ready} == 1);
-        }
-        zmq_poll($centreond->{poll}, 5000);
-    }
-    foreach my $pool_id (keys %{$options{pool}})  {
-        return 1 if ($options{pool}->{$pool_id}->{ready} == 1);
-    }
-    return 0;
-}
-sub waiting_ready {
-    my (%options) = @_;
-    return 1 if (${$options{ready}} == 1);
-    my $time = time();
-    while (${$options{ready}} == 0 && 
-           time() - $time < 10) {
-        zmq_poll($centreond->{poll}, 5000);
-    }
-    if (${$options{ready}} == 0) {
-        return 0;
-    }
-    return 1;
-}
-sub clean_sessions {
-    my ($self, %options) = @_;
-    if ($self->{sessions_timer} - time() > $centreond_config->{centreondcore}{purge_sessions_time}) {
-        $self->{logger}->writeLogInfo("purge sessions in progress...");
-        $self->{db_centreond}->query("DELETE FROM centreond_identity WHERE `ctime` <  " . $self->{db_centreond}->quote(time() - $centreond_config->{centreondcore}{sessions_time}));
-        $self->{sessions_timer} = time();
-    }
-}
-sub quit {
-    my ($self, %options) = @_;
-    $self->{logger}->writeLogInfo("Quit main process");
-    zmq_close($self->{internal_socket});
-    if (defined($centreond_config->{centreondcore}{external_com_type}) && $centreond_config->{centreondcore}{external_com_type} ne '') {
-        zmq_close($self->{external_socket});
-    }
-    exit(0);
-}
-sub run {
-    $centreond = shift;
-    $centreond->SUPER::run();
-    $centreond->{logger}->redirect_output();
-    $centreond->{logger}->writeLogDebug("centreond launched....");
-    $centreond->{logger}->writeLogDebug("PID: $$");
-    if (centreon::centreond::common::add_history(dbh => $centreond->{db_centreond},
-                                                 code => 0,
-                                                 data => { msg => 'centreond is starting...' },
-                                                 json_encode => 1) == -1) {
-        $centreond->{logger}->writeLogInfo("Cannot write in history. We quit!!");
-        exit(1);
-    }
-    $centreond->{internal_socket} = centreon::centreond::common::create_com(type => $centreond_config->{centreondcore}{internal_com_type},
-                                            path => $centreond_config->{centreondcore}{internal_com_path},
-                                            zmq_type => 'ZMQ_ROUTER', name => 'router-internal',
-                                            logger => $centreond->{logger});
-    if (defined($centreond_config->{centreondcore}{external_com_type}) && $centreond_config->{centreondcore}{external_com_type} ne '') {
-        $centreond->{external_socket} = centreon::centreond::common::create_com(type => $centreond_config->{centreondcore}{external_com_type},
-                                                path => $centreond_config->{centreondcore}{external_com_path},
-                                                zmq_type => 'ZMQ_ROUTER', name => 'router-external',
-                                                logger => $centreond->{logger});
-    }
-    $centreond->{poll} = [
-        {
-            socket  => $centreond->{internal_socket},
-            events  => ZMQ_POLLIN,
-            callback => \&router_internal_event,
-        }
-    ];
-    if (defined($centreond->{external_socket})) {
-        push @{$centreond->{poll}}, {
-            socket  => $centreond->{external_socket},
-            events  => ZMQ_POLLIN,
-            callback => \&router_external_event,
-        };
-    }
-    foreach my $name (keys %{$centreond->{modules_register}}) {
-        $centreond->{logger}->writeLogInfo("Call init function from module '$name'");
-        $centreond->{modules_register}->{$name}->{init}->(logger => $centreond->{logger}, id => $centreond->{id},
-                                                          poll => $centreond->{poll},
-                                                          external_socket => $centreond->{external_socket},
-                                                          internal_socket => $centreond->{internal_socket},
-                                                          dbh => $centreond->{db_centreond});
-    }
-    $centreond->{logger}->writeLogInfo("[Server accepting clients]");
-    while (1) {
-        my $count = 0;
-        my $poll = [@{$centreond->{poll}}];
-        foreach my $name (keys %{$centreond->{modules_register}}) {
-            $count += $centreond->{modules_register}->{$name}->{check}->(logger => $centreond->{logger},
-                                                                         dead_childs => $centreond->{return_child},
-                                                                         internal_socket => $centreond->{internal_socket},
-                                                                         dbh => $centreond->{db_centreond},
-                                                                         poll => $poll);
-        }
-        if ($centreond->{stop} == 1) {
-            if ($count == 0) {
-                $centreond->quit();
-            }
-            if (time() - $centreond->{kill_timer} > $centreond_config->{centreondcore}{timeout}) {
-                foreach my $name (keys %{$centreond->{modules_register}}) {
-                    $centreond->{modules_register}->{$name}->{kill_internal}->(logger => $centreond->{logger});
-                }
-                $centreond->quit();
-            }
-        }
-        zmq_poll($poll, 5000);
-        $centreond->clean_sessions();
-    }
-}
-1;
-__END__

--- a/bin/centreond/modules/centreondacl/class.pm
+++ b//dev/null
@@ -1,92 +0,0 @@
-package modules::centreondacl::class;
-use strict;
-use warnings;
-use centreon::centreond::common;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-my %handlers = (TERM => {}, HUP => {});
-my ($connector, $socket);
-sub new {
-    my ($class, %options) = @_;
-    $connector  = {};
-    $connector->{logger} = $options{logger};
-    $connector->{organization_id} = $options{organization_id};
-    $connector->{config} = $options{config};
-    $connector->{config_core} = $options{config_core};
-    $connector->{stop} = 0;
-    bless $connector, $class;
-    $connector->set_signal_handlers;
-    return $connector;
-}
-sub set_signal_handlers {
-    my $self = shift;
-    $SIG{TERM} = \&class_handle_TERM;
-    $handlers{TERM}->{$self} = sub { $self->handle_TERM() };
-    $SIG{HUP} = \&class_handle_HUP;
-    $handlers{HUP}->{$self} = sub { $self->handle_HUP() };
-}
-sub handle_HUP {
-    my $self = shift;
-    $self->{reload} = 0;
-}
-sub handle_TERM {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("centreond-acl $$ Receiving order to stop...");
-    $self->{stop} = 1;
-}
-sub class_handle_TERM {
-    foreach (keys %{$handlers{TERM}}) {
-        &{$handlers{TERM}->{$_}}();
-    }
-}
-sub class_handle_HUP {
-    foreach (keys %{$handlers{HUP}}) {
-        &{$handlers{HUP}->{$_}}();
-    }
-}
-sub event {
-    while (1) {
-        my $message = centreon::centreond::common::zmq_dealer_read_message(socket => $socket);
-        $connector->{logger}->writeLogDebug("centreondacl: class: $message");
-        last unless (centreon::centreond::common::zmq_still_read(socket => $socket));
-    }
-}
-sub run {
-    my ($self, %options) = @_;
-    my $on_demand = (defined($options{on_demand}) && $options{on_demand} == 1) ? 1 : 0;
-    my $on_demand_time = time();
-    $socket = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondacl-' . $self->{organization_id},
-                                                       logger => $self->{logger},
-                                                       type => $self->{config_core}{internal_com_type},
-                                                       path => $self->{config_core}{internal_com_path});
-    centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                  action => 'ACLREADY', data => { organization_id => $self->{organization_id} },
-                                                  json_encode => 1);
-    $self->{poll} = [
-            {
-            socket  => $socket,
-            events  => ZMQ_POLLIN,
-            callback => \&event,
-            }
-    ];
-    while (1) {
-        my $rev = zmq_poll($self->{poll}, 5000);
-        if ($rev == 0 && $self->{stop} == 1) {
-            $self->{logger}->writeLogInfo("centreond-acl $$ has quit");
-            zmq_close($socket);
-            exit(0);
-        }
-        if ($on_demand == 1) {
-            if ($rev == 0) {
-                if (time() - $on_demand_time > $self->{config}{on_demand_time}) {
-                    $self->{logger}->writeLogInfo("centreond-acl $$ has quit");
-                    zmq_close($socket);
-                    exit(0);
-                }
-            } else {
-                $on_demand_time = time();
-            }
-        }
-    }
-}
-1;

--- a/bin/centreond/modules/centreondacl/hooks.pm
+++ b//dev/null
@@ -1,151 +0,0 @@
-package modules::centreondacl::hooks;
-use warnings;
-use strict;
-use centreon::script::centreondcore;
-use modules::centreondacl::class;
-my $config_core;
-my $config;
-my $module_id = 'centreondacl';
-my $events = [
-    'ACLREADY', 'ACLADDHOST', 'ACLADDSERVICE', 'PURGEORGANIZATION',
-];
-my $last_organizations = {}; # Last values from centreon database
-my $organizations = {};
-my $organizations_pid = {};
-my $stop = 0;
-my $timer_check = time();
-my $config_check_organizations_time;
-my $on_demand = 0;
-sub register {
-    my (%options) = @_;
-    $config = $options{config};
-    $config_core = $options{config_core};
-    $config_check_organizations_time = defined($config->{check_organizations_time}) ? $config->{check_organizations_time} : 3600;
-    $on_demand = defined($config->{on_demand}) && $config->{on_demand} == 1 ? 1 : 0;
-    return ($events, $module_id);
-}
-sub init {
-    my (%options) = @_;
-    $last_organizations = get_organizations();
-    return if ($on_demand == 1);
-    foreach my $organization_id (keys %{$last_organizations}) {
-        create_child(organization_id => $organization_id, logger => $options{logger});
-    }
-}
-sub routing {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot decode json data: $@");
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 100, token => $options{token},
-                                                 data => { message => 'centreondacl: cannot decode json' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($options{action} eq 'ACLREADY') {
-        $organizations->{$data->{organization_id}}->{ready} = 1;
-        return undef;
-    }
-    if (!defined($data->{organization_id}) || !defined($last_organizations->{$data->{organization_id}})) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 100, token => $options{token},
-                                                 data => { message => 'centreondacl: need a valid organization id' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($on_demand == 1) {
-        if (!defined($organizations->{$data->{organization_id}})) {
-            create_child(organization_id => $data->{organization_id}, logger => $options{logger}, on_demand => 1);
-        }
-    }
-    if (centreon::script::centreondcore::waiting_ready(ready => \$organizations->{$data->{organization_id}}->{ready}) == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 100, token => $options{token},
-                                                 data => { message => 'centreondacl: still no ready' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket}, identity => 'centreondacl-' . $data->{organization_id},
-                                                  action => $options{action}, data => $options{data}, token => $options{token},
-                                                  );
-}
-sub gently {
-    my (%options) = @_;
-    $stop = 1;
-    return if ($on_demand == 1);
-    foreach my $organization_id (keys %{$organizations}) {
-        $options{logger}->writeLogInfo("centreond-acl: Send TERM signal for organization '" . $organization_id . "'");
-        if ($organizations->{$organization_id}->{running} == 1) {
-            kill('TERM', $organizations->{$organization_id}->{pid});
-        }
-    }
-}
-sub kill_internal {
-    my (%options) = @_;
-    foreach (keys %{$organizations}) {
-        if ($organizations->{$_}->{running} == 1) {
-            $options{logger}->writeLogInfo("centreond-acl: Send KILL signal for organization '" . $_ . "'");
-            kill('KILL', $organizations->{$_}->{pid});
-        }
-    }
-}
-sub kill {
-    my (%options) = @_;
-}
-sub check {
-    my (%options) = @_;
-    if ($timer_check - time() > $config_check_organizations_time) {
-        sync_organization_childs(logger => $options{logger});
-        $timer_check = time();
-    }
-    my $count = 0;
-    foreach my $pid (keys %{$options{dead_childs}}) {
-        next if (!defined($organizations_pid->{$pid}));
-        delete $organizations->{$organizations_pid->{$pid}};
-        delete $organizations_pid->{$pid};
-        delete $options{dead_childs}->{$pid};
-        if ($stop == 0 && $on_demand == 0) {
-            sync_organization_childs(logger => $options{logger});
-        }
-    }
-    foreach (keys %{$organizations}) {
-        $count++  if ($organizations->{$_}->{running} == 1);
-    }
-    return $count;
-}
-sub get_organizations {
-    my (%options) = @_;
-    my $orgas = { 10 => 1, 25 => 1, 50 => 1, 100 => 1, 13 => 1 };    
-    return $orgas;
-}
-sub sync_organization_childs {
-    my (%options) = @_;
-    $last_organizations = get_organizations();
-    foreach my $organization_id (keys %{$last_organizations}) {
-        if (!defined($organizations->{$organization_id}) && $on_demand == 0) {
-            create_child(organization_id => $organization_id, logger => $options{logger});
-        }
-    }
-}
-sub create_child {
-    my (%options) = @_;
-    $options{logger}->writeLogInfo("Create centreondacl for organization id '" . $options{organization_id} . "'");
-    my $child_pid = fork();
-    if ($child_pid == 0) {
-        my $module = modules::centreondacl::class->new(logger => $options{logger},
-                                                       config_core => $config_core,
-                                                       config => $config,
-                                                       organization_id => $options{organization_id}
-                                                       );
-        $module->run(on_demand => $options{on_demand});
-        exit(0);
-    }
-    $options{logger}->writeLogInfo("PID $child_pid for centreondacl for organization id '" . $options{organization_id} . "'");
-    $organizations->{$options{organization_id}} = { pid => $child_pid, ready => 0, running => 1 };
-    $organizations_pid->{$child_pid} = $options{organization_id};
-}
-1;

--- a/bin/centreond/modules/centreondaction/class.pm
+++ b//dev/null
@@ -1,195 +0,0 @@
-package modules::centreondaction::class;
-use strict;
-use warnings;
-use centreon::centreond::common;
-use centreon::common::misc;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-my %handlers = (TERM => {}, HUP => {});
-my ($connector, $socket);
-sub new {
-    my ($class, %options) = @_;
-    $connector  = {};
-    $connector->{logger} = $options{logger};
-    $connector->{config} = $options{config};
-    $connector->{config_core} = $options{config_core};
-    $connector->{stop} = 0;
-    $connector->{enginecommand_timeout} = defined($connector->{config}{enginecommand_timeout}) ? $connector->{config}{enginecommand_timeout} : 30;
-    $connector->{command_timeout} = defined($connector->{config}{command_timeout}) ? $connector->{config}{command_timeout} : 30;
-    bless $connector, $class;
-    $connector->set_signal_handlers;
-    return $connector;
-}
-sub set_signal_handlers {
-    my $self = shift;
-    $SIG{TERM} = \&class_handle_TERM;
-    $handlers{TERM}->{$self} = sub { $self->handle_TERM() };
-    $SIG{HUP} = \&class_handle_HUP;
-    $handlers{HUP}->{$self} = sub { $self->handle_HUP() };
-}
-sub handle_HUP {
-    my $self = shift;
-    $self->{reload} = 0;
-}
-sub handle_TERM {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("centreond-action $$ Receiving order to stop...");
-    $self->{stop} = 1;
-}
-sub class_handle_TERM {
-    foreach (keys %{$handlers{TERM}}) {
-        &{$handlers{TERM}->{$_}}();
-    }
-}
-sub class_handle_HUP {
-    foreach (keys %{$handlers{HUP}}) {
-        &{$handlers{HUP}->{$_}}();
-    }
-}
-sub action_command {
-    my ($self, %options) = @_;
-    if (!defined($options{data}->{command}) || $options{data}->{command} eq '') {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "need command argument" } },
-                                                      json_encode => 1);
-        return -1;
-    }
-    my ($error, $stdout, $return_code) = centreon::common::misc::backtick(command => $options{data}->{command},
-                                                                          timeout => $self->{command_timeout},
-                                                                          wait_exit => 1,
-                                                                          redirect_stderr => 1,
-                                                                          logger => $self->{logger});
-    if ($error <= -1000) {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' execution issue: $stdout" } },
-                                                      json_encode => 1);
-        return -1;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                  action => 'PUTLOG', data => { code => 36, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' had finished", stdout => $stdout, exit_code => $return_code } },
-                                                  json_encode => 1);
-    return 0;
-}
-sub action_enginecommand {
-    my ($self, %options) = @_;
-    if (!defined($options{data}->{engine_pipe}) || $options{data}->{engine_pipe} eq '') {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "need engine_pipe argument" } },
-                                                      json_encode => 1);
-        return -1;
-    }    
-    if (! -e $options{data}->{engine_pipe}) {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' - engine_pipe '$options{data}->{engine_pipe}' must exist" } },
-                                                      json_encode => 1);
-        return -1;
-    }
-    if (! -p $options{data}->{engine_pipe}) {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' - engine_pipe '$options{data}->{engine_pipe}' must be a pipe file" } },
-                                                      json_encode => 1);
-        return -1;
-    }
-    if (! -w $options{data}->{engine_pipe}) {
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' - engine_pipe '$options{data}->{engine_pipe}' must be writeable" } },
-                                                      json_encode => 1);
-        return -1;
-    }
-    $self->{logger}->writeLogDebug("centreond-action: class: submit engine command '$options{data}->{command}'");
-    my $fh;
-    eval {
-        local $SIG{ALRM} = sub { die "Timeout command\n" };
-        alarm $self->{enginecommand_timeout};
-        open($fh, ">", $options{data}->{engine_pipe}) or die "cannot open '$options{data}->{engine_pipe}': $!";
-        print $fh $options{data}->{command} . "\n";
-        close $fh;
-        alarm 0;
-    };
-    if ($@) {
-        close $fh if (defined($fh));
-        $self->{logger}->writeLogError("centreond-action: class: submit engine command '$options{data}->{command}' issue: $@");
-        centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                      action => 'PUTLOG', data => { code => 35, etime => time(), token => $options{token}, data => { message => "submit command issue '$options{data}->{command}': $@" } },
-                                                      json_encode => 1);
-        return undef;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket_log},
-                                                  action => 'PUTLOG', data => { code => 36, etime => time(), token => $options{token}, data => { message => "command '$options{data}->{command}' had been submitted" } },
-                                                  json_encode => 1);
-    return 0;
-}
-sub action_run {
-    my ($self, %options) = @_;
-    my $socket_log = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondaction-'. $$,
-                                                              logger => $self->{logger}, linger => 5000,
-                                                              type => $self->{config_core}{internal_com_type},
-                                                              path => $self->{config_core}{internal_com_path});
-    if ($options{action} eq 'COMMAND') {
-        $self->action_command(%options, socket_log => $socket_log);
-    } elsif ($options{action} eq 'ENGINECOMMAND') {
-        $self->action_enginecommand(%options, socket_log => $socket_log);
-    }
-    centreon::centreond::common::zmq_send_message(socket => $socket_log,
-                                                  action => 'PUTLOG', data => { code => 32, etime => time(), token => $options{token}, data => { message => "proceed action end" } },
-                                                  json_encode => 1);
-    zmq_close($socket_log);
-}
-sub create_child {
-    my ($self, %options) = @_;
-    $self->{logger}->writeLogInfo("Create centreondaction sub-process");
-    $options{message} =~ /^\[(.*?)\]\s+\[(.*?)\]\s+\[.*?\]\s+(.*)$/m;
-    my ($action, $token) = ($1, $2);
-    my $data = JSON->new->utf8->decode($3);
-    my $child_pid = fork();
-    if (!defined($child_pid)) {
-        centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                      action => 'PUTLOG', data => { code => 30, etime => time(), token => $token, data => { message => "cannot fork: $!" } },
-                                                      json_encode => 1);
-        return undef;
-    }
-    if ($child_pid == 0) {
-        $self->action_run(action => $action, token => $token, data => $data);
-        exit(0);
-    } else {
-        centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                      action => 'PUTLOG', data => { code => 31, etime => time(), token => $token, data => { message => "proceed action" } },
-                                                      json_encode => 1);
-    }
-}
-sub event {
-    while (1) {
-        my $message = centreon::centreond::common::zmq_dealer_read_message(socket => $socket);
-        $connector->{logger}->writeLogDebug("centreondaction: class: $message");
-        if ($message !~ /^\[ACK\]/) {
-            $connector->create_child(message => $message);
-        }
-        last unless (centreon::centreond::common::zmq_still_read(socket => $socket));
-    }
-}
-sub run {
-    my ($self, %options) = @_;
-    $socket = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondaction',
-                                                       logger => $self->{logger},
-                                                       type => $self->{config_core}{internal_com_type},
-                                                       path => $self->{config_core}{internal_com_path});
-    centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                  action => 'ACTIONREADY', data => { },
-                                                  json_encode => 1);
-    $self->{poll} = [
-            {
-            socket  => $socket,
-            events  => ZMQ_POLLIN,
-            callback => \&event,
-            }
-    ];
-    while (1) {
-        my $rev = zmq_poll($self->{poll}, 5000);
-        if ($rev == 0 && $self->{stop} == 1) {
-            $self->{logger}->writeLogInfo("centreond-action $$ has quit");
-            zmq_close($socket);
-            exit(0);
-        }
-    }
-}
-1;

--- a/bin/centreond/modules/centreondaction/hooks.pm
+++ b//dev/null
@@ -1,106 +0,0 @@
-package modules::centreondaction::hooks;
-use warnings;
-use strict;
-use centreon::script::centreondcore;
-use modules::centreondaction::class;
-my $config_core;
-my $config;
-my $module_id = 'centreondaction';
-my $events = [
-    'ACTIONREADY',
-];
-my $action = {};
-my $stop = 0;
-sub register {
-    my (%options) = @_;
-    $config = $options{config};
-    $config_core = $options{config_core};
-    if (!defined($config->{disable_command_event}) || $config->{disable_command_event} != 1) {
-        push @{$events}, 'COMMAND';
-    }
-    if (!defined($config->{disable_enginecommand_event}) || $config->{disable_enginecommand_event} != 1) {
-        push @{$events}, 'ENGINECOMMAND';
-    }
-    return ($events, $module_id);
-}
-sub init {
-    my (%options) = @_;
-    create_child(logger => $options{logger});
-}
-sub routing {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot decode json data: $@");
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 30, token => $options{token},
-                                                 data => { msg => 'centreondaction: cannot decode json' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($options{action} eq 'ACTIONREADY') {
-        $action->{ready} = 1;
-        return undef;
-    }
-    if (centreon::script::centreondcore::waiting_ready(ready => \$action->{ready}) == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 30, token => $options{token},
-                                                 data => { msg => 'centreondaction: still no ready' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket}, identity => 'centreondaction',
-                                                  action => $options{action}, data => $options{data}, token => $options{token},
-                                                  );
-}
-sub gently {
-    my (%options) = @_;
-    $stop = 1;
-    $options{logger}->writeLogInfo("centreond-action: Send TERM signal");
-    if ($action->{running} == 1) {
-        kill('TERM', $action->{pid});
-    }
-}
-sub kill {
-    my (%options) = @_;
-    if ($action->{running} == 1) {
-        $options{logger}->writeLogInfo("centreond-action: Send KILL signal for pool");
-        kill('KILL', $action->{pid});
-    }
-}
-sub kill_internal {
-    my (%options) = @_;
-}
-sub check {
-    my (%options) = @_;
-    my $count = 0;
-    foreach my $pid (keys %{$options{dead_childs}}) {
-        next if ($action->{pid} != $pid);
-        $action = {};
-        delete $options{dead_childs}->{$pid};
-        if ($stop == 0) {
-            create_child(logger => $options{logger});
-        }
-    }
-    $count++  if (defined($action->{running}) && $action->{running} == 1);
-    return $count;
-}
-sub create_child {
-    my (%options) = @_;
-    $options{logger}->writeLogInfo("Create centreondaction process");
-    my $child_pid = fork();
-    if ($child_pid == 0) {
-        my $module = modules::centreondaction::class->new(logger => $options{logger},
-                                                          config_core => $config_core,
-                                                          config => $config,
-                                                          );
-        $module->run();
-        exit(0);
-    }
-    $options{logger}->writeLogInfo("PID $child_pid centreondaction");
-    $action = { pid => $child_pid, ready => 0, running => 1 };
-}
-1;

--- a/bin/centreond/modules/centreondcron/class.pm
+++ b//dev/null
@@ -1,88 +0,0 @@
-package modules::centreondcron::class;
-use strict;
-use warnings;
-use centreon::centreond::common;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-use Schedule::Cron;
-my %handlers = (TERM => {}, HUP => {});
-my ($connector, $socket);
-sub new {
-    my ($class, %options) = @_;
-    $connector  = {};
-    $connector->{logger} = $options{logger};
-    $connector->{config} = $options{config};
-    $connector->{config_core} = $options{config_core};
-    $connector->{stop} = 0;
-    bless $connector, $class;
-    $connector->set_signal_handlers;
-    return $connector;
-}
-sub set_signal_handlers {
-    my $self = shift;
-    $SIG{TERM} = \&class_handle_TERM;
-    $handlers{TERM}->{$self} = sub { $self->handle_TERM() };
-    $SIG{HUP} = \&class_handle_HUP;
-    $handlers{HUP}->{$self} = sub { $self->handle_HUP() };
-}
-sub handle_HUP {
-    my $self = shift;
-    $self->{reload} = 0;
-}
-sub handle_TERM {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("centreond-action $$ Receiving order to stop...");
-    $self->{stop} = 1;
-}
-sub class_handle_TERM {
-    foreach (keys %{$handlers{TERM}}) {
-        &{$handlers{TERM}->{$_}}();
-    }
-}
-sub class_handle_HUP {
-    foreach (keys %{$handlers{HUP}}) {
-        &{$handlers{HUP}->{$_}}();
-    }
-}
-sub event {
-    while (1) {
-        my $message = centreon::centreond::common::zmq_dealer_read_message(socket => $socket);
-        $connector->{logger}->writeLogDebug("centreondcron: class: $message");
-        last unless (centreon::centreond::common::zmq_still_read(socket => $socket));
-    }
-}
-sub cron_sleep {
-    my $rev = zmq_poll($connector->{poll}, 1000);
-    if ($rev == 0 && $connector->{stop} == 1) {
-        $connector->{logger}->writeLogInfo("centreond-cron $$ has quit");
-        zmq_close($socket);
-        exit(0);
-    }
-}
-sub dispatcher {
-    my ($options) = @_;
-    $options->{logger}->writeLogInfo("Job is starting");    
-}
-sub run {
-    my ($self, %options) = @_;
-    $socket = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondcron',
-                                                       logger => $self->{logger},
-                                                       type => $self->{config_core}{internal_com_type},
-                                                       path => $self->{config_core}{internal_com_path});
-    centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                  action => 'CRONREADY', data => { },
-                                                  json_encode => 1);
-    $self->{poll} = [
-            {
-            socket  => $socket,
-            events  => ZMQ_POLLIN,
-            callback => \&event,
-            }
-    ];
-    my $cron = new Schedule::Cron(\&dispatcher, nostatus => 1, nofork => 1);
-    $cron->add_entry('* * * * *', \&dispatcher, { logger => $self->{logger}, plop => 1 });
-    $cron->run(sleep => \&cron_sleep);
-    zmq_close($socket);
-    exit(0);
-}
-1;

--- a/bin/centreond/modules/centreondcron/hooks.pm
+++ b//dev/null
@@ -1,100 +0,0 @@
-package modules::centreondcron::hooks;
-use warnings;
-use strict;
-use centreon::script::centreondcore;
-use modules::centreondcron::class;
-my $config_core;
-my $config;
-my $module_id = 'centreondcron';
-my $events = [
-    'CRONREADY', 'RELOADCRON',
-];
-my $cron = {};
-my $stop = 0;
-sub register {
-    my (%options) = @_;
-    $config = $options{config};
-    $config_core = $options{config_core};
-    return ($events, $module_id);
-}
-sub init {
-    my (%options) = @_;
-    create_child(logger => $options{logger});
-}
-sub routing {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot decode json data: $@");
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 10, token => $options{token},
-                                                 data => { message => 'centreondcron: cannot decode json' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($options{action} eq 'CRONREADY') {
-        $cron->{ready} = 1;
-        return undef;
-    }
-    if (centreon::script::centreondcore::waiting_ready(ready => \$cron->{ready}) == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 10, token => $options{token},
-                                                 data => { message => 'centreondcron: still no ready' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket}, identity => 'centreondcron',
-                                                  action => $options{action}, data => $options{data}, token => $options{token},
-                                                  );
-}
-sub gently {
-    my (%options) = @_;
-    $stop = 1;
-    $options{logger}->writeLogInfo("centreond-cron: Send TERM signal");
-    if ($cron->{running} == 1) {
-        kill('TERM', $cron->{pid});
-    }
-}
-sub kill {
-    my (%options) = @_;
-    if ($cron->{running} == 1) {
-        $options{logger}->writeLogInfo("centreond-cron: Send KILL signal for pool");
-        kill('KILL', $cron->{pid});
-    }
-}
-sub kill_internal {
-    my (%options) = @_;
-}
-sub check {
-    my (%options) = @_;
-    my $count = 0;
-    foreach my $pid (keys %{$options{dead_childs}}) {
-        next if ($cron->{pid} != $pid);
-        $cron = {};
-        delete $options{dead_childs}->{$pid};
-        if ($stop == 0) {
-            create_child(logger => $options{logger});
-        }
-    }
-    $count++  if (defined($cron->{running}) && $cron->{running} == 1);
-    return $count;
-}
-sub create_child {
-    my (%options) = @_;
-    $options{logger}->writeLogInfo("Create centreondaction process");
-    my $child_pid = fork();
-    if ($child_pid == 0) {
-        my $module = modules::centreondcron::class->new(logger => $options{logger},
-                                                        config_core => $config_core,
-                                                        config => $config,
-                                                        );
-        $module->run();
-        exit(0);
-    }
-    $options{logger}->writeLogInfo("PID $child_pid centreondaction");
-    $cron = { pid => $child_pid, ready => 0, running => 1 };
-}
-1;

--- a/bin/centreond/modules/centreondproxy/class.pm
+++ b//dev/null
@@ -1,169 +0,0 @@
-package modules::centreondproxy::class;
-use strict;
-use warnings;
-use centreon::centreond::common;
-use centreon::centreond::clientzmq;
-use ZMQ::LibZMQ3;
-use ZMQ::Constants qw(:all);
-my %handlers = (TERM => {}, HUP => {});
-my ($connector, $socket);
-sub new {
-    my ($class, %options) = @_;
-    $connector  = {};
-    $connector->{logger} = $options{logger};
-    $connector->{core_id} = $options{core_id};
-    $connector->{pool_id} = $options{pool_id};
-    $connector->{config} = $options{config};
-    $connector->{config_core} = $options{config_core};
-    $connector->{stop} = 0;
-    $connector->{clients} = {};
-    bless $connector, $class;
-    $connector->set_signal_handlers;
-    return $connector;
-}
-sub set_signal_handlers {
-    my $self = shift;
-    $SIG{TERM} = \&class_handle_TERM;
-    $handlers{TERM}->{$self} = sub { $self->handle_TERM() };
-    $SIG{HUP} = \&class_handle_HUP;
-    $handlers{HUP}->{$self} = sub { $self->handle_HUP() };
-}
-sub handle_HUP {
-    my $self = shift;
-    $self->{reload} = 0;
-}
-sub handle_TERM {
-    my $self = shift;
-    $self->{logger}->writeLogInfo("centreond-proxy $$ Receiving order to stop...");
-    $self->{stop} = 1;
-}
-sub class_handle_TERM {
-    foreach (keys %{$handlers{TERM}}) {
-        &{$handlers{TERM}->{$_}}();
-    }
-}
-sub class_handle_HUP {
-    foreach (keys %{$handlers{HUP}}) {
-        &{$handlers{HUP}->{$_}}();
-    }
-}
-sub get_client_information {
-    my ($self, %options) = @_;
-    my $result = { type => 1, target_type => 'tcp', target_path => 'localhost:5556',
-                   pubkey => 'keys/poller/pubkey.crt', cipher => 'Crypt::OpenSSL::AES',
-                   keysize => '32', vector => '0123456789012345', class => undef, delete => 0 };
-    return $result;
-}
-sub read_message {
-    my (%options) = @_;
-    return undef if (!defined($options{identity}) || $options{identity} !~ /^proxy-(.*?)-(.*?)$/);
-    my ($client_identity) = ($2);
-    if ($options{data} =~ /^\[PONG\]/) {
-        if ($options{data} !~ /^\[(.+?)\]\s+\[(.*?)\]\s+\[(.*?)\]/m) {
-            return undef;
-        }
-        my ($action, $token) = ($1, $2);
-        centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                      action => 'PONG', token => $token, target => '',
-                                                      data => { code => 0, data => { message => 'ping ok', action => 'ping', id => $client_identity } },
-                                                      json_encode => 1);
-    }
-    elsif ($options{data} =~ /^\[ACK\]\s+\[(.*?)\]\s+(.*)/m) {
-        my $data;
-        eval {
-            $data = JSON->new->utf8->decode($2);
-        };
-        if ($@) {
-            return undef;
-        }
-        if (defined($data->{data}->{action}) && $data->{data}->{action} eq 'getlog') {
-            centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                          action => 'SETLOGS', token => $1, target => '',
-                                                          data => $2);
-        }
-        return undef;
-    }
-}
-sub connect {
-    my ($self, %options) = @_;
-    if ($options{entry}->{type} == 1) {
-        $options{entry}->{class} = centreon::centreond::clientzmq->new(identity => 'proxy-' . $self->{core_id} . '-' . $options{id}, 
-                                                      cipher => $options{entry}->{cipher}, 
-                                                      vector => $options{entry}->{vector},
-                                                      pubkey => $options{entry}->{pubkey},
-                                                      target_type => $options{entry}->{target_type},
-                                                      target_path => $options{entry}->{target_path},
-                                                      logger => $self->{logger}
-                                                      );
-        $options{entry}->{class}->init(callback => \&read_message);
-    }
-}
-sub proxy {
-    my (%options) = @_;
-    if ($options{message} !~ /^\[(.+?)\]\s+\[(.*?)\]\s+\[(.*?)\]\s+(.*)$/m) {
-        return undef;
-    }
-    my ($action, $token, $target, $data) = ($1, $2, $3, $4);
-    my $entry;
-    if (!defined($connector->{clients}->{$target})) {
-        $entry = $connector->get_client_information(id => $target);
-        return if (!defined($entry));
-        $connector->connect(id => $target, entry => $entry);
-    } else {
-        $entry = $connector->{clients}->{$target};
-    }
-    if ($entry->{type} == 1) {
-        my ($status, $msg) = $entry->{class}->send_message(action => $action, token => $token,
-                                                           target => '', data => $data);
-        if ($status == 0) {
-            $connector->{clients}->{$target} = $entry;
-        } else {
-            $connector->{logger}->writeLogError("centreondproxy: class: send message problem for '$target': $msg");
-            $connector->{clients}->{$target}->{delete} = 1 if (defined($connector->{clients}->{$target}));
-        }
-    }
-    $connector->{logger}->writeLogDebug("centreondproxy: class: [action = $action] [token = $token] [target = $target] [data = $data]");
-}
-sub event_internal {
-    while (1) {
-        my $message = centreon::centreond::common::zmq_dealer_read_message(socket => $socket);
-        proxy(message => $message);        
-        last unless (centreon::centreond::common::zmq_still_read(socket => $socket));
-    }
-}
-sub run {
-    my ($self, %options) = @_;
-    $socket = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondproxy-' . $self->{pool_id},
-                                                       logger => $self->{logger},
-                                                       type => $self->{config_core}{internal_com_type},
-                                                       path => $self->{config_core}{internal_com_path});
-    centreon::centreond::common::zmq_send_message(socket => $socket,
-                                                  action => 'PROXYREADY', data => { pool_id => $self->{pool_id} },
-                                                  json_encode => 1);
-    my $poll = {
-            socket  => $socket,
-            events  => ZMQ_POLLIN,
-            callback => \&event_internal,
-    };
-    while (1) {
-        my $polls = [$poll];
-        foreach (keys %{$self->{clients}}) {
-            if ($self->{clients}->{$_}->{delete} == 1) {
-                $self->{clients}->{$_}->{class}->close();
-                delete $self->{clients}->{$_};
-                next;
-            }
-            if ($self->{clients}->{$_}->{type} == 1) {
-                push @{$polls}, $self->{clients}->{$_}->{class}->get_poll();
-            }
-        }
-        my $rev = zmq_poll($polls, 5000);
-        next if (!defined($rev));
-        if ($rev == 0 && $self->{stop} == 1) {
-            $self->{logger}->writeLogInfo("centreond-proxy $$ has quit");
-            zmq_close($socket);
-            exit(0);
-        }
-    }
-}
-1;

--- a/bin/centreond/modules/centreondproxy/hooks.pm
+++ b//dev/null
@@ -1,369 +0,0 @@
-package modules::centreondproxy::hooks;
-use warnings;
-use strict;
-use centreon::script::centreondcore;
-use centreon::centreond::common;
-use modules::centreondproxy::class;
-my $config_core;
-my $config;
-my $module_id = 'centreondproxy';
-my $events = [
-    'PROXYREADY', 'SETLOGS', 'PONG', 'REGISTERNODE', 'UNREGISTERNODE', # internal. Shouldn't be used by third party clients
-    'ADDPOLLER', 
-];
-my $synctime_error = 0;
-my $synctime_pollers = {}; # get last time retrieved
-my $synctime_lasttime;
-my $synctime_option;
-my $synctimeout_option;
-my $ping_option;
-my $ping_time = 0;
-my $last_pong = {}; 
-my $register_pollers = {};
-my $last_pollers = {}; # Last values from centreon database and the type
-my $pools = {};
-my $pools_pid = {};
-my $poller_pool = {};
-my $rr_current = 0;
-my $stop = 0;
-my ($external_socket, $internal_socket, $core_id);
-sub register {
-    my (%options) = @_;
-    $config = $options{config};
-    $config_core = $options{config_core};
-    return ($events, $module_id);
-}
-sub init {
-    my (%options) = @_;
-    $synctime_lasttime = time();
-    $synctime_option = defined($config->{synchistory_time}) ? $config->{synchistory_time} : 300;
-    $synctimeout_option = defined($config->{synchistory_timeout}) ? $config->{synchistory_timeout} : 120;
-    $ping_option = defined($config->{ping}) ? $config->{ping} : 60;
-    $core_id = $options{id};
-    $external_socket = $options{external_socket};
-    $internal_socket = $options{internal_socket};
-    $last_pollers = get_pollers(dbh => $options{dbh});
-    for my $pool_id (1..$config->{pool}) {
-        create_child(pool_id => $pool_id, logger => $options{logger});
-    }
-}
-sub routing {
-    my (%options) = @_;
-    my $data;
-    eval {
-        $data = JSON->new->utf8->decode($options{data});
-    };
-    if ($@) {
-        $options{logger}->writeLogError("Cannot decode json data: $@");
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => 'centreondproxy: cannot decode json' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($options{action} eq 'PONG') {
-        return undef if (!defined($data->{data}->{id}) || $data->{data}->{id} eq '');
-        $last_pong->{$data->{data}->{id}} = time();
-        $options{logger}->writeLogInfo("centreond-proxy: pong received from '" . $data->{data}->{id} . "'");
-        return undef;
-    }
-    if ($options{action} eq 'UNREGISTERNODE') {
-        $options{logger}->writeLogInfo("centreond-proxy: poller '" . $data->{id} . "' is unregistered");
-        if (defined($register_pollers->{$data->{id}})) {
-            delete $register_pollers->{$data->{id}};
-            delete $synctime_pollers->{$data->{id}};
-        }
-        return undef;
-    }
-    if ($options{action} eq 'REGISTERNODE') {
-        $options{logger}->writeLogInfo("centreond-proxy: poller '" . $data->{id} . "' is registered");
-        $register_pollers->{$data->{id}} = 1;
-        $last_pong->{$data->{id}} = 0 if (!defined($last_pong->{$data->{id}}));
-        if ($synctime_error == 0 && !defined($synctime_pollers->{$options{target}}) &&
-            !defined($synctime_pollers->{$data->{id}})) {
-            $synctime_pollers->{$data->{id}} = { ctime => 0, in_progress => 0, in_progress_time => -1, last_id => 0 }; 
-        }
-        return undef;
-    }
-    if ($options{action} eq 'PROXYREADY') {
-        $pools->{$data->{pool_id}}->{ready} = 1;
-        return undef;
-    }
-    if ($options{action} eq 'SETLOGS') {
-        setlogs(dbh => $options{dbh}, data => $data, token => $options{token}, logger => $options{logger});
-        return undef;
-    }
-    if (!defined($options{target}) || 
-        (!defined($last_pollers->{$options{target}}) && !defined($register_pollers->{$options{target}}))) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => 'centreondproxy: need a valid poller id' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($options{action} eq 'GETLOG') {
-        if ($synctime_error == -1 || get_sync_time(dbh => $options{dbh}) == -1) {
-            centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                     code => 20, token => $options{token},
-                                                     data => { message => 'centreondproxy: problem to getlog' },
-                                                     json_encode => 1);
-            return undef;
-        }
-        if ($synctime_pollers->{$options{target}}->{in_progress} == 1) {
-            centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                     code => 20, token => $options{token},
-                                                     data => { message => 'centreondproxy: getlog already in progress' },
-                                                     json_encode => 1);
-            return undef;
-        }
-        if (defined($last_pollers->{$options{target}}) && $last_pollers->{$options{target}}->{type} == 2) {
-            centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                     code => 20, token => $options{token},
-                                                     data => { message => "centreondproxy: can't get log a ssh target" },
-                                                     json_encode => 1);
-            return undef;
-        }
-        my $ctime = $synctime_pollers->{$options{target}}->{ctime};
-        my $last_id = $synctime_pollers->{$options{target}}->{last_id};
-        $options{data} = centreon::centreond::common::json_encode(data => { ctime => $ctime, id => $last_id });
-        $synctime_pollers->{$options{target}}->{in_progress} = 1;
-        $synctime_pollers->{$options{target}}->{in_progress_time} = time();
-    }
-    if (defined($register_pollers->{$options{target}})) {
-        pull_request(%options, data_decoded => $data);
-        return undef;
-    }
-    if (centreon::script::centreondcore::waiting_ready_pool(pool => $pools) == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => 'centreondproxy: still none ready' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    my $identity;
-    if (defined($poller_pool->{$options{target}})) {
-        $identity = $poller_pool->{$options{target}};
-    } else {
-        $identity = rr_pool();
-        $poller_pool->{$options{target}} = $identity;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $options{socket}, identity => 'centreondproxy-' . $identity,
-                                                  action => $options{action}, data => $options{data}, token => $options{token},
-                                                  target => $options{target}
-                                                  );
-}
-sub gently {
-    my (%options) = @_;
-    $stop = 1;
-    foreach my $pool_id (keys %{$pools}) {
-        $options{logger}->writeLogInfo("centreond-proxy: Send TERM signal for pool '" . $pool_id . "'");
-        if ($pools->{$pool_id}->{running} == 1) {
-            kill('TERM', $pools->{$pool_id}->{pid});
-        }
-    }
-}
-sub kill {
-    my (%options) = @_;
-    foreach (keys %{$pools}) {
-        if ($pools->{$_}->{running} == 1) {
-            $options{logger}->writeLogInfo("centreond-proxy: Send KILL signal for pool '" . $_ . "'");
-            kill('KILL', $pools->{$_}->{pid});
-        }
-    }
-}
-sub kill_internal {
-    my (%options) = @_;
-}
-sub check {
-    my (%options) = @_;
-    my $count = 0;
-    foreach my $pid (keys %{$options{dead_childs}}) {
-        next if (!defined($pools_pid->{$pid}));
-        my $pool_id = $pools_pid->{$pid};
-        delete $pools->{$pools_pid->{$pid}};
-        delete $pools_pid->{$pid};
-        delete $options{dead_childs}->{$pid};
-        if ($stop == 0) {
-            create_child(pool_id => $pool_id, logger => $options{logger});
-        }
-    }
-    foreach (keys %{$pools}) {
-        $count++  if ($pools->{$_}->{running} == 1);
-    }
-    foreach (keys %{$synctime_pollers}) {
-        if ($synctime_pollers->{$_}->{in_progress} == 1 && 
-            time() - $synctime_pollers->{$_}->{in_progress_time} > $synctimeout_option) {
-            centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                     code => 20,
-                                                     data => { message => "centreondproxy: getlog in timeout for '$_'" },
-                                                     json_encode => 1);
-            $synctime_pollers->{$_}->{in_progress} = 0;
-        }
-    }
-    if ($stop == 0 && 
-        ($synctime_error == 0 || get_sync_time(dbh => $options{dbh}) == 0) &&
-        time() - $synctime_lasttime > $synctime_option) {
-        $synctime_lasttime = time();
-        full_sync_history(dbh => $options{dbh});
-    }
-    if ($stop == 0 &&
-        time() - $ping_time > $ping_option) {
-        $options{logger}->writeLogInfo("centreond-proxy: send pings");
-        $ping_time = time();
-        ping_send(dbh => $options{dbh});
-    }
-    return $count;
-}
-sub setlogs {
-    my (%options) = @_;
-    if (!defined($options{data}->{data}->{id}) || $options{data}->{data}->{id} eq '') {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => 'centreondproxy: need a id to setlogs' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    if ($synctime_pollers->{$options{data}->{data}->{id}}->{in_progress} == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => 'centreondproxy: skip setlogs response. Maybe too much time to get response. Retry' },
-                                                 json_encode => 1);
-        return undef;
-    }
-    $options{logger}->writeLogInfo("centreondproxy: hooks: received setlogs for '$options{data}->{data}->{id}'");
-    $synctime_pollers->{$options{data}->{data}->{id}}->{in_progress} = 0;
-    my $ctime_recent = 0;
-    my $last_id = 0;
-    $options{dbh}->transaction_mode(1);
-    my $status = 0;
-    foreach (keys %{$options{data}->{data}->{result}}) {
-        $status = centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                           etime => $options{data}->{data}->{result}->{$_}->{etime}, 
-                                                           code => $options{data}->{data}->{result}->{$_}->{code}, 
-                                                           token => $options{data}->{data}->{result}->{$_}->{token},
-                                                           data => $options{data}->{data}->{result}->{$_}->{data});
-        last if ($status == -1);
-        $ctime_recent = $options{data}->{data}->{result}->{$_}->{ctime} if ($ctime_recent < $options{data}->{data}->{result}->{$_}->{ctime});
-        $last_id = $options{data}->{data}->{result}->{$_}->{id} if ($last_id < $options{data}->{data}->{result}->{$_}->{id});
-    }
-    if ($status == 0 && update_sync_time(dbh => $options{dbh}, id => $options{data}->{data}->{id}, last_id => $last_id, ctime => $ctime_recent) == 0) {
-        $options{dbh}->commit();
-        $synctime_pollers->{$options{data}->{data}->{id}}->{last_id} = $last_id if ($last_id != 0);
-        $synctime_pollers->{$options{data}->{data}->{id}}->{ctime} = $ctime_recent if ($ctime_recent != 0);
-    } else {
-        $options{dbh}->rollback();
-    }
-    $options{dbh}->transaction_mode(0);    
-}
-sub ping_send {
-    my (%options) = @_;
-    foreach my $id (keys %{$last_pollers}) {
-        if ($last_pollers->{$id}->{type} == 1) {
-            routing(socket => $internal_socket, action => 'PING', target => $id, data => '{}', dbh => $options{dbh});
-        }
-    }
-    foreach my $id (keys %{$register_pollers}) {
-        routing(action => 'PING', target => $id, data => '{}', dbh => $options{dbh});
-    }
-}
-sub full_sync_history {
-    my (%options) = @_;
-    foreach my $id (keys %{$last_pollers}) {
-        if ($last_pollers->{$id}->{type} == 1) {
-            routing(socket => $internal_socket, action => 'GETLOG', target => $id, data => '{}', dbh => $options{dbh});
-        }
-    }
-    foreach my $id (keys %{$register_pollers}) {
-        routing(action => 'GETLOG', target => $id, data => '{}', dbh => $options{dbh});
-    }
-}
-sub update_sync_time {
-    my (%options) = @_;
-    return 0 if ($options{ctime} == 0);
-    my $status;
-    if ($synctime_pollers->{$options{id}}->{last_id} == 0) {
-        ($status) = $options{dbh}->query("INSERT INTO centreond_synchistory (`id`, `ctime`, `last_id`) VALUES (" . $options{dbh}->quote($options{id}) . ", " . $options{dbh}->quote($options{ctime}) . ", " . $options{dbh}->quote($options{last_id}) . ")");
-    } else {
-        ($status) = $options{dbh}->query("UPDATE centreond_synchistory SET `ctime` = " . $options{dbh}->quote($options{ctime}) . ", `last_id` = " . $options{dbh}->quote($options{last_id}) . " WHERE `id` = " . $options{dbh}->quote($options{id}));
-    }
-    return $status;
-}
-sub get_sync_time {
-    my (%options) = @_;
-    my ($status, $sth) = $options{dbh}->query("SELECT * FROM centreond_synchistory");
-    if ($status == -1) {
-        $synctime_error = -1;
-        return -1;
-    }
-    $synctime_error = 0;
-    while (my $row = $sth->fetchrow_hashref()) {
-        $synctime_pollers->{$row->{id}} = { ctime => $row->{ctime}, in_progress => 0, in_progress_time => -1, last_id => $row->{last_id} }; 
-    }
-    return 0;
-}
-sub get_pollers {
-    my (%options) = @_;
-    my $pollers = {};
-    foreach (([1, 1], [2, 1], [10, 1], [166, 2], [140, 1])) {
-        $pollers->{${$_}[0]} = { type => ${$_}[1] };
-        $synctime_pollers->{${$_}[0]} = { ctime => 0, in_progress => 0, in_progress_time => -1, last_id => 0 }; 
-        $last_pong->{${$_}[0]} = 0 if (!defined($last_pong->{${$_}[0]}));
-    }
-    get_sync_time(dbh => $options{dbh});
-    return $pollers;
-}
-sub rr_pool {
-    my (%options) = @_;
-    while (1) {
-        $rr_current = $rr_current % $config->{pool};
-        if ($pools->{$rr_current + 1}->{ready} == 1) {
-            $rr_current++;
-            return $rr_current;
-        }
-        $rr_current++;
-    }
-}
-sub create_child {
-    my (%options) = @_;
-    $options{logger}->writeLogInfo("Create centreondproxy for pool id '" . $options{pool_id} . "'");
-    my $child_pid = fork();
-    if ($child_pid == 0) {
-        my $module = modules::centreondproxy::class->new(logger => $options{logger},
-                                                         config_core => $config_core,
-                                                         config => $config,
-                                                         pool_id => $options{pool_id},
-                                                         core_id => $core_id
-                                                        );
-        $module->run();
-        exit(0);
-    }
-    $options{logger}->writeLogInfo("PID $child_pid centreondproxy for pool id '" . $options{pool_id} . "'");
-    $pools->{$options{pool_id}} = { pid => $child_pid, ready => 0, running => 1 };
-    $pools_pid->{$child_pid} = $options{pool_id};
-}
-sub pull_request {
-    my (%options) = @_;
-    my $message = centreon::centreond::common::build_protocol(action => $options{action}, data => $options{data}, token => $options{token},
-                                                              target => ''
-                                                              );
-    my ($status, $key) = centreon::centreond::common::is_handshake_done(dbh => $options{dbh}, identity => unpack('H*', $options{target}));
-    if ($status == 0) {
-        centreon::centreond::common::add_history(dbh => $options{dbh},
-                                                 code => 20, token => $options{token},
-                                                 data => { message => "centreondproxy: node '" . $options{target} . "' had never been connected" },
-                                                 json_encode => 1);
-        return undef;
-    }
-    centreon::centreond::common::zmq_send_message(socket => $external_socket,
-                                                  cipher => $config_core->{cipher},
-                                                  vector => $config_core->{vector},
-                                                  symkey => $key,
-                                                  identity => $options{target},
-                                                  message => $message);
-}
-sub get_constatus_result {
-    my (%options) = @_;
-    my $result = { last_ping => $ping_time, entries => $last_pong };
-    return $result;
-}
-1;

--- a/bin/centreond/modules/centreondpull/hooks.pm
+++ b//dev/null
@@ -1,110 +0,0 @@
-package modules::centreondpull::hooks;
-use warnings;
-use strict;
-use centreon::centreond::clientzmq;
-my $config_core;
-my $config;
-my $module_id = 'centreondpull';
-my $events = [
-];
-my $stop = 0;
-my $client;
-my $socket_to_internal;
-my $logger;
-sub register {
-    my (%options) = @_;
-    $config = $options{config};
-    $config_core = $options{config_core};
-    return ($events, $module_id);
-}
-sub init {
-    my (%options) = @_;
-    $logger = $options{logger};
-    $socket_to_internal = centreon::centreond::common::connect_com(zmq_type => 'ZMQ_DEALER', name => 'centreondpull',
-                                                                   logger => $options{logger},
-                                                                   type => $config_core->{internal_com_type},
-                                                                   path => $config_core->{internal_com_path},
-                                                                   linger => $config->{linger}
-                                                                   );
-    $client = centreon::centreond::clientzmq->new(identity => $config_core->{id}, 
-                                                  cipher => $config->{cipher}, 
-                                                  vector => $config->{vector},
-                                                  pubkey => $config->{pubkey},
-                                                  target_type => $config->{target_type},
-                                                  target_path => $config->{target_path},
-                                                  logger => $options{logger},
-                                                  ping => $config->{ping},
-                                                  ping_timeout => $config->{ping_timeout}
-                                                  );
-    $client->init(callback => \&read_message);
-    $client->send_message(action => 'REGISTERNODE', data => { id => $config_core->{id} }, 
-                          json_encode => 1);
-    centreon::centreond::common::add_zmq_pollin(socket => $socket_to_internal,
-                                                callback => \&from_router,
-                                                poll => $options{poll});
-}
-sub routing {
-    my (%options) = @_;
-}
-sub gently {
-    my (%options) = @_;
-    $stop = 1;
-    $client->send_message(action => 'UNREGISTERNODE', data => { id => $config_core->{id} }, 
-                          json_encode => 1);
-    $client->close();
-    return 0;
-}
-sub kill {
-    my (%options) = @_;
-    return 0;
-}
-sub kill_internal {
-    my (%options) = @_;
-    return 0;
-}
-sub check {
-    my (%options) = @_;
-    if ($stop == 0) {
-        $client->ping(poll => $options{poll}, action => 'REGISTERNODE', data => { id => $config_core->{id} }, json_encode => 1);
-    }
-    return 0;
-}
-sub transmit_back {
-    my (%options) = @_;
-    if ($options{message} =~ /^\[ACK\]\s+\[(.*?)\]\s+(.*)/m) {
-        my $data;
-        eval {
-            $data = JSON->new->utf8->decode($2);
-        };
-        if ($@) {
-            return $options{message};
-        }
-        if (defined($data->{data}->{action}) && $data->{data}->{action} eq 'getlog') {
-            return '[SETLOGS] [' . $1 . '] [] ' . $2;
-        }
-        return undef;
-    } elsif ($options{message} =~ /^\[PONG\]/) {
-        return $options{message};
-    }
-    return undef;
-}
-sub from_router {
-    while (1) {        
-        my $message = transmit_back(message => centreon::centreond::common::zmq_dealer_read_message(socket => $socket_to_internal));
-        if (defined($message)) {
-            $logger->writeLogDebug("centreond-pull: hook: read message from internal: $message");
-            $client->send_message(message => $message);
-        }
-        last unless (centreon::centreond::common::zmq_still_read(socket => $socket_to_internal));
-    }
-}
-sub read_message {
-    my (%options) = @_;
-    if ($options{data} =~ /^\[ACK\]/) {
-        return undef;
-    }
-    $logger->writeLogDebug("centreond-pull: hook: read message from external: $options{data}");
-    centreon::centreond::common::zmq_send_message(socket => $socket_to_internal,
-                                                  message => $options{data});
-}
-1;

--- a/bootstrap.php
+++ b//dev/null
@@ -1,130 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-/* Define the path to configuration files */
-define('CENTREON_ETC', '../config/');
-$centreon_path = __DIR__;
-ini_set('display_errors', 'On');
-/* Add classpath to include path */
-set_include_path($centreon_path . PATH_SEPARATOR . get_include_path());
-require_once 'vendor/autoload.php';
-spl_autoload_register(function ($classname) use ($centreon_path) {
-    $filename = $centreon_path;
-    $fullClassPath = explode('\\', $classname);
-    $mainScope = array_shift($fullClassPath);
-    if ($mainScope == 'Centreon') {
-        $secondScope = array_shift($fullClassPath);
-        switch (strtolower($secondScope)) {
-            default:
-            case 'internal':
-                $filename .= '/core/internal/'.  implode('/', $fullClassPath);
-                break;
-            case 'api':
-                $thirdScope = array_shift($fullClassPath);
-                if (strtolower($thirdScope) === 'internal') {
-                    $filename .= '/core/api/internal/'.  implode('/', $fullClassPath);
-                } elseif (strtolower($thirdScope) === 'rest') {
-                    $filename .= '/core/api/rest/'.  implode('/', $fullClassPath);
-                } elseif (strtolower($thirdScope) === 'soap') {
-                    $filename .= '/core/api/soap/'.  implode('/', $fullClassPath);
-                }
-                break;
-            case 'controllers':
-                $filename .= '/core/controllers/'.  implode('/', $fullClassPath);
-                break;
-            case 'repository':
-                $filename .= '/core/repositories/'.  implode('/', $fullClassPath);
-                break;
-            case 'models':
-                $filename .= '/core/models/'.  implode('/', $fullClassPath);
-                break;
-            case 'custom':
-                $filename .= '/core/custom/'.  implode('/', $fullClassPath);
-                break;
-        }
-    }
-    $filename .= '.php';
-    if (file_exists($filename)) {
-        require_once $filename;
-    }
-});
-spl_autoload_register(function ($classname) use ($centreon_path) {
-    $filename = $centreon_path . '/modules/';
-    $fullClassPath = explode('\\', $classname);
-    $filename .= array_shift($fullClassPath).'Module';
-    $secondScope = array_shift($fullClassPath);
-    switch(strtolower($secondScope)) {
-        default:
-            $filename .= implode('/', $fullClassPath);
-            break;
-        case 'controllers':
-            $filename .= '/controllers/'.  implode('/', $fullClassPath);
-            break;
-        case 'events':
-            $filename .= '/events/'.  implode('/', $fullClassPath);
-            break;
-        case 'hooks':
-            $filename .= '/hooks/'.  implode('/', $fullClassPath);
-            break;
-        case 'listeners':
-            $filename .= '/listeners/'.  implode('/', $fullClassPath);
-            break;
-        case 'models':
-            $filename .= '/models/'.  implode('/', $fullClassPath);
-            break;
-        case 'repository':
-            $filename .= '/repositories/'.  implode('/', $fullClassPath);
-            break;
-        case 'internal':
-            $filename .= '/internal/'.  implode('/', $fullClassPath);
-            break;
-        case 'install':
-            $filename .= '/install/'.  implode('/', $fullClassPath);
-            break;
-        case 'api':
-            $thirdScope = array_shift($fullClassPath);
-            if (strtolower($thirdScope) === 'internal') {
-                $filename .= '/api/internal/'.  implode('/', $fullClassPath);
-            } elseif (strtolower($thirdScope) === 'rest') {
-                $filename .= '/api/rest/'.  implode('/', $fullClassPath);
-            } elseif (strtolower($thirdScope) === 'soap') {
-                $filename .= '/api/soap/'.  implode('/', $fullClassPath);
-            }
-            break;
-    }
-    $filename .= '.php';
-    if (file_exists($filename)) {
-        require_once $filename;
-    }
-});

--- a/core/api/rest/BasicCrudApi.php
+++ b//dev/null
@@ -1,427 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Api\Rest;
-use Centreon\Internal\Exception;
-use Centreon\Internal\Api;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Exception\Validator\MissingParameterException;
-use Centreon\Internal\Exception\Http\BadRequestException;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of BasicCrudApi
- *
- * @author lionel
- */
-class BasicCrudApi extends Api
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $objectManifest = '';
-    /**
-     *
-     * @var type 
-     */
-    protected $liteAttributesSet = array();
-    /**
-     *
-     * @var type 
-     */
-    protected $attributesMap = array();
-    /**
-     *
-     * @var type 
-     */
-    protected $objectName = '';
-    /**
-     *
-     * @var type 
-     */
-    protected $objectBaseUrl = '';
-    /**
-     *
-     * @var type 
-     */
-    protected $objectClass = '';
-    /**
-     *
-     * @var type 
-     */
-    protected $repository;
-    /**
-     *
-     * @var type 
-     */
-    public static $moduleShortName = '';
-    /**
-     *
-     * @var type 
-     */
-    public $relationMap = array();
-    /**
-     *
-     * @var type 
-     */
-    public $simpleRelationMap = array();
-    /**
-     * 
-     */
-    const OBJ_NOT_EXIST = 'Object not in database.';
-    /**
-     * 
-     * @param type $request
-     * @throws Exception
-     */
-    public function __construct($request)
-    {
-        parent::__construct($request);
-        $this->parseManifest();
-        if (is_null($this->repository)) {
-            throw new Exception('Repository unspecified');
-        }
-        $repository = $this->repository;
-        $repository::setRelationMap($this->relationMap);
-        $repository::setObjectName($this->objectName);
-        $repository::setObjectClass($this->objectClass);
-        if (!empty($this->secondaryObjectClass)) {
-            $repository::setSecondaryObjectClass($this->secondaryObjectClass);
-        }
-        $rc = new \ReflectionClass(get_class($this));
-        $moduleName = Informations::getModuleFromPath($rc->getFileName());
-        static::$moduleShortName = Informations::getModuleSlugName($moduleName);
-        $this->objectBaseUrl = '/' . static::$moduleShortName . '/' . $this->objectName;
-    }
-    /**
-     * 
-     * @param string $manifestFile
-     */
-    private function parseManifest()
-    {
-        $reflector = new \ReflectionClass($this);
-        $manifestFile = dirname($reflector->getFileName()) . '/' . $this->objectName . 'Manifest.json';
-        $this->objectManifest = json_decode(file_get_contents($manifestFile), true);
-        foreach ($this->objectManifest as $mKey => $mValue) {
-            if (property_exists($this, $mKey)) {
-                $this->$mKey = $mValue;
-            }
-        }
-    }
-    /**
-     * 
-     * @param type $dataset
-     * @param type $strict
-     */
-    protected function normalizeParams(&$dataset, $strict = true)
-    {
-        foreach ($dataset as &$value) {
-            $this->normalizeSingleSet($value, $strict);
-        }
-    }
-    /**
-     * 
-     * @param type $dataset
-     * @param type $strict
-     */
-    protected function normalizeSingleSet(&$dataset, $strict = true)
-    {
-        $newDataset = array();
-        foreach($dataset as $dKey => $dValue) {
-            $normalizeKey = array_search($dKey, $this->attributesMap);
-            if ($normalizeKey !== false) {
-                $newDataset[$normalizeKey] = $dValue;
-            } else {
-                $newDataset[$dKey] = $dValue;
-            }
-        }
-        if ($strict) {
-            $diffKey = array_diff(array_keys($newDataset), array_keys($this->attributesMap));
-            foreach ($diffKey as $dKey) {
-                unset($newDataset[$dKey]);
-            }
-        }
-        $dataset = $newDataset;
-    }
-    /**
-     * @method GET
-     * @route /{object}
-     * @auth
-     */
-    public function listAction()
-    {
-        $headers = $this->request->headers();
-        $version = null;
-        if (isset($headers['centreon-version'])) {
-            $version = trim($headers['centreon-version']);
-        } /* mode strict */
-        $calledMethod = '\\' . get_called_class() . '::' . __FUNCTION__;
-        static::executeRoute($calledMethod, $version);
-    }
-    /**
-     * @api /{object}
-     * @method GET
-     * @since 3.0.0
-     */
-    public function list300Action()
-    {
-        $headers = $this->request->headers();
-        $params = $this->getParams();
-        $repository = $this->repository;
-        $objLink = $this->objectBaseUrl . '/[i:id]';
-        $count = (isset($params['count'])) ? $params['count'] : 25;
-        $offset = (isset($params['offset'])) ? $params['offset'] : 0;
-        $fields = (isset($params['fields'])) ? $params['fields'] : $this->liteAttributesSet;
-        $list = $repository::getList($fields, $count, $offset);
-        $this->normalizeParams($list);
-        foreach ($list as &$singleObject) {
-            $finalLink = $this->router->getPathFor($objLink, array('id' => $singleObject['id']));
-            $singleObject['href'] = 'http://' . $headers['host'] . $finalLink;
-        }
-        $this->sendJsonApiResponse($this->objectName, $list);
-    }
-    /**
-     * @api /{object}
-     * @method GET
-     * @since 3.1.0
-     */
-    protected function list310Action()
-    {
-        echo "aaaaaaa";
-    }
-    /**
-     * 
-     */
-    private function viewObject()
-    {
-        $headers = $this->request->headers();
-        $params = $this->getParams();
-        $hostUrl = 'http://' . $headers['host'];
-        $repository = $this->repository;
-        $obj = $this->objectClass;
-        $objPrimaryKey = $obj::getPrimaryKey();
-        $objLink = $this->objectBaseUrl . '/[i:id]';
-        $fields = (isset($params['fields'])) ? $params['fields'] : '*';
-        $linkedObjects = (isset($params['linkedobject'])) ? explode(',', $params['linkedobject']) : array();
-        $ids = explode(',', $params['id']);
-        try {
-            if (count($ids) > 1) {
-                $object = $repository::getList($fields, -1, 0, null, 'asc', array($objPrimaryKey => $ids));
-                $this->normalizeParams($object);
-                foreach ($object as &$singleObject) {
-                    $singleObject['links'] = $this->getLinkedObjects($singleObject['id'], $linkedObjects);
-                    $finalLink = $this->router->getPathFor($objLink, array('id' => $singleObject['id']));
-                    $singleObject['href'] = $hostUrl . $finalLink;
-                }
-            } else {
-                $object = $repository::load($params['id'], $fields);
-                $this->normalizeSingleSet($object);
-                $object['links'] = $this->getLinkedObjects($params['id'], $linkedObjects);
-                $finalLink = $this->router->getPathFor($objLink, array('id' => $object['id']));
-                $object['href'] = $hostUrl . $finalLink;
-            }
-            $links = array();
-            foreach ($linkedObjects as $linkedObject) {
-                $links[$this->objectName . '.' . $linkedObject] = $hostUrl . "/$linkedObject/" . '{' . $linkedObject . '}';
-            }
-            $this->sendJsonApiResponse($this->objectName, $object, $links);
-        } catch (Exception $ex) {
-            if ($ex->getMessage() === static::OBJ_NOT_EXIST) {
-                $this->router->response()->code(404);
-            } else {
-                $this->router->response()->code(500);
-            }
-        }
-    }
-    /**
-     * @method GET
-     * @route /{object}/[:id]
-     * @auth
-     */
-    public function viewAction()
-    {
-        $this->viewObject();
-    }
-    /**
-     * @method GET
-     * @route /{object}/[:id]/links/[:linkedobject]
-     * @auth
-     */
-    public function viewWithRelationsAction()
-    {
-        $this->viewObject();
-    }
-    /**
-     * 
-     * @method POST
-     * @route /{object}
-     * @auth
-     */
-    public function createAction()
-    {
-        $params = $this->getParams();
-        $apiResourceObjects = json_decode($params['data'], true);
-        try {
-            $object = array();
-            $repository = $this->repository;
-            foreach ($apiResourceObjects as $apiResourceObject) {
-                if (!isset($apiResourceObject['type'])) {
-                    throw new MissingParameterException("type is not provided", 400);
-                }
-                if ($apiResourceObject['type'] == $this->objectName) {
-                    unset($apiResourceObject['type']);
-                    $idOfCreatedElement = $repository::create(
-                        $apiResourceObject,
-                        'api',
-                        $this->objectBaseUrl . '/update'
-                    );
-                    $object[] = $repository::load($idOfCreatedElement);
-                } else {
-                    throw new BadRequestException('Wrong Type', 'The type you set does not match expected');
-                }
-            }
-            $this->sendJsonApiResponse($this->objectName, $object);
-        } catch (MissingParameterException $ex) {
-            $this->router->response()->code(400)->json($ex->getMessage());
-        } catch (\PDOException $ex) {
-            if ($ex->getCode() == 23000) {
-                $this->router->response()->code(409);
-            }
-        } catch (HttpException $ex) {
-            $this->router->response()->code($ex->getCode())->json($ex->getMessage());
-        } catch (Exception $ex) {
-            $this->router->response()->code(500);
-        }
-    }
-    /**
-     * @method PUT
-     * @route /{object}/[:id]
-     * @auth
-     */
-    public function fullUpdateAction()
-    {
-    }
-    /**
-     * @method PATCH
-     * @route /{object}/[:id]
-     * @auth
-     */
-    public function partialUpdateAction()
-    {
-        $params = $this->getParams();
-        try {
-            if (isset($params['id'])) {
-                $repository = $this->repository;
-                $objectParams = $params[$this->objectName];
-                if (isset($objectParams[0])) {
-                    foreach ($objectParams as $singleObjectParams) {
-                        $singleObjectParams['object_id'] = $params['id'];
-                        $repository::update($singleObjectParams);
-                    }
-                } else {
-                    $objectParams['object_id'] = $params['id'];
-                    $repository::update($objectParams);
-                }
-                $this->router->response()->code(204);
-            } else {
-                $this->router->response()->code(400);
-            }
-        } catch (Exception $ex) {
-            if ($ex->getMessage() === static::OBJ_NOT_EXIST) {
-                $this->router->response()->code(404);
-            } else {
-                $this->router->response()->code(500);
-            }
-        }
-    }
-    /**
-     * @method PATCH
-     * @route /{object}/[:id]/links/[:linkedobject]
-     * @auth
-     */
-    public function updateRelationsAction()
-    {
-    }
-    /**
-     * @method DELETE
-     * @route /{object}/[:id]
-     * @auth
-     */
-    public function deleteAction()
-    {
-        $params = $this->getParams();
-        $repository = $this->repository;
-        $returnCode = 204;
-        try {
-            $ids = explode(',', $params['id']);
-            $repository::delete($ids);
-        } catch (Exception $ex) {
-            if ($ex->getMessage() === static::OBJ_NOT_EXIST) {
-                $returnCode = 404;
-            } else {
-                $returnCode = 500;
-            }
-        }
-        $this->router->response()->code($returnCode);
-    }
-    /**
-     * 
-     * @param type $linkedObjects
-     */
-    private function getLinkedObjects($objectId, $linkedObjects = array(), $asResource = false)
-    {
-        $linked = array();
-        $repository = $this->repository;
-        foreach ($linkedObjects as $linkedObject) {
-            $fList = array();
-            if (isset($this->relationMap[$linkedObject])) {
-                $relClass = $this->relationMap[$linkedObject];
-                $list = $repository::getRelations($relClass, $objectId);
-                foreach ($list as $obj) {
-                    if ($asResource) {
-                        $fList[] = $obj;
-                    } else {
-                        $fList[] = $obj['id'];
-                    }
-                }
-            } elseif (isset($this->simpleRelationMap[$linkedObject])) {
-                $fList = $repository::getSimpleRelation($this->simpleRelationMap[$linkedObject], $linkedObject, $objectId);
-            }
-            if (count($fList) > 0) {
-                $linked[$linkedObject] = $fList;
-            }
-        }
-        return $linked;
-    }
-}

--- a/core/commandLine/bootstrap.php
+++ b//dev/null
@@ -1,106 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-/* Define the path to configuration files */
-define('CENTREON_ETC', realpath(__DIR__ . '/../../config/'));
-$centreon_path = realpath(__DIR__ . '/../..');
-/* Add classpath to include path */
-set_include_path($centreon_path . PATH_SEPARATOR . get_include_path());
-require_once realpath(__DIR__ . '/../../vendor/autoload.php');
-spl_autoload_register(function ($classname) use ($centreon_path) {
-    $filename = $centreon_path;
-    $fullClassPath = explode('\\', $classname);
-    $mainScope = array_shift($fullClassPath);
-    if ($mainScope == 'Centreon') {
-        $secondScope = array_shift($fullClassPath);
-        switch (strtolower($secondScope)) {
-            default:
-            case 'internal':
-                $filename .= '/core/internal/'.  implode('/', $fullClassPath);
-                break;
-            case 'commands':
-                $filename .= '/core/commands/'.  implode('/', $fullClassPath);
-                break;
-            case 'repository':
-                $filename .= '/core/repositories/'.  implode('/', $fullClassPath);
-                break;
-            case 'models':
-                $filename .= '/core/models/'.  implode('/', $fullClassPath);
-                break;
-            case 'custom':
-                $filename .= '/core/custom/'.  implode('/', $fullClassPath);
-                break;
-        }
-    }
-    $filename .= '.php';
-    if (file_exists($filename)) {
-        require_once $filename;
-    }
-});
-spl_autoload_register(function ($classname) use ($centreon_path) {
-    $filename = $centreon_path . '/modules/';
-    $fullClassPath = explode('\\', $classname);
-    $filename .= array_shift($fullClassPath).'Module';
-    $secondScope = array_shift($fullClassPath);
-    switch(strtolower($secondScope)) {
-        default:
-            $filename .= implode('/', $fullClassPath);
-            break;
-        case 'commands':
-            $filename .= '/commands/'.  implode('/', $fullClassPath);
-            break;
-        case 'models':
-            $filename .= '/models/'.  implode('/', $fullClassPath);
-            break;
-        case 'repository':
-            $filename .= '/repositories/'.  implode('/', $fullClassPath);
-            break;
-        case 'internal':
-            $filename .= '/internal/'.  implode('/', $fullClassPath);
-            break;
-        case 'install':
-            $filename .= '/install/'.  implode('/', $fullClassPath);
-            break;
-        case 'events':
-            $filename .= '/events/'.  implode('/', $fullClassPath);
-            break;
-        case 'listeners':
-            $filename .= '/listeners/'.  implode('/', $fullClassPath);
-            break;
-    }
-    $filename .= '.php';
-    if (file_exists($filename)) {
-        require_once $filename;
-    }
-});

--- a/core/commands/Database/ConfigurationCommand.php
+++ b//dev/null
@@ -1,47 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Commands\Database;
-use Centreon\Internal\Command\AbstractCommand;
-use Centreon\Internal\Install\Db;
-class ConfigurationCommand extends AbstractCommand
-{
-    /**
-     * 
-     */
-    public function generateAction($schema = 'centreon')
-    {
-        Db::update($schema);
-    }
-}

--- a/core/commands/Database/ToolsCommand.php
+++ b//dev/null
@@ -1,99 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Commands\Database;
-use Centreon\Internal\Command\AbstractCommand;
-use Centreon\Internal\Exception;
-use Centreon\Internal\Di;
-class ToolsCommand extends AbstractCommand
-{
-    /**
-     * Extract data from a db table and prints a json string
-     *
-     * @param string $dbname | 'db_centreon' or 'db_storage'
-     * @param string $tablename
-     * @param string $extra
-     */
-    public function sqlToJsonAction($dbname, $tablename, $extra = '')
-    {
-        $db = Di::getDefault()->get($dbname);
-        $sql = "SELECT * FROM $tablename $extra";
-        $stmt = $db->prepare($sql);
-        $stmt->execute();
-        $tab = array();
-        $i = 0;
-        while ($row = $stmt->fetch(\PDO::FETCH_ASSOC)) {
-            foreach ($row as $k => $v) {
-                if (!is_null($v)) {
-                    $tab[$i][$k] = $v;
-                }
-            }
-            $i++;
-        }
-        echo json_encode($tab);
-    }
-     /**
-     * Extract json file and prints a sql string 
-     *
-     * @param string $sFile
-     * @param string $tablename
-     * @sDestination
-     */
-    public function jsonToSqlAction($sFile, $tablename, $sDestination = '')
-    {
-        $sInsert = "INSERT INTO ".$tablename."(";
-        if (file_exists($sFile)) {
-            try {
-                $sColumns = '';
-                $aData = json_decode(file_get_contents($sFile), true);
-                $sSql = '';
-                foreach($aData as $value) {
-                    $sColumns = implode(',', array_keys($value));
-                    $sSql .= "(".'"'.implode('","',array_values($value)).'"'."), "; 
-                }
-                $sChars = $sInsert.$sColumns.") VALUES ".$sSql;
-                $sContent = substr($sChars, 0, strlen($sChars) - 2 ).";";
-                if (empty($sDestination)) {
-                    echo $sContent;
-                } else  {
-                    if (file_exists($sDestination)) {
-                        file_put_contents($sContent, $sDestination);
-                    } else throw new Exception("invalide desination");
-                }
-            } catch (Exception $ex) {
-                 return "invalide content";
-            } 
-        }
-    }
-}

--- a/core/commands/InternalCommand.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Commands;
-use Centreon\Internal\Command\AbstractCommand;
-use Centreon\Internal\Install\Install;
-use Centreon\Internal\Install\Upgrade;
-use Centreon\Internal\Install\Migrate;
-/**
- * Command Line for Centreon Internal actions
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class InternalCommand extends AbstractCommand
-{
-    /**
-     * 
-     */
-    public function installAction()
-    {
-        Install::installCentreon();
-    }
-    /**
-     * 
-     */
-    public function upgradeAction()
-    {
-        Upgrade::updateCentreon();
-    }
-    /**
-     * 
-     */
-    public function migrateAction()
-    {
-        Migrate::migrateCentreon();
-    }
-    /**
-     * 
-     * @param type $removeDb
-     */
-    public function uninstallAction($removeDb = false)
-    {
-        Install::uninstallCentreon($removeDb);
-    }
-}

--- a/core/commands/Module/ManageCommand.php
+++ b//dev/null
@@ -1,128 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Commands\Module;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Command\AbstractCommand;
-/**
- * COmmand Line to manage
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class ManageCommand extends AbstractCommand
-{
-    /**
-     * List module names
-     * @param string $type
-     * @param string $status
-     */
-    public function simpleListAction($onlyActivated = 1)
-    {
-        $moduleList = Informations::getModuleList($onlyActivated);
-        foreach ($moduleList as $module) {
-            echo $module."\n";
-        }
-    }
-    /**
-     * List all information about modules
-     * @param string $type
-     * @param int $onlyActivated
-     * @param int $header
-     */
-    public function extendedListAction($onlyActivated = 1, $header = 1)
-    {
-        $moduleList = Informations::getModuleExtendedList($onlyActivated);
-        if ($header) {
-            echo 'name;alias;description;version;author;isactivated;isinstalled' . "\n";
-        }
-        foreach ($moduleList as $module) {
-            echo $module['name'].';'.
-                $module['alias'].';'.
-                $module['description'].';'.
-                $module['version'].';'.
-                $module['author'].';'.
-                $module['isactivated'].';'.
-                $module['isinstalled']."\n";
-        }
-    }
-    /**
-     * 
-     * @param string $moduleName
-     */
-    public function showAction($moduleName)
-    {
-    }
-    /**
-     * 
-     * @param string $moduleName
-     */
-    public function installAction($moduleName)
-    {
-        $moduleInstaller = Informations::getModuleInstaller($moduleName);
-        $moduleInstaller->install();
-    }
-    /**
-     * 
-     * @param string $moduleName
-     */
-    public function reinstallAction($moduleName)
-    {
-        $moduleId = Informations::getModuleIdByName($moduleName);
-        $moduleInstaller = Informations::getModuleInstaller($moduleName, $moduleId);
-        $moduleInstaller->remove();
-        unset($moduleInstaller);
-        $moduleInstaller = Informations::getModuleInstaller($moduleName);
-        $moduleInstaller->install(false);
-    }
-    /**
-     * 
-     * @param string $moduleName
-     */
-    public function upgradeAction($moduleName)
-    {
-        echo "Not implemented yet";
-    }
-    /**
-     * 
-     * @param string $moduleName
-     */
-    public function removeAction($moduleName)
-    {
-        $moduleInstaller = Informations::getModuleInstaller($moduleName);
-        $moduleInstaller->remove();
-    }
-}

--- a/core/commands/Module/ToolsCommand.php
+++ b//dev/null
@@ -1,93 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Commands\Module;
-use Centreon\Internal\Utils\String\CamelCaseTransformation;
-use Centreon\Internal\Module\Generator;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Utils\CommandLine\InputOutput;
-use Centreon\Internal\Command\AbstractCommand;
-/**
- * Description of Generate
- *
- * @author lionel
- */
-class ToolsCommand extends AbstractCommand
-{
-    /**
-     * 
-     */
-    public function generateAction()
-    {
-        $moduleCanonicalName = InputOutput::prompt(
-            _("Type the module canonical name here (in CamelCase, it must not contains Module at the ends)"),
-            function($params, &$result) {
-                call_user_func_array(
-                    array('\Centreon\Internal\Module\Informations', 'isCanonicalNameValid'),
-                    array($params, &$result)
-                );
-            }
-        );
-        $moduleDisplayName = CamelCaseTransformation::camelCaseToCustom($moduleCanonicalName, " ");
-        $moduleShortname = strtolower(CamelCaseTransformation::camelCaseToCustom($moduleCanonicalName, "-"));
-        $moduleGenerator = new Generator($moduleCanonicalName);
-        $moduleGenerator->setModuleShortName($moduleShortname);
-        $moduleGenerator->setModuleDisplayName($moduleDisplayName);
-        $userAnswer = InputOutput::prompt(
-            _("Type the module shortname here (seperate by -) [" . $moduleShortname ."]")
-        );
-        if (!empty($userAnswer)) {
-            $moduleShortname = $userAnswer;
-        }
-        $moduleAuthor = InputOutput::prompt(
-            _("Type your name here")
-        );
-        $moduleGenerator->setModuleAuthor($moduleAuthor);
-        InputOutput::display(_("Generating module full structure... "), false);
-        $moduleGenerator->generateModuleStructure();
-        $moduleGenerator->generateConfigFile();
-        $moduleGenerator->createSampleInstaller();
-        InputOutput::display(_("Done\n"), true, "bgreen");
-        $generateController = InputOutput::prompt(_("Generate sample controller/view (yes/no)? [yes]"));
-        if (empty($generateController) || $generateController == "yes" || $generateController == "y") {
-            $moduleGenerator->createSampleController();
-            $moduleGenerator->createSampleView();
-        }
-        $installModule = InputOutput::prompt(_("Install the module(yes/no)? [no] "));
-        if (!empty($installModule) && ($installModule == "yes" || $installModule == "y")) {
-            $moduleInstaller = Informations::getModuleInstaller($moduleShortname);
-            $moduleInstaller->install();
-        }
-    }
-}

--- a/core/controllers/FormController.php
+++ b//dev/null
@@ -1,156 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Controllers;
-use Centreon\Internal\Form\Generator\Web\Full as WebFormGenerator;
-use Centreon\Internal\Form\Validators\Validator\Validator;
-use Centreon\Internal\Di;
-use Centreon\Internal\Exception;
-/**
- * Abstact class for configuration controller
- *
- * @version 3.0.0
- * @author Maximilien Bersoult <mbersoult@centreon.com>
- */
-abstract class FormController extends ListController
-{
-    /**
-     * 
-     * @param type $request
-     * @throws Exception
-     */
-    public function __construct($request)
-    {
-        parent::__construct($request);
-        if (is_null($this->repository)) {
-            throw new Exception('Repository unspecified');
-        }
-        $repository = $this->repository;
-        $repository::setRelationMap(static::$relationMap);
-        $repository::setObjectName(static::$objectName);
-        $repository::setObjectClass($this->objectClass);
-        if (!empty($this->secondaryObjectClass)) {
-            $repository::setSecondaryObjectClass($this->secondaryObjectClass);
-        }
-        if (is_null($this->objectBaseUrl) || $this->objectBaseUrl === '') {
-            $this->objectBaseUrl = '/' . static::$moduleShortName . '/' . static::$objectName;
-        }
-    }
-    /**
-     * Action for getting list of objects
-     *
-     * JSON response
-     *
-     * @method get
-     * @route /{object}/formlist
-     */
-    public function formListAction()
-    {
-        $requestParams = $this->getParams('get');
-        $repository = $this->repository;
-        $list = $repository::getFormList($requestParams['q']);
-        $this->router->response()->json($list);
-    }
-    /**
-     * 
-     * @method get
-     * @route /{object}/[i:id]
-     */
-    public function editAction($additionnalParamsForSmarty = array())
-    {
-        $requestParam = $this->getParams('named');
-        $objectFormUpdateUrl = $this->objectBaseUrl.'/update';
-        $inheritanceUrl = null;
-        if (false === is_null($this->inheritanceUrl)) {
-            $inheritanceUrl = $this->router->getPathFor(
-                $this->inheritanceUrl,
-                array('id' => $requestParam['id'])
-            );
-        }
-        $myForm = new WebFormGenerator($objectFormUpdateUrl, array('id' => $requestParam['id'], 'objectName'=> static::$objectName));
-        $myForm->getFormFromDatabase();
-        $myForm->addHiddenComponent('object_id', $requestParam['id']);
-        $myForm->addHiddenComponent('object', static::$objectName);
-        $myForm->setDefaultValues($this->objectClass, $requestParam['id']);
-        $formModeUrl = $this->router->getPathFor(
-                            $this->objectBaseUrl.'/[i:id]',
-                            array(
-                                'id' => $requestParam['id']
-                            )
-                        );
-        $this->tpl->assign('pageTitle', $this->objectDisplayName);
-        $this->tpl->assign('form', $myForm->generate());
-        $this->tpl->assign('advanced', $requestParam['advanced']);
-        $this->tpl->assign('formModeUrl', $formModeUrl);
-        $this->tpl->assign('formName', $myForm->getName());
-        $this->tpl->assign('validateUrl', $objectFormUpdateUrl);
-        foreach ($additionnalParamsForSmarty as $smartyVarName => $smartyVarValue) {
-            $this->tpl->assign($smartyVarName, $smartyVarValue);
-        }
-        $this->tpl->assign('inheritanceUrl', $inheritanceUrl);
-        if (isset($this->inheritanceTmplUrl)) {
-            $this->tpl->assign(
-                'inheritanceTmplUrl',
-                $this->router->getPathFor(
-                    $this->inheritanceTmplUrl
-                )
-            );
-        }
-        if (isset($this->tmplField)) {
-            $this->tpl->assign('tmplField', $this->tmplField);
-        }
-        $this->tpl->display('file:[CentreonConfigurationModule]edit.tpl');
-    }
-    /**
-     * Generic update function
-     *
-     * @method post
-     * @route /{object}/update
-     */
-    public function updateAction()
-    {
-        $givenParameters = clone $this->getParams('post');
-        try {
-            $repository = $this->repository;
-            $repository::update($givenParameters, 'form', $this->getUri());
-            unset($_SESSION['form_token']);
-            unset($_SESSION['form_token_time']);
-            $this->router->response()->json(array('success' => true));
-        } catch (\Centreon\Internal\Exception $e) {
-            $updateErrorMessage = $e->getMessage();
-            $this->router->response()->json(array('success' => false,'error' => $updateErrorMessage));
-        }
-    }
-}

--- a/core/controllers/ListController.php
+++ b//dev/null
@@ -1,453 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Controllers;
-use Centreon\Internal\Form;
-use Centreon\Internal\Form\Generator\Web\Wizard;
-use Centreon\Internal\Di;
-use Centreon\Internal\Exception;
-use Centreon\Internal\Controller;
-use Centreon\Internal\Module\Informations;
-/**
- * Abstact class for configuration controller
- *
- * @version 3.0.0
- * @author Maximilien Bersoult <mbersoult@centreon.com>
- */
-abstract class ListController extends Controller
-{
-    /**
-     *
-     * @var type 
-     */
-    public static $moduleName = '';
-    /**
-     *
-     * @var type 
-     */
-    public static $moduleShortName = '';
-    /**
-     *
-     * @var string
-     */
-    public static $enableDisableFieldName = ''; 
-    /**
-     *
-     * @var type 
-     */
-    public static $objectName = '';
-    /**
-     *
-     * @var type 
-     */
-    public static $isDisableable = false;
-    /**
-     *
-     * @var type 
-     */
-    protected $repository = null;
-    /**
-     *
-     * @var type 
-     */
-    protected $inheritanceUrl = null;
-    /**
-     *
-     * @var type 
-     */
-    protected $objectBaseUrl = ''; 
-    /**
-     * 
-     * @param type $request
-     * @throws Exception
-     */
-    public function __construct($request)
-    {
-        parent::__construct($request);
-        if (is_null($this->repository)) {
-            throw new Exception('Repository unspecified');
-        }
-        $repository = $this->repository;
-        $repository::setRelationMap(static::$relationMap);
-        $repository::setObjectName(static::$objectName);
-        $repository::setObjectClass($this->objectClass);
-        if (!empty($this->secondaryObjectClass)) {
-            $repository::setSecondaryObjectClass($this->secondaryObjectClass);
-        }
-        $rc = new \ReflectionClass(get_class($this));
-        static::$moduleName = Informations::getModuleFromPath($rc->getFileName());
-        static::$moduleShortName = Informations::getModuleSlugName(static::$moduleName);
-        if ($this->objectBaseUrl === '' || is_null($this->objectBaseUrl)) {
-            $this->objectBaseUrl = '/' . static::$moduleShortName . '/' . static::$objectName;
-        }
-    }
-    /**
-     * List view for object
-     *
-     * @method get
-     * @route /{object}
-     */
-    public function listAction()
-    {
-        $this->tpl->addCss('jquery.fileupload.css');
-        /* Load CssFile */
-        $this->tpl->addCss('dataTables.tableTools.min.css')
-            ->addCss('jquery.fileupload.css')
-            ->addCss('dataTables.colVis.min.css')
-            ->addCss('dataTables.colReorder.min.css')
-            ->addCss('select2.css')
-            ->addCss('select2-bootstrap.css')
-            ->addCss('centreon-wizard.css');
-        /* Load JsFile */
-        $this->tpl->addJs('jquery.dataTables.min.js')
-            ->addJs('dataTables.tableTools.min.js')
-            ->addJs('dataTables.colVis.min.js')
-            ->addJs('dataTables.colReorder.min.js')
-            ->addJs('bootstrap-dataTables-paging.js')
-            ->addJs('jquery.dataTables.columnFilter.js')
-            ->addJs('dataTables.bootstrap.js')
-            ->addJs('jquery.select2/select2.min.js')
-            ->addJs('jquery.validation/jquery.validate.min.js')
-            ->addJs('jquery.validation/additional-methods.min.js')
-            ->addJs('centreon.search.js')
-            ->addJs('centreon-clone.js')
-            ->addJs('tmpl.min.js')
-            ->addJs('load-image.min.js')
-            ->addJs('canvas-to-blob.min.js')
-            ->addJs('jquery.fileupload.js')
-            ->addJs('jquery.fileupload-process.js')
-            ->addJs('jquery.fileupload-image.js')
-            ->addJs('jquery.fileupload-validate.js')
-            ->addJs('jquery.fileupload-ui.js')
-            ->addJs('bootstrap3-typeahead.js')
-            ->addJs('centreon-wizard.js')
-            ->addJs('moment-with-locales.js')
-            ->addJs('moment-timezone-with-data.min.js');
-        /* Display variable */
-        $this->tpl->assign('objectName', $this->objectDisplayName);
-        $this->tpl->assign('datatableObject', $this->datatableObject);
-        $this->tpl->assign('moduleName', static::$moduleName);
-        $this->tpl->assign('objectAddUrl', $this->objectBaseUrl . '/add');
-        $this->tpl->assign('objectListUrl', $this->objectBaseUrl . '/list');
-        $this->tpl->assign('objectMcUrl', $this->objectBaseUrl . '/massive_change');
-        $this->tpl->assign('objectMcFieldsUrl', $this->objectBaseUrl . '/mc_fields');
-        $this->tpl->assign('isDisableable', static::$isDisableable);
-        if (static::$isDisableable) {
-            $this->tpl->assign('objectEnableUrl', $this->objectBaseUrl . '/enable');
-            $this->tpl->assign('objectDisableUrl', $this->objectBaseUrl . '/disable');
-        }
-        $this->tpl->assign('objectDuplicateUrl', $this->objectBaseUrl . '/duplicate');
-        $this->tpl->assign('objectDeleteUrl', $this->objectBaseUrl . '/delete');
-        $this->tpl->display('file:[CentreonConfigurationModule]list.tpl');
-    }
-    /**
-     * Get wizard for add a object
-     *
-     * Response HTML
-     *
-     * @method get
-     * @route /{object}/add
-     */
-    public function addAction()
-    {
-        $this->tpl->assign('validateUrl', $this->objectBaseUrl . "/add");
-        $form = new Wizard($this->objectBaseUrl . '/add', array('id' => 0));
-        $form->getFormFromDatabase();
-        $form->addHiddenComponent('object', static::$objectName);
-        $form->addHiddenComponent('module', static::$moduleName);
-        $this->tpl->assign('formName', $form->getName());
-        $formGen = str_replace(
-            array('alertMessage', 'alertClose'),
-            array('alertModalMessage', 'alertModalClose'),
-            $form->generate()
-        );
-        echo $formGen;
-    }
-    /**
-     * Generic create action
-     * 
-     * @param boolean $sendResponse
-     * @method post
-     * @route /{object}/add
-     * @return array
-     */
-    public function createAction($sendResponse = true)
-    {
-        $givenParameters = clone $this->getParams('post');
-        $repository = $this->repository;
-        try {
-            $id = $repository::create($givenParameters, 'wizard', $this->getUri());
-        } catch (Exception $e) {
-            if ($sendResponse) {
-                $this->router->response()->json(array('success' => false, 'error' => $e->getMessage()));
-            }
-            return false;
-        }
-        if ($sendResponse) {
-            $this->router->response()->json(array('success' => true));
-        } else {
-            return $id;
-        }
-    }
-    /**
-     * Delete a object
-     *
-     * Response JSON
-     *
-     * @method post
-     * @route /{object}/delete
-     */
-    public function deleteAction()
-    {
-        $deleteSuccess = true;
-        $errorMessage = '';
-        try {
-            $params = $this->router->request()->paramsPost();
-            $repository = $this->repository;
-            $repository::delete($params['ids']);
-        } catch (Exception $e) {
-            $deleteSuccess = false;
-            $errorMessage = $e->getMessage();
-        }
-        $this->router->response()->json(
-            array(
-                'success' => $deleteSuccess,
-                'errorMessage' => $errorMessage
-            )
-        );
-    }
-    /**
-     *
-     * @method get
-     * @route /{object}/list
-     */
-    public function datatableAction()
-    {
-        $myDatatable = new $this->datatableObject($this->getParams('get'), $this->objectClass);
-        $myDataForDatatable = $myDatatable->getDatas();
-        $this->router->response()->json($myDataForDatatable);
-    }
-    /**
-     * Get the list of massive change fields
-     *
-     * Response JSON
-     *
-     * @method get
-     * @route /{object}/mc_fields
-     */
-    public function getMassiveChangeFieldsAction()
-    {
-        $data = array(
-            'listMc' => array()
-        );
-        $stmt = $this->db->prepare(
-            "SELECT f.field_id, f.label
-            FROM cfg_forms_fields f, cfg_forms_massive_change_fields_relations mcfr, cfg_forms_massive_change mc
-            WHERE mc.route = :route
-                AND mc.massive_change_id = mcfr.massive_change_id
-                AND f.field_id = mcfr.field_id"
-        );
-        $stmt->bindValue(':route', $this->objectBaseUrl . '/mc_fields', \PDO::PARAM_STR);
-        $stmt->execute();
-        while ($row = $stmt->fetch()) {
-            $data['listMc'][$row['field_id']] = $row['label'];
-        }
-        $this->router->response()->json($data);
-    }
-    /**
-     * Get field HTML
-     *
-     * Response HTML
-     *
-     * @method get
-     * @route /{object}/mc_fields/[i:id]
-     */
-    public function getMcFieldAction()
-    {
-        $requestParam = $this->getParams('named');
-        $stmt = $this->routeprepare(
-            "SELECT name, label, default_value, attributes, type, help
-            FROM cfg_forms_fields
-            WHERE field_id = :id"
-        );
-        $stmt->bindValue(':id', $requestParam['id'], \PDO::PARAM_INT);
-        $stmt->execute();
-        $row = $stmt->fetch();
-        $form = new Form('default');
-        $form->add($row, array('id' => 0));
-        $formElements = $form->toSmarty();
-        $this->tpl->assign('field', $formElements[$row['name']]['html']);
-        $this->tpl->display('tools/mcField.tpl');
-    }
-    /**
-     * Duplicate a object
-     *
-     * Response JSON
-     *
-     * @method post
-     * @route /{object}/duplicate
-     */
-    public function duplicateAction()
-    {
-        $duplicateSuccess = true;
-        $errorMessage = '';
-        try {
-            $listDuplicate = json_decode($this->router->request()->param('duplicate'));
-            $objClass = $this->objectClass;
-            $repository = $this->repository;
-            $repository::duplicate($listDuplicate);
-        } catch (Exception $e) {
-            $duplicateSuccess = false;
-            $errorMessage = $e->getMessage();
-        }
-        $this->router->response()->json(
-            array(
-                'success' => $duplicateSuccess,
-                'errorMessage' => $errorMessage
-            )
-        );
-    }
-    /**
-     * Enable object
-     *
-     * @method post
-     * @route /{object}/enable
-     */
-    public function enableAction()
-    {
-        $this->setEnableDisableParameter('1');
-    }
-    /**
-     * Disable object
-     *
-     * @method post
-     * @route /{object}/disable
-     */
-    public function disableAction()
-    {
-        $this->setEnableDisableParameter('0');
-    }
-    /**
-     * Apply the massive change to a object
-     *
-     * Response JSON
-     *
-     * @method post
-     * @route /{object}/massive_change
-     */
-    public function massiveChangeAction()
-    {
-        $massiveChangeSuccess = true;
-        $errorMessage = '';
-        try {
-            $params = $this->router->request()->paramsPost();
-            $objClass = $this->objectClass;
-            foreach ($params['ids'] as $id) {
-                $objClass::update($id, $params['values']);
-            }
-        } catch (Exception $e) {
-            $massiveChangeSuccess = false;
-            $errorMessage = $e->getMessage();
-        }
-        $this->router->response()->json(
-            array(
-                'success' => $massiveChangeSuccess,
-                'errorMessage' => $errorMessage
-            )
-        );
-    }
-    /**
-     * Get relations 
-     *
-     * @param string $relClass
-     */
-    protected function getRelations($relClass)
-    {
-        $requestParam = $this->getParams('named');
-        $repository = $this->repository;
-        $list = $repository::getRelations($relClass, $requestParam['id']);
-        $this->router->response()->json($list);
-    }
-    /**
-     * Get simple relation (1-N)
-     *
-     * @param string $fieldName
-     * @param string $targetObj
-     * @param bool $reverse
-     */
-    public function getSimpleRelation($fieldName, $targetObj, $reverse = false)
-    {
-        $requestParam = $this->getParams('named');
-        $repository = $this->repository;
-        $list = $repository::getSimpleRelation($fieldName, $targetObj, $requestParam['id'], $reverse);
-        $this->router->response()->json($list);
-    }
-    /**
-     * Set enable or disable
-     *
-     * @param string $value
-     * @throws \Centreon\Internal\Exception
-     */
-    protected function setEnableDisableParameter($value)
-    {
-        if (static::$enableDisableFieldName == '') {
-            throw new Exception('Cannot enable or disable this object');
-        }
-        $success = true;
-        $errorMessage = '';
-        $field = static::$enableDisableFieldName;
-        try {
-            $params = $this->router->request()->paramsPost();
-            $repository = $this->repository;
-            foreach ($params['ids'] as $id) {
-                $repository::disable(
-                    array(
-                        'object_id' => $id,
-                        $field => $value
-                    )
-                );
-            }
-        } catch (Exception $e) {
-            $success = false;
-            $errorMessage = $e->getMessage();
-        }
-        $this->router->response()->json(
-            array(
-                'success' => $success,
-                'errorMessage' => $errorMessage
-            )
-        );
-    }
-}

--- a/core/custom/Propel/CentreonMysqlPlatform.php
+++ b//dev/null
@@ -1,157 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Custom\Propel;
-class CentreonMysqlPlatform extends \MysqlPlatform
-{
-    /**
-     * Builds the DDL SQL to alter a table
-     * based on a PropelTableDiff instance
-     *
-     * @return string
-     */
-    public function getModifyTableDDL(\PropelTableDiff $tableDiff)
-    {
-        $ret = '';
-        foreach ($tableDiff->getRemovedFks() as $fk) {
-            $ret .= $this->getDropForeignKeyDDL($fk);
-        }
-        foreach ($tableDiff->getModifiedFks() as $fkName => $fkModification) {
-            list($fromFk, $toFk) = $fkModification;
-            $ret .= $this->getDropForeignKeyDDL($fromFk);
-        }
-        foreach ($tableDiff->getRemovedIndices() as $index) {
-            $ret .= $this->getDropIndexDDL($index);
-        }
-        foreach ($tableDiff->getModifiedIndices() as $indexName => $indexModification) {
-            list($fromIndex, $toIndex) = $indexModification;
-            $ret .= $this->getDropIndexDDL($fromIndex);
-        }
-        foreach ($tableDiff->getRenamedColumns() as $columnRenaming) {
-            $ret .= $this->getRenameColumnDDL($columnRenaming[0], $columnRenaming[1]);
-        }
-        if ($modifiedColumns = $tableDiff->getModifiedColumns()) {
-            $ret .= $this->getModifyColumnsDDL($modifiedColumns);
-        }
-        if ($addedColumns = $tableDiff->getAddedColumns()) {
-            $ret .= $this->getAddColumnsDDL($addedColumns);
-        }
-        foreach ($tableDiff->getRemovedColumns() as $column) {
-            $ret .= $this->getRemoveColumnDDL($column);
-        }
-        if ($tableDiff->hasModifiedPk()) {
-            if ($tableDiff->getFromTable()->getName() === $tableDiff->getToTable()->getName()) {
-                $dropDDL = str_replace(";\n", ", ", $this->getDropPrimaryKeyDDL($tableDiff->getFromTable()));
-                $addDDL = $this->getAddPrimaryKeyDDL($tableDiff->getToTable());
-                $ret .= $dropDDL . (substr($addDDL, strpos($addDDL, "ADD PRIMARY")));
-            } else {
-                $ret .= $this->getDropPrimaryKeyDDL($tableDiff->getFromTable());
-                $ret .= $this->getAddPrimaryKeyDDL($tableDiff->getToTable());
-            }
-        }
-        foreach ($tableDiff->getModifiedIndices() as $indexName => $indexModification) {
-            list($fromIndex, $toIndex) = $indexModification;
-            $ret .= $this->getAddIndexDDL($toIndex);
-        }
-        foreach ($tableDiff->getAddedIndices() as $index) {
-            $ret .= $this->getAddIndexDDL($index);
-        }
-        foreach ($tableDiff->getModifiedFks() as $fkName => $fkModification) {
-            list($fromFk, $toFk) = $fkModification;
-            $ret .= $this->getAddForeignKeyDDL($toFk);
-        }
-        foreach ($tableDiff->getAddedFks() as $fk) {
-            $ret .= $this->getAddForeignKeyDDL($fk);
-        }
-        return $ret;
-    }
-    /**
-     * 
-     * @param \Table $table
-     * @return type
-     */
-    protected function getTableOptions(\Table $table)
-    {
-        $dbVI = $table->getDatabase()->getVendorInfoForType('mysql');
-        $tableVI = $table->getVendorInfoForType('mysql');
-        $vi = $dbVI->getMergedVendorInfo($tableVI);
-        $tableOptions = array();
-        $supportedOptions = array(
-            'AutoIncrement'   => 'AUTO_INCREMENT',
-            'AvgRowLength'    => 'AVG_ROW_LENGTH',
-            'Charset'         => 'CHARACTER SET',
-            'Checksum'        => 'CHECKSUM',
-            'Collate'         => 'COLLATE',
-            'Connection'      => 'CONNECTION',
-            'DataDirectory'   => 'DATA DIRECTORY',
-            'Delay_key_write' => 'DELAY_KEY_WRITE',
-            'DelayKeyWrite'   => 'DELAY_KEY_WRITE',
-            'IndexDirectory'  => 'INDEX DIRECTORY',
-            'InsertMethod'    => 'INSERT_METHOD',
-            'KeyBlockSize'    => 'KEY_BLOCK_SIZE',
-            'MaxRows'         => 'MAX_ROWS',
-            'MinRows'         => 'MIN_ROWS',
-            'Pack_Keys'       => 'PACK_KEYS',
-            'PackKeys'        => 'PACK_KEYS',
-            'RowFormat'       => 'ROW_FORMAT',
-            'Union'           => 'UNION',
-            'Partition'       => 'PARTITION'
-        );
-        foreach ($supportedOptions as $name => $sqlName) {
-            $parameterValue = null;
-            if ($vi->hasParameter($name)) {
-                $parameterValue = $vi->getParameter($name);
-            } elseif ($vi->hasParameter($sqlName)) {
-                $parameterValue = $vi->getParameter($sqlName);
-            }
-            if (!is_null($parameterValue)) {
-                if ($name === 'Partition') {
-                    $tableOptions[] = sprintf('%s %s', $sqlName, $this->parsePartitionCommand($parameterValue));
-                } else {
-                    $parameterValue = is_numeric($parameterValue) ? $parameterValue : $this->quote($parameterValue);
-                    $tableOptions[] = sprintf('%s=%s', $sqlName, $parameterValue);
-                }
-            }
-        }
-        return $tableOptions;
-    }
-    /**
-     * 
-     * @param string $command
-     */
-    protected function parsePartitionCommand($command)
-    {
-        return $command;
-    }
-}

--- a/core/custom/Smarty/function.datatable.php
+++ b//dev/null
@@ -1,62 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.datatable.php
- * Type:     function
- * Name:     datatable
- * Purpose:  returns a datatable
- * -------------------------------------------------------------
- */
-function smarty_function_datatable($params, $smarty)
-{
-    $smarty->assign('object', $params['object']);
-    if (isset($params['objectAddUrl'])) {
-        $smarty->assign('objectAddUrl', $params['objectAddUrl']);
-    }
-    $datatableParameters = array();
-    $datatableParameters['header'] = $params['datatableObject']::getHeader();
-    $datatableParameters['configuration'] = $params['datatableObject']::getConfiguration();
-    $datatableParameters = array_merge($datatableParameters, $params['datatableObject']::getExtraParams());
-    $smarty->assign('datatableParameters', $datatableParameters);
-    if ($params['configuration']) {
-        $smarty->assign('displayActionBar', true);
-    } else {
-        $smarty->assign('displayActionBar', false);
-    }
-    return $smarty->fetch('tools/datatable.tpl');
-}

--- a/core/custom/Smarty/function.datatablejs.php
+++ b//dev/null
@@ -1,49 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.datatable.php
- * Type:     function
- * Name:     datatable
- * Purpose:  returns a datatable
- * -------------------------------------------------------------
- */
-function smarty_function_datatablejs($params, $smarty)
-{
-    $smarty->assign('objectUrl', $params['objectUrl']);
-    return $smarty->fetch('tools/datatableJs.tpl');
-}

--- a/core/custom/Smarty/function.environment_user.php
+++ b//dev/null
@@ -1,59 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.environment_user.php
- * Type:     function
- * Name:     environment_user
- * Purpose:  returns html of environment
- * -------------------------------------------------------------
- */
-function smarty_function_environment_user($params, $template) {
-    $html = '';
-    $m = \Centreon\Internal\Di::getDefault()->get('menu');
-    $envmenu = $m->getMenu(null, null, 'user');
-    foreach ($envmenu as $menu) {
-        $html .= '<a href="#" class="envmenu" data-menu="' . $menu['menu_id'] . '">';
-        if (isset($menu['icon_class']) && $menu['icon_class']) {
-        } elseif (isset($menu['icon']) && $menu['icon']) {
-            $html .= "<img src=\"{$menu['icon']}\" class=\"\">";
-        }
-        $html .= " " . $menu['name'];
-        $html .= "</a>";
-    }
-    return $html;
-}

--- a/core/custom/Smarty/function.get_breadcrumb.php
+++ b//dev/null
@@ -1,118 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.get_breadcrumb.php
- * Type:     function
- * Name:     get_breadcrumb
- * Purpose:  returns The list for breadcrumb
- * -------------------------------------------------------------
- */
-function smarty_function_get_breadcrumb($params, $template)
-{
-    $di = \Centreon\Internal\Di::getDefault();
-    $router = $di->get('router');
-    $route = $router->getCurrentUri();
-    $baseUrl = $di->get('config')->get('global', 'base_url');
-    $route = str_replace($baseUrl, '/', $route);
-    $breadcrumb = array();
-    $db = $di->get('db_centreon');
-    /* Get in database */
-    $queryFindRoute = "SELECT name, parent_id FROM cfg_menus WHERE url = :url";
-    $parentId = null;
-    $stmt = $db->prepare($queryFindRoute);
-    $stmt->bindParam(':url', $route, \PDO::PARAM_STR);
-    $stmt->execute();
-    $row = $stmt->fetch();
-    $stmt->closeCursor();
-    if ($row !== false) {
-        $parentId = $row['parent_id'];
-	    $breadcrumb[] = array(
-		    'name' => $row['name'],
-            'url' => null
-        );
-    } else {
-        $route = dirname($route);
-        $stmt = $db->prepare($queryFindRoute);
-        $stmt->bindParam(':url', $route, \PDO::PARAM_STR);
-        $stmt->execute();
-        $row = $stmt->fetch();
-        $stmt->closeCursor();
-        if ($row === false) {
-            return '';
-        }
-        $parentId = $row['parent_id'];
-        $breadcrumb[] = array(
-            'name' => $row['name'],
-            'url' => null
-        );
-    }
-    $queryGetParent = "SELECT name, parent_id, url FROM cfg_menus WHERE menu_id = :menu_id";
-    while (false === is_null($parentId)) {
-        $stmt = $db->prepare($queryGetParent);
-        $stmt->bindParam(':menu_id', $parentId, \PDO::PARAM_INT);
-        $stmt->execute();
-        $row = $stmt->fetch();
-        $stmt->closeCursor();
-        if ($row === false) {
-            $parentId = null;
-        }
-        $parentId = $row['parent_id'];
-        array_unshift($breadcrumb, array(
-            'name' => $row['name'],
-            'url' => $row['url']
-        ));
-    }
-    $nbLink = count($breadcrumb);
-    $string = '';
-    for ($i = 0; $i < $nbLink; $i++) {
-        $string .= '<li';
-        if ($i == $nbLink - 1) {
-            $string .= ' class="active"';
-        }
-        $string .= '>';
-        if ($i != $nbLink - 1 && !is_null($breadcrumb[$i]['url'])) {
-            $string .= '<a href="' + $breadcrumb[$i]['url'] + '">';
-        }
-        $string .= $breadcrumb[$i]['name'];
-        if ($i != $nbLink - 1 && !is_null($breadcrumb[$i]['url'])) {
-            $string .= '</a>';
-        }
-        $string .= '</li>';
-    }
-    return $string;
-}

--- a/core/custom/Smarty/function.get_custom_js.php
+++ b//dev/null
@@ -1,49 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-use Centreon\Internal\Di;
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.get_custom_js.php
- * Type:     function
- * Name:     get_custom_js
- * Purpose:  returns The custom js from Di
- * -------------------------------------------------------------
- */
-function smarty_function_get_custom_js()
-{
-    $template = Di::getDefault()->get('template');
-    return $template->getCustomJs();
-}

--- a/core/custom/Smarty/function.get_environment_id.php
+++ b//dev/null
@@ -1,71 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.get_environment_id.php
- * Type:     function
- * Name:     get_environment_id
- * Purpose:  returns The id of environment
- * -------------------------------------------------------------
- * @todo - use cache here, LEFT JOIN may have performance issues !
- */
-function smarty_function_get_environment_id($params, $template)
-{
-    $di = \Centreon\Internal\Di::getDefault();
-    $router = $di->get('router');
-    $route = $router->getCurrentUri();
-    $db = $di->get('db_centreon');
-    $arr = array('envid' => 0, 'subid' => 0, 'childid' => 0);
-    /* Get environment */
-    $stmt = $db->prepare("SELECT m1.parent_id as envid, m1.menu_id as subid, 
-            m1.url as lvl1_url, m2.url as lvl2_url, m2.menu_id as childid
-        FROM cfg_menus m1 LEFT JOIN cfg_menus m2 ON m1.menu_id = m2.parent_id
-        WHERE m1.parent_id IN (SELECT menu_id FROM cfg_menus WHERE parent_id IS NULL) 
-        ORDER BY LENGTH(m2.url) DESC, LENGTH(m1.url) DESC");
-    $stmt->execute();
-    $len = 0;
-    while ($row = $stmt->fetch()) {
-	$url = is_null($row['lvl1_url']) ? $row['lvl2_url'] : $row['lvl1_url'];
-        if (preg_match("/^".preg_quote($url, '/')."/", $route, $matches)) {
-            $arr['envid'] = $row['envid'];
-            $arr['subid'] = $row['subid'];
-            $arr['childid'] = is_null($row['childid']) ? 0 : $row['childid'];
-            break;
-        }
-    }
-    return json_encode($arr);
-}

--- a/core/custom/Smarty/function.get_user_homepage.php
+++ b//dev/null
@@ -1,48 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.get_user_homepage.php
- * Type:     function
- * Name:     get_user_homepage
- * Purpose:  returns The homepage for the current user
- * -------------------------------------------------------------
- */
-function smarty_function_get_user_homepage($params, $template)
-{
-    $user = $_SESSION['user'];
-    return $user->getHomePage();
-}

--- a/core/custom/Smarty/function.hook.php
+++ b//dev/null
@@ -1,69 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.hook.php
- * Type:     function
- * Name:     hook
- * Purpose:  returns contents of registered hooks
- * -------------------------------------------------------------
- */
-function smarty_function_hook($params, $template) {
-    $contents = "";
-    if (isset($params['name'])) {
-        $core_params_to_hook = array();
-        if (isset($params['params'])) {
-            $core_params_to_hook = $params['params'];
-        }
-        if (!isset($params['container'])) {
-            $params['container'] = "<div>[hook]</div>";
-        }
-        $hookData = \Centreon\Internal\Hook::execute($params['name'], $core_params_to_hook);
-        foreach ($hookData as $hook) {
-            if (isset($hook['template'])) {
-                $tpl = $template->createTemplate($hook['template']);
-                if (isset($hook['variables'])) {
-                    $tpl->assign('variables', $hook['variables']);
-                }
-                if (isset($params['container'])) {
-                    $contents .= str_replace("[hook]", $template->fetch($tpl), $params['container']);
-                }
-            }
-        }
-    }
-    return $contents;
-}

--- a/core/custom/Smarty/function.preg_match.php
+++ b//dev/null
@@ -1,60 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/**
- * Smarty plugin
- * @package Smarty
- * @subpackage PluginsFunction
- */
-/**
- * Smarty {preg_match} function plugin
- *
- * Type:     function
- * Name:     preg_match
- * Purpose:  offers php preg_match function inside a template
- * @author Damiano Venturin
- * @param array parameters
- * @param object $template template object
- * @return boolean, matches array in template
- */
-function smarty_function_preg_match($params, $template)
-{
-    $flags = (empty($params['flags']) ? 0 : $params['flags']);
-    $offset = (empty($params['offset']) ? 0 : $params['offset']);
-    $match = preg_match("/".$params['pattern']."/", $params['subject'], $matches, $flags, $offset);
-    $template->assign('matches', $matches);
-    return $match;
-}
-?>

--- a/core/custom/Smarty/function.url_for.php
+++ b//dev/null
@@ -1,56 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.url_for.php
- * Type:     function
- * Name:     url_for
- * Purpose:  returns url with complete parameters
- * -------------------------------------------------------------
- */
-function smarty_function_url_for($params) {
-    if (isset($params['url'])) {
-        $routeParams = array();
-        if (isset($params['params']) && is_array($params['params'])) {
-            $routeParams = $params['params'];
-        }
-        $finalRoute = \Centreon\Internal\Di::getDefault()
-            ->get('router')
-            ->getPathFor($params['url'], $routeParams);
-    }
-    return str_replace("//", "/", $finalRoute);
-}

--- a/core/custom/Smarty/function.url_static.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 MERETHIS
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give MERETHIS
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of MERETHIS choice, provided that
- * MERETHIS also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     function.url_static.php
- * Type:     function
- * Name:     url_static
- * Purpose:  returns url with complete for static file
- * -------------------------------------------------------------
- */
-function smarty_function_url_static($params) {
-    $finalRoute = '';
-    if (isset($params['url'])) {
-        $config = \Centreon\Internal\Di::getDefault()->get('config');
-        $finalRoute = $config->get('global', 'base_url', '/centreon');
-        $finalRoute .= '/static/' . $params['url'];
-    }
-    return str_replace('//', '/', $finalRoute);
-}

--- a/core/custom/Smarty/modifier.css.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.css.php
- * Type:     modifier
- * Name:     css
- * Purpose:  outputs a full link tag for a cascading stylesheet file
- * -------------------------------------------------------------
- */
-function smarty_modifier_css($cssFile) {
-    $cssIncludeLine = '<link href="'.
-            $cssFile.
-            '" rel="stylesheet" type="text/css"/>';
-    return $cssIncludeLine;
-}

--- a/core/custom/Smarty/modifier.duration.php
+++ b//dev/null
@@ -1,70 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.duration.php
- * Type:     modifier
- * Name:     duration
- * Purpose:  format a timestamp to the centreon format for duration
- * -------------------------------------------------------------
- */
-function smarty_modifier_duration($timestamp) {
-    $periods = array (
-        'y'	=> 31556926,
-        'M' => 2629743,
-        'w' => 604800,
-        'd' => 86400,
-        'h' => 3600,
-        'm' => 60,
-        's' => 1
-    );
-    $timestamp = (int) $timestamp;
-    foreach ($periods as $period => $value) {
-        $count = floor($timestamp / $value);
-        if ($count == 0) {
-            continue;
-        }
-        $values[$period] = $count;
-        $timestamp = $timestamp % $value;
-    }
-    foreach ($values as $key => $value) {
-        $segment = $value . '' . $key;
-        $array[] = $segment;
-    }
-    $str = implode(' ', $array);
-    return $str;
-}

--- a/core/custom/Smarty/modifier.host_color.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.host_color.php
- * Type:     modifier
- * Name:     host_color
- * Purpose:  outputs a class name depending on host status
- * -------------------------------------------------------------
- */
-function smarty_modifier_host_color($state) {
-    switch ($state) {
-    case 0:
-        $class = "success";
-        break;
-    case 1:
-        $class = "danger";
-        break;
-    case 2:
-        $class = "primary";
-        break;
-    default:
-        $class = "default";
-        break;
-    }    
-    return $class;
-}

--- a/core/custom/Smarty/modifier.img.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.img.php
- * Type:     modifier
- * Name:     img
- * Purpose:  outputs a full script tag for an image file
- * -------------------------------------------------------------
- */
-function smarty_modifier_img($imgFile) {
-    $di = \Centreon\Internal\Di::getDefault();
-    $config = $di->get('config');
-    $baseUrl = rtrim($config->get('global','base_url'), '/').'/static/centreon/img/';
-    $imgIncludeLine = '<img alt="'.$imgFile.'"'
-        . 'src="'.$baseUrl.$imgFile.'" />';
-    return $imgIncludeLine;
-}

--- a/core/custom/Smarty/modifier.js.php
+++ b//dev/null
@@ -1,48 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.js.php
- * Type:     modifier
- * Name:     js
- * Purpose:  outputs a full script tag for a javascript file
- * -------------------------------------------------------------
- */
-function smarty_modifier_js($jsFile) {
-    $jsIncludeLine = '<script src="'.$jsFile.'"></script>';
-    return $jsIncludeLine;
-}

--- a/core/custom/Smarty/modifier.service_color.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.service_color.php
- * Type:     modifier
- * Name:     service_color
- * Purpose:  outputs a class name depending on service status
- * -------------------------------------------------------------
- */
-function smarty_modifier_service_color($state) {
-    switch ($state) {
-    case 0:
-        $class = "success";
-        break;
-    case 1:
-        $class = "warning";
-        break;
-    case 2:
-        $class = "danger";
-        break;
-    default:
-        $class = "default";
-        break;
-    }
-    return $class;
-}

--- a/core/custom/Smarty/modifier.url.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-/*
- * Smarty plugin
- * -------------------------------------------------------------
- * File:     modifier.url.php
- * Type:     modifier
- * Name:     url
- * Purpose:  outputs a full url
- * -------------------------------------------------------------
- */
-function smarty_modifier_url($url) {
-    $di = \Centreon\Internal\Di::getDefault();
-    $config = $di->get('config');
-    $fullUrl = rtrim($config->get('global','base_url'), '/').$url;
-    return $fullUrl;
-}

--- a/core/internal/Acl.php
+++ b//dev/null
@@ -1,155 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal;
-class Acl
-{
-    const ADD = 1;
-    const DELETE = 2;
-    const UPDATE = 4;
-    const VIEW = 8;
-    const ADVANCED = 16;
-    private $routes;
-    private $isAdmin;
-    private $userId;
-    /**
-     * Constructor
-     *
-     * @param \Centreon\User $userId
-     */
-    public function __construct($user)
-    {
-        $this->userId = $user->getId();
-        $this->isAdmin = $user->isAdmin();
-    }
-    /**
-     * Checks whether or not a flag is set
-     *
-     * @param int $values
-     * @param int $flag
-     * @return bool
-     */
-    public static function isFlagSet($values, $flag)
-    {
-        return (($values & $flag) === $flag);
-    }
-    /**
-     * Get user ACL
-     *
-     * @param string $route
-     */
-    public function getUserAcl($route)
-    {
-        static $rules = null;
-        if (is_null($rules)) {
-            $rules = array();
-            $db = Di::getDefault()->get('db_centreon');
-            $stmt = $db->prepare(
-                "SELECT DISTINCT acl_level, url 
-                FROM cfg_acl_menu_menu_relations ammr, cfg_acl_groups_menus_relations agmr, cfg_menus m
-                WHERE ammr.acl_menu_id = agmr.acl_menu_id
-                AND ammr.menu_id = m.menu_id
-                AND agmr.acl_group_id IN (
-                    SELECT acl_group_id 
-                    FROM cfg_acl_group_contacts_relations agcr
-                    WHERE agcr.contact_contact_id = :contactid
-                    UNION
-                    SELECT acl_group_id
-                    FROM cfg_acl_group_contactgroups_relations agcgr, cfg_contactgroups_contacts_relations ccr
-                    WHERE agcgr.cg_cg_id = ccr.contactgroup_cg_id
-                    AND ccr.contact_contact_id = :contactid
-                ) "
-            );
-            $stmt->bindParam(':contactid', $this->userId);
-            $stmt->execute();
-            $rows = $stmt->fetchAll();
-            $aclFlag = 0;
-            foreach ($rows as $row) {
-                if (!isset($rules[$row['url']])) {
-                    $rules[$row['url']] = 0;
-                }
-                $rules[$row['url']] = $rules[$row['url']] | $row['acl_level'];
-            }
-        }
-        foreach ($rules as $uri => $acl) {
-            if (strstr($route, $uri)) {
-                return $acl;
-            }
-        }
-    }
-    /**
-     * Check whether user is allowed to access route
-     *
-     * @param array $data
-     * @return bool
-     */
-    public function routeAllowed($data)
-    {
-        if ($this->isAdmin) {
-            return true;
-        }
-        if ($data['route'] && $data['acl']) {
-            return self::isFlagSet($this->getUserAcl($data['route']), $data['acl']);
-        }
-        return true;
-    }
-    /**
-     * Convert ACL flags
-     *
-     * @return int
-     */
-    public static function convertAclFlags($aclFlags)
-    {
-        $flag = 0;
-        foreach ($aclFlags as $flag) {
-            switch (strtolower($flag)) {
-                case "add":
-                    $f = self::ADD;
-                    break;
-                case "delete":
-                    $f = self::DELETE;
-                    break;
-                case "update":
-                    $f = self::UPDATE;
-                    break;
-                case "view":
-                    $f = self::VIEW;
-                    break;
-            }
-            $flag = $flag | $f;
-        }
-        return $flag;
-    }
-}

--- a/core/internal/Api.php
+++ b//dev/null
@@ -1,211 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Router;
-use Centreon\Internal\Exception\HttpException;
-use Centreon\Internal\Exception\Http\BadRequestException;
-use Centreon\Internal\Exception\Http\UnauthorizedException;
-use CentreonConfiguration\Repository\UserRepository;
-/**
- * Description of Api
- *
- * @author lionel
- */
-class Api extends HttpCore
-{
-    /**
-     * If a api route need the auth token
-     * @var array
-     */
-    protected static $routeAuth = array();
-    /**
-     * 
-     * @param type $request
-     */
-    protected function __construct($request)
-    {
-        parent::__construct($request);
-    }
-    /**
-     * 
-     * @param type $object
-     * @param type $objectData
-     * @param type $links
-     */
-    protected function sendJsonApiResponse($object, $objectData, $links = array())
-    {
-        $finalResponse = array(strtolower($object) => $objectData);
-        if (count($finalResponse) > 0) {
-            $finalResponse['links'] = $links;
-        }
-        $this->router->response()->header('Content-Type', 'application/json');
-        $this->router->response()->json($finalResponse);
-    }
-    /**
-     * Get routes
-     *
-     * @return array
-     */
-    public static function getRoutes()
-    {
-        $tempo = array();
-        $obj = get_called_class();
-        $ref = new \ReflectionClass(get_called_class());
-        foreach ($ref->getMethods() as $method) {
-            $methodName = $method->getName();
-            if (substr($methodName, -6) == 'Action') {
-                foreach (explode("\n", $method->getDocComment()) as $line) {
-                    $str = trim(str_replace("* ", '', $line));
-                    if (substr($str, 0, 6) == '@route') {
-                        $route = substr($str, 6);
-                        $objExp = explode('\\', $obj);
-                        $nbOcc = count($objExp) -1;
-                        $finalName = substr($objExp[$nbOcc], 0, strlen($objExp[$nbOcc])-3);
-                        $route = str_replace('{object}', strtolower($finalName), $route);
-                        $tempo[$methodName]['route'] = trim($route);
-                    } elseif (substr($str, 0, 7) == '@method') {
-                        $method_type = strtoupper(substr($str, 7));
-                        $tempo[$methodName]['method_type'] = trim($method_type);
-                    } elseif (substr($str, 0, 4) == '@acl') {
-                        $aclFlags = explode(",", trim(substr($str, 4)));
-                        $tempo[$methodName]['acl'] = Acl::convertAclFlags($aclFlags);
-                    } elseif (substr($str, 0, 5) == '@auth') {
-                        $tempo[$methodName]['auth'] = true;
-                    } elseif (substr($str, 0, 4) == '@api') {
-                        $route = substr($str, 4);
-                        /* @todo better */
-                        $objExp = explode('\\', $obj);
-                        $nbOcc = count($objExp) -1;
-                        $finalName = substr($objExp[$nbOcc], 0, strlen($objExp[$nbOcc])-3);
-                        $route = str_replace('{object}', strtolower($finalName), $route);
-                        $tempo[$methodName]['api_route'] = trim($route);
-                    } elseif (substr($str, 0, 6) == '@since') {
-                        $version = substr($str, 6);
-                        $tempo[$methodName]['api_version'] = trim($version);
-                    }
-                }
-                if (isset($tempo[$methodName]['auth']) && $tempo[$methodName]['auth']) {
-                    if (isset($tempo[$methodName]['route'])) {
-                        static::$routeAuth[] = '\\' . $obj . '::' . $methodName;
-                    }
-                }
-            }
-        }
-        return $tempo;
-    }
-    /**
-     * 
-     * @param type $requestMethod
-     * @param type $requestVersion
-     */
-    public function executeRoute($requestMethod, $requestVersion = null)
-    {
-        try {
-            $routeVersion = Router::getApiVersion($requestMethod);
-            if (in_array($requestMethod, static::$routeAuth)) {
-                $headers = $this->request->headers();
-                if (!isset($headers['centreon-x-token'])) {
-                    throw new BadRequestException('Missing Token', 'The Token for the request is not present');
-                }
-                $token = $headers['centreon-x-token'];
-                if (!\CentreonAdministration\Repository\UserRepository::checkApiToken($token)) { /* method auth */
-                    throw new UnauthorizedException('Invalid Token', 'The Token is not valid');
-                }
-            }
-            $methodName = null;
-            $currentVersion = null;
-            if (isset($routeVersion[$requestVersion])) {
-                $methodName = $routeVersion[$requestVersion];
-            } elseif (isset($routeVersion)) {
-                foreach ($routeVersion as $version => $method) {
-                    if (is_null($requestVersion)) {
-                        if (is_null($currentVersion)) {
-                            $currentVersion = $version;
-                            $methodName = $method;
-                        } else {
-                            if (version_compare($currentVersion, $version, '>')) {
-                                $currentVersion = $version;
-                                $methodName = $method;
-                            }
-                        }
-                    } else {
-                        if (version_compare($version, $requestVersion, '<')) {
-                            if (is_null($currentVersion)) {
-                                $currentVersion = $version;
-                                $methodName = $method;
-                            } else {
-                                if (version_compare($currentVersion, $version, '>')) {
-                                    $currentVersion = $version;
-                                    $methodName = $method;
-                                }
-                            }
-                        }
-                    }
-                }
-            }
-            if (is_null($methodName)) {
-                throw new Exception\Http\NotFoundException('Action does not exist', 'The requested action does not exist');
-            }
-            $calledMethod = function($className, $methodName, $request) {
-                $classToCall = $className::getHttpCoreInstance($request);
-                $classToCall->$methodName();
-            };
-            $className = get_called_class();
-            $calledMethod($className, $methodName, $this->request);
-        } catch (HttpException $ex) {
-            $errorObject = array(
-                'id' => '',
-                'href' => '',
-                'status' => $ex->getCode(),
-                'code' => $ex->getInternalCode(),
-                'title' => $ex->getTitle(),
-                'detail' => $ex->getMessage(),
-                'links' => '',
-                'path' => ''
-            );
-            $this->router->response()->code($ex->getCode())->json($errorObject);
-        } catch (Exception $ex) {
-            $this->router->response()->code(500);
-        }
-    }
-    /**
-     * 
-     * @param type $code
-     * @param type $exceptionParams
-     */
-    public static function raiseHttpException($code, $exceptionParams)
-    {
-    }
-}

--- a/core/internal/Bootstrap.php
+++ b//dev/null
@@ -1,244 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-use Evenement\EventEmitter;
-/**
- * Class Bootstrap
- * In charge of initializing the application context.
- * Loaded early during request processing by either front controller (index.php) or centreonConsole
- * Will init the service container (Di) thru Di->init() to init all services or Di->init(array of services to init) to only
- * init a subset of services...
- * @package Centreon\Internal
- */
-class Bootstrap
-{
-    /**
-     *
-     * @var \Centreon\Internal\Di
-     */
-    private $di;
-    /**
-     * Constructor
-     */
-    public function __construct()
-    {
-        $this->di = new Di();
-    }
-    /**
-     * Init a selection of methods
-     *
-     * @param array $sections
-     */    
-    private function customInit(array $sections)
-    {
-        foreach($sections as $section) {
-            $method = "init" . ucfirst($section);
-            if (method_exists($this, $method)) {
-                $this->$method();
-            }
-        }
-    }
-    /**
-     * Init method
-     */
-    public function init($sectionToInit = null)
-    {
-        if (isset($sectionToInit)) {
-            $this->customInit($sectionToInit);
-        } else {
-            $class = new \ReflectionClass(__CLASS__);
-            $methods = $class->getMethods(\ReflectionMethod::IS_PRIVATE);
-            foreach ($methods as $method) {
-                if (preg_match('/^init/', $method->name)) {
-                    $this->{$method->name}();
-                }
-            }
-        }
-    }
-    /**
-     * Init configuration object
-     */
-    private function initConfiguration()
-    {
-        $this->config = new Config(CENTREON_ETC . '/centreon.ini');
-        $this->di->setShared('config', $this->config);
-    }
-    /**
-     * Init the logger
-     */
-    private function initLogger()
-    {
-        Logger::load($this->config);
-    }
-    /**
-     * Init database objects
-     *
-     * @todo add profiler
-     */
-    private function initDatabase()
-    {
-        $config = $this->config;
-        $this->di->set(
-            'db_centreon',
-            function () use ($config) {
-                return new Db(
-                    $config->get('db_centreon', 'dsn'),
-                    $config->get('db_centreon', 'username'),
-                    $config->get('db_centreon', 'password'),
-                    array(
-                        \PDO::MYSQL_ATTR_FOUND_ROWS => true
-                    )
-                );
-            }
-        );
-    }
-    /**
-     * Init cache
-     */
-    private function initCache()
-    {
-        $cache = Cache::load($this->config);
-        $this->di->setShared('cache', $cache);
-    }
-    /**
-     * Load configuration from database
-     */
-    private function initConfigFromDb()
-    {
-        $this->di->get('config')->loadFromDb();
-    }
-    /**
-     * Init action hooks
-     */
-    private function initEvents()
-    {
-        $this->di->set(
-            'events',
-            function () {
-                return new EventEmitter();
-            }
-        );
-        Event::initEventListeners();
-    }
-    /**
-     * Init template object
-     */
-    private function initTemplate()
-    {
-        $this->di->set(
-            'template',
-            function () {
-                $tmpl = new Template();
-                $tmpl->initStaticFiles();
-                return $tmpl;
-            }
-        );
-    }
-    /**
-     * Init menus
-     */
-    private function initMenus()
-    {
-        $this->di->set(
-            'menu',
-            function () {
-                return new Menu();
-            }
-        );
-    }
-    /**
-     * Init routes
-     */
-    private function initRoutes()
-    {
-        $this->di->set(
-            'router',
-            function () {
-                $router = new Router();
-                /* Add middleroute for CSRF token */
-                $router->respond(function ($request, $response, $service, $app)
-                    {
-                        /* Get the token */
-                        $headers = $request->headers();
-                        $tokenValue = '';
-                        foreach (Csrf::getHeaderNames() as $headerName) {
-                            if ($headers->exists($headerName)) {
-                                $tokenValue = $headers[$headerName];
-                                break;
-                            }
-                        }
-                        $toSend = false;
-                        /*
-                         * Test if must test the token 
-                         * @todo better management with middleware global implementation
-                         */
-                        $excludeRoute = array(
-                            '/api'
-                        );
-                        $matchingRoute = array_filter($excludeRoute, function ($route) use ($request) {
-                            $route = rtrim(Di::getDefault()->get('config')->get('global', 'base_url'), '/') . $route;
-                            if ($route == substr($request->pathname(), 0, strlen($route))) {
-                                return true;
-                            }
-                            return false;
-                        });
-                        if (count($matchingRoute) == 0) {
-                            if (false === Csrf::checkToken($tokenValue, $request->method())) {
-                                $toSend = true;
-                                $response->cookie(Csrf::getCookieName(), Csrf::generateToken(), 0);
-                                $response->code(403)->json(array("message" => "CSRF Token is no valid"));
-                            } else {
-                                if ($tokenValue == '' || Csrf::mustBeGenerate($request->method())) {
-                                    /* Generate and send a new csrf cookie */
-                                    $response->cookie(Csrf::getCookieName(), Csrf::generateToken(), 0);
-                                }
-                            }
-                        }
-                    }
-                );
-                /* Parsing route */
-                $router->parseRoutes();
-                return $router;
-            }
-        );
-    }
-    /**
-     * Init organization
-     */
-    private function initOrganization()
-    {
-        $this->di->setShared('organization', 1);
-    }
-}

--- a/core/internal/Cache.php
+++ b//dev/null
@@ -1,90 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-use Desarrolla2\Cache\Cache as DesarrollaCache;
-use Desarrolla2\Cache\Adapter\Apc as ApcCache;
-use Desarrolla2\Cache\Adapter\MemCache;
-use Desarrolla2\Cache\Adapter\Memcached;
-use Desarrolla2\Cache\Adapter\NotCache;
-/**
- * Class for loading cache informations
- *
- * @see http://www.php.net/manual/en/class.pdo.php
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Cache
-{
-    /**
-     * Create cache object
-     *
-     * @param $config \Centreon\Config The application configuration
-     * @return \Desarrolla2\Cache\Cache
-     */
-    public static function load($config)
-    {
-        $cacheType = null;
-        if ($config->get('cache', 'enabled')) {
-            $cacheType = $config->get('cache', 'type');
-        }
-        switch ($cacheType) {
-            case 'apc':
-                $driver = new ApcCache();
-                break;
-            case 'memcache':
-                $driver = new MemCache();
-                foreach ($config->get('cache', 'servers') as $server) {
-                    list($serverHost, $serverPort) = explode(':', $server);
-                    $driver->addServer($serverHost, $serverPort);
-                }
-                break;
-            case 'memcached':
-                $driver = new Memcached();
-                foreach ($config->get('cache', 'servers') as $server) {
-                    list($serverHost, $serverPort) = explode(':', $server);
-                    $driver->addServer($serverHost, $serverPort);
-                }
-                break;
-            case null:
-            default:
-                $driver = new NotCache();
-                break;
-        }
-        $ttl = $config->get('cache', 'ttl', 3600);
-        $driver->setOption('ttl', $ttl);
-        return new DesarrollaCache($driver);
-    }
-}

--- a/core/internal/Command.php
+++ b//dev/null
@@ -1,297 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Di;
-use Centreon\Internal\Utils\CommandLine\Colorize;
-use Centreon\Internal\Module\Informations;
-class Command
-{
-    private $requestLine;
-    private $parametersLine;
-    private $commandList;
-    /**
-     * 
-     * @param string $requestLine
-     * @param string $parametersLine
-     */
-    public function __construct($requestLine, $parametersLine)
-    {
-        try {
-            $bootstrap = new Bootstrap();
-            $sectionToInit = array('configuration', 'database', 'cache', 'logger', 'organization', 'events');
-            $bootstrap->init($sectionToInit);
-            $this->requestLine = $requestLine;
-            $this->parametersLine = $parametersLine;
-            $modulesToParse = array();
-            $coreCheck = preg_match("/^core:/", $requestLine);
-            if (($coreCheck === 0) || ($coreCheck === false)){
-                foreach (glob(__DIR__."/../../modules/*Module") as $moduleTemplateDir) {
-                    $modulesToParse[] = basename($moduleTemplateDir);
-                }
-            }
-            $this->parseCommand($modulesToParse);
-        } catch (\Exception $e) {
-            echo $e;
-        }
-    }
-    /**
-     * 
-     */
-    public function authenticate($username, $password = "")
-    {
-        echo "Authentication not implemented yet\n";
-    }
-    /**
-     * 
-     */
-    public function getHelp()
-    {
-        echo "Help not yet implemented\n";
-    }
-    /**
-     * 
-     */
-    public function getCommandList()
-    {
-        $requestLineExploded = explode(':', $this->requestLine);
-        $nbOfElements = count($requestLineExploded);
-        if (($nbOfElements == 1) && ($requestLineExploded[0] == "")) {
-            $this->displayCommandList($this->commandList);
-        } else {
-            $module = $requestLineExploded[0];
-            $this->displayCommandList($this->commandList[$module], $module);
-        }
-    }
-    /**
-     * Display the current installed version
-     */
-    public function getVersion()
-    {
-        $dbconn = Di::getDefault()->get('db_centreon');
-        try {
-            $stmt = $dbconn->query('SELECT value FROM cfg_informations where `key` = "version"');
-        } catch (\Exception $e) {
-            throw new \Exception("Version not present.");
-        }
-        if (0 === $stmt->rowCount()) {
-            throw new \Exception("Version not present.");
-        }
-        $row = $stmt->fetch();
-        $stmt->closeCursor();
-        echo $row['value'] . "\n";
-    }
-    /**
-     * 
-     * @param array $ListOfCommands
-     */
-    private function displayCommandList($ListOfCommands, $module = null)
-    {
-        if (!is_null($module)) {
-            $ListOfCommands = array($module => $ListOfCommands);
-        }
-        foreach ($ListOfCommands as $module => $section) {
-            if ($module == 'core') {
-                $moduleColorized = Colorize::colorizeText($module, "blue", "black", true);
-            } else {
-                $moduleColorized = Colorize::colorizeText($module, "purple", "black", true);
-            }
-            echo "[" . $moduleColorized . "]\n";
-            foreach ($section as $sectionName => $call) {
-                $explodedSectionName = explode('\\', $sectionName);
-                $nbOfChunk = count($explodedSectionName);
-                $commandName = "";
-                for ($i=0 ;$i<($nbOfChunk-1); $i++) {
-                    $commandName .= strtolower($explodedSectionName[$i]) . ':';
-                }
-                $commandName .= strtolower(str_replace("Command", "", $explodedSectionName[$nbOfChunk - 1]));
-                $classReflection = new \ReflectionClass($call);
-                $actionList = $classReflection->getMethods(\ReflectionMethod::IS_PUBLIC);
-                foreach ($actionList as $action) {
-                    if (strpos($action->getName(), "Action")) {
-                        $actionName = str_replace("Action", "", $action->getName());
-                        $colorizedAction = Colorize::colorizeText($actionName, "yellow", "black", true);
-                        echo "    $moduleColorized:$commandName:$colorizedAction\n";
-                    }
-                }
-                echo "\n";
-            }
-            echo "\n\n";
-        }
-    }
-    /**
-     * 
-     * @throws Exception
-     */
-    public function executeRequest()
-    {
-        $requestLineElements = $this->parseRequestLine();
-        $module = $requestLineElements['module'];
-        $object = ltrim($requestLineElements['object'], '\\');
-        $action = $requestLineElements['action'];
-        if (strtolower($module) != 'core') {
-            if (!Informations::isModuleReachable($module)) {
-                throw new Exception("The module doesn't exist");
-            }
-        }
-        if (!isset($this->commandList[$module][$object])) {
-            throw new Exception("The object $object doesn't exist");
-        }
-        $aliveObject = new $this->commandList[$module][$object]();
-        if (!method_exists($aliveObject, $action)) {
-            throw new Exception("The action '$action' doesn't exist");
-        }
-        $actionArgs = array();
-        if (!is_null($this->parametersLine)) {
-            $this->getArgs($actionArgs, $aliveObject, $action);
-        }
-        $aliveObject->named($action, $actionArgs);
-        echo "\n";
-    }
-    /**
-     * 
-     */
-    private function parseRequestLine()
-    {
-        $requestLineExploded = explode(':', $this->requestLine);
-        $nbOfElements = count($requestLineExploded);
-        $module = $requestLineExploded[0];
-        $object = ucfirst($requestLineExploded[($nbOfElements - 2)]) . 'Command';
-        $action = $requestLineExploded[($nbOfElements - 1)] . 'Action';
-        if ($nbOfElements > 3) {
-            $objectRaw = "";
-            for ($i=1; $i<($nbOfElements - 2); $i++) {
-                $objectRaw .= ucfirst($requestLineExploded[$i]) . '\\';
-            }
-            $object = $objectRaw . $object;
-        } elseif ($nbOfElements < 3) {
-            throw new Exception("The request is not valid");
-        }
-        return array(
-            'module' => $module,
-            'object' => $object,
-            'action' => $action
-        );
-    }
-    /**
-     * 
-     * @param type $aliveObject
-     * @param type $action
-     */
-    private function getArgs(array &$argsList, $aliveObject, $action)
-    {
-        $rawRistOfArgs = explode(':', $this->parametersLine);
-        foreach ($rawRistOfArgs as $rawArgs) {
-            $currentArgsValue = explode('=', $rawArgs);
-            $argsList[$currentArgsValue[0]] = $currentArgsValue[1];
-        }
-    }
-    /**
-     * 
-     * @param type $object
-     * @param type $method
-     */
-    public function parseAction($object, $method)
-    {
-        $classReflection = new \ReflectionClass($object);
-        $methodReflection = $classReflection->getMethod($method);
-        $docComment = $methodReflection->getDocComment();
-        preg_match_all('/@param\s+([A-z]+)\s+(\$[A-z]+)(.*)/', $docComment, $matches);
-        $paramList = array();
-        $nbElement = count($matches) - 1;
-        for ($i=0; $i<$nbElement; $i++) {
-            $pDescription = "";
-            $pName = str_replace('$', '', $matches[2][$i]);
-            $pType = $matches[1][$i];
-            if (isset($matches[3][$i])) {
-                $pDescription .= trim($matches[3][$i]);
-            }
-            $paramList[$pName] = array(
-                'type' => $pType,
-                'description' => $pDescription
-            );
-        }
-    }
-    /**
-     * 
-     * @param array $modules
-     */
-    private function parseCommand($modules)
-    {
-        $this->commandList = array();
-        $this->getCommandDirectoryContent(realpath(__DIR__."/../commands/"));
-        foreach ($modules as $module) {
-            $moduleName = str_replace('Module', '', $module);
-            preg_match_all('/[A-Z]?[a-z]+/', $moduleName, $myMatches);
-            $moduleShortName = strtolower(implode('-', $myMatches[0]));
-            if (Informations::isModuleReachable($moduleShortName)) {
-                $this->getCommandDirectoryContent(
-                    __DIR__ . "/../../modules/$module/commands/",
-                    $moduleShortName,
-                    $moduleName
-                );
-            }
-        }
-    }
-    /**
-     * 
-     * @param string $dirname
-     * @param string $module
-     * @param string $namespace
-     */
-    private function getCommandDirectoryContent($dirname, $module = 'core', $namespace = 'Centreon')
-    {
-        $path = realpath($dirname);
-        if (file_exists($path)) {
-            $listOfDirectories = glob($path . '/*');
-            while (count($listOfDirectories) > 0) {
-                $currentFolder = array_shift($listOfDirectories);
-                if (is_dir($currentFolder)) {
-                    $listOfDirectories = array_merge($listOfDirectories, glob($currentFolder . '/*'));
-                } elseif (pathinfo($currentFolder, PATHINFO_EXTENSION) == 'php') {
-                    $objectName = str_replace(
-                        '/',
-                        '\\',
-                        substr(
-                            $currentFolder,
-                            (strlen($path) + 1),
-                            (strlen($currentFolder) - strlen($path) - 5)
-                        )
-                    );
-                    $this->commandList[$module][$objectName] = '\\'.$namespace.'\\Commands\\'.str_replace('/', '\\', $objectName);
-                }
-            }
-        }
-    }
-}

--- a/core/internal/Command/AbstractCommand.php
+++ b//dev/null
@@ -1,85 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal\Command;
-use Centreon\Internal\Di;
-abstract class AbstractCommand
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $db;
-    /**
-     *
-     * @var type 
-     */
-    protected $di;
-    /**
-     *
-     * @var string 
-     */
-    public static $moduleName = 'Core';
-    /**
-     * 
-     */
-    public function __construct()
-    {
-        $this->di = Di::getDefault();
-        $this->db = $this->di->get('db_centreon');
-    }
-    /**
-     * 
-     * @param string $method
-     * @param array $args
-     * @return mixed
-     */
-    public function named($method, array $args)
-    {
-        $classReflection = new \ReflectionClass($this);
-        $methodReflection = $classReflection->getMethod($method);
-        $pass = array();
-        foreach ($methodReflection->getParameters() as $param) {
-            if (isset($args[$param->getName()])) {
-                $pass[] = $args[$param->getName()];
-            } elseif ($param->isOptional()) {
-                $pass[] = $param->getDefaultValue();
-            } else {
-                throw new \Exception('The parameter "' . $param->getName(). '" is missing');
-            }
-        }
-        $methodReflection->invokeArgs($this, $pass);
-    }
-}

--- a/core/internal/Config.php
+++ b//dev/null
@@ -1,179 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Class for Centreon Configuration
- *
- * @see http://www.php.net/manual/en/class.pdo.php PHP PDO
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Config
-{
-    /**
-     * @var string The list of group from config file, this group is readonly
-     */
-    private $fileGroups = array(
-        'db_centreon',
-        'db_storage',
-        'loggers',
-        'cache',
-        'template',
-        'static_file',
-        'global'
-    );
-    /**
-     * @var array The application configuration
-     */
-    private $config = null;
-    /**
-     * Constructor
-     *
-     * @param $filename string The configuration filename, this file is in ini format
-     * @throws \Centreon\Exception The configuration file is not readable
-     */
-    public function __construct($filename)
-    {
-        if (false === is_readable($filename)) {
-            throw new Exception("The configuration file is not readable.");
-        }
-        try {
-            $this->config = parse_ini_file($filename, true);
-        } catch (\Exception $e) {
-            throw new Exception("Error when parsing configuration file.", 0, $e);
-        }
-        if (false === $this->config) {
-            throw new Exception("Error when parsing configuration file.");
-        }
-    }
-    /**
-     * Load configuration from Centreon database
-     */
-    public function loadFromDb()
-    {
-        $di = Di::getDefault();
-        /* Load from cache if exists */
-        if ($di->get('cache')->has('app:config')) {
-            $configTmp = $di->get('cache')->get('app:config');
-            foreach ($configTmp as $group => $configGroup) {
-                if (false === in_array($group, $this->fileGroups)) {
-                    $this->config[$group] = $configGroup;
-                }
-            }
-            return;
-        }
-        /* Load from database */
-        $dbconn = $di->get('db_centreon');
-        $stmt = $dbconn->query(
-            "SELECT `group`, `key`, `value`
-                FROM `cfg_options`
-                ORDER BY `group`, `key`"
-        );
-        while ($row = $stmt->fetch()) {
-            if (false === in_array($row['group'], $this->fileGroups)) {
-                if (false === isset($this->config[$row['group']])) {
-                    $this->config[$row['group']] = array();
-                }
-                $this->config[$row['group']][$row['key']] = $row['value'];
-            }
-        }
-        $stmt->closeCursor();
-        /* Save config into cache */
-        $di->get('cache')->set('app:config', $this->config);
-    }
-    /**
-     * Get a configuration value
-     *
-     * @param $group string The group of configuration
-     * @param $var string The variable name
-     * @param $default mixed The default value if the variable doesn't exists
-     * @return mixed
-     */
-    public function get($group, $var, $default = null)
-    {
-        if (isset($this->config[$group]) && isset($this->config[$group][$var])) {
-            return $this->config[$group][$var];
-        }
-        return $default;
-    }
-    /**
-     * Get a full section informaiton
-     *
-     * @param $group string The group of configuration
-     * @return array
-     */
-    public function getGroup($group)
-    {
-        if (isset($this->config[$group])) {
-            return $this->config[$group];
-        }
-        return array();
-    }
-    /**
-     * Set a configuration variable
-     *
-     * @param $group string The group of configuration
-     * @param $var string The variable name
-     * @param $value mixed The value to store
-     * @throws The group is not permit for store in database
-     * @throws If the configuration is not set in database
-     */
-    public function set($group, $var, $value)
-    {
-        if (in_array($group, $this->fileGroups)) {
-            throw new Exception("This configuration group is not permit.");
-        }
-        if (false === isset($this->config[$group]) || false === isset($this->config[$group][$var])) {
-            throw new Exception("This configuration $group - $var does not exists into database.");
-        }
-        $di = Di::getDefault();
-        /* Save information in database */
-        $dbconn = $di->get('db_centreon');
-        $stmt = $dbconn->prepare(
-            "UPDATE `cfg_options`
-                SET `value` = :value
-                WHERE `group` = :group
-                    AND `key` = :key"
-        );
-        $stmt->bindParam(':value', $value, \PDO::PARAM_STR);
-        $stmt->bindParam(':group', $group, \PDO::PARAM_STR);
-        $stmt->bindParam(':key', $var, \PDO::PARAM_STR);
-        $stmt->execute();
-        $this->config[$group][$var] = $value;
-        /* Save config into cache */
-        $di->get('cache')->set('app:cache', $this->config);
-    }
-}

--- a/core/internal/Controller.php
+++ b//dev/null
@@ -1,108 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Di;
-abstract class Controller extends HttpCore
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $tpl;
-    /**
-     * 
-     */
-    protected function __construct($request)
-    {
-        parent::__construct($request);
-        $this->tpl = Di::getDefault()->get('template');
-        $this->init();
-    }
-    /**
-     * 
-     * @param string $varname
-     * @param mixed $value
-     */
-    protected function assignVarToTpl($varname, $value)
-    {
-        $this->tpl->assign($varname, $value);
-    }
-    /**
-     * 
-     * @param string $cssFile
-     * @param string $origin
-     */
-    protected function addCssToTpl($cssFile, $origin = 'current')
-    {
-        $this->tpl->addCss($cssFile);
-    }
-    /**
-     * 
-     * @param string $jsFile
-     * @param string $origin
-     */
-    protected function addJsToTpl($jsFile, $origin = 'current')
-    {
-        $this->tpl->addJs($jsFile);
-    }
-    /**
-     * 
-     * @param string $tplFile
-     */
-    protected function display($tplFile)
-    {
-        $tplDirectory = 'file:['. static::$moduleName . 'Module]';
-        $this->tpl->display($tplDirectory . $tplFile);
-    }
-    /**
-     *
-     */
-    protected function init()
-    {
-        $md5Email = "";
-        if (isset($_SESSION['user'])) {
-            try {
-                $md5Email = md5($_SESSION['user']->getEmail());
-            } catch (Exception $e) {
-                ;
-            }
-        }
-        /*
-         * Set md5Email for Gravatar
-         */
-        $this->tpl->assign("md5Email", $md5Email);
-    }
-}

--- a/core/internal/Csrf.php
+++ b//dev/null
@@ -1,111 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Class for manage CSRF Token
- *
- * @version 3.0.0
- * @package Centreon
- * @author Maximilien Bersoult <mbersoult@centreon.com>
- */
-class Csrf
-{
-    private static $ignoreMethod = array(
-        'GET',
-        'OPTIONS',
-        'HEAD'
-    );
-    private static $sessionTokenName = 'CSRF_TOKEN';
-    private static $cookieName = 'XSRF-TOKEN';
-    private static $headerNames = array('x-xsrf-token', 'x-csrf-token');
-    /**
-     * Check if a value match with the value in the session
-     *
-     * @param string $value The value to check
-     * @param string $method The http method
-     * @return boolean
-     */
-    public static function checkToken($value, $method = 'POST')
-    {
-        if (false === in_array(strtoupper($method), self::$ignoreMethod)) {
-            if ($value != $_SESSION[self::$sessionTokenName]) {
-                return false;
-            }
-        }
-        return true;
-    }
-    /**
-     * Generate a new CSRF token an store it in session
-     *
-     * @return string
-     */
-    public static function generateToken()
-    {
-       $token = md5(uniqid(Di::getDefault()->get('config')->get('global', 'secret'), true));
-       $_SESSION[self::$sessionTokenName] = $token;
-       return $token;
-    }
-    /**
-     * If the token must regenerate
-     *
-     * @param string $method The http method
-     * @return boolean
-     */
-    public static function mustBeGenerate($method = 'POST')
-    {
-        if (false === isset($_SESSION[self::$sessionTokenName]) || false === in_array(strtoupper($method), self::$ignoreMethod)) {
-            return true;
-        }
-        return false;
-    }
-    /**
-     * Return the cookie name
-     *
-     * @return string
-     */
-    public static function getCookieName()
-    {
-        return self::$cookieName;
-    }
-    /**
-     * Return the list of possible header name for csrf
-     *
-     * @return array
-     */
-    public static function getHeaderNames()
-    {
-        return self::$headerNames;
-    }
-}

--- a/core/internal/Datatable.php
+++ b//dev/null
@@ -1,606 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Datatable
-{
-    /**
-     *
-     * @var string 
-     */
-    protected static $hook = '';
-    /**
-     * Parameters send to hook
-     *
-     * A var _ids is add to this parameters and content the list of id of the table
-     * 
-     * @var array
-     */
-    protected static $hookParams = array();
-    /**
-     *
-     * @var string 
-     */
-    protected static $objectId = '';
-    /**
-     *
-     * @var string 
-     */
-    protected static $objectName = '';
-    /**
-     *
-     * @var string 
-     */
-    protected $objectModelClass;
-    /**
-     *
-     * @var string 
-     */
-    protected static $dataprovider = '';
-    /**
-     *
-     * @var array 
-     */
-    public static $fieldList = array();
-    /**
-     *
-     * @var array 
-     */
-    protected $options = array();
-    /**
-     *
-     * @var array 
-     */
-    public static $columns = array();
-    /**
-     *
-     * @var array 
-     */
-    protected static $configuration = array();
-    /**
-     *
-     * @var array 
-     */
-    protected $specialFields = array();
-    /**
-     *
-     * @var array 
-     */
-    protected $params = array();
-    /**
-     *
-     * @var type 
-     */
-    protected $rawDatasFromDb;
-    /**
-     *
-     * @var array 
-     */
-    protected static $additionnalDatasource = null;
-    /**
-     *
-     * @var array 
-     */
-    private static $nonDatatableParams = array(
-        'cast',
-        'searchParam',
-        'source',
-        'searchvalues',
-        'DT_RowData',
-        'DT_RowId'
-    );
-    /**
-     * 
-     */
-    protected static $rowIdColumn = array();
-    /**
-     * Extra parameters for datatable
-     *
-     * @var array
-     */
-    protected static $extraParams = array();
-    /**
-     * 
-     * @param array $params
-     * @param string $objectModelClass
-     */
-    public function __construct($params, $objectModelClass = '')
-    {
-        $this->params = $params;
-        $this->objectModelClass = $objectModelClass;
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function getDatas()
-    {
-        $provider = static::$dataprovider;
-        $datasFromDb = $provider::loadDatas(
-            $this->params,
-            static::$columns,
-            $this->specialFields,
-            get_class($this),
-            $this->objectModelClass,
-            static::$additionnalDatasource,
-            isset(static::$aFieldNotAuthorized) ? static::$aFieldNotAuthorized : array()
-        );
-        static::addAdditionnalDatas($datasFromDb['datas']);
-        if (count(static::$rowIdColumn) > 0) {
-            foreach ($datasFromDb['datas'] as &$datas) {
-                $datas['DT_RowData'] = array(
-                    'id' => $datas[static::$rowIdColumn['id']],
-                    'name' => $datas[static::$rowIdColumn['name']]
-                );
-                $datas['DT_RowId'] = $datas[static::$rowIdColumn['id']];
-            }
-        }
-        static::processHooks($datasFromDb['datas']);
-        $this->formatDatas($datasFromDb['datas']);
-        $sendableDatas = $this->prepareDatasForSending($datasFromDb);
-        return $sendableDatas;
-    }
-    /**
-     * 
-     * @param array $datasToFormat
-     */
-    protected function formatDatas(&$datasToFormat)
-    {
-    }
-    /**
-     * 
-     * @param array $datasToSend
-     * @return array
-     */
-    protected function prepareDatasForSending($datasToSend)
-    {
-        $datasToSend['datas'] = $this->castResult($datasToSend['datas']);
-        $finalDatas = array(
-            "draw" => intval($this->params['draw']),
-            "recordsTotal" => count($datasToSend['datas']),
-            "recordsFiltered" => $datasToSend['nbOfTotalDatas'],
-            "data" => $datasToSend['datas']
-        );
-        return $finalDatas;
-    }
-    /**
-     * 
-     * @param array $resultSet
-     */
-    protected static function addAdditionnalDatas(&$resultSet)
-    {
-    }
-    /**
-     * 
-     * @return array
-     */
-    public static function getHeader()
-    {
-        $columnHeader = "";
-        $columnSearchIndex = array();
-        $nbFixedTr = count(static::$columns);
-        $hookArr = static::getHookArray();
-        foreach ($hookArr as $hook) {
-            $hookData = Hook::execute($hook, array());
-            foreach ($hookData as $data) {
-                $columnName = $data['columnName'];
-                static::$columns[] = array(
-                    'name' => $columnName,
-                    'title' => $columnName,
-                    'data' => $columnName,
-                    'orderable' => false,
-                    'searchable' => false
-                );
-            }
-        }
-        foreach (static::$columns as $column) {
-            static::$fieldList[] = $column['name'];
-            $columnHeader .= '{';
-            $searchable = false;
-            foreach ($column as $key => $value) {
-                if (!in_array($key, self::$nonDatatableParams)) {
-                    if (is_string($value)) {
-                        $columnHeader .= '"' . $key . '":"' . addslashes($value) . '",';
-                    } elseif (is_bool($value)) {
-                        if ($value === true) {
-                            $columnHeader .= '"' . $key . '":true,';
-                        } else {
-                            $columnHeader .= '"' . $key . '":false,';
-                        }
-                    } else {
-                        $columnHeader .= '"' . $key . '":' . (string)$value . ',';
-                    }
-                    if (($key === 'searchable')) {
-                        $searchable = $value;
-                    }
-                }
-            }
-            $columnHeader .= "},\n";
-            if ($searchable) {
-                $searchParam = array ('type' => 'text');
-                if (isset($column['searchParam'])) {
-                    $searchParam = array_merge($searchParam, $column['searchParam']);
-                }
-                if (isset($column['searchLabel'])) {
-                    $searchParam['searchLabel'] = $column['searchLabel'];
-                } else {
-                    $replaceChar = array(' ', '/', '\\');
-                    $firstReplace = str_replace($replaceChar, '_', $column['title']);
-                    $searchParam['searchLabel'] = strtolower(preg_replace('/(\_)+/', '_', $firstReplace));
-                }
-                $searchParam['title'] = $column['title'];
-                $searchParam['colIndex'] = array_search($column['name'], static::$fieldList);
-                if (!isset($searchParam['main'])) {
-                    $searchParam['main'] = false;
-                }
-                $columnSearchIndex[addslashes($column['data'])] = $searchParam;
-            }
-        }
-        return array(
-            'columnHeader' => $columnHeader,
-            'columnSearch' => $columnSearchIndex,
-            'nbFixedTr' => $nbFixedTr
-        );
-    }
-    /**
-     * 
-     * @return string
-     */
-    public static function getConfiguration()
-    {
-        $configurationParams = "";
-        foreach (static::$configuration as $configName => $configEntry) {
-            if ($configName == 'order') {
-                $configEntry = self::initOrder($configEntry);
-            }
-            if ($configName == 'searchCols') {
-                $configEntry = self::initSearch($configEntry);
-            }
-            $configEntry = (is_array($configEntry)) ? json_encode($configEntry) : $configEntry;
-            if (is_bool($configEntry)) {
-                if ($configEntry === true) {
-                    $configEntry = 'true';
-                } else {
-                    $configEntry = 'false';
-                }
-            }
-            $configurationParams .= '"' . $configName . '":' . $configEntry . ",\n";
-        }
-        return trim($configurationParams);
-    }
-    /**
-     * Get the list of extra parameters for datatable
-     *
-     * @return array
-     */
-    public static function getExtraParams()
-    {
-        return static::$extraParams;
-    }
-    /**
-     * 
-     * @param type $configEntry
-     * @return array
-     */
-    private static function initSearch($configEntry)
-    {
-        $rawSeachTable = array();
-        $listOfSearchField = array_keys(static::$configuration['searchCols']);
-        foreach (static::$columns as $column) {
-            if (in_array($column['name'], $listOfSearchField)) {
-                $rawSeachTable[] = array('sSearch' => $configEntry[$column['name']]);
-            } else {
-                $rawSeachTable[] = null;
-            }
-        }
-        return $rawSeachTable;
-    }
-    /**
-     * 
-     * @param array $configEntry
-     * @return string
-     */
-    private static function initOrder($configEntry)
-    {
-        $line = "[";
-        foreach ($configEntry as $order) {
-            $line .= "[" . array_search($order[0], static::$fieldList) . ", '". $order[1] ."'],";
-        }
-        return rtrim($line, ',') . ']';
-    }
-    /**
-     * 
-     * @param type $datas
-     * @return type
-     */
-    public static function castResult($datas)
-    {
-        try {
-            $columnsToCast = array();
-            foreach (static::$columns as $column) {
-                if (isset($column['cast'])) {
-                    $columnsToCast[$column['name']] = $column['cast'];
-                    $columnsToCast[$column['name']]['caster'] = 'add'.ucwords($column['cast']['type']);
-                }
-            }
-            foreach ($datas as &$singleData) {
-                $originalData = $singleData;
-                foreach ($columnsToCast as $colName => $colCast) {
-                    if (preg_match('/[A-z]\./', $colName)) {
-                        $a = explode('.', $colName);
-                        array_shift($a);
-                        $a = implode('.', $a);
-                    } else {
-                        $a = $colName;
-                    }
-                    $extra = array();
-                    if (isset($colCast['extra'])) {
-                        $extra = $colCast['extra'];
-                    }
-                    $singleData[$a] =  self::$colCast['caster']($a, $originalData, $colCast['parameters'], $extra);
-                }
-            }
-            return $datas;
-        } catch (\Exception $e) {
-            var_dump($e);
-        }
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $values
-     * @param type $cast
-     * @return type
-     */
-    public static function addUrl($field, $values, $cast)
-    {
-        if (isset($values['DT_RowData'])) {
-            unset($values['DT_RowData']);
-            unset($values['DT_RowId']);
-        }
-        $castedElement = \array_map(
-            function ($n) {
-                return "::$n::";
-            },
-            array_keys($values)
-        );
-        $finalRoute = self::parseUrl($cast, $castedElement, $values);
-        $linkName =  str_replace($castedElement, $values, $cast['linkName']);
-        $class = '';
-        if (isset($cast['styleClass'])) {
-            $class .=$cast['styleClass'];
-        }
-        return '<a class="' . $class . '" href="' . $finalRoute . '">' . $linkName . '</a>';
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $values
-     * @param type $cast
-     * @return type
-     */
-    public static function addCheckbox($field, $values, $cast)
-    {
-        if (isset($values['DT_RowData'])) {
-            unset($values['DT_RowData']);
-            unset($values['DT_RowId']);
-        }
-        $castedElement = \array_map(
-            function ($n) {
-                return "::$n::";
-            },
-            array_keys($values)
-        );
-        $datasource = static::$datasource;
-        $uniqueField = $datasource::getUniqueLabelField();
-        $object = ucwords(str_replace('_', '', $field));
-        $className = 'all' . static::$objectName . 'Box';
-        if (isset($cast['styleClass'])) {
-            $className = $cast['styleClass'];
-        }
-        $input = '<input class="' . $className . '" '
-            . 'id="'. static::$objectName .'::'. $field .'::" '
-            . 'name="'. static::$objectName .'[]" '
-            . 'type="checkbox" '
-            . 'value="::'. $field .'::" '
-            . 'data-name="' . htmlentities($values[$uniqueField]) . '"';
-        if (isset($cast['data'])) {
-            $input .= self::setData($cast['data'], $castedElement, $values);
-        }
-        $input .= '>';
-        return str_replace($castedElement, $values, $input);
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $values
-     * @param type $cast
-     * @return type
-     */
-    public static function addSelect($field, $values, $cast, $extra = array())
-    {
-        $myElement = "";
-        static $previousValue;
-        if (isset($cast['selecttype']) && ($cast['selecttype'] != 'none')) {
-            $subCaster = 'add'.ucwords($cast['selecttype']);
-            $myElement = static::$subCaster($field, $values, $cast['parameters'][$values[$field]]['parameters']);
-        } elseif (isset($values[$field])) {
-            $myElement = $cast[$values[$field]];
-            if (isset($extra['groupable']) && $extra['groupable']) {
-                if ($myElement === $previousValue) {
-                    $myElement = "";
-                } else {
-                    $previousValue = $myElement;
-                }
-            }
-        }
-        return $myElement;
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $values
-     * @param type $cast
-     * @return type
-     */
-    public static function addDate($field, $values, $cast)
-    {
-        return date($cast['date'], $values[$field]);
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $values
-     * @param type $cast
-     * @return type
-     */
-    public static function addTemplate($field, $values, $cast)
-    {
-        if (isset($values['DT_RowData'])) {
-            unset($values['DT_RowData']);
-            unset($values['DT_RowId']);
-        }
-        $castedElement = \array_map(
-            function ($n) {
-                return "::$n::";
-            },
-            array_keys($values)
-        );
-        $returnString = $cast['tmpl'];
-        if (isset($cast['route'])) {
-            $finalRoute = self::parseUrl($cast, $castedElement, $values);
-            $returnString = str_replace("::link::", $finalRoute, $returnString);
-        }
-        return str_replace($castedElement, $values, $returnString);
-    }
-    /**
-     * 
-     * @param type $resultSet
-     */
-    public static function processHooks(&$resultSet)
-    {
-       	$params = static::$hookParams;
-        $params['_ids'] = array();
-        foreach ($resultSet as $set) {
-            if (isset($set[static::$objectId])) {
-                $params['_ids'][] = $set[static::$objectId];
-            }
-        }
-        $hookArr = static::getHookArray();
-        foreach ($hookArr as $hook) {
-            $hookData = Hook::execute($hook, $params);
-            foreach ($hookData as $data) {
-                $columnName = $data['columnName'];
-                foreach ($data['values'] as $k => $value) {
-                    foreach ($resultSet as $key => $set) {
-                        if ($set[static::$objectId] == $k) {
-                            $resultSet[$key][$columnName] = $value;
-                        }
-                    }
-                }
-            }
-        }
-    }
-    /**
-     * Return the hook array
-     *
-     * @return array
-     */
-    protected static function getHookArray()
-    {
-        $hookArr = array();
-        /* If hook is string, we put it in an array */
-        if (!isset(static::$hook) || static::$hook == '') {
-            return $hookArr;
-        }
-        if (!is_array(static::$hook)) {
-            $hookArr = array(static::$hook);
-        } else {
-            $hookArr = static::$hook;
-        }
-        return $hookArr;
-    }
-    /**
-     * 
-     * @param type $datas
-     * @param type $castedElement
-     * @param type $values
-     * @return string
-     */
-    public static function setData($datas, $castedElement, $values)
-    {
-        $dataStr = '';
-        foreach ($datas as $key => $info) {
-            if (is_array($info)) {
-                if ($info['type'] == 'url') {
-                    $info = self::parseUrl($info, $castedElement, $values);
-                }
-            }
-            $dataStr .= ' data-' . $key . '="' . $info . '"';
-        }
-        return $dataStr;
-    }
-    /**
-     * Parse a array for generate the url
-     *
-     * @param array $params The url parameters
-     * @param array $castedElement The element converted
-     * @param array $values The values of row
-     * @return string
-     */
-    protected static function parseUrl($params, $castedElement, $values)
-    {
-        if (isset($values['DT_RowData'])) {
-            unset($values['DT_RowData']);
-            unset($values['DT_RowId']);
-        }
-        $routeParams = array();
-        if (isset($params['routeParams']) && is_array($params['routeParams'])) {
-            $routeParams = str_replace($castedElement, $values, $params['routeParams']);
-        }
-        $finalRoute = str_replace(
-            "//",
-            "/",
-            Di::getDefault()
-                ->get('router')
-                ->getPathFor($params['route'], $routeParams)
-        );
-        return $finalRoute;
-    }
-}

--- a/core/internal/Datatable/Dataprovider/CentreonDb.php
+++ b//dev/null
@@ -1,123 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Datatable\Dataprovider;
-/**
- * Description of CentreonDb
- *
- * @author lionel
- */
-class CentreonDb implements DataProviderInterface
-{
-    public static function loadDatas(
-        $params,
-        array $columns,
-        array $specialFields,
-        $datatableClass,
-        $modelClass = '',
-        $additionnalClass = null,
-        $aFieldNotAuthorized = array()
-    ) {
-        $fields = "";
-        $otherFields = "";
-        $result = array();
-        $specialFieldsKeys = array_keys($specialFields);
-        foreach ($columns as $column) {
-            if (!in_array($column['name'], $aFieldNotAuthorized)) {
-                if (!in_array($column['name'], $specialFieldsKeys)) {
-                    if (isset($column['source'])) {
-                        $otherFields .= $column['name'] . ',';
-                    } else {
-                        $fields .= $column['name'] . ',';
-                    }
-                } elseif (in_array($column['name'], $specialFieldsKeys) && $specialFields[$column['name']]['sameSource']) {
-                    $fields .= $specialFields[$column['name']]['source'] . ',';
-                }
-            }
-        }
-        $fields = rtrim($fields, ',');
-        $otherFields = rtrim($otherFields, ',');       
-        $conditions = array();
-        foreach ($params['columns'] as $columnSearch) {
-            if ($columnSearch['searchable'] === "true" && (!empty($columnSearch['search']['value']) || $columnSearch['search']['value'] == "0")) {
-                $conditions[$columnSearch['data']] = $columnSearch['search']['value'];
-            }
-        }
-      if (isset($additionnalClass)) {
-            $result = $additionnalClass::getMergedParametersBySearch(
-                explode(',', $fields),
-                explode(',', $otherFields),
-                $params['length'],
-                $params['start'],
-                $columns[$params['order'][0]['column']]['name'],
-                $params['order'][0]['dir'],
-                $conditions,
-                "AND"
-            );
-            $result2 = $additionnalClass::getMergedParametersBySearch(
-                explode(',', $fields),
-                array(),
-                -1,
-                0,
-                null,
-                'ASC',
-                $conditions,
-                "AND"
-            );
-            $a['nbOfTotalDatas'] = count($result2);
-        } else { 
-            $result = $modelClass::getListBySearch(
-                $fields,
-                $params['length'],
-                $params['start'],
-                $columns[$params['order'][0]['column']]['name'],
-                $params['order'][0]['dir'],
-                $conditions,
-                "AND"
-            );
-            $result2 = $modelClass::getListBySearch(
-                'count(*)',
-                -1,
-                0,
-                null,
-                'ASC',
-                $conditions,
-                "AND"
-            );
-            $a['nbOfTotalDatas'] = $result2[0]['count(*)'];
-        }
-        $a['datas'] = $result;
-        return $a;
-    }
-}

--- a/core/internal/Datatable/Dataprovider/CentreonStorageDb.php
+++ b//dev/null
@@ -1,159 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Datatable\Dataprovider;
-/**
- * Description of CentreonStorageDb
- *
- * @author lionel
- */
-class CentreonStorageDb implements DataProviderInterface
-{
-    public static function loadDatas(
-        $params,
-        array $columns,
-        array $specialFields,
-        $datatableClass,
-        $modelClass = '',
-        $additionnalClass = null
-    ) {
-        $fields = "";
-        $otherFields = "";
-        $otherTables = "";
-        $conditions = array();
-        $conditionsForTable = array();
-        $specialFieldsKeys = array_keys($specialFields);
-        foreach ($columns as $column) {
-            if (isset($column['dbName'])) {
-                $column['name'] = $column['dbName'];
-            }
-            if (!in_array($column['name'], $specialFieldsKeys)) {
-                if (isset($column['source'])) {
-                    if (is_array($column['source'])) {
-                        $otherTables .= $column['source']['table'] . ',';
-                        $conditionsForTable[$column['source']['condition']['first']] =
-                            $column['source']['condition']['second'];
-                        $fields .= $column['name'] . ',';
-                    }
-                    $otherFields .= $column['name'] . ',';
-                } else {
-                    $fields .= $column['name'] . ',';
-                }
-            } elseif (in_array($column['name'], $specialFieldsKeys) && $specialFields[$column['name']]['sameSource']) {
-                $fields .= $specialFields[$column['name']]['source'] . ',';
-            }
-        }
-        $fields = rtrim($fields, ',');
-        $otherFields = rtrim($otherFields, ',');
-        $otherTables = rtrim($otherTables, ',');
-        $a = array();
-        $fieldList = array();
-        foreach ($datatableClass::$columns as $column) {
-            $fieldList[] = $column['name'];
-        }
-        foreach ($params as $key => $value) {
-            if (substr($key, 0, 7) == 'sSearch') {
-                if (!empty($value)) {
-                    if ($key === 'host_enabled') {
-                        $conditions['h.enabled'] = $value;
-                    } elseif ($key === 'service_enabled') {
-                        $conditions['s.enabled'] = $value;
-                    } else {
-                        $b = explode('_', $key);
-                        if (is_string($value)) {
-                            $possibleValues = array();
-                            preg_match_all('/[a-zA-Z\s]+|"[a-zA-Z\s]+"/i', $value, $possibleValues);
-                            if (count($possibleValues) > 0) {
-                                $value = array();
-                                foreach ($possibleValues[0] as $pVal) {
-                                    $value[] = str_replace('"', '', trim($pVal));
-                                }
-                            }
-                        }
-                        $conditions[$fieldList[$b[1]]] = $value;
-                    }
-                }
-            }
-        }
-        if (isset($additionnalClass)) {
-            $result = $additionnalClass::getMergedParameters(
-                explode(',', $fields),
-                explode(',', $otherFields),
-                $params['iDisplayLength'],
-                $params['iDisplayStart'],
-                $columns[$params['iSortCol_0']]['name'],
-                $params['sSortDir_0'],
-                $conditions,
-                "AND"
-            );
-            $result2 = $additionnalClass::getMergedParameters(
-                explode(',', $fields),
-                array(),
-                -1,
-                0,
-                null,
-                'ASC',
-                $conditions,
-                "AND"
-            );
-            $a['nbOfTotalDatas'] = count($result2);
-        } else {
-            $result = $modelClass::getList(
-                $fields,
-                explode(',', $otherTables),
-                $params['iDisplayLength'],
-                $params['iDisplayStart'],
-                $columns[$params['iSortCol_0']]['name'],
-                $params['sSortDir_0'],
-                $conditions,
-                "AND",
-                $conditionsForTable
-            );
-            $result2 = $modelClass::getList(
-                'count(*)',
-                explode(',', $otherTables),
-                -1,
-                0,
-                null,
-                'ASC',
-                $conditions,
-                "AND",
-                $conditionsForTable
-            );
-            $a['nbOfTotalDatas'] = $result2[0]['count(*)'];
-        }
-        $a['datas'] = $result;
-        return $a;
-    }
-}

--- a/core/internal/Datatable/Dataprovider/DataProviderInterface.php
+++ b//dev/null
@@ -1,43 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Datatable\Dataprovider;
-/**
- *
- * @author lionel
- */
-interface DataProviderInterface
-{
-    public static function loadDatas($params, array $columns, array $specialFields, $datatableClass, $modelClass = '');
-}

--- a/core/internal/Datatable/ModuleDatatable.php
+++ b//dev/null
@@ -1,291 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Datatable;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Di;
-use Centreon\Internal\Datatable;
-/**
- * Description of ModuleDatatable
- *
- * @author lionel
- */
-class ModuleDatatable extends Datatable
-{
-    /**
-     *
-     * @var string 
-     */
-    protected static $dataprovider = '\Centreon\Internal\Datatable\Dataprovider\CentreonDb';
-    /**
-     *
-     * @var string 
-     */
-    protected static $datasource = '\Centreon\Models\Module';
-    /**
-     *
-     * @var type 
-     */
-    protected static $rowIdColumn = array('id' => 'id', 'name' => 'name');
-    /**
-     *
-     * @var array 
-     */
-    protected static $configuration = array(
-        'autowidth' => true,
-        'order' => array(
-            array('name', 'asc')
-        ),
-        'stateSave' => false,
-        'paging' => true,
-    );
-    /**
-     *
-     * @var array 
-     */
-    public static $columns = array(
-        array (
-            'title' => "Id",
-            'name' => 'id',
-            'data' => 'id',
-            'orderable' => true,
-            'searchable' => false,
-            'type' => 'string',
-            'visible' => false,
-        ),
-        array (
-            'title' => 'Name',
-            'name' => 'name',
-            'data' => 'name',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-            'cast' => array(
-                'type' => 'url',
-                'parameters' => array(
-                    'route' => '/centreon-administration/extensions/module/[i:id]',
-                    'routeParams' => array(
-                        'id' => '::id::'
-                    ),
-                    'linkName' => '::name::'
-                )
-            )
-        ),
-        array (
-            'title' => 'Description',
-            'name' => 'description',
-            'data' => 'description',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-        ),
-        array (
-            'title' => 'Version',
-            'name' => 'version',
-            'data' => 'version',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-        ),
-        array (
-            'title' => 'Author',
-            'name' => 'author',
-            'data' => 'author',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-        ),
-        array (
-            'title' => 'Install Status',
-            'name' => 'isinstalled',
-            'data' => 'isinstalled',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-            'className' => 'cell_center',
-            'cast' => array(
-                'type' => 'select',
-                'parameters' => array(
-                    'selecttype' => 'template',
-                    'parameters' => array(
-                        '0' => array(
-                            'parameters' => array(
-                                'tmpl' => '<span class="label label-default">Not installed</span>'
-                            )
-                        ),
-                        '1' => array(
-                            'parameters' => array(
-                                'tmpl' => '<span class="label label-primary">Installed</span>'
-                            )
-                        ),
-                        '2' => array(
-                            'parameters' => array(
-                                'tmpl' => '<span class="label label-primary">Core</span>'
-                            )
-                        ),
-                    )
-                )
-            )
-        ),
-        array (
-            'title' => 'Status',
-            'name' => 'isactivated',
-            'data' => 'isactivated',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-            'className' => 'cell_center',
-            'cast' => array(
-                'type' => 'checkbox',
-                'parameters' => array(
-                    'styleClass' => 'enabled',
-                    'data' => array(
-                        'urlEnabled' => array(
-                            'type' => 'url',
-                            'route' => '/centreon-administration/extensions/module/[i:id]/enable',
-                            'routeParams' => array(
-                                'id' => '::id::'
-                            )
-                        ),
-                        'urlDisabled' => array(
-                            'type' => 'url',
-                            'route' => '/centreon-administration/extensions/module/[i:id]/disable',
-                            'routeParams' => array(
-                                'id' => '::id::'
-                            )
-                        )
-                    )
-                )
-            )
-        ),
-        array(
-            'title' => 'Action',
-            'name' => 'action',
-            'data' => 'action',
-            'orderable' => true,
-            'searchable' => true,
-            'type' => 'string',
-            'visible' => true,
-            'className' => 'cell_center',
-            'source' => 'other',
-            'cast' => array(
-                'type' => 'select',
-                'parameters' => array(
-                    'selecttype' => 'template',
-                    'parameters' => array(
-                        '0' => array(
-                            'parameters' => array(
-                                'tmpl' => '<a class="btn btn-sm btn-primary" href="::link::">Install</a>',
-                                'route' => '/centreon-administration/extensions/module/[*:shortname]/install',
-                                'routeParams' => array(
-                                    'shortname' => '::name::'
-                                )
-                            )
-                        ),
-                        '1' => array(
-                            'parameters' => array(
-                                'tmpl' => '<a class="btn btn-sm btn-danger" href="::link::">Uninstall</a>',
-                                'route' => '/centreon-administration/extensions/module/[i:id]/uninstall',
-                                'routeParams' => array(
-                                    'id' => '::id::'
-                                )
-                            )
-                        ),
-                        '2' => array(
-                            'parameters' => array(
-                                'tmpl' => ''
-                            )
-                        ),
-                    )
-                )
-            )
-        )
-    );
-    /**
-     * 
-     * @param array $params
-     */
-    public function __construct($params, $objectModelClass = '')
-    {
-        parent::__construct($params, $objectModelClass);
-    }
-    /**
-     * 
-     * @param type $resultSet
-     */
-    protected static function addAdditionnalDatas(&$resultSet)
-    {
-        self::getFilesystemModule($resultSet);
-    }
-    protected function formatDatas(&$resultSet) 
-    {
-        foreach ($resultSet as &$result) {
-            $result['action'] = $result['isinstalled'];
-        }
-    }
-    /**
-     * 
-     * @param type $resultSet
-     */
-    private static function getFilesystemModule(& $resultSet)
-    {
-        $moduleNameList = Informations::getModuleList();
-        $path = rtrim(Di::getDefault()->get('config')->get('global', 'centreon_path'), '/');
-        $rawModuleList = glob($path."/modules/*Module/");
-        foreach ($rawModuleList as $module) {
-            if (file_exists(realpath($module . 'install/config.json'))) {
-                $b = json_decode(file_get_contents($module . 'install/config.json'), true);
-                if (!in_array($b['shortname'], $moduleNameList)) {
-                    $resultSet[] = array(
-                        'id' => 0,
-                        'name' => $b['shortname'],
-                        'description' => $b['name'],
-                        'version' => $b['version'],
-                        'author' => implode(", ", $b['author']),
-                        'isactivated' => 0,
-                        'isinstalled' => 0,
-                        'action' => 0,
-                        'alias' => $b['name'],
-                    );
-                }
-            }
-        }
-    }
-}

--- a/core/internal/Db.php
+++ b//dev/null
@@ -1,156 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Class for manage database connection
- *
- * @see http://www.php.net/manual/en/class.pdo.php
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Db extends \PDO
-{
-    /**
-     * Constructor
-     *
-     * @see http://www.php.net/manual/en/pdo.construct.php
-     * @param $dsn string The datasource name
-     * @param $username string The database username
-     * @param $password string The database password
-     * @param $driver_options array The driver options
-     */
-    public function __construct($dsn, $username = '', $password = '', $driver_options = array())
-    {
-        parent::__construct($dsn, $username, $password, $driver_options);
-        $this->setAttribute(\PDO::ATTR_STATEMENT_CLASS, array('\Centreon\Internal\Db\Statement', array($this)));
-        $this->setAttribute(\PDO::ATTR_ERRMODE, \PDO::ERRMODE_EXCEPTION);
-    }
-    /**
-     * Execute a SQL query
-     *
-     * @see http://www.php.net/manual/en/pdo.query.php
-     * @param $query string The SQL query
-     * @return \Centreon\Db\Statement|bool Return false on failure
-     */
-    public function query($query, $fetchType = \PDO::FETCH_BOTH, $extraArgs1 = null, $extraArgs2 = null)
-    {
-        if ($fetchType == \PDO::FETCH_COLUMN || $fetchType == \PDO::FETCH_INTO) {
-            $stmt = parent::query($query, $fetchType, $extraArgs1);
-        } elseif ($fetchType == \PDO::FETCH_CLASS) {
-            $stmt = parent::query($query, $fetchType, $extraArgs1, $extraArgs2);
-        } else {
-            $stmt = parent::query($query);
-        }
-        return $stmt;
-    }
-    /**
-     * Execute a SQL query and return the number of rows affected
-     *
-     * @see http://www.php.net/manual/en/pdo.exec.php
-     * @param $query string The SQL query
-     * @return int
-     */
-    public function exec($query)
-    {
-        $nbRows = parent::exec($query);
-        return $nbRows;
-    }
-    /**
-     * Builds a limit clause
-     *
-     * @param string $sql
-     * @param int $count
-     * @param int $offset
-     * @return string
-     */
-    public function limit($sql, $count, $offset)
-    {
-        return $sql . " LIMIT {$count} OFFSET {$offset}";
-    }
-    /**
-     * Returns last inserted id
-     *
-     * @param string $table
-     * @param string $primaryKey
-     * @return int
-     */
-    public function lastInsertId($table, $primaryKey)
-    {
-        $sql = "SELECT MAX({$primaryKey}) AS last_id FROM {$table}";
-        $stmt = $this->prepare($sql);
-        $stmt->execute();
-        $row = $stmt->fetch();
-        return $row['last_id'];
-    }
-    /**
-     * Parse a DSN and return a array
-     *
-     * @param string $dsn The dsn
-     * @param string $user The username
-     * @param string $pass The password
-     * @return array
-     */
-    public static function parseDsn($dsn, $user = '', $pass = '')
-    {
-        $convertKeys = array(
-            'host' => 'db_host',
-            'port' => 'db_port',
-            'dbname' => 'db_name'
-        );
-        $defaultPorts = array(
-            'mysql' => 3306,
-            'pgsql' => 5432
-        );
-        $values = array(
-            'db_user' => $user,
-            'db_password' => $pass
-        );
-        list($type, $uri) = explode(':', $dsn, 2);
-        if (is_null($uri)) {
-            throw new Exception("Bad DSN format");
-        }
-        $values['db_type'] = $type;
-        $information = explode(';', $uri);
-        foreach ($information as $info) {
-            list($infoType, $infoValue) = explode('=', $info, 2);
-            $values[$convertKeys[$infoType]] = $infoValue;
-        }
-        if (isset($values['db_host']) && false === isset($values['db_port'])) {
-            $values['db_port'] = $defaultPorts[$type];
-        }
-        return $values;
-    }
-}

--- a/core/internal/Db/Installer.php
+++ b//dev/null
@@ -1,206 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Db;
-use Centreon\Internal\Di;
-use Centreon\Models\Module;
-use Centreon\Internal\Module\Informations;
-class Installer
-{
-    /**
-     * 
-     * @param type $operation
-     * @param type $targetDbName
-     */
-    public static function updateDb($operation = 'upgrade', $targetDbName = 'centreon')
-    {
-        /*
-        ini_set('memory_limit', '-1');
-        $di = \Centreon\Internal\Di::getDefault();
-        $config = $di->get('config');
-        $targetDb = 'db_' . $targetDbName;
-        $db = $di->get($targetDb);
-        $configParams = array(
-            'propel.project' => 'centreon',
-            'propel.database' => 'mysql',
-            'propel.database.url' => $config->get($targetDb, 'dsn'),
-            'propel.database.user' => $config->get($targetDb, 'username'),
-            'propel.database.password' => $config->get($targetDb, 'password')
-        );
-        $platform = new \Centreon\Custom\Propel\CentreonMysqlPlatform($db);
-        $propelDb = new \MysqlSchemaParser($db);
-        $propelDb->setGeneratorConfig(new \GeneratorConfig($configParams));
-        $propelDb->setPlatform($platform);
-        $currentDbAppData = new \AppData($platform);
-        $currentDbAppData->setGeneratorConfig(new \GeneratorConfig($configParams));
-        $currentDb = $currentDbAppData->addDatabase(array('name' => $targetDbName));
-        $propelDb->parse($currentDb);
-        $updatedAppData = new \AppData($platform);
-        self::getDbFromXml($updatedAppData, $operation, $targetDbName);
-        $diff = \PropelDatabaseComparator::computeDiff(
-            $currentDb,
-            $updatedAppData->getDatabase($targetDbName),
-            false
-        );
-        $strDiff = $platform->getModifyDatabaseDDL($diff);
-        \PropelSQLParser::executeString($strDiff, $db);*/
-    }
-    /**
-     * 
-     * @param \AppData $myAppData
-     * @param string $targetDbName
-     */
-    public static function getDbFromXml(& $myAppData, $operation, $targetDbName)
-    {
-        $di = Di::getDefault();
-        $targetDb = 'db_' . $targetDbName;
-        $db = $di->get($targetDb);
-        $xmlDbFiles = self::getAllXmlFiles($operation, $targetDbName);
-        $appDataObject = new \XmlToAppData(new \Centreon\Custom\Propel\CentreonMysqlPlatform($db), null, 'utf-8');
-        foreach ($xmlDbFiles as $dbFile) {
-            $myAppData->joinAppDatas(array($appDataObject->parseFile($dbFile)));
-            unset($appDataObject);
-            $appDataObject = new \XmlToAppData(new \Centreon\Custom\Propel\CentreonMysqlPlatform($db), null, 'utf-8');
-        }
-        unset($appDataObject);
-    }
-    /**
-     * 
-     * @param string $operationType
-     * @param string $targetDbName
-     * @return array
-     */
-    private static function getAllXmlFiles($operationType = 'update', $targetDbName = 'centreon')
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $centreonPath = $config->get('global', 'centreon_path');
-        $xmlDbFiles = glob(realpath(rtrim($centreonPath, '/') . '/install/db/' . $targetDbName). '/*.xml');
-        if ($operationType == 'update') {
-            $registeredModules = Module::getList('name');
-            $registeredModules(
-                array_merge(
-                    $registeredModules,
-                    Informations::getCoreModuleList()
-                )
-            );
-            foreach ($registeredModules as $module) {
-                $module['name'] = str_replace(' ', '', ucwords(str_replace('-', ' ', $module['name']))) . 'Module';
-                $xmlDbFiles = array_merge(
-                    $xmlDbFiles,
-                    glob(
-                        realpath(rtrim($centreonPath, '/') . '/modules') . '/'
-                        . $module['name']
-                        . '/install/db/'
-                        . $targetDbName
-                        . '/*.xml'
-                    )
-                );
-            }
-        } else {
-            $xmlDbFiles = array_merge(
-                $xmlDbFiles,
-                glob(
-                    realpath(rtrim($centreonPath, '/') . '/modules') . '/*Module/install/db/' . $targetDbName . '/*.xml'
-                )
-            );
-        }
-        return $xmlDbFiles;
-    }
-    /**
-     * 
-     * @param array $sqlStatements
-     * @return array
-     */
-    public static function getTablesToBeRemoved($sqlStatements)
-    {
-        $tablesToBeRemoved = array();
-        foreach ($sqlStatements as $statement) {
-            if (strpos($statement, "DROP TABLE IF EXISTS") !== false) {
-                $tablesToBeRemoved[] = trim(substr($statement, strlen("DROP TABLE IF EXISTS")));
-            }
-        }
-        return $tablesToBeRemoved;
-    }
-    /**
-     * 
-     * @param type $targetDbName
-     */
-    public static function buildTargetDbSchema($targetDbName = 'centreon')
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $centreonPath = $config->get('global', 'centreon_path');
-        $targetFolder = $centreonPath . '/tmp/db/target/' . $targetDbName . '/';
-        $fileList = array();
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonAdministrationModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonBamModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonConfigurationModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonCustomviewModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonMainModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonRealtimeModule/install/db/' . $targetDbName));
-        $fileList = array_merge($fileList, self::getDbFiles($centreonPath . '/modules/CentreonSecurityModule/install/db/' . $targetDbName));
-        if (!file_exists($targetFolder)) {
-            mkdir($targetFolder, 0700, true);
-        }
-        $nbOfFiles = count($fileList);
-        for ($i=0; $i<$nbOfFiles; $i++) {
-            $targetFile = $targetFolder . basename($fileList[$i]);
-            copy($fileList[$i], $targetFile);
-        }
-    }
-    /**
-     * 
-     * @param string $dirname
-     * @return array
-     */
-    private static function getDbFiles($dirname)
-    {
-        $finalXmlFileList = array();
-        $path = realpath($dirname);
-        if (file_exists($path)) {
-            $listOfFiles = glob($path . '/*');
-            while (count($listOfFiles) > 0) {
-                $currentFile = array_shift($listOfFiles);
-                if (is_dir($currentFile)) {
-                    $listOfFiles = array_merge($listOfFiles, glob($currentFile . '/*'));
-                } elseif (pathinfo($currentFile, PATHINFO_EXTENSION) == 'xml') {
-                    $finalXmlFileList[] = $currentFile;
-                }
-            }
-        }
-        return $finalXmlFileList;
-    }
-}

--- a/core/internal/Db/Statement.php
+++ b//dev/null
@@ -1,87 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Db;
-/**
- * Class for manage database connection
- *
- * @see http://www.php.net/manual/en/class.pdostatement.php PDO Statement
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Statement extends \PDOStatement
-{
-    /**
-     * @var \PDO The database connection
-     */
-    protected $connection;
-    /**
-     * Consturctor
-     *
-     * @param $connection \PDO The database connection
-     */
-    protected function __construct(\PDO $connection)
-    {
-        $this->connection = $connection;
-    }
-    /**
-     * Execute a prepare statement
-     *
-     * @see http://www.php.net/manual/en/pdostatement.execute.php PDO Statement
-     * @param $parameters array The input parameters
-     * @return bool
-     */
-    public function execute($parameters = array())
-    {
-        if (count($parameters) === 0) {
-            $return = parent::execute();
-        } else {
-            $return = parent::execute($parameters);
-        }
-        return $return;
-    }
-    /**
-     * Fetch a line from SQL cursor
-     * 
-     * Alias to the method fetch
-     *
-     * @deprecated
-     * @return mixed
-     */
-    public function fetchRow()
-    {
-        return $this->fetch();
-    }
-}

--- a/core/internal/Di.php
+++ b//dev/null
@@ -1,156 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Class for dependency injector
- *
- * $di = new \Centreon\Internal\Di();
- * $di->set('test', function () {
- *   return array("test" => "test");
- * });
- * $di->set('test2', 'MyClass');
- * $di->setShared('test3', $variable);
- * 
- * $test = $di->get('test');
- *
- * @authors Maximilien Bersoult <mbersoult@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Di
-{
-    private static $instance = null;
-    private $shared;
-    private $services;
-    /**
-     * Constructor
-     */
-    public function __construct()
-    {
-        if (is_null(self::$instance)) {
-            self::$instance = $this;
-        }
-    }
-    /**
-     * Add a service into DI
-     *
-     * @param $name string The name of the service
-     * @param $definition string|\Closure The service
-     *        string: The class name
-     *        \Closure: A function which return a variable
-     * @param $shared bool If the service is shared, the definition can be mixed
-     */
-    public function set($name, $definition, $shared = false)
-    {
-        if ($shared) {
-            $this->setShared($name, $definition);
-        }
-        $this->services[$name] = $definition;
-    }
-    /**
-     * Add a shared service
-     *
-     * @param $name string The name of the service
-     * @param $definition mixed A value for the service
-     */
-    public function setShared($name, $definition)
-    {
-        $this->shared[$name] = $definition;
-    }
-    /**
-     * Test if a service is registred
-     *
-     * @param $name string The name of the service
-     * @return bool
-     */
-    public function has($name)
-    {
-        if (isset($this->shared[$name])) {
-            return true;
-        }
-        if (isset($this->services[$name])) {
-            return true;
-        }
-        return false;
-    }
-    /**
-     * Get a value of a service
-     *
-     * @param $name string The name of the service
-     * @return mixed
-     * @throws \Centreon\Exception If the service is not defined
-     */
-    public function get($name)
-    {
-        if (false === $this->has($name)) {
-            throw new Exception("No service defined in DI with name: '" . $name . "'");
-        }
-        if (false === isset($this->shared[$name])) {
-            if (is_string($this->services[$name])) {
-                $this->shared[$name] = new $this->services[$name]();
-            } elseif (is_a($this->services[$name], '\Closure')) {
-                $this->shared[$name] = $this->services[$name]();
-            } else {
-                throw new Exception("Bad type of service");
-            }
-        }
-        return $this->shared[$name];
-    }
-    /**
-     * Set the default instance of dependency injector
-     *
-     * @param $di \Centreon\Internal\Di
-     */
-    public static function setDefault(Di $di)
-    {
-        self::$instance = $di;
-    }
-    /**
-     * Return the default dependency injector instance
-     *
-     * @return \Centreon\Internal\Di
-     */
-    public static function getDefault()
-    {
-        return self::$instance;
-    }
-    /**
-     * Reset the instance of dependency injector
-     */
-    public static function reset()
-    {
-        self::$instance = null;
-    }
-}

--- a/core/internal/Event.php
+++ b//dev/null
@@ -1,89 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Utils\Filesystem\File;
-use Centreon\Internal\Utils\String\CamelCaseTransformation;
-/**
- * Description of Event
- *
- * @author lionel
- */
-class Event
-{
-    /**
-     * Init event listeners of modules
-     */
-    public static function initEventListeners()
-    {
-        $moduleList = Informations::getModuleList();
-        foreach ($moduleList as $module) {
-            $listenersPath = Informations::getModulePath($module) . '/listeners/';
-            if (file_exists($listenersPath)) {
-                $ModuleListenersList = glob($listenersPath . '*');
-                foreach ($ModuleListenersList as $moduleListenersPath) {   
-                    $mTarget = substr($moduleListenersPath, strlen($listenersPath));
-                    $mSource = CamelCaseTransformation::customToCamelCase($module, '-');
-                    self::attachModuleEventListeners($mSource, $mTarget, $moduleListenersPath);
-                }
-            }
-        }
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @param type $moduleListenersPath
-     */
-    private static function attachModuleEventListeners($moduleSource, $moduleTarget, $moduleListenersPath)
-    {
-        $emitter = Di::getDefault()->get('events');
-        $myListeners = File::getFiles($moduleListenersPath, 'php');
-        foreach ($myListeners as $myListener) {
-            $listener = (basename($myListener, '.php'));
-            $eventName = CamelCaseTransformation::camelCaseToCustom($moduleTarget, '-')
-                . '.'
-                . CamelCaseTransformation::camelCaseToCustom($listener, '.');
-            $emitter->on(
-                strtolower($eventName),
-                function ($params) use ($listener, $moduleSource, $moduleTarget) {
-                    call_user_func(
-                        array($moduleSource . "\\Listeners\\".$moduleTarget."\\".$listener, "execute"),
-                        $params
-                    );
-                }
-            );
-        }
-    }
-}

--- a/core/internal/Exception.php
+++ b//dev/null
@@ -1,43 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Exception
- *
- * @todo extend this class so that it can handle logging methods
- */
-class Exception extends \Exception
-{
-}

--- a/core/internal/Exception/Authentication/BadCredentialException.php
+++ b//dev/null
@@ -1,48 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Authentication;
-use Centreon\Internal\Exception;
-/**
- * Description of BadCredentialException
- *
- * @author lionel
- */
-class BadCredentialException extends Exception
-{
-    public function __construct($message, $code, $previous = null)
-    {
-        parent::__construct($message, $code, $previous);
-    }
-}

--- a/core/internal/Exception/Http/BadRequestException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class BadRequestException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $internalCode = '', $previous = null)
-    {
-        parent::__construct($title, $message, 400, $internalCode, $previous);
-    }
-}

--- a/core/internal/Exception/Http/ConflictException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class ConflictException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $previous)
-    {
-        parent::__construct($title, $message, 400, $previous);
-    }
-}

--- a/core/internal/Exception/Http/ForbiddenException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class ForbiddenException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $previous)
-    {
-        parent::__construct($title, $message, 400, $previous);
-    }
-}

--- a/core/internal/Exception/Http/InternalServerErrorException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class InternalServerErrorException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $previous)
-    {
-        parent::__construct($title, $message, 400, $previous);
-    }
-}

--- a/core/internal/Exception/Http/NotAcceptableException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class NotAcceptableException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $previous)
-    {
-        parent::__construct($title, $message, 400, $previous);
-    }
-}

--- a/core/internal/Exception/Http/NotFoundException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class NotFoundException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $internalCode = '', $previous = null)
-    {
-        parent::__construct($title, $message, 400, $internalCode, $previous);
-    }
-}

--- a/core/internal/Exception/Http/NotImplementedException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class NotImplementedException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $previous)
-    {
-        parent::__construct($title, $message, 400, $previous);
-    }
-}

--- a/core/internal/Exception/Http/UnauthorizedException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Http;
-use Centreon\Internal\Exception\HttpException;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class UnauthorizedException extends HttpException
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($title, $message, $internalCode = '', $previous = null)
-    {
-        parent::__construct($title, $message, 400, $internalCode, $previous);
-    }
-}

--- a/core/internal/Exception/HttpException.php
+++ b//dev/null
@@ -1,80 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception;
-use Centreon\Internal\Exception;
-/**
- * Description of HttpException
- *
- * @author lionel
- */
-class HttpException extends Exception
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $httpErrorTitle = '';
-    /**
-     *
-     * @var type 
-     */
-    protected $internalCode = '';
-    /**
-     * 
-     * @param type $message
-     * @param type $code
-     * @param type $previous
-     */
-    public function __construct($title, $message, $code, $internalCode, $previous)
-    {
-        parent::__construct($message, $code, $previous);
-        $this->httpErrorTitle = $title;
-        $this->internalCode = $internalCode;
-    }
-    /**
-     * 
-     * @return type
-     */
-    public function getTitle()
-    {
-        return $this->httpErrorTitle;
-    }
-    /**
-     * 
-     */
-    public function getInternalCode()
-    {
-    }
-}

--- a/core/internal/Exception/Validator/MissingParameterException.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Exception\Validator;
-use Centreon\Internal\Exception;
-/**
- * Description of NotFoundException
- *
- * @author lionel
- */
-class MissingParameterException extends Exception
-{
-    /**
-     * 
-     * @param type $message
-     * @param type $previous
-     */
-    public function __construct($message, $internalCode = 400, $previous = null)
-    {
-        parent::__construct($message, $internalCode, $previous);
-    }
-}

--- a/core/internal/Form.php
+++ b//dev/null
@@ -1,725 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Form
-{
-    /**
-     *
-     * @var \HTML_QuickForm
-     */
-    private $formProcessor;
-    /**
-     *
-     * @var HTML_QuickForm_Renderer_ArraySmarty
-     */
-    private $formRenderer;
-    /**
-     *
-     * @var type 
-     */
-    private $options;
-    /**
-     *
-     * @var \Centreon\Template
-     */
-    private $tpl;
-    /**
-     *
-     * @var type
-     */
-    private $template;
-    /**
-     *
-     * @var \Centreon\Internal\Di 
-     */
-    private $di;
-    /**
-     * The style for quickform elements
-     * 
-     * @var array
-     */
-    private $style;
-    /**
-     * The separator for quickform elements
-     *
-     * @var string
-     */
-    private $basicSeparator;
-    /**
-     * Javascript rules 
-     *
-     * @var array
-     */
-    private $jsRules;
-    /**
-     *
-     * @var array 
-     */
-    private $customValidator = array();
-    /**
-     *
-     * @var string 
-     */
-    private $eventValidation = array(
-        'validators' => array(),
-        'formId' => '',
-        'extraJs' => ''
-    );
-    /**
-     *
-     * @var string 
-     */
-    private $submitValidation = '';
-    /** 
-     *
-     * @var string The form name
-     */
-    private $formName;
-    /**
-     * Constructor
-     *
-     * @param string $name The name of form
-     * @param array $options The options
-     */
-    public function __construct($name, $options = null)
-    {
-        $this->formProcessor = new \HTML_QuickForm($name, 'post');
-        $this->formName = $name;
-        $this->options = $options;
-        $this->init();
-        $this->di = Di::getDefault();
-        $this->tpl = $this->di->get('template');
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function toSmarty()
-    {
-        $this->formRenderer = new \HTML_QuickForm_Renderer_ArraySmarty($this->tpl, true);
-        $this->formRenderer->setRequiredTemplate('{label}<font color="red" size="1">*</font>');
-        $this->formRenderer->setErrorTemplate('<font color="red">{error}</font><br />{html}');
-        $this->formProcessor->accept($this->formRenderer);
-        $smartyArrayFormat = $this->formatForSmarty();
-        $this->tpl->assign('eventValidation', $this->eventValidation);
-        $this->tpl->assign('submitValidation', $this->submitValidation);
-        return $smartyArrayFormat;
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function getCustomValidator()
-    {
-        return $this->customValidator;
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function getAjaxValidator()
-    {
-        return $this->ajaxValidator;
-    }
-    /**
-     * 
-     * @param array $smartyArray
-     */
-    private function formatForSmarty()
-    {
-        $smartyArray = $this->formRenderer->toArray();
-        $finalArray = array (
-            'frozen' => $smartyArray['frozen'],
-            'javascript' => $smartyArray['javascript'],
-            'attributes' => $smartyArray['attributes'],
-            'requirednote' => $smartyArray['requirednote'],
-            'errors' => $smartyArray['errors'],
-            'hidden' => $smartyArray['hidden']
-        );
-        $this->eventValidation['formId'] = $this->formName;
-        if (isset($smartyArray['elements'])) {
-            foreach ($smartyArray['elements'] as $element) {
-                $finalArray[$element['name']] = array();
-                foreach ($element as $key => $value) {
-                    $finalArray[$element['name']][$key] = $value;
-                }
-                $this->renderAsHtml($finalArray[$element['name']]);
-            }
-        }
-        return $finalArray;
-    }
-    /**
-     * 
-     * @param array $element
-     */
-    private function renderAsHtml(&$element)
-    {
-        switch ($element['type']) {
-            default:
-                $element['input'] = $this->renderHtmlTextarea($element);
-                $element['label'] = $this->renderHtmlLabel($element);
-                $element['html'] = $this->renderFinalHtml($element);
-                break;
-            case 'button':
-            case 'submit':
-            case 'reset':
-                $element['input'] = $this->renderHtmlButton($element);
-                $element['label'] = "";
-                $element['html'] = $this->renderFinalHtml($element);
-                break;
-            case 'static':
-                $className = "\\Centreon\\Internal\\Form\\Component\\".ucfirst($element['label_type']);
-                if (class_exists($className) && method_exists($className, 'renderHtmlInput')) {
-                    $element['label'] = $element['label_label'];
-                    $in = $className::renderHtmlInput($element);
-                    $inVal = $className::addValidation($element);
-                    if (isset($in['html'])) {
-                        $element['input'] = $in['html'];
-                    }
-                    if (isset($in['css'])) {
-                        $element['css'] = $in['css'];
-                    }
-                    if (isset($in['extrahtml'])) {
-                        $element['extrahtml'] = $in['extrahtml'];
-                    }
-                    $element['label'] = $this->renderHtmlLabel($element);
-                    $element['html'] = $this->renderFinalHtml($element);
-                    if (isset($in['js'])) {
-                        $this->tpl->addCustomJs($in['js']);
-                    }
-                    if (isset($inVal['eventValidation'])) {
-                        if (isset($inVal['eventValidation']['extraJs'])) {
-                            $this->eventValidation['extraJs'] .= $inVal['eventValidation']['extraJs'];
-                            unset($inVal['eventValidation']['extraJs']);
-                        }
-                        $this->eventValidation['validators'] = array_merge(
-                            $this->eventValidation['validators'],
-                            $inVal['eventValidation']
-                        );
-                    }
-                    if (isset($inVal['submitValidation'])) {
-                        $this->submitValidation .= $inVal['submitValidation'];
-                    }
-                }
-                break;
-        }
-    }
-    /**
-     * 
-     * @param array $inputElement
-     * @return string
-     */
-    public function renderHtmlButton($inputElement)
-    {
-        (isset($inputElement['value']) ? $value = 'value="'.$inputElement['value'].'" ' :  $value = '');
-        if (!isset($inputElement['id']) || (isset($inputElement['id']) && empty($inputElement['id']))) {
-            $inputElement['id'] = $inputElement['name'];
-        }
-        $inputHtml = '<input '.
-                            'id="'.$inputElement['id'].'" '.
-                            'type="'.$inputElement['type'].'" '.
-                            'name="'.$inputElement['name'].'" '.
-                            $value.
-                            'class="btn btn-default" '.
-                            '/>';
-        return $inputHtml;
-    }
-    /**
-     * 
-     * @param type $inputElement
-     * @return type
-     */
-    public function renderFinalHtml($inputElement)
-    {
-        $helpButton = '';
-        $classInput = 'col-sm-9';
-        $classAdvanced = '';
-        $extraHtml = '';
-        if ($inputElement['type'] !== 'submit') {
-            $helpButton = $this->renderHelp($inputElement);
-            $classInput = 'col-sm-9';
-        }
-        if (isset($inputElement['css'])) {
-            $classInput = $inputElement['css'];
-        }
-        if (isset($inputElement['extrahtml'])) {
-            $extraHtml = $inputElement['extrahtml'];
-        }
-        if (isset($inputElement['label_advanced']) && $inputElement['label_advanced'] == '1') {
-            $classAdvanced = 'advanced';
-        }
-        return '<div class="form-group ' . $classAdvanced . '">'.
-                '<div class="col-sm-2" style="text-align:right">'.$inputElement['label'].'</div>'.
-                '<div class="'.$classInput.'">'.$inputElement['input'].'</div>'. $extraHtml .
-                $helpButton.
-                '</div>';
-    }
-    /**
-     * 
-     * @param type $inputElement
-     * @return string
-     */
-    private function renderHelp($inputElement)
-    {
-        $helpButton = '';
-        if (isset($inputElement['label_help'])) {
-            $helpButton = '<div class="col-sm-1"><button id="'
-                . $inputElement['name'] . '_help" type="button" class="btn btn-sm btn-info">?</button>'
-                . '</div>';
-            $helpBubble = '$("#' . $inputElement['name'] . '_help").qtip({
-                                content: {
-                                    text: "'.str_replace('"', '\"', $inputElement['label_help']).'",
-                                    title: "'.$inputElement['label_label'].' Help",
-                                    button: true
-                                },
-                                position: {
-                                    my: "top right",
-                                    at: "bottom left",
-                                    target: $("#' . $inputElement['name'] . '_help") // my target
-                                },
-                                show: {
-                                    event: "click",
-                                    solo: "true"
-                                },
-                                style: {
-                                    classes: "qtip-bootstrap"
-                                },
-                                hide: {
-                                    event: "unfocus"
-                                }
-                            });';
-            $this->tpl->addCustomJs($helpBubble);
-        }
-        return $helpButton;
-    }
-    /**
-     * 
-     * @param array $inputElement
-     * @return string
-     */
-    public function renderHtmlLabel($inputElement)
-    {
-        if (!isset($inputElement['label']) || (isset($inputElement['label']) && empty($inputElement['label']))) {
-            $inputElement['label'] = $inputElement['name'];
-        }
-        if (!isset($inputElement['id']) || (isset($inputElement['id']) && empty($inputElement['id']))) {
-            $inputElement['id'] = $inputElement['name'];
-        }
-        $mandatorySign = "";
-        if (isset($inputElement['label_mandatory']) && $inputElement['label_mandatory'] == "1") {
-            $mandatorySign .= ' required';
-        }
-        $inputHtml = '<label class="label-controller' . $mandatorySign . '" for="'.$inputElement['id'].'">'.$inputElement['label'].'</label>';
-        return $inputHtml;
-    }
-    /**
-     * Add a submit to the form
-     *
-     * @param string $name The name of submit
-     * @param string $label The value of submit
-     * @param array $params Additionnal param
-     * @return \HTML_QuickForm_Element_InputSubmit
-     */
-    public function addSubmit($name, $label, $params = array())
-    {
-        $this->formProcessor->addElement('submit', $name, $label, $params)
-                ->updateAttributes(array('id'=>$name, 'class'=>'btn-primary'));
-    }
-    /**
-     * 
-     * @param type $origin
-     * @param type $uri
-     * @return type
-     */
-    public static function getValidatorsQuery($origin, $uri)
-    {
-        $di = Di::getDefault();
-        $baseUrl = $di->get('config')->get('global', 'base_url');
-        $uri = substr($uri, strlen($baseUrl));
-        switch ($origin) {
-            default:
-            case 'form':
-                $validatorsQuery = "SELECT
-                        fv.`name` as validator_name, `action` as `validator`,
-                        ff.`name` as `field_name`, ff.`label` as `field_label`
-                    FROM
-                        cfg_forms_validators fv, cfg_forms_fields_validators_relations ffv, cfg_forms_fields ff
-                    WHERE
-                        ffv.validator_id = fv.validator_id
-                    AND
-                        ff.field_id = ffv.field_id
-                    AND
-                        ffv.field_id IN (
-                            SELECT
-                                fi.field_id
-                            FROM
-                                cfg_forms_fields fi, cfg_forms_blocks fb, cfg_forms_blocks_fields_relations fbf, cfg_forms_sections fs, cfg_forms f
-                            WHERE
-                                fi.field_id = fbf.field_id
-                            AND
-                                fbf.block_id = fb.block_id
-                            AND
-                                fb.section_id = fs.section_id
-                            AND
-                                fs.form_id = f.form_id
-                            AND
-                                f.route = '$uri'
-                    );";
-                break;
-            case 'wizard':
-                $validatorsQuery = "SELECT
-                        fv.`name` as validator_name, `action` as `validator`, ff.`name` as `field_name`,
-                        ff.`label` as `field_label`
-                    FROM
-                        cfg_forms_validators fv, cfg_forms_fields_validators_relations ffv, cfg_forms_fields ff
-                    WHERE
-                        ffv.validator_id = fv.validator_id
-                    AND
-                        ff.field_id = ffv.field_id
-                    AND
-                        ffv.field_id IN (
-                            SELECT
-                                fi.field_id
-                            FROM
-                                cfg_forms_fields fi, cfg_forms_steps fs, cfg_forms_steps_fields_relations fsf, cfg_forms_wizards fw
-                            WHERE
-                                fi.field_id = fsf.field_id
-                            AND
-                                fsf.step_id = fs.step_id
-                            AND
-                                fs.wizard_id = fw.wizard_id
-                            AND
-                                fw.route = '$uri'
-                    );";
-                break;
-        }
-        return $validatorsQuery;
-    }
-    /**
-     * 
-     * @param type $origin
-     * @param type $uri
-     * @return type
-     */
-    public static function getValidators($origin, $uri)
-    {
-        $di = Di::getDefault();
-        $dbconn = $di->get('db_centreon');
-        $validatorsQuery = self::getValidatorsQuery($origin, $uri);
-        $stmt = $dbconn->query($validatorsQuery);
-        $validatorsRawList = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        $validatorsFinalList = array();
-        foreach ($validatorsRawList as $validator) {
-            $validatorsFinalList[$validator['field_name']][] = array(
-                'call' => $validator['validator_name'],
-                'label' => $validator['field_label']
-            );
-        }
-        return $validatorsFinalList;
-    }
-    /**
-     * 
-     * @param type $field
-     * @param type $extraParams
-     * @return \Centreon\Internal\Form
-     */
-    public function add($field, $extraParams = array())
-    {
-        switch ($field['type']) {
-            default:
-                $this->addStatic($field, $extraParams);
-                break;
-            case 'radio':
-                $values = json_decode($field['attributes']);
-                $radioValues = array();
-                foreach ($values as $label => $value) {
-                    $radioValues['list'][] = array(
-                        'name' => $label,
-                        'label' => $label,
-                        'value' => $value
-                    );
-                }
-                $this->addRadio(
-                    $field['name'],
-                    $field['label'],
-                    $field['name'],
-                    '&nbsp;',
-                    $radioValues
-                );
-                break;
-            case 'checkbox':
-                $values = json_decode($field['attributes']);
-                if (is_array($values) || is_object($values)) {
-                    $checkboxValues = array();
-                    foreach ($values as $label => $value) {
-                        $checkboxValues['list'][] = array(
-                            'name' => $label,
-                            'label' => $label,
-                            'value' => $value
-                        );
-                    }
-                    $this->addCheckBox(
-                        $field['name'],
-                        $field['label'],
-                        '&nbsp;',
-                        $checkboxValues
-                    );
-                } else {
-                    $this->addCheckbox($field['name'], $field['label']);
-                }
-                break;
-        }
-        return $this;
-    }
-    /**
-     * 
-     * @param type $given
-     * @param type $mandatory
-     */
-    private function checkParameters(&$given, $mandatory)
-    {
-        foreach ($mandatory as $field => $value) {
-            if (!isset($given[$field])) {
-                $given[$field] = $value;
-            }
-        }
-    }
-    /**
-     * 
-     * @param string $name
-     * @param string $value
-     */
-    public function addHidden($name, $value)
-    {
-        $this->formProcessor->addElement('hidden', $name, $value);
-    }
-    /**
-     * Add custom inputs
-     *
-     * @param array $field
-     * @param array $extraParams
-     */
-    public function addStatic($field, $extraParams = array())
-    {
-        $params = array();
-        if (isset($field['attributes']) && $field['attributes']) {
-            $params = json_decode($field['attributes'], true);
-        }
-        $params['label'] = $field['label'];
-        $params['type'] = $field['type'];
-        $params['mandatory'] = $field['mandatory'];
-        $params['parent_field'] = isset($field['parent_field']) ? $field['parent_field'] : '';
-        $params['parent_value'] = isset($field['parent_value']) ? $field['parent_value'] : '';
-        $params['child_actions'] = isset($field['child_actions']) ? $field['child_actions'] : '';
-        if (isset($field['advanced']) && $field['advanced'] != null) {
-            $params['advanced'] = $field['advanced'];
-        }
-        if (isset($field['help']) && $field['help'] != null) {
-            $params['help'] = $field['help'];
-        }
-        if (isset($field['help_url']) && $field['help_url'] != null) {
-            $params['help_url'] = $field['help_url'];
-        }
-        if (isset($field['validators']) && $field['validators'] != null) {
-            $params['validators'] = $field['validators'];
-        }
-        $params['extra'] = $extraParams;
-        $elem = $this->formProcessor->addElement('static', $field['name'], $params);
-    }
-    /**
-     * Return the array for smarty
-     * 
-     * @return type
-     */
-    public function display()
-    {
-        $this->setDefaults();
-        $renderer = \HTML_QuickForm_Renderer::factory('centreon');
-        $this->formProcessor->render($renderer);
-        $this->formProcessor->addRecursiveFilter("trim");
-        return $this->rulesToArray($renderer->toArray());
-    }
-    /**
-     * 
-     * @param type $defaultValues
-     * @param type $filter
-     */
-    public function setDefaults($defaultValues = null, $filter = null)
-    {
-        $this->formProcessor->setDefaults($defaultValues, $filter);
-    }
-    /**
-     * Enable or Disable freeze status
-     * @params boolean
-     *
-     */
-    public function freeze($bool = 1)
-    {
-        $this->formProcessor->toggleFrozen($bool);
-    }
-    /**
-     * Returns the element's value, possibly with filters applied
-     *
-     */
-    public function getValue()
-    {
-        return $this->formProcessor->getValue();
-    }
-    /**
-     * 
-     * @param type $elem
-     * @return string
-     */
-    public function getSubmitValue($elem = null)
-    {
-        if (!isset($elem)) {
-            return $this->formProcessor->getSubmitValue();
-        } else {
-            return $this->formProcessor->getSubmitValue($elem);
-        }
-    }
-    /**
-     * 
-     * @param type $elem
-     * @return type
-     */
-    public function getSubmitValues($elem = null)
-    {
-        if (!isset($elem)) {
-            return $this->formProcessor->getSubmitValues();
-        } else {
-            return $this->formProcessor->getSubmitValues($elem);
-        }
-    }
-    /**
-     * 
-     */
-    public function isSubmitted()
-    {
-        $this->formProcessor->isSubmitted();
-    }
-    /**
-     * 
-     * @param type $elem
-     * @return type
-     */
-    public function getElement($elem)
-    {
-        return $this->formProcessor->getElement($elem);
-    }
-    /**
-     * 
-     * @param type $origin
-     * @param type $uri
-     * @param type $moduleName
-     * @param type $submittedValues
-     * @return type
-     */
-    public static function validate($origin, $uri, $moduleName, &$submittedValues)
-    {
-        $isValidate = true;
-        $errorMessage = '';
-        try {
-            unset($submittedValues['token']);
-            if (!isset($submittedValues['object_id'])) {
-                $submittedValues['object_id'] = null;
-            }
-            $validatorsList = self::getValidators($origin, $uri);
-            foreach ($validatorsList as $validatorKey => $validatorsForField) {
-                $nbOfValidators = count($validatorsForField);
-                for ($i=0; $i<$nbOfValidators; $i++) {
-                    $validatorCall = '\Centreon\Internal\Form\Validator\\'.ucfirst($validatorsForField[$i]['call']);
-                    $resultValidate = $validatorCall::validate(
-                        $submittedValues[$validatorKey],
-                        $moduleName,
-                        $submittedValues['object'],
-                        $submittedValues['object_id'],
-                        $validatorKey
-                    );
-                    if (!$resultValidate['success']) {
-                        $isValidate = false;
-                        $errorMessage .= '<b>'
-                            .$validatorsForField[$i]['label']
-                            . '</b> : '
-                            . $resultValidate['error']
-                            . '<br />';
-                        break;
-                    }
-                }
-            }
-        } catch (Exception $e) {
-            $isValidate = false;
-            $errorMessage = $e->getMessage();
-        }
-        return array('success' => $isValidate, 'error' => $errorMessage);
-    }
-    /**
-     * 
-     * @param type $field Specific rules
-     * @return type
-     */
-    private function removeSpaces($field)
-    {
-        $ret = $this->formProcessor->getSubmitValues();
-        return (str_replace(" ", "_", $ret[$field]));
-    }
-    /****************************************************/
-    /**
-     * Add javascript rules in end of form array
-     *
-     * @param array $array The quickform to array
-     * @return array
-     */
-    private function rulesToArray($array)
-    {
-        $array['rules'] = $this->jsRules;
-        return $array;
-    }
-    /**
-     * Initialiaze the form templating style
-     */
-    private function init()
-    {
-        $this->template = array();
-        $this->template['textarea'] = array('rows' => '6', 'cols' => '120');
-        $this->style = array();
-        $this->basicSeparator = '&nbsp;';
-    }
-}

--- a/core/internal/Form/Component/Checkbox.php
+++ b//dev/null
@@ -1,82 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * Html Checkobox element
- * 
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Checkbox extends Component
-{
-    /**
-     * Return the HTML representation of the checkbox field
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = $element['html'] :  $value = '');
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-        }
-        $inputHtml = '';
-        $myJs = '';
-        $i = 1;
-        foreach ($element['label_choices'] as $key => $choice) {
-            $htmlSelected = '';
-            if ($value == $choice) {
-                $htmlSelected = 'checked=checked';
-            }
-            $inputHtml .= '<label class="label-controller" for="'.$element['id'] . $i . '">&nbsp;'.
-                        '<input '.'id="'.$element['id']. $i . '" '.
-                        'type="'.$element['label_type'].'" '.'name="'.$element['name'].'" '.
-                        'value=' . $choice . ' '.$htmlSelected.' '.
-                        '/>'.' '.$key.
-                        '</label>'.'&nbsp;&nbsp;';
-            $i++;
-        }
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Command.php
+++ b//dev/null
@@ -1,86 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Command extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $commandSelect = Select::renderHtmlInput($element);
-        $myHtml = '<div class="row"><div class="col-sm-12">'.$commandSelect['html'].'</div></div>';
-        $myJs = $commandSelect['js'];
-        $myHtml .='<div id="'.$element['name'].'_command_args" class="row"></div>';
-        $commandArgumentsUrl = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor('/centreon-configuration/command/[i:id]/arguments');
-        $myJs .= ' '
-            . '$("#'.$element['name'].'").on("change", function() { '
-                . '$("#'.$element['name'].'_command_args").empty(); '
-                . 'var commandId = $("#'.$element['name'].'").val(); '
-                . 'var realCommandArgumentsUrl = "'.$commandArgumentsUrl.'"; '
-                . 'var computedCommandArgumentsUrl = realCommandArgumentsUrl.replace("[i:id]", commandId);'
-                . '$.ajax({ '
-                    . 'url: computedCommandArgumentsUrl,'
-                    . 'type: "GET", '
-                    . 'dataType: "json" '
-                . '})'
-                . '.success(function(data, status, jqxhr) { '
-                    . 'var argumentsHtml = ""; '
-                    . '$.each(data, function(key, value){ '
-                        . 'argumentsHtml += "<div class=\"row\"><div class=\"col-sm-3\">"+value.name+"</div>'
-                        . '<div class=\"col-sm-4\">'
-                            . '<input class=\"form-control\" type=\"text\" value=\""+value.value+"\">'
-                            . '</div>'
-                        . '<div class=\"col-sm-3\">"+value.example+"</div></div>" '
-                    . '}); '
-                    . '$("#'.$element['name'].'_command_args").append(argumentsHtml); '
-                . '});'
-            . '});';
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Component.php
+++ b//dev/null
@@ -1,122 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * Description of FormComponent
- *
- * @author lionel
- */
-class Component
-{
-    /**
-     * Render Html for input field
-     *
-     * @param array
-     * @return array array('html' => string, 'js' => string)
-     */
-    public static function renderHtmlInput(array $element)
-    {
-    }
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function addValidation($element)
-    {
-        $eventValidation = '';
-        $submitValidation = '';
-        if (isset($element['label_label']) && (!empty($element['label_label']))) {
-            $label = $element['label_label'];
-        } else {
-            $label = $element['name'];
-        }
-        $rules = array();
-        if (isset($element['label_validators'])) {
-            $remote = false;
-            foreach ($element['label_validators'] as $validator) {
-                $rule = null;
-                switch ($validator['rules']) {
-                    case 'remote':
-                        if ($remote) {
-                            break;
-                        }
-                        $rule = array(
-                            'action' => $validator['validator_action']
-                        );
-                        $remote = true;
-                        break;
-                    case 'size':
-                        if (false === isset($validator['params']['minlength'])
-                            && false === isset($validator['params']['maxlength'])) {
-                            break;
-                        }
-                        if (isset($validator['params']['minlength'])) {
-                            $rule['minlength'] = $validator['params']['minlength'];
-                        }
-                        if (isset($validator['params']['maxlength'])) {
-                            $rule['maxlength'] = $validator['params']['maxlength'];
-                        }
-                        break;
-                    case 'forbiddenChar':
-                        if (false === isset($validator['params']['charaters'])) {
-                            break;
-                        }
-                        $rule['characters'] = $validator['params']['characters'];
-                    default:
-                        break;
-                }
-                if (false === is_null($rule)) {
-                    $rules = array_merge($rules, array(
-                        $validator['rules'] => $rule
-                    ));
-                }
-            }
-        }
-        if ((isset($element['parent_fields']) && $element['parent_fields'] != '')
-            && (isset($element['parent_value']) && $element['parent_value'] != '')
-            && (isset($element['child_mandatory']) && $element['child_mandatory'] == 1)) {
-            $rules['required'] = array(
-                'parent_id' => $element['parent_fields'],
-                'parent_value' => $element['parent_value']
-            );
-        }
-        return array(
-            'submitValidation' => $submitValidation,
-            'eventValidation' => array($element['name'] => $rules)
-        );
-    }
-}

--- a/core/internal/Form/Component/Customarguments.php
+++ b//dev/null
@@ -1,71 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Customarguments extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['value']) ? $value = 'value="'.$element['value'].'" ' :  $value = '');
-        if (!isset($element['label']) || (isset($element['label']) && empty($element['label']))) {
-            $element['label'] = $element['name'];
-        }
-        if (!isset($element['placeholder']) || (isset($element['placeholder']) && empty($element['placeholder']))) {
-            $placeholder = 'placeholder="'.$element['name'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $myJs = "";
-        $myHtml = '<div class="row">
-                    <div class="col-sm-5"><input class="form-control" name="" /></div>
-                    <div class="col-sm-2" style="text-align:center;"><i class="fa fa-arrow-left"></i></div>
-                    <div class="col-sm-5"><input class="form-control" name="" /></div>
-                   </div>';
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Customcurvegraph.php
+++ b//dev/null
@@ -1,132 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 MERETHIS
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give MERETHIS
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of MERETHIS choice, provided that
- * MERETHIS also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use CentreonPerformance\Repository\GraphTemplate;
-/**
- * Astract for custom form for graph
- *
- * @author Maximilien Bersoult <mbersoult@merethis.com>
- * @package Centreon
- * @subpackage Core
- */
-abstract class Customcurvegraph extends Component
-{
-    /**
-     * @var string The template name for render input
-     */
-    protected static $templateName = null;
-    /**
-     * Render the html input
-     *
-     * @param array $element The element to render
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $di = \Centreon\Internal\Di::getDefault();
-        /* Add javascript file for clone */
-        $tpl = $di->get('template');
-        $tpl->addJs('centreon-clone.js')
-            ->addJs('spectrum.js');
-        $tpl->addCss('spectrum.css');
-        $router = $di->get('router');
-        $metricsUrl = $router->getPathFor('/centreon-performance/configuration/graphtemplate/listMetrics');
-        $javascript = '$(function() {
-  $(".clonable").centreonClone({
-    events: {
-      add: [
-        function(element) {
-          element.find(".color-picker").spectrum({
-            showInput: true,
-            allowEmpty: true,
-            preferredFormat: "hex"
-          });
-        }
-      ]
-    }
-  });
-  $(".cloned_element .color-picker").spectrum({
-    showInput: true,
-    allowEmpty: true,
-    preferredFormat: "hex"
-  });
-  $("body").on("click", ".btn-toggle", function() {
-    $(this).find(".btn").toggleClass("active");
-    if ($(this).find(".btn-primary").size()>0) {
-      $(this).find(".btn").toggleClass("btn-primary");
-    }
-    $(this).find(".btn").toggleClass("btn-default");
-  });
-  $("#load_metrics").on("click", function() {
-    var tmplId = $("#svc_tmpl_id").val();
-    if (tmplId == "") {
-      return;
-    }
-    $.ajax({
-      url: "' . $metricsUrl . '",
-      data: {svc_tmpl_id: tmplId},
-      dataType: "json",
-      type: "post",
-      success: function(data, statusText, jqXHR) {
-        var listMetrics = [];
-        if (data.success) {
-          $("input.metric_id").each(function(idx, el) {
-            listMetrics.push($(el).val());
-          });
-          $.each(data.data, function(idx, metric) {
-            if (-1 == $.inArray(metric, listMetrics)) {
-              $(".clonable").centreonClone("addElement", {
-                "input.metric_id": metric
-              });
-            }
-          });
-        }
-      }
-    });
-  });
-});';
-        /* Load default values */
-        if (isset($element['label_extra']) && isset($element['label_extra']['id'])) {
-            $graphTmplId = $element['label_extra']['id'];
-            $listMetrics = GraphTemplate::getMetrics($graphTmplId);
-            $tpl->assign('metrics', $listMetrics);
-        }
-        $tpl->assign('element', $element);
-        return array(
-            'html' => $tpl->fetch(static::$templateName),
-            'js' => $javascript
-        );
-    }
-}

--- a/core/internal/Form/Component/Customcurvegraphcustomgraph.php
+++ b//dev/null
@@ -1,49 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 MERETHIS
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give MERETHIS
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of MERETHIS choice, provided that
- * MERETHIS also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * Astract for custom form for graph
- *
- * @author Maximilien Bersoult <mbersoult@merethis.com>
- * @package Centreon
- * @subpackage Core
- */
-class Customcurvegraphcustomgraph extends Customcurvegraph
-{
-    /**
-     * @var string The template name for render input
-     */
-    protected static $templateName = 'file:[Core]form/customcurvegraph_customgraph.tpl';
-}

--- a/core/internal/Form/Component/Custommacro.php
+++ b//dev/null
@@ -1,153 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use CentreonConfiguration\Repository\CustomMacroRepository;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Custommacro extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        if (!isset($element['label']) || (isset($element['label']) && empty($element['label']))) {
-            $element['label'] = $element['name'];
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $tpl = \Centreon\Internal\Di::getDefault()->get('template');
-        $tpl->addJs('centreon-clone.js');
-        $myJs = '$(function() {
-  $(".clonable").centreonClone();
-})';
-        $myHtml = '<div id="'.$element['name'].'_controls">
-                       <div id="'.$element['name'].'_add" class="clone-trigger">
-                           <a 
-                                id="'.$element['name'].'_add_link" 
-                                class="addclone" style="padding-right:5px;cursor:pointer;"
-                            >
-                               '._("Add a new entry").' <i data-action="add" class="fa fa-plus-square"></i>
-                           </a>
-                       </div>
-                   </div>';
-        $myHtml .= '<ul id="'.$element['name'].'" class="clonable no-deco-list">
-                        <li id="'.$element['name'].'_noforms_template">
-                            <p class="muted">'._('Nothing here, use the "Add" button').'</p>
-                        </li>
-                        <li id="'.$element['name'].'_clone_template" class="clone_template" style="display:none;">
-                            <div class="row clone-cell">
-                                <div class="col-sm-1"><label class="label-controller">'._("Name").'</label></div>
-                                <div class="col-sm-3"><input class="form-control" name="macro_name[#index#]" /></div>
-                                <div class="col-sm-1"><label class="label-controller">'._("Value").'</label></div>
-                                <div class="col-sm-3">
-                                    <input class="hidden-value form-control" name="macro_value[#index#]" />
-                                </div>
-                                <div class="col-sm-1"><label class="label-controller">'._("Hidden").'</label></div>
-                                <div class="col-sm-1">
-                                    <input class="hidden-value-trigger" type="checkbox" name="macro_hidden[#index#]" />
-                                </div>
-                                <div class="col-sm-2">
-                                    <span class="clonehandle" style="cursor:move;"><i class="fa fa-arrows"></i></span>
-                                    &nbsp;
-                                    <span class="remove-trigger" style="cursor:pointer;">
-                                        <i class="fa fa-times-circle"></i>
-                                    </span>
-                                </div>
-                            </div>
-                            <input 
-                                type="hidden" 
-                                name="clone_order_'.$element['name'].'_#index#" 
-                                id="clone_order_#index#" 
-                            />
-                        </li>';
-        $functionCall = 'load' . ucfirst($element['label_object']) .'CustomMacro';
-        $currentCustommacro = CustomMacroRepository::$functionCall($element['label_extra']['id']);
-        if ($element['label_object'] == 'host') {
-            $regex = '/^\$_HOST(.+)\$$/';
-        } else {
-            $regex = '/^\$_SERVICE(.+)\$$/';
-        }
-        if (count($currentCustommacro) > 0) {
-            $i = 0;
-            foreach ($currentCustommacro as $cm) {
-                if ((int)$cm['macro_hidden'] > 0) {
-                    $cm['macro_hidden'] = 'checked=checked';
-                } else {
-                    $cm['macro_hidden'] = '';
-                }
-                $myHtml .= '
-                        <li id="'.$element['name'].'_clone_template" class="cloned_element" style="display:block;">
-                            <div class="row clone-cell">
-                                <div class="col-sm-1"><label class="label-controller">'._("Name").'</label></div>
-                                <div class="col-sm-3"><input class="form-control" name="macro_name[' . $i . ']" value="'. preg_replace($regex, '$1', $cm['macro_name']) .'"/></div>
-                                <div class="col-sm-1"><label class="label-controller">'._("Value").'</label></div>
-                                <div class="col-sm-3">
-                                    <input class="hidden-value form-control" name="macro_value[' . $i . ']" value="'.$cm['macro_value'].'"/>
-                                </div>
-                                <div class="col-sm-1"><label class="label-controller">'._("Hidden").'</label></div>
-                                <div class="col-sm-1">
-                                    <input class="hidden-value-trigger" type="checkbox" name="macro_hidden[' . $i . ']" '.$cm['macro_hidden'].' />
-                                </div>
-                                <div class="col-sm-2">
-                                    <span class="clonehandle" style="cursor:move;"><i class="fa fa-arrows"></i></span>
-                                    &nbsp;
-                                    <span class="remove-trigger" style="cursor:pointer;">
-                                        <i class="fa fa-times-circle"></i>
-                                    </span>
-                                </div>
-                            </div>
-                            <input 
-                                type="hidden" 
-                                name="clone_order_'.$element['name'].'_' . $i . '" 
-                                id="clone_order_' . $i . '" 
-                            />
-                        </li>';
-                $i++;
-            }
-        }
-        $myHtml .= '</ul><input id="cloned_element_index" name="cloned_element_index" type="hidden" value="0" />';
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Duration.php
+++ b//dev/null
@@ -1,109 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Duration extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $value = (isset($element['html']) ? 'value="'.$element['html'].'" ' : '');
-        $placeholder = 'placeholder="'.$element['name'].'" ';
-        if (isset($element['label_label']) && (!empty($element['label_label']))) {
-            $placeholder = 'placeholder="'.$element['label_label'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required = ' required';
-        }
-        $myJs = '';
-        $durationInput = '<input '
-            . 'id="'.$element['id'].'" '
-            . 'type="number" '
-            . 'name="'.$element['name'].'" '
-            . $value
-            . 'class="form-control input-sm '.$addClass.'" '
-            . $placeholder
-            . $required
-            . '/>';
-        $durationScaleSelector = '<button '
-            . 'id="'.$element['id'].'_scale_selector" '
-            . 'type="button" '
-            . 'class="btn btn-default btn-sm dropdown-toggle" '
-            . 'data-toggle="dropdown">'
-            . 'Seconds '
-            . '<span class="caret"></span></button>'
-            . ''
-            . ''
-            . '<ul class="dropdown-menu" role="menu">'
-            . '<li class="'.$element['name'].'_scale_values"><a href="#">Seconds</a></li>'
-            . '<li class="'.$element['name'].'_scale_values"><a href="#">Minutes</a></li>'
-            . '<li class="'.$element['name'].'_scale_values"><a href="#">Hours</a></li>'
-            . '<li class="'.$element['name'].'_scale_values"><a href="#">Years</a></li>'
-            . '</ul>'
-            . '';
-        $durationInputScaleValue = '<input '
-            . 'id="'.$element['id'].'_scale" '
-            . 'type="hidden" '
-            . 'name="'.$element['name'].'_scale" '
-            . $value
-            . '/>';
-         $finalHtml = '<div class="input-group">'
-            .$durationInput
-            . '<span class="input-group-btn">' . $durationScaleSelector . ' ' . $durationInputScaleValue . '</span>'
-            . '</div>';
-         $myJs = '$(".'.$element['name'].'_scale_values").on("click", function(){'
-             . '$("#'.$element['id'].'_scale").val($(this).text()); '
-             . '$("#'.$element['id'].'_scale_selector").text($(this).text());'
-             . '});';
-        return array(
-            'html' => $finalHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Email.php
+++ b//dev/null
@@ -1,136 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Email extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = 'value="'.$element['html'].'" ' :  $value = '');
-        if (!isset($element['label']) || (isset($element['label']) && empty($element['label']))) {
-            $element['label'] = $element['name'];
-        }
-        if (!isset($element['placeholder']) || (isset($element['placeholder']) && empty($element['placeholder']))) {
-            $placeholder = 'placeholder="'.$element['name'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required = ' required';
-        }
-        $myJs = "";
-        $myHtml = '<div id="'.$element['name'].'_email" class="input-group input-group-sm">
-                <span class="input-group-addon">@</span>';
-        $myHtml .= '<input '.
-                'id="'.$element['id'].'" '.
-                'type="email" '.
-                'name="'.$element['name'].'" '.
-                $value.
-                'class="form-control '.$addClass.'" '.
-                $placeholder.
-                $required .
-                '/>';
-        $myHtml .= '<span id="'.$element['name'].'_email_span" class=""></span>'
-            . '</div>';
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function addValidation($element)
-    {
-        $validations = parent::addValidation($element);
-        $validationUrl = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor('/validator/email');
-        $validations['eventValidation'] .= ' $("#'.$element['name'].'").on("blur", function() {
-                    $.ajax({
-                        url: "'.$validationUrl.'",
-                        type: "POST",
-                        data: {"email":$("#'.$element['name'].'").val()},
-                        context: document.body
-                    })
-                    .success(function(data, status, jqxhr) {
-                        if (data.success) {
-                            $("#'
-                            .$element['name']
-                            .'_email").removeClass("has-error has-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email_span").removeClass("glyphicon glyphicon-remove form-control-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email").addClass("has-success has-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email_span").addClass("glyphicon glyphicon-ok form-control-feedback");    
-                        } else {
-                            $("#'
-                            .$element['name']
-                            .'_email").removeClass("has-error has-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email_span").removeClass("glyphicon glyphicon-ok form-control-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email").addClass("has-error has-feedback");
-                            $("#'
-                            .$element['name']
-                            .'_email_span").addClass("glyphicon glyphicon-remove form-control-feedback"); 
-                        }
-                    });
-                });';
-        return $validations;
-    }
-}

--- a/core/internal/Form/Component/File.php
+++ b//dev/null
@@ -1,239 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class File extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $tpl = Di::getDefault()->get('template');
-        $tpl->addCss('jquery.fileupload.css')
-            ->addCss('centreon-wizard.css');
-        $tpl->addJs('tmpl.min.js')
-            ->addJs('load-image.min.js')
-            ->addJs('canvas-to-blob.min.js')
-            ->addJs('jquery.fileupload.js')
-            ->addJs('jquery.fileupload-process.js')
-            ->addJs('jquery.fileupload-image.js')
-            ->addJs('jquery.fileupload-validate.js')
-            ->addJs('jquery.fileupload-ui.js')
-            ->addJs('centreon-wizard.js');
-        $uploadUrl = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor('/file/upload');
-        $fileInputHtml = '
-            <div id="fileupload">
-                <div class="row fileupload-buttonbar">
-                    <div class="col-sm-3">
-                        <!-- The fileinput-button span is used to style the file input field as button -->
-                        <span class="btn btn-success btn-sm fileinput-button">
-                            <i class="glyphicon glyphicon-plus"></i>
-                            <span>Add files...</span>
-                            <input type="file" name="centreonUploadedFile" multiple>
-                        </span>
-                    </div>
-                    <div class="col-sm-3">
-                        <button type="button" class="btn btn-primary btn-sm start">
-                            <i class="glyphicon glyphicon-upload"></i>
-                            <span>Start upload</span>
-                        </button>
-                    </div>
-                    <div class="col-sm-3">
-                        <button type="reset" class="btn btn-warning btn-sm cancel">
-                            <i class="glyphicon glyphicon-ban-circle"></i>
-                            <span>Cancel upload</span>
-                        </button>
-                    </div>
-                    <div class="col-sm-3">
-                        <button type="button" class="btn btn-danger btn-sm delete">
-                            <i class="glyphicon glyphicon-trash"></i>
-                            <span>Delete</span>
-                        </button>
-                        <input type="checkbox" class="toggle">
-                        <!-- The global file processing state -->
-                        <span class="fileupload-process"></span>
-                    </div>
-                </div>
-                <!-- The global progress state -->
-                <div class="row">
-                    <div class="col-sm-12">
-                        <div class="fileupload-progress fade">
-                            <!-- The global progress bar -->
-                            <div class="progress progress-striped active" 
-                                role="progressbar" aria-valuemin="0" aria-valuemax="100">
-                                <div id="progress" class="progress-bar progress-bar-success bar" style="width:0%;">
-                                </div>
-                            </div>
-                            <!-- The extended global progress state -->
-                            <div class="progress-extended">&nbsp;</div>
-                        </div>
-                    </div>
-                </div>
-                <div class="row">
-                    <div class="col-sm-12">
-                        <!-- The table listing the files available for upload/download -->
-                        <table role="presentation" class="table table-striped"><tbody class="files"></tbody></table>
-                    </div>
-                </div>
-            </div>
-            <!-- The template to display files available for upload -->
-            <script id="template-upload" type="text/x-tmpl">
-            {% for (var i=0, file; file=o.files[i]; i++) { %}
-                <tr class="template-upload fade">
-                    <td>
-                        <span class="preview"></span>
-                    </td>
-                    <td>
-                        <p class="name">{%=file.name%}</p>
-                        <strong class="error text-danger"></strong>
-                    </td>
-                    <td>
-                        <p class="size">Processing...</p>
-                        <div 
-                            class="progress progress-striped active" 
-                            role="progressbar" 
-                            aria-valuemin="0" 
-                            aria-valuemax="100" 
-                            aria-valuenow="0">
-                            <div class="progress-bar progress-bar-success" style="width:0%;"></div>
-                        </div>
-                    </td>
-                    <td>
-                        {% if (!i && !o.options.autoUpload) { %}
-                            <button class="btn btn-primary btn-sm start" disabled>
-                                <i class="glyphicon glyphicon-upload"></i>
-                                <span>Start</span>
-                            </button>
-                        {% } %}
-                        {% if (!i) { %}
-                            <button class="btn btn-warning btn-sm cancel">
-                                <i class="glyphicon glyphicon-ban-circle"></i>
-                                <span>Cancel</span>
-                            </button>
-                        {% } %}
-                    </td>
-                </tr>
-            {% } %}
-            </script>
-            <!-- The template to display files available for download -->
-            <script id="template-download" type="text/x-tmpl">
-            {% for (var i=0, file; file=o.files[i]; i++) { %}
-                <tr class="template-download fade">
-                    <td>
-                        <span class="preview">
-                            {% if (file.thumbnailUrl) { %}
-                                <a 
-                                    href="{%=file.url%}" 
-                                    title="{%=file.name%}" 
-                                    download="{%=file.name%}" 
-                                    data-gallery
-                                >
-                                    <img src="{%=file.thumbnailUrl%}">
-                                </a>
-                            {% } %}
-                        </span>
-                    </td>
-                    <td>
-                        <p class="name">
-                            {% if (file.url) { %}
-                                <a 
-                                    href="{%=file.url%}" 
-                                    title="{%=file.name%}" 
-                                    download="{%=file.name%}" 
-                                    {%=file.thumbnailUrl?\'data-gallery\':\'\'%}
-                                >
-                                    {%=file.name%}
-                                </a>
-                            {% } else { %}
-                                <span>{%=file.name%}</span>
-                            {% } %}
-                        </p>
-                        {% if (file.error) { %}
-                            <div><span class="label label-danger">Error</span> {%=file.error%}</div>
-                        {% } %}
-                    </td>
-                    <td>
-                        <span class="size">{%=o.formatFileSize(file.size)%}</span>
-                    </td>
-                    <td>
-                        {% if (file.deleteUrl) { %}
-                            <button 
-                                class="btn btn-danger btn-sm delete" 
-                                data-type="{%=file.deleteType%}" 
-                                data-url="{%=file.deleteUrl%}"
-                                {% if (file.deleteWithCredentials) {
-                                    %} data-xhr-fields=\'{"withCredentials":true}\'{% } 
-                                %}
-                            >
-                                <i class="glyphicon glyphicon-trash"></i>
-                                <span>Delete</span>
-                            </button>
-                            <input type="checkbox" name="delete" value="1" class="toggle">
-                        {% } else { %}
-                            <button class="btn btn-warning btn-sm cancel">
-                                <i class="glyphicon glyphicon-ban-circle"></i>
-                                <span>Cancel</span>
-                            </button>
-                        {% } %}
-                    </td>
-                </tr>
-            {% } %}
-            </script>';
-        $fileUploadJs = '$("#fileupload").fileupload({
-							url: "'.$uploadUrl.'",
-						});
-                        $("#fileupload").fileupload("option", {
-                            url: "'.$uploadUrl.'",
-                            disableImageResize: /Android(?!.*Chrome)|Opera/
-                                .test(window.navigator.userAgent),
-                            maxFileSize: 5000000,
-                            acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i
-                        });';
-        return array(
-            'html' => $fileInputHtml,
-            'js' => $fileUploadJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Float.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Float extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = 'value="'.$element['html'].'" ' :  $value = '');
-        $placeholder = 'placeholder="'.$element['name'].'" ';
-        if (isset($element['label_label']) && (!empty($element['label_label']))) {
-            $placeholder = 'placeholder="'.$element['label_label'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $myJs = "";
-        $inputHtml = '<span><input '.
-                        'id="'.$element['id'].'" '.
-                        'type="text" '.
-                        'name="'.$element['name'].'" '.
-                        $value.
-                        'class="form-control input-sm '.$addClass.'" '.
-                        $placeholder.
-                        $required .
-                        '/></span>';
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Integer.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Integer extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = 'value="'.$element['html'].'" ' :  $value = '');
-        $placeholder = 'placeholder="'.$element['name'].'" ';
-        if (isset($element['label_label']) && (!empty($element['label_label']))) {
-            $placeholder = 'placeholder="'.$element['label_label'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $myJs = "";
-        $inputHtml = '<input '.
-                        'id="'.$element['id'].'" '.
-                        'type="number" '.
-                        'name="'.$element['name'].'" '.
-                        $value.
-                        'class="form-control input-sm '.$addClass.'" '.
-                        $placeholder.
-                        $required .
-                        '/>';
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Ipaddress.php
+++ b//dev/null
@@ -1,114 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-class Ipaddress extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = 'value="'.$element['html'].'" ' :  $value = '');
-        if (!isset($element['placeholder']) || (isset($element['placeholder']) && empty($element['placeholder']))) {
-            $placeholder = 'placeholder="'.$element['name'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $myJs = "";
-        $myHtml = '<div id="'.$element['name'].'_ipaddress" class="input-group input-group-sm">';
-        $myHtml .= '<input '.
-                'id="'.$element['id'].'" '.
-                'type="text" '.
-                'name="'.$element['name'].'" '.
-                $value.
-                'class="form-control '.$addClass.'" '.
-                $placeholder.
-                $required.
-                '/>';
-        $myHtml .= '<span id="'.$element['name'].'_ipaddress_span" class=""></span>';
-        $myHtml .= '<span id="'.$element['name'].'_resolve_dns_span" class="input-group-btn">'
-            . '<button id="'.$element['name'].'_resolve_dns" class="btn btn-default" type="button">Resolve</button>'
-            . '</span>';
-        $myHtml .= '</div>';
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function addValidation($element)
-    {
-        $validations = parent::addValidation($element);
-        $resolveUrl = Di::getDefault()
-                        ->get('router')
-                        ->getPathFor('/validator/resolvedns');
-        $validations['eventValidation']['extraJs'] = '$("#'.$element['name'].'_resolve_dns").on("click", function(){
-                $.ajax({
-                    url: "'.$resolveUrl.'",
-                    type: "POST",
-                    data: {"dnsname":$("#'.$element['name'].'").val()},
-                    dataType: "json",
-                    context: document.body
-                })
-                .success(function(data, status, jqxhr) {
-                    alertClose();
-                    if (data["success"]) {
-                        $("#'.$element['name'].'").val(data["value"]);
-                        $("#'.$element['name'].'").trigger("blur");
-                    } else {
-                        alertMessage(data["error"], "alert-danger");
-                    }
-                });
-            });';
-        $validations['eventValidation'][$element['name']] = array(
-            'ipaddress' => array()
-        );
-        return $validations;
-    }
-}

--- a/core/internal/Form/Component/Nestablemenuacl.php
+++ b//dev/null
@@ -1,167 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Acl;
-use Centreon\Internal\Di;
-use CentreonAdministration\Repository\AclmenuRepository;
-/**
- * @author Sylvestre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Nestablemenuacl extends Component
-{
-    private static $aclmenudata = array();
-    /**
-     * Get checkbox html
-     * 
-     * @param int $menuId
-     * @param string $uri
-     * @return string
-     */
-    private static function getCheckboxHtml($menuId, $uri)
-    {
-        $routesData = Di::getDefault()
-            ->get('router')
-            ->getRoutes();
-        $str = "<span class=\"nestable_cb\">";
-        $cbArray = array();
-        foreach ($routesData as $data) {
-            if (strstr($data['route'], $uri) && $data['acl']) {
-                $cbArray[$data['acl']] = true;
-            }
-        }
-        $acldata = 0;
-        if (isset(self::$aclmenudata[$menuId])) {
-            $acldata = self::$aclmenudata[$menuId];
-        }
-        $tmp = "<span class=\"acl_cb\">%s <input type=\"checkbox\" name=\"acl_%s[{$menuId}]\" %s></input></span>";
-        if (isset($cbArray[Acl::ADD])) {
-            $checked = Acl::isFlagSet($acldata, Acl::ADD) ? 'checked' : '';
-            $str .= sprintf($tmp, _('Create'), 'create', $checked);
-        }
-        if (isset($cbArray[Acl::DELETE])) {
-            $checked = Acl::isFlagSet($acldata, Acl::DELETE) ? 'checked' : '';
-            $str .= sprintf($tmp, _('Delete'), 'delete', $checked);
-        }
-        if (isset($cbArray[Acl::UPDATE])) {
-            $checked = Acl::isFlagSet($acldata, Acl::UPDATE) ? 'checked' : '';
-            $str .= sprintf($tmp, _('Update'), 'update', $checked);
-        }
-        if (isset($cbArray[Acl::VIEW])) {
-            $checked = Acl::isFlagSet($acldata, Acl::VIEW) ? 'checked' : '';
-            $str .= sprintf($tmp, _('View'), 'view', $checked);
-        }
-        if (isset($cbArray[Acl::ADVANCED])) {
-            $checked = Acl::isFlagSet($acldata, Acl::ADVANCED) ? 'checked' : '';
-            $str .= sprintf($tmp, _('Advanced'), 'advanced', $checked);
-        }
-        $str .= "</span>";
-        return $str;
-    }
-    /**
-     * Get menu html string
-     *
-     * @param array $menus
-     * @param int $menuId
-     * @return string
-     */
-    private static function getMenuString($menus, $menuId)
-    {
-        $str = "";
-        foreach ($menus as $menu) {
-            if ($menu['menu_id'] == $menuId) {
-                $str .= "<li class=\"dd-item\" data-id=\"{$menuId}\">";
-                $style = "";
-                if ($menu['bgcolor']) {
-                    $style = "style=\"background: {$menu['bgcolor']}\"";
-                }
-                $str .= "<div class=\"dd-handle\" {$style}>";
-                if ($menu['icon_class']) {
-                    $str .= "<i class=\"{$menu['icon_class']}\"></i> ";
-                }
-                $str .= $menu['name'];
-                if (!count($menu['children'])) {
-                    $str .= self::getCheckboxHtml($menuId, $menu['url']);
-                }
-                $str .= "</div>";
-                if (count($menu['children'])) {
-                    $str .= "<ol class=\"dd-list\">";
-                    foreach ($menu['children'] as $cmenu) {
-                        $str .= self::getMenuString($menu['children'], $cmenu['menu_id']);
-                    }
-                    $str .= "</ol>";
-                }
-                $str .= "</li>";
-            }
-        }
-        return $str;
-    }
-    /**
-     * Render html input
-     *
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $tpl = Di::getDefault()->get('template');
-        $tpl->addCss('nestable.css');
-        $tpl->addJs('jquery.nestable.js');
-        $menus = Di::getDefault()->get('menu')->getMenu();
-        $menuStr = "";
-        if (isset($element['label_extra']) && isset($element['label_extra']['id'])) {
-            self::$aclmenudata = AclmenuRepository::getAclLevelByAclMenuId(
-                $element['label_extra']['id']
-            );
-        }
-        foreach ($menus as $menu) {
-            $menuStr .= self::getMenuString($menus, $menu['menu_id']);
-        }
-        $myHtml = '
-            <div class="dd">
-            <ol class="dd-list dd-nodrag">
-            '.$menuStr.'
-            </ol>
-            </div>
-            ';
-        $myJs = '
-            $(".dd").nestable({
-                handleClass: "dd-nohandle"
-            });
-        ';
-        return array('html' => $myHtml, 'js' => $myJs);
-    }
-}

--- a/core/internal/Form/Component/Password.php
+++ b//dev/null
@@ -1,81 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Password extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element, $repeat = false)
-    {
-        (isset($element['value']) ? $value = 'value="'.$element['value'].'" ' :  $value = '');
-        if (!isset($element['label']) || (isset($element['label']) && empty($element['label']))) {
-            $element['label'] = $element['name'];
-        }
-        if (!isset($element['placeholder']) || (isset($element['placeholder']) && empty($element['placeholder']))) {
-            $placeholder = 'placeholder="'.$element['label'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $myJs = '';
-        $inputHtml = '<input '.
-                        'id="'.$element['id'].'" '.
-                        'type="password" '.
-                        'name="'.$element['name'].'" '.
-                        $value.
-                        'class="form-control input-sm ' . $addClass . '" '.
-                        $placeholder.
-                        $required .
-                        '/>';
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Radio.php
+++ b//dev/null
@@ -1,84 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Radio extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = $element['html'] :  $value = '');
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $inputHtml = '';
-        $myJs = '';
-        $i = 1;
-        if (isset($element['label_choices'])) {
-            foreach ($element['label_choices'] as $key => $choice) {
-                $htmlSelected = '';
-                if ($value == $choice) {
-                    $htmlSelected = 'checked=checked';
-                }
-                $inputHtml .= '<label class="label-controller" for="'.$element['id'] . $i . '">&nbsp;'.
-                            '<input '.'id="'.$element['id']. $i . '" '.
-                            'type="'.$element['label_type'].'" '.'name="'.$element['name'].'" '.
-                            'value=' . $choice . ' '.$htmlSelected.' '.
-                            $required . 
-                            '/>'.' '.$key.
-                            '</label>'.'&nbsp;&nbsp;';
-                $i++;
-            }
-        }
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Select.php
+++ b//dev/null
@@ -1,176 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Select extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $tpl = Di::getDefault()->get('template');
-        $tpl->addCss('select2.css')
-            ->addCss('select2-bootstrap.css');
-        $tpl->addJs('jquery.select2/select2.min.js');
-        if (isset($element['label_defaultValuesRoute'])) {
-            $element['label_defaultValuesRoute'] = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor($element['label_defaultValuesRoute'], $element['label_extra']);
-        }
-        if (isset($element['label_listValuesRoute'])) {
-            $element['label_listValuesRoute'] = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor($element['label_listValuesRoute'], $element['label_extra']);
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $addJs = '';
-        if (isset($element['label_ordered']) && $element['label_ordered']) {
-            $addJs = '$("#'
-                .$element['name']
-                .'").on("change", function() { $("#'
-                .$element['name']
-                .'_val").html($("#'
-                .$element['name']
-                .'").val());});';
-            $addJs .= '$("#'.$element['name'].'").select2("container").find("ul.select2-choices").sortable({
-                    containment: "parent",
-                    start: function() { $("#'.$element['name'].'").select2("onSortStart"); },
-                    update: function() { $("#'.$element['name'].'").select2("onSortEnd"); }
-                  });'."\n";
-        }
-        if (!isset($element['label_multiple'])) {
-            $element['label_multiple'] = 0;
-        }
-        $myHtml = '<input '
-            . 'class="form-control input-sm '
-            . $addClass
-            . '" id="'.$element['name']
-            . '" name="' . $element['name']
-            . '" style="width: 100%;" type="hidden" value=" "' . $required . ' />';
-        $myJs = ''
-            . '$("#'.$element['name'].'").select2({'
-                . 'placeholder:"'.$element['label_label'].'", '
-                . 'multiple:'.(int)$element['label_multiple'].', '
-                . 'allowClear: true, '
-                . 'formatResult: select2_formatResult, '
-                . 'formatSelection: select2_formatSelection, ';
-        if (isset($element['label_selectData'])) {
-            if (is_array($element['label_selectData'])) {
-                $datas = json_encode($element['label_selectData']);
-            } else {
-                $datas = $element['label_selectData'];
-            }
-            $myJs .= 'data: { results: ' . $datas . ' },';
-        } elseif (isset($element['label_defaultValuesRoute'])) {
-            $myJs .= ''
-                . 'ajax: {'
-                    .'data: function(term, page) {'
-                        .'return { '
-                            .'q: term, '
-                        .'};'
-                    .'},'
-                    .'dataType: "json", '
-                    .'url:"'.$element['label_defaultValuesRoute'].'", '
-                    .'results: function (data){ '
-                        .'return {results:data, more:false}; '
-                    .'}'
-                .'},';
-        }
-        $initCallback = '';
-        if (isset($element['label_initCallback']) && $element['label_initCallback'] != '') {
-            $initCallback = '
-                if ( typeof ' . $element['label_initCallback'] . ' === "function" ) {
-                    ' . $element['label_initCallback'] . '(data);
-                } else {
-                    callFunction = "' . $element['label_initCallback'] . '(data)";
-                    eval(callFunction);
-                }
-            ';
-        }
-        if (isset($element['label_selectDefault']) && $element['label_selectDefault'] != "[]") {
-            $myJs .= ''
-                .'initSelection: function(element, callback) {'
-                    .'var data = '.$element['label_selectDefault'].';'
-                    .'callback(data);'
-                    .'id = $(element).val();'
-                    .'if (data.id) {'
-                    .'  $(element).val(data.id);'
-                    .'}'
-                    .$initCallback
-                .'}';
-        } elseif (isset($element['label_listValuesRoute'])) {
-            $myJs .= ''
-                .'initSelection: function(element, callback) { '
-                    .'var id=$(element).val();'
-                    .'if (id == " ") {
-                        $.ajax("'.$element['label_listValuesRoute'].'", {
-                            dataType: "json"
-                        }).done(function(data) {
-                            if (data.length > 0 || data.id) {
-                                callback(data);
-                                id = $(element).val();
-                                if (data.id) {
-                                    $(element).val(data.id);
-                                }
-                                if (id.match(/^,/)) {
-                                    $(element).val(id.substring(1, id.length));
-                                } ' . $initCallback . '
-                            }
-                        });
-                     }
-                },';
-        }
-        $myJs .= ''
-            .'});'."\n";
-        $myJs .= $addJs;
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Selectimage.php
+++ b//dev/null
@@ -1,89 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-class Selectimage extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $selectImageParameters = array(
-            'label_label' => $element['label_label'],
-            'label_multiple' => false,
-            'name' => $element['name'],
-            'label_object_type' => $element['label_object_type'],
-            'label_defaultValuesRoute' => $element['label_defaultValuesRoute'],
-            'label_listValuesRoute' => $element['label_listValuesRoute'],
-            'label_extra' => $element['label_extra'],
-            'label_object_type' => $element['label_object_type']
-        );
-        $addImageUrl = Di::getDefault()
-                        ->get('router')
-                        ->getPathFor($element['label_wizardRoute']);
-        $selectForImage = Select::renderHtmlInput($selectImageParameters);
-        $fileUploadForImage = File::renderHtmlInput($element);
-        $finalHtml = '<div class="row">'
-                . '<div class="col-sm-10">'.$selectForImage['html'].'</div>'
-                . '<div class="col-sm-2">'
-                    . '<button '
-                        . 'class="btn btn-default btn-sm" '
-                        . 'id="modalAdd_'.$element['name'].'" '
-                        . 'type="button">'
-                        . 'Add Files...'
-                    . '</button>'
-                . '</div>'
-            . '</div>';
-        $finalJs = $selectForImage['js'].' '.$fileUploadForImage['js'].' ';
-        $finalJs .= '$("#modalAdd_'.$element['name'].'").on("click", function(e) {
-            $("#modal").removeData("bs.modal");
-            $("#modal").removeData("centreonWizard");
-            $("#modal .modal-content").text("");
-            $("#modal").one("loaded.bs.modal", function(e) {
-                $(this).centreonWizard();
-            });
-            $("#modal").modal({
-                "remote": "'.$addImageUrl.'"
-            });
-        });';
-        return array(
-            'html' => $finalHtml,
-            'js' => $finalJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Singlecheckbox.php
+++ b//dev/null
@@ -1,72 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * Html Checkobox element
- * Checkbox with no label
- * 
- * @author Sylvestre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Singlecheckbox extends Component
-{
-    /**
-     * Return the HTML ouput of the checkbox field
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['html']) ? $value = $element['html'] :  $value = '');
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $htmlSelected = '';
-        if ($value) {
-            $htmlSelected = 'checked=checked';
-        }
-        $inputHtml = '<label class="label-controller" for="'. $element['id'] . '">&nbsp;' .
-                    '<input id="' . $element['id'] . '" ' .
-                    'type="checkbox" name="' . $element['name'] . '" ' .
-                    'value=1 ' . $htmlSelected . ' />' .
-                    '</label>&nbsp;&nbsp;';
-        return array(
-            'html' => $inputHtml,
-            'js' => ''
-        );
-    }
-}

--- a/core/internal/Form/Component/Submit.php
+++ b//dev/null
@@ -1,66 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * Html Submit element
- * 
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Submit extends Component
-{
-    /**
-     * Return the HTMLrepresentation of the submit field
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        (isset($element['value']) ? $value = 'value="'.$element['value'].'" ' :  $value = '');
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $inputHtml = '<input '.
-                    'id="'.$element['id'].'" '.
-                    'type="sbumit" '.
-                    'name="'.$element['name'].'" '.
-                    $value.
-                    'class="btn btn-default btn-sm" '.
-                    '/>';
-        return $inputHtml;
-    }
-}

--- a/core/internal/Form/Component/Tag.php
+++ b//dev/null
@@ -1,186 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-use Centreon\Internal\Di;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Tag extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $tpl = Di::getDefault()->get('template');
-        $tpl->addCss('select2.css')
-            ->addCss('select2-bootstrap.css');
-        $tpl->addJs('jquery.select2/select2.min.js');
-        if (isset($element['label_defaultValuesRoute'])) {
-            $element['label_defaultValuesRoute'] = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor($element['label_defaultValuesRoute'], $element['label_extra']);
-        }
-        if (isset($element['label_listValuesRoute'])) {
-            $element['label_listValuesRoute'] = Di::getDefault()
-                            ->get('router')
-                            ->getPathFor($element['label_listValuesRoute'], $element['label_extra']);
-        }
-        $addClass = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-        }
-        $addJs = '';
-        if (isset($element['label_ordered']) && $element['label_ordered']) {
-            $addJs = '$("#'
-                .$element['name']
-                .'").on("change", function() { $("#'
-                .$element['name']
-                .'_val").html($("#'
-                .$element['name']
-                .'").val());});';
-            $addJs .= '$("#'.$element['name'].'").select2("container").find("ul.select2-choices").sortable({
-                    containment: "parent",
-                    start: function() { $("#'.$element['name'].'").select2("onSortStart"); },
-                    update: function() { $("#'.$element['name'].'").select2("onSortEnd"); }
-                  });'."\n";
-        }
-        if (!isset($element['label_multiple'])) {
-            $element['label_multiple'] = 0;
-        }
-        $myHtml = '<input '
-            . 'class="form-control input-sm '
-            . $addClass
-            . '" id="'.$element['name']
-            . '" name="' . $element['name']
-            . '" style="width: 100%;" type="hidden" value=" " />';
-        $myJs = ''
-            . '$("#'.$element['name'].'").select2({'
-                . 'placeholder:"'.$element['label_label'].'", '
-                . 'multiple:'.(int)$element['label_multiple'].', '
-                . 'tags: true, '
-                . 'tokenSeparators: [","],'
-                . 'createSearchChoice: function (term) {
-                        return {
-                            id: $.trim(term),
-                            text: $.trim(term)
-                        };
-                    } ,';
-        if (isset($element['label_selectData'])) {
-            if (is_array($element['label_selectData'])) {
-                $datas = json_encode($element['label_selectData']);
-            } else {
-                $datas = $element['label_selectData'];
-            }
-            $myJs .= 'data: { results: ' . $datas . ' },';
-        } elseif (isset($element['label_defaultValuesRoute'])) {
-            $myJs .= ''
-                . 'ajax: {'
-                    .'data: function(term, page) {'
-                        .'return { '
-                            .'q: term, '
-                        .'};'
-                    .'},'
-                    .'dataType: "json", '
-                    .'url:"'.$element['label_defaultValuesRoute'].'", '
-                    .'results: function (data){ '
-                        .'return {results:data, more:false}; '
-                    .'}'
-                .'},';
-        }
-        $initCallback = '';
-        if (isset($element['label_initCallback']) && $element['label_initCallback'] != '') {
-            $initCallback = '
-                if ( typeof ' . $element['label_initCallback'] . ' === "function" ) {
-                    ' . $element['label_initCallback'] . '(data);
-                } else {
-                    callFunction = "' . $element['label_initCallback'] . '(data)";
-                    eval(callFunction);
-                }
-            ';
-        }
-        if (isset($element['label_selectDefault']) && $element['label_selectDefault'] != "[]") {
-            $myJs .= ''
-                .'initSelection: function(element, callback) {'
-                    .'var data = '.$element['label_selectDefault'].';'
-                    .'callback(data);'
-                    .'id = $(element).val();'
-                    .'if (data.id) {'
-                    .'  $(element).val(data.id);'
-                    .'}'
-                    .$initCallback
-                .'}';
-        } elseif (isset($element['label_listValuesRoute'])) {
-            $myJs .= ''
-                .'initSelection: function(element, callback) { '
-                    .'var id=$(element).val();'
-                    .'if (id == " ") {
-                        $.ajax("'.$element['label_listValuesRoute'].'", {
-                            dataType: "json"
-                        }).done(function(data) {
-                            if (data.length > 0 || data.id) {
-                                callback(data);
-                                id = $(element).val();
-                                if (data.id) {
-                                    $(element).val(data.id);
-                                }
-                                if (id.match(/^,/)) {
-                                    $(element).val(id.substring(1, id.length));
-                                } ' . $initCallback . '
-                            }
-                        });
-                     }
-                },';
-        }
-        $myJs .= ''
-            .'});'."\n";
-        $myJs .= '
-            $("#'.$element['name'].'").on("change", function (e) {
-                if (e.added) {
-                } else if (e.removed) {
-                    deleteTagToResource(e.removed.id);
-                }
-            })';
-        $myJs .= $addJs;
-        return array(
-            'html' => $myHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Templatepoller.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Maximilien Bersoult <mbersoult@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Templatepoller extends Select
-{
-    /**
-     * Render the element in html
-     *
-     * @param array $element The information of field
-     * @return array The html and extra information
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $info = parent::renderHtmlInput($element);
-        $info['css'] = 'col-sm-7';
-        $info['extrahtml'] = '<div class="col-sm-1">
-            <button class="btn btn-sm" disabled><i class="fa fa-gear fa-btn-inactive"></i></button>
-            </div>
-            <div class="col-sm-1">
-            <button class="btn btn-sm" disabled><i class="fa fa-database fa-btn-inactive"></i></button>
-            </div>';
-        return $info;
-    }
-}

--- a/core/internal/Form/Component/Text.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Text extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $value = (isset($element['html']) ? 'value="'.$element['html'].'" ' : '');
-        $placeholder = 'placeholder="'.$element['name'].'" ';
-        if (isset($element['label_label']) && (!empty($element['label_label']))) {
-            $placeholder = 'placeholder="'.$element['label_label'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required .= ' required';
-        }
-        $myJs = '';
-        $inputHtml = '<input '.
-                        'id="'.$element['id'].'" '.
-                        'type="text" '.
-                        'name="'.$element['name'].'" '.
-                        $value.
-                        'class="form-control input-sm '.$addClass.'" '.
-                        $placeholder.
-                        $required .
-                        '/>';
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Component/Textarea.php
+++ b//dev/null
@@ -1,80 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Component;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Textarea extends Component
-{
-    /**
-     * 
-     * @param array $element
-     * @return array
-     */
-    public static function renderHtmlInput(array $element)
-    {
-        $value = (isset($element['html']) ? ''.$element['html'].' ' : '');
-        if (!isset($element['label']) || (isset($element['label']) && empty($element['label']))) {
-            $element['label'] = $element['name'];
-        }
-        if (!isset($element['placeholder']) || (isset($element['placeholder']) && empty($element['placeholder']))) {
-            $placeholder = 'placeholder="'.$element['name'].'" ';
-        }
-        if (!isset($element['id']) || (isset($element['id']) && empty($element['id']))) {
-            $element['id'] = $element['name'];
-        }
-        $addClass = '';
-        $required = '';
-        if (isset($element['label_mandatory']) && $element['label_mandatory'] == "1") {
-            $addClass .= 'mandatory-field ';
-            $required = ' required';
-        }
-        $inputHtml = '<textarea '.
-                    'id="'.$element['id'].'" '.
-                    'name="'.$element['name'].'" '.
-                    'class="form-control '.$addClass.'" '.
-                    'rows="3" '.
-                    $placeholder.
-                    $required .
-                    '>'.$value.'</textarea>';
-        $myJs = '';
-        return array(
-            'html' => $inputHtml,
-            'js' => $myJs
-        );
-    }
-}

--- a/core/internal/Form/Exception/InvalidTokenException.php
+++ b//dev/null
@@ -1,44 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Exception;
-use Centreon\Internal\Exception;
-/**
- * Description of InvalidToken
- *
- * @author lionel
- */
-class InvalidTokenException extends Exception
-{
-}

--- a/core/internal/Form/Exception/MissingParameterException.php
+++ b//dev/null
@@ -1,42 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-/**
- * Description of MissingParameterException
- *
- * @author lionel
- */
-class MissingParameterException
-{
-}

--- a/core/internal/Form/Generator/Api.php
+++ b//dev/null
@@ -1,107 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Generator;
-use Centreon\Internal\Di;
-/**
- * Description of Api
- *
- * @author lionel
- */
-class Api extends Generator
-{
-    /**
-     * 
-     * @param string $formRoute
-     * @param array $extraParams
-     * @param string $productVersion
-     */
-    public function __construct($formRoute, $extraParams = array(), $productVersion = '')
-    {
-        parent::__construct($formRoute, $extraParams, $productVersion);
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function getValidators()
-    {
-        $validatorsQuery = $this->buildValidatorsQuery();
-        $stmt = $this->dbconn->query($validatorsQuery);
-        $validatorsRawList = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        $validatorsFinalList = array();
-        foreach ($validatorsRawList as $validator) {
-            $validatorsFinalList[$validator['field_name']][] = array(
-                'call' => $validator['validator_name'],
-                'params' => $validator['params']
-            );
-        }
-        return array('fieldScheme' => $validatorsFinalList);
-    }
-    /**
-     * 
-     */
-    protected function buildValidatorsQuery()
-    {
-        $validatorsQuery = "SELECT
-                fv.`name` as validator_name, `route` as `validator`, ffv.`params` as `params`,
-                ff.`name` as `field_name`, ff.`label` as `field_label`
-            FROM
-                cfg_forms_validators fv, cfg_forms_fields_validators_relations ffv, cfg_forms_fields ff
-            WHERE
-                ffv.validator_id = fv.validator_id
-            AND
-                ffv.server_side = '1'
-            AND
-                ff.field_id = ffv.field_id
-            AND
-                ffv.field_id IN (
-                    SELECT
-                        fi.field_id
-                    FROM
-                        cfg_forms_fields fi, cfg_forms_blocks fb, cfg_forms_blocks_fields_relations fbf, cfg_forms_sections fs, cfg_forms f
-                    WHERE
-                        fi.field_id = fbf.field_id
-                    AND
-                        fbf.block_id = fb.block_id
-                    AND
-                        fb.section_id = fs.section_id
-                    AND
-                        fs.form_id = f.form_id
-                    AND
-                        f.route = '$this->formRoute'
-            );";
-        return $validatorsQuery;
-    }
-}

--- a/core/internal/Form/Generator/Cli.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Generator;
-/**
- * Description of Cli
- *
- * @author lionel
- */
-class Cli extends Generator
-{
-    /**
-     * 
-     * @param type $formRoute
-     * @param type $extraParams
-     * @param type $productVersion
-     */
-    public function __construct($formRoute, $extraParams = array(), $productVersion = '')
-    {
-        parent::__construct($formRoute, $extraParams, $productVersion);
-    }
-}

--- a/core/internal/Form/Generator/Generator.php
+++ b//dev/null
@@ -1,158 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Generator;
-use Centreon\Internal\Di;
-/**
- * Description of Generator
- *
- * @author lionel
- */
-abstract class Generator
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $dbconn;
-    /**
-     *
-     * @var string 
-     */
-    protected $formName = '';
-    /**
-     *
-     * @var string 
-     */
-    protected $formRoute;
-    /**
-     *
-     * @var string 
-     */
-    protected $formRedirect;
-    /**
-     *
-     * @var string 
-     */
-    protected $formRedirectRoute;
-    /**
-     *
-     * @var array 
-     */
-    protected $formComponents = array();
-    /**
-     *
-     * @var array 
-     */
-    protected $formDefaults = array();
-    /**
-     *
-     * @var \Centreon\Internal\Form 
-     */
-    protected $formHandler;
-    /**
-     *
-     * @var type 
-     */
-    protected $firstSection;
-    /**
-     *
-     * @var array 
-     */
-    protected $extraParams;
-    /**
-     * The product version
-     *
-     * @var string
-     */
-    protected $productVersion = '';
-    /**
-     * 
-     * @param type $formRoute
-     * @param type $extraParams
-     * @param type $productVersion
-     */
-    public function __construct($formRoute, $extraParams = array(), $productVersion = '')
-    {
-        $this->formRoute = $formRoute;
-        $this->extraParams = $extraParams;
-        $this->productVersion = $productVersion;
-        $di = Di::getDefault();
-        $this->dbconn = $di->get('db_centreon');
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function getValidationScheme()
-    {
-        $validatorsScheme = $this->getValidators();
-        $validatorsScheme['mandatory'] = $this->getMandatoryFields();
-        $validationScheme = array('mandatory' => $validatorsScheme['mandatory'], 'fieldScheme' => $validatorsScheme['fieldScheme']);
-        return $validationScheme;
-    }
-    /**
-     * 
-     * @return type
-     */
-    public function getMandatoryFields()
-    {
-        $di = Di::getDefault();
-        $baseUrl = $di->get('config')->get('global', 'base_url');
-        $uri = substr($this->formRoute, strlen($baseUrl));
-        if ($uri[0] !== '/') {
-           $uri = '/' . $uri;
-        }
-        $mandatoryQuery = "SELECT name FROM cfg_forms_fields WHERE mandatory = '1' "
-            . "AND field_id IN (
-                    SELECT
-                        fi.field_id
-                    FROM
-                        cfg_forms_fields fi, cfg_forms_blocks fb, cfg_forms_blocks_fields_relations fbf, cfg_forms_sections fs, cfg_forms f
-                    WHERE
-                        fi.field_id = fbf.field_id
-                    AND
-                        fbf.block_id = fb.block_id
-                    AND
-                        fb.section_id = fs.section_id
-                    AND
-                        fs.form_id = f.form_id
-                    AND
-                        f.route = '$uri'
-            )";
-        $stmt = $this->dbconn->query($mandatoryQuery);
-        $mandatoryFieldList = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        return array_column($mandatoryFieldList, 'name');
-    }
-}

--- a/core/internal/Form/Generator/GeneratorInterface.php
+++ b//dev/null
@@ -1,41 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-/**
- *
- * @author lionel
- */
-interface GeneratorInterface
-{
-}

--- a/core/internal/Form/Generator/Web/Full.php
+++ b//dev/null
@@ -1,385 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Generator\Web;
-use Centreon\Internal\Exception;
-use Centreon\Internal\Di;
-use Centreon\Internal\Form;
-use Centreon\Internal\Form\Generator\Generator;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Full extends Generator
-{
-    /**
-     * 
-     * @param string $formRoute
-     * @param array $extraParams
-     * @param string $productVersion The version of product when form accept multi version
-     */
-    public function __construct($formRoute, $extraParams = array(), $productVersion = '')
-    {
-        parent::__construct($formRoute, $extraParams, $productVersion);
-    }
-    /**
-     * 
-     * @throws Exception
-     */
-    public function getFormFromDatabase()
-    {
-        $di = Di::getDefault();
-        $dbconn = $di->get('db_centreon');
-        $queryForm = "SELECT form_id, name, redirect, redirect_route FROM cfg_forms WHERE route = '$this->formRoute'";
-        $stmtForm = $dbconn->query($queryForm);
-        $formInfo = $stmtForm->fetchAll();
-        if (!isset($formInfo[0])) {
-            throw new Exception(sprintf('Could not find form with route %s', $this->formRoute));
-        }
-        $formId = $formInfo[0]['form_id'];
-        $this->formName = $formInfo[0]['name'];
-        $this->formRedirect = $formInfo[0]['redirect'];
-        $this->formRedirectRoute = $formInfo[0]['redirect_route'];
-        $this->formHandler = new Form($this->formName);
-        $sectionQuery = 'SELECT section_id, name '
-            . 'FROM cfg_forms_sections '
-            . 'WHERE form_id='.$formId.' '
-            . 'ORDER BY rank ASC';
-        $sectionStmt = $dbconn->query($sectionQuery);
-        $sectionList = $sectionStmt->fetchAll(\PDO::FETCH_ASSOC);
-        $firstSectionDetected = false;
-        foreach ($sectionList as $section) {
-            if (!$firstSectionDetected) {
-                $this->firstSection = $section['name'];
-                $firstSectionDetected = true;
-            }
-            $blockQuery = 'SELECT block_id, name '
-            . 'FROM cfg_forms_blocks '
-            . 'WHERE section_id='.$section['section_id'].' '
-            . 'ORDER BY rank ASC';
-            $blockStmt = $dbconn->query($blockQuery);
-            $blockList = $blockStmt->fetchAll(\PDO::FETCH_ASSOC);
-            $this->formComponents[$section['name']] = array();
-            foreach ($blockList as $block) {
-                $fieldQuery = 'SELECT '
-                    . 'f.field_id, f.name, f.label, f.default_value, f.attributes, '
-                    . 'f.type, f.help, f.help_url, f.advanced, f.mandatory, f.parent_field, '
-                    . 'f.parent_value, f.child_actions, f.child_mandatory '
-                    . 'FROM cfg_forms_fields f, cfg_forms_blocks_fields_relations bfr '
-                    . 'WHERE bfr.block_id='.$block['block_id'].' '
-		    . 'AND bfr.field_id = f.field_id ' 
-		    . "AND bfr.product_version = '" . $this->productVersion . "' " 
-                    . 'ORDER BY rank ASC';
-                $this->formComponents[$section['name']][$block['name']] = array();
-                $fieldStmt = $dbconn->query($fieldQuery);
-                $fieldList = $fieldStmt->fetchAll(\PDO::FETCH_ASSOC);
-                foreach ($fieldList as $field) {
-                    $validatorQuery = "SELECT v.route as validator_action, vr.params as params, vr.client_side_event as rules "
-                        . "FROM cfg_forms_validators v, cfg_forms_fields_validators_relations vr "
-                        . "WHERE vr.field_id = $field[field_id] "
-                        . "AND vr.validator_id = v.validator_id";
-                    $validatorStmt = $dbconn->query($validatorQuery);
-                    while ($validator = $validatorStmt->fetch()) {
-                        $validator['params'] = json_decode($validator['params'], true);
-                        $field['validators'][] = $validator;
-                    }
-                    $this->addFieldToForm($field);
-                    $this->formComponents[$section['name']][$block['name']][] = $field;
-                    if ((strstr($field['type'], 'select') === false ||
-                        strstr($field['type'], 'deprecated') === false) &&
-                        !isset($this->formDefaults[$field['name']])) {
-                        $this->formDefaults[$field['name']] = $field['default_value'];
-                    }
-                }
-                if (count($this->formComponents[$section['name']][$block['name']]) == 0) {
-                    unset($this->formComponents[$section['name']][$block['name']]);
-                }
-            }
-            if (count($this->formComponents[$section['name']]) == 0) {
-                unset($this->formComponents[$section['name']]);
-            }
-        }
-        $this->formHandler->addSubmit('save_form', _("Save"));
-    }
-    /**
-     * 
-     * @param array $field
-     */
-    protected function addFieldToForm($field)
-    {
-        switch ($field['type']) {
-            default:
-                $this->formHandler->addStatic($field, $this->extraParams);
-                break;
-        }
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function generate()
-    {
-        $di = Di::getDefault();
-        $tpl = $di->get('template');
-        $finalHtml = $this->generateHtml();
-        $tpl->assign('formRedirect', $this->formRedirect);
-        $tpl->assign('formRedirectRoute', $this->formRedirectRoute);
-        $tpl->assign('customValuesGetter', $this->formHandler->getCustomValidator());
-        return $finalHtml;
-    }
-    /**
-     * 
-     * @return \Centreon\Internal\Form
-     */
-    public function getFormHandler()
-    {
-        return $this->formHandler;
-    }
-    /**
-     * 
-     * @return type
-     */
-    public function getFormComponents()
-    {
-        return $this->formComponents;
-    }
-    /**
-     * 
-     * @return string
-     */
-    protected function generateHtml()
-    {
-        $formElements = $this->formHandler->toSmarty();
-        $htmlRendering = '<div class="form-group formWrapper">';
-        $htmlRendering .= '<div '
-            . 'class="bs-callout bs-callout-success" '
-            . 'id="formSuccess" '
-            . 'style="display: none;">'
-            . 'The object has been successfully updated'
-            . '</div>';
-        $htmlRendering .= '<div '
-            . 'class="bs-callout bs-callout-danger" '
-            . 'id="formError" '
-            . 'style="display: none;">'
-            . 'An error occured'
-            . '</div>';
-        $htmlRendering .= '<form class="form-horizontal" role="form" '.$formElements['attributes'].' novalidate>';
-        $formRendering = '';
-        $tabRendering = '<div class="form-tabs-header">'
-            . '<div class="col-md-12">'
-            . '<ul class="nav nav-tabs" id="formHeader">';
-        $first = true;
-        foreach ($this->formComponents as $sectionLabel => $sectionComponents) {
-            $tabRendering .= '<li';
-            if ($first) {
-                $first = false;
-                $tabRendering .= ' class="active"';
-            }
-            $tabRendering .= '>'
-                . '<a '
-                . 'href="#'.str_replace(' ', '', $sectionLabel).'" '
-                . 'data-toggle="tab">'
-                .$sectionLabel
-                .'</a>'
-                . '</li>';
-        }
-        $formRendering .= '</ul></div>' // end col-md-12
-            . '</div>'; // end form-tabs-header
-        $formRendering .= '<div class="tab-content">';
-        $first = true;
-        foreach ($this->formComponents as $sectionLabel => $sectionComponents) {
-            $formRendering .= '<div class="tab-pane';
-            if ($first) {
-                $first = false;
-                $formRendering .= ' active';
-            }
-            $formRendering .= '" id="'.str_replace(' ', '', $sectionLabel).'">';
-            foreach ($sectionComponents as $blockLabel => $blockComponents) {
-                $formRendering .= '<h4 class="page-header" style="padding-top:0px;">'.$blockLabel.'</h4>';
-                $formRendering .= '<div class="panel-body">';
-                foreach ($blockComponents as $component) {
-                    if (isset($formElements[$component['name']]['html'])) {
-                        $formRendering .= '<div class="col-xs-12 col-sm-8">';
-                        $formRendering .= $formElements[$component['name']]['html'];
-                        $formRendering .= '</div>'
-                            . '<div class="clearfix visible-xs-block"></div>'
-                            . '<div class="col-xs-12 col-sm-4';
-                        if ($component['advanced'] == '1') {
-                            $formRendering .= ' advanced';
-                        }
-                        $formRendering .= '">'
-                            . '<span class="inheritance" id="' . $component['name'] . '_inheritance"></span>'
-                            . '</div>';
-                    }
-                }
-                $formRendering .= '</div>';
-            }
-            $formRendering .= '</div>';
-        }
-        $formRendering .= '</div>';
-        $formRendering .= '<div>'.$formElements['save_form']['html'].'</div>';
-        $formRendering .= $formElements['hidden'];
-        $htmlRendering .= $tabRendering.$formRendering.'</form></div>';
-        return $htmlRendering;
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function getName()
-    {
-        return $this->formName;
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function getRedirect()
-    {
-        return $this->formRedirect;
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function getRedirectRoute()
-    {
-        return $this->formRedirectRoute;
-    }
-    /**
-     * 
-     * @param string $name
-     * @param string $value
-     */
-    public function addHiddenComponent($name, $value)
-    {
-        $this->formHandler->addHidden($name, $value);
-    }
-    /**
-     * 
-     * @param array $defaultValues
-     */
-    public function setDefaultValues($defaultValues, $objectId = "")
-    {
-        if (is_string($defaultValues)) {
-            $objectColumns = $defaultValues::getColumns();
-            $fields = implode(',', array_intersect($objectColumns, array_keys($this->formDefaults)));
-            $myValues = $defaultValues::getParameters($objectId, $fields);
-            foreach ($myValues as $key => &$value) {
-                if (is_null($value)) {
-                    $value = $this->formDefaults[$key];
-                }
-            }
-            $this->formHandler->setDefaults(array_merge($myValues, array_diff_key($this->formDefaults, $myValues)));
-        } elseif (is_array($defaultValues)) {
-            foreach ($defaultValues as $k => $v) {
-                $this->formDefaults[$k] = $v;
-            }
-            $this->formHandler->setDefaults($defaultValues);
-        }
-    }
-    /**
-     *
-     * @param array $param
-     */
-    public function setValues($defaultValue, $objectId = "", $params)
-    {
-        $objectColumns = $defaultValue::getColumns();
-        $fields = implode(',', array_intersect($objectColumns, array_keys($this->formDefaults)));
-        $myValues = $defaultValue::getParameters($objectId, $fields);
-        foreach ($params as $key => $value) {
-            $myValues[$key] = $value;
-        }
-        $this->formHandler->setDefaults(array_merge($myValues, array_diff_key($this->formDefaults, $myValues)));
-    }
-    /**
-     * 
-     * @param type $origin
-     * @param type $uri
-     */
-    public function getValidators()
-    {
-        $validatorsQuery = $this->buildValidatorsQuery();
-        $stmt = $this->dbconn->query($validatorsQuery);
-        $validatorsRawList = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        $validatorsFinalList = array();
-        foreach ($validatorsRawList as $validator) {
-            $validatorsFinalList[$validator['field_name']][] = array(
-                'call' => $validator['validator_name'],
-                'params' => $validator['params']
-            );
-        }
-        return array('fieldScheme' => $validatorsFinalList);
-    }
-    /**
-     * 
-     * @return type
-     */
-    protected function buildValidatorsQuery()
-    {
-        $di = Di::getDefault();
-        $baseUrl = $di->get('config')->get('global', 'base_url');
-        $uri = substr($this->formRoute, strlen($baseUrl));
-        $validatorsQuery = "SELECT
-                fv.`name` as validator_name, `route` as `validator`, ffv.`params` as `params`,
-                ff.`name` as `field_name`, ff.`label` as `field_label`
-            FROM
-                cfg_forms_validators fv, cfg_forms_fields_validators_relations ffv, cfg_forms_fields ff
-            WHERE
-                ffv.validator_id = fv.validator_id
-            AND
-                ffv.server_side = '1'
-            AND
-                ff.field_id = ffv.field_id
-            AND
-                ffv.field_id IN (
-                    SELECT
-                        fi.field_id
-                    FROM
-                        cfg_forms_fields fi, cfg_forms_blocks fb, cfg_forms_blocks_fields_relations fbf, cfg_forms_sections fs, cfg_forms f
-                    WHERE
-                        fi.field_id = fbf.field_id
-                    AND
-                        fbf.block_id = fb.block_id
-                    AND
-                        fb.section_id = fs.section_id
-                    AND
-                        fs.form_id = f.form_id
-                    AND
-                        f.route = '$uri'
-            );";
-        return $validatorsQuery;
-    }
-}

--- a/core/internal/Form/Generator/Web/Wizard.php
+++ b//dev/null
@@ -1,155 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Generator\Web;
-use Centreon\Internal\Di;
-use Centreon\Internal\Form;
-/**
- * Manage wizard for object
- *
- * @author Maximilien Bersoult <mbersoult@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Wizard extends Full
-{
-    /**
-     * Constructor
-     *
-     * @see \Centreon\Internal\Form\Generator\Web\Full::__construct
-     */
-    public function __construct($formRoute, $extraParams = array())
-    {
-        parent::__construct($formRoute, $extraParams);
-    }
-    /**
-     * Load wizard information from database
-     */
-    public function getFormFromDatabase()
-    {
-        $di = Di::getDefault();
-        $dbconn = $di->get('db_centreon');
-        $route = $this->formRoute;
-        /*$baseUrl = rtrim($di->get('config')->get('global', 'base_url'), '/');
-        $route = str_replace($baseUrl, '', $route);*/
-        $query = "SELECT f.field_id as field_id, w.name as wizard_name, s.name as step_name, 
-            s.rank as step_rank, f.mandatory as mandatory, f.parent_field as parent_field, f.parent_value as parent_value,
-            f.child_mandatory as child_mandatory, f.child_actions as child_actions, sf.rank as field_pos,
-            f.name as name, f.label, f.default_value, f.attributes, f.type, f.help
-            FROM cfg_forms_wizards w, cfg_forms_steps s, cfg_forms_steps_fields_relations sf, cfg_forms_fields f
-            WHERE w.route = :route
-                AND w.wizard_id = s.wizard_id
-                AND s.step_id = sf.step_id
-                AND sf.field_id = f.field_id
-            ORDER BY s.rank, sf.rank";
-        $stmt = $dbconn->prepare($query);
-        $stmt->bindParam(':route', $route);
-        $stmt->execute();
-        while ($row = $stmt->fetch()) {
-            $validatorQuery = "SELECT v.route as validator_action, vr.params as params, vr.client_side_event as rules "
-                        . "FROM cfg_forms_validators v, cfg_forms_fields_validators_relations vr "
-                        . "WHERE vr.field_id = $row[field_id] "
-                        . "AND vr.validator_id = v.validator_id";
-            $validatorStmt = $dbconn->query($validatorQuery);
-            while ($validator = $validatorStmt->fetch()) {
-                $validator['params'] = json_decode($validator['params'], true);
-                $row['validators'][] = $validator;
-            }
-            if ('' === $this->formName) {
-                $this->formName = $row['wizard_name'];
-                $this->formHandler = new Form($this->formName);
-            }
-            if (false === isset($this->formComponents[$row['step_name']])) {
-                $this->formComponents[$row['step_name']] = array();
-                $this->formComponents[$row['step_name']]['default'] = array();
-            }
-            $this->formDefaults[$row['name']] = $row['default_value'];
-            $this->addFieldToForm($row);
-            $this->formComponents[$row['step_name']]['default'][] = $row;
-        }
-    }
-    /**
-     * 
-     * @return type
-     */
-    protected function buildValidatorsQuery()
-    {
-        $di = Di::getDefault();
-        $baseUrl = $di->get('config')->get('global', 'base_url');
-        $uri = substr($this->formRoute, strlen($baseUrl));
-        $validatorsQuery = "SELECT
-                        fv.`name` as validator_name, `route` as `validator`, ffv.`params` as `params`,
-                        ff.`name` as `field_name`, ff.`label` as `field_label`
-                    FROM
-                        cfg_forms_validators fv, cfg_forms_fields_validators_relations ffv, cfg_forms_fields ff
-                    WHERE
-                        ffv.validator_id = fv.validator_id
-                    AND
-                        ffv.server_side = '1'
-                    AND
-                        ff.field_id = ffv.field_id
-                    AND
-                        ffv.field_id IN (
-                            SELECT
-                                fi.field_id
-                            FROM
-                                cfg_forms_fields fi, cfg_forms_steps fs, cfg_forms_steps_fields_relations fsf, cfg_forms_wizards fw
-                            WHERE
-                                fi.field_id = fsf.field_id
-                            AND
-                                fsf.step_id = fs.step_id
-                            AND
-                                fs.wizard_id = fw.wizard_id
-                            AND
-                                fw.route = '$uri'
-                    );";
-        return $validatorsQuery;
-    }
-    /**
-     * Return the wizard HTML
-     * @return string
-     */
-    protected function generateHtml()
-    {
-        /* Set default values to quickform */
-        $this->formHandler->setDefaults($this->formDefaults);
-        $formElements = $this->formHandler->toSmarty();
-        $di = Di::getDefault();
-        $tpl = $di->get('template');
-        $tpl->assign('name', $this->formName);
-        $tpl->assign('formElements', $formElements);
-        $tpl->assign('steps', $this->formComponents);
-        return $tpl->fetch('tools/modalWizard.tpl');
-    }
-}

--- a/core/internal/Form/Generator/Widget.php
+++ b//dev/null
@@ -1,246 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Generator;
-use CentreonCustomview\Repository\WidgetRepository;
-use CentreonCustomview\Repository\CustomviewRepository;
-use Centreon\Internal\Di;
-use Centreon\Internal\Form;
-use Centreon\Internal\Form\Generator\Generator;
-/**
- * Manage widget settings
- *
- * @author Sylvetre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Widget extends Generator
-{
-    /**
-     * Constructor
-     *
-     * @see \Centreon\Form\Generator::__construct
-     */
-    public function __construct($widgetId, $extraParams = array())
-    {
-        parent::__construct($widgetId, $extraParams);
-    }
-    /**
-     * Convert type
-     *
-     * @param array $data
-     * @return array
-     */
-    protected function convertType($data)
-    {
-        $db = Di::getDefault()->get('db_centreon');
-        $attr = array();
-        switch ($data['type']) {
-            case 'list':
-                $type = 'select';
-                $res = WidgetRepository::getParameterOptions($data['parameter_id']);
-                $options = array();
-                $i = 0;
-                $preferences = array();
-                foreach ($res as $id => $name) {
-                    $options[$i]['id'] = $id;
-                    $options[$i]['text'] = $name;
-                    if ($data['preference_value'] == $id) {
-                        $preferences = $options[$i];
-                    }
-                    $i++;
-                }
-                $attr = json_encode(
-                    array(
-                        'selectData' => json_encode($options),
-                        'selectDefault' => json_encode($preferences)
-                    )
-                );
-                break;
-            case 'boolean':
-                $type = 'checkbox';
-                $attr = json_encode(array('choices' => array(null => 1)));
-                break;
-            case 'hidden':
-                $type = 'text';
-                break;
-            case 'range':
-                $type = 'text';
-                break;
-            case 'compare':
-                $type = 'text';
-                break;
-            case 'sort':
-                $type = 'text';
-                break;
-            case 'date':
-                $type = 'text';
-                break;
-            case 'host':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/host/formlist'
-                    )
-                );
-                break;
-            case 'hostTemplate':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/hosttemplate/formlist'
-                    )
-                );
-                break;
-            case 'serviceTemplate':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/servicetemplate/formlist'
-                    )
-                );
-                break;
-            case 'hostgroup':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/hostgroup/formlist'
-                    )
-                );
-                break;
-            case 'servicegroup':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/servicegroup/formlist'
-                    )
-                );
-                break;
-            case 'service':
-                $type = 'select';
-                $attr = json_encode(
-                    array(
-                        'object_type' => 'object',
-                        'defaultValuesRoute' => '/centreon-configuration/service/formlist'
-                    )
-                );
-                break;
-            default:
-                $type = 'text';
-                break;
-        }
-        return array($type, $attr);
-    }
-    /**
-     * Load wizard information from database
-     */
-    protected function getFormFromDatabase()
-    {
-        $di = Di::getDefault();
-        $dbconn = $di->get('db_centreon');
-        $widgetId = $this->formRoute;
-        $baseUrl = $di->get('config')->get('global', 'base_url');
-        $query = "SELECT w.title as wizard_name, header_title, parameter_name as label, wp.is_filter,
-            parameter_code_name as name, default_value, ft_typename as type, is_connector,
-            wp.parameter_id, wr.preference_value, wr.comparator
-            FROM cfg_widgets w, cfg_widgets_models wm, cfg_widgets_parameters_fields_types ft, cfg_widgets_parameters wp
-            LEFT JOIN cfg_widgets_preferences wr ON (wr.parameter_id = wp.parameter_id AND wr.widget_id = :widget_id)
-            WHERE w.widget_id = :widget_id
-            AND w.widget_model_id = wm.widget_model_id
-            AND wm.widget_model_id = wp.widget_model_id
-            AND wp.field_type_id = ft.field_type_id
-            ORDER BY parameter_order";
-        $stmt = $dbconn->prepare($query);
-        $stmt->bindParam(':widget_id', $widgetId);
-        $stmt->execute();
-        $header = _("Settings");
-        while ($row = $stmt->fetch()) {
-            if ('' === $this->formName) {
-                $this->formName = $row['wizard_name'];
-                $this->formHandler = new Form($this->formName);
-            }
-            if ($row['header_title'] && !isset($this->formComponents[$row['header_title']])) {
-                $this->formComponents[$row['header_title']] = array();
-                $this->formComponents[$row['header_title']]['default'] = array();
-                $header = $row['header_title'];
-            }
-            $this->formDefaults[$row['name']] = $row['preference_value'];
-            $row['mandatory'] = 0;
-            if (!$row['is_filter']) {
-                list($row['type'], $row['attributes']) = $this->convertType($row);
-            } else {
-                $tmp = $row;
-                $tmp['type'] = 'text';
-                $tmp['name'] = 'cmp-'.$row['name'];
-                $tmp['label'] = $row['comparator'];
-                $this->addFieldToForm($tmp);
-                $this->formComponents[$header]['default'][] = $tmp;
-                $row['type'] = 'text';
-                $row['attributes'] = array();
-            }
-            $this->addFieldToForm($row);
-            $this->formComponents[$header]['default'][] = $row;
-        }
-    }
-    /**
-     * Return the wizard HTML
-     * @return string
-     */
-    protected function generateHtml()
-    {
-        /* Set default values to quickform */
-        $this->formHandler->setDefaults($this->formDefaults);
-        $formElements = $this->formHandler->toSmarty();
-        $di = Di::getDefault();
-        $tpl = $di->get('template');
-        $tpl->assign('name', $this->formName);
-        $tpl->assign('formElements', $formElements);
-        $tpl->assign('steps', $this->formComponents);
-        $options[CustomviewRepository::EQUAL] = _('equal');
-        $options[CustomviewRepository::NOT_EQUAL] = _('not equal');
-        $options[CustomviewRepository::CONTAINS] = _('contains');
-        $options[CustomviewRepository::NOT_CONTAINS] = _('not contains');
-        $options[CustomviewRepository::GREATER] = _('greater than');
-        $options[CustomviewRepository::GREATER_EQUAL] = _('greater or equal');
-        $options[CustomviewRepository::LESSER] = _('lesser than');
-        $options[CustomviewRepository::LESSER_EQUAL] = _('lesser or equal');
-        $tpl->assign('cmpOptions', $options);
-        return $tpl->fetch('tools/modalWidget.tpl');
-    }
-}

--- a/core/internal/Form/Install/Installer.php
+++ b//dev/null
@@ -1,762 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal\Form\Install;
-class Installer
-{
-    protected static $forms;
-    protected static $sections;
-    protected static $blocks;
-    protected static $fields;
-    protected static $blockFields;
-    protected static $steps;
-    protected static $wizards;
-    protected static $stepFields;
-    protected static $validators;
-    /**
-     * Init arrays
-     *
-     * @param string $formName
-     * @param string $wizardName
-     */
-    public static function initForm($formName)
-    {
-        $sql = "SELECT f.form_id, f.name as form_name, 
-            s.section_id, s.name as section_name, 
-            b.block_id, b.name as block_name,
-            d.field_id, d.name as field_name
-            FROM cfg_forms f, cfg_forms_sections s, cfg_forms_blocks b, cfg_forms_fields d, cfg_forms_blocks_fields_relations r
-            WHERE f.form_id = s.form_id
-            AND s.section_id = b.section_id
-            AND b.block_id = r.block_id
-            AND r.field_id = d.field_id
-            AND f.name = ?";
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $stmt = $db->prepare($sql);
-        $stmt->execute(array($formName));
-        $rows = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        self::$forms = array();
-        self::$sections = array();
-        self::$blocks = array();
-        self::$fields = array();
-        self::$blockFields = array();
-        foreach ($rows as $row) {
-            $form_key = $row['form_name'];
-            $section_key = $form_key . ';' . $row['section_name'];
-            $block_key = $section_key . ';' . $row['block_name'];
-            $field_key = $row['field_name'];
-            $block_field_key = $block_key . ';' . $row['field_name'];
-            if (!isset(self::$forms[$form_key])) {
-                self::$forms[$form_key] = $row['form_id'];
-            }
-            if (!isset(self::$sections[$section_key])) {
-                self::$sections[$section_key] = $row['section_id'];
-            }
-            if (!isset(self::$blocks[$block_key])) {
-                self::$blocks[$block_key] = $row['block_id'];
-            }
-            if (!isset(self::$fields[$field_key])) {
-                self::$fields[$field_key] = $row['field_id'];
-            }
-            if (!isset(self::$blockFields[$block_field_key])) {
-                self::$blockFields[$block_field_key] = $row['block_id'] . ';' . $row['field_id'];
-            }
-        }
-    }
-    public static function initValidators()
-    {
-        self::$validators = array();
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $stmt = $db->query("SELECT validator_id, name FROM cfg_forms_validators");
-        $rows = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        foreach ($rows as $row) {
-            self::$validators[$row['name']] = $row['validator_id'];
-        }
-    }
-    /**
-     * Init arrays
-     *
-     * @param string $wizardName
-     */
-    public static function initWizard($wizardName)
-    {
-        $sql = "SELECT w.wizard_id, w.name as wizard_name, 
-            s.step_id, s.name as step_name,
-            d.field_id, d.name as field_name
-            FROM cfg_forms_wizards w, cfg_forms_steps s, cfg_forms_steps_fields_relations r, cfg_forms_fields d
-            WHERE w.wizard_id = s.wizard_id
-            AND s.step_id = r.step_id
-            AND r.field_id = d.field_id
-            AND w.name = ?";
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $stmt = $db->prepare($sql);
-        $stmt->execute(array($wizardName));
-        $rows = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        self::$wizards = array();
-        self::$steps = array();
-        self::$stepFields = array();
-        foreach ($rows as $row) {
-            $wizard_key = $row['wizard_name'];
-            $step_key = $wizard_key . ';' . $row['step_name'];
-            $field_key = $row['field_name'];
-            $step_field_key = $step_key . ';' . $row['field_name'];
-            if (!isset(self::$wizards[$wizard_key])) {
-                self::$wizards[$wizard_key] = $row['wizard_id'];
-            }
-            if (!isset(self::$steps[$step_key])) {
-                self::$steps[$step_key] = $row['step_id'];
-            }
-            if (!isset(self::$stepFields[$step_field_key])) {
-                self::$stepFields[$step_field_key] = $row['step_id'] . ';' . $row['field_id'];
-            }
-        }
-    }
-    /**
-     * Insert a form into db
-     *
-     * @param array $data
-     */
-    public static function insertForm($data, $moduleId)
-    {
-        $key = $data['name'];
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$forms[$key])) {
-            $sql = 'INSERT INTO cfg_forms (name, route, redirect, redirect_route, module_id) 
-              VALUES (:name, :route, :redirect, :redirect_route, :module)';
-        } else {
-            $sql = 'UPDATE cfg_forms SET route = :route,
-                redirect = :redirect,
-                redirect_route = :redirect_route
-                WHERE name = :name
-                AND module_id = :module';
-        }
-        $stmt = $db->prepare($sql);
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':route', $data['route']);
-        $stmt->bindParam(':redirect', $data['redirect']);
-        $stmt->bindParam(':redirect_route', $data['redirect_route']);
-        $stmt->bindParam(':module', $moduleId);
-        $stmt->execute();
-        if (!isset(self::$forms[$key])) {
-            self::$forms[$key] = $db->lastInsertId('cfg_forms', 'form_id');
-        }
-    }
-    /**
-     * Insert section into db
-     *
-     * @param array $data
-     */
-    public static function insertSection($data)
-    {
-        $key = $data['form_name'] . ';' . $data['name'];
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$sections[$key])) {
-            $sql = 'INSERT INTO cfg_forms_sections (name, rank, form_id) 
-                VALUES (:name, :rank, :form_id)';
-        } else {
-            $sql = 'UPDATE cfg_forms_sections SET rank = :rank,
-                form_id = :form_id
-                WHERE name = :name
-                AND section_id = :section_id';
-        }
-        $stmt = $db->prepare($sql);
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':rank', $data['rank'], \PDO::PARAM_INT);
-        if (isset(self::$sections[$key])) {
-            $stmt->bindParam(':section_id', $sections[$key]);
-        }
-        $stmt->bindParam(':form_id', self::$forms[$data['form_name']], \PDO::PARAM_INT);
-        $stmt->execute();
-        if (!isset(self::$sections[$key])) {
-            self::$sections[$key] = $db->lastInsertId('cfg_forms_sections', 'section_id');
-        }
-    }
-    /**
-     * Insert block into db
-     *
-     * @param array $data
-     */
-    public static function insertBlock($data)
-    {
-        $sectionKey = $data['form_name'] . ';' . $data['section_name'];
-        $key = implode(';', array($data['form_name'], $data['section_name'], $data['name']));
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$blocks[$key])) {
-            $sql = 'INSERT INTO cfg_forms_blocks (name, rank, section_id) 
-                VALUES (:name, :rank, :section_id)';
-        } else {
-            $sql = 'UPDATE cfg_forms_blocks SET rank = :rank,
-                section_id = :section_id
-                WHERE name = :name
-                AND block_id = :block_id';
-        }
-        $stmt = $db->prepare($sql);
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':rank', $data['rank'], \PDO::PARAM_INT);
-        if (isset(self::$blocks[$key])) {
-            $stmt->bindParam(':block_id', self::$blocks[$key]);
-        }
-        $stmt->bindParam(':section_id', self::$sections[$sectionKey], \PDO::PARAM_INT);
-        $stmt->execute();
-        if (!isset(self::$blocks[$key])) {
-            self::$blocks[$key] = $db->lastInsertId('cfg_forms_blocks', 'block_id');
-        }
-    }
-    /**
-     * Insert field into db
-     *
-     * @param array $data
-     */
-    public static function insertField($data)
-    {
-        $key = $data['name'];
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$fields[$key])) {
-            $sql = 'INSERT INTO cfg_forms_fields 
-                (name, label, default_value, attributes, advanced, type, 
-                help, module_id, parent_field, parent_value, child_actions, mandatory, child_mandatory) VALUES 
-                (:name, :label, :default_value, :attributes, :advanced, 
-                :type, :help, :module_id, :parent_field, :parent_value, :child_actions, :mandatory, :child_mandatory)';
-        } else {
-            $sql = 'UPDATE cfg_forms_fields SET label = :label,
-                default_value = :default_value,
-                attributes = :attributes,
-                advanced = :advanced,
-                type = :type,
-                help = :help,
-                module_id = :module_id,
-                parent_field = :parent_field,
-                parent_value = :parent_value,
-                child_actions = :child_actions
-                mandatory = :mandatory
-                child_mandatory = :child_mandatory
-                WHERE name = :name
-                AND field_id = :field_id';
-        }
-        $stmt = $db->prepare($sql);
-        if (isset(self::$fields[$key])) {
-            $stmt->bindParam(':field_id', self::$fields[$key]);
-        }
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':label', $data['label']);
-        $stmt->bindParam(':default_value', $data['default_value']);
-        $stmt->bindParam(':attributes', $data['attributes']);
-        $stmt->bindParam(':advanced', $data['advanced']);
-        $stmt->bindParam(':type', $data['type']);
-        $stmt->bindParam(':help', $data['help']);
-        $stmt->bindParam(':module_id', $data['module_id']);
-        $stmt->bindParam(':parent_field', $data['parent_field']);
-        $stmt->bindParam(':child_actions', $data['child_actions']);
-        if (!isset($data['mandatory'])) {
-            $data['mandatory'] = '0';
-        }
-        $stmt->bindParam(':mandatory', $data['mandatory']);
-        if (!isset($data['child_mandatory'])) {
-            $data['child_mandatory'] = '0';
-        }
-        $stmt->bindParam(':child_mandatory', $data['child_mandatory']);
-        if (!isset($data['parent_value'])) {
-            $data['parent_value'] = null;
-        }
-        $stmt->bindParam(':parent_value', $data['parent_value']);
-        $stmt->execute();
-        if (!isset(self::$fields[$key])) {
-            self::$fields[$key] = $db->lastInsertId('cfg_forms_fields', 'field_id');
-        }
-    }
-    /**
-     * Add field to a block
-     *
-     * @param array $data
-     */
-    public static function addFieldToBlock($data)
-    {
-        $fname = $data['field_name'];
-        $key = implode(';', array($data['form_name'], $data['section_name'], $data['block_name']));
-        if (isset(self::$blocks[$key]) && isset(self::$fields[$fname])) {
-            $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-            $stmt = $db->prepare(
-                'DELETE FROM cfg_forms_blocks_fields_relations WHERE block_id = :block_id AND field_id = :field_id'
-            );
-            $stmt->bindParam(':block_id', self::$blocks[$key]);
-            $stmt->bindParam(':field_id', self::$fields[$fname]);
-            $stmt->execute();
-            foreach ($data['versions'] as $version) {
-                $stmt = $db->prepare(
-                    'REPLACE INTO cfg_forms_blocks_fields_relations (block_id, field_id, rank, product_version) '
-                    . 'VALUES (:block_id, :field_id, :rank, :product_version)'
-                );
-                $stmt->bindParam(':block_id', self::$blocks[$key]);
-                $stmt->bindParam(':field_id', self::$fields[$fname]);
-                $stmt->bindParam(':rank', $data['rank']);
-                $stmt->bindParam(':product_version', $version);
-                $stmt->execute();
-            }
-        }
-        $tmp = $key . ';' . $fname;
-        self::$blockFields[$tmp] = self::$blocks[$key] . ';' . self::$fields[$fname];
-    }
-    /**
-     * 
-     * @param type $data
-     */
-    public static function addValidatorsToField($data)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $fname = (string)$data['field_name'];
-        $validators = $data['validators'];
-        if (isset(self::$fields[$fname]) && !is_null($validators->validator)) {
-            foreach ($validators->validator as $validator) {
-                if (isset($validator['serverside'])) {
-                    $serverside = (string)$validator['serverside'];
-                } else {
-                    $serverside = null;
-                }
-                if (isset(self::$validators[$serverside])) {
-                    $stmt = $db->prepare(
-                        'DELETE FROM cfg_forms_fields_validators_relations '
-                        . 'WHERE validator_id = :validator_id AND field_id = :field_id'
-                    );
-                    $stmt->bindParam(':validator_id', self::$validators[$serverside]);
-                    $stmt->bindParam(':field_id', self::$fields[$fname]);
-                    $stmt->execute();
-                    $stmt = $db->prepare(
-                        'REPLACE INTO cfg_forms_fields_validators_relations (validator_id, field_id, client_side_event, params, server_side) '
-                        . 'VALUES (:validator_id, :field_id, :client_side_event, :params, :server_side)'
-                    );
-                    $stmt->bindParam(':validator_id', self::$validators[$serverside]);
-                    $stmt->bindParam(':field_id', self::$fields[$fname]);
-                    $stmt->bindValue(':client_side_event', (string)$validator['rules']);
-                    if (is_null($serverside)) {
-                        $stmt->bindValue(':server_side', '0');
-                    } else {
-                        $stmt->bindValue(':server_side', '1');
-                    }
-                    unset($validator['rules']);
-                    $validatorParams = array();
-                    foreach ($validator->argument as $argument) {
-                        $validatorName = (string)$argument['name'];
-                        $validatorValue = (string)$argument;
-                        $validatorParams[$validatorName] = $validatorValue;
-                    }
-                    $stmt->bindParam(':params', json_encode($validatorParams));
-                    $stmt->execute();
-                }
-            }
-        }
-    }
-    /**
-     * Install form from XML string
-     *
-     * @param string $xmlFile
-     */
-    public static function installFromXml($moduleId, $xmlFile = "")
-    {
-        $xml = simplexml_load_file($xmlFile);
-        foreach ($xml as $form) {
-            if ($form->getName() == 'form') {
-                self::processForm($form, $moduleId);
-            } elseif ($form->getName() == 'wizard') {
-                self::processWizard($form, $moduleId);
-            }
-        }
-    }
-    /**
-     * Insert wizard
-     *
-     * @param array $data
-     */
-    protected static function insertWizard($data, $moduleId)
-    {
-        $key = $data['name'];
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$wizards[$key])) {
-            $sql = 'INSERT INTO cfg_forms_wizards (name, route, module_id) 
-              VALUES (:name, :route, :module)';
-        } else {
-            $sql = 'UPDATE cfg_forms_wizards SET route = :route
-                WHERE name = :name 
-                AND wizard_id = :wizard_id
-                AND module_id = :module';
-        }
-        $stmt = $db->prepare($sql);
-        if (isset(self::$wizards[$key])) {
-            $stmt->bindParam(':wizard_id', self::$wizards[$key]);
-        }
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':route', $data['route']);
-        $stmt->bindParam(':module', $moduleId);
-        $stmt->execute();
-        if (!isset(self::$wizards[$key])) {
-            self::$wizards[$key] = $db->lastInsertId('cfg_forms_wizards', 'wizard_id');
-        }
-    }
-    /**
-     * Insert step
-     *
-     * @param array $data
-     */
-    protected static function insertStep($data)
-    {
-        $key = implode(';', array($data['wizard_name'], $data['name']));
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        if (!isset(self::$steps[$key])) {
-            $sql = 'INSERT INTO cfg_forms_steps (name, rank, wizard_id) 
-                VALUES (:name, :rank, :wizard_id)';
-        } else {
-            $sql = 'UPDATE cfg_forms_steps SET rank = :rank,
-                wizard_id = :wizard_id
-                WHERE name = :name
-                AND step_id = :step_id';
-        }
-        $stmt = $db->prepare($sql);
-        if (isset(self::$steps[$key])) {
-            $stmt->bindParam(':step_id', self::$steps[$key]);
-        }
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':rank', $data['rank'], \PDO::PARAM_INT);
-        $stmt->bindParam(':wizard_id', self::$wizards[$data['wizard_name']], \PDO::PARAM_INT);
-        $stmt->execute();
-        if (!isset(self::$steps[$key])) {
-            self::$steps[$key] = $db->lastInsertId('cfg_forms_steps', 'step_id');
-        }
-    }
-    /**
-     * Add field to step
-     *
-     * @param array $data
-     */
-    protected static function addFieldToStep($data)
-    {
-        $fname = $data['field_name'];
-        $key = implode(';', array($data['wizard_name'], $data['step_name']));
-        if (isset(self::$steps[$key]) && isset(self::$fields[$fname])) {
-            $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-            $stmt = $db->prepare(
-                'REPLACE INTO cfg_forms_steps_fields_relations (step_id, field_id, rank) '
-                . 'VALUES (:step_id, :field_id, :rank)'
-            );
-            $stmt->bindParam(':step_id', self::$steps[$key]);
-            $stmt->bindParam(':field_id', self::$fields[$fname]);
-            $stmt->bindParam(':rank', $data['rank']);
-            $stmt->execute();
-        }
-        $tmp = $key . ';' . $fname;
-        self::$stepFields[$tmp] = self::$steps[$key] . ';' . self::$fields[$fname];
-    }
-    /**
-     * Process wizard
-     *
-     * @param SimpleXMLElement $wizard
-     */
-    protected static function processWizard($wizard, $moduleId)
-    {
-        $insertedSteps = array();
-        $insertedFields = array();
-        self::initWizard($wizard['name']);
-        self::initValidators();
-        $wizardData = array(
-            'name' => $wizard['name'],
-            'route' => $wizard->route
-        );
-        self::insertWizard(array_map('strval', $wizardData), $moduleId);
-        $stepRank = 1;
-        foreach ($wizard->step as $step) {
-            $stepData = array(
-                'name' => $step['name'],
-                'wizard_name' => $wizard['name'],
-                'rank' => $stepRank
-            );
-            self::insertStep(array_map('strval', $stepData));
-            $stepRank++;
-            $fieldRank = 1;
-            foreach ($step->field as $field) {
-                $stepFieldData = array(
-                    'wizard_name' => $wizard['name'],
-                    'step_name' => $step['name'],
-                    'field_name' => $field['name'],
-                    'rank' => $fieldRank
-                );
-                self::addFieldToStep(array_map('strval', $stepFieldData));
-                $fieldValidators = array(
-                    'field_name' => $field['name'],
-                    'validators' => $field->validators
-                );
-                self::addValidatorsToField($fieldValidators);
-                $fieldRank++;
-                $insertedFields[] = implode(';', array($wizard['name'], $step['name'], $field['name']));
-            }
-            $insertedSteps[] = implode(';', array($wizard['name'], $step['name']));
-        }
-        self::purgeSteps($insertedSteps);
-        self::purgeStepFields($insertedFields);
-    }
-    /**
-     * Process form
-     *
-     * @param SimpleXMLElement $form
-     */
-    protected static function processForm($form, $moduleId)
-    {
-        $insertedSections = array();
-        $insertedBlocks = array();
-        $insertedFields = array();
-        self::initForm($form['name']);
-        self::initValidators();
-        $formData = array(
-            'name' => $form['name'],
-            'route' => $form->route,
-            'redirect' => $form->redirect,
-            'redirect_route' => $form->redirect_route
-        );
-        self::insertForm(array_map('strval', $formData), $moduleId);
-        $sectionRank = 1;
-        foreach ($form->section as $section) {
-            $sectionData = array(
-                'name' => $section['name'],
-                'form_name' => $form['name'],
-                'rank' => $sectionRank
-            );
-            self::insertSection(array_map('strval', $sectionData));
-            $sectionRank++;
-            $blockRank = 1;
-            foreach ($section->block as $block) {
-                $blockData = array(
-                    'name' => $block['name'],
-                    'form_name' => $form['name'],
-                    'section_name' => $section['name'],
-                    'rank' => $blockRank
-                );
-                self::insertBlock(array_map('strval', $blockData));
-                $blockRank++;
-                $fieldRank = 1;
-                foreach ($block->field as $field) {
-                    $attributes = array();
-                    $versions = array('');
-                    if (isset($field->attributes)) {
-                        $attributes = self::parseAttributes($field->attributes);
-                    }
-                    if (isset($field->versions)) {
-                        $versions = self::parseVersions($field->versions);
-                    }
-                    $attributes = json_encode($attributes);
-                    $fieldData = array(
-                        'name' => $field['name'],
-                        'label' => $field['label'],
-                        'default_value' => $field['default_value'],
-                        'advanced' => $field['advanced'],
-                        'type' => $field['type'],
-                        'parent_field' => $field['parent_field'],
-                        'module_id' => $moduleId,
-                        'child_actions' => $field->child_actions,
-                        'attributes' => $attributes,
-                        'mandatory' => $field['mandatory'],
-                        'help' => $field->help,
-                    );
-                    self::insertField(array_map('strval', $fieldData));
-                    $blockFieldData = array(
-                        'form_name' => strval($form['name']),
-                        'section_name' => strval($section['name']),
-                        'block_name' => strval($block['name']),
-                        'field_name' => strval($field['name']),
-                        'rank' => $fieldRank,
-                        'versions' => $versions
-                    );
-                    self::addFieldToBlock($blockFieldData);
-                    $fieldValidators = array(
-                        'field_name' => $field['name'],
-                        'validators' => $field->validators
-                    );
-                    self::addValidatorsToField($fieldValidators);
-                    $fieldRank++;
-                    $insertedFields[] = implode(
-                        ';',
-                        array($form['name'], $section['name'], $block['name'], $field['name'])
-                    );
-                }
-                $insertedBlocks[] = implode(';', array($form['name'], $section['name'], $block['name']));
-            }
-            $insertedSections[] = implode(';', array($form['name'], $section['name']));
-        }
-        self::purgeFields($insertedFields);
-        self::purgeBlocks($insertedBlocks);
-        self::purgeSections($insertedSections);
-    }
-    /**
-     * 
-     * @param type $attributes
-     * @return boolean
-     */
-    protected static function parseAttributes($attributes)
-    {
-        $finalAttributes = array();
-        foreach ($attributes->children() as $attr) {
-            $attrName = $attr->getName();
-            if (isset($attr['name']) && $attr['name']) {
-                $attrName = $attr['name'];
-            }
-            if (count($attr->children()) > 0) {
-                if ($attrName == 'selectData') {
-                    $values = self::parseAttributes($attr);
-                    $finalAttributes[$attrName] = array();
-                    foreach ($values as $key => $value) {
-                        $finalAttributes[$attrName][] = array(
-                            'id' => $key,
-                            'text' => $value
-                        );
-                    }
-                } else {
-                    $finalAttributes[$attrName] = self::parseAttributes($attr);
-                }
-            } else {
-                $finalAttributes[$attrName] = $attr->__toString();
-                if ($finalAttributes[$attrName] == "true") {
-                    $finalAttributes[$attrName] = true;
-                } elseif ($finalAttributes[$attrName] == "false") {
-                    $finalAttributes[$attrName] = false;
-                }
-            }
-        }
-        return $finalAttributes;
-    }
-    /**
-     * Parse the list of versions for relation between fields and a block, if the form can use product version
-     *
-     * @param \SimpleXMLElement
-     * @return array
-     */
-    protected static function parseVersions($versions)
-    {
-        $finalVersions = array();
-        foreach ($versions->children() as $version) {
-            $finalVersions[] = strval($version);
-        }
-        if (0 === count($finalVersions)) {
-            return array('');
-        }
-        return $finalVersions;
-    }
-    /**
-     * Purge fields
-     *
-     * @param array $insertedFields
-     */
-    protected static function purgeFields($insertedFields)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $db->beginTransaction();
-        $stmt = $db->prepare("DELETE FROM cfg_forms_blocks_fields_relations WHERE CONCAT_WS(';', block_id, field_id) = ?");
-        foreach (self::$blockFields as $key => $value) {
-            if (!in_array($key, $insertedFields)) {
-                $stmt->execute(array($value));
-            }
-        }
-        $db->commit();
-        $stmt = $db->prepare(
-            "DELETE FROM cfg_forms_fields "
-            . "WHERE NOT EXISTS "
-            . "(SELECT field_id FROM cfg_forms_blocks_fields_relations r WHERE r.field_id = cfg_forms_fields.field_id)"
-        );
-        $stmt->execute();
-    }
-    /**
-     * Purge blocks
-     *
-     * @param array $insertedBlocks
-     */
-    protected static function purgeBlocks($insertedBlocks)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $db->beginTransaction();
-        $stmt = $db->prepare("DELETE FROM cfg_forms_blocks WHERE block_id = ?");
-        foreach (self::$blocks as $key => $value) {
-            if (!in_array($key, $insertedBlocks)) {
-                $stmt->execute(array($value));
-            }
-        }
-        $db->commit();
-    }
-    /**
-     * Purge sections
-     *
-     * @param array $insertedSections
-     */
-    protected static function purgeSections($insertedSections)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $db->beginTransaction();
-        $stmt = $db->prepare("DELETE FROM cfg_forms_sections WHERE section_id = ?");
-        foreach (self::$sections as $key => $value) {
-            if (!in_array($key, $insertedSections)) {
-                $stmt->execute(array($value));
-            }
-        }
-        $db->commit();
-    }
-    /**
-     * Purge steps
-     *
-     * @param array $insertedSteps
-     */
-    protected static function purgeSteps($insertedSteps)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $db->beginTransaction();
-        $stmt = $db->prepare("DELETE FROM cfg_forms_steps WHERE step_id = ?");
-        foreach (self::$steps as $key => $value) {
-            if (!in_array($key, $insertedSteps)) {
-                $stmt->execute(array($value));
-            }
-        }
-        $db->commit();
-    }
-    /**
-     * Purge step fields
-     *
-     * @param array $insertedFields
-     */
-    protected static function purgeStepFields($insertedFields)
-    {
-        $db = \Centreon\Internal\Di::getDefault()->get('db_centreon');
-        $db->beginTransaction();
-        $stmt = $db->prepare("DELETE FROM cfg_forms_steps_fields_relations WHERE CONCAT_WS(';', step_id, field_id) = ?");
-        foreach (self::$stepFields as $key => $value) {
-            if (!in_array($key, $insertedFields)) {
-                $stmt->execute(array($value));
-            }
-        }
-        $db->commit();
-    }
-}

--- a/core/internal/Form/Validators/CircularDependency.php
+++ b//dev/null
@@ -1,78 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class CircularDependency implements ValidatorInterface
-{
-    /**
-     * 
-     */
-    public function validate($value, $module = "", $objectName = '', $id = null, $fieldname = '')
-    {
-        /*$controller = '\\' . $module . '\Controllers\\' . ucfirst($objectName) . 'Controller';
-        $result = true;
-        $resultError = _("Circular redundancy detected");
-        $object = $controller::$relationMap[$fieldname];
-        $objectStack = explode(',', trim($value));
-        $enlistedObject = array();
-        while (count($objectStack) > 0) {
-            $currentObject = array_pop($objectStack);
-            if (!is_null($id)) {
-                if ($currentObject == $id) {
-                    $result = false;
-                    break;
-                }
-            }
-            $enlistedObject[$currentObject] = true;
-            $relations = $object::getTargetIdFromSourceId(
-                $object::getSecondKey(),
-                $object::getFirstKey(),
-                $currentObject
-            );
-            foreach ($relations as $relation) {
-                $objectStack[] = $relation;
-            }
-        }
-        return array(
-            'success' => $result,
-            'error' => $resultError
-        );*/
-        return array('success' => true, 'error' => '');
-    }
-}

--- a/core/internal/Form/Validators/Datetime.php
+++ b//dev/null
@@ -1,62 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * Description of String
- *
- * @author lionel
- */
-class Datetime extends RespectValidationAbstract
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $validators = array(
-        'between',
-        'date',
-        'leapDate',
-        'leapYear',
-        'minimumAge',
-    );
-    /**
-     * 
-     * @param type $params
-     */
-    public function __construct($params)
-    {
-        parent::__construct($params);
-    }
-}

--- a/core/internal/Form/Validators/ForbiddenChar.php
+++ b//dev/null
@@ -1,71 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class ForbiddenChar implements ValidatorInterface
-{
-    public function __construct()
-    {
-    }
-    /**
-     * 
-     */
-    public function validate($value, $params = array())
-    {
-        /*$forbiddenCharDetected = false;
-        $illegalCharsStr = str_split($params['characters']);
-        $forbiddenCharsList = '';
-        foreach ($illegalCharsArr as $char) {
-            if (strpos($value, $char) !== false) {
-                $forbiddenCharDetected = true;
-                $forbiddenCharsList .= $char.' ';
-            }
-        }
-        if (!$forbiddenCharDetected) {
-            $result = array('success' => true);
-        } else {
-            $result = array(
-                'success' => false,
-                'error' => _('One of these illegal chars ('.$forbiddenCharsList.') have been found')
-            );
-        }
-        return $result;*/
-        return array('success' => true, 'error' => '');
-    }
-}

--- a/core/internal/Form/Validators/Misc.php
+++ b//dev/null
@@ -1,69 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * Description of String
- *
- * @author lionel
- */
-class Misc extends RespectValidationAbstract
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $validators = array(
-        'cnh',
-        'cnpj',
-        'cpf',
-        'domain',
-        'email',
-        'hexRgbColor',
-        'ip',
-        'json',
-        'macAddress',
-        'nfeAccessKey',
-        'phone',
-        'url',
-    );
-    /**
-     * 
-     * @param type $params
-     */
-    public function __construct($params)
-    {
-        parent::__construct($params);
-    }
-}

--- a/core/internal/Form/Validators/Numeric.php
+++ b//dev/null
@@ -1,72 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * Description of String
- *
- * @author lionel
- */
-class Numeric extends RespectValidationAbstract
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $validators = array(
-        'between',
-        'bool',
-        'even',
-        'float',
-        'int',
-        'multiple',
-        'negative',
-        'notEmpty',
-        'numeric',
-        'odd',
-        'perfectSquare',
-        'positive',
-        'primeNumber',
-        'roman',
-        'xdigit',
-    );
-    /**
-     * 
-     * @param type $params
-     */
-    public function __construct($params)
-    {
-        parent::__construct($params);
-    }
-}

--- a/core/internal/Form/Validators/RespectValidationAbstract.php
+++ b//dev/null
@@ -1,103 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-use Respect\Validation\Validator as v;
-/**
- * Description of RespectValidationAbstract
- *
- * @author lionel
- */
-abstract class RespectValidationAbstract implements ValidatorInterface
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $validators = array();
-    /**
-     *
-     * @var type 
-     */
-    protected $submittedValidators;
-    /**
-     *
-     */
-    protected $contextCall = '';
-    /**
-     * 
-     * @param type $params
-     */
-    protected function __construct($params)
-    {
-        $this->submittedValidators = explode(';', $params);
-        $this->prepareArguments();
-    }
-    /**
-     * 
-     * @param type $value
-     * @return type
-     */
-    public function validate($value, $params = array())
-    {
-        $validators = $this->buildValidationChain();
-        $callStr = $this->contextCall;
-        $obj = \Respect\Validation\Validator::$callStr();
-        foreach ($validators as $func => $param) {
-            $obj = call_user_func_array(array($obj, $func), $param);
-        }
-        return $obj->validate($value);
-    }
-    /**
-     * 
-     * @return string
-     */
-    protected function buildValidationChain()
-    {
-        $validationChainCall = array();
-        foreach ($this->submittedValidators as $stringValidator) {
-            $validatorParamsAndValue = explode('=', $stringValidator);
-            if (in_array($validatorParamsAndValue[0], $this->validators)) {
-                $validationChainCall[$validatorParamsAndValue[0]] = explode(',' ,$validatorParamsAndValue[1]);
-            }
-        }
-        return $validationChainCall;
-    }
-    /**
-     * Prepare custom arguments
-     */
-    protected function prepareArguments()
-    {
-    }
-}

--- a/core/internal/Form/Validators/String.php
+++ b//dev/null
@@ -1,102 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * Description of String
- *
- * @author lionel
- */
-class String extends RespectValidationAbstract
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $validators = array(
-        'alnum',
-        'alpha',
-        'between',
-        'charset',
-        'cntrl',
-        'consonant',
-        'contains',
-        'digit',
-        'endsWith',
-        'graph',
-        'in',
-        'length',
-        'lowercase',
-        'notEmpty',
-        'noWhitespace',
-        'prnt',
-        'punct',
-        'regex',
-        'slug',
-        'space',
-        'startsWith',
-        'uppercase',
-        'version',
-        'vowel',
-        'xdigit',
-    );
-    /**
-     * 
-     * @param type $params
-     */
-    public function __construct($params)
-    {
-        parent::__construct($params);
-        $this->contextCall = 'string';
-    }
-    /**
-     * Prepare custom arguments
-     */
-    protected function prepareArguments()
-    {
-        $length = array();
-        foreach ($this->submittedValidators as $stringValidator) {
-            $stringValidator = json_decode($stringValidator, true);
-            foreach ($stringValidator as $myKey => $myValue) {
-                $length[$myKey] = $myValue;
-            }
-            /*if ($validatorParamsAndValue[0] == 'minlength' || $validatorParamsAndValue[0] == 'maxlength') {
-                $length[$validatorParamsAndValue[0]] = $validatorParamsAndValue[1];
-            }*/
-        }
-        if (isset($length['minlength']) && isset($length['maxlength'])) {
-            $this->submittedValidators[] = 'length=' . $length['minlength'] . ',' . $length['maxlength'];
-        }
-    }
-}

--- a/core/internal/Form/Validators/Unique.php
+++ b//dev/null
@@ -1,66 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Unique implements ValidatorInterface
-{
-    /**
-     * 
-     * @param type $value
-     * @param type $module
-     * @param type $objectName
-     * @param type $id
-     * @param type $fieldname
-     * @return boolean
-     */
-    public function validate($value, $module = "", $objectName = "", $id = null, $fieldname = '')
-    {
-        /*$callableObject = '\\' . $module . '\Models\\'.ucwords($objectName);
-        if ($callableObject::isUnique($value, $id)) {
-            $result = array('success' => true);
-        } else {
-            $result = array(
-                'success' => false,
-                'error' => _("\"<i>$value</i>\" is already in use for another $objectName")
-            );
-        }
-        return $result;*/
-        return array('success' => true, 'error' => '');
-    }
-}

--- a/core/internal/Form/Validators/Validator.php
+++ b//dev/null
@@ -1,144 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Form\Validators;
-use Centreon\Internal\Form\Generator\Web\Full;
-use Centreon\Internal\Form\Generator\Web\Wizard;
-use Centreon\Internal\Form\Generator\Api;
-use Centreon\Internal\Form\Generator\Cli;
-use Centreon\Internal\Form\Exception\InvalidTokenException;
-use Centreon\Internal\Exception;
-use Centreon\Internal\Exception\Validator\MissingParameterException;
-/**
- * Description of Validator
- *
- * @author lionel
- */
-class Validator
-{
-    private $formType;
-    private $formGenerator;
-    /**
-     * 
-     * @param type $formType
-     * @param type $formInfo
-     */
-    public function __construct($formType, $formInfo)
-    {
-        $this->getFormGenerator($formType, $formInfo);
-        $this->formType = $formType;
-    }
-    /**
-     * 
-     * @param type $formType
-     */
-    private function getFormGenerator($formType, $formInfo = array())
-    {
-        switch(strtolower($formType)) {
-            case 'form':
-                $this->formGenerator = new Full($formInfo['route'], $formInfo['params'], $formInfo['version']);
-                break;
-            case 'wizard':
-                $this->formGenerator = new Wizard($formInfo['route'], $formInfo['params']);
-                break;
-            case 'api':
-                $this->formGenerator = new Api($formInfo['route'], $formInfo['params'], $formInfo['version']);
-                break;
-            case 'cli':
-                $this->formGenerator = new Cli($formInfo['route'], $formInfo['params'], $formInfo['version']);
-                break;
-        }
-    }
-    /**
-     * 
-     * @param type $submittedDatas
-     */
-    public function validate($submittedDatas)
-    {
-        $validationScheme = $this->formGenerator->getValidationScheme(array_keys($submittedDatas));
-        $this->validateDatas($validationScheme, $submittedDatas);
-    }
-    /**
-     * 
-     * @param type $validationScheme
-     * @param type $submittedDatas
-     */
-    public function customValidate($validationScheme, $submittedDatas)
-    {
-        $this->validateDatas($validationScheme, $submittedDatas);
-    }
-    /**
-     * 
-     * @param type $validationScheme
-     * @param type $submittedDatas
-     * @throws \Exception
-     */
-    private function validateDatas($validationScheme, $submittedDatas)
-    {
-        $errors = array();
-        $datasKeys = array_keys($submittedDatas);
-        $missingKeys = array_diff($validationScheme['mandatory'], $datasKeys);
-        if (count($missingKeys) > 0) {
-            $errorMessage = "The following mandatory parameters are missing : ";
-            $errorMessage .= implode("\n    - ", $missingKeys);
-            throw new MissingParameterException($errorMessage);
-        }
-        foreach ($submittedDatas as $key => $value) {
-            if (isset($validationScheme['fieldScheme'][$key])) {
-                foreach ($validationScheme['fieldScheme'][$key] as $validatorElement) {
-                    $call = '\Centreon\Internal\Form\Validators\\' . ucfirst($validatorElement['call']);
-                    $validator = new $call($validatorElement['params']);
-                    $result = $validator->validate($value);
-                    if ($result['success'] === false) {
-                        $errors[] = $result['error'];
-                    }
-                }
-            }
-        }
-        if (count($errors) > 0) {
-            $this->raiseValidationException($errors);
-        }
-    }
-    /**
-     * 
-     * @param type $errors
-     * @throws \Exception
-     */
-    private function raiseValidationException($errors)
-    {
-        $message = $errors;
-        $code = 401;
-        throw new Exception($message, $code);
-    }
-}

--- a/core/internal/Form/Validators/ValidatorInterface.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Form\Validators;
-/**
- * @author Sylvestre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-interface ValidatorInterface
-{
-    /**
-     * Validate a value
-     *
-     * @param mixed $value
-     * @return bool
-     */
-    public function validate($value, $params = array());
-}

--- a/core/internal/Hook.php
+++ b//dev/null
@@ -1,313 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-class Hook
-{
-    const DISPLAY_PREFIX = 'display';
-    const TYPE_DISPLAY = 0;
-    const TYPE_ACTION = 1;
-    private static $hookCache;
-    private static $moduleHookCache;
-    /**
-     * Reset static properties
-     */
-    public static function reset()
-    {
-        static::$hookCache = null;
-        static::$moduleHookCache = null;
-    }
-    /**
-     * Get hook id from hook name
-     * 
-     * @param string $hookName
-     * @return int 
-     * @throws \Centreon\Internal\Exception
-     */
-    public static function getHookId($hookName)
-    {
-        $hooks = self::getHookCache(true);
-        if (isset($hooks['name'][$hookName]) && isset($hooks['name'][$hookName]['hook_id'])) {
-            return $hooks['name'][$hookName]['hook_id'];
-        } else {
-            throw new Exception(sprintf('Could not find hook named %s', $hookName));
-        }
-    }
-    /**
-     * Get hook name from hook id
-     *
-     * @param string $hookId
-     * @return string
-     * @throws \Centreon\Internal\Exception
-     */
-    public static function getHookName($hookId)
-    {
-        $hooks = self::getHookCache();
-        if (isset($hooks['id'][$hookId]) && isset($hooks['id'][$hookId]['hook_name'])) {
-            return $hooks['id'][$hookId]['hook_name'];
-        } else {
-            throw new Exception(sprintf('Could not find hook id %s', $hookId));
-        }
-    }
-    /**
-     * 
-     * @param type $hookName
-     * @param type $hookDescription
-     */
-    public static function insertHook($hookName, $hookDescription)
-    {
-        $db = Di::getDefault()->get('db_centreon');
-        $sql = "INSERT INTO cfg_hooks 
-            (hook_name, hook_description) VALUES
-            (?, ?)";
-        $arr = array(
-            'hook_name' => $hookName,
-            'hook_description' => $hookDescription
-        );
-        $stmt = $db->prepare($sql);
-        $sqlarr = array();
-        foreach ($arr as $elem) {
-            $sqlarr[] = $elem;
-        }
-        $stmt->execute($sqlarr);
-    }
-    /**
-     * Register a hook
-     *
-     * @param int $moduleId
-     * @param string $hookName
-     * @param string $moduleHookName
-     * @param string $moduleHookDescription
-     * @throws \Centreon\Internal\Exception
-     */
-    public static function register($moduleId, $hookName, $moduleHookName, $moduleHookDescription)
-    {
-        $unique = implode("_", array($moduleId, self::getHookId($hookName), $moduleHookName));
-        $moduleHookCache = self::getModuleHookCache();
-        if (isset($moduleHookCache[$unique])) {
-            throw new Exception('Hook already registered');
-        }
-        $db = Di::getDefault()->get('db_centreon');
-        $sql = "INSERT INTO cfg_modules_hooks 
-            (module_id, hook_id, module_hook_name, module_hook_description) VALUES
-            (?, ?, ?, ?)";
-        $arr = array(
-            'module_id' => $moduleId,
-            'hook_id' => self::getHookId($hookName),
-            'module_hook_name' => $moduleHookName,
-            'module_hook_description' => $moduleHookDescription
-        );
-        $stmt = $db->prepare($sql);
-        $sqlarr = array();
-        foreach ($arr as $elem) {
-            $sqlarr[] = $elem;
-        }
-        $stmt->execute($sqlarr);
-        self::$moduleHookCache[$unique] = $arr;
-    }
-    /**
-     * Unregister a hook
-     *
-     * @param int $moduleId
-     * @param string $hookName
-     * @param string $moduleHookName
-     * @throws \Centreon\Internal\Exception
-     */
-    public static function unregister($moduleId, $hookName, $moduleHookName)
-    {
-        $hookId = self::getHookId($hookName);
-        $unique = implode("_", array($moduleId, $hookId, $moduleHookName));
-        $moduleHookCache = self::getModuleHookCache();
-        if (isset($moduleHookCache[$unique])) {
-            $db = Di::getDefault()->get('db_centreon');
-            $stmt = $db->prepare(
-                "DELETE FROM cfg_modules_hooks 
-                WHERE module_id = ? 
-                AND hook_id = ? 
-                AND module_hook_name = ?"
-            );
-            $stmt->execute(array($moduleId, $hookId, $moduleHookName));
-            unset(self::$moduleHookCache[$unique]);
-        }
-    }
-    /**
-     * Get modules from hook
-     *
-     * @param string $hookName
-     * @return array
-     */
-    public static function getModulesFromHook($hookType = null, $hookName = null)
-    {
-        $filters = array();
-        $sql = "SELECT m.name AS module, h.hook_name, module_hook_name
-            FROM cfg_modules m, cfg_hooks h, cfg_modules_hooks mh 
-            WHERE m.id = mh.module_id
-            AND mh.hook_id = h.hook_id";
-        if (!is_null($hookName)) {
-            $sql .= " AND h.hook_name = ? ";
-            $filters[] = $hookName;
-        }
-        if (!is_null($hookType)) {
-            if (!in_array($hookType, array(static::TYPE_DISPLAY, static::TYPE_ACTION))) {
-                throw new Exception(sprintf('Unknown hook type %s', $hookType));
-            }
-            $sql .= " AND h.hook_type = ? ";
-            $filters[] = $hookType;
-        }
-        $db = Di::getDefault()->get('db_centreon');
-        $stmt = $db->prepare($sql);
-        $stmt->execute($filters);
-        return $stmt->fetchAll();
-    }
-    /**
-     * Execute a hook
-     *
-     * @param string $hookName
-     * @param array $params
-     * @todo retrieve registered hooks FROM cfg_moduless
-     * @return array
-     */
-    public static function execute($hookName, $params)
-    {
-        if (!preg_match('/^'.self::DISPLAY_PREFIX.'/', $hookName)) {
-            throw new Exception(sprintf('Invalid hook name %s', $hookName));
-        }
-        $db = Di::getDefault()->get('db_centreon');
-        $hooks = self::getModulesFromHook(self::TYPE_DISPLAY, $hookName);
-        $hookData = array();
-        $i = 0;
-        $path = rtrim(Di::getDefault()->get('config')->get('global', 'centreon_path'), '/');
-        foreach ($hooks as $hook) {
-            $commonName = str_replace(' ', '', ucwords(str_replace('-', ' ', $hook['module'])));
-            $filename = "$path/modules/{$commonName}Module/hooks/".ucfirst($hook['module_hook_name']).".php";
-            if (file_exists($filename)) {
-                $data = call_user_func(
-                    array("\\".$commonName."\\Hooks\\".ucfirst($hook['module_hook_name']), "execute"),
-                    $params
-                );
-                /* has template */
-                if (is_array($data) && count($data) && isset($data[0]) && 
-                    is_file("$path/modules/{$commonName}Module/views/{$data[0]}")) {
-                    $hookData[$i]['template'] = $data[0];
-                    $hookData[$i]['variables'] = array();
-                    if (isset($data[1]) && is_array($data[1])) {
-                        $hookData[$i]['variables'] = $data[1];
-                    }
-                } else { /* has no template */
-                    $hookData[$i] = $data;
-                }
-                $i++;
-            }
-        }
-        return $hookData;
-    }
-    /**
-     * Add to template the list of static file (js / css)
-     *
-     * @param string $hookName The hook name
-     */
-    public static function addStaticFile($hookName)
-    {
-        if (!preg_match('/^'.self::DISPLAY_PREFIX.'/', $hookName)) {
-            throw new Exception(sprintf('Invalid hook name %s', $hookName));
-        }
-        $hooks = self::getModulesFromHook(self::TYPE_DISPLAY, $hookName);
-        $path = rtrim(Di::getDefault()->get('config')->get('global', 'centreon_path'), '/');
-        $tpl = Di::getDefault()->get('template');
-        foreach ($hooks as $hook) {
-            $commonName = str_replace(' ', '', ucwords(str_replace('-', ' ', $hook['module'])));
-            $filename = "$path/modules/{$commonName}Module/hooks/".ucfirst($hook['module_hook_name']).".php";
-            if (file_exists($filename)) {
-                include_once $filename;
-                $classname = "\\" . $commonName . "\\Hooks\\" . ucfirst($hook['module_hook_name']);
-                if (method_exists($classname, 'addJs')) {
-                    call_user_func(array($classname, 'addJs'), $tpl);
-                }
-                if (method_exists($classname, 'addCss')) {
-                    call_user_func(array($classname, 'addCss'), $tpl);
-                }
-            }
-        }
-    }
-    /**
-     * Get hook cache
-     *
-     * @return array
-     */
-    private static function getHookCache($force = false)
-    {
-        $db = Di::getDefault()->get('db_centreon');
-        if (!isset(self::$hookCache) || $force) {
-            self::$hookCache = array('id' => array(), 'name' => array());
-            $sql = "SELECT hook_id, hook_name, hook_description FROM cfg_hooks";
-            $stmt = $db->prepare($sql);
-            $stmt->execute();
-            $rows = $stmt->fetchAll();
-            foreach ($rows as $row) {
-                self::$hookCache['id'][$row['hook_id']] = $row;
-                self::$hookCache['name'][$row['hook_name']] = $row;
-            }
-        }
-        return self::$hookCache;
-    }
-    /**
-     * Get module hook cache
-     *
-     * @return array
-     */
-    private static function getModuleHookCache()
-    {
-        $db = Di::getDefault()->get('db_centreon');
-        if (!isset(self::$moduleHookCache)) {
-            self::$moduleHookCache = array();
-            $sql = "SELECT module_id, hook_id, module_hook_name, module_hook_description
-                FROM cfg_modules_hooks";
-            $stmt = $db->prepare($sql);
-            $stmt->execute();
-            $rows = $stmt->fetchAll();
-            foreach ($rows as $row) {
-                $unique = implode(
-                    "_",
-                    array(
-                        $row['module_id'],
-                        $row['hook_id'],
-                        $row['module_hook_name']
-                    )
-                );
-                self::$moduleHookCache[$unique] = $row;
-            }
-        }
-        return self::$moduleHookCache;
-    }
-}

--- a/core/internal/HttpCore.php
+++ b//dev/null
@@ -1,177 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Di;
-/**
- * Description of HttpCore
- *
- * @author lionel
- */
-class HttpCore
-{
-    /**
-     *
-     * @var type 
-     */
-    protected $db;
-    /**
-     *
-     * @var type 
-     */
-    protected $request;
-    /**
-     *
-     * @var \Centreon\Internal\Router 
-     */
-    protected $router;
-    /**
-     *
-     * @var string 
-     */
-    public static $moduleName = 'Core';
-    /**
-     *
-     * @var type 
-     */
-    protected static $httpCoreInstance;
-    /**
-     * 
-     * @param type $request
-     */
-    protected function __construct($request)
-    {
-        $this->db = Di::getDefault()->get('db_centreon');
-        $this->router = Di::getDefault()->get('router');
-        $this->request = $request;
-    }
-    /**
-     * 
-     * @param type $request
-     * @return type
-     */
-    final public static function getHttpCoreInstance($request)
-    {
-        if (is_null(self::$httpCoreInstance)) {
-            $className = get_called_class();
-            self::$httpCoreInstance = new $className($request);
-        }
-        return self::$httpCoreInstance;
-    }
-    /**
-     * 
-     * @return string
-     */
-    protected function getUri()
-    {
-        return $this->request->uri();
-    }
-    /**
-     * Get params
-     *
-     * @param string $type
-     * @return array
-     */
-    protected function getParams($type = "")
-    {
-        switch(strtolower($type)) {
-            case 'get':
-                $collection = $this->request->paramsGet();
-                break;
-            case 'post':
-                $collection = $this->request->paramsPost();
-                break;
-            case 'named':
-                $collection = $this->request->paramsNamed();
-                break;
-            default:
-                $collection = $this->request->params();
-                break;
-        }
-        return $collection;
-    }
-    /**
-     * Get routes
-     *
-     * @return array
-     */
-    public static function getRoutes()
-    {
-        $tempo = array();
-        $className = get_called_class();
-        $ref = new \ReflectionClass($className);
-        foreach ($ref->getMethods() as $method) {
-            $methodName = $method->getName();
-            if (substr($methodName, -6) == 'Action') {
-                foreach (explode("\n", $method->getDocComment()) as $line) {
-                    $str = trim(str_replace("* ", '', $line));
-                    if (substr($str, 0, 6) == '@route') {
-                        $route = substr($str, 6);
-                        if (isset($className::$objectName)) {
-                            $route = str_replace("{object}", $className::$objectName, $route);
-                        }
-                        $tempo[$methodName]['route'] = trim($route);
-                    } elseif (substr($str, 0, 7) == '@method') {
-                        $method_type = strtoupper(substr($str, 7));
-                        $tempo[$methodName]['method_type'] = trim($method_type);
-                    } elseif (substr($str, 0, 4) == '@acl') {
-                        $aclFlags = explode(",", trim(substr($str, 4)));
-                        $tempo[$methodName]['acl'] = Acl::convertAclFlags($aclFlags);
-                    }
-                }
-            }
-        }
-        return $tempo;
-    }
-    /**
-     * 
-     * @param string $route
-     * @param integer $returnCode
-     */
-    protected function redirect($route, $returnCode = 200)
-    {
-        $redirectUrl = $this->router->getPathFor($route);
-        $this->router->response()->redirect($redirectUrl, $returnCode);
-    }
-    /**
-     * 
-     * @param array $response
-     */
-    protected function sendResponse(array $response = array())
-    {
-        if (isset($response['json']) && is_array($response['json'])) {
-            $this->router->response()->json($response['json']);
-        }
-    }
-}

--- a/core/internal/Informations.php
+++ b//dev/null
@@ -1,65 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal;
-/**
- * Description of Informations
- *
- * @author lionel
- */
-class Informations
-{
-    /**
-     * 
-     * @return type
-     * @throws Exception
-     */
-    public static function getCentreonVersion()
-    {
-        $di = Di::getDefault();
-        $db = $di->get('db_centreon');
-        try {
-            $stmt = $db->query("SELECT `value` FROM cfg_informations WHERE `key` = 'version'");
-            $res = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-            if (count($res) == 0) {
-                throw new \Exception("No values");
-            }
-        } catch (\PDOException $e) {
-            if ($e->getCode() == "42S02") {
-                throw new \Exception("Table not exist");
-            }
-        }
-        return $res[0]['value'];
-    }
-}

--- a/core/internal/Install/AbstractInstall.php
+++ b//dev/null
@@ -1,86 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Install;
-/**
- * Description of AbstractInstall
- *
- * @author lionel
- */
-class AbstractInstall
-{
-    /**
-     *
-     * @var array Core Modules of Centreon
-     */
-    private static $coreModules = array(
-        'centreon-main',
-        'centreon-security',
-        'centreon-administration',
-        'centreon-configuration',
-        'centreon-realtime',
-        'centreon-customview',
-        'centreon-bam',
-    );
-    /**
-     * 
-     * @return array
-     * @throws \Exception
-     */
-    protected static function getCoreModules()
-    {
-        $result = array('moduleCheck' => true, 'errorMessages' => '', 'modules' => array());
-        $centreonPath = rtrim(\Centreon\Internal\Di::getDefault()->get('config')->get('global', 'centreon_path'), '/');
-        foreach (self::$coreModules as $coreModule) {
-            $commonName = str_replace(' ', '', ucwords(str_replace('-', ' ', $coreModule)));
-            $moduleDirectory = $centreonPath . '/modules/' . $commonName . 'Module/';
-            if (!file_exists(realpath($moduleDirectory . 'install/config.json'))) {
-                throw new \Exception("The module $commonName is not valid because of a missing configuration file");
-            }
-            $moduleInfo = json_decode(file_get_contents($moduleDirectory . 'install/config.json'), true);
-            $classCall = '\\'.$commonName.'\\Install\\Installer';
-            try {
-                $result['modules'][$coreModule] = array(
-                    'classCall' => $classCall,
-                    'directory' => $moduleDirectory,
-                    'infos' => $moduleInfo
-                );
-            } catch (\Exception $e) {
-                $result['moduleCheck'] = false;
-                $result['errorMessages'] = $e->getMessage() . "\n";
-            }
-        }
-        return $result;
-    }
-}

--- a/core/internal/Install/Db.php
+++ b//dev/null
@@ -1,283 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Install;
-use Centreon\Internal\Utils\Filesystem\File;
-use Centreon\Internal\Di;
-use Centreon\Custom\Propel\CentreonMysqlPlatform; 
-use Centreon\Internal\Module\Informations;
-class Db
-{
-    /**
-     * 
-     * @param type $operation
-     * @param type $targetDbName
-     */
-    public static function update($targetDbName = 'centreon')
-    {
-        ini_set('memory_limit', '-1');
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $targetDb = 'db_centreon';
-        $db = $di->get($targetDb);
-        $configParams = array(
-            'propel.project' => 'centreon',
-            'propel.database' => 'mysql',
-            'propel.database.url' => $config->get($targetDb, 'dsn'),
-            'propel.database.user' => $config->get($targetDb, 'username'),
-            'propel.database.password' => $config->get($targetDb, 'password')
-        );
-        $platform = new CentreonMysqlPlatform($db);
-        $propelDb = new \MysqlSchemaParser($db);
-        $propelDb->setGeneratorConfig(new \GeneratorConfig($configParams));
-        $propelDb->setPlatform($platform);
-        $currentDbAppData = new \AppData($platform);
-        $currentDbAppData->setGeneratorConfig(new \GeneratorConfig($configParams));
-        $currentDb = $currentDbAppData->addDatabase(array('name' => $targetDbName));
-        $propelDb->parse($currentDb);
-        $updatedAppData = new \AppData($platform);
-        self::getDbFromXml($updatedAppData, 'centreon');
-        $diff = \PropelDatabaseComparator::computeDiff(
-            $currentDb,
-            $updatedAppData->getDatabase('centreon'),
-            false
-        );
-        $strDiff = $platform->getModifyDatabaseDDL($diff);
-        file_put_contents("/tmp/installSqlLog.sql", $strDiff);
-        self::preUpdate();
-        \PropelSQLParser::executeString($strDiff, $db);
-        self::postUpdate();
-        self::deleteTargetDbSchema($targetDbName);
-    }
-    /**
-     * 
-     * @param \AppData $myAppData
-     * @param string $targetDbName
-     */
-    public static function getDbFromXml(& $myAppData, $targetDbName)
-    {
-        $db = self::getDbConnector($targetDbName);
-        $xmlDbFiles = self::buildTargetDbSchema($targetDbName);
-        $appDataObject = new \XmlToAppData(new CentreonMysqlPlatform($db), null, 'utf-8');
-        foreach ($xmlDbFiles as $dbFile) {
-            $myAppData->joinAppDatas(array($appDataObject->parseFile($dbFile)));
-            unset($appDataObject);
-            $appDataObject = new \XmlToAppData(new CentreonMysqlPlatform($db), null, 'utf-8');
-        }
-        unset($appDataObject);
-    }
-    /**
-     * 
-     * @param array $sqlStatements
-     * @return array
-     */
-    public static function getTablesToBeRemoved($sqlStatements)
-    {
-        $tablesToBeRemoved = array();
-        foreach ($sqlStatements as $statement) {
-            if (strpos($statement, "DROP TABLE IF EXISTS") !== false) {
-                $tablesToBeRemoved[] = trim(substr($statement, strlen("DROP TABLE IF EXISTS")));
-            }
-        }
-        return $tablesToBeRemoved;
-    }
-    private static function deleteTargetDbSchema($targetDbName = 'centreon')
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $centreonPath = $config->get('global', 'centreon_path');
-        $targetFolder = $centreonPath . '/tmp/db/target/' . $targetDbName . '/';
-        $currentFolder = $centreonPath . '/tmp/db/current/' . $targetDbName . '/';
-        if (!file_exists($currentFolder)) {
-            mkdir($currentFolder, 0775, true);
-            if (posix_getuid() == 0) {
-                chown($currentFolder, 'centreon');
-                chgrp($currentFolder, 'centreon');
-            }
-        }
-        $fileList = glob($targetFolder . '/*.xml');
-        $nbOfFiles = count($fileList);
-        for ($i=0; $i<$nbOfFiles; $i++) {
-            $targetFile = $currentFolder . basename($fileList[$i]);
-            copy($fileList[$i], $targetFile);
-            if (posix_getuid() == 0) {
-                chmod($targetFile, 0664);
-                chown($targetFile, 'centreon');
-                chgrp($targetFile, 'centreon');
-            }
-            unlink($fileList[$i]);
-        }
-        self::deleteFolder($targetFolder);
-    }
-    /**
-     *
-     * @param string $path
-     */
-    private static function deleteFolder($path)
-    {
-        if (is_dir($path) === true) {
-            $files = array_diff(scandir($path), array('.', '..'));
-            foreach ($files as $file) {
-                unlink(realpath($path) . '/' . $file);
-            }
-            return rmdir($path);
-        } else if (is_file($path) === true) {
-            return unlink($path);
-        }
-        return false;
-    }
-    /**
-     * 
-     * @param type $targetDbName
-     */
-    private static function buildTargetDbSchema($targetDbName = 'centreon')
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $centreonPath = $config->get('global', 'centreon_path');
-        $targetFolder = '';
-        $tmpFolder = '';
-        $tmpFolder .= trim($config->get('global', 'centreon_generate_tmp_dir'));
-        if (!empty($tmpFolder)) {
-            $targetFolder .= $tmpFolder . '/centreon/db/target/' . $targetDbName . '/';
-        } else {
-            $targetFolder .= $centreonPath . '/tmp/db/target/' . $targetDbName . '/';
-        }
-        $fileList = array();
-        $fileList = array_merge(
-            $fileList,
-            File::getFiles($centreonPath . '/install/db/' . $targetDbName, 'xml')
-        );
-        $moduleList = Informations::getModuleList(false);
-        foreach ($moduleList as $module) {
-            $expModuleName = array_map(function ($n) { return ucfirst($n); }, explode('-', $module));
-            $moduleFileSystemName = implode("", $expModuleName) . 'Module';
-            $fileList = array_merge(
-                $fileList,
-                File::getFiles(
-                    $centreonPath . '/modules/' . $moduleFileSystemName . '/install/db/' . $targetDbName, 'xml'
-                )
-            );
-        }
-        if (!file_exists($targetFolder)) {
-            mkdir($targetFolder, 0777, true);
-        }
-        $nbOfFiles = count($fileList);
-        for ($i=0; $i<$nbOfFiles; $i++) {
-            $targetFile = $targetFolder . basename($fileList[$i]);
-            copy($fileList[$i], $targetFile);
-        }
-        return glob($targetFolder . '/*.xml');
-    }
-    /**
-     * 
-     * @param string $dirname
-     * @param string $targetDbName
-     */
-    public static function loadDefaultDatas($dirname, $targetDbName = 'centreon')
-    {
-        $dirname = rtrim($dirname, '/');
-        $orderFile = $dirname . '/' . $targetDbName . '.json';
-        $db = self::getDbConnector($targetDbName);
-        $db->beginTransaction();
-        if (file_exists($orderFile)) {
-            $insertionOrder = json_decode(file_get_contents($orderFile), true);
-            foreach ($insertionOrder as $fileBaseName) {
-                $datasFile = $dirname . '/' . $targetDbName . '/'. $fileBaseName . '.json';
-                self::insertDatas($datasFile, $targetDbName);
-            }
-        } else {
-            $datasFiles = File::getFiles($dirname, 'json');
-            foreach ($datasFiles as $datasFile) {
-                self::insertDatas($datasFile, $targetDbName);
-            }
-        }
-        $db->commit();
-    }
-    /**
-     * 
-     * @param string $datasFile
-     * @param string $targetDbName
-     */
-    private static function insertDatas($datasFile, $targetDbName)
-    {
-        ini_set('memory_limit', '-1');
-        $db = self::getDbConnector($targetDbName);
-        if (file_exists($datasFile)) {
-            $tableName = basename($datasFile, '.json');
-            $datas = json_decode(file_get_contents($datasFile), true);
-            foreach ($datas as $data) {
-                $fields = "";
-                $values = "";
-                foreach ($data as $key=>$value) {
-                    $fields .= "`$key`,";
-                    if (is_array($value)) {
-                        if ($value['domain'] == 'php') {
-                            $values .= $db->quote($value['function']()) . ",";
-                        } else {
-                            $values .= "$value[function](),";
-                        }
-                    } else {
-                        $values .= $db->quote($value) . ",";
-                    }
-                }
-                $insertQuery = "INSERT INTO `$tableName` (". rtrim($fields, ',') .") VALUES (" . rtrim($values, ',') . ") ";
-                $db->query($insertQuery);
-            }
-        }
-    }
-    private static function getDbConnector($dbName)
-    {
-        $di = Di::getDefault();
-        if ($dbName == 'centreon_storage') {
-            $targetDb = 'db_storage';
-        } else {
-            $targetDb = 'db_' . $dbName;
-        }
-        $db = $di->get($targetDb);
-        return $db;
-    }
-    /**
-     * 
-     */
-    private static function preUpdate()
-    {
-    }
-    /**
-     * 
-     */
-    private static function postUpdate()
-    {
-    }
-}

--- a/core/internal/Install/Install.php
+++ b//dev/null
@@ -1,83 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Install;
-use Centreon\Internal\Utils\CommandLine\Colorize;
-use Centreon\Internal\Install\Migrate;
-use Centreon\Internal\Install\AbstractInstall;
-use Centreon\Internal\Utils\Dependency\PhpDependencies;
-use Centreon\Internal\Module\Dependency;
-use Centreon\Internal\Install\Db;
-use Centreon\Internal\Di;
-class Install extends AbstractInstall
-{
-    /**
-     * 
-     */
-    public static function installCentreon()
-    {
-        if (Migrate::checkForMigration()) {
-            Migrate::migrateCentreon();
-        } else {
-            $di = Di::getDefault();
-            $config = $di->get('config');
-            $centreonPath = $config->get('global', 'centreon_path');
-            $dbName = $config->get('db_centreon', 'dbname');
-            $phpDependencies = json_decode(file_get_contents(rtrim($centreonPath, '/') . '/install/dependencies.json'));
-            PhpDependencies::checkDependencies($phpDependencies);
-            echo Colorize::colorizeMessage("Starting to install Centreon 3.0", "info") . "\n";
-            echo "Creating " . Colorize::colorizeText('centreon', 'blue', 'black', true) . " database... ";
-            Db::update($dbName);
-            echo Colorize::colorizeText('Done', 'green', 'black', true) . "\n";
-            $modulesToInstall = self::getCoreModules();
-            $dependencyResolver = new Dependency($modulesToInstall['modules']);
-            $installOrder = $dependencyResolver->resolve();
-            foreach($installOrder as $moduleName) {
-                $currentModule = $modulesToInstall['modules'][$moduleName];
-                $moduleInstaller = new $currentModule['classCall']($currentModule['directory'], $currentModule['infos']);
-                echo "Installing ". Colorize::colorizeText($moduleName, 'purple', 'black', true) . " module\n";
-                $moduleInstaller->install();
-                echo Colorize::colorizeText('Installation of module ' .$moduleName . ' done', 'green', 'black', true) . "\n";
-            }
-            echo Colorize::colorizeMessage("Centreon 3.0 has been successfully installed", "success") . "\n";
-        }
-    }
-    /**
-     * 
-     * @param boolean $removeDb
-     */
-    public static function uninstallCentreon($removeDb = false)
-    {
-    }
-}

--- a/core/internal/Install/Migrate.php
+++ b//dev/null
@@ -1,98 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Install;
-use Centreon\Internal\Utils\CommandLine\Colorize;
-use Centreon\Internal\Install\Install;
-use Centreon\Internal\Install\Db;
-use Centreon\Internal\Install\AbstractInstall;
-use Centreon\Internal\Informations;
-use Centreon\Internal\Di;
-use Centreon\Internal\Module\Dependency;
-class Migrate extends AbstractInstall
-{
-    /**
-     * 
-     * @return boolean
-     */
-    public static function checkForMigration()
-    {
-        $migrationNeeded = false;
-        try {
-            if (version_compare(Informations::getCentreonVersion(), '3.0.0', '<')) {
-                $migrationNeeded = true;
-            }
-        } catch (\Exception $e) {
-            $migrationNeeded = false;
-        }
-        return $migrationNeeded;
-    }
-    /**
-     * 
-     */
-    public static function migrateCentreon()
-    {
-        if (!self::checkForMigration()) {
-            Install::installCentreon();
-        } else {
-            $di = Di::getDefault();
-            $config = $di->get('config');
-            $dbName = $config->get('db_centreon', 'dbname');
-            echo Colorize::colorizeMessage("Starting to migrate to Centreon 3.0", "info") . "\n";
-            echo "Preparing Migration... ";
-            self::prepareDb();
-            echo Colorize::colorizeText('Done', 'green', 'black', true) . "\n";
-            echo "Migrating " . Colorize::colorizeText('centreon', 'blue', 'black', true) . " database... ";
-            Db::update($dbName);
-            echo Colorize::colorizeText('Done', 'green', 'black', true) . "\n";
-            $modulesToInstall = self::getCoreModules();
-            $dependencyResolver = new Dependency($modulesToInstall['modules']);
-            $installOrder = $dependencyResolver->resolve();
-            foreach($installOrder as $moduleName) {
-                $currentModule = $modulesToInstall['modules'][$moduleName];
-                $moduleInstaller = new $currentModule['classCall']($currentModule['directory'], $currentModule['infos']);
-                echo "Installing ". Colorize::colorizeText($moduleName, 'purple', 'black', true) . " module... ";
-                $moduleInstaller->install(false);
-                echo Colorize::colorizeText('Done', 'green', 'black', true) . "\n";
-            }
-            echo Colorize::colorizeMessage("Your Centreon has been successfully migrated to Centreon 3.0", "success") . "\n";
-        }
-    }
-    /**
-     * 
-     */
-    private static function prepareDb()
-    {
-    }
-}

--- a/core/internal/Install/Upgrade.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Install;
-use Centreon\Internal\Install\Migrate;
-use Centreon\Internal\Db\Installer;
-use Centreon\Internal\Install\AbstractInstall;
-class Upgrade extends AbstractInstall
-{
-    public static function upgradeCentreon()
-    {
-        if (Migrate::checkForMigration()) {
-            Migrate::migrateCentreon();
-        } else {
-            Installer::updateDb('migrate');
-            $modulesToUpgrade = self::getCoreModules();
-            foreach($modulesToUpgrade as $module) {
-                $moduleInstaller = new $module['classCall']($module['directory'], $module['infos']);
-                $moduleInstaller->install();
-            }
-        }
-    }
-    /**
-     * 
-     */
-    public static function checkForUpdate()
-    {
-        return false;
-    }
-}

--- a/core/internal/Logger.php
+++ b//dev/null
@@ -1,132 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-/**
- * Class for loading logger informations
- *
- * @see http://www.php.net/manual/en/class.pdo.php
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Logger
-{
-    private static $loggerHandler = array(
-        'file' => array(
-            'class' => '\Monolog\Handler\StreamHandler',
-            'extraArgs' => array(
-                'filename'
-            ),
-            'callbackArgs' => null
-        ),
-        'syslog' => array(
-            'class' => '\Monolog\Handler\SyslogHandler',
-            'extraArgs' => array(
-                'ident',
-                'facility'
-            ),
-            'callbackArgs' => null
-        ),
-        'phplog' => array(
-            'class' => '\Monolog\Handler\ErrorLogHandler',
-            'extraArgs' => array(
-                'messageType'
-            ),
-            'callbackArgs' => null
-        ),
-        'chromephp' => array(
-            'class' => '\Monolog\Handler\ChromePHPHandler',
-            'extraArgs' => array(),
-            'callbackArgs' => null
-        ),
-        'firephp' => array(
-            'class' => '\Monolog\Handler\FirePHPHandler',
-            'extraArgs' => array(),
-            'callbackArgs' => null
-        )
-    );
-    private static $reflectionHandler = array();
-    /**
-     * Load loggers and register them into \Monolog\Registry
-     *
-     * @param $config \Centreon\Config The application configuration
-     */
-    public static function load($config)
-    {
-        $logger = new \Monolog\Logger('MAIN');
-        $loggers = $config->get('loggers', 'logger');
-        foreach ($loggers as $loggerName) {
-            $loggerType = $config->get('logger_' . $loggerName, 'type');
-            if (!is_null($loggerType) && isset(self::$loggerHandler[$loggerType])) {
-                try {
-                    $handler = self::createHandler($config->getGroup('logger_' . $loggerName), $loggerName);
-                    $logger->pushHandler($handler);
-                } catch (\Exception $e) {
-                }
-            }
-        }
-        \Monolog\Registry::addLogger($logger, $logger->getName(), true);
-    }
-    /**
-     * Create an logger handler
-     *
-     * @param $info array The information for the handler
-     * @param $loggerName string The logger name
-     * @return \Monolog\AbstractHandler
-     * @throws \Centreon\Exception If a parameters doesn't set in configuration
-     */
-    private static function createHandler($info, $loggerName)
-    {
-        /* Init relfextion */
-        if (!isset($reflectionHandler[$info['type']])) {
-            self::$reflectionHandler[$info['type']] = new \ReflectionClass(
-                self::$loggerHandler[$info['type']]['class']
-            );
-        }
-        /* Prepare args */
-        $args = array();
-        foreach (self::$loggerHandler[$info['type']]['extraArgs'] as $argName) {
-            if (false === isset($info[$argName])) {
-                throw new Exception("The configuration value $argName for logger $loggerName is not set.");
-            }
-            $args[] = $info[$argName];
-        }
-        $args[] = constant('\Monolog\Logger::' . $info['level']);
-        /* Callback for handler arguments if set */
-        if (false === is_null(self::$loggerHandler[$info['type']]['callbackArgs'])) {
-        }
-        return self::$reflectionHandler[$info['type']]->newInstanceArgs($args);
-    }
-}

--- a/core/internal/Menu.php
+++ b//dev/null
@@ -1,147 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-class Menu
-{
-    /**
-     * @var array
-     */
-    private $tree;
-    /**
-     * Constructor
-     */
-    public function __construct()
-    {
-        $this->setMenu();
-    }
-    /**
-     * Takes a set of results and build a tree from it
-     *
-     * @param array $elements
-     * @param int $parentId
-     * @return array
-     */
-    private function buildTree(array $elements, $parentId = 0)
-    {
-        $branch = array();
-        $router = Di::getDefault()->get('router');
-        foreach ($elements as $element) {
-            if ($element['parent_id'] == $parentId) {
-                $children = $this->buildTree($elements, $element['menu_id']);
-                if ($children) {
-                    $element['children'] = $children;
-                } else {
-                    $element['children'] = array();
-                }
-                if (false === is_null($element['url'])) {
-                    $element['url'] = $router->getPathFor($element['url']);
-                }
-                $branch[] = $element;
-            }
-        }
-        return $branch;
-    }
-    /**
-     * Init menu
-     *
-     */
-    private function setMenu()
-    {
-        $cache = Di::getDefault()->get('cache');
-        if ($cache->has('app:menu')) {
-            $this->tree = $cache->get('app:menu');
-            return null;
-        }
-        $db = Di::getDefault()->get('db_centreon');
-        $this->tree = array();
-        $stmt = $db->prepare(
-            "SELECT menu_id, name, parent_id, url, icon_class, icon, bgcolor, menu_order, menu_block
-            FROM cfg_menus
-            WHERE module_id IN (SELECT id FROM cfg_modules WHERE isactivated = '1' OR isactivated = '2')
-            ORDER BY (CASE WHEN menu_order IS NULL then 1 ELSE 0 END), menu_order ASC, name ASC"
-        );
-        $stmt->execute();
-        $menus = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-        $this->tree = $this->buildTree($menus);
-        $cache->set('app:menu', $this->tree);
-    }
-    /**
-     * Get menu, can be recursive if $menuId is set.
-     * When $menuId is set, the method will return a 
-     * specific branch
-     *
-     * @param int $menuId
-     * @param array $tree
-     * @param string $block The block where the menu is displayed
-     * @return array
-     */
-    public function getMenu($menuId = null, $tree = null, $menuBlock = null)
-    {
-        $menu = array();
-        if (is_null($menuId)) {
-            $menu = $this->tree;
-        } else {
-            if (is_null($tree)) {
-                $tree = $this->tree;
-            }
-            foreach ($tree as $v) {
-                if ($v['menu_id'] == $menuId) {
-                    $menu = $v;
-                    break;
-                }
-            }
-        }
-        if (is_null($menuBlock)) {
-            return $menu;
-        }
-        $menu2 = array();
-        foreach ($menu as $item) {
-            if ($item['menu_block'] == $menuBlock) {
-                $menu2[] = $item;
-            }
-        }
-        return $menu2;
-    }
-    /**
-     * Get menu and returns json string
-     *
-     * @param int $menuId
-     * @return string
-     */
-    public function getMenuJson($menuId = null)
-    {
-        return json_encode($this->getMenu($menuId));
-    }
-}

--- a/core/internal/Module/Dependency.php
+++ b//dev/null
@@ -1,103 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Module;
-use Centreon\Internal\Utils\Dependency\Graph;
-/**
- * Dependencies resolver for entreon modules
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class Dependency
-{
-    /**
-     *
-     * @var \Centreon\Internal\Utils\Dependency\Graph() 
-     */
-    private $dependencyGraph;
-    /**
-     *
-     * @var array 
-     */
-    private $modules  = array();
-    /**
-     *
-     * @var type 
-     */
-    private $moduleNameList  = array();
-    /**
-     *
-     * @var type 
-     */
-    private $modulesOrderInstall = array();
-    /**
-     * 
-     * @param array $modules
-     */
-    public function __construct($modules)
-    {
-        foreach($modules as $n => $module) {
-            $this->modules[$n] = $module['infos']['dependencies'];
-        }
-        $this->moduleNameList = array_keys($this->modules);
-        $this->dependencyGraph = new Graph();
-        $this->buildDependenciesGraph();
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function resolve()
-    {
-        $seen = array();
-        $mList = $this->moduleNameList;
-        while (count(array_diff($this->moduleNameList, $this->modulesOrderInstall)) > 0) {
-            $currentModule = array_pop($mList);
-            $this->dependencyGraph->resolve($currentModule, $this->modulesOrderInstall, $seen);
-        }
-        return $this->modulesOrderInstall;
-    }
-    /**
-     * 
-     */
-    private function buildDependenciesGraph()
-    {
-        foreach ($this->modules as $mName => $mDep) {
-            $this->dependencyGraph->addNode($mName, $mDep);
-        }
-    }
-}

--- a/core/internal/Module/Generator.php
+++ b//dev/null
@@ -1,261 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Module;
-use Centreon\Internal\Di;
-use Centreon\Internal\Informations as CentreonInformations;
-/**
- * Module Generator
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class Generator
-{
-    /**
-     *
-     * @var type 
-     */
-    private $moduleDisplayName;
-    /**
-     *
-     * @var type 
-     */
-    private $moduleCanonicalName;
-    /**
-     *
-     * @var type 
-     */
-    private $moduleShortName;
-    /**
-     *
-     * @var type 
-     */
-    private $moduleAuthor;
-    /**
-     *
-     * @var type 
-     */
-    private $moduleFolderPath;
-    /**
-     *
-     * @var type 
-     */
-    private $licensePath;
-    /**
-     *
-     * @var type 
-     */
-    private $moduleFolderStructure;
-    /**
-     * 
-     * @param type $moduleCanonicalName
-     */
-    public function __construct($moduleCanonicalName)
-    {
-        $this->moduleCanonicalName = $moduleCanonicalName;
-        $config = Di::getDefault()->get('config');
-        $centreonPath = rtrim($config->get('global', 'centreon_path'), '/');
-        $this->licensePath = $centreonPath . '/infos/header.txt';
-        $this->moduleFolderPath = $centreonPath . '/modules/' . $moduleCanonicalName . 'Module';
-        $this->defineModuleFolderStructure();
-    }
-    /**
-     * 
-     */
-    public function defineModuleFolderStructure()
-    {
-        $this->moduleFolderStructure= array(
-            'api' => $this->moduleFolderPath . '/api',
-            'apiInternal' => $this->moduleFolderPath . '/api/internal',
-            'apiRest' => $this->moduleFolderPath . '/api/rest',
-            'apiSoap' => $this->moduleFolderPath . '/api/soap',
-            'commands' => $this->moduleFolderPath . '/commands',
-            'config' => $this->moduleFolderPath . '/config',
-            'controllers' => $this->moduleFolderPath . '/controllers',
-            'customs' => $this->moduleFolderPath . '/customs',
-            'events' => $this->moduleFolderPath . '/events',
-            'install' => $this->moduleFolderPath . '/install',
-            'installDb' => $this->moduleFolderPath . '/install/db',
-            'installDbCentreon' => $this->moduleFolderPath . '/install/db/centreon',
-            'forms' => $this->moduleFolderPath . '/forms',
-            'internal' => $this->moduleFolderPath . '/internal',
-            'models' => $this->moduleFolderPath . '/models',
-            'repositories' => $this->moduleFolderPath . '/repositories',
-            'tests' => $this->moduleFolderPath . '/tests',
-            'views' => $this->moduleFolderPath . '/views'
-        );
-    }
-    /**
-     * 
-     * @param type $shortname
-     */
-    public function setModuleShortName($shortname)
-    {
-        $this->moduleShortName = $shortname;
-    }
-    /**
-     * 
-     * @param type $displayName
-     */
-    public function setModuleDisplayName($displayName)
-    {
-        $this->moduleDisplayName = $displayName;
-    }
-    /**
-     * 
-     * @param type $author
-     */
-    public function setModuleAuthor($author)
-    {
-        $this->moduleAuthor = $author;
-    }
-    /**
-     * 
-     */
-    public function generateConfigFile()
-    {
-        $moduleConfig = array(
-            'name' => $this->moduleDisplayName,
-            'shortname' => $this->moduleShortName,
-            'version' => '1.0.0',
-            'author' => array($this->moduleAuthor),
-            'isuninstallable' => 1,
-            'isdisableable' => 1,
-            'url' => "",
-            'description' => $this->moduleDisplayName,
-            'core version' => CentreonInformations::getCentreonVersion(),
-            'dependencies' => array(
-                array(
-                    'name' => 'centreon-administration',
-                    'version' => CentreonInformations::getCentreonVersion()
-                )
-            ),
-            'optionnal dependencies' => array(),
-            'php module dependencies' => array(),
-            'program dependencies' => array()
-        );
-        file_put_contents(
-            $this->moduleFolderStructure['install'] . '/config.json',
-            json_encode($moduleConfig, JSON_PRETTY_PRINT | JSON_NUMERIC_CHECK)
-        );
-    }
-    /**
-     * 
-     */
-    public function generateModuleStructure()
-    {
-        mkdir($this->moduleFolderPath, 0777, true);
-        foreach ($this->moduleFolderStructure as $subFolder) {
-            mkdir($subFolder, 0777, true);
-        }
-    }
-    /**
-     * 
-     * @param type $withLicense
-     */
-    public function createSampleInstaller($withLicense = true)
-    {
-        $installerClass = "<?php\n\n";
-        if ($withLicense) {
-            $installerClass .= file_get_contents($this->licensePath);
-        }
-        $installerClass .= "namespace $this->moduleCanonicalName\Install;\n\n";
-        $installerClass .= "class Installer extends \Centreon\Internal\Module\Installer\n";
-        $installerClass .= "{\n";
-        $installerClass .= $this->indent() . 'public function __construct($moduleDirectory, $moduleInfo)' . "\n";
-        $installerClass .= $this->indent() . "{\n";
-        $installerClass .= $this->indent(2) . 'parent::__construct($moduleDirectory, $moduleInfo);';
-        $installerClass .= $this->indent() . "\n" . $this->indent() . "}\n\n";
-        $installerClass .= $this->indent() . 'public function customPreInstall()' . "\n";
-        $installerClass .= $this->indent() . "{\n" . $this->indent(2) . "\n" . $this->indent() . "}\n\n";
-        $installerClass .= $this->indent() . 'public function customInstall()' . "\n";
-        $installerClass .= $this->indent() . "{\n" . $this->indent(2) . "\n" . $this->indent() . "}\n\n";
-        $installerClass .= $this->indent() . 'public function customRemove()' . "\n";
-        $installerClass .= $this->indent() . "{\n" . $this->indent(2) . "\n" . $this->indent() . "}\n";
-        $installerClass .= "}\n\n";
-        file_put_contents($this->moduleFolderStructure['install'] . '/Installer.php', $installerClass);
-    }
-    /**
-     * 
-     * @param type $withLicense
-     */
-    public function createSampleController($withLicense = true)
-    {
-        $controllerClass = "<?php\n\n";
-        if ($withLicense) {
-            $controllerClass .= file_get_contents($this->licensePath);
-        }
-        $controllerClass .= "namespace $this->moduleCanonicalName\Controllers;\n\n";
-        $controllerClass .= "class SampleController extends \Centreon\Internal\Controller\n";
-        $controllerClass .= "{\n";
-        $controllerClass .= $this->indent() . 'public static $moduleName = ' . "'$this->moduleCanonicalName';\n\n";
-        $controllerClass .= $this->indent() . "/**\n";
-        $controllerClass .= $this->indent() . " * @method get\n";
-        $controllerClass .= $this->indent() . " * @route /sample\n";
-        $controllerClass .= $this->indent() . " */\n";
-        $controllerClass .= $this->indent() . "public function sampleAction()\n";
-        $controllerClass .= $this->indent() . "{\n";
-        $controllerClass .= $this->indent(2) . '$this->assignVarToTpl(\'centreonVersion\', \'Centreon 3.0\');' . "\n";
-        $controllerClass .= $this->indent(2) . '$this->display("sample.tpl");' . "\n";
-        $controllerClass .= $this->indent() . "}\n}\n";
-        $controllerClass .= "\n";
-        file_put_contents($this->moduleFolderStructure['controllers'] . '/SampleController.php', $controllerClass);
-    }
-    /**
-     * 
-     */
-    public function createSampleView()
-    {
-        $viewContent = '{extends file="file:[Core]viewLayout.tpl"}' . "\n\n";
-        $viewContent .= '{block name="title"}Sample{/block}' . "\n\n";
-        $viewContent .= '{block name="content"}Welcome to my {$centreonVersion} module{/block}' . "\n\n";
-        file_put_contents($this->moduleFolderStructure['views'] . '/sample.tpl', $viewContent);
-    }
-    /**
-     * 
-     * @param type $occurence
-     * @return string
-     */
-    private function indent($occurence = 1)
-    {
-        $finalIndent = "";
-        for ($i=0; $i<$occurence; $i++) {
-            $finalIndent .= "    ";
-        }
-        return $finalIndent;
-    }
-}

--- a/core/internal/Module/Informations.php
+++ b//dev/null
@@ -1,365 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal\Module;
-use Centreon\Internal\Di;
-use Centreon\Internal\Utils\String\CamelCaseTransformation;
-use Centreon\Models\Module;
-/**
- * Gives informations about modules
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class Informations
-{
-    /**
-     * 
-     * @param array $module
-     * @return boolean
-     */
-    public static function checkDependency($module)
-    {
-        $dependencySatisfied = false;
-        $db = Di::getDefault()->get('db_centreon');
-        $sql = "SELECT name, version FROM cfg_modules WHERE name = '$module[name]'";
-        $res = $db->query($sql);
-        $dependency = $res->fetchAll(\PDO::FETCH_ASSOC);
-        if (is_array($dependency) && count($dependency) > 0) {
-            if (version_compare($dependency[0]['version'], $module['version'], '>=')) {
-                $dependencySatisfied = true;
-            }
-        }
-        return $dependencySatisfied;
-    }
-    /**
-     * 
-     * @param string $moduleName
-     * @return boolean
-     */
-    public static function isModuleActivated($moduleName)
-    {
-        $moduleId = self::getModuleIdByName($moduleName);
-        $result = Module::getParameters($moduleId, 'isactivated');
-        return (boolean)$result['isactivated'];
-    }
-    /**
-     * 
-     * @param string $moduleName
-     * @return boolean
-     */
-    public static function isModuleInstalled($moduleName)
-    {
-        $isinstalled = false;
-        $moduleId = self::getModuleIdByName($moduleName);
-        if ($moduleId != false) {
-            $result = Module::getParameters($moduleId, 'isinstalled');
-            $isinstalled = (boolean)$result['isinstalled'];
-        }
-        return $isinstalled;
-    }
-    /**
-     * Chzeck to see if the module routes can be reached
-     * @return boolean
-        */
-    public static function isModuleReachable($moduleName)
-    {
-        $isReachable = false;
-        if (self::isModuleInstalled($moduleName)) {
-            if (self::isModuleActivated($moduleName)) {
-                $isReachable = true;
-            }
-        }
-        return $isReachable;
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @return type
-     */
-    public static function getModuleIdByName($moduleName)
-    {
-        $returnValue = false;
-        $resultModule = Module::getIdByParameter('name', $moduleName);
-        if (count($resultModule) > 0) {
-            $returnValue = $resultModule[0];
-        }
-        return $returnValue;
-    }
-    /**
-     *
-     * @param bool $onlyActivated If list only module activated
-     * @return array Array of module names (string)
-     */
-    public static function getModuleList($onlyActivated = 1)
-    {
-        $moduleList = array();
-        $activated = array('0', '1', '2');
-        if ($onlyActivated == 1) {
-            $activated = array('1', '2');
-        }
-        try {
-            $rawModuleList = Module::getList(
-                'name',
-                -1,
-                0,
-                null,
-                "ASC",
-                array('isactivated' => $activated)
-                );
-            foreach ($rawModuleList as $module) {
-                $moduleList[] = $module['name'];
-            }
-        } catch (\PDOException $e) {
-        }
-        return $moduleList;
-    }
-    /**
-     *
-     * @param bool $onlyActivated If list only module activated
-     * @return array Array of arrays describing modules
-     */
-    public static function getModuleExtendedList($onlyActivated = 1)
-    {
-        $activated = array('0', '1', '2');
-        if ($onlyActivated == 1) {
-            $activated = array('1', '2');
-        }
-        try {
-            $rawModuleList = Module::getList(
-                '*',
-                -1,
-                0,
-                null,
-                "ASC",
-                array('isactivated' => $activated)
-            );
-        } catch (\PDOException $e) {
-        }
-        return $rawModuleList;
-    }
-    /**
-     * 
-     * @return array
-     */
-    public static function getCoreModuleList()
-    {
-        $coreModuleList = array(
-            'centreon-main',
-            'centreon-security',
-            'centreon-administration',
-            'centreon-configuration',
-            'centreon-realtime',
-            'centreon-customview',
-            'centreon-bam',
-        );
-        return $coreModuleList;
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @return type
-     */
-    public static function getModulePath($moduleName)
-    {
-        $path = rtrim(Di::getDefault()->get('config')->get('global', 'centreon_path'), '/');
-        $realPath = $path . '/modules/' . self::getModuleCommonName($moduleName) . 'Module/';
-        return realpath($realPath);
-    }
-    /**
-     * Returns the name of the module from any given path
-     *
-     * @param string $path
-     * @return string
-     */
-    public static function getModuleFromPath($path)
-    {
-        $centreonPath = Di::getDefault()->get('config')->get('global', 'centreon_path');
-        $path = str_replace($centreonPath, '', $path);
-        $module = "";
-        if (preg_match('/modules\/([A-Za-z]+)Module\//', $path, $matches)) {
-            $module = $matches[1];
-        }
-        return $module;
-    }
-    /**
-     * Returns the slug name from camelcased module name
-     *
-     * @param string $moduleName
-     * @return string
-     */
-    public static function getModuleSlugName($moduleName)
-    {
-        $slugName = ltrim(strtolower(preg_replace('/[A-Z]/', '-$0', $moduleName)), '-');
-        return str_replace('-module', '', $slugName);
-    }
-    /**
-     * 
-     * @param string $moduleName
-     * @return string
-     */
-    public static function getModuleCommonName($moduleName)
-    {
-        return str_replace(' ', '', ucwords(str_replace('-', ' ', $moduleName)));
-    }
-    /**
-     * 
-     * @param string $canonicalName
-     * @param array $result
-     */
-    public static function isCanonicalNameValid($canonicalName, &$result)
-    {
-        $canonicalNameNotOk = true;
-        $error = "";
-        if (!CamelCaseTransformation::isCamelCase($canonicalName)) {
-            $canonicalNameNotOk = false;
-            $error = "The given canonical name is not in CamelCase";
-        } elseif (ucwords(substr($canonicalName, -6)) === "Module") {
-            $canonicalNameNotOk = false;
-            $error = "The given canonical name contains 'Module' at the end";
-        } elseif (self::isModuleCanonicalExists($canonicalName)) {
-            $canonicalNameNotOk = false;
-            $error = "A module with the same canonical name already exist in your centreon";
-        }
-        $result['success'] = $canonicalNameNotOk;
-        $result['message'] = $error;
-    }
-    /**
-     * 
-     * @param string $canonicalName
-     * @return boolean
-     */
-    public static function isModuleCanonicalExists($canonicalName)
-    {
-        $moduleExists = false;
-        $config =  Di::getDefault()->get('config');
-        $centreonPath = rtrim($config->get('global', 'centreon_path'), '/');
-        if (file_exists($centreonPath . '/modules/' . $canonicalName .'Module')) {
-            $moduleExists = true;
-        }
-        return $moduleExists;
-    }
-    /**
-     * Set menu entry
-     * Inserts into database if short_name does not exist, otherwise it just updates entry
-     *
-     * @param array $data (name, short_name, parent, route, icon_class, icon, bgcolor, order, module)
-     */
-    public static function setMenu($data)
-    {
-        $menus = null;
-        $db = Di::getDefault()->get('db_centreon');
-        if (is_null($menus)) {
-            $sql = "SELECT menu_id, short_name FROM cfg_menus";
-            $stmt = $db->prepare($sql);
-            $stmt->execute();
-            $rows = $stmt->fetchAll(\PDO::FETCH_ASSOC);
-            foreach ($rows as $row) {
-                $menus[$row['short_name']] = $row['menu_id'];
-            }
-        }
-        $mandatoryKeys = array('name', 'short_name');
-        foreach ($mandatoryKeys as $k) {
-            if (!isset($data[$k])) {
-                throw new Exception(sprintf('Missing mandatory key %s', $k));
-            }
-        }
-        if (isset($data['parent']) && !isset($menus[$data['parent']])) {
-            throw new Exception(sprintf('Parent %s does not exist', $data['parent']));
-        }
-        if (!isset($menus[$data['short_name']])) {
-            $sql = "INSERT INTO cfg_menus 
-                (name, short_name, parent_id, url, icon_class, icon, bgcolor, menu_order, module_id, menu_block) VALUES
-                (:name, :short_name, :parent, :route, :icon_class, :icon, :bgcolor, :order, :module, :menu_block)";
-        }
-        $stmt = $db->prepare($sql);
-        $stmt->bindParam(':name', $data['name']);
-        $stmt->bindParam(':short_name', $data['short_name']);
-        $parent = isset($data['parent']) && isset($menus[$data['parent']])? $menus[$data['parent']] : null;
-        $stmt->bindParam(':parent', $parent);
-        $stmt->bindParam(':route', $data['route']);
-        $icon_class = isset($data['icon_class']) ? $data['icon_class'] : null;
-        $stmt->bindParam(':icon_class', $icon_class);
-        $icon = isset($data['icon']) ? $data['icon'] : null;
-        $stmt->bindParam(':icon', $icon);
-        $bgcolor = isset($data['bgcolor']) ? $data['bgcolor'] : null;
-        $stmt->bindParam(':bgcolor', $bgcolor);
-        $order = isset($data['order']) ? $data['order'] : null;
-        $stmt->bindParam(':order', $order);
-        $module = isset($data['module']) ? $data['module'] : 0;
-        $stmt->bindParam(':module', $module);
-        $menuBlock = 'root';
-        if (isset($data['block'])) {
-            $menuBlock = $data['block'];
-        } elseif (isset($data['parent'])) {
-            $menuBlock = 'submenu';
-        }
-        $stmt->bindParam(':menu_block', $menuBlock, \PDO::PARAM_STR);
-        $stmt->execute();
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @return \Centreon\Commands\classCall
-     * @throws \Exception
-     */
-    public static function getModuleInstaller($moduleName, $moduleId = null)
-    {
-        $config =  Di::getDefault()->get('config');
-        $centreonPath = rtrim($config->get('global', 'centreon_path'), '/');
-        $commonName = str_replace(' ', '', ucwords(str_replace('-', ' ', $moduleName)));
-        $moduleDirectory = $centreonPath
-            . '/modules/'
-            . $commonName
-            . 'Module/';
-        if (!file_exists(realpath($moduleDirectory . 'install/config.json'))) {
-            throw new \Exception("The module is not valid because of a missing configuration file");
-        }
-        $moduleInfo = json_decode(file_get_contents($moduleDirectory . 'install/config.json'), true);
-        $classCall = '\\'.$commonName.'\\Install\\Installer';
-        if (isset($moduleId)) {
-            $moduleInfo['id'] = $moduleId;
-        } else {
-            $retrievedId = self::getModuleIdByName($moduleName);
-            if ($retrievedId !== false) {
-                $moduleInfo['id'] = $retrievedId;
-            }
-        }
-        $moduleInstaller = new $classCall($moduleDirectory, $moduleInfo);
-        return $moduleInstaller;
-    }
-}

--- a/core/internal/Module/Installer.php
+++ b//dev/null
@@ -1,297 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal\Module;
-use Centreon\Internal\Utils\CommandLine\Colorize;
-use Centreon\Internal\Module\Informations;
-use Centreon\Internal\Di;
-use Centreon\Internal\Install\Db;
-use Centreon\Internal\Form\Install\Installer as FormInstaller;
-use Centreon\Internal\Hook;
-use Centreon\Models\Module;
-/**
- * Module Abstract Install
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-abstract class Installer
-{
-    /**
-     *
-     * @var array 
-     */
-    protected $moduleInfo;
-    /**
-     *
-     * @var string 
-     */
-    protected $moduleDirectory;
-    /**
-     *
-     * @var int 
-     */
-    protected $moduleId;
-    /**
-     * 
-     * @param string $moduleDirectory
-     * @param array $moduleInfo
-     */
-    public function __construct($moduleDirectory, $moduleInfo)
-    {
-        $this->moduleInfo = $moduleInfo;
-        $this->moduleDirectory = $moduleDirectory;
-    }
-    /**
-     * 
-     */
-    abstract public function customPreInstall();
-    /**
-     * 
-     */
-    abstract public function customInstall();
-    /**
-     * 
-     */
-    abstract public function customRemove();
-    /**
-     * 
-     */
-    public function install($installDefault = true)
-    {
-        $this->preInstall();
-        $this->installDb($installDefault);
-        $this->customPreInstall();
-        $this->installForms();
-        $this->installMenu();
-        $this->installHooks();
-        $this->customInstall();
-        $this->postInstall();
-    }
-    /**
-     * 
-     */
-    public function installMenu()
-    {
-        $filejson = $this->moduleDirectory . 'install/menu.json';
-        if (file_exists($filejson)) {
-            $menus = json_decode(file_get_contents($filejson), true);
-            self::parseMenuArray($this->moduleId, $menus);
-        }
-    }
-    /**
-     * @todo After seeing Propel
-     */
-    public function installDb($installDefault = true)
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $dbName = $config->get('db_centreon', 'dbname');
-        echo "Updating " . Colorize::colorizeText('centreon', 'blue', 'black', true) . " database... ";
-        Db::update($dbName);
-        echo Colorize::colorizeText('Done', 'green', 'black', true) . "\n";
-        if ($installDefault) {
-            Db::loadDefaultDatas($this->moduleDirectory . 'install/datas');
-        }
-    }
-    /**
-     * @todo After seeing Propel
-     */
-    public function removeDb()
-    {
-    }
-    /**
-     * @todo Check for form dependencies
-     */
-    public function installForms()
-    {
-        $formsFiles = $this->moduleDirectory . '/install/forms/*.xml';
-        foreach (glob($formsFiles) as $xmlFile) {
-            FormInstaller::installFromXml($this->moduleId, $xmlFile);
-        }
-    }
-    /**
-     * 
-     */
-    public function installHooks()
-    {
-        $hooksFile = $this->moduleDirectory . '/install/hooks.json';
-        $moduleHooksFile = $this->moduleDirectory . '/install/registeredHooks.json';
-        if (file_exists($hooksFile)) {
-            $hooks = json_decode(file_get_contents($hooksFile), true);
-            foreach ($hooks as $hook) {
-                Hook::insertHook($hook['name'], $hook['description']);
-            }
-        }
-        if (file_exists($moduleHooksFile)) {
-            $moduleHooks = json_decode(file_get_contents($moduleHooksFile), true);
-            foreach ($moduleHooks as $moduleHook) {
-                Hook::register(
-                    $this->moduleId,
-                    $moduleHook['name'],
-                    $moduleHook['moduleHook'],
-                    $moduleHook['moduleHookDescription']
-                );
-            }
-        }
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function isDependenciesSatisfied()
-    {
-        $dependenciesSatisfied = true;
-        $missingDependencies = array();
-        foreach ($this->moduleInfo['dependencies'] as $module) {
-            if (!Informations::checkDependency($module)) {
-                $dependenciesSatisfied = false;
-                $missingDependencies[] = $module['name'];
-            }
-        }
-        return array(
-            'success' => $dependenciesSatisfied,
-            'missingDependencies' => $missingDependencies
-        );
-    }
-    /**
-     * 
-     * @throws \Exception
-     */
-    public function preInstall()
-    {
-        $newModuleId = Module::getIdByParameter('name', $this->moduleInfo['shortname']);
-        if (count($newModuleId) == 0) {
-            $params = array(
-                'name' => $this->moduleInfo['shortname'],
-                'alias' => $this->moduleInfo['name'],
-                'description' => $this->moduleInfo['description'],
-                'author' => implode(", ", $this->moduleInfo['author']),
-                'name' => $this->moduleInfo['shortname'],
-                'version' => $this->moduleInfo['version'],
-                'isactivated' => '0',
-                'isinstalled' => '0',
-            );
-            Module::insert($params);
-            $newModuleId = Module::getIdByParameter('name', $this->moduleInfo['shortname']);
-            $this->moduleId = $newModuleId[0];
-        } else {
-            throw new \Exception("Module already installed");
-        }
-    }
-    /**
-     * 
-     */
-    public function postInstall()
-    {
-        $isinstalled = 1;
-        $isactivated = 1;
-        if (isset($this->moduleInfo['isuninstallable']) && ($this->moduleInfo['isuninstallable'] === false)) {
-            $isinstalled = 2;
-        }
-        if (isset($this->moduleInfo['isdisableable']) && ($this->moduleInfo['isdisableable'] === false)) {
-            $isactivated = 2;
-        }
-        Module::update(
-            $this->moduleId,
-            array('isactivated' => $isactivated,'isinstalled' => $isinstalled)
-        );
-    }
-    /**
-     * 
-     */
-    public function remove()
-    {
-        $this->preRemove();
-        $this->removeHook();
-        $this->removeDb();
-        $this->postRemove();
-    }
-    /**
-     * 
-     */
-    public function preRemove()
-    {
-        if (is_null($this->moduleId)) {
-            $this->moduleId = $this->moduleInfo['id'];
-        }
-    }
-    /**
-     * 
-     */
-    public function postRemove()
-    {
-        Module::delete($this->moduleId);
-    }
-    /**
-     * 
-     */
-    public function removeHook()
-    {
-        $moduleHooksFile = $this->moduleDirectory . '/install/registeredHooks.json';
-        if (file_exists($moduleHooksFile)) {
-            $moduleHooks = json_decode(file_get_contents($moduleHooksFile), true);
-            foreach ($moduleHooks as $moduleHook) {
-                Hook::unregister(
-                    $this->moduleId,
-                    $moduleHook['name'],
-                    $moduleHook['moduleHook']
-                );
-            }
-        }
-    }
-    /**
-     * 
-     * @param int $moduleId
-     * @param array $menus
-     * @param string $parent
-     */
-    public static function parseMenuArray($moduleId, $menus, $parent = null)
-    {
-        $i = 1;
-        foreach ($menus as $menu) {
-            if (!is_null($parent)) {
-                $menu['parent'] = $parent;
-            }
-            $menu['module'] = $moduleId;
-            Informations::setMenu($menu);
-            if (isset($menu['menus']) && count($menu['menus'])) {
-                self::parseMenuArray($moduleId, $menu['menus'], $menu['short_name']);
-            }
-        }
-    }
-}

--- a/core/internal/Router.php
+++ b//dev/null
@@ -1,369 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Module\Informations;
-use CentreonSecurity\Controllers\LoginController;
-use Klein\Klein;
-class Router extends Klein
-{
-    /**
-     * The regular expression used to compile and match URL's
-     *
-     * @const string
-     */
-    const ROUTE_COMPILE_REGEX = '`(\\\?(?:/|\.|))(\[([^:\]]*+)(?::([^:\]]*+))?\])(\?|)`';
-    /**
-     * Temporary list of route with method for create API route version
-     * @var array
-     */
-    protected $tmpRoute = array();
-    /**
-     * Route info
-     * 
-     * @var array
-     */
-    protected $routesData = array();
-    /**
-     * Temporary store the 404 route
-     *
-     * @var array
-     */
-    protected $notFoundRoute = array();
-    /**
-     * Count the deep of scan for loadin route
-     *
-     * @var int
-     */
-    protected $countDeep = 0;
-    /**
-     *
-     * @var type 
-     */
-    protected $mainRouteModules = array();
-    /**
-     * The list of version for api route
-     * @var array
-     */
-    protected static $routeApiVersion = array();
-    /**
-     * 
-     */
-    public function parseRoutes()
-    {
-        $this->mainRouteModules = array(
-            'centreon-main',
-            'centreon-security'
-        );
-        $cacheHandler = Di::getDefault()->get('cache');
-        $routesFullList = $cacheHandler->get('routes');
-        if (is_null($routesFullList) || !$routesFullList) {
-            $routesFullList = $this->getRoutesList();
-            $cacheHandler->set('routes', $routesFullList);
-        }
-        foreach ($routesFullList as $routeType => $routesList) {
-            switch ($routeType) {
-                default:
-                case 'front':
-                    $prefix = '';
-                    break;
-                case 'api':
-                    $prefix = 'api';
-                    break;
-            }
-            foreach ($routesList as $moduleName => $routesAndControllers) {
-                foreach ($routesAndControllers as $controllerName => $routes) {
-                    $this->parseRouteData($moduleName, $controllerName, $routes, $prefix);
-                }
-            }
-            if ($routeType == 'api') {
-                $this->computeApiVersion($routesList);
-            }
-        }
-        unset($this->tmpRoute);
-        $this->respond(
-            '404',
-            function ($request, $response) {
-                $tmpl = Di::getDefault()->get('template');
-                $response->code(404);
-                $response->body($tmpl->fetch('404.tpl'));
-            }
-        );
-        /*$this->onHttpError(function ($code, $router, $matched, $methods_matched, $http_exception) {
-            switch ($code) {
-                case 404:
-                    $tmpl = Di::getDefault()->get('template');
-                    $router->response()->body($tmpl->fetch('404.tpl'));
-                    break;
-                case 405:
-                    $router->response()->body(
-                        'You can\'t do that!'
-                    );
-                    break;
-                default:
-                    $router->response()->body(
-                        'Oh no, a bad error happened that caused a '. $code
-                    );
-            }
-        });*/
-    }
-    /**
-     * 
-     * @return array
-     */
-    private function getRoutesList()
-    {
-        $modulesList = Informations::getModuleList(true);
-        $modules = array();
-        foreach ($modulesList as $currentModule) {
-            $modules[$currentModule]['path'] = Informations::getModulePath($currentModule);
-            $modules[$currentModule]['commonName'] = Informations::getModuleCommonName($currentModule);
-        }
-        $controllersFullList = $this->getControllersList($modules);
-        $routesFullList = array('front' => array(), 'api' => array());
-        foreach ($controllersFullList as $type => $controllersList) {
-            foreach($controllersList as $moduleName => $controllers) {
-                $this->getRoutesFromController($moduleName, $controllers, $routesFullList[$type]);
-            }
-        }
-        return $routesFullList;
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @param type $controllers
-     * @param type $routesFullList
-     */
-    private function getRoutesFromController($moduleName, $controllers, &$routesFullList)
-    {
-        foreach($controllers as $controllerName) {
-            $routes = $controllerName::getRoutes();
-            if (count($routes) > 0) {
-                $routesFullList[$moduleName][$controllerName] = $routes;
-            }
-        }
-    }
-    /**
-     * 
-     * @param type $modules
-     * @return string
-     */
-    private function getControllersList($modules)
-    {
-        $controllersList = array();
-        foreach ($modules as $moduleName => $module) {
-            $myModuleControllersFiles = glob("$module[path]/controllers/*Controller.php");
-            $myModuleApiFiles = glob("$module[path]/api/rest/*Api.php");
-            foreach ($myModuleControllersFiles as $moduleController) {
-                $controllersList['front'][$moduleName][] = '\\'.$module['commonName'].'\\Controllers\\'.basename($moduleController, '.php');
-            }
-            foreach ($myModuleApiFiles as $moduleApi) {
-                $controllersList['api'][$moduleName][] = '\\'.$module['commonName'].'\\Api\\Rest\\'.basename($moduleApi, '.php');
-            }
-        }
-        return $controllersList;
-    }
-    /**
-     * 
-     * @param type $moduleName
-     * @param type $controllerName
-     * @param type $routesData
-     * @param type $routePrefix
-     */
-    private function parseRouteData($moduleName, $controllerName, $routesData, $routePrefix = '')
-    {
-        $baseUrl = rtrim(Di::getDefault()->get('config')->get('global', 'base_url'), '/');
-        if (!empty($routePrefix)) {
-            $baseUrl .= '/' . $routePrefix;
-        }
-        foreach ($routesData as $action => $data) {
-            if (!isset($data['acl'])) {
-                $data['acl'] = "";
-            }
-            if (isset($data['route'])) {
-                if (!in_array($moduleName, $this->mainRouteModules)) {
-                    $data['route'] = '/' . $moduleName . $data['route'];
-                }
-                $this->routesData[] = $data;
-                if (substr($data['route'], 0, 1) === '@' || $data['route'] === '405') {
-                    $routeName = $data['route'];
-                } elseif ($data['route'] === '404') {
-                    $this->notFoundRoute = array(
-                        'controllerName' => $controllerName,
-                        'action' => $action,
-                        'method' => $data['method_type']
-                    );
-                } else {
-                    $routeName = $baseUrl . $data['route'];
-                }
-                if (isset($_SESSION['acl']) &&
-                    false === $_SESSION['acl']->routeAllowed($data['route'])) {
-                    $this->respond(
-                        $routeName,
-                        function ($request, $response) {
-                            $response->code(403);
-                        }
-                    );
-                } else {
-                    $this->tmpRoute[$routeName][$data['method_type']] = $controllerName . '::' . $action;
-                    $this->respond(
-                        $data['method_type'],
-                        $routeName,
-                        function ($request, $response) use ($controllerName, $action, $routeName) {
-                            if (!isset($_SESSION['user']) && !strstr($routeName, ".css") &&
-                                !strstr($controllerName, "LoginController") && !strstr($routeName, "/api/")) {
-                                $obj = LoginController::getHttpCoreInstance($request);
-                                $obj->loginAction();
-                            } else {
-                                $obj = $controllerName::getHttpCoreInstance($request);
-                                $obj->$action();
-                            }
-                        }
-                    );
-                }
-            }
-        }
-    }
-    /**
-     * Get routes
-     *
-     * @return array
-     */
-    public function getRoutes()
-    {
-        return $this->routesData;
-    }
-    /**
-     * Get the path for a given route
-     *
-     * This looks up the route by its passed name and returns
-     * the path/url for that route, with its URL params as
-     * placeholders unless you pass a valid key-value pair array
-     * of the placeholder params and their values
-     *
-     * If a pathname is a complex/custom regular expression, this
-     * method will simply return the regular expression used to
-     * match the request pathname, unless an optional boolean is
-     * passed "flatten_regex" which will flatten the regular
-     * expression into a simple path string
-     *
-     * This method, and its style of reverse-compilation, was originally
-     * inspired by a similar effort by Gilles Bouthenot (@gbouthenot)
-     *
-     * @link https://github.com/gbouthenot
-     * @param string $route_name        The name of the route
-     * @param array $params             The array of placeholder fillers
-     * @param boolean $flatten_regex    Optionally flatten custom regular expressions to "/"
-     * @throws OutOfBoundsException     If the route requested doesn't exist
-     * @access public
-     * @return string
-     */
-    public function getPathFor($route_name, array $params = null, $flatten_regex = true)
-    {
-        $path = rtrim(Di::getDefault()->get('config')->get('global', 'base_url'), '/').$route_name;
-        if (preg_match_all(static::ROUTE_COMPILE_REGEX, $path, $matches, PREG_SET_ORDER)) {
-            foreach ($matches as $match) {
-                list($block, $pre, $inner_block, $type, $param, $optional) = $match;
-                if (isset($params[$param])) {
-                    $path = str_replace($block, $pre. $params[$param], $path);
-                } elseif ($optional) {
-                    $path = str_replace($block, '', $path);
-                }
-            }
-        } elseif ($flatten_regex && strpos($path, '@') === 0) {
-            $path = '/';
-        }
-        return $path;
-    }
-    /**
-     * Return current URI without the base URL
-     *
-     * @return string
-     */
-    public function getCurrentUri()
-    {
-        $baseUrl = rtrim(Di::getDefault()->get('config')->get('global', 'base_url'), '/');
-        return preg_replace('/^'.preg_quote($baseUrl, '/').'/', '', $this->request()->uri());
-    }
-    /**
-     * 
-     * @param type $methodName
-     * @return type
-     */
-    public static function getApiVersion($methodName)
-    {
-        if (isset(static::$routeApiVersion[$methodName])) {
-            return static::$routeApiVersion[$methodName];
-        }
-        return array();
-    }
-    /**
-     * 
-     * @param type $routesList
-     */
-    protected function computeApiVersion($routesList)
-    {
-        foreach ($routesList as $moduleName => $routesAndControllers) {
-            foreach ($routesAndControllers as $controllerName => $routes) {
-                foreach ($routes as $action => $info) {
-                    if (isset($info['api_route']) && isset($info['api_version']) && isset($info['method_type'])) {
-                        $route = $this->fullPath($moduleName, $info['api_route'], 'api');
-                        if (isset($this->tmpRoute[$route][$info['method_type']])) {
-                            static::$routeApiVersion[$this->tmpRoute[$route][$info['method_type']]][$info['api_version']] = $action;
-                        }
-                    }
-                }
-            }
-        }
-    }
-    /**
-     * 
-     * @param string $moduleName
-     * @param string $route
-     * @param string $routePrefix
-     * @return string
-     */
-    protected function fullPath($moduleName, $route, $routePrefix='')
-    {
-        $baseUrl = rtrim(Di::getDefault()->get('config')->get('global', 'base_url'), '/');
-        if (!empty($routePrefix)) {
-            $baseUrl .= '/' . $routePrefix;
-        }
-        if (!in_array($moduleName, $this->mainRouteModules)) {
-            return $baseUrl . '/' . $moduleName . $route;
-        }
-        return $baseUrl . '/' . $route;
-    }
-}

--- a/core/internal/Session.php
+++ b//dev/null
@@ -1,223 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Di;
-/**
- * Class for manage session
- *
- * The session manager use the application cache for store data
- *
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class Session
-{
-    private $savePath;
-    private $useCache = true;
-    /**
-     * Constructor
-     */
-    public function __construct()
-    {
-        $cache = Di::getDefault()->get('cache');
-        if ($cache->getAdapter() instanceof \Desarrolla2\Cache\Adapter\NotCache) {
-            $this->useCache = false;
-        }
-        session_set_save_handler(
-            array($this, 'open'),
-            array($this, 'close'),
-            array($this, 'read'),
-            array($this, 'write'),
-            array($this, 'destroy'),
-            array($this, 'gc')
-        );
-        register_shutdown_function('session_write_close');
-    }
-    /**
-     * Open the user session
-     *
-     * @param $savePath string The path for save session file
-     * @param $sessionName string The session name
-     * @return bool
-     */
-    public function open($savePath, $sessionName)
-    {
-        $this->savePath = $savePath;
-        return true;
-    }
-    /**
-     * Close the user session
-     *
-     * @return bool
-     */
-    public function close()
-    {
-        return true;
-    }
-    /**
-     * Read the data from the session storage
-     *
-     * @param $sessionId string The session ID
-     * @return bool
-     */
-    public function read($sessionId)
-    {
-        if ($this->useCache) {
-            try {
-                $sesssionData = Di::getDefault()->get('cache')->get('session::' . $sessionId);
-            } catch (\Exception $e) {
-                return "";
-            }
-        } else {
-            if (false === file_exists($this->savePath . '/sess_' . $sessionId)) {
-                return "";
-            }
-            $sesssionData = file_get_contents($this->savePath . '/sess_' . $sessionId);
-        }
-        if (is_null($sesssionData)) {
-            return "";
-        }
-        return $sesssionData;
-    }
-    /**
-     * Write the data to the session storage
-     *
-     * @param $sessionId string The session ID
-     * @return bool
-     */
-    public function write($sessionId, $data)
-    {
-        if (isset($_SESSION['user'])) {
-            /* Update session in db */
-            $dbconn = Di::getDefault()->get('db_centreon');
-            $router = Di::getDefault()->get('router');
-            $route = $router->request()->pathname();
-            try {
-                $stmt = $dbconn->prepare(
-                    'UPDATE `session` SET
-                        last_reload = :now,
-                        route = :route
-                        WHERE session_id = :session_id'
-                );
-                $stmt->bindParam(':now', time(), \PDO::PARAM_INT);
-                $stmt->bindParam(':route', $route, \PDO::PARAM_STR);
-                $stmt->bindParam(':session_id', $sessionId, \PDO::PARAM_STR);
-                $stmt->execute();
-            } catch (\Exception $e) {
-            }
-        }
-        if ($this->useCache) {
-            try {
-                Di::getDefault()->get('cache')->set('session::' . $sessionId, $data, session_cache_expire());
-            } catch (\Exception $e) {
-                return false;
-            }
-        } else {
-            $ret = file_put_contents($this->savePath . '/sess_' . $sessionId, $data, LOCK_EX);
-            if ($ret === false) {
-                return false;
-            }
-            chmod($this->savePath . '/sess_' . $sessionId, 0600);
-        }
-        return true;
-    }
-    /**
-     * Destroy a session
-     *
-     * @param $sessionId string The session ID
-     * @return bool
-     */
-    public function destroy($sessionId)
-    {
-        if ($this->useCache) {
-            try {
-                Di::getDefault()->get('cache')->delete('session::' . $sessionId);
-            } catch (\Exception $e) {
-                return false;
-            }
-        } else {
-            if (file_exists($this->savePath . '/sess_' . $sessionId)) {
-                return unlink($this->savePath . '/sess_' . $sessionId);
-            }
-        }
-        return true;
-    }
-    /**
-     * Purge old sessions
-     *
-     * @param $maxlifetime int The time life of sessions
-     * @return bool
-     */
-    public function gc($maxlifetime)
-    {
-        if (false === $this->useCache) {
-            foreach (glob($this->savePath . '/sess_*') as $file) {
-                if (filemtime($file) + $maxlifetime < time() && file_exists($file)) {
-                    unlink($file);
-                }
-            }
-        }
-        return true;
-    }
-    /**
-     * Initialize the user session in database
-     *
-     * @param $userId int The user ID
-     */
-    public static function init($userId)
-    {
-        $dbconn = Di::getDefault()->get('db_centreon');
-        $router = Di::getDefault()->get('router');
-        $route = $router->request()->pathname();
-        $ipAddress = $router->request()->ip();
-        try {
-            $stmt = $dbconn->prepare(
-                'INSERT INTO `session`
-                (session_id, user_id, session_start_time, last_reload, ip_address, route)
-                VALUES (:session_id, :user_id, :start_time, :last_reload, :ip_address, :route)'
-            );
-            $time = time();
-            $stmt->bindParam(':session_id', session_id(), \PDO::PARAM_STR);
-            $stmt->bindParam(':user_id', $userId, \PDO::PARAM_INT);
-            $stmt->bindParam(':start_time', $time, \PDO::PARAM_INT);
-            $stmt->bindParam(':last_reload', $time, \PDO::PARAM_INT);
-            $stmt->bindParam(':ip_address', $ipAddress, \PDO::PARAM_STR);
-            $stmt->bindParam(':route', $route, \PDO::PARAM_STR);
-            $stmt->execute();
-        } catch (\Exception $e) {
-        }
-    }
-}

--- a/core/internal/Template.php
+++ b//dev/null
@@ -1,347 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 MERETHIS
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give MERETHIS
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of MERETHIS choice, provided that
- * MERETHIS also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal;
-use Centreon\Internal\Di;
-use Centreon\Internal\Exception;
-/**
- * @author Lionel Assepo <lassepo@centreon.com>
- * @package Centreon
- * @subpackage Core
- */
-class Template extends \Smarty
-{
-    /**
-     *
-     * @var string 
-     */
-    private $templateFile;
-    /**
-     *
-     * @var array 
-     */
-    private $cssResources;
-    /**
-     *
-     * @var array 
-     */
-    private $jsTopResources;
-    /**
-     *
-     * @var array 
-     */
-    private $jsBottomResources;
-    /**
-     *
-     * @var array 
-     */
-    private $exclusionList;
-    /**
-     *
-     * @var string
-     */
-    private $customJs;
-    /**
-     * 
-     * @param string $newTemplateFile
-     * @param boolean $enableCaching
-     */
-    public function __construct($newTemplateFile = '', $enableCaching = 0)
-    {
-        $this->templateFile = $newTemplateFile;
-        $this->caching = $enableCaching;
-        $this->cssResources = array();
-        $this->jsTopResources = array();
-        $this->jsBottomResources = array();
-        $this->buildExclusionList();
-        $this->customJs = "";
-        parent::__construct();
-        $this->initConfig();
-        $menu = new Menu();
-        $this->assign('appMenu', $menu->getMenu());
-    }
-    /**
-     * 
-     */
-    public function initConfig()
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $this->setTemplateDir($this->buildTemplateDirList());
-        $this->addPluginsDir(realpath(__DIR__ . '/../custom/Smarty/'));
-        $this->setCompileDir($config->get('template', 'compile_dir'));
-        $this->setCacheDir($config->get('template', 'cache_dir'));
-        if ($config->get('template', 'debug')) {
-            $this->compile_check = true;
-            $this->force_compile = true;
-        }
-        /* Set the current route */
-        $this->assign('currentRoute', $di->get('router')->request()->pathname());
-    }
-    private function buildTemplateDirList()
-    {
-        $config = Di::getDefault()->get('config');
-        $path = rtrim($config->get('global', 'centreon_path'), '/');
-        $templateDirList = array();
-        $templateDirList['Core'] = realpath($path . '/core/views/');
-        foreach (glob($path . "/widgets/*Widget/views") as $widgetTemplateDir) {
-            if (preg_match('/\/([a-zA-Z0-9]+Widget)\//', $widgetTemplateDir, $matches)) {
-                $widgetTemplateDir = realpath($widgetTemplateDir);
-                $templateDirList[$matches[1]] = $widgetTemplateDir;
-            }
-        }
-        foreach (glob($path . "/modules/*Module/views") as $moduleTemplateDir) {
-            if (preg_match('/\/([a-zA-Z0-9]+Module)\//', $moduleTemplateDir, $matches)) {
-                $moduleTemplateDir = realpath($moduleTemplateDir);
-                $templateDirList[$matches[1]] = $moduleTemplateDir;
-            }
-        }
-        foreach (glob($path . "/modules/*Module/widgets/*Widget/views") as $widgetTemplateDir) {
-            if (preg_match('/\/([a-zA-Z0-9]+Widget)\//', $widgetTemplateDir, $matches)) {
-                $widgetTemplateDir = realpath($widgetTemplateDir);
-                $templateDirList[$matches[1]] = $widgetTemplateDir;
-            }
-        }
-        return $templateDirList;
-    }
-    /**
-     * Load statics file (css/js)
-     *
-     * jQuery, bootstrap, font-awesome and centreon
-     */
-    public function initStaticFiles()
-    {
-        /* Load css */
-        $this->addCss('bootstrap.min.css');
-        $this->addCss('dataTables.bootstrap.css');
-        $this->addCss('font-awesome.min.css');
-        $this->addCss('jquery-ui.min.css');
-        $this->addCss('centreon.qtip.css');
-        $this->addCss('centreon.css');
-        /* Load javascript */
-        $this->addJs('jquery.min.js');
-        $this->addJs('jquery-ui.min.js');
-        $this->addJs('jquery.qtip.min.js');
-        $this->addJs('centreon.help.tooltip.js');
-        $this->addJs('bootstrap.min.js');
-        $this->addJs('jquery.ba-resize.js');
-        $this->addJs('moment-with-langs.min.js');
-        $this->addJs('centreon.functions.js');
-        $this->addJs('centreon-timezone.js');
-        $this->addJs('centreon-wizard.js');
-        $this->addJs('centreon.csrf.js');
-        $this->addJs('jquery.metisMenu.js');
-        $this->addJs('centreon.custom.js');
-        $this->addJs('pace.min.js');
-        $this->addJs('jquery.slimscroll.min.js');
-        $this->addJs('moment-with-locales.js');
-        $this->addJs('moment-timezone-with-data.min.js');
-    }
-    /**
-     * @todo Maybe load this list from a config file
-     */
-    private function buildExclusionList()
-    {
-        $this->exclusionList = array(
-            'cssFileList',
-            'jsTopFileList',
-            'jsBottomFileList'
-        );
-    }
-    /**
-     * 
-     * {@inheritdoc}
-     * @throws \Centreon\Exception If the template file is not defined
-     */
-    public function display($template = null, $cache_id = null, $compile_id = null, $parent = null)
-    {
-        if ($this->templateFile === "") {
-            $this->templateFile = $template;
-        }
-        $this->loadResources();
-        $this->assign('customJs', $this->customJs);
-        parent::display($this->templateFile, $cache_id, $compile_id, $parent);
-    }
-    /**
-     * 
-     * {@inheritdoc}
-     * @throws \Centreon\Exception If the template file is not defined
-     * @return type
-     */
-    public function fetch(
-        $template = null,
-        $cache_id = null,
-        $compile_id = null,
-        $parent = null,
-        $display = false,
-        $merge_tpl_vars = true,
-        $no_output_filter = false
-    ) {
-        if ($this->templateFile === "" && is_null($template)) {
-            throw \Exception("Template is not defined.");
-        } else if ($this->templateFile !== "" && is_null($template)) {
-            $template = $this->templateFile;
-        }
-        $this->loadResources();
-        $this->assign('customJs', $this->customJs);
-        return parent::fetch(
-            $template,
-            $cache_id,
-            $compile_id,
-            $parent,
-            $display,
-            $merge_tpl_vars,
-            $no_output_filter
-        );
-    }
-    /**
-     * 
-     */
-    private function loadResources()
-    {
-        parent::assign('cssFileList', $this->cssResources);
-        parent::assign('jsTopFileList', $this->jsTopResources);
-        parent::assign('jsBottomFileList', $this->jsBottomResources);
-    }
-    /**
-     * 
-     * @param string $fileName $fileName CSS file to add
-     * @param string $module
-     * @return \Centreon\Template
-     * @throws Exception
-     */
-    public function addCss($fileName, $module = 'centreon')
-    {
-        if ($this->isStaticFileExist('css', $fileName, $module) === false) {
-            throw new Exception('The given file does not exist');
-        }
-        $config = Di::getDefault()->get('config');
-        $baseUrl = rtrim($config->get('global', 'base_url'), '/');
-        $fileName = $baseUrl . '/static/'  . $module . '/css/' . $fileName;
-        if (!in_array($fileName, $this->cssResources)) {
-            $this->cssResources[] = $fileName;
-        }
-        return $this;
-    }
-    /**
-     * 
-     * @param string $fileName Javascript file to add
-     * @param string $loadingLocation
-     * @param string $module
-     * @return \Centreon\Template
-     * @throws Exception
-     */
-    public function addJs($fileName, $loadingLocation = 'bottom', $module = 'centreon')
-    {
-        if ($this->isStaticFileExist('js', $fileName, $module) === false) {
-            throw new Exception('The given file does not exist');
-        }
-        switch(strtolower($loadingLocation)) {
-            case 'bottom':
-            default:
-                $jsArray = 'jsBottomResources';
-                break;
-            case 'top':
-                $jsArray = 'jsTopResources';
-                break;
-        }
-        $config = Di::getDefault()->get('config');
-        $baseUrl = rtrim($config->get('global', 'base_url'), '/');
-        $fileName = $baseUrl . '/static/' . $module . '/js/' . $fileName;
-        if (!in_array($fileName, $this->$jsArray)) {
-            $this->{$jsArray}[] = $fileName;
-        }
-        return $this;
-    }
-    /**
-     * 
-     * @param string $varName
-     * @param mixed $varValue
-     * @param boolean $nocache
-     * @return \Centreon\Template
-     * @throws \Centreon\Internal\Exception
-     */
-    public function assign($varName, $varValue = null, $nocache = false)
-    {
-        if (in_array($varName, $this->exclusionList)) {
-            throw new Exception(_('This variable name is reserved'));
-        }
-        parent::assign($varName, $varValue, $nocache);
-        return $this;
-    }
-    /**
-     * 
-     * @param string $type
-     * @param string $filename
-     * @param string $module
-     * @return boolean
-     * @throws \Centreon\Internal\Exception
-     */
-    private function isStaticFileExist($type, $filename, $module)
-    {
-        $di = Di::getDefault();
-        $config = $di->get('config');
-        $centreonPath = rtrim($config->get('global', 'centreon_path'), '/');
-        $basePath = $centreonPath . '/www/static/' . $module . '/' . strtolower($type) . '/';
-        if (!file_exists($basePath . $filename)) {
-            if (strtolower($type) == 'css') {
-                $filename = $centreonPath . '/www/static/' . $module . '/less/' .
-                    str_replace('.css', '.less', $filename);
-                if (file_exists($filename)) {
-                    return true;
-                }
-            }
-            return false;
-        }
-        return true;
-    }
-    /**
-     * Add custom js code
-     *
-     * @param string $jsStr
-     */
-    public function addCustomJs($jsStr)
-    {
-        $this->customJs .= $jsStr . "\n";
-    }
-    /**
-     * Getter
-     *
-     * @return string
-     */
-    public function getCustomJs()
-    {
-        return $this->customJs;
-    }
-}

--- a/core/internal/Utils/CentreonArray.php
+++ b//dev/null
@@ -1,90 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils;
-/**
- * Utils for Array in Centreon
- *
- * @authors Lionel Assepo
- * @package Centreon
- * @subpackage Core
- */
-class CentreonArray
-{
-    /**
-    * 
-    * @param array $array
-    * @return int
-    */
-   public static function arrayDepth(array $array)
-   {
-       $max_depth = 1;
-       foreach ($array as $value) {
-           if (is_array($value)) {
-               $depth = arrayDepth($value) + 1;
-               if ($depth > $max_depth) {
-                   $max_depth = $depth;
-               }
-           }
-       }
-       return $max_depth;
-   }
-   /**
-    * Inserts values after specific key.
-    *
-    * @param array $array
-    * @param sting/integer $position
-    * @param array $values
-    * @return array
-    * @throws \Exception
-    */
-   public static function insertAfter(array &$array, $position, array $values)
-   {
-       if (!isset($array[$position]))
-       {
-           throw new \Exception(strtr('Array position does not exist (:1)', array(':1' => $position)));
-       }
-       $offset = 0;
-       foreach ($array as $key => $value)
-       {
-           ++$offset;
-           if ($key == $position)
-           {
-               break;
-           }
-       }
-       $array = array_slice($array, 0, $offset, true) + $values + array_slice($array, $offset, null, true);
-       return $array;
-   }
-}

--- a/core/internal/Utils/CommandLine/Colorize.php
+++ b//dev/null
@@ -1,176 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\CommandLine;
-/**
- * 
- *
- * @authors Lionel Assepo
- * @package Core
- * @subpackage Internals
- */
-class Colorize
-{
-    /**
-     * 
-     * @param type $text
-     * @param type $status
-     * @return string
-     */
-    public static function colorizeMessage($text, $status = "success", $background = "black")
-    {
-        $colorizedMessage = chr(27);
-        switch (strtolower($status)) {
-            default:
-            case "success":
-                $colorizedMessage .= self::getColor("bgreen");
-                break;
-            case "primary":
-                $colorizedMessage .= self::getColor("bblue");
-                break;
-            case "info":
-                $colorizedMessage .= self::getColor("bcyan");
-                break;
-            case "warning":
-                $colorizedMessage .= self::getColor("byellow");
-                break;
-            case "danger":
-                $colorizedMessage .= self::getColor("bred");
-                break;
-        }
-        $colorizedMessage .=  self::getBackground($background) . $text . self::resetColor();
-        return $colorizedMessage;
-    }
-    /**
-     * 
-     * @param string $text
-     * @param string $color
-     * @param string $background
-     * @param boolean $bold
-     * @return string
-     */
-    public static function colorizeText($text, $color = "white", $background = "black", $bold = false)
-    {
-        if ($bold) {
-            $color = 'b' . $color;
-        }
-        $colorizedText = chr(27) . self::getColor($color) . self::getBackground($background) . $text . self::resetColor();
-        return $colorizedText;
-    }
-    /**
-     * 
-     * @return string
-     */
-    private static function resetColor()
-    {
-        return chr(27) . "[0m";
-    }
-    /**
-     * 
-     * @param string $color
-     * @return string
-     */
-    private static function getColor($color)
-    {
-        $finalColor = "";
-        switch (strtolower($color)) {
-            default:
-            case "white":
-                $finalColor .= "[0;37m";
-                break;
-            case "bwhite":
-                $finalColor .= "[1;37m";
-                break;
-            case "cyan":
-                $finalColor .= "[0;36m";
-                break;
-            case "bcyan":
-                $finalColor .= "[1;36m";
-                break;
-            case "purple":
-                $finalColor .= "[0;35m";
-                break;
-            case "bpurple":
-                $finalColor .= "[1;35m";
-                break;
-            case "blue":
-                $finalColor .= "[0;34m";
-                break;
-            case "bblue":
-                $finalColor .= "[1;34m";
-                break;
-            case "yellow":
-                $finalColor .= "[0;33m";
-                break;
-            case "byellow":
-                $finalColor .= "[1;33m";
-                break;
-            case "green":
-                $finalColor .= "[0;32m";
-                break;
-            case "bgreen":
-                $finalColor .= "[1;32m";
-                break;
-            case "red":
-                $finalColor .= "[0;31m";
-                break;
-            case "bred":
-                $finalColor .= "[1;31m";
-                break;
-            case "black":
-                $finalColor .= "[0;30m";
-                break;
-            case "bblack":
-                $finalColor .= "[1;30m";
-                break;
-        }
-        return $finalColor;
-    }
-    /**
-     * 
-     * @param string $background
-     * @return string
-     */
-    private static function getBackground($background)
-    {
-        $finalBackground = "";
-        switch ($background) {
-            default:
-            case "black":
-                $finalBackground . "[40m";
-                break;
-        }
-        return $finalBackground;
-    }
-}

--- a/core/internal/Utils/CommandLine/InputOutput.php
+++ b//dev/null
@@ -1,91 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\CommandLine;
-use Centreon\Internal\Utils\CommandLine\Colorize;
-/**
- * Utils to Prompt and display in COmmand line
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class InputOutput
-{
-    /**
-     * 
-     * @param string $message
-     * @param type $conditions
-     * @return type
-     */
-    public static function prompt($message = "", $conditions = null)
-    {
-        $returnNotOk = true;
-        $message = Colorize::colorizeText($message, "blue");
-        $promptMessage = $message;
-        while ($returnNotOk) {
-            echo $promptMessage . " => ";
-            $userAnswer = trim(fgets(STDIN));
-            if (isset($conditions)) {
-                $conditions($userAnswer, $result);
-                if ($result['success']) {
-                    $returnNotOk = false;
-                } else {
-                    $promptMessage = Colorize::colorizeText($result['message'], "red") . "\n" . $message;
-                }
-            } else {
-                $returnNotOk = false;
-            }
-        }
-        return $userAnswer;
-    }
-    /**
-     * 
-     * @param string $message
-     * @param boolean $withEndOfLine
-     * @param string $color
-     */
-    public static function display($message, $withEndOfLine = true, $color = null)
-    {
-        $endOfLine = "";
-        if (isset($color)) {
-            $message = Colorize::colorizeText($message, $color);
-        }
-        if ($withEndOfLine) {
-            $endOfLine .= "\n";
-        }
-        echo $message . $endOfLine;
-    }
-}

--- a/core/internal/Utils/DateInterval.php
+++ b//dev/null
@@ -1,71 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- */
-namespace Centreon\Internal\Utils;
-/**
- * Class for simulate DateInterval and fix bug https://bugs.php.net/bug.php?id=45545
- *
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Core
- */
-class DateInterval
-{
-    public $y = 0;
-    public $m = 0;
-    public $d = 0;
-    public $h = 0;
-    public $i = 0;
-    public $s = 0;
-    /**
-     * Constructor
-     *
-     * Load a interval from a time in second
-     *
-     * @param int $timestamp time in second
-     */
-    public function __construct($timestamp)
-    {
-        $this->y = intval($timestamp / (60 * 60 * 24 * 365));
-        $timestamp -= $this->y * 60 * 60 * 24 * 365;
-        $this->m = intval($timestamp / (60 * 60 * 24 * 30));
-        $timestamp -= $this->m * 60 * 60 * 24 * 30;
-        $this->d = intval($timestamp / (60 * 60 * 24));
-        $timestamp -= $this->d * 60 * 60 * 24;
-        $this->h = intval($timestamp / (60 * 60));
-        $timestamp -= $this->h * 60 * 60;
-        $this->i = intval($timestamp / 60);
-        $timestamp -= $this->i * 60;
-        $this->s = $timestamp;
-    }
-}

--- a/core/internal/Utils/Datetime.php
+++ b//dev/null
@@ -1,110 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- */
-namespace Centreon\Internal\Utils;
-/**
- * Class for funtions to manipulate date and time
- *
- * @authors Maximilien Bersoult
- * @package Centreon
- */
-class Datetime
-{
-    const PRECISION_FULL = 1;
-    const PRECISION_FORMAT = 2;
-    const PRECISION_CHAR = 3;
-    /**
-     * Convert a time in seconds to human readable string
-     *
-     * @param int $diff The time in seconds
-     * @param int $precisionType The precision type for the string
-     * @param int $precision The precision
-     *                       The number of element if type is by format
-     *                       The number of character if type is by characters
-     * @return string
-     */
-    public static function humanReadable($diff, $precisionType = 1, $precision = 1)
-    {
-        /* List of format in Date interval */
-        $listFormat = array(
-            'y' => array('year', 'years'),
-            'm' => array('month', 'months'),
-            'd' => array('day', 'days'),
-            'h' => array('hour', 'hours'),
-            'i' => array('min', 'min'),
-            's' => array('sec', 'sec')
-        );
-        $dateInterval = new DateInterval($diff);
-        $formatedStr = '';
-        $newFormatedStr = '';
-        $count = 0;
-        /* Prepare string */
-        foreach ($listFormat as $format => $words) {
-            if ($dateInterval->$format > 0) {
-                if (strlen($newFormatedStr) > 0) {
-                    $newFormatedStr .= ' ';
-                }
-                $newFormatedStr .= $dateInterval->$format
-                    . ' '
-                    . ngettext($words[0], $words[1], $dateInterval->$format);
-                $count++;
-            }
-            /* Test for precision type format */
-            if ($precisionType == self::PRECISION_FORMAT && $count >= $precision) {
-                return $newFormatedStr;
-            }
-            /* Test for precision type character */
-            if ($precisionType == self::PRECISION_CHAR && strlen($newFormatedStr) >= $precision) {
-                if ($formatedStr === '') {
-                    return $newFormatedStr;
-                }
-                return $formatedStr;
-            }
-            $formatedStr = $newFormatedStr;
-        }
-        return $formatedStr;
-    }
-    /**
-     * Convert timestamp into human readable date time
-     *
-     * @param int $timestamp
-     * @return string
-     * @todo handle locales
-     */
-    public static function format($timestamp)
-    {
-        $format = 'Y-m-d H:i:s';
-        $datetime = date($format, $timestamp);
-        return $datetime;
-    }
-}

--- a/core/internal/Utils/Dependency/Graph.php
+++ b//dev/null
@@ -1,115 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\Dependency;
-/**
- * Graph Dependency class
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class Graph
-{
-    /**
-     *
-     * @var array 
-     */
-    private $nodes = array();
-    /**
-     * 
-     */
-    public function __construct()
-    {
-        ;
-    }
-    /**
-     * 
-     * @param string $nodeName
-     * @param array $dependencies
-     */
-    public function addNode($nodeName, $dependencies = array())
-    {
-        $myNode = new Graph\Node($nodeName);
-        foreach($dependencies as $dependency) {
-            $depNode = new Graph\Node($dependency['name']);
-            $myNode->addEdge($depNode);
-        }
-        $this->nodes[$nodeName] = $myNode;
-    }
-    /**
-     * 
-     * @param string $nodeName
-     * @return \Centreon\Internal\Utils\Dependency\Graph\Node
-     */
-    public function getNode($nodeName)
-    {
-        return $this->nodes[$nodeName];
-    }
-    /**
-     * 
-     * @param string $nodeName
-     */
-    public function removeNode($nodeName)
-    {
-        unset($this->nodes[$nodeName]);
-    }
-    /**
-     * 
-     * @param string $nodeName
-     * @param array $resolved
-     * @param array $seen
-     * @throws Exception
-     */
-    public function resolve($nodeName, array &$resolved, array &$seen)
-    {
-        $myNode = $this->getNode($nodeName);
-        $nodeEdges = $myNode->getEdges();
-        $seen[] = $nodeName;
-        foreach ($nodeEdges as $nodeEdge) {
-            $edgeName = $nodeEdge->getName();
-            if (!in_array($edgeName, $resolved)) {
-                if (in_array($edgeName, $seen)) {
-                    throw new Exception(sprintf("Circular reference detected %s -> %s", $nodeName, $edgeName));
-                }
-                $this->resolve($edgeName, $resolved, $seen);
-            }
-        }
-        if (!in_array($nodeName, $resolved)) {
-            $resolved[] = $nodeName;
-            unset($seen[$nodeName]);
-        }
-    }
-}

--- a/core/internal/Utils/Dependency/Graph/Node.php
+++ b//dev/null
@@ -1,85 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\Dependency\Graph;
-/**
- * Description of Node
- *
- * @author lionel
- */
-class Node
-{
-    /**
-     *
-     * @var string 
-     */
-    private $name;
-    /**
-     *
-     * @var array 
-     */
-    private $edges = array();
-    /**
-     * 
-     * @param string $nodeName
-     */
-    public function __construct($nodeName)
-    {
-        $this->name = $nodeName;
-    }
-    /**
-     * 
-     * @return string
-     */
-    public function getName()
-    {
-        return $this->name;
-    }
-    /**
-     * 
-     * @return array
-     */
-    public function getEdges()
-    {
-        return $this->edges;
-    }
-    /**
-     * 
-     * @param \Centreon\Internal\Utils\Dependency\Graph\Node $node
-     */
-    public function addEdge(Node $node)
-    {
-        $this->edges[] = $node;
-    }
-}

--- a/core/internal/Utils/Dependency/PhpDependencies.php
+++ b//dev/null
@@ -1,75 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\Dependency;
-/**
- * Check for PHP Dependencies
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class PhpDependencies
-{
-    /**
-     * 
-     * @param array $dependencies
-     * @param boolean $strict
-     * @param boolean $fullScan
-     * @return array
-     * @throws Exception
-     */
-    public static function checkDependencies($dependencies = array(), $strict = true, $fullScan = true)
-    {
-        $status = true;
-        $errors = array();
-        $nbDependencies = count($dependencies);
-        foreach ($dependencies as $dependency) {
-            if (!extension_loaded($dependency)) {
-                $message = 'Mandatory PHP module ' . $dependency . 'is not available';
-                if ($strict) {
-                    if (($nbDependencies == 0) || (!$fullScan)) {
-                        throw new Exception($message, 1);
-                    }
-                    $nbDependencies--;
-                } else {
-                    $status = false;
-                    $errors[] = array($message);
-                }
-            }
-        }
-        return array('success' => $status, 'errors' => $errors);
-    }
-}

--- a/core/internal/Utils/Filesystem/Directory.php
+++ b//dev/null
@@ -1,117 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\Filesystem;
-use Centreon\Internal\Exception;
-/**
- * Utils for filesystem directories
- *
- * @author Maximilien Bersoult
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class Directory
-{
-    /**
-     * @var array List of directory where cannot delete files
-     */
-    private static $securityDir = array(
-        '',
-        '/etc',
-        '/usr',
-        '/var',
-        '/'
-    );
-    /**
-     * Delete a directory with recursive
-     * Check some security before delete
-     *
-     * @param string $dirname The directory to delete
-     * @param boolean $recursive If delete recursive or not
-     * @return boolean
-     */
-    public static function delete($dirname, $recursive = false)
-    {
-        if (in_array($dirname, self::$securityDir)) {
-            return false;
-        }
-        $dirname = realpath($dirname);
-        if (false === $dirname || false === is_dir($dirname)) {
-            return false;
-        }
-        if (false === $recursive) {
-           return rmdir($dirname);
-        }
-        $ok = true;
-        $fh = opendir($dirname);
-        while ($file = readdir($fh)) {
-            if ($file != '.' && $file != '..') {
-                $filename = $dirname . '/' . $file;
-                if (is_dir($filename)) {
-                    if (false === self::delete($filename, $recursive)) {
-                        $ok = false;
-                    }
-                } else {
-                    if (false === unlink($filename)) {
-                        $ok = false;
-                    }
-                } 
-            }
-        } 
-        closedir($fh);
-        if (false === $ok) {
-            return false;
-        }
-        return rmdir($dirname);
-    }
-    /**
-     * Get the temporary name for a directory
-     *
-     * @param string $prefix The prefix for the temporary directory
-     * @param boolean $create If create the directory
-     * @return string The full path of temporary directory
-     * @throws \Centreon\Internal\Exception When cannot create the directory
-     */
-    public static function temporary($prefix = '', $create = false)
-    {
-        $dirname = sys_get_temp_dir() . '/' . uniqid($prefix);
-        if ($create) {
-            if (false === mkdir($dirname)) {
-                throw new Exception('Error when create temporary directory');
-            }
-        }
-        return $dirname;
-    }
-}

--- a/core/internal/Utils/Filesystem/File.php
+++ b//dev/null
@@ -1,69 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\Filesystem;
-/**
- * Utils for filesystem files
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class File
-{
-    /**
-     * 
-     * @param string $dirname
-     * @param string $extension
-     * @return array
-     */
-    public static function getFiles($dirname, $extension)
-    {
-        $finalFileList = array();
-        $path = realpath($dirname);
-        if (file_exists($path)) {
-            $listOfFiles = glob($path . '/*');
-            while (count($listOfFiles) > 0) {
-                $currentFile = array_shift($listOfFiles);
-                if (is_dir($currentFile)) {
-                    $listOfFiles = array_merge($listOfFiles, glob($currentFile . '/*'));
-                } elseif (pathinfo($currentFile, PATHINFO_EXTENSION) == $extension) {
-                    $finalFileList[] = $currentFile;
-                }
-            }
-        }
-        return $finalFileList;
-    }
-}

--- a/core/internal/Utils/HumanReadable.php
+++ b//dev/null
@@ -1,141 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- */
-namespace Centreon\Internal\Utils;
-/**
- * Convert a value in human readable
- *
- * @authors Maximilien Bersoult
- * @package Centreon
- */
-class HumanReadable
-{
-    public static $units = array(
-        'o' => array(
-            'smaller' => false,
-            'divider' => 1024,
-            'units' => array('o','ko','Mo','Go','To','Po','Eo','Zo','Yo')
-        ),
-        'B' => array(
-            'smaller' => false,
-            'divider' => 1024,
-            'units' => array('B','kB','MB','GB','TB','PB','EB','ZB','YB')
-        ),
-        'b' => array(
-            'smaller' => false,
-            'divider' => 1000,
-            'units' => array('b','kb','Mb','Gb','Tb','Pb','Eb','Zb','Yb')
-        ),
-        's' => array(
-            'smaller' => true,
-            'function' => "self::seconds"
-        )
-    );
-    /**
-     * Convert a array for human readable
-     *
-     * @param array $values The array of values (float or int)
-     * @param string $unit The string of the unit
-     * @param string $newUnit The new unit string
-     * @param int $decimal The number of decimal for the result
-     * @return array
-     */
-    public static function convertArray($values, $unit, &$newUnit, $decimal = null)
-    {
-        if (false === in_array($unit, array_keys(self::$units))) {
-            return $values;
-        }
-        /* Getting the factor */
-        $factor = self::getFactor($values, $decimal);
-        if (false === $factor) {
-        } else {
-            $newUnit = self::$units[$unit]['units'][$factor];
-            return self::convertArrayWithFactor($values, $unit, $factor, $decimal);
-        }
-    }
-    /**
-     * Convert a array for human readable with a factor
-     *
-     * @param array $values The array of values (float or int)
-     * @param string $unit The string of the unit
-     * @param int $factor The factor for divide
-     * @param int $decimal The number of decimal for the result
-     * @return array
-     */
-    public static function convertArrayWithFactor($values, $unit, $factor, $decimal = null)
-    {
-        if (false === in_array($unit, array_keys(self::$units)) && is_null($decimal)) {
-            return $values;
-        } elseif (false === in_array($unit, array_keys(self::$units))) {
-            return array_map(
-                function ($value) use ($decimal) {
-                    if (is_null($value)) {
-                        return $value;
-                    }
-                    return sprintf("%.{$decimal}f", $value);
-                },
-                $values
-            );
-        }
-        if (isset(self::$units[$unit]['divider'])) {
-            $divider = self::$units[$unit]['divider'];
-            return array_map(
-                function ($value) use ($factor, $decimal, $divider) {
-                    if (is_null($value)) {
-                        return $value;
-                    }
-                    if (is_null($decimal)) {
-                        return $value / pow($divider, $factor);
-                    } else {
-                        return sprintf("%.{$decimal}f", $value / pow($divider, $factor));
-                    }
-                },
-                $values
-            );
-        }
-    }
-    /**
-     * Return the factor for convert
-     *
-     * @param array $values The array of values (float or int)
-     * @return int|bool The factor or false if the max is < 0
-     */
-    public static function getFactor($values)
-    {
-        $max = intval(max($values));
-        if ($max > 0) {
-            return floor((strlen($max) - 1) / 3);
-        }
-        return false;
-    }
-}

--- a/core/internal/Utils/Status.php
+++ b//dev/null
@@ -1,129 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Utils;
-/**
- * Utils class for status
- *
- * @authors Maximilien Bersoult
- * @package Centreon
- * @subpackage Utils
- */
-class Status
-{
-    const SERVICE_OK = 0;
-    const SERVICE_WARNING = 1;
-    const SERVICE_CRITICAL = 2;
-    const SERVICE_UNKNOWN = 3;
-    const SERVICE_PENDING = 4;
-    const HOST_UP = 0;
-    const HOST_DOWN = 1;
-    const HOST_UNREACHABLE = 2;
-    const HOST_PENDING = 4;
-    const EVENT_OK = 0;
-    const EVENT_WARNING = 1;
-    const EVENT_CRITICAL = 2;
-    const EVENT_UNKNOWN = 3;
-    const EVENT_PENDING = 4;
-    const EVENT_INFORMATION = 5;
-    const TYPE_SERVICE = 1;
-    const TYPE_HOST = 2;
-    const TYPE_EVENT = 3;
-    private static $status = array(
-        self::TYPE_SERVICE => array(
-            self::SERVICE_OK => 'Ok',
-            self::SERVICE_WARNING => 'Warning',
-            self::SERVICE_CRITICAL => 'Critical',
-            self::SERVICE_UNKNOWN => 'Unknown',
-            self::SERVICE_PENDING => 'Pending'
-        ),
-        self::TYPE_HOST => array(
-            self::HOST_UP => 'Up',
-            self::HOST_DOWN => 'Down',
-            self::HOST_UNREACHABLE => 'Unreachable',
-            self::HOST_PENDING => 'Pending'
-        ),
-        self::TYPE_EVENT => array(
-            self::EVENT_OK => 'Ok',
-            self::EVENT_WARNING => 'Warning',
-            self::EVENT_CRITICAL => 'Critical',
-            self::EVENT_UNKNOWN => 'Unknown',
-            self::EVENT_PENDING => 'Pending',
-            self::EVENT_INFORMATION => 'Information'
-        )
-    );
-    /** 
-     * Convert a status number to string
-     *
-     * \Centreon\Utils\Status::numToString(
-     *   1,
-     *   \Centreon\Utils\Status::TYPE_SERVICE
-     * );
-     *
-     * @param int $numStatus The number status
-     * @param int $typeStatus The type of the status
-     * @return string
-     * @throws \OutOfBoundsException
-     */
-    public static function numToString($numStatus, $typeStatus, $translate = false)
-    {
-        if (false === isset(self::$status[$typeStatus]) ||
-            false === isset(self::$status[$typeStatus][$numStatus])) {
-            throw new \OutOfBoundsException("Status type or status number does not exists");
-        }
-        if ($translate) {
-            return _(self::$status[$typeStatus][$numStatus]);
-        }
-        return self::$status[$typeStatus][$numStatus];
-    }
-    /**
-     * Convert a status string to number
-     *
-     * @param string $textStatus The text status
-     * @param int $typeStatus The type of the status
-     * @return int
-     * @throws \OutOfBoundsException
-     */
-    public static function stringToNum($textStatus, $typeStatus)
-    {
-        if (false === isset(self::$status[$typeStatus])) {
-            throw new \OutOfBoundsException("Status type does not exists");
-        }
-        $key = array_search($textStatus, self::$status[$typeStatus]);
-        if (false === $key) {
-            throw new \OutOfBoundsException("Status text does not exists");
-        }
-        return $key;
-    }
-}

--- a/core/internal/Utils/String/CamelCaseTransformation.php
+++ b//dev/null
@@ -1,86 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- * 
- * This program is free software; you can redistribute it and/or modify it under 
- * the terms of the GNU General Public License as published by the Free Software 
- * Foundation ; either version 2 of the License.
- * 
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- * 
- * You should have received a copy of the GNU General Public License along with 
- * this program; if not, see <http://www.gnu.org/licenses>.
- * 
- * Linking this program statically or dynamically with other modules is making a 
- * combined work based on this program. Thus, the terms and conditions of the GNU 
- * General Public License cover the whole combination.
- * 
- * As a special exception, the copyright holders of this program give CENTREON 
- * permission to link this program with independent modules to produce an executable, 
- * regardless of the license terms of these independent modules, and to copy and 
- * distribute the resulting executable under terms of CENTREON choice, provided that 
- * CENTREON also meet, for each linked independent module, the terms  and conditions 
- * of the license of that module. An independent module is a module which is not 
- * derived from this program. If you modify this program, you may extend this 
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- * 
- * For more information : contact@centreon.com
- * 
- */
-namespace Centreon\Internal\Utils\String;
-/**
- * Utils for CamelCase strings
- *
- * @author Lionel Assepo
- * @version 3.0.0
- * @package Centreon
- * @subpackage Core
- */
-class CamelCaseTransformation
-{
-    /**
-     * 
-     */
-    const REGEX = '/((?:^|[A-Z])[a-z]+)/';
-    /**
-     * 
-     * @param string $string
-     * @param string $separator
-     * @return string
-     */
-    public static function camelCaseToCustom($string, $separator = "")
-    {
-        $matches = array();
-        preg_match_all(self::REGEX, $string, $matches);
-        return implode($separator, $matches[0]);
-    }
-    /**
-     * 
-     * @param string $string
-     * @param string $separator
-     * @return string
-     */
-    public static function customToCamelCase($string, $separator = "")
-    {
-        $stringExploded = ucwords(implode(' ', explode($separator, $string)));
-        return str_replace(' ', '', $stringExploded);
-    }
-    /**
-     * 
-     * @param string $string
-     * @return boolean
-     */
-    public static function isCamelCase($string)
-    {
-        $isCamelCase = false;
-        if (preg_match(self::REGEX, $string) === 1) {
-            $isCamelCase = true;
-        }
-        return $isCamelCase;
-    }
-}

--- a/core/internal/Utils/Tree.php
+++ b//dev/null
@@ -1,55 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Utils;
-/**
- * Utils class 
- *
- * @author Sylvestre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Utils
- */
-class Tree
-{
-    /**
-     * Prepend text with tree branch icon
-     *
-     * @param string $text
-     * @return string
-     */
-    public static function formatChild($text)
-    {
-        return "&nbsp;&nbsp;|&nbsp;&nbsp;{$text}";
-    }
-}

--- a/core/internal/Utils/YesNoDefault.php
+++ b//dev/null
@@ -1,64 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- */
-namespace Centreon\Internal\Utils;
-/**
- * Utils class 
- *
- * @author Sylvestre Ho <sho@centreon.com>
- * @package Centreon
- * @subpackage Utils
- */
-class YesNoDefault
-{
-    const YES = 1;
-    const NO = 0;
-    const DFLT = 2;
-    /**
-     * Convert yes / no / default int values to string
-     *
-     * @param int $val
-     * @return string
-     */
-    public static function toString($val)
-    {
-        if ($val == self::YES) {
-            return _('Yes');
-        }
-        if ($val == self::NO) {
-            return _('No');
-        }
-        return "";
-    }
-}

--- a/core/models/Aclgroup/Aclaction.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Models\Relation\Aclgroup;
-use Centreon\Models\CentreonRelationModel;
-class Aclaction extends CentreonRelationModel
-{
-    protected static $relationTable = "cfg_acl_group_actions_relations";
-    protected static $firstKey = "acl_group_id";
-    protected static $secondKey = "acl_action_id";
-    public static $firstObject =  "\Centreon\Models\Acl\Group";
-    public static $secondObject = "\Centreon\Models\Acl\Action";
-}

--- a/core/models/Aclgroup/Aclmenu.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-/*
- * Copyright 2005-2015 CENTREON
- * Centreon is developped by : Julien Mathis and Romain Le Merlus under
- * GPL Licence 2.0.
- *
- * This program is free software; you can redistribute it and/or modify it under
- * the terms of the GNU General Public License as published by the Free Software
- * Foundation ; either version 2 of the License.
- *
- * This program is distributed in the hope that it will be useful, but WITHOUT ANY
- * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
- * PARTICULAR PURPOSE. See the GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License along with
- * this program; if not, see <http://www.gnu.org/licenses>.
- *
- * Linking this program statically or dynamically with other modules is making a
- * combined work based on this program. Thus, the terms and conditions of the GNU
- * General Public License cover the whole combination.
- *
- * As a special exception, the copyright holders of this program give CENTREON
- * permission to link this program with independent modules to produce an executable,
- * regardless of the license terms of these independent modules, and to copy and
- * distribute the resulting executable under terms of CENTREON choice, provided that
- * CENTREON also meet, for each linked independent module, the terms  and conditions
- * of the license of that module. An independent module is a module which is not
- * derived from this program. If you modify this program, you may extend this
- * exception to your version of the program, but you are not obliged to do so. If you
- * do not wish to do so, delete this exception statement from your version.
- *
- * For more information : contact@centreon.com
- *
- *
- */
-namespace Centreon\Models\Relation\Aclgroup;
-use Centreon\Models\CentreonRelationModel;
-class Aclmenu extends CentreonRelationModel
-{
-    protected static $relationTable = "cfg_acl_groups_menus_relations";
-    protected static $firstKey = "acl_group_id";
-    protected static $secondKey = "acl_menu_id";
-    public static $firstObject =  "\Centreon\Models\Acl\Group";
-    public static $secondObject = "\Centreon\Models\Acl\Menu";
-}
