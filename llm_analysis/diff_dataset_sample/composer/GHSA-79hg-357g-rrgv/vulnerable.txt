# ====================================================================
# FILE: GPL_LIB/AutoComplete/autocomplete-1.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-107 ---
     1| function getXMLHTTP(){
     2|   var xhr=null;
     3|   if(window.XMLHttpRequest) // Firefox et autres
     4|   xhr = new XMLHttpRequest();
     5|   else if(window.ActiveXObject){ // Internet Explorer
     6|     try {
     7|       xhr = new ActiveXObject("Msxml2.XMLHTTP");
     8|     } catch (e) {
     9|       try {
    10|         xhr = new ActiveXObject("Microsoft.XMLHTTP");
    11|       } catch (e1) {
    12|         xhr = null;
    13|       }
    14|     }
    15|   }
    16|   else { // XMLHttpRequest non support� par le navigateur
    17|     alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
    18|   }
    19|   return xhr;
    20| }
    21| var _documentForm=null; // le formulaire contenant notre champ texte
    22| var _inputField=null; // le champ texte lui-m�me
    23| var _submitButton=null; // le bouton submit de notre formulaire
    24| function initAutoComplete(form,field,submit){
    25|   _documentForm=form;
    26|   _inputField=field;
    27|   _submitButton=submit;
    28|   _inputField.autocomplete="off";
    29|   creeAutocompletionListe();
    30|   _currentInputFieldValue=_inputField.value;
    31|   _oldInputFieldValue=_currentInputFieldValue;
    32|   cacheResults("",new Array())
    33|   setTimeout("mainLoop()",200)
    34| }
    35| var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
    36| var _currentInputFieldValue=""; // valeur actuelle du champ texte
    37| var _resultCache=new Object(); // m�canisme de cache des requetes
    38| function mainLoop(){
    39|   _currentInputFieldValue = _inputField.value;
    40|   if(_oldInputFieldValue!=_currentInputFieldValue){
    41|     var valeur=escapeURI(_currentInputFieldValue);
    42|     var suggestions=_resultCache[_currentInputFieldValue];
    43|     if(suggestions){ // la r�ponse �tait encore dans le cache
    44|       metsEnPlace(valeur,suggestions)
    45|     }else{
    46|       callSuggestions(valeur) // appel distant
    47|     }
    48|     _inputField.focus()
    49|   }
    50|   _oldInputFieldValue=_currentInputFieldValue;
    51|   setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
    52|   return true
    53| }
    54| function escapeURI(La){
    55|   if(encodeURIComponent) {
    56|     return encodeURIComponent(La);
    57|   }
    58|   if(escape) {
    59|     return escape(La)
    60|   }
    61| }
    62| var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
    63| var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
    64| function callSuggestions(valeur){
    65|   if(_xmlHttp&&_xmlHttp.readyState!=0){
    66|     _xmlHttp.abort()
    67|   }
    68|   _xmlHttp=getXMLHTTP();
    69|   if(_xmlHttp){
    70|     _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
    71|     _xmlHttp.onreadystatechange=function() {
    72|       if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
    73|         var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
    74|         cacheResults(valeur,liste)
    75|         metsEnPlace(valeur,liste)
    76|       }
    77|     };
    78|     _xmlHttp.send(null)
    79|   }
    80| }
    81| function cacheResults(debut,suggestions){
    82|   _resultCache[debut]=suggestions
    83| }
    84| function traiteXmlSuggestions(xmlDoc) {
    85|   var options = xmlDoc.getElementsByTagName('option');
    86|   var optionsListe = new Array();
    87|   for (var i=0; i < options.length; ++i) {
    88|     optionsListe.push(options[i].firstChild.data);
    89|   }
    90|   return optionsListe;
    91| }
    92| var _completeListe=null; // la liste contenant les suggestions
    93| function creeAutocompletionListe(){
    94|   _completeListe=document.createElement("UL");
    95|   _completeListe.id="completeDiv";
    96|   document.body.appendChild(_completeListe);
    97| }
    98| function metsEnPlace(valeur, liste) {
    99|   while(_completeListe.childNodes.length>0) {
   100|     _completeListe.removeChild(_completeListe.childNodes[0]);
   101|   }
   102|   for (var i=0; i < liste.length; ++i) {
   103|     var nouveauElmt = document.createElement("LI")
   104|     nouveauElmt.innerHTML = liste[i]
   105|     _completeListe.appendChild(nouveauElmt)
   106|   }
   107| }


# ====================================================================
# FILE: GPL_LIB/AutoComplete/autocomplete-2.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-176 ---
     1| function getXMLHTTP(){
     2|   var xhr=null;
     3|   if(window.XMLHttpRequest) // Firefox et autres
     4|   xhr = new XMLHttpRequest();
     5|   else if(window.ActiveXObject){ // Internet Explorer
     6|     try {
     7|       xhr = new ActiveXObject("Msxml2.XMLHTTP");
     8|     } catch (e) {
     9|       try {
    10|         xhr = new ActiveXObject("Microsoft.XMLHTTP");
    11|       } catch (e1) {
    12|         xhr = null;
    13|       }
    14|     }
    15|   }
    16|   else { // XMLHttpRequest non support� par le navigateur
    17|     alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
    18|   }
    19|   return xhr;
    20| }
    21| var _documentForm=null; // le formulaire contenant notre champ texte
    22| var _inputField=null; // le champ texte lui-m�me
    23| var _submitButton=null; // le bouton submit de notre formulaire
    24| function initAutoComplete(form,field,submit){
    25|   _documentForm=form;
    26|   _inputField=field;
    27|   _submitButton=submit;
    28|   _inputField.autocomplete="off";
    29|   creeAutocompletionDiv();
    30|   _currentInputFieldValue=_inputField.value;
    31|   _oldInputFieldValue=_currentInputFieldValue;
    32|   cacheResults("",new Array())
    33|   setTimeout("mainLoop()",200)
    34| }
    35| var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
    36| var _currentInputFieldValue=""; // valeur actuelle du champ texte
    37| var _resultCache=new Object(); // m�canisme de cache des requetes
    38| function mainLoop(){
    39|   _currentInputFieldValue = _inputField.value;
    40|   if(_oldInputFieldValue!=_currentInputFieldValue){
    41|     var valeur=escapeURI(_currentInputFieldValue);
    42|     var suggestions=_resultCache[_currentInputFieldValue];
    43|     if(suggestions){ // la r�ponse �tait encore dans le cache
    44|       metsEnPlace(valeur,suggestions)
    45|     }else{
    46|       callSuggestions(valeur) // appel distant
    47|     }
    48|     _inputField.focus()
    49|   }
    50|   _oldInputFieldValue=_currentInputFieldValue;
    51|   setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
    52|   return true
    53| }
    54| function escapeURI(La){
    55|   if(encodeURIComponent) {
    56|     return encodeURIComponent(La);
    57|   }
    58|   if(escape) {
    59|     return escape(La)
    60|   }
    61| }
    62| var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
    63| var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
    64| function callSuggestions(valeur){
    65|   if(_xmlHttp&&_xmlHttp.readyState!=0){
    66|     _xmlHttp.abort()
    67|   }
    68|   _xmlHttp=getXMLHTTP();
    69|   if(_xmlHttp){
    70|     _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
    71|     _xmlHttp.onreadystatechange=function() {
    72|       if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
    73|         var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
    74|         cacheResults(valeur,liste)
    75|         metsEnPlace(valeur,liste)
    76|       }
    77|     };
    78|     _xmlHttp.send(null)
    79|   }
    80| }
    81| function cacheResults(debut,suggestions){
    82|   _resultCache[debut]=suggestions
    83| }
    84| function traiteXmlSuggestions(xmlDoc) {
    85|   var options = xmlDoc.getElementsByTagName('option');
    86|   var optionsListe = new Array();
    87|   for (var i=0; i < options.length; ++i) {
    88|     optionsListe.push(options[i].firstChild.data);
    89|   }
    90|   return optionsListe;
    91| }
    92| function insereCSS(nom,regle){
    93|   if (document.styleSheets) {
    94|     var I=document.styleSheets[0];
    95|     if(I.addRule){ // m�thode IE
    96|       I.addRule(nom,regle)
    97|     }else if(I.insertRule){ // m�thode DOM
    98|       I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
    99|     }
   100|   }
   101| }
   102| function initStyle(){
   103|   var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
   104|   var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
   105|   var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
   106|   insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
   107|   insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
   108|   insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
   109| }
   110| function setStylePourElement(c,name){
   111|   c.className=name;
   112| }
   113| function calculateOffsetLeft(r){
   114|   return calculateOffset(r,"offsetLeft")
   115| }
   116| function calculateOffsetTop(r){
   117|   return calculateOffset(r,"offsetTop")
   118| }
   119| function calculateOffset(r,attr){
   120|   var kb=0;
   121|   while(r){
   122|     kb+=r[attr];
   123|     r=r.offsetParent
   124|   }
   125|   return kb
   126| }
   127| function calculateWidth(){
   128|   return _inputField.offsetWidth-2*1
   129| }
   130| function setCompleteDivSize(){
   131|   if(_completeDiv){
   132|     _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
   133|     _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
   134|     _completeDiv.style.width=calculateWidth()+"px"
   135|   }
   136| }
   137| function creeAutocompletionDiv() {
   138|   initStyle();
   139|   _completeDiv=document.createElement("DIV");
   140|   _completeDiv.id="completeDiv";
   141|   var borderLeftRight=1;
   142|   var borderTopBottom=1;
   143|   _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
   144|   _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
   145|   _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
   146|   _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
   147|   _completeDiv.style.zIndex="1";
   148|   _completeDiv.style.paddingRight="0";
   149|   _completeDiv.style.paddingLeft="0";
   150|   _completeDiv.style.paddingTop="0";
   151|   _completeDiv.style.paddingBottom="0";
   152|   setCompleteDivSize();
   153|   _completeDiv.style.visibility="visible";
   154|   _completeDiv.style.position="absolute";
   155|   _completeDiv.style.backgroundColor="white";
   156|   document.body.appendChild(_completeDiv);
   157|   setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
   158| }
   159| function metsEnPlace(valeur, liste){
   160|   while(_completeDiv.childNodes.length>0) {
   161|     _completeDiv.removeChild(_completeDiv.childNodes[0]);
   162|   }
   163|   for(var f=0; f<liste.length; ++f){
   164|     var nouveauDiv=document.createElement("DIV");
   165|     setStylePourElement(nouveauDiv,"AutoCompleteDiv");
   166|     var nouveauSpan=document.createElement("SPAN");
   167|     nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
   168|     nouveauDiv.appendChild(nouveauSpan);
   169|     _completeDiv.appendChild(nouveauDiv)
   170|   }
   171|   if(_completeDivRows>0) {
   172|     _completeDiv.height=16*_completeDivRows+4;
   173|   } else {
   174|     hideCompleteDiv();
   175|   }
   176| }


# ====================================================================
# FILE: GPL_LIB/AutoComplete/autocomplete-3-1.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-398 ---
     1| function getXMLHTTP(){
     2|   var xhr=null;
     3|   if(window.XMLHttpRequest) // Firefox et autres
     4|   xhr = new XMLHttpRequest();
     5|   else if(window.ActiveXObject){ // Internet Explorer
     6|     try {
     7|       xhr = new ActiveXObject("Msxml2.XMLHTTP");
     8|     } catch (e) {
     9|       try {
    10|         xhr = new ActiveXObject("Microsoft.XMLHTTP");
    11|       } catch (e1) {
    12|         xhr = null;
    13|       }
    14|     }
    15|   }
    16|   else { // XMLHttpRequest non support� par le navigateur
    17|     alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
    18|   }
    19|   return xhr;
    20| }
    21| var _documentForm=null; // le formulaire contenant notre champ texte
    22| var _inputField=null; // le champ texte lui-m�me
    23| var _submitButton=null; // le bouton submit de notre formulaire
    24| function initAutoComplete(form,field,submit){
    25|   _documentForm=form;
    26|   _inputField=field;
    27|   _submitButton=submit;
    28|   _inputField.autocomplete="off";
    29|   creeAutocompletionDiv();
    30|   _currentInputFieldValue=_inputField.value;
    31|   _oldInputFieldValue=_currentInputFieldValue;
    32|   cacheResults("",new Array())
    33|   document.onkeydown=onKeyDownHandler;
    34|   _inputField.onkeyup=onKeyUpHandler;
    35|   setTimeout("mainLoop()",200)
    36| }
    37| var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
    38| var _currentInputFieldValue=""; // valeur actuelle du champ texte
    39| var _resultCache=new Object(); // m�canisme de cache des requetes
    40| function mainLoop(){
    41|   if(_oldInputFieldValue!=_currentInputFieldValue){
    42|     var valeur=escapeURI(_currentInputFieldValue);
    43|     var suggestions=_resultCache[_currentInputFieldValue];
    44|     if(suggestions){ // la r�ponse �tait encore dans le cache
    45|       metsEnPlace(valeur,suggestions)
    46|     }else{
    47|       callSuggestions(valeur) // appel distant
    48|     }
    49|     _inputField.focus()
    50|   }
    51|   _oldInputFieldValue=_currentInputFieldValue;
    52|   setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
    53|   return true
    54| }
    55| function escapeURI(La){
    56|   if(encodeURIComponent) {
    57|     return encodeURIComponent(La);
    58|   }
    59|   if(escape) {
    60|     return escape(La)
    61|   }
    62| }
    63| var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
    64| var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
    65| function callSuggestions(valeur){
    66|   if(_xmlHttp&&_xmlHttp.readyState!=0){
    67|     _xmlHttp.abort()
    68|   }
    69|   _xmlHttp=getXMLHTTP();
    70|   if(_xmlHttp){
    71|     _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
    72|     _xmlHttp.onreadystatechange=function() {
    73|       if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
    74|         var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
    75|         cacheResults(valeur,liste)
    76|         metsEnPlace(valeur,liste)
    77|       }
    78|     };
    79|     _xmlHttp.send(null)
    80|   }
    81| }
    82| function cacheResults(debut,suggestions){
    83|   _resultCache[debut]=suggestions
    84| }
    85| function traiteXmlSuggestions(xmlDoc) {
    86|   var options = xmlDoc.getElementsByTagName('option');
    87|   var optionsListe = new Array();
    88|   for (var i=0; i < options.length; ++i) {
    89|     optionsListe.push(options[i].firstChild.data);
    90|   }
    91|   return optionsListe;
    92| }
    93| function insereCSS(nom,regle){
    94|   if (document.styleSheets) {
    95|     var I=document.styleSheets[0];
    96|     if(I.addRule){ // m�thode IE
    97|       I.addRule(nom,regle)
    98|     }else if(I.insertRule){ // m�thode DOM
    99|       I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
   100|     }
   101|   }
   102| }
   103| function initStyle(){
   104|   var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
   105|   var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
   106|   var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
   107|   insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
   108|   insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
   109|   insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
   110| }
   111| function setStylePourElement(c,name){
   112|   c.className=name;
   113| }
   114| function calculateOffsetLeft(r){
   115|   return calculateOffset(r,"offsetLeft")
   116| }
   117| function calculateOffsetTop(r){
   118|   return calculateOffset(r,"offsetTop")
   119| }
   120| function calculateOffset(r,attr){
   121|   var kb=0;
   122|   while(r){
   123|     kb+=r[attr];
   124|     r=r.offsetParent
   125|   }
   126|   return kb
   127| }
   128| function calculateWidth(){
   129|   return _inputField.offsetWidth-2*1
   130| }
   131| function setCompleteDivSize(){
   132|   if(_completeDiv){
   133|     _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
   134|     _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
   135|     _completeDiv.style.width=calculateWidth()+"px"
   136|   }
   137| }
   138| function creeAutocompletionDiv() {
   139|   initStyle();
   140|   _completeDiv=document.createElement("DIV");
   141|   _completeDiv.id="completeDiv";
   142|   var borderLeftRight=1;
   143|   var borderTopBottom=1;
   144|   _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
   145|   _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
   146|   _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
   147|   _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
   148|   _completeDiv.style.zIndex="1";
   149|   _completeDiv.style.paddingRight="0";
   150|   _completeDiv.style.paddingLeft="0";
   151|   _completeDiv.style.paddingTop="0";
   152|   _completeDiv.style.paddingBottom="0";
   153|   setCompleteDivSize();
   154|   _completeDiv.style.visibility="hidden";
   155|   _completeDiv.style.position="absolute";
   156|   _completeDiv.style.backgroundColor="white";
   157|   document.body.appendChild(_completeDiv);
   158|   setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
   159| }
   160| function metsEnPlace(valeur, liste){
   161|   while(_completeDiv.childNodes.length>0) {
   162|     _completeDiv.removeChild(_completeDiv.childNodes[0]);
   163|   }
   164|   for(var f=0; f<liste.length; ++f){
   165|     var nouveauDiv=document.createElement("DIV");
   166|     setStylePourElement(nouveauDiv,"AutoCompleteDiv");
   167|     var nouveauSpan=document.createElement("SPAN");
   168|     nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
   169|     nouveauDiv.appendChild(nouveauSpan);
   170|     _completeDiv.appendChild(nouveauDiv)
   171|   }
   172|   PressAction();
   173|   if(_completeDivRows>0) {
   174|     _completeDiv.height=16*_completeDivRows+4;
   175|   } else {
   176|     hideCompleteDiv();
   177|   }
   178| }
   179| var _lastKeyCode=null;
   180| var onKeyDownHandler=function(event){
   181|   if(!event&&window.event) {
   182|     event=window.event;
   183|   }
   184|   if(event) {
   185|     _lastKeyCode=event.keyCode;
   186|   }
   187| }
   188| var _eventKeycode = null;
   189| var onKeyUpHandler=function(event){
   190|   if(!event&&window.event) {
   191|     event=window.event;
   192|   }
   193|   _eventKeycode=event.keyCode;
   194|   if(_eventKeycode==40||_eventKeycode==38) {
   195|     blurThenGetFocus();
   196|   }
   197|   var N=rangeSize(_inputField);
   198|   var v=beforeRangeSize(_inputField);
   199|   var V=_inputField.value;
   200|   if(_eventKeycode!=0){
   201|     if(N>0&&v!=-1) {
   202|       V=V.substring(0,v);
   203|     }
   204|     if(_eventKeycode==13||_eventKeycode==3){
   205|       var d=_inputField;
   206|       if(_inputField.createTextRange){
   207|         var t=_inputField.createTextRange();
   208|         t.moveStart("character",_inputField.value.length);
   209|         _inputField.select()
   210|       } else if (d.setSelectionRange){
   211|         _inputField.setSelectionRange(_inputField.value.length,_inputField.value.length)
   212|       }
   213|     } else {
   214|       if(_inputField.value!=V) {
   215|         _inputField.value=V
   216|       }
   217|     }
   218|   }
   219|   if(_eventKeycode!=40&&_eventKeycode!=38) {
   220|   	_currentInputFieldValue=V;
   221|   }
   222|   if(handleCursorUpDownEnter(_eventKeycode)&&_eventKeycode!=0) {
   223|     PressAction();
   224|   }
   225| }
   226| function handleCursorUpDownEnter(eventCode){
   227|   if(eventCode==40){
   228|     highlightNewValue(_highlightedSuggestionIndex+1);
   229|     return false
   230|   }else if(eventCode==38){
   231|     highlightNewValue(_highlightedSuggestionIndex-1);
   232|     return false
   233|   }else if(eventCode==13||eventCode==3){
   234|     return false
   235|   }
   236|   return true
   237| }
   238| var _completeDivRows = 0;
   239| var _completeDivDivList = null;
   240| var _highlightedSuggestionIndex = -1;
   241| var _highlightedSuggestionDiv = null;
   242| function PressAction(){
   243|   _highlightedSuggestionIndex=-1;
   244|   var suggestionList=_completeDiv.getElementsByTagName("div");
   245|   var suggestionLongueur=suggestionList.length;
   246|   _completeDivRows=suggestionLongueur;
   247|   _completeDivDivList=suggestionList;
   248|   if(_currentInputFieldValue==""||suggestionLongueur==0){
   249|     hideCompleteDiv()
   250|   }else{
   251|     showCompleteDiv()
   252|   }
   253|   var trouve=false;
   254|   if(_currentInputFieldValue.length>0){
   255|     var indice;
   256|     for(indice=0; indice<suggestionLongueur; indice++){
   257|       if(getSuggestion(suggestionList.item(indice)).toUpperCase().indexOf(_currentInputFieldValue.toUpperCase())==0) {
   258|         trouve=true;
   259|         break
   260|       }
   261|     }
   262|   }
   263|   for(var i=0; i<suggestionLongueur; i++) {
   264|     setStylePourElement(suggestionList.item(i),"AutoCompleteDiv");
   265|   }
   266|   if(trouve){
   267|     _highlightedSuggestionIndex=indice;
   268|     _highlightedSuggestionDiv=suggestionList.item(_highlightedSuggestionIndex);
   269|   }else{
   270|     _highlightedSuggestionIndex=-1;
   271|     _highlightedSuggestionDiv=null
   272|   }
   273|   var supprSelection=false;
   274|   switch(_eventKeycode){
   275|     case 8:
   276|     case 33:
   277|     case 34:
   278|     case 35:
   279|     case 35:
   280|     case 36:
   281|     case 37:
   282|     case 39:
   283|     case 45:
   284|     case 46:
   285|       supprSelection=true;
   286|       break;
   287|     default:
   288|       break
   289|   }
   290|   if(!supprSelection&&_highlightedSuggestionDiv){
   291|     setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
   292|     var z;
   293|     if(trouve) {
   294|       z=getSuggestion(_highlightedSuggestionDiv).substr(0);
   295|     } else {
   296|       z=_currentInputFieldValue;
   297|     }
   298|     if(z!=_inputField.value){
   299|       if(_inputField.value!=_currentInputFieldValue) {
   300|         return;
   301|       }
   302|       if(_inputField.createTextRange||_inputField.setSelectionRange) {
   303|         _inputField.value=z;
   304|       }
   305|       if(_inputField.createTextRange){
   306|         var t=_inputField.createTextRange();
   307|         t.moveStart("character",_currentInputFieldValue.length);
   308|         t.select()
   309|       }else if(_inputField.setSelectionRange){
   310|         _inputField.setSelectionRange(_currentInputFieldValue.length,_inputField.value.length)
   311|       }
   312|     }
   313|   }else{
   314|     _highlightedSuggestionIndex=-1;
   315|   }
   316| }
   317| var _cursorUpDownPressed = null;
   318| function blurThenGetFocus(){
   319|   _cursorUpDownPressed=true;
   320|   _inputField.blur();
   321|   setTimeout("_inputField.focus();",10);
   322|   return
   323| }
   324| function rangeSize(n){
   325|   var N=-1;
   326|   if(n.createTextRange){
   327|     var fa=document.selection.createRange().duplicate();
   328|     N=fa.text.length
   329|   }else if(n.setSelectionRange){
   330|     N=n.selectionEnd-n.selectionStart
   331|   }
   332|   return N
   333| }
   334| function beforeRangeSize(n){
   335|   var v=0;
   336|   if(n.createTextRange){
   337|     var fa=document.selection.createRange().duplicate();
   338|     fa.moveEnd("textedit",1);
   339|     v=n.value.length-fa.text.length
   340|   }else if(n.setSelectionRange){
   341|     v=n.selectionStart
   342|   }else{
   343|     v=-1
   344|   }
   345|   return v
   346| }
   347| function cursorAfterValue(n){
   348|   if(n.createTextRange){
   349|     var t=n.createTextRange();
   350|     t.moveStart("character",n.value.length);
   351|     t.select()
   352|   } else if(n.setSelectionRange) {
   353|     n.setSelectionRange(n.value.length,n.value.length)
   354|   }
   355| }
   356| function getSuggestion(uneDiv){
   357|   if(!uneDiv) {
   358|     return null;
   359|   }
   360|   return trimCR(uneDiv.getElementsByTagName('span')[0].firstChild.data)
   361| }
   362| function trimCR(chaine){
   363|   for(var f=0,nChaine="",zb="\n\r"; f<chaine.length; f++) {
   364|     if (zb.indexOf(chaine.charAt(f))==-1) {
   365|       nChaine+=chaine.charAt(f);
   366|     }
   367|   }
   368|   return nChaine
   369| }
   370| function hideCompleteDiv(){
   371|   _completeDiv.style.visibility="hidden"
   372| }
   373| function showCompleteDiv(){
   374|   _completeDiv.style.visibility="visible";
   375|   setCompleteDivSize()
   376| }
   377| function highlightNewValue(C){
   378|   if(!_completeDivDivList||_completeDivRows<=0) {
   379|     return;
   380|   }
   381|   showCompleteDiv();
   382|   if(C>=_completeDivRows){
   383|     C=_completeDivRows-1
   384|   }
   385|   if(_highlightedSuggestionIndex!=-1&&C!=_highlightedSuggestionIndex){
   386|     setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
   387|     _highlightedSuggestionIndex=-1
   388|   }
   389|   if(C<0){
   390|     _highlightedSuggestionIndex=-1;
   391|     _inputField.focus();
   392|     return
   393|   }
   394|   _highlightedSuggestionIndex=C;
   395|   _highlightedSuggestionDiv=_completeDivDivList.item(C);
   396|   setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
   397|   _inputField.value=getSuggestion(_highlightedSuggestionDiv);
   398| }


# ====================================================================
# FILE: GPL_LIB/AutoComplete/autocomplete-3-2.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-429 ---
     1| function getXMLHTTP(){
     2|   var xhr=null;
     3|   if(window.XMLHttpRequest) // Firefox et autres
     4|   xhr = new XMLHttpRequest();
     5|   else if(window.ActiveXObject){ // Internet Explorer
     6|     try {
     7|       xhr = new ActiveXObject("Msxml2.XMLHTTP");
     8|     } catch (e) {
     9|       try {
    10|         xhr = new ActiveXObject("Microsoft.XMLHTTP");
    11|       } catch (e1) {
    12|         xhr = null;
    13|       }
    14|     }
    15|   }
    16|   else { // XMLHttpRequest non support� par le navigateur
    17|     alert("Votre navigateur ne supporte pas les objets XMLHTTPRequest...");
    18|   }
    19|   return xhr;
    20| }
    21| var _documentForm=null; // le formulaire contenant notre champ texte
    22| var _inputField=null; // le champ texte lui-m�me
    23| var _submitButton=null; // le bouton submit de notre formulaire
    24| function initAutoComplete(form,field,submit){
    25|   _documentForm=form;
    26|   _inputField=field;
    27|   _submitButton=submit;
    28|   _inputField.autocomplete="off";
    29|   creeAutocompletionDiv();
    30|   _currentInputFieldValue=_inputField.value;
    31|   _oldInputFieldValue=_currentInputFieldValue;
    32|   cacheResults("",new Array())
    33|   document.onkeydown=onKeyDownHandler;
    34|   _inputField.onkeyup=onKeyUpHandler;
    35|   _inputField.onblur=onBlurHandler;
    36|   window.onresize=onResizeHandler;
    37|   setTimeout("mainLoop()",200)
    38| }
    39| var _oldInputFieldValue=""; // valeur pr�c�dente du champ texte
    40| var _currentInputFieldValue=""; // valeur actuelle du champ texte
    41| var _resultCache=new Object(); // m�canisme de cache des requetes
    42| function mainLoop(){
    43|   if(_oldInputFieldValue!=_currentInputFieldValue){
    44|     var valeur=escapeURI(_currentInputFieldValue);
    45|     var suggestions=_resultCache[_currentInputFieldValue];
    46|     if(suggestions){ // la r�ponse �tait encore dans le cache
    47|       metsEnPlace(valeur,suggestions)
    48|     }else{
    49|       callSuggestions(valeur) // appel distant
    50|     }
    51|     _inputField.focus()
    52|   }
    53|   _oldInputFieldValue=_currentInputFieldValue;
    54|   setTimeout("mainLoop()",200); // la fonction se red�clenchera dans 200 ms
    55|   return true
    56| }
    57| function escapeURI(La){
    58|   if(encodeURIComponent) {
    59|     return encodeURIComponent(La);
    60|   }
    61|   if(escape) {
    62|     return escape(La)
    63|   }
    64| }
    65| var _xmlHttp = null; //l'objet xmlHttpRequest utilis� pour contacter le serveur
    66| var _adresseRecherche = "options.php" //l'adresse � interroger pour trouver les suggestions
    67| function callSuggestions(valeur){
    68|   if(_xmlHttp&&_xmlHttp.readyState!=0){
    69|     _xmlHttp.abort()
    70|   }
    71|   _xmlHttp=getXMLHTTP();
    72|   if(_xmlHttp){
    73|     _xmlHttp.open("GET",_adresseRecherche+"?debut="+valeur,true);
    74|     _xmlHttp.onreadystatechange=function() {
    75|       if(_xmlHttp.readyState==4&&_xmlHttp.responseXML) {
    76|         var liste = traiteXmlSuggestions(_xmlHttp.responseXML)
    77|         cacheResults(valeur,liste)
    78|         metsEnPlace(valeur,liste)
    79|       }
    80|     };
    81|     _xmlHttp.send(null)
    82|   }
    83| }
    84| function cacheResults(debut,suggestions){
    85|   _resultCache[debut]=suggestions
    86| }
    87| function traiteXmlSuggestions(xmlDoc) {
    88|   var options = xmlDoc.getElementsByTagName('option');
    89|   var optionsListe = new Array();
    90|   for (var i=0; i < options.length; ++i) {
    91|     optionsListe.push(options[i].firstChild.data);
    92|   }
    93|   return optionsListe;
    94| }
    95| function insereCSS(nom,regle){
    96|   if (document.styleSheets) {
    97|     var I=document.styleSheets[0];
    98|     if(I.addRule){ // m�thode IE
    99|       I.addRule(nom,regle)
   100|     }else if(I.insertRule){ // m�thode DOM
   101|       I.insertRule(nom+" { "+regle+" }",I.cssRules.length)
   102|     }
   103|   }
   104| }
   105| function initStyle(){
   106|   var AutoCompleteDivListeStyle="font-size: 13px; font-family: arial,sans-serif; word-wrap:break-word; ";
   107|   var AutoCompleteDivStyle="display: block; padding-left: 3; padding-right: 3; height: 16px; overflow: hidden; background-color: white;";
   108|   var AutoCompleteDivActStyle="background-color: #3366cc; color: white ! important; ";
   109|   insereCSS(".AutoCompleteDivListeStyle",AutoCompleteDivListeStyle);
   110|   insereCSS(".AutoCompleteDiv",AutoCompleteDivStyle);
   111|   insereCSS(".AutoCompleteDivAct",AutoCompleteDivActStyle);
   112| }
   113| function setStylePourElement(c,name){
   114|   c.className=name;
   115| }
   116| function calculateOffsetLeft(r){
   117|   return calculateOffset(r,"offsetLeft")
   118| }
   119| function calculateOffsetTop(r){
   120|   return calculateOffset(r,"offsetTop")
   121| }
   122| function calculateOffset(r,attr){
   123|   var kb=0;
   124|   while(r){
   125|     kb+=r[attr];
   126|     r=r.offsetParent
   127|   }
   128|   return kb
   129| }
   130| function calculateWidth(){
   131|   return _inputField.offsetWidth-2*1
   132| }
   133| function setCompleteDivSize(){
   134|   if(_completeDiv){
   135|     _completeDiv.style.left=calculateOffsetLeft(_inputField)+"px";
   136|     _completeDiv.style.top=calculateOffsetTop(_inputField)+_inputField.offsetHeight-1+"px";
   137|     _completeDiv.style.width=calculateWidth()+"px"
   138|   }
   139| }
   140| function creeAutocompletionDiv() {
   141|   initStyle();
   142|   _completeDiv=document.createElement("DIV");
   143|   _completeDiv.id="completeDiv";
   144|   var borderLeftRight=1;
   145|   var borderTopBottom=1;
   146|   _completeDiv.style.borderRight="black "+borderLeftRight+"px solid";
   147|   _completeDiv.style.borderLeft="black "+borderLeftRight+"px solid";
   148|   _completeDiv.style.borderTop="black "+borderTopBottom+"px solid";
   149|   _completeDiv.style.borderBottom="black "+borderTopBottom+"px solid";
   150|   _completeDiv.style.zIndex="1";
   151|   _completeDiv.style.paddingRight="0";
   152|   _completeDiv.style.paddingLeft="0";
   153|   _completeDiv.style.paddingTop="0";
   154|   _completeDiv.style.paddingBottom="0";
   155|   setCompleteDivSize();
   156|   _completeDiv.style.visibility="hidden";
   157|   _completeDiv.style.position="absolute";
   158|   _completeDiv.style.backgroundColor="white";
   159|   document.body.appendChild(_completeDiv);
   160|   setStylePourElement(_completeDiv,"AutoCompleteDivListeStyle");
   161| }
   162| function metsEnPlace(valeur, liste){
   163|   while(_completeDiv.childNodes.length>0) {
   164|     _completeDiv.removeChild(_completeDiv.childNodes[0]);
   165|   }
   166|   for(var f=0; f<liste.length; ++f){
   167|     var nouveauDiv=document.createElement("DIV");
   168|     nouveauDiv.onmousedown=divOnMouseDown;
   169|     nouveauDiv.onmouseover=divOnMouseOver;
   170|     nouveauDiv.onmouseout=divOnMouseOut;
   171|     setStylePourElement(nouveauDiv,"AutoCompleteDiv");
   172|     var nouveauSpan=document.createElement("SPAN");
   173|     nouveauSpan.innerHTML=liste[f]; // le texte de la suggestion
   174|     nouveauDiv.appendChild(nouveauSpan);
   175|     _completeDiv.appendChild(nouveauDiv)
   176|   }
   177|   PressAction();
   178|   if(_completeDivRows>0) {
   179|     _completeDiv.height=16*_completeDivRows+4;
   180|   } else {
   181|     hideCompleteDiv();
   182|   }
   183| }
   184| var _lastKeyCode=null;
   185| var onKeyDownHandler=function(event){
   186|   if(!event&&window.event) {
   187|     event=window.event;
   188|   }
   189|   if(event) {
   190|     _lastKeyCode=event.keyCode;
   191|   }
   192| }
   193| var _eventKeycode = null;
   194| var onKeyUpHandler=function(event){
   195|   if(!event&&window.event) {
   196|     event=window.event;
   197|   }
   198|   _eventKeycode=event.keyCode;
   199|   if(_eventKeycode==40||_eventKeycode==38) {
   200|     blurThenGetFocus();
   201|   }
   202|   var N=rangeSize(_inputField);
   203|   var v=beforeRangeSize(_inputField);
   204|   var V=_inputField.value;
   205|   if(_eventKeycode!=0){
   206|     if(N>0&&v!=-1) {
   207|       V=V.substring(0,v);
   208|     }
   209|     if(_eventKeycode==13||_eventKeycode==3){
   210|       var d=_inputField;
   211|       if(_inputField.createTextRange){
   212|         var t=_inputField.createTextRange();
   213|         t.moveStart("character",_inputField.value.length);
   214|         _inputField.select()
   215|       } else if (d.setSelectionRange){
   216|         _inputField.setSelectionRange(_inputField.value.length,_inputField.value.length)
   217|       }
   218|     } else {
   219|       if(_inputField.value!=V) {
   220|         _inputField.value=V
   221|       }
   222|     }
   223|   }
   224|   if(_eventKeycode!=40&&_eventKeycode!=38) {
   225|   	_currentInputFieldValue=V;
   226|   }
   227|   if(handleCursorUpDownEnter(_eventKeycode)&&_eventKeycode!=0) {
   228|     PressAction();
   229|   }
   230| }
   231| function handleCursorUpDownEnter(eventCode){
   232|   if(eventCode==40){
   233|     highlightNewValue(_highlightedSuggestionIndex+1);
   234|     return false
   235|   }else if(eventCode==38){
   236|     highlightNewValue(_highlightedSuggestionIndex-1);
   237|     return false
   238|   }else if(eventCode==13||eventCode==3){
   239|     return false
   240|   }
   241|   return true
   242| }
   243| var _completeDivRows = 0;
   244| var _completeDivDivList = null;
   245| var _highlightedSuggestionIndex = -1;
   246| var _highlightedSuggestionDiv = null;
   247| function PressAction(){
   248|   _highlightedSuggestionIndex=-1;
   249|   var suggestionList=_completeDiv.getElementsByTagName("div");
   250|   var suggestionLongueur=suggestionList.length;
   251|   _completeDivRows=suggestionLongueur;
   252|   _completeDivDivList=suggestionList;
   253|   if(_currentInputFieldValue==""||suggestionLongueur==0){
   254|     hideCompleteDiv()
   255|   }else{
   256|     showCompleteDiv()
   257|   }
   258|   var trouve=false;
   259|   if(_currentInputFieldValue.length>0){
   260|     var indice;
   261|     for(indice=0; indice<suggestionLongueur; indice++){
   262|       if(getSuggestion(suggestionList.item(indice)).toUpperCase().indexOf(_currentInputFieldValue.toUpperCase())==0) {
   263|         trouve=true;
   264|         break
   265|       }
   266|     }
   267|   }
   268|   for(var i=0; i<suggestionLongueur; i++) {
   269|     setStylePourElement(suggestionList.item(i),"AutoCompleteDiv");
   270|   }
   271|   if(trouve){
   272|     _highlightedSuggestionIndex=indice;
   273|     _highlightedSuggestionDiv=suggestionList.item(_highlightedSuggestionIndex);
   274|   }else{
   275|     _highlightedSuggestionIndex=-1;
   276|     _highlightedSuggestionDiv=null
   277|   }
   278|   var supprSelection=false;
   279|   switch(_eventKeycode){
   280|     case 8:
   281|     case 33:
   282|     case 34:
   283|     case 35:
   284|     case 35:
   285|     case 36:
   286|     case 37:
   287|     case 39:
   288|     case 45:
   289|     case 46:
   290|       supprSelection=true;
   291|       break;
   292|     default:
   293|       break
   294|   }
   295|   if(!supprSelection&&_highlightedSuggestionDiv){
   296|     setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
   297|     var z;
   298|     if(trouve) {
   299|       z=getSuggestion(_highlightedSuggestionDiv).substr(0);
   300|     } else {
   301|       z=_currentInputFieldValue;
   302|     }
   303|     if(z!=_inputField.value){
   304|       if(_inputField.value!=_currentInputFieldValue) {
   305|         return;
   306|       }
   307|       if(_inputField.createTextRange||_inputField.setSelectionRange) {
   308|         _inputField.value=z;
   309|       }
   310|       if(_inputField.createTextRange){
   311|         var t=_inputField.createTextRange();
   312|         t.moveStart("character",_currentInputFieldValue.length);
   313|         t.select()
   314|       }else if(_inputField.setSelectionRange){
   315|         _inputField.setSelectionRange(_currentInputFieldValue.length,_inputField.value.length)
   316|       }
   317|     }
   318|   }else{
   319|     _highlightedSuggestionIndex=-1;
   320|   }
   321| }
   322| var _cursorUpDownPressed = null;
   323| function blurThenGetFocus(){
   324|   _cursorUpDownPressed=true;
   325|   _inputField.blur();
   326|   setTimeout("_inputField.focus();",10);
   327|   return
   328| }
   329| function rangeSize(n){
   330|   var N=-1;
   331|   if(n.createTextRange){
   332|     var fa=document.selection.createRange().duplicate();
   333|     N=fa.text.length
   334|   }else if(n.setSelectionRange){
   335|     N=n.selectionEnd-n.selectionStart
   336|   }
   337|   return N
   338| }
   339| function beforeRangeSize(n){
   340|   var v=0;
   341|   if(n.createTextRange){
   342|     var fa=document.selection.createRange().duplicate();
   343|     fa.moveEnd("textedit",1);
   344|     v=n.value.length-fa.text.length
   345|   }else if(n.setSelectionRange){
   346|     v=n.selectionStart
   347|   }else{
   348|     v=-1
   349|   }
   350|   return v
   351| }
   352| function cursorAfterValue(n){
   353|   if(n.createTextRange){
   354|     var t=n.createTextRange();
   355|     t.moveStart("character",n.value.length);
   356|     t.select()
   357|   } else if(n.setSelectionRange) {
   358|     n.setSelectionRange(n.value.length,n.value.length)
   359|   }
   360| }
   361| function getSuggestion(uneDiv){
   362|   if(!uneDiv) {
   363|     return null;
   364|   }
   365|   return trimCR(uneDiv.getElementsByTagName('span')[0].firstChild.data)
   366| }
   367| function trimCR(chaine){
   368|   for(var f=0,nChaine="",zb="\n\r"; f<chaine.length; f++) {
   369|     if (zb.indexOf(chaine.charAt(f))==-1) {
   370|       nChaine+=chaine.charAt(f);
   371|     }
   372|   }
   373|   return nChaine
   374| }
   375| function hideCompleteDiv(){
   376|   _completeDiv.style.visibility="hidden"
   377| }
   378| function showCompleteDiv(){
   379|   _completeDiv.style.visibility="visible";
   380|   setCompleteDivSize()
   381| }
   382| function highlightNewValue(C){
   383|   if(!_completeDivDivList||_completeDivRows<=0) {
   384|     return;
   385|   }
   386|   showCompleteDiv();
   387|   if(C>=_completeDivRows){
   388|     C=_completeDivRows-1
   389|   }
   390|   if(_highlightedSuggestionIndex!=-1&&C!=_highlightedSuggestionIndex){
   391|     setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
   392|     _highlightedSuggestionIndex=-1
   393|   }
   394|   if(C<0){
   395|     _highlightedSuggestionIndex=-1;
   396|     _inputField.focus();
   397|     return
   398|   }
   399|   _highlightedSuggestionIndex=C;
   400|   _highlightedSuggestionDiv=_completeDivDivList.item(C);
   401|   setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDivAct");
   402|   _inputField.value=getSuggestion(_highlightedSuggestionDiv);
   403| }
   404| var onResizeHandler=function(event){
   405|   setCompleteDivSize();
   406| }
   407| var onBlurHandler=function(event){
   408|   if(!_cursorUpDownPressed){
   409|     hideCompleteDiv();
   410|     if(_lastKeyCode==9){
   411|       _submitButton.focus();
   412|       _lastKeyCode=-1
   413|     }
   414|   }
   415|   _cursorUpDownPressed=false
   416| };
   417| var divOnMouseDown=function(){
   418|   _inputField.value=getSuggestion(this);
   419|   _documentForm.submit()
   420| };
   421| var divOnMouseOver=function(){
   422|   if(_highlightedSuggestionDiv) {
   423|     setStylePourElement(_highlightedSuggestionDiv,"AutoCompleteDiv");
   424|   }
   425|   setStylePourElement(this,"AutoCompleteDivAct")
   426| };
   427| var divOnMouseOut = function(){
   428|   setStylePourElement(this,"AutoCompleteDiv");
   429| };


# ====================================================================
# FILE: GPL_LIB/AutoComplete/options.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| header('Content-Type: text/xml;charset=utf-8');
     3| echo(utf8_encode("<?xml version='1.0' encoding='UTF-8' ?><options>"));
     4| if (isset($_GET['debut'])) {
     5|     $debut = utf8_decode($_GET['debut']);
     6| } else {
     7|     $debut = "";
     8| }
     9| $debut = strtolower($debut);
    10| $liste = array("abeille","abricot","acheter","acheteur","adjectif","adroit","adroitement","agent","aigle","aile","air","amour","�ne","approcher","ardoise","ar�te","arracher","asperge","astre","aujourd'hui","au lieu de","aussi","autobus","autocar","autruche","avant","avertir","aviation","avril","bain","bal","balcon","balle","ballon","banc","bande","banque","barque","bas","basse","bassin","bataille","b�ton","bavarder","baver","bavette","bazar","beau","belle","bec","b�ler","b�te","bidon","bien","bille","billet","biscuit","bise","blanc","blancheur","blanchir","bleu","bord","bordure","borne","botte","bottine","boucher","bouchon","boucle","boue","boulanger","boulangerie","bouquet","bouteille","boutique","bras","brioche","briquet","brise","briser","brochet","brosse","brosser","brouette","bureau","cachette","cadre","campagne","canal","canard","capitaine","carnaval","carnet","case","castor","chacun","chameau","chant","chapeau","chapelle","chaque","chaton","chaud","chaudement","chef","chenille","chevalier","cheville","chocolat","chose","choucroute","cidre","ciel","cinq","cirque","clocher","clochette","clou","combien","comment","compagne","compagnie","compagnon","compliment","conduire","conduite","confortable","conjuguer","contenir","continuer","coq","coquin","corbeau","corbeille","corde","corne","cornet","corniche","coton","cou","couchette","coudre","coupant","cour","courir","course","couverture","couvrir","craie","cr�ne","crier","croire","croix","cuire","cuisine","cuisson","cuit","cuivre","cuve","date","d�cembre","d�couverte","demi","d�monter","dent","depuis","dernier","derri�re","dessin","dessiner","dessous","devant","dire","direct","directement","diriger","disque","diviser","division","dix","docteur","domestique","donner","dos","double","douloureux","doux","douce","douze","dragon","dur","dur�e","durer","eau","�caille","�chapper","�charpe","�chelle","�colier","�couter","�crevisse","�crire","�criteau","�curie","�l�mentaire","�leveur","en bas","encore","encrier","encre","endormir","enfantin","enfermer","enfin","en haut","ensuite","entier","entr�e","�picerie","�pine","�pingle","�plucher","escalier","escargot","estrade","�trange","fabrique","fabriquer","fatigue","f�minin","fen�tre","fer","fermer","feuille","feutre","fid�le","film","fils","fin","fleuriste","foin","folie","fondre","fontaine","force","forme","formidable","fort","fortement","fourche","franc","franche","fr�re","frileux","fruit","fuite","fumer","gamin","garage","garde","garde","garder","gardien","garnir","gauche","genre","gerbe","gibier","gilet","girafe","gomme","grammaire","grandeur","grandir","gras","grasse","grave","grenouille","gris","grossir","groupe","haut","hauteur","herbe","heure","hibou","hier","histoire","hiver","ici","id�e","injuste","insecte","inspecteur","instrument","invisible","jambe","janvier","jaune","jeune","joie","joue","jouet","joueur","juillet","juin","jument","jusqu'�","labourer","lac","langue","larme","lavage","laver","l�cher","le�on","l�ger","l�gume","lettre","l�vre","li�vre","linge","liquide","litre","livret","loin","long","longue","lorsque","loup","lueur","lunettes","lutte","machine","mademoiselle","magasin","mai","maintenant","maisonnette","ma�tre","ma�tresse","majuscule","malin","mari","masculin","mati�re","matinal","mauve","m�lange","m�langer","m�moire","m�nagerie","menteur","menu","mer","merci","mercredi","merle","merveille","messe","m�tier","mie","miel","le mien","miette","mine","minuit","miracle","moderne","moineau","mois","moment","monstre","montagne","montre","montrer","morue","moteur","motif","moucheron","mouchoir","moudre","mouette","moutarde","mouvement","muraille","murmure","murmurer","nappe","n�","neuf","nez","nid","no�l","noir","nom","nombre","nouer","nuageux","nuit","nul","odeur","oie","oncle","ongle","or","orage","orageux","oreille","ours","ourson","ouvert","ouvrage","ouvrier","paille","pain","paire","panier","pantalon","papier","papillon","parcourir","pardon","parent","parfait","parole","partage","partager","partie","partir","partout","parvenir","pass�","passer","pastille","p�te","patron","patte","pays","peau","p�che","p�cher","p�cheur","peine","pendant","pendre","p�pin","perche","perdant","perdre","perte","peureux","pie","pi�ce","pied","pi�ge","pierre","pi�ton","pioche","piocher","piquet","place","plage","plaine","plaisir","planter","plaque","plat","pleurer","plonger","pluie","pluriel","pochette","point","pointe","poirier","poitrine","pompe","pomper","pondre","porter","pot","pouce","poudre","pourquoi","pourtant","prairie","pratique","presque","prince","princesse","probl�me","produire","produit","promenade","promeneur","propre","proprement","provenir","puis","puisque","punir","pur","pur�e","quatre","quoi","racine","radis","rage","raie","raisin","rame","ramener","raquette","rare","rarement","rebord","recopier","recoudre","recouper","reculer","redevenir","r�duire","regard","r�gime","renard","rencontre","rencontrer","repartir","repasser","r�pondre","r�ponse","reprendre","reproduire","requin","respiration","respirer","r�union","richesse","ride","risque","rivage","rivi�re","robinet","robot","rocher","rond","rondelle","ros�e","roue","rude","ruelle","rugir","salle","saluer","s'amuser","sans","sardine","sauvage","sauver","savoir","secouer","se fatiguer","sel","semelle","se moquer","se munir","s'envoler","se rendormir","se souvenir","seul","si�ge","signe","singulier","soie","soir�e","soldat","solidement","sombre","somme","sonner","sonnerie","sorci�re","sorte","sot","sotte","sottise","souper","soupi�re","sous","souvent","spectateur","sport","sportif","sucrier","sueur","suivant","sujet","superbe","surprise","surtout","tableau","tablier","tabouret","tache","taupe","taille","tante","tapage","taper","taureau","tenir","tenue","tigre","timbre","tirer","tissage","tisser","titre","toile","tondre","tordre","train","traire","tranche","traverser","tr�fle","tr�sor","tresse","tricher","tricheur","tristement","trompe","trou","truite","unit�","usage","us�","utile","utilit�","vague","valeur","valoir","vanille","vapeur","vendeur","vendre","vent","vente","ventre","verger","vernir","vert","verte","veste","viande","victoire","vide","vider","vieux","vif","vive","villa","vinaigre","violette","vip�re","virgule","visible","vitesse","vitre","vitrine","vivement","vivre","vocabulaire","voile","voile","voisin","voisinage","vouloir","voyage","voyageur","z�bre","z�ro");
    11| function generateOptions($debut,$liste) {
    12|     $MAX_RETURN = 10;
    13|     $i = 0;
    14|     foreach ($liste as $element) {
    15|         if ($i<$MAX_RETURN && substr($element, 0, strlen($debut))==$debut) {
    16|             echo(utf8_encode("<option>".$element."</option>"));
    17|             $i++;
    18|         }
    19|     }
    20| }
    21| generateOptions($debut,$liste);
    22| echo("</options>");
    23| ?>


# ====================================================================
# FILE: GPL_LIB/Color_Picker/color_picker.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-150 ---
     1| <?php
     2| $n ="";
     3| $name ="";
     4| $title ="";
     5| $n = $_GET['n'];
     6| $name = $_GET['name'];
     7| $title = $_GET['title'];
     8| $name1 = $n."";
     9| $name2 = $n."_color";
    10| ?>
    11| <html>
    12| <head>
    13| 	<title>Color Picker</title>
    14| 	<style type="text/css">
    15| 		body	{ font-size: 12px; font-family: Verdana, Sans-Serif; text-align:center; background-color:#FFFFFF; color:navy;}
    16| 		td  { font-size: 12px; font-family: Verdana, Sans-Serif; text-align:center; background-color:#FFFFFF}
    17| 		.table_black_border {border-style:solid; border-width:1px; border-color:#000000;}
    18|    </style>
    19| 	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    20| 	<script type="text/javascript">
    21| 		/*****************************************************************
    22| 		* Script Color Picker �crit par Frosty (Maxime Pacary) - Mai 2003
    23| 		******************************************************************/
    24| 		var detail = 50; // nombre de nuances de couleurs dans la barre de droite
    25| 		var strhex = "0123456789ABCDEF";
    26| 		var i;
    27| 		var is_mouse_down = false;
    28| 		var is_mouse_over = false;
    29| 		function dechex(n) {
    30| 			return strhex.charAt(Math.floor(n/16)) + strhex.charAt(n%16);
    31| 		}
    32| 		function compute_color(e)
    33| 		{
    34| 			x = e.offsetX ? e.offsetX : (e.target ? e.clientX-e.target.x : 0);
    35| 			y = e.offsetY ? e.offsetY : (e.target ? e.clientY-e.target.y : 0);
    36| 			var part_width = document.all ? document.all.color_picker.width/6 : document.getElementById('color_picker').width/6;
    37| 			var part_detail = detail/2;
    38| 			var im_height = document.all ? document.all.color_picker.height : document.getElementById('color_picker').height;
    39| 			var red = (x >= 0)*(x < part_width)*255
    40| 					+ (x >= part_width)*(x < 2*part_width)*(2*255 - x * 255 / part_width)
    41| 					+ (x >= 4*part_width)*(x < 5*part_width)*(-4*255 + x * 255 / part_width)
    42| 					+ (x >= 5*part_width)*(x < 6*part_width)*255;
    43| 			var blue = (x >= 2*part_width)*(x < 3*part_width)*(-2*255 + x * 255 / part_width)
    44| 					+ (x >= 3*part_width)*(x < 5*part_width)*255
    45| 					+ (x >= 5*part_width)*(x < 6*part_width)*(6*255 - x * 255 / part_width);
    46| 			var green = (x >= 0)*(x < part_width)*(x * 255 / part_width)
    47| 					+ (x >= part_width)*(x < 3*part_width)*255
    48| 					+ (x >= 3*part_width)*(x < 4*part_width)*(4*255 - x * 255 / part_width);
    49| 			var coef = (im_height-y)/im_height;
    50| 			red = 128+(red-128)*coef;
    51| 			green = 128+(green-128)*coef;
    52| 			blue = 128+(blue-128)*coef;
    53| 			changeFinalColor('#' + dechex(red) + dechex(green) + dechex(blue));
    54| 			for(i = 0; i < detail; i++)
    55| 			{
    56| 				if ((i >= 0) && (i < part_detail))
    57| 				{
    58| 					var final_coef = i/part_detail ;
    59| 					var final_red = dechex(255 - (255 - red) * final_coef);
    60| 					var final_green = dechex(255 - (255 - green) * final_coef);
    61| 					var final_blue = dechex(255 - (255 - blue) * final_coef);
    62| 				}
    63| 				else
    64| 				{
    65| 					var final_coef = 2 - i/part_detail ;
    66| 					var final_red = dechex(red * final_coef);
    67| 					var final_green = dechex(green * final_coef);
    68| 					var final_blue = dechex(blue * final_coef);
    69| 				}
    70| 				color = final_red + final_green + final_blue ;
    71| 				document.all ? document.all('gs'+i).style.backgroundColor = '#'+color : document.getElementById('gs'+i).style.backgroundColor = '#'+color;
    72| 			}
    73| 		}
    74| 		function changeFinalColor(color)
    75| 		{
    76| 			document.forms['colpick_form'].elements['btn_choose_color'].style.backgroundColor = color;
    77| 			document.forms['colpick_form'].elements['btn_choose_color'].style.borderColor = color;
    78| 		}
    79| 		function send_color()
    80| 		{
    81| 			if (window.opener)
    82| 			{
    83| 			   var new_color = document.forms['colpick_form'].elements['btn_choose_color'].style.backgroundColor;
    84| 			   exp_rgb = new RegExp("rgb","g");
    85| 			   if (exp_rgb.test(new_color))
    86| 			   {
    87| 			   	exp_extract = new RegExp("[0-9]+","g");
    88| 			   	var tab_rgb = new_color.match(exp_extract);
    89| 			      new_color = '#'+dechex(parseInt(tab_rgb[0]))+dechex(parseInt(tab_rgb[1]))+dechex(parseInt(tab_rgb[2]));
    90| 			   }
    91|                 window.opener.document.forms['Form'].elements['<?php echo $name1; ?>'].value = new_color;
    92|         	     window.opener.document.forms['Form'].elements['<?php echo $name2;?>'].style.borderColor = new_color;
    93| 			   window.opener.document.forms['Form'].elements['<?php echo $name2; ?>'].style.backgroundColor = new_color;
    94| 				window.opener.focus();
    95| 				window.close();
    96| 			}
    97| 		}
    98| 		window.focus();
    99| 	</script>
   100| </head>
   101| <body>
   102|    <form name="colpick_form" action="#" method="post">
   103| 	<h2><?php echo $title; ?></h2>
   104| 	<h3><?php echo $name; ?></h3>
   105| 	<table border="0" cellspacing="0" cellpadding="0" align="center">
   106| 		<tr>
   107| 			<td>
   108| 				<table border="1" cellspacing="0" cellpadding="0" class="table_black_border">
   109| 					<tr>
   110| 						<td style="padding:0px; border-width:0px; border-style:none;">
   111| 							<img id="color_picker" src="colpick.jpg" onclick="compute_color(event)"
   112| 							   onmousedown="is_mouse_down = true; return false;"
   113| 							   onmouseup="is_mouse_down = false;"
   114| 							   onmousemove="if (is_mouse_down && is_mouse_over) compute_color(event); return false;"
   115| 							   onmouseover="is_mouse_over = true;"
   116| 							   onmouseout="is_mouse_over = false;"
   117|                         style="cursor:crosshair;" /></td>
   118| 						</td>
   119| 					</tr>
   120| 				</table>
   121| 			<td style="background-color:#ffffff; width:20px; height:2px; padding:0px;"></td>
   122| 			<td>
   123| 				<table border="1" cellspacing="0" cellpadding="0" class="table_black_border" style="cursor:crosshair">
   124| 					<script type="text/javascript">
   125| 						for(i = 0; i < detail; i++)
   126| 						{
   127| 							document.write('<tr><td id="gs'+i+'" style="background-color:#000000; width:20px; height:3px; border-style:none; border-width:0px;"'
   128|                         + ' onclick="changeFinalColor(this.style.backgroundColor)"'
   129|                         + ' onmousedown="is_mouse_down = true; return false;"'
   130|                         + ' onmouseup="is_mouse_down = false;"'
   131|                         + ' onmousemove="if (is_mouse_down && is_mouse_over) changeFinalColor(this.style.backgroundColor); return false;"'
   132|                         + ' onmouseover="is_mouse_over = true;"'
   133| 				   + ' onmouseout="is_mouse_over = false;"'
   134|                         + '></td></tr>');
   135| 						}
   136| 					</script>
   137| 				</table>
   138| 			</td>
   139| 		</tr>
   140| 	</table>
   141| 	<br />
   142| 	<table align="center">
   143| 		<tr valign="center">
   144| 			<td><input type="button" name="btn_choose_color" value="&nbsp;" style="background-color:#000000; border-color:#000000; width:100px; height:35px;"></td>
   145| 			<td><input type="button" name="btn_ok" value="Ok" style="width:70px" onclick="send_color();"></td>
   146| 		</tr>
   147| 	</table>
   148| 	</form>
   149| </body>
   150| </html>


# ====================================================================
# FILE: GPL_LIB/Smarty/demo/index.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-17 ---
     1| <?php
     2| require '../libs/Smarty.class.php';
     3| $smarty = new Smarty;
     4| $smarty->compile_check = true;
     5| $smarty->debugging = true;
     6| $smarty->assign("Name","Fred Irving Johnathan Bradley Peppergill");
     7| $smarty->assign("FirstName",array("John","Mary","James","Henry"));
     8| $smarty->assign("LastName",array("Doe","Smith","Johnson","Case"));
     9| $smarty->assign("Class",array(array("A","B","C","D"), array("E", "F", "G", "H"),
    10| 	  array("I", "J", "K", "L"), array("M", "N", "O", "P")));
    11| $smarty->assign("contacts", array(array("phone" => "1", "fax" => "2", "cell" => "3"),
    12| 	  array("phone" => "555-4444", "fax" => "555-3333", "cell" => "760-1234")));
    13| $smarty->assign("option_values", array("NY","NE","KS","IA","OK","TX"));
    14| $smarty->assign("option_output", array("New York","Nebraska","Kansas","Iowa","Oklahoma","Texas"));
    15| $smarty->assign("option_selected", "NE");
    16| $smarty->display('index.tpl');
    17| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/Config_File.class.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-343 ---
     1| <?php
     2| /**
     3|  * Config_File class.
     4|  *
     5|  * This library is free software; you can redistribute it and/or
     6|  * modify it under the terms of the GNU Lesser General Public
     7|  * License as published by the Free Software Foundation; either
     8|  * version 2.1 of the License, or (at your option) any later version.
     9|  *
    10|  * This library is distributed in the hope that it will be useful,
    11|  * but WITHOUT ANY WARRANTY; without even the implied warranty of
    12|  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    13|  * Lesser General Public License for more details.
    14|  *
    15|  * You should have received a copy of the GNU Lesser General Public
    16|  * License along with this library; if not, write to the Free Software
    17|  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    18|  *
    19|  * @link http://smarty.php.net/
    20|  * @version 2.6.18
    21|  * @copyright Copyright: 2001-2005 New Digital Group, Inc.
    22|  * @author Andrei Zmievski <andrei@php.net>
    23|  * @access public
    24|  * @package Smarty
    25|  */
    26| /* $Id$ */
    27| /**
    28|  * Config file reading class
    29|  * @package Smarty
    30|  */
    31| class Config_File {
    32|     /**#@+
    33|      * Options
    34|      * @var boolean
    35|      */
    36|     /**
    37|      * Controls whether variables with the same name overwrite each other.
    38|      */
    39|     var $overwrite        =    true;
    40|     /**
    41|      * Controls whether config values of on/true/yes and off/false/no get
    42|      * converted to boolean values automatically.
    43|      */
    44|     var $booleanize        =    true;
    45|     /**
    46|      * Controls whether hidden config sections/vars are read from the file.
    47|      */
    48|     var $read_hidden     =    true;
    49|     /**
    50|      * Controls whether or not to fix mac or dos formatted newlines.
    51|      * If set to true, \r or \r\n will be changed to \n.
    52|      */
    53|     var $fix_newlines =    true;
    54|     /**#@-*/
    55|     /** @access private */
    56|     var $_config_path    = "";
    57|     var $_config_data    = array();
    58|     /**#@-*/
    59|     /**
    60|      * Constructs a new config file class.
    61|      *
    62|      * @param string $config_path (optional) path to the config files
    63|      */
    64|     function Config_File($config_path = NULL)
    65|     {
    66|         if (isset($config_path))
    67|             $this->set_path($config_path);
    68|     }
    69|     /**
    70|      * Set the path where configuration files can be found.
    71|      *
    72|      * @param string $config_path path to the config files
    73|      */
    74|     function set_path($config_path)
    75|     {
    76|         if (!empty($config_path)) {
    77|             if (!is_string($config_path) || !file_exists($config_path) || !is_dir($config_path)) {
    78|                 $this->_trigger_error_msg("Bad config file path '$config_path'");
    79|                 return;
    80|             }
    81|             if(substr($config_path, -1) != DIRECTORY_SEPARATOR) {
    82|                 $config_path .= DIRECTORY_SEPARATOR;
    83|             }
    84|             $this->_config_path = $config_path;
    85|         }
    86|     }
    87|     /**
    88|      * Retrieves config info based on the file, section, and variable name.
    89|      *
    90|      * @param string $file_name config file to get info for
    91|      * @param string $section_name (optional) section to get info for
    92|      * @param string $var_name (optional) variable to get info for
    93|      * @return string|array a value or array of values
    94|      */
    95|     function get($file_name, $section_name = NULL, $var_name = NULL)
    96|     {
    97|         if (empty($file_name)) {
    98|             $this->_trigger_error_msg('Empty config file name');
    99|             return;
   100|         } else {
   101|             $file_name = $this->_config_path . $file_name;
   102|             if (!isset($this->_config_data[$file_name]))
   103|                 $this->load_file($file_name, false);
   104|         }
   105|         if (!empty($var_name)) {
   106|             if (empty($section_name)) {
   107|                 return $this->_config_data[$file_name]["vars"][$var_name];
   108|             } else {
   109|                 if(isset($this->_config_data[$file_name]["sections"][$section_name]["vars"][$var_name]))
   110|                     return $this->_config_data[$file_name]["sections"][$section_name]["vars"][$var_name];
   111|                 else
   112|                     return array();
   113|             }
   114|         } else {
   115|             if (empty($section_name)) {
   116|                 return (array)$this->_config_data[$file_name]["vars"];
   117|             } else {
   118|                 if(isset($this->_config_data[$file_name]["sections"][$section_name]["vars"]))
   119|                     return (array)$this->_config_data[$file_name]["sections"][$section_name]["vars"];
   120|                 else
   121|                     return array();
   122|             }
   123|         }
   124|     }
   125|     /**
   126|      * Retrieves config info based on the key.
   127|      *
   128|      * @param $file_name string config key (filename/section/var)
   129|      * @return string|array same as get()
   130|      * @uses get() retrieves information from config file and returns it
   131|      */
   132|     function &get_key($config_key)
   133|     {
   134|         list($file_name, $section_name, $var_name) = explode('/', $config_key, 3);
   135|         $result = &$this->get($file_name, $section_name, $var_name);
   136|         return $result;
   137|     }
   138|     /**
   139|      * Get all loaded config file names.
   140|      *
   141|      * @return array an array of loaded config file names
   142|      */
   143|     function get_file_names()
   144|     {
   145|         return array_keys($this->_config_data);
   146|     }
   147|     /**
   148|      * Get all section names from a loaded file.
   149|      *
   150|      * @param string $file_name config file to get section names from
   151|      * @return array an array of section names from the specified file
   152|      */
   153|     function get_section_names($file_name)
   154|     {
   155|         $file_name = $this->_config_path . $file_name;
   156|         if (!isset($this->_config_data[$file_name])) {
   157|             $this->_trigger_error_msg("Unknown config file '$file_name'");
   158|             return;
   159|         }
   160|         return array_keys($this->_config_data[$file_name]["sections"]);
   161|     }
   162|     /**
   163|      * Get all global or section variable names.
   164|      *
   165|      * @param string $file_name config file to get info for
   166|      * @param string $section_name (optional) section to get info for
   167|      * @return array an array of variables names from the specified file/section
   168|      */
   169|     function get_var_names($file_name, $section = NULL)
   170|     {
   171|         if (empty($file_name)) {
   172|             $this->_trigger_error_msg('Empty config file name');
   173|             return;
   174|         } else if (!isset($this->_config_data[$file_name])) {
   175|             $this->_trigger_error_msg("Unknown config file '$file_name'");
   176|             return;
   177|         }
   178|         if (empty($section))
   179|             return array_keys($this->_config_data[$file_name]["vars"]);
   180|         else
   181|             return array_keys($this->_config_data[$file_name]["sections"][$section]["vars"]);
   182|     }
   183|     /**
   184|      * Clear loaded config data for a certain file or all files.
   185|      *
   186|      * @param string $file_name file to clear config data for
   187|      */
   188|     function clear($file_name = NULL)
   189|     {
   190|         if ($file_name === NULL)
   191|             $this->_config_data = array();
   192|         else if (isset($this->_config_data[$file_name]))
   193|             $this->_config_data[$file_name] = array();
   194|     }
   195|     /**
   196|      * Load a configuration file manually.
   197|      *
   198|      * @param string $file_name file name to load
   199|      * @param boolean $prepend_path whether current config path should be
   200|      *                              prepended to the filename
   201|      */
   202|     function load_file($file_name, $prepend_path = true)
   203|     {
   204|         if ($prepend_path && $this->_config_path != "")
   205|             $config_file = $this->_config_path . $file_name;
   206|         else
   207|             $config_file = $file_name;
   208|         ini_set('track_errors', true);
   209|         $fp = @fopen($config_file, "r");
   210|         if (!is_resource($fp)) {
   211|             $this->_trigger_error_msg("Could not open config file '$config_file'");
   212|             return false;
   213|         }
   214|         $contents = ($size = filesize($config_file)) ? fread($fp, $size) : '';
   215|         fclose($fp);
   216|         $this->_config_data[$config_file] = $this->parse_contents($contents);
   217|         return true;
   218|     }
   219|     /**
   220|      * Store the contents of a file manually.
   221|      *
   222|      * @param string $config_file file name of the related contents
   223|      * @param string $contents the file-contents to parse
   224|      */
   225|     function set_file_contents($config_file, $contents)
   226|     {
   227|         $this->_config_data[$config_file] = $this->parse_contents($contents);
   228|         return true;
   229|     }
   230|     /**
   231|      * parse the source of a configuration file manually.
   232|      *
   233|      * @param string $contents the file-contents to parse
   234|      */
   235|     function parse_contents($contents)
   236|     {
   237|         if($this->fix_newlines) {
   238|             $contents = preg_replace('!\r\n?!', "\n", $contents);
   239|         }
   240|         $config_data = array();
   241|         $config_data['sections'] = array();
   242|         $config_data['vars'] = array();
   243|         /* reference to fill with data */
   244|         $vars =& $config_data['vars'];
   245|         /* parse file line by line */
   246|         preg_match_all('!^.*\r?\n?!m', $contents, $match);
   247|         $lines = $match[0];
   248|         for ($i=0, $count=count($lines); $i<$count; $i++) {
   249|             $line = $lines[$i];
   250|             if (empty($line)) continue;
   251|             if ( substr($line, 0, 1) == '[' && preg_match('!^\[(.*?)\]!', $line, $match) ) {
   252|                 /* section found */
   253|                 if (substr($match[1], 0, 1) == '.') {
   254|                     /* hidden section */
   255|                     if ($this->read_hidden) {
   256|                         $section_name = substr($match[1], 1);
   257|                     } else {
   258|                         /* break reference to $vars to ignore hidden section */
   259|                         unset($vars);
   260|                         $vars = array();
   261|                         continue;
   262|                     }
   263|                 } else {                    
   264|                     $section_name = $match[1];
   265|                 }
   266|                 if (!isset($config_data['sections'][$section_name]))
   267|                     $config_data['sections'][$section_name] = array('vars' => array());
   268|                 $vars =& $config_data['sections'][$section_name]['vars'];
   269|                 continue;
   270|             }
   271|             if (preg_match('/^\s*(\.?\w+)\s*=\s*(.*)/s', $line, $match)) {
   272|                 /* variable found */
   273|                 $var_name = rtrim($match[1]);
   274|                 if (strpos($match[2], '"""') === 0) {
   275|                     /* handle multiline-value */
   276|                     $lines[$i] = substr($match[2], 3);
   277|                     $var_value = '';
   278|                     while ($i<$count) {
   279|                         if (($pos = strpos($lines[$i], '"""')) === false) {
   280|                             $var_value .= $lines[$i++];
   281|                         } else {
   282|                             /* end of multiline-value */
   283|                             $var_value .= substr($lines[$i], 0, $pos);
   284|                             break;
   285|                         }
   286|                     }
   287|                     $booleanize = false;
   288|                 } else {
   289|                     /* handle simple value */
   290|                     $var_value = preg_replace('/^([\'"])(.*)\1$/', '\2', rtrim($match[2]));
   291|                     $booleanize = $this->booleanize;
   292|                 }
   293|                 $this->_set_config_var($vars, $var_name, $var_value, $booleanize);
   294|             }
   295|             /* else unparsable line / means it is a comment / means ignore it */
   296|         }
   297|         return $config_data;
   298|     }
   299|     /**#@+ @access private */
   300|     /**
   301|      * @param array &$container
   302|      * @param string $var_name
   303|      * @param mixed $var_value
   304|      * @param boolean $booleanize determines whether $var_value is converted to
   305|      *                            to true/false
   306|      */
   307|     function _set_config_var(&$container, $var_name, $var_value, $booleanize)
   308|     {
   309|         if (substr($var_name, 0, 1) == '.') {
   310|             if (!$this->read_hidden)
   311|                 return;
   312|             else
   313|                 $var_name = substr($var_name, 1);
   314|         }
   315|         if (!preg_match("/^[a-zA-Z_]\w*$/", $var_name)) {
   316|             $this->_trigger_error_msg("Bad variable name '$var_name'");
   317|             return;
   318|         }
   319|         if ($booleanize) {
   320|             if (preg_match("/^(on|true|yes)$/i", $var_value))
   321|                 $var_value = true;
   322|             else if (preg_match("/^(off|false|no)$/i", $var_value))
   323|                 $var_value = false;
   324|         }
   325|         if (!isset($container[$var_name]) || $this->overwrite)
   326|             $container[$var_name] = $var_value;
   327|         else {
   328|             settype($container[$var_name], 'array');
   329|             $container[$var_name][] = $var_value;
   330|         }
   331|     }
   332|     /**
   333|      * @uses trigger_error() creates a PHP warning/error
   334|      * @param string $error_msg
   335|      * @param integer $error_type one of
   336|      */
   337|     function _trigger_error_msg($error_msg, $error_type = E_USER_WARNING)
   338|     {
   339|         trigger_error("Config_File error: $error_msg", $error_type);
   340|     }
   341|     /**#@-*/
   342| }
   343| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/Smarty.class.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1680 ---
     1| <?php
     2| /**
     3|  * Project:     Smarty: the PHP compiling template engine
     4|  * File:        Smarty.class.php
     5|  *
     6|  * This library is free software; you can redistribute it and/or
     7|  * modify it under the terms of the GNU Lesser General Public
     8|  * License as published by the Free Software Foundation; either
     9|  * version 2.1 of the License, or (at your option) any later version.
    10|  *
    11|  * This library is distributed in the hope that it will be useful,
    12|  * but WITHOUT ANY WARRANTY; without even the implied warranty of
    13|  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    14|  * Lesser General Public License for more details.
    15|  *
    16|  * You should have received a copy of the GNU Lesser General Public
    17|  * License along with this library; if not, write to the Free Software
    18|  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    19|  *
    20|  * For questions, help, comments, discussion, etc., please join the
    21|  * Smarty mailing list. Send a blank e-mail to
    22|  * smarty-general-subscribe@lists.php.net
    23|  *
    24|  * @link http://smarty.php.net/
    25|  * @copyright 2001-2005 New Digital Group, Inc.
    26|  * @author Monte Ohrt <monte at ohrt dot com>
    27|  * @author Andrei Zmievski <andrei@php.net>
    28|  * @package Smarty
    29|  * @version 2.6.18
    30|  */
    31| /* $Id$ */
    32| /**
    33|  * DIR_SEP isn't used anymore, but third party apps might
    34|  */
    35| if(!defined('DIR_SEP')) {
    36|     define('DIR_SEP', DIRECTORY_SEPARATOR);
    37| }
    38| /**
    39|  * set SMARTY_DIR to absolute path to Smarty library files.
    40|  * if not defined, include_path will be used. Sets SMARTY_DIR only if user
    41|  * application has not already defined it.
    42|  */
    43| if (!defined('SMARTY_DIR')) {
    44|     define('SMARTY_DIR', dirname(__FILE__) . DIRECTORY_SEPARATOR);
    45| }
    46| if (!defined('SMARTY_CORE_DIR')) {
    47|     define('SMARTY_CORE_DIR', SMARTY_DIR . 'internals' . DIRECTORY_SEPARATOR);
    48| }
    49| define('SMARTY_PHP_PASSTHRU',   0);
    50| define('SMARTY_PHP_QUOTE',      1);
    51| define('SMARTY_PHP_REMOVE',     2);
    52| define('SMARTY_PHP_ALLOW',      3);
    53| /**
    54|  * @package Smarty
    55|  */
    56| class Smarty
    57| {
    58|     /**#@+
    59|      * Smarty Configuration Section
    60|      */
    61|     /**
    62|      * The name of the directory where templates are located.
    63|      *
    64|      * @var string
    65|      */
    66|     var $template_dir    =  'templates';
    67|     /**
    68|      * The directory where compiled templates are located.
    69|      *
    70|      * @var string
    71|      */
    72|     var $compile_dir     =  'templates_c';
    73|     /**
    74|      * The directory where config files are located.
    75|      *
    76|      * @var string
    77|      */
    78|     var $config_dir      =  'configs';
    79|     /**
    80|      * An array of directories searched for plugins.
    81|      *
    82|      * @var array
    83|      */
    84|     var $plugins_dir     =  array('plugins');
    85|     /**
    86|      * If debugging is enabled, a debug console window will display
    87|      * when the page loads (make sure your browser allows unrequested
    88|      * popup windows)
    89|      *
    90|      * @var boolean
    91|      */
    92|     var $debugging       =  false;
    93|     /**
    94|      * When set, smarty does uses this value as error_reporting-level.
    95|      *
    96|      * @var boolean
    97|      */
    98|     var $error_reporting  =  null;
    99|     /**
   100|      * This is the path to the debug console template. If not set,
   101|      * the default one will be used.
   102|      *
   103|      * @var string
   104|      */
   105|     var $debug_tpl       =  '';
   106|     /**
   107|      * This determines if debugging is enable-able from the browser.
   108|      * <ul>
   109|      *  <li>NONE => no debugging control allowed</li>
   110|      *  <li>URL => enable debugging when SMARTY_DEBUG is found in the URL.</li>
   111|      * </ul>
   112|      * @link http://www.foo.dom/index.php?SMARTY_DEBUG
   113|      * @var string
   114|      */
   115|     var $debugging_ctrl  =  'NONE';
   116|     /**
   117|      * This tells Smarty whether to check for recompiling or not. Recompiling
   118|      * does not need to happen unless a template or config file is changed.
   119|      * Typically you enable this during development, and disable for
   120|      * production.
   121|      *
   122|      * @var boolean
   123|      */
   124|     var $compile_check   =  true;
   125|     /**
   126|      * This forces templates to compile every time. Useful for development
   127|      * or debugging.
   128|      *
   129|      * @var boolean
   130|      */
   131|     var $force_compile   =  false;
   132|     /**
   133|      * This enables template caching.
   134|      * <ul>
   135|      *  <li>0 = no caching</li>
   136|      *  <li>1 = use class cache_lifetime value</li>
   137|      *  <li>2 = use cache_lifetime in cache file</li>
   138|      * </ul>
   139|      * @var integer
   140|      */
   141|     var $caching         =  0;
   142|     /**
   143|      * The name of the directory for cache files.
   144|      *
   145|      * @var string
   146|      */
   147|     var $cache_dir       =  'cache';
   148|     /**
   149|      * This is the number of seconds cached content will persist.
   150|      * <ul>
   151|      *  <li>0 = always regenerate cache</li>
   152|      *  <li>-1 = never expires</li>
   153|      * </ul>
   154|      *
   155|      * @var integer
   156|      */
   157|     var $cache_lifetime  =  3600;
   158|     /**
   159|      * Only used when $caching is enabled. If true, then If-Modified-Since headers
   160|      * are respected with cached content, and appropriate HTTP headers are sent.
   161|      * This way repeated hits to a cached page do not send the entire page to the
   162|      * client every time.
   163|      *
   164|      * @var boolean
   165|      */
   166|     var $cache_modified_check = false;
   167|     /**
   168|      * This determines how Smarty handles "<?php ... ?>" tags in templates.
   169|      * possible values:
   170|      * <ul>
   171|      *  <li>SMARTY_PHP_PASSTHRU -> print tags as plain text</li>
   172|      *  <li>SMARTY_PHP_QUOTE    -> escape tags as entities</li>
   173|      *  <li>SMARTY_PHP_REMOVE   -> remove php tags</li>
   174|      *  <li>SMARTY_PHP_ALLOW    -> execute php tags</li>
   175|      * </ul>
   176|      *
   177|      * @var integer
   178|      */
   179|     var $php_handling    =  SMARTY_PHP_PASSTHRU;
   180|     /**
   181|      * This enables template security. When enabled, many things are restricted
   182|      * in the templates that normally would go unchecked. This is useful when
   183|      * untrusted parties are editing templates and you want a reasonable level
   184|      * of security. (no direct execution of PHP in templates for example)
   185|      *
   186|      * @var boolean
   187|      */
   188|     var $security       =   false;
   189|     /**
   190|      * This is the list of template directories that are considered secure. This
   191|      * is used only if {@link $security} is enabled. One directory per array
   192|      * element.  {@link $template_dir} is in this list implicitly.
   193|      *
   194|      * @var array
   195|      */
   196|     var $secure_dir     =   array();
   197|     /**
   198|      * These are the security settings for Smarty. They are used only when
   199|      * {@link $security} is enabled.
   200|      *
   201|      * @var array
   202|      */
   203|     var $security_settings  = array(
   204|                                     'PHP_HANDLING'    => false,
   205|                                     'IF_FUNCS'        => array('array', 'list',
   206|                                                                'isset', 'empty',
   207|                                                                'count', 'sizeof',
   208|                                                                'in_array', 'is_array',
   209|                                                                'true', 'false', 'null'),
   210|                                     'INCLUDE_ANY'     => false,
   211|                                     'PHP_TAGS'        => false,
   212|                                     'MODIFIER_FUNCS'  => array('count'),
   213|                                     'ALLOW_CONSTANTS'  => false
   214|                                    );
   215|     /**
   216|      * This is an array of directories where trusted php scripts reside.
   217|      * {@link $security} is disabled during their inclusion/execution.
   218|      *
   219|      * @var array
   220|      */
   221|     var $trusted_dir        = array();
   222|     /**
   223|      * The left delimiter used for the template tags.
   224|      *
   225|      * @var string
   226|      */
   227|     var $left_delimiter  =  '{';
   228|     /**
   229|      * The right delimiter used for the template tags.
   230|      *
   231|      * @var string
   232|      */
   233|     var $right_delimiter =  '}';
   234|     /**
   235|      * The order in which request variables are registered, similar to
   236|      * variables_order in php.ini E = Environment, G = GET, P = POST,
   237|      * C = Cookies, S = Server
   238|      *
   239|      * @var string
   240|      */
   241|     var $request_vars_order    = 'EGPCS';
   242|     /**
   243|      * Indicates wether $HTTP_*_VARS[] (request_use_auto_globals=false)
   244|      * are uses as request-vars or $_*[]-vars. note: if
   245|      * request_use_auto_globals is true, then $request_vars_order has
   246|      * no effect, but the php-ini-value "gpc_order"
   247|      *
   248|      * @var boolean
   249|      */
   250|     var $request_use_auto_globals      = true;
   251|     /**
   252|      * Set this if you want different sets of compiled files for the same
   253|      * templates. This is useful for things like different languages.
   254|      * Instead of creating separate sets of templates per language, you
   255|      * set different compile_ids like 'en' and 'de'.
   256|      *
   257|      * @var string
   258|      */
   259|     var $compile_id            = null;
   260|     /**
   261|      * This tells Smarty whether or not to use sub dirs in the cache/ and
   262|      * templates_c/ directories. sub directories better organized, but
   263|      * may not work well with PHP safe mode enabled.
   264|      *
   265|      * @var boolean
   266|      *
   267|      */
   268|     var $use_sub_dirs          = false;
   269|     /**
   270|      * This is a list of the modifiers to apply to all template variables.
   271|      * Put each modifier in a separate array element in the order you want
   272|      * them applied. example: <code>array('escape:"htmlall"');</code>
   273|      *
   274|      * @var array
   275|      */
   276|     var $default_modifiers        = array();
   277|     /**
   278|      * This is the resource type to be used when not specified
   279|      * at the beginning of the resource path. examples:
   280|      * $smarty->display('file:index.tpl');
   281|      * $smarty->display('db:index.tpl');
   282|      * $smarty->display('index.tpl'); // will use default resource type
   283|      * {include file="file:index.tpl"}
   284|      * {include file="db:index.tpl"}
   285|      * {include file="index.tpl"} {* will use default resource type *}
   286|      *
   287|      * @var array
   288|      */
   289|     var $default_resource_type    = 'file';
   290|     /**
   291|      * The function used for cache file handling. If not set, built-in caching is used.
   292|      *
   293|      * @var null|string function name
   294|      */
   295|     var $cache_handler_func   = null;
   296|     /**
   297|      * This indicates which filters are automatically loaded into Smarty.
   298|      *
   299|      * @var array array of filter names
   300|      */
   301|     var $autoload_filters = array();
   302|     /**#@+
   303|      * @var boolean
   304|      */
   305|     /**
   306|      * This tells if config file vars of the same name overwrite each other or not.
   307|      * if disabled, same name variables are accumulated in an array.
   308|      */
   309|     var $config_overwrite = true;
   310|     /**
   311|      * This tells whether or not to automatically booleanize config file variables.
   312|      * If enabled, then the strings "on", "true", and "yes" are treated as boolean
   313|      * true, and "off", "false" and "no" are treated as boolean false.
   314|      */
   315|     var $config_booleanize = true;
   316|     /**
   317|      * This tells whether hidden sections [.foobar] are readable from the
   318|      * tempalates or not. Normally you would never allow this since that is
   319|      * the point behind hidden sections: the application can access them, but
   320|      * the templates cannot.
   321|      */
   322|     var $config_read_hidden = false;
   323|     /**
   324|      * This tells whether or not automatically fix newlines in config files.
   325|      * It basically converts \r (mac) or \r\n (dos) to \n
   326|      */
   327|     var $config_fix_newlines = true;
   328|     /**#@-*/
   329|     /**
   330|      * If a template cannot be found, this PHP function will be executed.
   331|      * Useful for creating templates on-the-fly or other special action.
   332|      *
   333|      * @var string function name
   334|      */
   335|     var $default_template_handler_func = '';
   336|     /**
   337|      * The file that contains the compiler class. This can a full
   338|      * pathname, or relative to the php_include path.
   339|      *
   340|      * @var string
   341|      */
   342|     var $compiler_file        =    'Smarty_Compiler.class.php';
   343|     /**
   344|      * The class used for compiling templates.
   345|      *
   346|      * @var string
   347|      */
   348|     var $compiler_class        =   'Smarty_Compiler';
   349|     /**
   350|      * The class used to load config vars.
   351|      *
   352|      * @var string
   353|      */
   354|     var $config_class          =   'Config_File';
   355| /**#@+
   356|  * END Smarty Configuration Section
   357|  * There should be no need to touch anything below this line.
   358|  * @access private
   359|  */
   360|     /**
   361|      * where assigned template vars are kept
   362|      *
   363|      * @var array
   364|      */
   365|     var $_tpl_vars             = array();
   366|     /**
   367|      * stores run-time $smarty.* vars
   368|      *
   369|      * @var null|array
   370|      */
   371|     var $_smarty_vars          = null;
   372|     /**
   373|      * keeps track of sections
   374|      *
   375|      * @var array
   376|      */
   377|     var $_sections             = array();
   378|     /**
   379|      * keeps track of foreach blocks
   380|      *
   381|      * @var array
   382|      */
   383|     var $_foreach              = array();
   384|     /**
   385|      * keeps track of tag hierarchy
   386|      *
   387|      * @var array
   388|      */
   389|     var $_tag_stack            = array();
   390|     /**
   391|      * configuration object
   392|      *
   393|      * @var Config_file
   394|      */
   395|     var $_conf_obj             = null;
   396|     /**
   397|      * loaded configuration settings
   398|      *
   399|      * @var array
   400|      */
   401|     var $_config               = array(array('vars'  => array(), 'files' => array()));
   402|     /**
   403|      * md5 checksum of the string 'Smarty'
   404|      *
   405|      * @var string
   406|      */
   407|     var $_smarty_md5           = 'f8d698aea36fcbead2b9d5359ffca76f';
   408|     /**
   409|      * Smarty version number
   410|      *
   411|      * @var string
   412|      */
   413|     var $_version              = '2.6.18';
   414|     /**
   415|      * current template inclusion depth
   416|      *
   417|      * @var integer
   418|      */
   419|     var $_inclusion_depth      = 0;
   420|     /**
   421|      * for different compiled templates
   422|      *
   423|      * @var string
   424|      */
   425|     var $_compile_id           = null;
   426|     /**
   427|      * text in URL to enable debug mode
   428|      *
   429|      * @var string
   430|      */
   431|     var $_smarty_debug_id      = 'SMARTY_DEBUG';
   432|     /**
   433|      * debugging information for debug console
   434|      *
   435|      * @var array
   436|      */
   437|     var $_smarty_debug_info    = array();
   438|     /**
   439|      * info that makes up a cache file
   440|      *
   441|      * @var array
   442|      */
   443|     var $_cache_info           = array();
   444|     /**
   445|      * default file permissions
   446|      *
   447|      * @var integer
   448|      */
   449|     var $_file_perms           = 0644;
   450|     /**
   451|      * default dir permissions
   452|      *
   453|      * @var integer
   454|      */
   455|     var $_dir_perms               = 0771;
   456|     /**
   457|      * registered objects
   458|      *
   459|      * @var array
   460|      */
   461|     var $_reg_objects           = array();
   462|     /**
   463|      * table keeping track of plugins
   464|      *
   465|      * @var array
   466|      */
   467|     var $_plugins              = array(
   468|                                        'modifier'      => array(),
   469|                                        'function'      => array(),
   470|                                        'block'         => array(),
   471|                                        'compiler'      => array(),
   472|                                        'prefilter'     => array(),
   473|                                        'postfilter'    => array(),
   474|                                        'outputfilter'  => array(),
   475|                                        'resource'      => array(),
   476|                                        'insert'        => array());
   477|     /**
   478|      * cache serials
   479|      *
   480|      * @var array
   481|      */
   482|     var $_cache_serials = array();
   483|     /**
   484|      * name of optional cache include file
   485|      *
   486|      * @var string
   487|      */
   488|     var $_cache_include = null;
   489|     /**
   490|      * indicate if the current code is used in a compiled
   491|      * include
   492|      *
   493|      * @var string
   494|      */
   495|     var $_cache_including = false;
   496|     /**#@-*/
   497|     /**
   498|      * The class constructor.
   499|      */
   500|     function Smarty()
   501|     {
   502|       $this->assign('SCRIPT_NAME', isset($_SERVER['SCRIPT_NAME']) ? $_SERVER['SCRIPT_NAME']
   503|                     : @$GLOBALS['HTTP_SERVER_VARS']['SCRIPT_NAME']);
   504|     }
   505|     /**
   506|      * assigns values to template variables
   507|      *
   508|      * @param array|string $tpl_var the template variable name(s)
   509|      * @param mixed $value the value to assign
   510|      */
   511|     function assign($tpl_var, $value = null)
   512|     {
   513|         if (is_array($tpl_var)){
   514|             foreach ($tpl_var as $key => $val) {
   515|                 if ($key != '') {
   516|                     $this->_tpl_vars[$key] = $val;
   517|                 }
   518|             }
   519|         } else {
   520|             if ($tpl_var != '')
   521|                 $this->_tpl_vars[$tpl_var] = $value;
   522|         }
   523|     }
   524|     /**
   525|      * assigns values to template variables by reference
   526|      *
   527|      * @param string $tpl_var the template variable name
   528|      * @param mixed $value the referenced value to assign
   529|      */
   530|     function assign_by_ref($tpl_var, &$value)
   531|     {
   532|         if ($tpl_var != '')
   533|             $this->_tpl_vars[$tpl_var] = &$value;
   534|     }
   535|     /**
   536|      * appends values to template variables
   537|      *
   538|      * @param array|string $tpl_var the template variable name(s)
   539|      * @param mixed $value the value to append
   540|      */
   541|     function append($tpl_var, $value=null, $merge=false)
   542|     {
   543|         if (is_array($tpl_var)) {
   544|             foreach ($tpl_var as $_key => $_val) {
   545|                 if ($_key != '') {
   546|                     if(!@is_array($this->_tpl_vars[$_key])) {
   547|                         settype($this->_tpl_vars[$_key],'array');
   548|                     }
   549|                     if($merge && is_array($_val)) {
   550|                         foreach($_val as $_mkey => $_mval) {
   551|                             $this->_tpl_vars[$_key][$_mkey] = $_mval;
   552|                         }
   553|                     } else {
   554|                         $this->_tpl_vars[$_key][] = $_val;
   555|                     }
   556|                 }
   557|             }
   558|         } else {
   559|             if ($tpl_var != '' && isset($value)) {
   560|                 if(!@is_array($this->_tpl_vars[$tpl_var])) {
   561|                     settype($this->_tpl_vars[$tpl_var],'array');
   562|                 }
   563|                 if($merge && is_array($value)) {
   564|                     foreach($value as $_mkey => $_mval) {
   565|                         $this->_tpl_vars[$tpl_var][$_mkey] = $_mval;
   566|                     }
   567|                 } else {
   568|                     $this->_tpl_vars[$tpl_var][] = $value;
   569|                 }
   570|             }
   571|         }
   572|     }
   573|     /**
   574|      * appends values to template variables by reference
   575|      *
   576|      * @param string $tpl_var the template variable name
   577|      * @param mixed $value the referenced value to append
   578|      */
   579|     function append_by_ref($tpl_var, &$value, $merge=false)
   580|     {
   581|         if ($tpl_var != '' && isset($value)) {
   582|             if(!@is_array($this->_tpl_vars[$tpl_var])) {
   583|              settype($this->_tpl_vars[$tpl_var],'array');
   584|             }
   585|             if ($merge && is_array($value)) {
   586|                 foreach($value as $_key => $_val) {
   587|                     $this->_tpl_vars[$tpl_var][$_key] = &$value[$_key];
   588|                 }
   589|             } else {
   590|                 $this->_tpl_vars[$tpl_var][] = &$value;
   591|             }
   592|         }
   593|     }
   594|     /**
   595|      * clear the given assigned template variable.
   596|      *
   597|      * @param string $tpl_var the template variable to clear
   598|      */
   599|     function clear_assign($tpl_var)
   600|     {
   601|         if (is_array($tpl_var))
   602|             foreach ($tpl_var as $curr_var)
   603|                 unset($this->_tpl_vars[$curr_var]);
   604|         else
   605|             unset($this->_tpl_vars[$tpl_var]);
   606|     }
   607|     /**
   608|      * Registers custom function to be used in templates
   609|      *
   610|      * @param string $function the name of the template function
   611|      * @param string $function_impl the name of the PHP function to register
   612|      */
   613|     function register_function($function, $function_impl, $cacheable=true, $cache_attrs=null)
   614|     {
   615|         $this->_plugins['function'][$function] =
   616|             array($function_impl, null, null, false, $cacheable, $cache_attrs);
   617|     }
   618|     /**
   619|      * Unregisters custom function
   620|      *
   621|      * @param string $function name of template function
   622|      */
   623|     function unregister_function($function)
   624|     {
   625|         unset($this->_plugins['function'][$function]);
   626|     }
   627|     /**
   628|      * Registers object to be used in templates
   629|      *
   630|      * @param string $object name of template object
   631|      * @param object &$object_impl the referenced PHP object to register
   632|      * @param null|array $allowed list of allowed methods (empty = all)
   633|      * @param boolean $smarty_args smarty argument format, else traditional
   634|      * @param null|array $block_functs list of methods that are block format
   635|      */
   636|     function register_object($object, &$object_impl, $allowed = array(), $smarty_args = true, $block_methods = array())
   637|     {
   638|         settype($allowed, 'array');
   639|         settype($smarty_args, 'boolean');
   640|         $this->_reg_objects[$object] =
   641|             array(&$object_impl, $allowed, $smarty_args, $block_methods);
   642|     }
   643|     /**
   644|      * Unregisters object
   645|      *
   646|      * @param string $object name of template object
   647|      */
   648|     function unregister_object($object)
   649|     {
   650|         unset($this->_reg_objects[$object]);
   651|     }
   652|     /**
   653|      * Registers block function to be used in templates
   654|      *
   655|      * @param string $block name of template block
   656|      * @param string $block_impl PHP function to register
   657|      */
   658|     function register_block($block, $block_impl, $cacheable=true, $cache_attrs=null)
   659|     {
   660|         $this->_plugins['block'][$block] =
   661|             array($block_impl, null, null, false, $cacheable, $cache_attrs);
   662|     }
   663|     /**
   664|      * Unregisters block function
   665|      *
   666|      * @param string $block name of template function
   667|      */
   668|     function unregister_block($block)
   669|     {
   670|         unset($this->_plugins['block'][$block]);
   671|     }
   672|     /**
   673|      * Registers compiler function
   674|      *
   675|      * @param string $function name of template function
   676|      * @param string $function_impl name of PHP function to register
   677|      */
   678|     function register_compiler_function($function, $function_impl, $cacheable=true)
   679|     {
   680|         $this->_plugins['compiler'][$function] =
   681|             array($function_impl, null, null, false, $cacheable);
   682|     }
   683|     /**
   684|      * Unregisters compiler function
   685|      *
   686|      * @param string $function name of template function
   687|      */
   688|     function unregister_compiler_function($function)
   689|     {
   690|         unset($this->_plugins['compiler'][$function]);
   691|     }
   692|     /**
   693|      * Registers modifier to be used in templates
   694|      *
   695|      * @param string $modifier name of template modifier
   696|      * @param string $modifier_impl name of PHP function to register
   697|      */
   698|     function register_modifier($modifier, $modifier_impl)
   699|     {
   700|         $this->_plugins['modifier'][$modifier] =
   701|             array($modifier_impl, null, null, false);
   702|     }
   703|     /**
   704|      * Unregisters modifier
   705|      *
   706|      * @param string $modifier name of template modifier
   707|      */
   708|     function unregister_modifier($modifier)
   709|     {
   710|         unset($this->_plugins['modifier'][$modifier]);
   711|     }
   712|     /**
   713|      * Registers a resource to fetch a template
   714|      *
   715|      * @param string $type name of resource
   716|      * @param array $functions array of functions to handle resource
   717|      */
   718|     function register_resource($type, $functions)
   719|     {
   720|         if (count($functions)==4) {
   721|             $this->_plugins['resource'][$type] =
   722|                 array($functions, false);
   723|         } elseif (count($functions)==5) {
   724|             $this->_plugins['resource'][$type] =
   725|                 array(array(array(&$functions[0], $functions[1])
   726|                             ,array(&$functions[0], $functions[2])
   727|                             ,array(&$functions[0], $functions[3])
   728|                             ,array(&$functions[0], $functions[4]))
   729|                       ,false);
   730|         } else {
   731|             $this->trigger_error("malformed function-list for '$type' in register_resource");
   732|         }
   733|     }
   734|     /**
   735|      * Unregisters a resource
   736|      *
   737|      * @param string $type name of resource
   738|      */
   739|     function unregister_resource($type)
   740|     {
   741|         unset($this->_plugins['resource'][$type]);
   742|     }
   743|     /**
   744|      * Registers a prefilter function to apply
   745|      * to a template before compiling
   746|      *
   747|      * @param string $function name of PHP function to register
   748|      */
   749|     function register_prefilter($function)
   750|     {
   751|     $_name = (is_array($function)) ? $function[1] : $function;
   752|         $this->_plugins['prefilter'][$_name]
   753|             = array($function, null, null, false);
   754|     }
   755|     /**
   756|      * Unregisters a prefilter function
   757|      *
   758|      * @param string $function name of PHP function
   759|      */
   760|     function unregister_prefilter($function)
   761|     {
   762|         unset($this->_plugins['prefilter'][$function]);
   763|     }
   764|     /**
   765|      * Registers a postfilter function to apply
   766|      * to a compiled template after compilation
   767|      *
   768|      * @param string $function name of PHP function to register
   769|      */
   770|     function register_postfilter($function)
   771|     {
   772|     $_name = (is_array($function)) ? $function[1] : $function;
   773|         $this->_plugins['postfilter'][$_name]
   774|             = array($function, null, null, false);
   775|     }
   776|     /**
   777|      * Unregisters a postfilter function
   778|      *
   779|      * @param string $function name of PHP function
   780|      */
   781|     function unregister_postfilter($function)
   782|     {
   783|         unset($this->_plugins['postfilter'][$function]);
   784|     }
   785|     /**
   786|      * Registers an output filter function to apply
   787|      * to a template output
   788|      *
   789|      * @param string $function name of PHP function
   790|      */
   791|     function register_outputfilter($function)
   792|     {
   793|     $_name = (is_array($function)) ? $function[1] : $function;
   794|         $this->_plugins['outputfilter'][$_name]
   795|             = array($function, null, null, false);
   796|     }
   797|     /**
   798|      * Unregisters an outputfilter function
   799|      *
   800|      * @param string $function name of PHP function
   801|      */
   802|     function unregister_outputfilter($function)
   803|     {
   804|         unset($this->_plugins['outputfilter'][$function]);
   805|     }
   806|     /**
   807|      * load a filter of specified type and name
   808|      *
   809|      * @param string $type filter type
   810|      * @param string $name filter name
   811|      */
   812|     function load_filter($type, $name)
   813|     {
   814|         switch ($type) {
   815|             case 'output':
   816|                 $_params = array('plugins' => array(array($type . 'filter', $name, null, null, false)));
   817|                 require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
   818|                 smarty_core_load_plugins($_params, $this);
   819|                 break;
   820|             case 'pre':
   821|             case 'post':
   822|                 if (!isset($this->_plugins[$type . 'filter'][$name]))
   823|                     $this->_plugins[$type . 'filter'][$name] = false;
   824|                 break;
   825|         }
   826|     }
   827|     /**
   828|      * clear cached content for the given template and cache id
   829|      *
   830|      * @param string $tpl_file name of template file
   831|      * @param string $cache_id name of cache_id
   832|      * @param string $compile_id name of compile_id
   833|      * @param string $exp_time expiration time
   834|      * @return boolean
   835|      */
   836|     function clear_cache($tpl_file = null, $cache_id = null, $compile_id = null, $exp_time = null)
   837|     {
   838|         if (!isset($compile_id))
   839|             $compile_id = $this->compile_id;
   840|         if (!isset($tpl_file))
   841|             $compile_id = null;
   842|         $_auto_id = $this->_get_auto_id($cache_id, $compile_id);
   843|         if (!empty($this->cache_handler_func)) {
   844|             return call_user_func_array($this->cache_handler_func,
   845|                                   array('clear', &$this, &$dummy, $tpl_file, $cache_id, $compile_id, $exp_time));
   846|         } else {
   847|             $_params = array('auto_base' => $this->cache_dir,
   848|                             'auto_source' => $tpl_file,
   849|                             'auto_id' => $_auto_id,
   850|                             'exp_time' => $exp_time);
   851|             require_once(SMARTY_CORE_DIR . 'core.rm_auto.php');
   852|             return smarty_core_rm_auto($_params, $this);
   853|         }
   854|     }
   855|     /**
   856|      * clear the entire contents of cache (all templates)
   857|      *
   858|      * @param string $exp_time expire time
   859|      * @return boolean results of {@link smarty_core_rm_auto()}
   860|      */
   861|     function clear_all_cache($exp_time = null)
   862|     {
   863|         return $this->clear_cache(null, null, null, $exp_time);
   864|     }
   865|     /**
   866|      * test to see if valid cache exists for this template
   867|      *
   868|      * @param string $tpl_file name of template file
   869|      * @param string $cache_id
   870|      * @param string $compile_id
   871|      * @return string|false results of {@link _read_cache_file()}
   872|      */
   873|     function is_cached($tpl_file, $cache_id = null, $compile_id = null)
   874|     {
   875|         if (!$this->caching)
   876|             return false;
   877|         if (!isset($compile_id))
   878|             $compile_id = $this->compile_id;
   879|         $_params = array(
   880|             'tpl_file' => $tpl_file,
   881|             'cache_id' => $cache_id,
   882|             'compile_id' => $compile_id
   883|         );
   884|         require_once(SMARTY_CORE_DIR . 'core.read_cache_file.php');
   885|         return smarty_core_read_cache_file($_params, $this);
   886|     }
   887|     /**
   888|      * clear all the assigned template variables.
   889|      *
   890|      */
   891|     function clear_all_assign()
   892|     {
   893|         $this->_tpl_vars = array();
   894|     }
   895|     /**
   896|      * clears compiled version of specified template resource,
   897|      * or all compiled template files if one is not specified.
   898|      * This function is for advanced use only, not normally needed.
   899|      *
   900|      * @param string $tpl_file
   901|      * @param string $compile_id
   902|      * @param string $exp_time
   903|      * @return boolean results of {@link smarty_core_rm_auto()}
   904|      */
   905|     function clear_compiled_tpl($tpl_file = null, $compile_id = null, $exp_time = null)
   906|     {
   907|         if (!isset($compile_id)) {
   908|             $compile_id = $this->compile_id;
   909|         }
   910|         $_params = array('auto_base' => $this->compile_dir,
   911|                         'auto_source' => $tpl_file,
   912|                         'auto_id' => $compile_id,
   913|                         'exp_time' => $exp_time,
   914|                         'extensions' => array('.inc', '.php'));
   915|         require_once(SMARTY_CORE_DIR . 'core.rm_auto.php');
   916|         return smarty_core_rm_auto($_params, $this);
   917|     }
   918|     /**
   919|      * Checks whether requested template exists.
   920|      *
   921|      * @param string $tpl_file
   922|      * @return boolean
   923|      */
   924|     function template_exists($tpl_file)
   925|     {
   926|         $_params = array('resource_name' => $tpl_file, 'quiet'=>true, 'get_source'=>false);
   927|         return $this->_fetch_resource_info($_params);
   928|     }
   929|     /**
   930|      * Returns an array containing template variables
   931|      *
   932|      * @param string $name
   933|      * @param string $type
   934|      * @return array
   935|      */
   936|     function &get_template_vars($name=null)
   937|     {
   938|         if(!isset($name)) {
   939|             return $this->_tpl_vars;
   940|         } elseif(isset($this->_tpl_vars[$name])) {
   941|             return $this->_tpl_vars[$name];
   942|         } else {
   943|             $_tmp = null;
   944|             return $_tmp;   
   945|         }
   946|     }
   947|     /**
   948|      * Returns an array containing config variables
   949|      *
   950|      * @param string $name
   951|      * @param string $type
   952|      * @return array
   953|      */
   954|     function &get_config_vars($name=null)
   955|     {
   956|         if(!isset($name) && is_array($this->_config[0])) {
   957|             return $this->_config[0]['vars'];
   958|         } else if(isset($this->_config[0]['vars'][$name])) {
   959|             return $this->_config[0]['vars'][$name];
   960|         } else {
   961|             $_tmp = null;
   962|             return $_tmp;
   963|         }
   964|     }
   965|     /**
   966|      * trigger Smarty error
   967|      *
   968|      * @param string $error_msg
   969|      * @param integer $error_type
   970|      */
   971|     function trigger_error($error_msg, $error_type = E_USER_WARNING)
   972|     {
   973|         trigger_error("Smarty error: $error_msg", $error_type);
   974|     }
   975|     /**
   976|      * executes & displays the template results
   977|      *
   978|      * @param string $resource_name
   979|      * @param string $cache_id
   980|      * @param string $compile_id
   981|      */
   982|     function display($resource_name, $cache_id = null, $compile_id = null)
   983|     {
   984|         $this->fetch($resource_name, $cache_id, $compile_id, true);
   985|     }
   986|     /**
   987|      * executes & returns or displays the template results
   988|      *
   989|      * @param string $resource_name
   990|      * @param string $cache_id
   991|      * @param string $compile_id
   992|      * @param boolean $display
   993|      */
   994|     function fetch($resource_name, $cache_id = null, $compile_id = null, $display = false)
   995|     {
   996|         static $_cache_info = array();
   997|         $_smarty_old_error_level = $this->debugging ? error_reporting() : error_reporting(isset($this->error_reporting)
   998|                ? $this->error_reporting : error_reporting() & ~E_NOTICE);
   999|         if (!$this->debugging && $this->debugging_ctrl == 'URL') {
  1000|             $_query_string = $this->request_use_auto_globals ? $_SERVER['QUERY_STRING'] : $GLOBALS['HTTP_SERVER_VARS']['QUERY_STRING'];
  1001|             if (@strstr($_query_string, $this->_smarty_debug_id)) {
  1002|                 if (@strstr($_query_string, $this->_smarty_debug_id . '=on')) {
  1003|                     @setcookie('SMARTY_DEBUG', true);
  1004|                     $this->debugging = true;
  1005|                 } elseif (@strstr($_query_string, $this->_smarty_debug_id . '=off')) {
  1006|                     @setcookie('SMARTY_DEBUG', false);
  1007|                     $this->debugging = false;
  1008|                 } else {
  1009|                     $this->debugging = true;
  1010|                 }
  1011|             } else {
  1012|                 $this->debugging = (bool)($this->request_use_auto_globals ? @$_COOKIE['SMARTY_DEBUG'] : @$GLOBALS['HTTP_COOKIE_VARS']['SMARTY_DEBUG']);
  1013|             }
  1014|         }
  1015|         if ($this->debugging) {
  1016|             $_params = array();
  1017|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
  1018|             $_debug_start_time = smarty_core_get_microtime($_params, $this);
  1019|             $this->_smarty_debug_info[] = array('type'      => 'template',
  1020|                                                 'filename'  => $resource_name,
  1021|                                                 'depth'     => 0);
  1022|             $_included_tpls_idx = count($this->_smarty_debug_info) - 1;
  1023|         }
  1024|         if (!isset($compile_id)) {
  1025|             $compile_id = $this->compile_id;
  1026|         }
  1027|         $this->_compile_id = $compile_id;
  1028|         $this->_inclusion_depth = 0;
  1029|         if ($this->caching) {
  1030|             array_push($_cache_info, $this->_cache_info);
  1031|             $this->_cache_info = array();
  1032|             $_params = array(
  1033|                 'tpl_file' => $resource_name,
  1034|                 'cache_id' => $cache_id,
  1035|                 'compile_id' => $compile_id,
  1036|                 'results' => null
  1037|             );
  1038|             require_once(SMARTY_CORE_DIR . 'core.read_cache_file.php');
  1039|             if (smarty_core_read_cache_file($_params, $this)) {
  1040|                 $_smarty_results = $_params['results'];
  1041|                 if (!empty($this->_cache_info['insert_tags'])) {
  1042|                     $_params = array('plugins' => $this->_cache_info['insert_tags']);
  1043|                     require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
  1044|                     smarty_core_load_plugins($_params, $this);
  1045|                     $_params = array('results' => $_smarty_results);
  1046|                     require_once(SMARTY_CORE_DIR . 'core.process_cached_inserts.php');
  1047|                     $_smarty_results = smarty_core_process_cached_inserts($_params, $this);
  1048|                 }
  1049|                 if (!empty($this->_cache_info['cache_serials'])) {
  1050|                     $_params = array('results' => $_smarty_results);
  1051|                     require_once(SMARTY_CORE_DIR . 'core.process_compiled_include.php');
  1052|                     $_smarty_results = smarty_core_process_compiled_include($_params, $this);
  1053|                 }
  1054|                 if ($display) {
  1055|                     if ($this->debugging)
  1056|                     {
  1057|                         $_params = array();
  1058|                         require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
  1059|                         $this->_smarty_debug_info[$_included_tpls_idx]['exec_time'] = smarty_core_get_microtime($_params, $this) - $_debug_start_time;
  1060|                         require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
  1061|                         $_smarty_results .= smarty_core_display_debug_console($_params, $this);
  1062|                     }
  1063|                     if ($this->cache_modified_check) {
  1064|                         $_server_vars = ($this->request_use_auto_globals) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];
  1065|                         $_last_modified_date = @substr($_server_vars['HTTP_IF_MODIFIED_SINCE'], 0, strpos($_server_vars['HTTP_IF_MODIFIED_SINCE'], 'GMT') + 3);
  1066|                         $_gmt_mtime = gmdate('D, d M Y H:i:s', $this->_cache_info['timestamp']).' GMT';
  1067|                         if (@count($this->_cache_info['insert_tags']) == 0
  1068|                             && !$this->_cache_serials
  1069|                             && $_gmt_mtime == $_last_modified_date) {
  1070|                             if (php_sapi_name()=='cgi')
  1071|                                 header('Status: 304 Not Modified');
  1072|                             else
  1073|                                 header('HTTP/1.1 304 Not Modified');
  1074|                         } else {
  1075|                             header('Last-Modified: '.$_gmt_mtime);
  1076|                             echo $_smarty_results;
  1077|                         }
  1078|                     } else {
  1079|                             echo $_smarty_results;
  1080|                     }
  1081|                     error_reporting($_smarty_old_error_level);
  1082|                     $this->_cache_info = array_pop($_cache_info);
  1083|                     return true;
  1084|                 } else {
  1085|                     error_reporting($_smarty_old_error_level);
  1086|                     $this->_cache_info = array_pop($_cache_info);
  1087|                     return $_smarty_results;
  1088|                 }
  1089|             } else {
  1090|                 $this->_cache_info['template'][$resource_name] = true;
  1091|                 if ($this->cache_modified_check && $display) {
  1092|                     header('Last-Modified: '.gmdate('D, d M Y H:i:s', time()).' GMT');
  1093|                 }
  1094|             }
  1095|         }
  1096|         if (count($this->autoload_filters)) {
  1097|             foreach ($this->autoload_filters as $_filter_type => $_filters) {
  1098|                 foreach ($_filters as $_filter) {
  1099|                     $this->load_filter($_filter_type, $_filter);
  1100|                 }
  1101|             }
  1102|         }
  1103|         $_smarty_compile_path = $this->_get_compile_path($resource_name);
  1104|         $_cache_including = $this->_cache_including;
  1105|         $this->_cache_including = false;
  1106|         if ($display && !$this->caching && count($this->_plugins['outputfilter']) == 0) {
  1107|             if ($this->_is_compiled($resource_name, $_smarty_compile_path)
  1108|                     || $this->_compile_resource($resource_name, $_smarty_compile_path))
  1109|             {
  1110|                 include($_smarty_compile_path);
  1111|             }
  1112|         } else {
  1113|             ob_start();
  1114|             if ($this->_is_compiled($resource_name, $_smarty_compile_path)
  1115|                     || $this->_compile_resource($resource_name, $_smarty_compile_path))
  1116|             {
  1117|                 include($_smarty_compile_path);
  1118|             }
  1119|             $_smarty_results = ob_get_contents();
  1120|             ob_end_clean();
  1121|             foreach ((array)$this->_plugins['outputfilter'] as $_output_filter) {
  1122|                 $_smarty_results = call_user_func_array($_output_filter[0], array($_smarty_results, &$this));
  1123|             }
  1124|         }
  1125|         if ($this->caching) {
  1126|             $_params = array('tpl_file' => $resource_name,
  1127|                         'cache_id' => $cache_id,
  1128|                         'compile_id' => $compile_id,
  1129|                         'results' => $_smarty_results);
  1130|             require_once(SMARTY_CORE_DIR . 'core.write_cache_file.php');
  1131|             smarty_core_write_cache_file($_params, $this);
  1132|             require_once(SMARTY_CORE_DIR . 'core.process_cached_inserts.php');
  1133|             $_smarty_results = smarty_core_process_cached_inserts($_params, $this);
  1134|             if ($this->_cache_serials) {
  1135|                 $_smarty_results = preg_replace('!(\{/?nocache\:[0-9a-f]{32}#\d+\})!s'
  1136|                                                 ,''
  1137|                                                 ,$_smarty_results);
  1138|             }
  1139|             $this->_cache_info = array_pop($_cache_info);
  1140|         }
  1141|         $this->_cache_including = $_cache_including;
  1142|         if ($display) {
  1143|             if (isset($_smarty_results)) { echo $_smarty_results; }
  1144|             if ($this->debugging) {
  1145|                 $_params = array();
  1146|                 require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
  1147|                 $this->_smarty_debug_info[$_included_tpls_idx]['exec_time'] = (smarty_core_get_microtime($_params, $this) - $_debug_start_time);
  1148|                 require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
  1149|                 echo smarty_core_display_debug_console($_params, $this);
  1150|             }
  1151|             error_reporting($_smarty_old_error_level);
  1152|             return;
  1153|         } else {
  1154|             error_reporting($_smarty_old_error_level);
  1155|             if (isset($_smarty_results)) { return $_smarty_results; }
  1156|         }
  1157|     }
  1158|     /**
  1159|      * load configuration values
  1160|      *
  1161|      * @param string $file
  1162|      * @param string $section
  1163|      * @param string $scope
  1164|      */
  1165|     function config_load($file, $section = null, $scope = 'global')
  1166|     {
  1167|         require_once($this->_get_plugin_filepath('function', 'config_load'));
  1168|         smarty_function_config_load(array('file' => $file, 'section' => $section, 'scope' => $scope), $this);
  1169|     }
  1170|     /**
  1171|      * return a reference to a registered object
  1172|      *
  1173|      * @param string $name
  1174|      * @return object
  1175|      */
  1176|     function &get_registered_object($name) {
  1177|         if (!isset($this->_reg_objects[$name]))
  1178|         $this->_trigger_fatal_error("'$name' is not a registered object");
  1179|         if (!is_object($this->_reg_objects[$name][0]))
  1180|         $this->_trigger_fatal_error("registered '$name' is not an object");
  1181|         return $this->_reg_objects[$name][0];
  1182|     }
  1183|     /**
  1184|      * clear configuration values
  1185|      *
  1186|      * @param string $var
  1187|      */
  1188|     function clear_config($var = null)
  1189|     {
  1190|         if(!isset($var)) {
  1191|             $this->_config = array(array('vars'  => array(),
  1192|                                          'files' => array()));
  1193|         } else {
  1194|             unset($this->_config[0]['vars'][$var]);
  1195|         }
  1196|     }
  1197|     /**
  1198|      * get filepath of requested plugin
  1199|      *
  1200|      * @param string $type
  1201|      * @param string $name
  1202|      * @return string|false
  1203|      */
  1204|     function _get_plugin_filepath($type, $name)
  1205|     {
  1206|         $_params = array('type' => $type, 'name' => $name);
  1207|         require_once(SMARTY_CORE_DIR . 'core.assemble_plugin_filepath.php');
  1208|         return smarty_core_assemble_plugin_filepath($_params, $this);
  1209|     }
  1210|    /**
  1211|      * test if resource needs compiling
  1212|      *
  1213|      * @param string $resource_name
  1214|      * @param string $compile_path
  1215|      * @return boolean
  1216|      */
  1217|     function _is_compiled($resource_name, $compile_path)
  1218|     {
  1219|         if (!$this->force_compile && file_exists($compile_path)) {
  1220|             if (!$this->compile_check) {
  1221|                 return true;
  1222|             } else {
  1223|                 $_params = array('resource_name' => $resource_name, 'get_source'=>false);
  1224|                 if (!$this->_fetch_resource_info($_params)) {
  1225|                     return false;
  1226|                 }
  1227|                 if ($_params['resource_timestamp'] <= filemtime($compile_path)) {
  1228|                     return true;
  1229|                 } else {
  1230|                     return false;
  1231|                 }
  1232|             }
  1233|         } else {
  1234|             return false;
  1235|         }
  1236|     }
  1237|    /**
  1238|      * compile the template
  1239|      *
  1240|      * @param string $resource_name
  1241|      * @param string $compile_path
  1242|      * @return boolean
  1243|      */
  1244|     function _compile_resource($resource_name, $compile_path)
  1245|     {
  1246|         $_params = array('resource_name' => $resource_name);
  1247|         if (!$this->_fetch_resource_info($_params)) {
  1248|             return false;
  1249|         }
  1250|         $_source_content = $_params['source_content'];
  1251|         $_cache_include    = substr($compile_path, 0, -4).'.inc';
  1252|         if ($this->_compile_source($resource_name, $_source_content, $_compiled_content, $_cache_include)) {
  1253|             if ($this->_cache_include_info) {
  1254|                 require_once(SMARTY_CORE_DIR . 'core.write_compiled_include.php');
  1255|                 smarty_core_write_compiled_include(array_merge($this->_cache_include_info, array('compiled_content'=>$_compiled_content, 'resource_name'=>$resource_name)),  $this);
  1256|             }
  1257|             $_params = array('compile_path'=>$compile_path, 'compiled_content' => $_compiled_content);
  1258|             require_once(SMARTY_CORE_DIR . 'core.write_compiled_resource.php');
  1259|             smarty_core_write_compiled_resource($_params, $this);
  1260|             return true;
  1261|         } else {
  1262|             return false;
  1263|         }
  1264|     }
  1265|    /**
  1266|      * compile the given source
  1267|      *
  1268|      * @param string $resource_name
  1269|      * @param string $source_content
  1270|      * @param string $compiled_content
  1271|      * @return boolean
  1272|      */
  1273|     function _compile_source($resource_name, &$source_content, &$compiled_content, $cache_include_path=null)
  1274|     {
  1275|         if (file_exists(SMARTY_DIR . $this->compiler_file)) {
  1276|             require_once(SMARTY_DIR . $this->compiler_file);
  1277|         } else {
  1278|             require_once($this->compiler_file);
  1279|         }
  1280|         $smarty_compiler = new $this->compiler_class;
  1281|         $smarty_compiler->template_dir      = $this->template_dir;
  1282|         $smarty_compiler->compile_dir       = $this->compile_dir;
  1283|         $smarty_compiler->plugins_dir       = $this->plugins_dir;
  1284|         $smarty_compiler->config_dir        = $this->config_dir;
  1285|         $smarty_compiler->force_compile     = $this->force_compile;
  1286|         $smarty_compiler->caching           = $this->caching;
  1287|         $smarty_compiler->php_handling      = $this->php_handling;
  1288|         $smarty_compiler->left_delimiter    = $this->left_delimiter;
  1289|         $smarty_compiler->right_delimiter   = $this->right_delimiter;
  1290|         $smarty_compiler->_version          = $this->_version;
  1291|         $smarty_compiler->security          = $this->security;
  1292|         $smarty_compiler->secure_dir        = $this->secure_dir;
  1293|         $smarty_compiler->security_settings = $this->security_settings;
  1294|         $smarty_compiler->trusted_dir       = $this->trusted_dir;
  1295|         $smarty_compiler->use_sub_dirs      = $this->use_sub_dirs;
  1296|         $smarty_compiler->_reg_objects      = &$this->_reg_objects;
  1297|         $smarty_compiler->_plugins          = &$this->_plugins;
  1298|         $smarty_compiler->_tpl_vars         = &$this->_tpl_vars;
  1299|         $smarty_compiler->default_modifiers = $this->default_modifiers;
  1300|         $smarty_compiler->compile_id        = $this->_compile_id;
  1301|         $smarty_compiler->_config            = $this->_config;
  1302|         $smarty_compiler->request_use_auto_globals  = $this->request_use_auto_globals;
  1303|         if (isset($cache_include_path) && isset($this->_cache_serials[$cache_include_path])) {
  1304|             $smarty_compiler->_cache_serial = $this->_cache_serials[$cache_include_path];
  1305|         }
  1306|         $smarty_compiler->_cache_include = $cache_include_path;
  1307|         $_results = $smarty_compiler->_compile_file($resource_name, $source_content, $compiled_content);
  1308|         if ($smarty_compiler->_cache_serial) {
  1309|             $this->_cache_include_info = array(
  1310|                 'cache_serial'=>$smarty_compiler->_cache_serial
  1311|                 ,'plugins_code'=>$smarty_compiler->_plugins_code
  1312|                 ,'include_file_path' => $cache_include_path);
  1313|         } else {
  1314|             $this->_cache_include_info = null;
  1315|         }
  1316|         return $_results;
  1317|     }
  1318|     /**
  1319|      * Get the compile path for this resource
  1320|      *
  1321|      * @param string $resource_name
  1322|      * @return string results of {@link _get_auto_filename()}
  1323|      */
  1324|     function _get_compile_path($resource_name)
  1325|     {
  1326|         return $this->_get_auto_filename($this->compile_dir, $resource_name,
  1327|                                          $this->_compile_id) . '.php';
  1328|     }
  1329|     /**
  1330|      * fetch the template info. Gets timestamp, and source
  1331|      * if get_source is true
  1332|      *
  1333|      * sets $source_content to the source of the template, and
  1334|      * $resource_timestamp to its time stamp
  1335|      * @param string $resource_name
  1336|      * @param string $source_content
  1337|      * @param integer $resource_timestamp
  1338|      * @param boolean $get_source
  1339|      * @param boolean $quiet
  1340|      * @return boolean
  1341|      */
  1342|     function _fetch_resource_info(&$params)
  1343|     {
  1344|         if(!isset($params['get_source'])) { $params['get_source'] = true; }
  1345|         if(!isset($params['quiet'])) { $params['quiet'] = false; }
  1346|         $_return = false;
  1347|         $_params = array('resource_name' => $params['resource_name']) ;
  1348|         if (isset($params['resource_base_path']))
  1349|             $_params['resource_base_path'] = $params['resource_base_path'];
  1350|         else
  1351|             $_params['resource_base_path'] = $this->template_dir;
  1352|         if ($this->_parse_resource_name($_params)) {
  1353|             $_resource_type = $_params['resource_type'];
  1354|             $_resource_name = $_params['resource_name'];
  1355|             switch ($_resource_type) {
  1356|                 case 'file':
  1357|                     if ($params['get_source']) {
  1358|                         $params['source_content'] = $this->_read_file($_resource_name);
  1359|                     }
  1360|                     $params['resource_timestamp'] = filemtime($_resource_name);
  1361|                     $_return = is_file($_resource_name);
  1362|                     break;
  1363|                 default:
  1364|                     if ($params['get_source']) {
  1365|                         $_source_return = isset($this->_plugins['resource'][$_resource_type]) &&
  1366|                             call_user_func_array($this->_plugins['resource'][$_resource_type][0][0],
  1367|                                                  array($_resource_name, &$params['source_content'], &$this));
  1368|                     } else {
  1369|                         $_source_return = true;
  1370|                     }
  1371|                     $_timestamp_return = isset($this->_plugins['resource'][$_resource_type]) &&
  1372|                         call_user_func_array($this->_plugins['resource'][$_resource_type][0][1],
  1373|                                              array($_resource_name, &$params['resource_timestamp'], &$this));
  1374|                     $_return = $_source_return && $_timestamp_return;
  1375|                     break;
  1376|             }
  1377|         }
  1378|         if (!$_return) {
  1379|             if (!empty($this->default_template_handler_func)) {
  1380|                 if (!is_callable($this->default_template_handler_func)) {
  1381|                     $this->trigger_error("default template handler function \"$this->default_template_handler_func\" doesn't exist.");
  1382|                 } else {
  1383|                     $_return = call_user_func_array(
  1384|                         $this->default_template_handler_func,
  1385|                         array($_params['resource_type'], $_params['resource_name'], &$params['source_content'], &$params['resource_timestamp'], &$this));
  1386|                 }
  1387|             }
  1388|         }
  1389|         if (!$_return) {
  1390|             if (!$params['quiet']) {
  1391|                 $this->trigger_error('unable to read resource: "' . $params['resource_name'] . '"');
  1392|             }
  1393|         } else if ($_return && $this->security) {
  1394|             require_once(SMARTY_CORE_DIR . 'core.is_secure.php');
  1395|             if (!smarty_core_is_secure($_params, $this)) {
  1396|                 if (!$params['quiet'])
  1397|                     $this->trigger_error('(secure mode) accessing "' . $params['resource_name'] . '" is not allowed');
  1398|                 $params['source_content'] = null;
  1399|                 $params['resource_timestamp'] = null;
  1400|                 return false;
  1401|             }
  1402|         }
  1403|         return $_return;
  1404|     }
  1405|     /**
  1406|      * parse out the type and name from the resource
  1407|      *
  1408|      * @param string $resource_base_path
  1409|      * @param string $resource_name
  1410|      * @param string $resource_type
  1411|      * @param string $resource_name
  1412|      * @return boolean
  1413|      */
  1414|     function _parse_resource_name(&$params)
  1415|     {
  1416|         $_resource_name_parts = explode(':', $params['resource_name'], 2);
  1417|         if (count($_resource_name_parts) == 1) {
  1418|             $params['resource_type'] = $this->default_resource_type;
  1419|             $params['resource_name'] = $_resource_name_parts[0];
  1420|         } else {
  1421|             if(strlen($_resource_name_parts[0]) == 1) {
  1422|                 $params['resource_type'] = $this->default_resource_type;
  1423|                 $params['resource_name'] = $params['resource_name'];
  1424|             } else {
  1425|                 $params['resource_type'] = $_resource_name_parts[0];
  1426|                 $params['resource_name'] = $_resource_name_parts[1];
  1427|             }
  1428|         }
  1429|         if ($params['resource_type'] == 'file') {
  1430|             if (!preg_match('/^([\/\\\\]|[a-zA-Z]:[\/\\\\])/', $params['resource_name'])) {
  1431|                 foreach ((array)$params['resource_base_path'] as $_curr_path) {
  1432|                     $_fullpath = $_curr_path . DIRECTORY_SEPARATOR . $params['resource_name'];
  1433|                     if (file_exists($_fullpath) && is_file($_fullpath)) {
  1434|                         $params['resource_name'] = $_fullpath;
  1435|                         return true;
  1436|                     }
  1437|                     $_params = array('file_path' => $_fullpath);
  1438|                     require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
  1439|                     if(smarty_core_get_include_path($_params, $this)) {
  1440|                         $params['resource_name'] = $_params['new_file_path'];
  1441|                         return true;
  1442|                     }
  1443|                 }
  1444|                 return false;
  1445|             } else {
  1446|                 /* absolute path */
  1447|                 return file_exists($params['resource_name']);
  1448|             }
  1449|         } elseif (empty($this->_plugins['resource'][$params['resource_type']])) {
  1450|             $_params = array('type' => $params['resource_type']);
  1451|             require_once(SMARTY_CORE_DIR . 'core.load_resource_plugin.php');
  1452|             smarty_core_load_resource_plugin($_params, $this);
  1453|         }
  1454|         return true;
  1455|     }
  1456|     /**
  1457|      * Handle modifiers
  1458|      *
  1459|      * @param string|null $modifier_name
  1460|      * @param array|null $map_array
  1461|      * @return string result of modifiers
  1462|      */
  1463|     function _run_mod_handler()
  1464|     {
  1465|         $_args = func_get_args();
  1466|         list($_modifier_name, $_map_array) = array_splice($_args, 0, 2);
  1467|         list($_func_name, $_tpl_file, $_tpl_line) =
  1468|             $this->_plugins['modifier'][$_modifier_name];
  1469|         $_var = $_args[0];
  1470|         foreach ($_var as $_key => $_val) {
  1471|             $_args[0] = $_val;
  1472|             $_var[$_key] = call_user_func_array($_func_name, $_args);
  1473|         }
  1474|         return $_var;
  1475|     }
  1476|     /**
  1477|      * Remove starting and ending quotes from the string
  1478|      *
  1479|      * @param string $string
  1480|      * @return string
  1481|      */
  1482|     function _dequote($string)
  1483|     {
  1484|         if ((substr($string, 0, 1) == "'" || substr($string, 0, 1) == '"') &&
  1485|             substr($string, -1) == substr($string, 0, 1))
  1486|             return substr($string, 1, -1);
  1487|         else
  1488|             return $string;
  1489|     }
  1490|     /**
  1491|      * read in a file
  1492|      *
  1493|      * @param string $filename
  1494|      * @return string
  1495|      */
  1496|     function _read_file($filename)
  1497|     {
  1498|         if ( file_exists($filename) && ($fd = @fopen($filename, 'rb')) ) {
  1499|             $contents = '';
  1500|             while (!feof($fd)) {
  1501|                 $contents .= fread($fd, 8192);
  1502|             }
  1503|             fclose($fd);
  1504|             return $contents;
  1505|         } else {
  1506|             return false;
  1507|         }
  1508|     }
  1509|     /**
  1510|      * get a concrete filename for automagically created content
  1511|      *
  1512|      * @param string $auto_base
  1513|      * @param string $auto_source
  1514|      * @param string $auto_id
  1515|      * @return string
  1516|      * @staticvar string|null
  1517|      * @staticvar string|null
  1518|      */
  1519|     function _get_auto_filename($auto_base, $auto_source = null, $auto_id = null)
  1520|     {
  1521|         $_compile_dir_sep =  $this->use_sub_dirs ? DIRECTORY_SEPARATOR : '^';
  1522|         $_return = $auto_base . DIRECTORY_SEPARATOR;
  1523|         if(isset($auto_id)) {
  1524|             $auto_id = str_replace('%7C',$_compile_dir_sep,(urlencode($auto_id)));
  1525|             $_return .= $auto_id . $_compile_dir_sep;
  1526|         }
  1527|         if(isset($auto_source)) {
  1528|             $_filename = urlencode(basename($auto_source));
  1529|             $_crc32 = sprintf('%08X', crc32($auto_source));
  1530|             $_crc32 = substr($_crc32, 0, 2) . $_compile_dir_sep .
  1531|                       substr($_crc32, 0, 3) . $_compile_dir_sep . $_crc32;
  1532|             $_return .= '%%' . $_crc32 . '%%' . $_filename;
  1533|         }
  1534|         return $_return;
  1535|     }
  1536|     /**
  1537|      * unlink a file, possibly using expiration time
  1538|      *
  1539|      * @param string $resource
  1540|      * @param integer $exp_time
  1541|      */
  1542|     function _unlink($resource, $exp_time = null)
  1543|     {
  1544|         if(isset($exp_time)) {
  1545|             if(time() - @filemtime($resource) >= $exp_time) {
  1546|                 return @unlink($resource);
  1547|             }
  1548|         } else {
  1549|             return @unlink($resource);
  1550|         }
  1551|     }
  1552|     /**
  1553|      * returns an auto_id for auto-file-functions
  1554|      *
  1555|      * @param string $cache_id
  1556|      * @param string $compile_id
  1557|      * @return string|null
  1558|      */
  1559|     function _get_auto_id($cache_id=null, $compile_id=null) {
  1560|     if (isset($cache_id))
  1561|         return (isset($compile_id)) ? $cache_id . '|' . $compile_id  : $cache_id;
  1562|     elseif(isset($compile_id))
  1563|         return $compile_id;
  1564|     else
  1565|         return null;
  1566|     }
  1567|     /**
  1568|      * trigger Smarty plugin error
  1569|      *
  1570|      * @param string $error_msg
  1571|      * @param string $tpl_file
  1572|      * @param integer $tpl_line
  1573|      * @param string $file
  1574|      * @param integer $line
  1575|      * @param integer $error_type
  1576|      */
  1577|     function _trigger_fatal_error($error_msg, $tpl_file = null, $tpl_line = null,
  1578|             $file = null, $line = null, $error_type = E_USER_ERROR)
  1579|     {
  1580|         if(isset($file) && isset($line)) {
  1581|             $info = ' ('.basename($file).", line $line)";
  1582|         } else {
  1583|             $info = '';
  1584|         }
  1585|         if (isset($tpl_line) && isset($tpl_file)) {
  1586|             $this->trigger_error('[in ' . $tpl_file . ' line ' . $tpl_line . "]: $error_msg$info", $error_type);
  1587|         } else {
  1588|             $this->trigger_error($error_msg . $info, $error_type);
  1589|         }
  1590|     }
  1591|     /**
  1592|      * callback function for preg_replace, to call a non-cacheable block
  1593|      * @return string
  1594|      */
  1595|     function _process_compiled_include_callback($match) {
  1596|         $_func = '_smarty_tplfunc_'.$match[2].'_'.$match[3];
  1597|         ob_start();
  1598|         $_func($this);
  1599|         $_ret = ob_get_contents();
  1600|         ob_end_clean();
  1601|         return $_ret;
  1602|     }
  1603|     /**
  1604|      * called for included templates
  1605|      *
  1606|      * @param string $_smarty_include_tpl_file
  1607|      * @param string $_smarty_include_vars
  1608|      */
  1609|     function _smarty_include($params)
  1610|     {
  1611|         if ($this->debugging) {
  1612|             $_params = array();
  1613|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
  1614|             $debug_start_time = smarty_core_get_microtime($_params, $this);
  1615|             $this->_smarty_debug_info[] = array('type'      => 'template',
  1616|                                                   'filename'  => $params['smarty_include_tpl_file'],
  1617|                                                   'depth'     => ++$this->_inclusion_depth);
  1618|             $included_tpls_idx = count($this->_smarty_debug_info) - 1;
  1619|         }
  1620|         $this->_tpl_vars = array_merge($this->_tpl_vars, $params['smarty_include_vars']);
  1621|         array_unshift($this->_config, $this->_config[0]);
  1622|         $_smarty_compile_path = $this->_get_compile_path($params['smarty_include_tpl_file']);
  1623|         if ($this->_is_compiled($params['smarty_include_tpl_file'], $_smarty_compile_path)
  1624|             || $this->_compile_resource($params['smarty_include_tpl_file'], $_smarty_compile_path))
  1625|         {
  1626|             include($_smarty_compile_path);
  1627|         }
  1628|         array_shift($this->_config);
  1629|         $this->_inclusion_depth--;
  1630|         if ($this->debugging) {
  1631|             $_params = array();
  1632|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
  1633|             $this->_smarty_debug_info[$included_tpls_idx]['exec_time'] = smarty_core_get_microtime($_params, $this) - $debug_start_time;
  1634|         }
  1635|         if ($this->caching) {
  1636|             $this->_cache_info['template'][$params['smarty_include_tpl_file']] = true;
  1637|         }
  1638|     }
  1639|     /**
  1640|      * get or set an array of cached attributes for function that is
  1641|      * not cacheable
  1642|      * @return array
  1643|      */
  1644|     function &_smarty_cache_attrs($cache_serial, $count) {
  1645|         $_cache_attrs =& $this->_cache_info['cache_attrs'][$cache_serial][$count];
  1646|         if ($this->_cache_including) {
  1647|             /* return next set of cache_attrs */
  1648|             $_return = current($_cache_attrs);
  1649|             next($_cache_attrs);
  1650|             return $_return;
  1651|         } else {
  1652|             /* add a reference to a new set of cache_attrs */
  1653|             $_cache_attrs[] = array();
  1654|             return $_cache_attrs[count($_cache_attrs)-1];
  1655|         }
  1656|     }
  1657|     /**
  1658|      * wrapper for include() retaining $this
  1659|      * @return mixed
  1660|      */
  1661|     function _include($filename, $once=false, $params=null)
  1662|     {
  1663|         if ($once) {
  1664|             return include_once($filename);
  1665|         } else {
  1666|             return include($filename);
  1667|         }
  1668|     }
  1669|     /**
  1670|      * wrapper for eval() retaining $this
  1671|      * @return mixed
  1672|      */
  1673|     function _eval($code, $params=null)
  1674|     {
  1675|         return eval($code);
  1676|     }
  1677|     /**#@-*/
  1678| }
  1679| /* vim: set expandtab: */
  1680| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/Smarty_Compiler.class.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1894 ---
     1| <?php
     2| /**
     3|  * Project:     Smarty: the PHP compiling template engine
     4|  * File:        Smarty_Compiler.class.php
     5|  *
     6|  * This library is free software; you can redistribute it and/or
     7|  * modify it under the terms of the GNU Lesser General Public
     8|  * License as published by the Free Software Foundation; either
     9|  * version 2.1 of the License, or (at your option) any later version.
    10|  *
    11|  * This library is distributed in the hope that it will be useful,
    12|  * but WITHOUT ANY WARRANTY; without even the implied warranty of
    13|  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
    14|  * Lesser General Public License for more details.
    15|  *
    16|  * You should have received a copy of the GNU Lesser General Public
    17|  * License along with this library; if not, write to the Free Software
    18|  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    19|  *
    20|  * @link http://smarty.php.net/
    21|  * @author Monte Ohrt <monte at ohrt dot com>
    22|  * @author Andrei Zmievski <andrei@php.net>
    23|  * @version 2.6.18
    24|  * @copyright 2001-2005 New Digital Group, Inc.
    25|  * @package Smarty
    26|  */
    27| /* $Id$ */
    28| /**
    29|  * Template compiling class
    30|  * @package Smarty
    31|  */
    32| class Smarty_Compiler extends Smarty {
    33|     /**#@+
    34|      * @access private
    35|      */
    36|     var $_folded_blocks         =   array();    // keeps folded template blocks
    37|     var $_current_file          =   null;       // the current template being compiled
    38|     var $_current_line_no       =   1;          // line number for error messages
    39|     var $_capture_stack         =   array();    // keeps track of nested capture buffers
    40|     var $_plugin_info           =   array();    // keeps track of plugins to load
    41|     var $_init_smarty_vars      =   false;
    42|     var $_permitted_tokens      =   array('true','false','yes','no','on','off','null');
    43|     var $_db_qstr_regexp        =   null;        // regexps are setup in the constructor
    44|     var $_si_qstr_regexp        =   null;
    45|     var $_qstr_regexp           =   null;
    46|     var $_func_regexp           =   null;
    47|     var $_reg_obj_regexp        =   null;
    48|     var $_var_bracket_regexp    =   null;
    49|     var $_num_const_regexp      =   null;
    50|     var $_dvar_guts_regexp      =   null;
    51|     var $_dvar_regexp           =   null;
    52|     var $_cvar_regexp           =   null;
    53|     var $_svar_regexp           =   null;
    54|     var $_avar_regexp           =   null;
    55|     var $_mod_regexp            =   null;
    56|     var $_var_regexp            =   null;
    57|     var $_parenth_param_regexp  =   null;
    58|     var $_func_call_regexp      =   null;
    59|     var $_obj_ext_regexp        =   null;
    60|     var $_obj_start_regexp      =   null;
    61|     var $_obj_params_regexp     =   null;
    62|     var $_obj_call_regexp       =   null;
    63|     var $_cacheable_state       =   0;
    64|     var $_cache_attrs_count     =   0;
    65|     var $_nocache_count         =   0;
    66|     var $_cache_serial          =   null;
    67|     var $_cache_include         =   null;
    68|     var $_strip_depth           =   0;
    69|     var $_additional_newline    =   "\n";
    70|     /**#@-*/
    71|     /**
    72|      * The class constructor.
    73|      */
    74|     function Smarty_Compiler()
    75|     {
    76|         $this->_db_qstr_regexp = '"[^"\\\\]*(?:\\\\.[^"\\\\]*)*"';
    77|         $this->_si_qstr_regexp = '\'[^\'\\\\]*(?:\\\\.[^\'\\\\]*)*\'';
    78|         $this->_qstr_regexp = '(?:' . $this->_db_qstr_regexp . '|' . $this->_si_qstr_regexp . ')';
    79|         $this->_var_bracket_regexp = '\[\$?[\w\.]+\]';
    80|         $this->_num_const_regexp = '(?:\-?\d+(?:\.\d+)?)';
    81|         $this->_dvar_math_regexp = '(?:[\+\*\/\%]|(?:-(?!>)))';
    82|         $this->_dvar_math_var_regexp = '[\$\w\.\+\-\*\/\%\d\>\[\]]';
    83|         $this->_dvar_guts_regexp = '\w+(?:' . $this->_var_bracket_regexp
    84|                 . ')*(?:\.\$?\w+(?:' . $this->_var_bracket_regexp . ')*)*(?:' . $this->_dvar_math_regexp . '(?:' . $this->_num_const_regexp . '|' . $this->_dvar_math_var_regexp . ')*)?';
    85|         $this->_dvar_regexp = '\$' . $this->_dvar_guts_regexp;
    86|         $this->_cvar_regexp = '\#\w+\#';
    87|         $this->_svar_regexp = '\%\w+\.\w+\%';
    88|         $this->_avar_regexp = '(?:' . $this->_dvar_regexp . '|'
    89|            . $this->_cvar_regexp . '|' . $this->_svar_regexp . ')';
    90|         $this->_var_regexp = '(?:' . $this->_avar_regexp . '|' . $this->_qstr_regexp . ')';
    91|         $this->_obj_ext_regexp = '\->(?:\$?' . $this->_dvar_guts_regexp . ')';
    92|         $this->_obj_restricted_param_regexp = '(?:'
    93|                 . '(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . ')(?:' . $this->_obj_ext_regexp . '(?:\((?:(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . ')'
    94|                 . '(?:\s*,\s*(?:' . $this->_var_regexp . '|' . $this->_num_const_regexp . '))*)?\))?)*)';
    95|         $this->_obj_single_param_regexp = '(?:\w+|' . $this->_obj_restricted_param_regexp . '(?:\s*,\s*(?:(?:\w+|'
    96|                 . $this->_var_regexp . $this->_obj_restricted_param_regexp . ')))*)';
    97|         $this->_obj_params_regexp = '\((?:' . $this->_obj_single_param_regexp
    98|                 . '(?:\s*,\s*' . $this->_obj_single_param_regexp . ')*)?\)';
    99|         $this->_obj_start_regexp = '(?:' . $this->_dvar_regexp . '(?:' . $this->_obj_ext_regexp . ')+)';
   100|         $this->_obj_call_regexp = '(?:' . $this->_obj_start_regexp . '(?:' . $this->_obj_params_regexp . ')?(?:' . $this->_dvar_math_regexp . '(?:' . $this->_num_const_regexp . '|' . $this->_dvar_math_var_regexp . ')*)?)';
   101|         $this->_mod_regexp = '(?:\|@?\w+(?::(?:\w+|' . $this->_num_const_regexp . '|'
   102|            . $this->_obj_call_regexp . '|' . $this->_avar_regexp . '|' . $this->_qstr_regexp .'))*)';
   103|         $this->_func_regexp = '[a-zA-Z_]\w*';
   104|         $this->_reg_obj_regexp = '[a-zA-Z_]\w*->[a-zA-Z_]\w*';
   105|         $this->_param_regexp = '(?:\s*(?:' . $this->_obj_call_regexp . '|'
   106|            . $this->_var_regexp . '|' . $this->_num_const_regexp  . '|\w+)(?>' . $this->_mod_regexp . '*)\s*)';
   107|         $this->_parenth_param_regexp = '(?:\((?:\w+|'
   108|                 . $this->_param_regexp . '(?:\s*,\s*(?:(?:\w+|'
   109|                 . $this->_param_regexp . ')))*)?\))';
   110|         $this->_func_call_regexp = '(?:' . $this->_func_regexp . '\s*(?:'
   111|            . $this->_parenth_param_regexp . '))';
   112|     }
   113|     /**
   114|      * compile a resource
   115|      *
   116|      * sets $compiled_content to the compiled source
   117|      * @param string $resource_name
   118|      * @param string $source_content
   119|      * @param string $compiled_content
   120|      * @return true
   121|      */
   122|     function _compile_file($resource_name, $source_content, &$compiled_content)
   123|     {
   124|         if ($this->security) {
   125|             if ($this->php_handling == SMARTY_PHP_ALLOW &&
   126|                 !$this->security_settings['PHP_HANDLING']) {
   127|                 $this->php_handling = SMARTY_PHP_PASSTHRU;
   128|             }
   129|         }
   130|         $this->_load_filters();
   131|         $this->_current_file = $resource_name;
   132|         $this->_current_line_no = 1;
   133|         $ldq = preg_quote($this->left_delimiter, '~');
   134|         $rdq = preg_quote($this->right_delimiter, '~');
   135|         if (count($this->_plugins['prefilter']) > 0) {
   136|             foreach ($this->_plugins['prefilter'] as $filter_name => $prefilter) {
   137|                 if ($prefilter === false) continue;
   138|                 if ($prefilter[3] || is_callable($prefilter[0])) {
   139|                     $source_content = call_user_func_array($prefilter[0],
   140|                                                             array($source_content, &$this));
   141|                     $this->_plugins['prefilter'][$filter_name][3] = true;
   142|                 } else {
   143|                     $this->_trigger_fatal_error("[plugin] prefilter '$filter_name' is not implemented");
   144|                 }
   145|             }
   146|         }
   147|         /* fetch all special blocks */
   148|         $search = "~{$ldq}\*(.*?)\*{$rdq}|{$ldq}\s*literal\s*{$rdq}(.*?){$ldq}\s*/literal\s*{$rdq}|{$ldq}\s*php\s*{$rdq}(.*?){$ldq}\s*/php\s*{$rdq}~s";
   149|         preg_match_all($search, $source_content, $match,  PREG_SET_ORDER);
   150|         $this->_folded_blocks = $match;
   151|         reset($this->_folded_blocks);
   152|         /* replace special blocks by "{php}" */
   153|         $source_content = preg_replace($search.'e', "'"
   154|                                        . $this->_quote_replace($this->left_delimiter) . 'php'
   155|                                        . "' . str_repeat(\"\n\", substr_count('\\0', \"\n\")) .'"
   156|                                        . $this->_quote_replace($this->right_delimiter)
   157|                                        . "'"
   158|                                        , $source_content);
   159|         /* Gather all template tags. */
   160|         preg_match_all("~{$ldq}\s*(.*?)\s*{$rdq}~s", $source_content, $_match);
   161|         $template_tags = $_match[1];
   162|         /* preg_split content by template tags to obtain non-template content. */
   163|         $text_blocks = preg_split("~{$ldq}.*?{$rdq}~s", $source_content);
   164|         /* loop through text blocks */
   165|         for ($curr_tb = 0, $for_max = count($text_blocks); $curr_tb < $for_max; $curr_tb++) {
   166|             /* match anything resembling php tags */
   167|             if (preg_match_all('~(<\?(?:\w+|=)?|\?>|language\s*=\s*[\"\']?\s*php\s*[\"\']?)~is', $text_blocks[$curr_tb], $sp_match)) {
   168|                 /* replace tags with placeholders to prevent recursive replacements */
   169|                 $sp_match[1] = array_unique($sp_match[1]);
   170|                 usort($sp_match[1], '_smarty_sort_length');
   171|                 for ($curr_sp = 0, $for_max2 = count($sp_match[1]); $curr_sp < $for_max2; $curr_sp++) {
   172|                     $text_blocks[$curr_tb] = str_replace($sp_match[1][$curr_sp],'%%%SMARTYSP'.$curr_sp.'%%%',$text_blocks[$curr_tb]);
   173|                 }
   174|                 /* process each one */
   175|                 for ($curr_sp = 0, $for_max2 = count($sp_match[1]); $curr_sp < $for_max2; $curr_sp++) {
   176|                     if ($this->php_handling == SMARTY_PHP_PASSTHRU) {
   177|                         /* echo php contents */
   178|                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '<?php echo \''.str_replace("'", "\'", $sp_match[1][$curr_sp]).'\'; ?>'."\n", $text_blocks[$curr_tb]);
   179|                     } else if ($this->php_handling == SMARTY_PHP_QUOTE) {
   180|                         /* quote php tags */
   181|                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', htmlspecialchars($sp_match[1][$curr_sp]), $text_blocks[$curr_tb]);
   182|                     } else if ($this->php_handling == SMARTY_PHP_REMOVE) {
   183|                         /* remove php tags */
   184|                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', '', $text_blocks[$curr_tb]);
   185|                     } else {
   186|                         /* SMARTY_PHP_ALLOW, but echo non php starting tags */
   187|                         $sp_match[1][$curr_sp] = preg_replace('~(<\?(?!php|=|$))~i', '<?php echo \'\\1\'?>'."\n", $sp_match[1][$curr_sp]);
   188|                         $text_blocks[$curr_tb] = str_replace('%%%SMARTYSP'.$curr_sp.'%%%', $sp_match[1][$curr_sp], $text_blocks[$curr_tb]);
   189|                     }
   190|                 }
   191|             }
   192|         }
   193|         /* Compile the template tags into PHP code. */
   194|         $compiled_tags = array();
   195|         for ($i = 0, $for_max = count($template_tags); $i < $for_max; $i++) {
   196|             $this->_current_line_no += substr_count($text_blocks[$i], "\n");
   197|             $compiled_tags[] = $this->_compile_tag($template_tags[$i]);
   198|             $this->_current_line_no += substr_count($template_tags[$i], "\n");
   199|         }
   200|         if (count($this->_tag_stack)>0) {
   201|             list($_open_tag, $_line_no) = end($this->_tag_stack);
   202|             $this->_syntax_error("unclosed tag \{$_open_tag} (opened line $_line_no).", E_USER_ERROR, __FILE__, __LINE__);
   203|             return;
   204|         }
   205|         /* Reformat $text_blocks between 'strip' and '/strip' tags,
   206|            removing spaces, tabs and newlines. */
   207|         $strip = false;
   208|         for ($i = 0, $for_max = count($compiled_tags); $i < $for_max; $i++) {
   209|             if ($compiled_tags[$i] == '{strip}') {
   210|                 $compiled_tags[$i] = '';
   211|                 $strip = true;
   212|                 /* remove leading whitespaces */
   213|                 $text_blocks[$i + 1] = ltrim($text_blocks[$i + 1]);
   214|             }
   215|             if ($strip) {
   216|                 /* strip all $text_blocks before the next '/strip' */
   217|                 for ($j = $i + 1; $j < $for_max; $j++) {
   218|                     /* remove leading and trailing whitespaces of each line */
   219|                     $text_blocks[$j] = preg_replace('![\t ]*[\r\n]+[\t ]*!', '', $text_blocks[$j]);
   220|                     if ($compiled_tags[$j] == '{/strip}') {
   221|                         /* remove trailing whitespaces from the last text_block */
   222|                         $text_blocks[$j] = rtrim($text_blocks[$j]);
   223|                     }
   224|                     $text_blocks[$j] = "<?php echo '" . strtr($text_blocks[$j], array("'"=>"\'", "\\"=>"\\\\")) . "'; ?>";
   225|                     if ($compiled_tags[$j] == '{/strip}') {
   226|                         $compiled_tags[$j] = "\n"; /* slurped by php, but necessary
   227|                                     if a newline is following the closing strip-tag */
   228|                         $strip = false;
   229|                         $i = $j;
   230|                         break;
   231|                     }
   232|                 }
   233|             }
   234|         }
   235|         $compiled_content = '';
   236|         $tag_guard = '%%%SMARTYOTG' . md5(uniqid(rand(), true)) . '%%%';
   237|         /* Interleave the compiled contents and text blocks to get the final result. */
   238|         for ($i = 0, $for_max = count($compiled_tags); $i < $for_max; $i++) {
   239|             if ($compiled_tags[$i] == '') {
   240|                 $text_blocks[$i+1] = preg_replace('~^(\r\n|\r|\n)~', '', $text_blocks[$i+1]);
   241|             }
   242|             $text_blocks[$i] = str_replace('<?', $tag_guard, $text_blocks[$i]);
   243|             $compiled_tags[$i] = str_replace('<?', $tag_guard, $compiled_tags[$i]);
   244|             $compiled_content .= $text_blocks[$i] . $compiled_tags[$i];
   245|         }
   246|         $compiled_content .= str_replace('<?', $tag_guard, $text_blocks[$i]);
   247|         $compiled_content = str_replace('<?', "<?php echo '<?' ?>\n", $compiled_content);
   248|         $compiled_content = preg_replace("~(?<!')language\s*=\s*[\"\']?\s*php\s*[\"\']?~", "<?php echo 'language=php' ?>\n", $compiled_content);
   249|         $compiled_content = str_replace($tag_guard, '<?', $compiled_content);
   250|         if (strlen($compiled_content) && (substr($compiled_content, -1) == "\n") ) {
   251|             $compiled_content = substr($compiled_content, 0, -1);
   252|         }
   253|         if (!empty($this->_cache_serial)) {
   254|             $compiled_content = "<?php \$this->_cache_serials['".$this->_cache_include."'] = '".$this->_cache_serial."'; ?>" . $compiled_content;
   255|         }
   256|         if (count($this->_plugins['postfilter']) > 0) {
   257|             foreach ($this->_plugins['postfilter'] as $filter_name => $postfilter) {
   258|                 if ($postfilter === false) continue;
   259|                 if ($postfilter[3] || is_callable($postfilter[0])) {
   260|                     $compiled_content = call_user_func_array($postfilter[0],
   261|                                                               array($compiled_content, &$this));
   262|                     $this->_plugins['postfilter'][$filter_name][3] = true;
   263|                 } else {
   264|                     $this->_trigger_fatal_error("Smarty plugin error: postfilter '$filter_name' is not implemented");
   265|                 }
   266|             }
   267|         }
   268|         $template_header = "<?php /* Smarty version ".$this->_version.", created on ".strftime("%Y-%m-%d %H:%M:%S")."\n";
   269|         $template_header .= "         compiled from ".strtr(urlencode($resource_name), array('%2F'=>'/', '%3A'=>':'))." */ ?>\n";
   270|         /* Emit code to load needed plugins. */
   271|         $this->_plugins_code = '';
   272|         if (count($this->_plugin_info)) {
   273|             $_plugins_params = "array('plugins' => array(";
   274|             foreach ($this->_plugin_info as $plugin_type => $plugins) {
   275|                 foreach ($plugins as $plugin_name => $plugin_info) {
   276|                     $_plugins_params .= "array('$plugin_type', '$plugin_name', '" . strtr($plugin_info[0], array("'" => "\\'", "\\" => "\\\\")) . "', $plugin_info[1], ";
   277|                     $_plugins_params .= $plugin_info[2] ? 'true),' : 'false),';
   278|                 }
   279|             }
   280|             $_plugins_params .= '))';
   281|             $plugins_code = "<?php require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');\nsmarty_core_load_plugins($_plugins_params, \$this); ?>\n";
   282|             $template_header .= $plugins_code;
   283|             $this->_plugin_info = array();
   284|             $this->_plugins_code = $plugins_code;
   285|         }
   286|         if ($this->_init_smarty_vars) {
   287|             $template_header .= "<?php require_once(SMARTY_CORE_DIR . 'core.assign_smarty_interface.php');\nsmarty_core_assign_smarty_interface(null, \$this); ?>\n";
   288|             $this->_init_smarty_vars = false;
   289|         }
   290|         $compiled_content = $template_header . $compiled_content;
   291|         return true;
   292|     }
   293|     /**
   294|      * Compile a template tag
   295|      *
   296|      * @param string $template_tag
   297|      * @return string
   298|      */
   299|     function _compile_tag($template_tag)
   300|     {
   301|         /* Matched comment. */
   302|         if (substr($template_tag, 0, 1) == '*' && substr($template_tag, -1) == '*')
   303|             return '';
   304|         /* preg_split tag into two three parts: command, command modifiers and the arguments. */
   305|         if(! preg_match('~^(?:(' . $this->_num_const_regexp . '|' . $this->_obj_call_regexp . '|' . $this->_var_regexp
   306|                 . '|\/?' . $this->_reg_obj_regexp . '|\/?' . $this->_func_regexp . ')(' . $this->_mod_regexp . '*))
   307|                       (?:\s+(.*))?$
   308|                     ~xs', $template_tag, $match)) {
   309|             $this->_syntax_error("unrecognized tag: $template_tag", E_USER_ERROR, __FILE__, __LINE__);
   310|         }
   311|         $tag_command = $match[1];
   312|         $tag_modifier = isset($match[2]) ? $match[2] : null;
   313|         $tag_args = isset($match[3]) ? $match[3] : null;
   314|         if (preg_match('~^' . $this->_num_const_regexp . '|' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '$~', $tag_command)) {
   315|             /* tag name is a variable or object */
   316|             $_return = $this->_parse_var_props($tag_command . $tag_modifier);
   317|             return "<?php echo $_return; ?>" . $this->_additional_newline;
   318|         }
   319|         /* If the tag name is a registered object, we process it. */
   320|         if (preg_match('~^\/?' . $this->_reg_obj_regexp . '$~', $tag_command)) {
   321|             return $this->_compile_registered_object_tag($tag_command, $this->_parse_attrs($tag_args), $tag_modifier);
   322|         }
   323|         switch ($tag_command) {
   324|             case 'include':
   325|                 return $this->_compile_include_tag($tag_args);
   326|             case 'include_php':
   327|                 return $this->_compile_include_php_tag($tag_args);
   328|             case 'if':
   329|                 $this->_push_tag('if');
   330|                 return $this->_compile_if_tag($tag_args);
   331|             case 'else':
   332|                 list($_open_tag) = end($this->_tag_stack);
   333|                 if ($_open_tag != 'if' && $_open_tag != 'elseif')
   334|                     $this->_syntax_error('unexpected {else}', E_USER_ERROR, __FILE__, __LINE__);
   335|                 else
   336|                     $this->_push_tag('else');
   337|                 return '<?php else: ?>';
   338|             case 'elseif':
   339|                 list($_open_tag) = end($this->_tag_stack);
   340|                 if ($_open_tag != 'if' && $_open_tag != 'elseif')
   341|                     $this->_syntax_error('unexpected {elseif}', E_USER_ERROR, __FILE__, __LINE__);
   342|                 if ($_open_tag == 'if')
   343|                     $this->_push_tag('elseif');
   344|                 return $this->_compile_if_tag($tag_args, true);
   345|             case '/if':
   346|                 $this->_pop_tag('if');
   347|                 return '<?php endif; ?>';
   348|             case 'capture':
   349|                 return $this->_compile_capture_tag(true, $tag_args);
   350|             case '/capture':
   351|                 return $this->_compile_capture_tag(false);
   352|             case 'ldelim':
   353|                 return $this->left_delimiter;
   354|             case 'rdelim':
   355|                 return $this->right_delimiter;
   356|             case 'section':
   357|                 $this->_push_tag('section');
   358|                 return $this->_compile_section_start($tag_args);
   359|             case 'sectionelse':
   360|                 $this->_push_tag('sectionelse');
   361|                 return "<?php endfor; else: ?>";
   362|                 break;
   363|             case '/section':
   364|                 $_open_tag = $this->_pop_tag('section');
   365|                 if ($_open_tag == 'sectionelse')
   366|                     return "<?php endif; ?>";
   367|                 else
   368|                     return "<?php endfor; endif; ?>";
   369|             case 'foreach':
   370|                 $this->_push_tag('foreach');
   371|                 return $this->_compile_foreach_start($tag_args);
   372|                 break;
   373|             case 'foreachelse':
   374|                 $this->_push_tag('foreachelse');
   375|                 return "<?php endforeach; else: ?>";
   376|             case '/foreach':
   377|                 $_open_tag = $this->_pop_tag('foreach');
   378|                 if ($_open_tag == 'foreachelse')
   379|                     return "<?php endif; unset(\$_from); ?>";
   380|                 else
   381|                     return "<?php endforeach; endif; unset(\$_from); ?>";
   382|                 break;
   383|             case 'strip':
   384|             case '/strip':
   385|                 if (substr($tag_command, 0, 1)=='/') {
   386|                     $this->_pop_tag('strip');
   387|                     if (--$this->_strip_depth==0) { /* outermost closing {/strip} */
   388|                         $this->_additional_newline = "\n";
   389|                         return '{' . $tag_command . '}';
   390|                     }
   391|                 } else {
   392|                     $this->_push_tag('strip');
   393|                     if ($this->_strip_depth++==0) { /* outermost opening {strip} */
   394|                         $this->_additional_newline = "";
   395|                         return '{' . $tag_command . '}';
   396|                     }
   397|                 }
   398|                 return '';
   399|             case 'php':
   400|                 /* handle folded tags replaced by {php} */
   401|                 list(, $block) = each($this->_folded_blocks);
   402|                 $this->_current_line_no += substr_count($block[0], "\n");
   403|                 /* the number of matched elements in the regexp in _compile_file()
   404|                    determins the type of folded tag that was found */
   405|                 switch (count($block)) {
   406|                     case 2: /* comment */
   407|                         return '';
   408|                     case 3: /* literal */
   409|                         return "<?php echo '" . strtr($block[2], array("'"=>"\'", "\\"=>"\\\\")) . "'; ?>" . $this->_additional_newline;
   410|                     case 4: /* php */
   411|                         if ($this->security && !$this->security_settings['PHP_TAGS']) {
   412|                             $this->_syntax_error("(secure mode) php tags not permitted", E_USER_WARNING, __FILE__, __LINE__);
   413|                             return;
   414|                         }
   415|                         return '<?php ' . $block[3] .' ?>';
   416|                 }
   417|                 break;
   418|             case 'insert':
   419|                 return $this->_compile_insert_tag($tag_args);
   420|             default:
   421|                 if ($this->_compile_compiler_tag($tag_command, $tag_args, $output)) {
   422|                     return $output;
   423|                 } else if ($this->_compile_block_tag($tag_command, $tag_args, $tag_modifier, $output)) {
   424|                     return $output;
   425|                 } else if ($this->_compile_custom_tag($tag_command, $tag_args, $tag_modifier, $output)) {
   426|                     return $output;
   427|                 } else {
   428|                     $this->_syntax_error("unrecognized tag '$tag_command'", E_USER_ERROR, __FILE__, __LINE__);
   429|                 }
   430|         }
   431|     }
   432|     /**
   433|      * compile the custom compiler tag
   434|      *
   435|      * sets $output to the compiled custom compiler tag
   436|      * @param string $tag_command
   437|      * @param string $tag_args
   438|      * @param string $output
   439|      * @return boolean
   440|      */
   441|     function _compile_compiler_tag($tag_command, $tag_args, &$output)
   442|     {
   443|         $found = false;
   444|         $have_function = true;
   445|         /*
   446|          * First we check if the compiler function has already been registered
   447|          * or loaded from a plugin file.
   448|          */
   449|         if (isset($this->_plugins['compiler'][$tag_command])) {
   450|             $found = true;
   451|             $plugin_func = $this->_plugins['compiler'][$tag_command][0];
   452|             if (!is_callable($plugin_func)) {
   453|                 $message = "compiler function '$tag_command' is not implemented";
   454|                 $have_function = false;
   455|             }
   456|         }
   457|         /*
   458|          * Otherwise we need to load plugin file and look for the function
   459|          * inside it.
   460|          */
   461|         else if ($plugin_file = $this->_get_plugin_filepath('compiler', $tag_command)) {
   462|             $found = true;
   463|             include_once $plugin_file;
   464|             $plugin_func = 'smarty_compiler_' . $tag_command;
   465|             if (!is_callable($plugin_func)) {
   466|                 $message = "plugin function $plugin_func() not found in $plugin_file\n";
   467|                 $have_function = false;
   468|             } else {
   469|                 $this->_plugins['compiler'][$tag_command] = array($plugin_func, null, null, null, true);
   470|             }
   471|         }
   472|         /*
   473|          * True return value means that we either found a plugin or a
   474|          * dynamically registered function. False means that we didn't and the
   475|          * compiler should now emit code to load custom function plugin for this
   476|          * tag.
   477|          */
   478|         if ($found) {
   479|             if ($have_function) {
   480|                 $output = call_user_func_array($plugin_func, array($tag_args, &$this));
   481|                 if($output != '') {
   482|                 $output = '<?php ' . $this->_push_cacheable_state('compiler', $tag_command)
   483|                                    . $output
   484|                                    . $this->_pop_cacheable_state('compiler', $tag_command) . ' ?>';
   485|                 }
   486|             } else {
   487|                 $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
   488|             }
   489|             return true;
   490|         } else {
   491|             return false;
   492|         }
   493|     }
   494|     /**
   495|      * compile block function tag
   496|      *
   497|      * sets $output to compiled block function tag
   498|      * @param string $tag_command
   499|      * @param string $tag_args
   500|      * @param string $tag_modifier
   501|      * @param string $output
   502|      * @return boolean
   503|      */
   504|     function _compile_block_tag($tag_command, $tag_args, $tag_modifier, &$output)
   505|     {
   506|         if (substr($tag_command, 0, 1) == '/') {
   507|             $start_tag = false;
   508|             $tag_command = substr($tag_command, 1);
   509|         } else
   510|             $start_tag = true;
   511|         $found = false;
   512|         $have_function = true;
   513|         /*
   514|          * First we check if the block function has already been registered
   515|          * or loaded from a plugin file.
   516|          */
   517|         if (isset($this->_plugins['block'][$tag_command])) {
   518|             $found = true;
   519|             $plugin_func = $this->_plugins['block'][$tag_command][0];
   520|             if (!is_callable($plugin_func)) {
   521|                 $message = "block function '$tag_command' is not implemented";
   522|                 $have_function = false;
   523|             }
   524|         }
   525|         /*
   526|          * Otherwise we need to load plugin file and look for the function
   527|          * inside it.
   528|          */
   529|         else if ($plugin_file = $this->_get_plugin_filepath('block', $tag_command)) {
   530|             $found = true;
   531|             include_once $plugin_file;
   532|             $plugin_func = 'smarty_block_' . $tag_command;
   533|             if (!function_exists($plugin_func)) {
   534|                 $message = "plugin function $plugin_func() not found in $plugin_file\n";
   535|                 $have_function = false;
   536|             } else {
   537|                 $this->_plugins['block'][$tag_command] = array($plugin_func, null, null, null, true);
   538|             }
   539|         }
   540|         if (!$found) {
   541|             return false;
   542|         } else if (!$have_function) {
   543|             $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
   544|             return true;
   545|         }
   546|         /*
   547|          * Even though we've located the plugin function, compilation
   548|          * happens only once, so the plugin will still need to be loaded
   549|          * at runtime for future requests.
   550|          */
   551|         $this->_add_plugin('block', $tag_command);
   552|         if ($start_tag)
   553|             $this->_push_tag($tag_command);
   554|         else
   555|             $this->_pop_tag($tag_command);
   556|         if ($start_tag) {
   557|             $output = '<?php ' . $this->_push_cacheable_state('block', $tag_command);
   558|             $attrs = $this->_parse_attrs($tag_args);
   559|             $_cache_attrs='';
   560|             $arg_list = $this->_compile_arg_list('block', $tag_command, $attrs, $_cache_attrs);
   561|             $output .= "$_cache_attrs\$this->_tag_stack[] = array('$tag_command', array(".implode(',', $arg_list).')); ';
   562|             $output .= '$_block_repeat=true;' . $this->_compile_plugin_call('block', $tag_command).'($this->_tag_stack[count($this->_tag_stack)-1][1], null, $this, $_block_repeat);';
   563|             $output .= 'while ($_block_repeat) { ob_start(); ?>';
   564|         } else {
   565|             $output = '<?php $_block_content = ob_get_contents(); ob_end_clean(); ';
   566|             $_out_tag_text = $this->_compile_plugin_call('block', $tag_command).'($this->_tag_stack[count($this->_tag_stack)-1][1], $_block_content, $this, $_block_repeat)';
   567|             if ($tag_modifier != '') {
   568|                 $this->_parse_modifiers($_out_tag_text, $tag_modifier);
   569|             }
   570|             $output .= '$_block_repeat=false;echo ' . $_out_tag_text . '; } ';
   571|             $output .= " array_pop(\$this->_tag_stack); " . $this->_pop_cacheable_state('block', $tag_command) . '?>';
   572|         }
   573|         return true;
   574|     }
   575|     /**
   576|      * compile custom function tag
   577|      *
   578|      * @param string $tag_command
   579|      * @param string $tag_args
   580|      * @param string $tag_modifier
   581|      * @return string
   582|      */
   583|     function _compile_custom_tag($tag_command, $tag_args, $tag_modifier, &$output)
   584|     {
   585|         $found = false;
   586|         $have_function = true;
   587|         /*
   588|          * First we check if the custom function has already been registered
   589|          * or loaded from a plugin file.
   590|          */
   591|         if (isset($this->_plugins['function'][$tag_command])) {
   592|             $found = true;
   593|             $plugin_func = $this->_plugins['function'][$tag_command][0];
   594|             if (!is_callable($plugin_func)) {
   595|                 $message = "custom function '$tag_command' is not implemented";
   596|                 $have_function = false;
   597|             }
   598|         }
   599|         /*
   600|          * Otherwise we need to load plugin file and look for the function
   601|          * inside it.
   602|          */
   603|         else if ($plugin_file = $this->_get_plugin_filepath('function', $tag_command)) {
   604|             $found = true;
   605|             include_once $plugin_file;
   606|             $plugin_func = 'smarty_function_' . $tag_command;
   607|             if (!function_exists($plugin_func)) {
   608|                 $message = "plugin function $plugin_func() not found in $plugin_file\n";
   609|                 $have_function = false;
   610|             } else {
   611|                 $this->_plugins['function'][$tag_command] = array($plugin_func, null, null, null, true);
   612|             }
   613|         }
   614|         if (!$found) {
   615|             return false;
   616|         } else if (!$have_function) {
   617|             $this->_syntax_error($message, E_USER_WARNING, __FILE__, __LINE__);
   618|             return true;
   619|         }
   620|         /* declare plugin to be loaded on display of the template that
   621|            we compile right now */
   622|         $this->_add_plugin('function', $tag_command);
   623|         $_cacheable_state = $this->_push_cacheable_state('function', $tag_command);
   624|         $attrs = $this->_parse_attrs($tag_args);
   625|         $_cache_attrs = '';
   626|         $arg_list = $this->_compile_arg_list('function', $tag_command, $attrs, $_cache_attrs);
   627|         $output = $this->_compile_plugin_call('function', $tag_command).'(array('.implode(',', $arg_list)."), \$this)";
   628|         if($tag_modifier != '') {
   629|             $this->_parse_modifiers($output, $tag_modifier);
   630|         }
   631|         if($output != '') {
   632|             $output =  '<?php ' . $_cacheable_state . $_cache_attrs . 'echo ' . $output . ';'
   633|                 . $this->_pop_cacheable_state('function', $tag_command) . "?>" . $this->_additional_newline;
   634|         }
   635|         return true;
   636|     }
   637|     /**
   638|      * compile a registered object tag
   639|      *
   640|      * @param string $tag_command
   641|      * @param array $attrs
   642|      * @param string $tag_modifier
   643|      * @return string
   644|      */
   645|     function _compile_registered_object_tag($tag_command, $attrs, $tag_modifier)
   646|     {
   647|         if (substr($tag_command, 0, 1) == '/') {
   648|             $start_tag = false;
   649|             $tag_command = substr($tag_command, 1);
   650|         } else {
   651|             $start_tag = true;
   652|         }
   653|         list($object, $obj_comp) = explode('->', $tag_command);
   654|         $arg_list = array();
   655|         if(count($attrs)) {
   656|             $_assign_var = false;
   657|             foreach ($attrs as $arg_name => $arg_value) {
   658|                 if($arg_name == 'assign') {
   659|                     $_assign_var = $arg_value;
   660|                     unset($attrs['assign']);
   661|                     continue;
   662|                 }
   663|                 if (is_bool($arg_value))
   664|                     $arg_value = $arg_value ? 'true' : 'false';
   665|                 $arg_list[] = "'$arg_name' => $arg_value";
   666|             }
   667|         }
   668|         if($this->_reg_objects[$object][2]) {
   669|             $args = "array(".implode(',', (array)$arg_list)."), \$this";
   670|         } else {
   671|             $args = implode(',', array_values($attrs));
   672|             if (empty($args)) {
   673|                 $args = 'null';
   674|             }
   675|         }
   676|         $prefix = '';
   677|         $postfix = '';
   678|         $newline = '';
   679|         if(!is_object($this->_reg_objects[$object][0])) {
   680|             $this->_trigger_fatal_error("registered '$object' is not an object" , $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
   681|         } elseif(!empty($this->_reg_objects[$object][1]) && !in_array($obj_comp, $this->_reg_objects[$object][1])) {
   682|             $this->_trigger_fatal_error("'$obj_comp' is not a registered component of object '$object'", $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
   683|         } elseif(method_exists($this->_reg_objects[$object][0], $obj_comp)) {
   684|             if(in_array($obj_comp, $this->_reg_objects[$object][3])) {
   685|                 if ($start_tag) {
   686|                     $prefix = "\$this->_tag_stack[] = array('$obj_comp', $args); ";
   687|                     $prefix .= "\$_block_repeat=true; \$this->_reg_objects['$object'][0]->$obj_comp(\$this->_tag_stack[count(\$this->_tag_stack)-1][1], null, \$this, \$_block_repeat); ";
   688|                     $prefix .= "while (\$_block_repeat) { ob_start();";
   689|                     $return = null;
   690|                     $postfix = '';
   691|                 } else {
   692|                     $prefix = "\$_obj_block_content = ob_get_contents(); ob_end_clean(); \$_block_repeat=false;";
   693|                     $return = "\$this->_reg_objects['$object'][0]->$obj_comp(\$this->_tag_stack[count(\$this->_tag_stack)-1][1], \$_obj_block_content, \$this, \$_block_repeat)";
   694|                     $postfix = "} array_pop(\$this->_tag_stack);";
   695|                 }
   696|             } else {
   697|                 $return = "\$this->_reg_objects['$object'][0]->$obj_comp($args)";
   698|             }
   699|         } else {
   700|             $return = "\$this->_reg_objects['$object'][0]->$obj_comp";
   701|         }
   702|         if($return != null) {
   703|             if($tag_modifier != '') {
   704|                 $this->_parse_modifiers($return, $tag_modifier);
   705|             }
   706|             if(!empty($_assign_var)) {
   707|                 $output = "\$this->assign('" . $this->_dequote($_assign_var) ."',  $return);";
   708|             } else {
   709|                 $output = 'echo ' . $return . ';';
   710|                 $newline = $this->_additional_newline;
   711|             }
   712|         } else {
   713|             $output = '';
   714|         }
   715|         return '<?php ' . $prefix . $output . $postfix . "?>" . $newline;
   716|     }
   717|     /**
   718|      * Compile {insert ...} tag
   719|      *
   720|      * @param string $tag_args
   721|      * @return string
   722|      */
   723|     function _compile_insert_tag($tag_args)
   724|     {
   725|         $attrs = $this->_parse_attrs($tag_args);
   726|         $name = $this->_dequote($attrs['name']);
   727|         if (empty($name)) {
   728|             return $this->_syntax_error("missing insert name", E_USER_ERROR, __FILE__, __LINE__);
   729|         }
   730|         if (!preg_match('~^\w+$~', $name)) {
   731|             return $this->_syntax_error("'insert: 'name' must be an insert function name", E_USER_ERROR, __FILE__, __LINE__);
   732|         }
   733|         if (!empty($attrs['script'])) {
   734|             $delayed_loading = true;
   735|         } else {
   736|             $delayed_loading = false;
   737|         }
   738|         foreach ($attrs as $arg_name => $arg_value) {
   739|             if (is_bool($arg_value))
   740|                 $arg_value = $arg_value ? 'true' : 'false';
   741|             $arg_list[] = "'$arg_name' => $arg_value";
   742|         }
   743|         $this->_add_plugin('insert', $name, $delayed_loading);
   744|         $_params = "array('args' => array(".implode(', ', (array)$arg_list)."))";
   745|         return "<?php require_once(SMARTY_CORE_DIR . 'core.run_insert_handler.php');\necho smarty_core_run_insert_handler($_params, \$this); ?>" . $this->_additional_newline;
   746|     }
   747|     /**
   748|      * Compile {include ...} tag
   749|      *
   750|      * @param string $tag_args
   751|      * @return string
   752|      */
   753|     function _compile_include_tag($tag_args)
   754|     {
   755|         $attrs = $this->_parse_attrs($tag_args);
   756|         $arg_list = array();
   757|         if (empty($attrs['file'])) {
   758|             $this->_syntax_error("missing 'file' attribute in include tag", E_USER_ERROR, __FILE__, __LINE__);
   759|         }
   760|         foreach ($attrs as $arg_name => $arg_value) {
   761|             if ($arg_name == 'file') {
   762|                 $include_file = $arg_value;
   763|                 continue;
   764|             } else if ($arg_name == 'assign') {
   765|                 $assign_var = $arg_value;
   766|                 continue;
   767|             }
   768|             if (is_bool($arg_value))
   769|                 $arg_value = $arg_value ? 'true' : 'false';
   770|             $arg_list[] = "'$arg_name' => $arg_value";
   771|         }
   772|         $output = '<?php ';
   773|         if (isset($assign_var)) {
   774|             $output .= "ob_start();\n";
   775|         }
   776|         $output .=
   777|             "\$_smarty_tpl_vars = \$this->_tpl_vars;\n";
   778|         $_params = "array('smarty_include_tpl_file' => " . $include_file . ", 'smarty_include_vars' => array(".implode(',', (array)$arg_list)."))";
   779|         $output .= "\$this->_smarty_include($_params);\n" .
   780|         "\$this->_tpl_vars = \$_smarty_tpl_vars;\n" .
   781|         "unset(\$_smarty_tpl_vars);\n";
   782|         if (isset($assign_var)) {
   783|             $output .= "\$this->assign(" . $assign_var . ", ob_get_contents()); ob_end_clean();\n";
   784|         }
   785|         $output .= ' ?>';
   786|         return $output;
   787|     }
   788|     /**
   789|      * Compile {include ...} tag
   790|      *
   791|      * @param string $tag_args
   792|      * @return string
   793|      */
   794|     function _compile_include_php_tag($tag_args)
   795|     {
   796|         $attrs = $this->_parse_attrs($tag_args);
   797|         if (empty($attrs['file'])) {
   798|             $this->_syntax_error("missing 'file' attribute in include_php tag", E_USER_ERROR, __FILE__, __LINE__);
   799|         }
   800|         $assign_var = (empty($attrs['assign'])) ? '' : $this->_dequote($attrs['assign']);
   801|         $once_var = (empty($attrs['once']) || $attrs['once']=='false') ? 'false' : 'true';
   802|         $arg_list = array();
   803|         foreach($attrs as $arg_name => $arg_value) {
   804|             if($arg_name != 'file' AND $arg_name != 'once' AND $arg_name != 'assign') {
   805|                 if(is_bool($arg_value))
   806|                     $arg_value = $arg_value ? 'true' : 'false';
   807|                 $arg_list[] = "'$arg_name' => $arg_value";
   808|             }
   809|         }
   810|         $_params = "array('smarty_file' => " . $attrs['file'] . ", 'smarty_assign' => '$assign_var', 'smarty_once' => $once_var, 'smarty_include_vars' => array(".implode(',', $arg_list)."))";
   811|         return "<?php require_once(SMARTY_CORE_DIR . 'core.smarty_include_php.php');\nsmarty_core_smarty_include_php($_params, \$this); ?>" . $this->_additional_newline;
   812|     }
   813|     /**
   814|      * Compile {section ...} tag
   815|      *
   816|      * @param string $tag_args
   817|      * @return string
   818|      */
   819|     function _compile_section_start($tag_args)
   820|     {
   821|         $attrs = $this->_parse_attrs($tag_args);
   822|         $arg_list = array();
   823|         $output = '<?php ';
   824|         $section_name = $attrs['name'];
   825|         if (empty($section_name)) {
   826|             $this->_syntax_error("missing section name", E_USER_ERROR, __FILE__, __LINE__);
   827|         }
   828|         $output .= "unset(\$this->_sections[$section_name]);\n";
   829|         $section_props = "\$this->_sections[$section_name]";
   830|         foreach ($attrs as $attr_name => $attr_value) {
   831|             switch ($attr_name) {
   832|                 case 'loop':
   833|                     $output .= "{$section_props}['loop'] = is_array(\$_loop=$attr_value) ? count(\$_loop) : max(0, (int)\$_loop); unset(\$_loop);\n";
   834|                     break;
   835|                 case 'show':
   836|                     if (is_bool($attr_value))
   837|                         $show_attr_value = $attr_value ? 'true' : 'false';
   838|                     else
   839|                         $show_attr_value = "(bool)$attr_value";
   840|                     $output .= "{$section_props}['show'] = $show_attr_value;\n";
   841|                     break;
   842|                 case 'name':
   843|                     $output .= "{$section_props}['$attr_name'] = $attr_value;\n";
   844|                     break;
   845|                 case 'max':
   846|                 case 'start':
   847|                     $output .= "{$section_props}['$attr_name'] = (int)$attr_value;\n";
   848|                     break;
   849|                 case 'step':
   850|                     $output .= "{$section_props}['$attr_name'] = ((int)$attr_value) == 0 ? 1 : (int)$attr_value;\n";
   851|                     break;
   852|                 default:
   853|                     $this->_syntax_error("unknown section attribute - '$attr_name'", E_USER_ERROR, __FILE__, __LINE__);
   854|                     break;
   855|             }
   856|         }
   857|         if (!isset($attrs['show']))
   858|             $output .= "{$section_props}['show'] = true;\n";
   859|         if (!isset($attrs['loop']))
   860|             $output .= "{$section_props}['loop'] = 1;\n";
   861|         if (!isset($attrs['max']))
   862|             $output .= "{$section_props}['max'] = {$section_props}['loop'];\n";
   863|         else
   864|             $output .= "if ({$section_props}['max'] < 0)\n" .
   865|                        "    {$section_props}['max'] = {$section_props}['loop'];\n";
   866|         if (!isset($attrs['step']))
   867|             $output .= "{$section_props}['step'] = 1;\n";
   868|         if (!isset($attrs['start']))
   869|             $output .= "{$section_props}['start'] = {$section_props}['step'] > 0 ? 0 : {$section_props}['loop']-1;\n";
   870|         else {
   871|             $output .= "if ({$section_props}['start'] < 0)\n" .
   872|                        "    {$section_props}['start'] = max({$section_props}['step'] > 0 ? 0 : -1, {$section_props}['loop'] + {$section_props}['start']);\n" .
   873|                        "else\n" .
   874|                        "    {$section_props}['start'] = min({$section_props}['start'], {$section_props}['step'] > 0 ? {$section_props}['loop'] : {$section_props}['loop']-1);\n";
   875|         }
   876|         $output .= "if ({$section_props}['show']) {\n";
   877|         if (!isset($attrs['start']) && !isset($attrs['step']) && !isset($attrs['max'])) {
   878|             $output .= "    {$section_props}['total'] = {$section_props}['loop'];\n";
   879|         } else {
   880|             $output .= "    {$section_props}['total'] = min(ceil(({$section_props}['step'] > 0 ? {$section_props}['loop'] - {$section_props}['start'] : {$section_props}['start']+1)/abs({$section_props}['step'])), {$section_props}['max']);\n";
   881|         }
   882|         $output .= "    if ({$section_props}['total'] == 0)\n" .
   883|                    "        {$section_props}['show'] = false;\n" .
   884|                    "} else\n" .
   885|                    "    {$section_props}['total'] = 0;\n";
   886|         $output .= "if ({$section_props}['show']):\n";
   887|         $output .= "
   888|             for ({$section_props}['index'] = {$section_props}['start'], {$section_props}['iteration'] = 1;
   889|                  {$section_props}['iteration'] <= {$section_props}['total'];
   890|                  {$section_props}['index'] += {$section_props}['step'], {$section_props}['iteration']++):\n";
   891|         $output .= "{$section_props}['rownum'] = {$section_props}['iteration'];\n";
   892|         $output .= "{$section_props}['index_prev'] = {$section_props}['index'] - {$section_props}['step'];\n";
   893|         $output .= "{$section_props}['index_next'] = {$section_props}['index'] + {$section_props}['step'];\n";
   894|         $output .= "{$section_props}['first']      = ({$section_props}['iteration'] == 1);\n";
   895|         $output .= "{$section_props}['last']       = ({$section_props}['iteration'] == {$section_props}['total']);\n";
   896|         $output .= "?>";
   897|         return $output;
   898|     }
   899|     /**
   900|      * Compile {foreach ...} tag.
   901|      *
   902|      * @param string $tag_args
   903|      * @return string
   904|      */
   905|     function _compile_foreach_start($tag_args)
   906|     {
   907|         $attrs = $this->_parse_attrs($tag_args);
   908|         $arg_list = array();
   909|         if (empty($attrs['from'])) {
   910|             return $this->_syntax_error("foreach: missing 'from' attribute", E_USER_ERROR, __FILE__, __LINE__);
   911|         }
   912|         $from = $attrs['from'];
   913|         if (empty($attrs['item'])) {
   914|             return $this->_syntax_error("foreach: missing 'item' attribute", E_USER_ERROR, __FILE__, __LINE__);
   915|         }
   916|         $item = $this->_dequote($attrs['item']);
   917|         if (!preg_match('~^\w+$~', $item)) {
   918|             return $this->_syntax_error("'foreach: 'item' must be a variable name (literal string)", E_USER_ERROR, __FILE__, __LINE__);
   919|         }
   920|         if (isset($attrs['key'])) {
   921|             $key  = $this->_dequote($attrs['key']);
   922|             if (!preg_match('~^\w+$~', $key)) {
   923|                 return $this->_syntax_error("foreach: 'key' must to be a variable name (literal string)", E_USER_ERROR, __FILE__, __LINE__);
   924|             }
   925|             $key_part = "\$this->_tpl_vars['$key'] => ";
   926|         } else {
   927|             $key = null;
   928|             $key_part = '';
   929|         }
   930|         if (isset($attrs['name'])) {
   931|             $name = $attrs['name'];
   932|         } else {
   933|             $name = null;
   934|         }
   935|         $output = '<?php ';
   936|         $output .= "\$_from = $from; if (!is_array(\$_from) && !is_object(\$_from)) { settype(\$_from, 'array'); }";
   937|         if (isset($name)) {
   938|             $foreach_props = "\$this->_foreach[$name]";
   939|             $output .= "{$foreach_props} = array('total' => count(\$_from), 'iteration' => 0);\n";
   940|             $output .= "if ({$foreach_props}['total'] > 0):\n";
   941|             $output .= "    foreach (\$_from as $key_part\$this->_tpl_vars['$item']):\n";
   942|             $output .= "        {$foreach_props}['iteration']++;\n";
   943|         } else {
   944|             $output .= "if (count(\$_from)):\n";
   945|             $output .= "    foreach (\$_from as $key_part\$this->_tpl_vars['$item']):\n";
   946|         }
   947|         $output .= '?>';
   948|         return $output;
   949|     }
   950|     /**
   951|      * Compile {capture} .. {/capture} tags
   952|      *
   953|      * @param boolean $start true if this is the {capture} tag
   954|      * @param string $tag_args
   955|      * @return string
   956|      */
   957|     function _compile_capture_tag($start, $tag_args = '')
   958|     {
   959|         $attrs = $this->_parse_attrs($tag_args);
   960|         if ($start) {
   961|             if (isset($attrs['name']))
   962|                 $buffer = $attrs['name'];
   963|             else
   964|                 $buffer = "'default'";
   965|             if (isset($attrs['assign']))
   966|                 $assign = $attrs['assign'];
   967|             else
   968|                 $assign = null;
   969|             $output = "<?php ob_start(); ?>";
   970|             $this->_capture_stack[] = array($buffer, $assign);
   971|         } else {
   972|             list($buffer, $assign) = array_pop($this->_capture_stack);
   973|             $output = "<?php \$this->_smarty_vars['capture'][$buffer] = ob_get_contents(); ";
   974|             if (isset($assign)) {
   975|                 $output .= " \$this->assign($assign, ob_get_contents());";
   976|             }
   977|             $output .= "ob_end_clean(); ?>";
   978|         }
   979|         return $output;
   980|     }
   981|     /**
   982|      * Compile {if ...} tag
   983|      *
   984|      * @param string $tag_args
   985|      * @param boolean $elseif if true, uses elseif instead of if
   986|      * @return string
   987|      */
   988|     function _compile_if_tag($tag_args, $elseif = false)
   989|     {
   990|         /* Tokenize args for 'if' tag. */
   991|         preg_match_all('~(?>
   992|                 ' . $this->_obj_call_regexp . '(?:' . $this->_mod_regexp . '*)? | # valid object call
   993|                 ' . $this->_var_regexp . '(?:' . $this->_mod_regexp . '*)?    | # var or quoted string
   994|                 \-?0[xX][0-9a-fA-F]+|\-?\d+(?:\.\d+)?|\.\d+|!==|===|==|!=|<>|<<|>>|<=|>=|\&\&|\|\||\(|\)|,|\!|\^|=|\&|\~|<|>|\||\%|\+|\-|\/|\*|\@    | # valid non-word token
   995|                 \b\w+\b                                                        | # valid word token
   996|                 \S+                                                           # anything else
   997|                 )~x', $tag_args, $match);
   998|         $tokens = $match[0];
   999|         if(empty($tokens)) {
  1000|             $_error_msg = $elseif ? "'elseif'" : "'if'";
  1001|             $_error_msg .= ' statement requires arguments';
  1002|             $this->_syntax_error($_error_msg, E_USER_ERROR, __FILE__, __LINE__);
  1003|         }
  1004|         $token_count = array_count_values($tokens);
  1005|         if(isset($token_count['(']) && $token_count['('] != $token_count[')']) {
  1006|             $this->_syntax_error("unbalanced parenthesis in if statement", E_USER_ERROR, __FILE__, __LINE__);
  1007|         }
  1008|         $is_arg_stack = array();
  1009|         for ($i = 0; $i < count($tokens); $i++) {
  1010|             $token = &$tokens[$i];
  1011|             switch (strtolower($token)) {
  1012|                 case '!':
  1013|                 case '%':
  1014|                 case '!==':
  1015|                 case '==':
  1016|                 case '===':
  1017|                 case '>':
  1018|                 case '<':
  1019|                 case '!=':
  1020|                 case '<>':
  1021|                 case '<<':
  1022|                 case '>>':
  1023|                 case '<=':
  1024|                 case '>=':
  1025|                 case '&&':
  1026|                 case '||':
  1027|                 case '|':
  1028|                 case '^':
  1029|                 case '&':
  1030|                 case '~':
  1031|                 case ')':
  1032|                 case ',':
  1033|                 case '+':
  1034|                 case '-':
  1035|                 case '*':
  1036|                 case '/':
  1037|                 case '@':
  1038|                     break;
  1039|                 case 'eq':
  1040|                     $token = '==';
  1041|                     break;
  1042|                 case 'ne':
  1043|                 case 'neq':
  1044|                     $token = '!=';
  1045|                     break;
  1046|                 case 'lt':
  1047|                     $token = '<';
  1048|                     break;
  1049|                 case 'le':
  1050|                 case 'lte':
  1051|                     $token = '<=';
  1052|                     break;
  1053|                 case 'gt':
  1054|                     $token = '>';
  1055|                     break;
  1056|                 case 'ge':
  1057|                 case 'gte':
  1058|                     $token = '>=';
  1059|                     break;
  1060|                 case 'and':
  1061|                     $token = '&&';
  1062|                     break;
  1063|                 case 'or':
  1064|                     $token = '||';
  1065|                     break;
  1066|                 case 'not':
  1067|                     $token = '!';
  1068|                     break;
  1069|                 case 'mod':
  1070|                     $token = '%';
  1071|                     break;
  1072|                 case '(':
  1073|                     array_push($is_arg_stack, $i);
  1074|                     break;
  1075|                 case 'is':
  1076|                     /* If last token was a ')', we operate on the parenthesized
  1077|                        expression. The start of the expression is on the stack.
  1078|                        Otherwise, we operate on the last encountered token. */
  1079|                     if ($tokens[$i-1] == ')')
  1080|                         $is_arg_start = array_pop($is_arg_stack);
  1081|                     else
  1082|                         $is_arg_start = $i-1;
  1083|                     /* Construct the argument for 'is' expression, so it knows
  1084|                        what to operate on. */
  1085|                     $is_arg = implode(' ', array_slice($tokens, $is_arg_start, $i - $is_arg_start));
  1086|                     /* Pass all tokens from next one until the end to the
  1087|                        'is' expression parsing function. The function will
  1088|                        return modified tokens, where the first one is the result
  1089|                        of the 'is' expression and the rest are the tokens it
  1090|                        didn't touch. */
  1091|                     $new_tokens = $this->_parse_is_expr($is_arg, array_slice($tokens, $i+1));
  1092|                     /* Replace the old tokens with the new ones. */
  1093|                     array_splice($tokens, $is_arg_start, count($tokens), $new_tokens);
  1094|                     /* Adjust argument start so that it won't change from the
  1095|                        current position for the next iteration. */
  1096|                     $i = $is_arg_start;
  1097|                     break;
  1098|                 default:
  1099|                     if(preg_match('~^' . $this->_func_regexp . '$~', $token) ) {
  1100|                             if($this->security &&
  1101|                                !in_array($token, $this->security_settings['IF_FUNCS'])) {
  1102|                                 $this->_syntax_error("(secure mode) '$token' not allowed in if statement", E_USER_ERROR, __FILE__, __LINE__);
  1103|                             }
  1104|                     } elseif(preg_match('~^' . $this->_var_regexp . '$~', $token) && (strpos('+-*/^%&|', substr($token, -1)) === false) && isset($tokens[$i+1]) && $tokens[$i+1] == '(') {
  1105|                         $this->_syntax_error("variable function call '$token' not allowed in if statement", E_USER_ERROR, __FILE__, __LINE__);
  1106|                     } elseif(preg_match('~^' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '(?:' . $this->_mod_regexp . '*)$~', $token)) {
  1107|                         $token = $this->_parse_var_props($token);
  1108|                     } elseif(is_numeric($token)) {
  1109|                     } else {
  1110|                         $this->_syntax_error("unidentified token '$token'", E_USER_ERROR, __FILE__, __LINE__);
  1111|                     }
  1112|                     break;
  1113|             }
  1114|         }
  1115|         if ($elseif)
  1116|             return '<?php elseif ('.implode(' ', $tokens).'): ?>';
  1117|         else
  1118|             return '<?php if ('.implode(' ', $tokens).'): ?>';
  1119|     }
  1120|     function _compile_arg_list($type, $name, $attrs, &$cache_code) {
  1121|         $arg_list = array();
  1122|         if (isset($type) && isset($name)
  1123|             && isset($this->_plugins[$type])
  1124|             && isset($this->_plugins[$type][$name])
  1125|             && empty($this->_plugins[$type][$name][4])
  1126|             && is_array($this->_plugins[$type][$name][5])
  1127|             ) {
  1128|             /* we have a list of parameters that should be cached */
  1129|             $_cache_attrs = $this->_plugins[$type][$name][5];
  1130|             $_count = $this->_cache_attrs_count++;
  1131|             $cache_code = "\$_cache_attrs =& \$this->_smarty_cache_attrs('$this->_cache_serial','$_count');";
  1132|         } else {
  1133|             /* no parameters are cached */
  1134|             $_cache_attrs = null;
  1135|         }
  1136|         foreach ($attrs as $arg_name => $arg_value) {
  1137|             if (is_bool($arg_value))
  1138|                 $arg_value = $arg_value ? 'true' : 'false';
  1139|             if (is_null($arg_value))
  1140|                 $arg_value = 'null';
  1141|             if ($_cache_attrs && in_array($arg_name, $_cache_attrs)) {
  1142|                 $arg_list[] = "'$arg_name' => (\$this->_cache_including) ? \$_cache_attrs['$arg_name'] : (\$_cache_attrs['$arg_name']=$arg_value)";
  1143|             } else {
  1144|                 $arg_list[] = "'$arg_name' => $arg_value";
  1145|             }
  1146|         }
  1147|         return $arg_list;
  1148|     }
  1149|     /**
  1150|      * Parse is expression
  1151|      *
  1152|      * @param string $is_arg
  1153|      * @param array $tokens
  1154|      * @return array
  1155|      */
  1156|     function _parse_is_expr($is_arg, $tokens)
  1157|     {
  1158|         $expr_end = 0;
  1159|         $negate_expr = false;
  1160|         if (($first_token = array_shift($tokens)) == 'not') {
  1161|             $negate_expr = true;
  1162|             $expr_type = array_shift($tokens);
  1163|         } else
  1164|             $expr_type = $first_token;
  1165|         switch ($expr_type) {
  1166|             case 'even':
  1167|                 if (isset($tokens[$expr_end]) && $tokens[$expr_end] == 'by') {
  1168|                     $expr_end++;
  1169|                     $expr_arg = $tokens[$expr_end++];
  1170|                     $expr = "!(1 & ($is_arg / " . $this->_parse_var_props($expr_arg) . "))";
  1171|                 } else
  1172|                     $expr = "!(1 & $is_arg)";
  1173|                 break;
  1174|             case 'odd':
  1175|                 if (isset($tokens[$expr_end]) && $tokens[$expr_end] == 'by') {
  1176|                     $expr_end++;
  1177|                     $expr_arg = $tokens[$expr_end++];
  1178|                     $expr = "(1 & ($is_arg / " . $this->_parse_var_props($expr_arg) . "))";
  1179|                 } else
  1180|                     $expr = "(1 & $is_arg)";
  1181|                 break;
  1182|             case 'div':
  1183|                 if (@$tokens[$expr_end] == 'by') {
  1184|                     $expr_end++;
  1185|                     $expr_arg = $tokens[$expr_end++];
  1186|                     $expr = "!($is_arg % " . $this->_parse_var_props($expr_arg) . ")";
  1187|                 } else {
  1188|                     $this->_syntax_error("expecting 'by' after 'div'", E_USER_ERROR, __FILE__, __LINE__);
  1189|                 }
  1190|                 break;
  1191|             default:
  1192|                 $this->_syntax_error("unknown 'is' expression - '$expr_type'", E_USER_ERROR, __FILE__, __LINE__);
  1193|                 break;
  1194|         }
  1195|         if ($negate_expr) {
  1196|             $expr = "!($expr)";
  1197|         }
  1198|         array_splice($tokens, 0, $expr_end, $expr);
  1199|         return $tokens;
  1200|     }
  1201|     /**
  1202|      * Parse attribute string
  1203|      *
  1204|      * @param string $tag_args
  1205|      * @return array
  1206|      */
  1207|     function _parse_attrs($tag_args)
  1208|     {
  1209|         /* Tokenize tag attributes. */
  1210|         preg_match_all('~(?:' . $this->_obj_call_regexp . '|' . $this->_qstr_regexp . ' | (?>[^"\'=\s]+)
  1211|                          )+ |
  1212|                          [=]
  1213|                         ~x', $tag_args, $match);
  1214|         $tokens       = $match[0];
  1215|         $attrs = array();
  1216|         /* Parse state:
  1217|             0 - expecting attribute name
  1218|             1 - expecting '='
  1219|             2 - expecting attribute value (not '=') */
  1220|         $state = 0;
  1221|         foreach ($tokens as $token) {
  1222|             switch ($state) {
  1223|                 case 0:
  1224|                     /* If the token is a valid identifier, we set attribute name
  1225|                        and go to state 1. */
  1226|                     if (preg_match('~^\w+$~', $token)) {
  1227|                         $attr_name = $token;
  1228|                         $state = 1;
  1229|                     } else
  1230|                         $this->_syntax_error("invalid attribute name: '$token'", E_USER_ERROR, __FILE__, __LINE__);
  1231|                     break;
  1232|                 case 1:
  1233|                     /* If the token is '=', then we go to state 2. */
  1234|                     if ($token == '=') {
  1235|                         $state = 2;
  1236|                     } else
  1237|                         $this->_syntax_error("expecting '=' after attribute name '$last_token'", E_USER_ERROR, __FILE__, __LINE__);
  1238|                     break;
  1239|                 case 2:
  1240|                     /* If token is not '=', we set the attribute value and go to
  1241|                        state 0. */
  1242|                     if ($token != '=') {
  1243|                         /* We booleanize the token if it's a non-quoted possible
  1244|                            boolean value. */
  1245|                         if (preg_match('~^(on|yes|true)$~', $token)) {
  1246|                             $token = 'true';
  1247|                         } else if (preg_match('~^(off|no|false)$~', $token)) {
  1248|                             $token = 'false';
  1249|                         } else if ($token == 'null') {
  1250|                             $token = 'null';
  1251|                         } else if (preg_match('~^' . $this->_num_const_regexp . '|0[xX][0-9a-fA-F]+$~', $token)) {
  1252|                             /* treat integer literally */
  1253|                         } else if (!preg_match('~^' . $this->_obj_call_regexp . '|' . $this->_var_regexp . '(?:' . $this->_mod_regexp . ')*$~', $token)) {
  1254|                             /* treat as a string, double-quote it escaping quotes */
  1255|                             $token = '"'.addslashes($token).'"';
  1256|                         }
  1257|                         $attrs[$attr_name] = $token;
  1258|                         $state = 0;
  1259|                     } else
  1260|                         $this->_syntax_error("'=' cannot be an attribute value", E_USER_ERROR, __FILE__, __LINE__);
  1261|                     break;
  1262|             }
  1263|             $last_token = $token;
  1264|         }
  1265|         if($state != 0) {
  1266|             if($state == 1) {
  1267|                 $this->_syntax_error("expecting '=' after attribute name '$last_token'", E_USER_ERROR, __FILE__, __LINE__);
  1268|             } else {
  1269|                 $this->_syntax_error("missing attribute value", E_USER_ERROR, __FILE__, __LINE__);
  1270|             }
  1271|         }
  1272|         $this->_parse_vars_props($attrs);
  1273|         return $attrs;
  1274|     }
  1275|     /**
  1276|      * compile multiple variables and section properties tokens into
  1277|      * PHP code
  1278|      *
  1279|      * @param array $tokens
  1280|      */
  1281|     function _parse_vars_props(&$tokens)
  1282|     {
  1283|         foreach($tokens as $key => $val) {
  1284|             $tokens[$key] = $this->_parse_var_props($val);
  1285|         }
  1286|     }
  1287|     /**
  1288|      * compile single variable and section properties token into
  1289|      * PHP code
  1290|      *
  1291|      * @param string $val
  1292|      * @param string $tag_attrs
  1293|      * @return string
  1294|      */
  1295|     function _parse_var_props($val)
  1296|     {
  1297|         $val = trim($val);
  1298|         if(preg_match('~^(' . $this->_obj_call_regexp . '|' . $this->_dvar_regexp . ')(' . $this->_mod_regexp . '*)$~', $val, $match)) {
  1299|             $return = $this->_parse_var($match[1]);
  1300|             $modifiers = $match[2];
  1301|             if (!empty($this->default_modifiers) && !preg_match('~(^|\|)smarty:nodefaults($|\|)~',$modifiers)) {
  1302|                 $_default_mod_string = implode('|',(array)$this->default_modifiers);
  1303|                 $modifiers = empty($modifiers) ? $_default_mod_string : $_default_mod_string . '|' . $modifiers;
  1304|             }
  1305|             $this->_parse_modifiers($return, $modifiers);
  1306|             return $return;
  1307|         } elseif (preg_match('~^' . $this->_db_qstr_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
  1308|                 preg_match('~^(' . $this->_db_qstr_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
  1309|                 $return = $this->_expand_quoted_text($match[1]);
  1310|                 if($match[2] != '') {
  1311|                     $this->_parse_modifiers($return, $match[2]);
  1312|                 }
  1313|                 return $return;
  1314|             }
  1315|         elseif(preg_match('~^' . $this->_num_const_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
  1316|                 preg_match('~^(' . $this->_num_const_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
  1317|                 if($match[2] != '') {
  1318|                     $this->_parse_modifiers($match[1], $match[2]);
  1319|                     return $match[1];
  1320|                 }
  1321|             }
  1322|         elseif(preg_match('~^' . $this->_si_qstr_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
  1323|                 preg_match('~^(' . $this->_si_qstr_regexp . ')('. $this->_mod_regexp . '*)$~', $val, $match);
  1324|                 if($match[2] != '') {
  1325|                     $this->_parse_modifiers($match[1], $match[2]);
  1326|                     return $match[1];
  1327|                 }
  1328|             }
  1329|         elseif(preg_match('~^' . $this->_cvar_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
  1330|                 return $this->_parse_conf_var($val);
  1331|             }
  1332|         elseif(preg_match('~^' . $this->_svar_regexp . '(?:' . $this->_mod_regexp . '*)$~', $val)) {
  1333|                 return $this->_parse_section_prop($val);
  1334|             }
  1335|         elseif(!in_array($val, $this->_permitted_tokens) && !is_numeric($val)) {
  1336|             return $this->_expand_quoted_text('"' . strtr($val, array('\\' => '\\\\', '"' => '\\"')) .'"');
  1337|         }
  1338|         return $val;
  1339|     }
  1340|     /**
  1341|      * expand quoted text with embedded variables
  1342|      *
  1343|      * @param string $var_expr
  1344|      * @return string
  1345|      */
  1346|     function _expand_quoted_text($var_expr)
  1347|     {
  1348|         if(preg_match_all('~(?:\`(?<!\\\\)\$' . $this->_dvar_guts_regexp . '(?:' . $this->_obj_ext_regexp . ')*\`)|(?:(?<!\\\\)\$\w+(\[[a-zA-Z0-9]+\])*)~', $var_expr, $_match)) {
  1349|             $_match = $_match[0];
  1350|             $_replace = array();
  1351|             foreach($_match as $_var) {
  1352|                 $_replace[$_var] = '".(' . $this->_parse_var(str_replace('`','',$_var)) . ')."';
  1353|             }
  1354|             $var_expr = strtr($var_expr, $_replace);
  1355|             $_return = preg_replace('~\.""|(?<!\\\\)""\.~', '', $var_expr);
  1356|         } else {
  1357|             $_return = $var_expr;
  1358|         }
  1359|         $_return = preg_replace('~^"([\s\w]+)"$~',"'\\1'",$_return);
  1360|         return $_return;
  1361|     }
  1362|     /**
  1363|      * parse variable expression into PHP code
  1364|      *
  1365|      * @param string $var_expr
  1366|      * @param string $output
  1367|      * @return string
  1368|      */
  1369|     function _parse_var($var_expr)
  1370|     {
  1371|         $_has_math = false;
  1372|         $_math_vars = preg_split('~('.$this->_dvar_math_regexp.'|'.$this->_qstr_regexp.')~', $var_expr, -1, PREG_SPLIT_DELIM_CAPTURE);
  1373|         if(count($_math_vars) > 1) {
  1374|             $_first_var = "";
  1375|             $_complete_var = "";
  1376|             $_output = "";
  1377|             foreach($_math_vars as $_k => $_math_var) {
  1378|                 $_math_var = $_math_vars[$_k];
  1379|                 if(!empty($_math_var) || is_numeric($_math_var)) {
  1380|                     if(preg_match('~^' . $this->_dvar_math_regexp . '$~', $_math_var)) {
  1381|                         $_has_math = true;
  1382|                         if(!empty($_complete_var) || is_numeric($_complete_var)) {
  1383|                             $_output .= $this->_parse_var($_complete_var);
  1384|                         }
  1385|                         $_output .= $_math_var;
  1386|                         if(empty($_first_var))
  1387|                             $_first_var = $_complete_var;
  1388|                         $_complete_var = "";
  1389|                     } else {
  1390|                         $_complete_var .= $_math_var;
  1391|                     }
  1392|                 }
  1393|             }
  1394|             if($_has_math) {
  1395|                 if(!empty($_complete_var) || is_numeric($_complete_var))
  1396|                     $_output .= $this->_parse_var($_complete_var);
  1397|                 $var_expr = $_complete_var;
  1398|             }
  1399|         }
  1400|         if(is_numeric(substr($var_expr, 0, 1)))
  1401|             $_var_ref = $var_expr;
  1402|         else
  1403|             $_var_ref = substr($var_expr, 1);
  1404|         if(!$_has_math) {
  1405|             preg_match_all('~(?:^\w+)|' . $this->_obj_params_regexp . '|(?:' . $this->_var_bracket_regexp . ')|->\$?\w+|\.\$?\w+|\S+~', $_var_ref, $match);
  1406|             $_indexes = $match[0];
  1407|             $_var_name = array_shift($_indexes);
  1408|             /* Handle $smarty.* variable references as a special case. */
  1409|             if ($_var_name == 'smarty') {
  1410|                 /*
  1411|                  * If the reference could be compiled, use the compiled output;
  1412|                  * otherwise, fall back on the $smarty variable generated at
  1413|                  * run-time.
  1414|                  */
  1415|                 if (($smarty_ref = $this->_compile_smarty_ref($_indexes)) !== null) {
  1416|                     $_output = $smarty_ref;
  1417|                 } else {
  1418|                     $_var_name = substr(array_shift($_indexes), 1);
  1419|                     $_output = "\$this->_smarty_vars['$_var_name']";
  1420|                 }
  1421|             } elseif(is_numeric($_var_name) && is_numeric(substr($var_expr, 0, 1))) {
  1422|                 if(count($_indexes) > 0)
  1423|                 {
  1424|                     $_var_name .= implode("", $_indexes);
  1425|                     $_indexes = array();
  1426|                 }
  1427|                 $_output = $_var_name;
  1428|             } else {
  1429|                 $_output = "\$this->_tpl_vars['$_var_name']";
  1430|             }
  1431|             foreach ($_indexes as $_index) {
  1432|                 if (substr($_index, 0, 1) == '[') {
  1433|                     $_index = substr($_index, 1, -1);
  1434|                     if (is_numeric($_index)) {
  1435|                         $_output .= "[$_index]";
  1436|                     } elseif (substr($_index, 0, 1) == '$') {
  1437|                         if (strpos($_index, '.') !== false) {
  1438|                             $_output .= '[' . $this->_parse_var($_index) . ']';
  1439|                         } else {
  1440|                             $_output .= "[\$this->_tpl_vars['" . substr($_index, 1) . "']]";
  1441|                         }
  1442|                     } else {
  1443|                         $_var_parts = explode('.', $_index);
  1444|                         $_var_section = $_var_parts[0];
  1445|                         $_var_section_prop = isset($_var_parts[1]) ? $_var_parts[1] : 'index';
  1446|                         $_output .= "[\$this->_sections['$_var_section']['$_var_section_prop']]";
  1447|                     }
  1448|                 } else if (substr($_index, 0, 1) == '.') {
  1449|                     if (substr($_index, 1, 1) == '$')
  1450|                         $_output .= "[\$this->_tpl_vars['" . substr($_index, 2) . "']]";
  1451|                     else
  1452|                         $_output .= "['" . substr($_index, 1) . "']";
  1453|                 } else if (substr($_index,0,2) == '->') {
  1454|                     if(substr($_index,2,2) == '__') {
  1455|                         $this->_syntax_error('call to internal object members is not allowed', E_USER_ERROR, __FILE__, __LINE__);
  1456|                     } elseif($this->security && substr($_index, 2, 1) == '_') {
  1457|                         $this->_syntax_error('(secure) call to private object member is not allowed', E_USER_ERROR, __FILE__, __LINE__);
  1458|                     } elseif (substr($_index, 2, 1) == '$') {
  1459|                         if ($this->security) {
  1460|                             $this->_syntax_error('(secure) call to dynamic object member is not allowed', E_USER_ERROR, __FILE__, __LINE__);
  1461|                         } else {
  1462|                             $_output .= '->{(($_var=$this->_tpl_vars[\''.substr($_index,3).'\']) && substr($_var,0,2)!=\'__\') ? $_var : $this->trigger_error("cannot access property \\"$_var\\"")}';
  1463|                         }
  1464|                     } else {
  1465|                         $_output .= $_index;
  1466|                     }
  1467|                 } elseif (substr($_index, 0, 1) == '(') {
  1468|                     $_index = $this->_parse_parenth_args($_index);
  1469|                     $_output .= $_index;
  1470|                 } else {
  1471|                     $_output .= $_index;
  1472|                 }
  1473|             }
  1474|         }
  1475|         return $_output;
  1476|     }
  1477|     /**
  1478|      * parse arguments in function call parenthesis
  1479|      *
  1480|      * @param string $parenth_args
  1481|      * @return string
  1482|      */
  1483|     function _parse_parenth_args($parenth_args)
  1484|     {
  1485|         preg_match_all('~' . $this->_param_regexp . '~',$parenth_args, $match);
  1486|         $orig_vals = $match = $match[0];
  1487|         $this->_parse_vars_props($match);
  1488|         $replace = array();
  1489|         for ($i = 0, $count = count($match); $i < $count; $i++) {
  1490|             $replace[$orig_vals[$i]] = $match[$i];
  1491|         }
  1492|         return strtr($parenth_args, $replace);
  1493|     }
  1494|     /**
  1495|      * parse configuration variable expression into PHP code
  1496|      *
  1497|      * @param string $conf_var_expr
  1498|      */
  1499|     function _parse_conf_var($conf_var_expr)
  1500|     {
  1501|         $parts = explode('|', $conf_var_expr, 2);
  1502|         $var_ref = $parts[0];
  1503|         $modifiers = isset($parts[1]) ? $parts[1] : '';
  1504|         $var_name = substr($var_ref, 1, -1);
  1505|         $output = "\$this->_config[0]['vars']['$var_name']";
  1506|         $this->_parse_modifiers($output, $modifiers);
  1507|         return $output;
  1508|     }
  1509|     /**
  1510|      * parse section property expression into PHP code
  1511|      *
  1512|      * @param string $section_prop_expr
  1513|      * @return string
  1514|      */
  1515|     function _parse_section_prop($section_prop_expr)
  1516|     {
  1517|         $parts = explode('|', $section_prop_expr, 2);
  1518|         $var_ref = $parts[0];
  1519|         $modifiers = isset($parts[1]) ? $parts[1] : '';
  1520|         preg_match('!%(\w+)\.(\w+)%!', $var_ref, $match);
  1521|         $section_name = $match[1];
  1522|         $prop_name = $match[2];
  1523|         $output = "\$this->_sections['$section_name']['$prop_name']";
  1524|         $this->_parse_modifiers($output, $modifiers);
  1525|         return $output;
  1526|     }
  1527|     /**
  1528|      * parse modifier chain into PHP code
  1529|      *
  1530|      * sets $output to parsed modified chain
  1531|      * @param string $output
  1532|      * @param string $modifier_string
  1533|      */
  1534|     function _parse_modifiers(&$output, $modifier_string)
  1535|     {
  1536|         preg_match_all('~\|(@?\w+)((?>:(?:'. $this->_qstr_regexp . '|[^|]+))*)~', '|' . $modifier_string, $_match);
  1537|         list(, $_modifiers, $modifier_arg_strings) = $_match;
  1538|         for ($_i = 0, $_for_max = count($_modifiers); $_i < $_for_max; $_i++) {
  1539|             $_modifier_name = $_modifiers[$_i];
  1540|             if($_modifier_name == 'smarty') {
  1541|                 continue;
  1542|             }
  1543|             preg_match_all('~:(' . $this->_qstr_regexp . '|[^:]+)~', $modifier_arg_strings[$_i], $_match);
  1544|             $_modifier_args = $_match[1];
  1545|             if (substr($_modifier_name, 0, 1) == '@') {
  1546|                 $_map_array = false;
  1547|                 $_modifier_name = substr($_modifier_name, 1);
  1548|             } else {
  1549|                 $_map_array = true;
  1550|             }
  1551|             if (empty($this->_plugins['modifier'][$_modifier_name])
  1552|                 && !$this->_get_plugin_filepath('modifier', $_modifier_name)
  1553|                 && function_exists($_modifier_name)) {
  1554|                 if ($this->security && !in_array($_modifier_name, $this->security_settings['MODIFIER_FUNCS'])) {
  1555|                     $this->_trigger_fatal_error("[plugin] (secure mode) modifier '$_modifier_name' is not allowed" , $this->_current_file, $this->_current_line_no, __FILE__, __LINE__);
  1556|                 } else {
  1557|                     $this->_plugins['modifier'][$_modifier_name] = array($_modifier_name,  null, null, false);
  1558|                 }
  1559|             }
  1560|             $this->_add_plugin('modifier', $_modifier_name);
  1561|             $this->_parse_vars_props($_modifier_args);
  1562|             if($_modifier_name == 'default') {
  1563|                 if(substr($output, 0, 1) == '$') {
  1564|                     $output = '@' . $output;
  1565|                 }
  1566|                 if(isset($_modifier_args[0]) && substr($_modifier_args[0], 0, 1) == '$') {
  1567|                     $_modifier_args[0] = '@' . $_modifier_args[0];
  1568|                 }
  1569|             }
  1570|             if (count($_modifier_args) > 0)
  1571|                 $_modifier_args = ', '.implode(', ', $_modifier_args);
  1572|             else
  1573|                 $_modifier_args = '';
  1574|             if ($_map_array) {
  1575|                 $output = "((is_array(\$_tmp=$output)) ? \$this->_run_mod_handler('$_modifier_name', true, \$_tmp$_modifier_args) : " . $this->_compile_plugin_call('modifier', $_modifier_name) . "(\$_tmp$_modifier_args))";
  1576|             } else {
  1577|                 $output = $this->_compile_plugin_call('modifier', $_modifier_name)."($output$_modifier_args)";
  1578|             }
  1579|         }
  1580|     }
  1581|     /**
  1582|      * add plugin
  1583|      *
  1584|      * @param string $type
  1585|      * @param string $name
  1586|      * @param boolean? $delayed_loading
  1587|      */
  1588|     function _add_plugin($type, $name, $delayed_loading = null)
  1589|     {
  1590|         if (!isset($this->_plugin_info[$type])) {
  1591|             $this->_plugin_info[$type] = array();
  1592|         }
  1593|         if (!isset($this->_plugin_info[$type][$name])) {
  1594|             $this->_plugin_info[$type][$name] = array($this->_current_file,
  1595|                                                       $this->_current_line_no,
  1596|                                                       $delayed_loading);
  1597|         }
  1598|     }
  1599|     /**
  1600|      * Compiles references of type $smarty.foo
  1601|      *
  1602|      * @param string $indexes
  1603|      * @return string
  1604|      */
  1605|     function _compile_smarty_ref(&$indexes)
  1606|     {
  1607|         /* Extract the reference name. */
  1608|         $_ref = substr($indexes[0], 1);
  1609|         foreach($indexes as $_index_no=>$_index) {
  1610|             if (substr($_index, 0, 1) != '.' && $_index_no<2 || !preg_match('~^(\.|\[|->)~', $_index)) {
  1611|                 $this->_syntax_error('$smarty' . implode('', array_slice($indexes, 0, 2)) . ' is an invalid reference', E_USER_ERROR, __FILE__, __LINE__);
  1612|             }
  1613|         }
  1614|         switch ($_ref) {
  1615|             case 'now':
  1616|                 $compiled_ref = 'time()';
  1617|                 $_max_index = 1;
  1618|                 break;
  1619|             case 'foreach':
  1620|                 array_shift($indexes);
  1621|                 $_var = $this->_parse_var_props(substr($indexes[0], 1));
  1622|                 $_propname = substr($indexes[1], 1);
  1623|                 $_max_index = 1;
  1624|                 switch ($_propname) {
  1625|                     case 'index':
  1626|                         array_shift($indexes);
  1627|                         $compiled_ref = "(\$this->_foreach[$_var]['iteration']-1)";
  1628|                         break;
  1629|                     case 'first':
  1630|                         array_shift($indexes);
  1631|                         $compiled_ref = "(\$this->_foreach[$_var]['iteration'] <= 1)";
  1632|                         break;
  1633|                     case 'last':
  1634|                         array_shift($indexes);
  1635|                         $compiled_ref = "(\$this->_foreach[$_var]['iteration'] == \$this->_foreach[$_var]['total'])";
  1636|                         break;
  1637|                     case 'show':
  1638|                         array_shift($indexes);
  1639|                         $compiled_ref = "(\$this->_foreach[$_var]['total'] > 0)";
  1640|                         break;
  1641|                     default:
  1642|                         unset($_max_index);
  1643|                         $compiled_ref = "\$this->_foreach[$_var]";
  1644|                 }
  1645|                 break;
  1646|             case 'section':
  1647|                 array_shift($indexes);
  1648|                 $_var = $this->_parse_var_props(substr($indexes[0], 1));
  1649|                 $compiled_ref = "\$this->_sections[$_var]";
  1650|                 break;
  1651|             case 'get':
  1652|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_GET' : "\$GLOBALS['HTTP_GET_VARS']";
  1653|                 break;
  1654|             case 'post':
  1655|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_POST' : "\$GLOBALS['HTTP_POST_VARS']";
  1656|                 break;
  1657|             case 'cookies':
  1658|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_COOKIE' : "\$GLOBALS['HTTP_COOKIE_VARS']";
  1659|                 break;
  1660|             case 'env':
  1661|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_ENV' : "\$GLOBALS['HTTP_ENV_VARS']";
  1662|                 break;
  1663|             case 'server':
  1664|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_SERVER' : "\$GLOBALS['HTTP_SERVER_VARS']";
  1665|                 break;
  1666|             case 'session':
  1667|                 $compiled_ref = ($this->request_use_auto_globals) ? '$_SESSION' : "\$GLOBALS['HTTP_SESSION_VARS']";
  1668|                 break;
  1669|             /*
  1670|              * These cases are handled either at run-time or elsewhere in the
  1671|              * compiler.
  1672|              */
  1673|             case 'request':
  1674|                 if ($this->request_use_auto_globals) {
  1675|                     $compiled_ref = '$_REQUEST';
  1676|                     break;
  1677|                 } else {
  1678|                     $this->_init_smarty_vars = true;
  1679|                 }
  1680|                 return null;
  1681|             case 'capture':
  1682|                 return null;
  1683|             case 'template':
  1684|                 $compiled_ref = "'$this->_current_file'";
  1685|                 $_max_index = 1;
  1686|                 break;
  1687|             case 'version':
  1688|                 $compiled_ref = "'$this->_version'";
  1689|                 $_max_index = 1;
  1690|                 break;
  1691|             case 'const':
  1692|                 if ($this->security && !$this->security_settings['ALLOW_CONSTANTS']) {
  1693|                     $this->_syntax_error("(secure mode) constants not permitted",
  1694|                                          E_USER_WARNING, __FILE__, __LINE__);
  1695|                     return;
  1696|                 }
  1697|                 array_shift($indexes);
  1698|                 if (preg_match('!^\.\w+$!', $indexes[0])) {
  1699|                     $compiled_ref = '@' . substr($indexes[0], 1);
  1700|                 } else {
  1701|                     $_val = $this->_parse_var_props(substr($indexes[0], 1));
  1702|                     $compiled_ref = '@constant(' . $_val . ')';
  1703|                 }
  1704|                 $_max_index = 1;
  1705|                 break;
  1706|             case 'config':
  1707|                 $compiled_ref = "\$this->_config[0]['vars']";
  1708|                 $_max_index = 3;
  1709|                 break;
  1710|             case 'ldelim':
  1711|                 $compiled_ref = "'$this->left_delimiter'";
  1712|                 break;
  1713|             case 'rdelim':
  1714|                 $compiled_ref = "'$this->right_delimiter'";
  1715|                 break;
  1716|             default:
  1717|                 $this->_syntax_error('$smarty.' . $_ref . ' is an unknown reference', E_USER_ERROR, __FILE__, __LINE__);
  1718|                 break;
  1719|         }
  1720|         if (isset($_max_index) && count($indexes) > $_max_index) {
  1721|             $this->_syntax_error('$smarty' . implode('', $indexes) .' is an invalid reference', E_USER_ERROR, __FILE__, __LINE__);
  1722|         }
  1723|         array_shift($indexes);
  1724|         return $compiled_ref;
  1725|     }
  1726|     /**
  1727|      * compiles call to plugin of type $type with name $name
  1728|      * returns a string containing the function-name or method call
  1729|      * without the paramter-list that would have follow to make the
  1730|      * call valid php-syntax
  1731|      *
  1732|      * @param string $type
  1733|      * @param string $name
  1734|      * @return string
  1735|      */
  1736|     function _compile_plugin_call($type, $name) {
  1737|         if (isset($this->_plugins[$type][$name])) {
  1738|             /* plugin loaded */
  1739|             if (is_array($this->_plugins[$type][$name][0])) {
  1740|                 return ((is_object($this->_plugins[$type][$name][0][0])) ?
  1741|                         "\$this->_plugins['$type']['$name'][0][0]->"    /* method callback */
  1742|                         : (string)($this->_plugins[$type][$name][0][0]).'::'    /* class callback */
  1743|                        ). $this->_plugins[$type][$name][0][1];
  1744|             } else {
  1745|                 /* function callback */
  1746|                 return $this->_plugins[$type][$name][0];
  1747|             }
  1748|         } else {
  1749|             /* plugin not loaded -> auto-loadable-plugin */
  1750|             return 'smarty_'.$type.'_'.$name;
  1751|         }
  1752|     }
  1753|     /**
  1754|      * load pre- and post-filters
  1755|      */
  1756|     function _load_filters()
  1757|     {
  1758|         if (count($this->_plugins['prefilter']) > 0) {
  1759|             foreach ($this->_plugins['prefilter'] as $filter_name => $prefilter) {
  1760|                 if ($prefilter === false) {
  1761|                     unset($this->_plugins['prefilter'][$filter_name]);
  1762|                     $_params = array('plugins' => array(array('prefilter', $filter_name, null, null, false)));
  1763|                     require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
  1764|                     smarty_core_load_plugins($_params, $this);
  1765|                 }
  1766|             }
  1767|         }
  1768|         if (count($this->_plugins['postfilter']) > 0) {
  1769|             foreach ($this->_plugins['postfilter'] as $filter_name => $postfilter) {
  1770|                 if ($postfilter === false) {
  1771|                     unset($this->_plugins['postfilter'][$filter_name]);
  1772|                     $_params = array('plugins' => array(array('postfilter', $filter_name, null, null, false)));
  1773|                     require_once(SMARTY_CORE_DIR . 'core.load_plugins.php');
  1774|                     smarty_core_load_plugins($_params, $this);
  1775|                 }
  1776|             }
  1777|         }
  1778|     }
  1779|     /**
  1780|      * Quote subpattern references
  1781|      *
  1782|      * @param string $string
  1783|      * @return string
  1784|      */
  1785|     function _quote_replace($string)
  1786|     {
  1787|         return strtr($string, array('\\' => '\\\\', '$' => '\\$'));
  1788|     }
  1789|     /**
  1790|      * display Smarty syntax error
  1791|      *
  1792|      * @param string $error_msg
  1793|      * @param integer $error_type
  1794|      * @param string $file
  1795|      * @param integer $line
  1796|      */
  1797|     function _syntax_error($error_msg, $error_type = E_USER_ERROR, $file=null, $line=null)
  1798|     {
  1799|         $this->_trigger_fatal_error("syntax error: $error_msg", $this->_current_file, $this->_current_line_no, $file, $line, $error_type);
  1800|     }
  1801|     /**
  1802|      * check if the compilation changes from cacheable to
  1803|      * non-cacheable state with the beginning of the current
  1804|      * plugin. return php-code to reflect the transition.
  1805|      * @return string
  1806|      */
  1807|     function _push_cacheable_state($type, $name) {
  1808|         $_cacheable = !isset($this->_plugins[$type][$name]) || $this->_plugins[$type][$name][4];
  1809|         if ($_cacheable
  1810|             || 0<$this->_cacheable_state++) return '';
  1811|         if (!isset($this->_cache_serial)) $this->_cache_serial = md5(uniqid('Smarty'));
  1812|         $_ret = 'if ($this->caching && !$this->_cache_including): echo \'{nocache:'
  1813|             . $this->_cache_serial . '#' . $this->_nocache_count
  1814|             . '}\'; endif;';
  1815|         return $_ret;
  1816|     }
  1817|     /**
  1818|      * check if the compilation changes from non-cacheable to
  1819|      * cacheable state with the end of the current plugin return
  1820|      * php-code to reflect the transition.
  1821|      * @return string
  1822|      */
  1823|     function _pop_cacheable_state($type, $name) {
  1824|         $_cacheable = !isset($this->_plugins[$type][$name]) || $this->_plugins[$type][$name][4];
  1825|         if ($_cacheable
  1826|             || --$this->_cacheable_state>0) return '';
  1827|         return 'if ($this->caching && !$this->_cache_including): echo \'{/nocache:'
  1828|             . $this->_cache_serial . '#' . ($this->_nocache_count++)
  1829|             . '}\'; endif;';
  1830|     }
  1831|     /**
  1832|      * push opening tag-name, file-name and line-number on the tag-stack
  1833|      * @param string the opening tag's name
  1834|      */
  1835|     function _push_tag($open_tag)
  1836|     {
  1837|         array_push($this->_tag_stack, array($open_tag, $this->_current_line_no));
  1838|     }
  1839|     /**
  1840|      * pop closing tag-name
  1841|      * raise an error if this stack-top doesn't match with the closing tag
  1842|      * @param string the closing tag's name
  1843|      * @return string the opening tag's name
  1844|      */
  1845|     function _pop_tag($close_tag)
  1846|     {
  1847|         $message = '';
  1848|         if (count($this->_tag_stack)>0) {
  1849|             list($_open_tag, $_line_no) = array_pop($this->_tag_stack);
  1850|             if ($close_tag == $_open_tag) {
  1851|                 return $_open_tag;
  1852|             }
  1853|             if ($close_tag == 'if' && ($_open_tag == 'else' || $_open_tag == 'elseif' )) {
  1854|                 return $this->_pop_tag($close_tag);
  1855|             }
  1856|             if ($close_tag == 'section' && $_open_tag == 'sectionelse') {
  1857|                 $this->_pop_tag($close_tag);
  1858|                 return $_open_tag;
  1859|             }
  1860|             if ($close_tag == 'foreach' && $_open_tag == 'foreachelse') {
  1861|                 $this->_pop_tag($close_tag);
  1862|                 return $_open_tag;
  1863|             }
  1864|             if ($_open_tag == 'else' || $_open_tag == 'elseif') {
  1865|                 $_open_tag = 'if';
  1866|             } elseif ($_open_tag == 'sectionelse') {
  1867|                 $_open_tag = 'section';
  1868|             } elseif ($_open_tag == 'foreachelse') {
  1869|                 $_open_tag = 'foreach';
  1870|             }
  1871|             $message = " expected {/$_open_tag} (opened line $_line_no).";
  1872|         }
  1873|         $this->_syntax_error("mismatched tag {/$close_tag}.$message",
  1874|                              E_USER_ERROR, __FILE__, __LINE__);
  1875|     }
  1876| }
  1877| /**
  1878|  * compare to values by their string length
  1879|  *
  1880|  * @access private
  1881|  * @param string $a
  1882|  * @param string $b
  1883|  * @return 0|-1|1
  1884|  */
  1885| function _smarty_sort_length($a, $b)
  1886| {
  1887|     if($a == $b)
  1888|         return 0;
  1889|     if(strlen($a) == strlen($b))
  1890|         return ($a > $b) ? -1 : 1;
  1891|     return (strlen($a) > strlen($b)) ? -1 : 1;
  1892| }
  1893| /* vim: set et: */
  1894| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.assemble_plugin_filepath.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-53 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * assemble filepath of requested plugin
     9|  *
    10|  * @param string $type
    11|  * @param string $name
    12|  * @return string|false
    13|  */
    14| function smarty_core_assemble_plugin_filepath($params, &$smarty)
    15| {
    16|     static $_filepaths_cache = array();
    17|     $_plugin_filename = $params['type'] . '.' . $params['name'] . '.php';
    18|     if (isset($_filepaths_cache[$_plugin_filename])) {
    19|         return $_filepaths_cache[$_plugin_filename];
    20|     }
    21|     $_return = false;
    22|     foreach ((array)$smarty->plugins_dir as $_plugin_dir) {
    23|         $_plugin_filepath = $_plugin_dir . DIRECTORY_SEPARATOR . $_plugin_filename;
    24|         if (!preg_match("/^([\/\\\\]|[a-zA-Z]:[\/\\\\])/", $_plugin_dir)) {
    25|             $_relative_paths[] = $_plugin_dir;
    26|             if (@is_readable(SMARTY_DIR . $_plugin_filepath)) {
    27|                 $_return = SMARTY_DIR . $_plugin_filepath;
    28|                 break;
    29|             }
    30|         }
    31|         if (@is_readable($_plugin_filepath)) {
    32|             $_return = $_plugin_filepath;
    33|             break;
    34|         }
    35|     }
    36|     if($_return === false) {
    37|         if(isset($_relative_paths)) {
    38|             foreach ((array)$_relative_paths as $_plugin_dir) {
    39|                 $_plugin_filepath = $_plugin_dir . DIRECTORY_SEPARATOR . $_plugin_filename;
    40|                 $_params = array('file_path' => $_plugin_filepath);
    41|                 require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
    42|                 if(smarty_core_get_include_path($_params, $smarty)) {
    43|                     $_return = $_params['new_file_path'];
    44|                     break;
    45|                 }
    46|             }
    47|         }
    48|     }
    49|     $_filepaths_cache[$_plugin_filename] = $_return;
    50|     return $_return;
    51| }
    52| /* vim: set expandtab: */
    53| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.assign_smarty_interface.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-36 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty assign_smarty_interface core plugin
     9|  *
    10|  * Type:     core<br />
    11|  * Name:     assign_smarty_interface<br />
    12|  * Purpose:  assign the $smarty interface variable
    13|  * @param array Format: null
    14|  * @param Smarty
    15|  */
    16| function smarty_core_assign_smarty_interface($params, &$smarty)
    17| {
    18|         if (isset($smarty->_smarty_vars) && isset($smarty->_smarty_vars['request'])) {
    19|             return;
    20|         }
    21|         $_globals_map = array('g'  => 'HTTP_GET_VARS',
    22|                              'p'  => 'HTTP_POST_VARS',
    23|                              'c'  => 'HTTP_COOKIE_VARS',
    24|                              's'  => 'HTTP_SERVER_VARS',
    25|                              'e'  => 'HTTP_ENV_VARS');
    26|         $_smarty_vars_request  = array();
    27|         foreach (preg_split('!!', strtolower($smarty->request_vars_order)) as $_c) {
    28|             if (isset($_globals_map[$_c])) {
    29|                 $_smarty_vars_request = array_merge($_smarty_vars_request, $GLOBALS[$_globals_map[$_c]]);
    30|             }
    31|         }
    32|         $_smarty_vars_request = @array_merge($_smarty_vars_request, $GLOBALS['HTTP_SESSION_VARS']);
    33|         $smarty->_smarty_vars['request'] = $_smarty_vars_request;
    34| }
    35| /* vim: set expandtab: */
    36| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.create_dir_structure.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-63 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * create full directory structure
     9|  *
    10|  * @param string $dir
    11|  */
    12| function smarty_core_create_dir_structure($params, &$smarty)
    13| {
    14|     if (!file_exists($params['dir'])) {
    15|         $_open_basedir_ini = ini_get('open_basedir');
    16|         if (DIRECTORY_SEPARATOR=='/') {
    17|             /* unix-style paths */
    18|             $_dir = $params['dir'];
    19|             $_dir_parts = preg_split('!/+!', $_dir, -1, preg_split_NO_EMPTY);
    20|             $_new_dir = (substr($_dir, 0, 1)=='/') ? '/' : getcwd().'/';
    21|             if($_use_open_basedir = !empty($_open_basedir_ini)) {
    22|                 $_open_basedirs = explode(':', $_open_basedir_ini);
    23|             }
    24|         } else {
    25|             /* other-style paths */
    26|             $_dir = str_replace('\\','/', $params['dir']);
    27|             $_dir_parts = preg_split('!/+!', $_dir, -1, preg_split_NO_EMPTY);
    28|             if (preg_match('!^((//)|([a-zA-Z]:/))!', $_dir, $_root_dir)) {
    29|                 /* leading "//" for network volume, or "[letter]:/" for full path */
    30|                 $_new_dir = $_root_dir[1];
    31|                 /* remove drive-letter from _dir_parts */
    32|                 if (isset($_root_dir[3])) array_shift($_dir_parts);
    33|             } else {
    34|                 $_new_dir = str_replace('\\', '/', getcwd()).'/';
    35|             }
    36|             if($_use_open_basedir = !empty($_open_basedir_ini)) {
    37|                 $_open_basedirs = explode(';', str_replace('\\', '/', $_open_basedir_ini));
    38|             }
    39|         }
    40|         /* all paths use "/" only from here */
    41|         foreach ($_dir_parts as $_dir_part) {
    42|             $_new_dir .= $_dir_part;
    43|             if ($_use_open_basedir) {
    44|                 $_make_new_dir = false;
    45|                 foreach ($_open_basedirs as $_open_basedir) {
    46|                     if (substr($_new_dir, 0, strlen($_open_basedir)) == $_open_basedir) {
    47|                         $_make_new_dir = true;
    48|                         break;
    49|                     }
    50|                 }
    51|             } else {
    52|                 $_make_new_dir = true;
    53|             }
    54|             if ($_make_new_dir && !file_exists($_new_dir) && !@mkdir($_new_dir, $smarty->_dir_perms) && !is_dir($_new_dir)) {
    55|                 $smarty->trigger_error("problem creating directory '" . $_new_dir . "'");
    56|                 return false;
    57|             }
    58|             $_new_dir .= '/';
    59|         }
    60|     }
    61| }
    62| /* vim: set expandtab: */
    63| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.display_debug_console.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-47 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty debug_console function plugin
     9|  *
    10|  * Type:     core<br />
    11|  * Name:     display_debug_console<br />
    12|  * Purpose:  display the javascript debug console window
    13|  * @param array Format: null
    14|  * @param Smarty
    15|  */
    16| function smarty_core_display_debug_console($params, &$smarty)
    17| {
    18|     if(empty($smarty->debug_tpl)) {
    19|         $smarty->debug_tpl = SMARTY_DIR . 'debug.tpl';
    20|         if($smarty->security && is_file($smarty->debug_tpl)) {
    21|             $smarty->secure_dir[] = realpath($smarty->debug_tpl);
    22|         }
    23|         $smarty->debug_tpl = 'file:' . SMARTY_DIR . 'debug.tpl';
    24|     }
    25|     $_ldelim_orig = $smarty->left_delimiter;
    26|     $_rdelim_orig = $smarty->right_delimiter;
    27|     $smarty->left_delimiter = '{';
    28|     $smarty->right_delimiter = '}';
    29|     $_compile_id_orig = $smarty->_compile_id;
    30|     $smarty->_compile_id = null;
    31|     $_compile_path = $smarty->_get_compile_path($smarty->debug_tpl);
    32|     if ($smarty->_compile_resource($smarty->debug_tpl, $_compile_path))
    33|     {
    34|         ob_start();
    35|         $smarty->_include($_compile_path);
    36|         $_results = ob_get_contents();
    37|         ob_end_clean();
    38|     } else {
    39|         $_results = '';
    40|     }
    41|     $smarty->_compile_id = $_compile_id_orig;
    42|     $smarty->left_delimiter = $_ldelim_orig;
    43|     $smarty->right_delimiter = $_rdelim_orig;
    44|     return $_results;
    45| }
    46| /* vim: set expandtab: */
    47| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.get_include_path.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-35 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Get path to file from include_path
     9|  *
    10|  * @param string $file_path
    11|  * @param string $new_file_path
    12|  * @return boolean
    13|  * @staticvar array|null
    14|  */
    15| function smarty_core_get_include_path(&$params, &$smarty)
    16| {
    17|     static $_path_array = null;
    18|     if(!isset($_path_array)) {
    19|         $_ini_include_path = ini_get('include_path');
    20|         if(strstr($_ini_include_path,';')) {
    21|             $_path_array = explode(';',$_ini_include_path);
    22|         } else {
    23|             $_path_array = explode(':',$_ini_include_path);
    24|         }
    25|     }
    26|     foreach ($_path_array as $_include_path) {
    27|         if (@is_readable($_include_path . DIRECTORY_SEPARATOR . $params['file_path'])) {
    28|                $params['new_file_path'] = $_include_path . DIRECTORY_SEPARATOR . $params['file_path'];
    29|             return true;
    30|         }
    31|     }
    32|     return false;
    33| }
    34| /* vim: set expandtab: */
    35| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.get_microtime.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-19 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Get seconds and microseconds
     9|  * @return double
    10|  */
    11| function smarty_core_get_microtime($params, &$smarty)
    12| {
    13|     $mtime = microtime();
    14|     $mtime = explode(" ", $mtime);
    15|     $mtime = (double)($mtime[1]) + (double)($mtime[0]);
    16|     return ($mtime);
    17| }
    18| /* vim: set expandtab: */
    19| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.get_php_resource.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-69 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Retrieves PHP script resource
     9|  *
    10|  * sets $php_resource to the returned resource
    11|  * @param string $resource
    12|  * @param string $resource_type
    13|  * @param  $php_resource
    14|  * @return boolean
    15|  */
    16| function smarty_core_get_php_resource(&$params, &$smarty)
    17| {
    18|     $params['resource_base_path'] = $smarty->trusted_dir;
    19|     $smarty->_parse_resource_name($params, $smarty);
    20|     /*
    21|      * Find out if the resource exists.
    22|      */
    23|     if ($params['resource_type'] == 'file') {
    24|         $_readable = false;
    25|         if(file_exists($params['resource_name']) && is_readable($params['resource_name'])) {
    26|             $_readable = true;
    27|         } else {
    28|             $_params = array('file_path' => $params['resource_name']);
    29|             require_once(SMARTY_CORE_DIR . 'core.get_include_path.php');
    30|             if(smarty_core_get_include_path($_params, $smarty)) {
    31|                 $_include_path = $_params['new_file_path'];
    32|                 $_readable = true;
    33|             }
    34|         }
    35|     } else if ($params['resource_type'] != 'file') {
    36|         $_template_source = null;
    37|         $_readable = is_callable($smarty->_plugins['resource'][$params['resource_type']][0][0])
    38|             && call_user_func_array($smarty->_plugins['resource'][$params['resource_type']][0][0],
    39|                                     array($params['resource_name'], &$_template_source, &$smarty));
    40|     }
    41|     /*
    42|      * Set the error function, depending on which class calls us.
    43|      */
    44|     if (method_exists($smarty, '_syntax_error')) {
    45|         $_error_funcc = '_syntax_error';
    46|     } else {
    47|         $_error_funcc = 'trigger_error';
    48|     }
    49|     if ($_readable) {
    50|         if ($smarty->security) {
    51|             require_once(SMARTY_CORE_DIR . 'core.is_trusted.php');
    52|             if (!smarty_core_is_trusted($params, $smarty)) {
    53|                 $smarty->$_error_funcc('(secure mode) ' . $params['resource_type'] . ':' . $params['resource_name'] . ' is not trusted');
    54|                 return false;
    55|             }
    56|         }
    57|     } else {
    58|         $smarty->$_error_funcc($params['resource_type'] . ':' . $params['resource_name'] . ' is not readable');
    59|         return false;
    60|     }
    61|     if ($params['resource_type'] == 'file') {
    62|         $params['php_resource'] = $params['resource_name'];
    63|     } else {
    64|         $params['php_resource'] = $_template_source;
    65|     }
    66|     return true;
    67| }
    68| /* vim: set expandtab: */
    69| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.is_secure.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-50 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * determines if a resource is secure or not.
     9|  *
    10|  * @param string $resource_type
    11|  * @param string $resource_name
    12|  * @return boolean
    13|  */
    14| function smarty_core_is_secure($params, &$smarty)
    15| {
    16|     if (!$smarty->security || $smarty->security_settings['INCLUDE_ANY']) {
    17|         return true;
    18|     }
    19|     if ($params['resource_type'] == 'file') {
    20|         $_rp = realpath($params['resource_name']);
    21|         if (isset($params['resource_base_path'])) {
    22|             foreach ((array)$params['resource_base_path'] as $curr_dir) {
    23|                 if ( ($_cd = realpath($curr_dir)) !== false &&
    24|                      strncmp($_rp, $_cd, strlen($_cd)) == 0 &&
    25|                      substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR ) {
    26|                     return true;
    27|                 }
    28|             }
    29|         }
    30|         if (!empty($smarty->secure_dir)) {
    31|             foreach ((array)$smarty->secure_dir as $curr_dir) {
    32|                 if ( ($_cd = realpath($curr_dir)) !== false) {
    33|                     if($_cd == $_rp) {
    34|                         return true;
    35|                     } elseif (strncmp($_rp, $_cd, strlen($_cd)) == 0 &&
    36|                         substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR) {
    37|                         return true;
    38|                     }
    39|                 }
    40|             }
    41|         }
    42|     } else {
    43|         return call_user_func_array(
    44|             $smarty->_plugins['resource'][$params['resource_type']][0][2],
    45|             array($params['resource_name'], &$smarty));
    46|     }
    47|     return false;
    48| }
    49| /* vim: set expandtab: */
    50| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.is_trusted.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-38 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * determines if a resource is trusted or not
     9|  *
    10|  * @param string $resource_type
    11|  * @param string $resource_name
    12|  * @return boolean
    13|  */
    14| function smarty_core_is_trusted($params, &$smarty)
    15| {
    16|     $_smarty_trusted = false;
    17|     if ($params['resource_type'] == 'file') {
    18|         if (!empty($smarty->trusted_dir)) {
    19|             $_rp = realpath($params['resource_name']);
    20|             foreach ((array)$smarty->trusted_dir as $curr_dir) {
    21|                 if (!empty($curr_dir) && is_readable ($curr_dir)) {
    22|                     $_cd = realpath($curr_dir);
    23|                     if (strncmp($_rp, $_cd, strlen($_cd)) == 0
    24|                         && substr($_rp, strlen($_cd), 1) == DIRECTORY_SEPARATOR ) {
    25|                         $_smarty_trusted = true;
    26|                         break;
    27|                     }
    28|                 }
    29|             }
    30|         }
    31|     } else {
    32|         $_smarty_trusted = call_user_func_array($smarty->_plugins['resource'][$params['resource_type']][0][3],
    33|                                                 array($params['resource_name'], $smarty));
    34|     }
    35|     return $_smarty_trusted;
    36| }
    37| /* vim: set expandtab: */
    38| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.load_plugins.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-110 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Load requested plugins
     9|  *
    10|  * @param array $plugins
    11|  */
    12| function smarty_core_load_plugins($params, &$smarty)
    13| {
    14|     foreach ($params['plugins'] as $_plugin_info) {
    15|         list($_type, $_name, $_tpl_file, $_tpl_line, $_delayed_loading) = $_plugin_info;
    16|         $_plugin = &$smarty->_plugins[$_type][$_name];
    17|         /*
    18|          * We do not load plugin more than once for each instance of Smarty.
    19|          * The following code checks for that. The plugin can also be
    20|          * registered dynamically at runtime, in which case template file
    21|          * and line number will be unknown, so we fill them in.
    22|          *
    23|          * The final element of the info array is a flag that indicates
    24|          * whether the dynamically registered plugin function has been
    25|          * checked for existence yet or not.
    26|          */
    27|         if (isset($_plugin)) {
    28|             if (empty($_plugin[3])) {
    29|                 if (!is_callable($_plugin[0])) {
    30|                     $smarty->_trigger_fatal_error("[plugin] $_type '$_name' is not implemented", $_tpl_file, $_tpl_line, __FILE__, __LINE__);
    31|                 } else {
    32|                     $_plugin[1] = $_tpl_file;
    33|                     $_plugin[2] = $_tpl_line;
    34|                     $_plugin[3] = true;
    35|                     if (!isset($_plugin[4])) $_plugin[4] = true; /* cacheable */
    36|                 }
    37|             }
    38|             continue;
    39|         } else if ($_type == 'insert') {
    40|             /*
    41|              * For backwards compatibility, we check for insert functions in
    42|              * the symbol table before trying to load them as a plugin.
    43|              */
    44|             $_plugin_func = 'insert_' . $_name;
    45|             if (function_exists($_plugin_func)) {
    46|                 $_plugin = array($_plugin_func, $_tpl_file, $_tpl_line, true, false);
    47|                 continue;
    48|             }
    49|         }
    50|         $_plugin_file = $smarty->_get_plugin_filepath($_type, $_name);
    51|         if (! $_found = ($_plugin_file != false)) {
    52|             $_message = "could not load plugin file '$_type.$_name.php'\n";
    53|         }
    54|         /*
    55|          * If plugin file is found, it -must- provide the properly named
    56|          * plugin function. In case it doesn't, simply output the error and
    57|          * do not fall back on any other method.
    58|          */
    59|         if ($_found) {
    60|             include_once $_plugin_file;
    61|             $_plugin_func = 'smarty_' . $_type . '_' . $_name;
    62|             if (!function_exists($_plugin_func)) {
    63|                 $smarty->_trigger_fatal_error("[plugin] function $_plugin_func() not found in $_plugin_file", $_tpl_file, $_tpl_line, __FILE__, __LINE__);
    64|                 continue;
    65|             }
    66|         }
    67|         /*
    68|          * In case of insert plugins, their code may be loaded later via
    69|          * 'script' attribute.
    70|          */
    71|         else if ($_type == 'insert' && $_delayed_loading) {
    72|             $_plugin_func = 'smarty_' . $_type . '_' . $_name;
    73|             $_found = true;
    74|         }
    75|         /*
    76|          * Plugin specific processing and error checking.
    77|          */
    78|         if (!$_found) {
    79|             if ($_type == 'modifier') {
    80|                 /*
    81|                  * In case modifier falls back on using PHP functions
    82|                  * directly, we only allow those specified in the security
    83|                  * context.
    84|                  */
    85|                 if ($smarty->security && !in_array($_name, $smarty->security_settings['MODIFIER_FUNCS'])) {
    86|                     $_message = "(secure mode) modifier '$_name' is not allowed";
    87|                 } else {
    88|                     if (!function_exists($_name)) {
    89|                         $_message = "modifier '$_name' is not implemented";
    90|                     } else {
    91|                         $_plugin_func = $_name;
    92|                         $_found = true;
    93|                     }
    94|                 }
    95|             } else if ($_type == 'function') {
    96|                 /*
    97|                  * This is a catch-all situation.
    98|                  */
    99|                 $_message = "unknown tag - '$_name'";
   100|             }
   101|         }
   102|         if ($_found) {
   103|             $smarty->_plugins[$_type][$_name] = array($_plugin_func, $_tpl_file, $_tpl_line, true, true);
   104|         } else {
   105|             $smarty->_trigger_fatal_error('[plugin] ' . $_message, $_tpl_file, $_tpl_line, __FILE__, __LINE__);
   106|         }
   107|     }
   108| }
   109| /* vim: set expandtab: */
   110| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.load_resource_plugin.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-61 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * load a resource plugin
     9|  *
    10|  * @param string $type
    11|  */
    12| function smarty_core_load_resource_plugin($params, &$smarty)
    13| {
    14|     /*
    15|      * Resource plugins are not quite like the other ones, so they are
    16|      * handled differently. The first element of plugin info is the array of
    17|      * functions provided by the plugin, the second one indicates whether
    18|      * all of them exist or not.
    19|      */
    20|     $_plugin = &$smarty->_plugins['resource'][$params['type']];
    21|     if (isset($_plugin)) {
    22|         if (!$_plugin[1] && count($_plugin[0])) {
    23|             $_plugin[1] = true;
    24|             foreach ($_plugin[0] as $_plugin_func) {
    25|                 if (!is_callable($_plugin_func)) {
    26|                     $_plugin[1] = false;
    27|                     break;
    28|                 }
    29|             }
    30|         }
    31|         if (!$_plugin[1]) {
    32|             $smarty->_trigger_fatal_error("[plugin] resource '" . $params['type'] . "' is not implemented", null, null, __FILE__, __LINE__);
    33|         }
    34|         return;
    35|     }
    36|     $_plugin_file = $smarty->_get_plugin_filepath('resource', $params['type']);
    37|     $_found = ($_plugin_file != false);
    38|     if ($_found) {            /*
    39|          * If the plugin file is found, it -must- provide the properly named
    40|          * plugin functions.
    41|          */
    42|         include_once($_plugin_file);
    43|         /*
    44|          * Locate functions that we require the plugin to provide.
    45|          */
    46|         $_resource_ops = array('source', 'timestamp', 'secure', 'trusted');
    47|         $_resource_funcs = array();
    48|         foreach ($_resource_ops as $_op) {
    49|             $_plugin_func = 'smarty_resource_' . $params['type'] . '_' . $_op;
    50|             if (!function_exists($_plugin_func)) {
    51|                 $smarty->_trigger_fatal_error("[plugin] function $_plugin_func() not found in $_plugin_file", null, null, __FILE__, __LINE__);
    52|                 return;
    53|             } else {
    54|                 $_resource_funcs[] = $_plugin_func;
    55|             }
    56|         }
    57|         $smarty->_plugins['resource'][$params['type']] = array($_resource_funcs, true);
    58|     }
    59| }
    60| /* vim: set expandtab: */
    61| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.process_cached_inserts.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-60 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Replace cached inserts with the actual results
     9|  *
    10|  * @param string $results
    11|  * @return string
    12|  */
    13| function smarty_core_process_cached_inserts($params, &$smarty)
    14| {
    15|     preg_match_all('!'.$smarty->_smarty_md5.'{insert_cache (.*)}'.$smarty->_smarty_md5.'!Uis',
    16|                    $params['results'], $match);
    17|     list($cached_inserts, $insert_args) = $match;
    18|     for ($i = 0, $for_max = count($cached_inserts); $i < $for_max; $i++) {
    19|         if ($smarty->debugging) {
    20|             $_params = array();
    21|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    22|             $debug_start_time = smarty_core_get_microtime($_params, $smarty);
    23|         }
    24|         $args = unserialize($insert_args[$i]);
    25|         $name = $args['name'];
    26|         if (isset($args['script'])) {
    27|             $_params = array('resource_name' => $smarty->_dequote($args['script']));
    28|             require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
    29|             if(!smarty_core_get_php_resource($_params, $smarty)) {
    30|                 return false;
    31|             }
    32|             $resource_type = $_params['resource_type'];
    33|             $php_resource = $_params['php_resource'];
    34|             if ($resource_type == 'file') {
    35|                 $smarty->_include($php_resource, true);
    36|             } else {
    37|                 $smarty->_eval($php_resource);
    38|             }
    39|         }
    40|         $function_name = $smarty->_plugins['insert'][$name][0];
    41|         if (empty($args['assign'])) {
    42|             $replace = $function_name($args, $smarty);
    43|         } else {
    44|             $smarty->assign($args['assign'], $function_name($args, $smarty));
    45|             $replace = '';
    46|         }
    47|         $params['results'] = substr_replace($params['results'], $replace, strpos($params['results'], $cached_inserts[$i]), strlen($cached_inserts[$i]));
    48|         if ($smarty->debugging) {
    49|             $_params = array();
    50|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    51|             $smarty->_smarty_debug_info[] = array('type'      => 'insert',
    52|                                                 'filename'  => 'insert_'.$name,
    53|                                                 'depth'     => $smarty->_inclusion_depth,
    54|                                                 'exec_time' => smarty_core_get_microtime($_params, $smarty) - $debug_start_time);
    55|         }
    56|     }
    57|     return $params['results'];
    58| }
    59| /* vim: set expandtab: */
    60| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.process_compiled_include.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-31 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Replace nocache-tags by results of the corresponding non-cacheable
     9|  * functions and return it
    10|  *
    11|  * @param string $compiled_tpl
    12|  * @param string $cached_source
    13|  * @return string
    14|  */
    15| function smarty_core_process_compiled_include($params, &$smarty)
    16| {
    17|     $_cache_including = $smarty->_cache_including;
    18|     $smarty->_cache_including = true;
    19|     $_return = $params['results'];
    20|     foreach ($smarty->_cache_info['cache_serials'] as $_include_file_path=>$_cache_serial) {
    21|         $smarty->_include($_include_file_path, true);
    22|     }
    23|     foreach ($smarty->_cache_serials as $_include_file_path=>$_cache_serial) {
    24|         $_return = preg_replace_callback('!(\{nocache\:('.$_cache_serial.')#(\d+)\})!s',
    25|                                          array(&$smarty, '_process_compiled_include_callback'),
    26|                                          $_return);
    27|     }
    28|     $smarty->_cache_including = $_cache_including;
    29|     return $_return;
    30| }
    31| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.read_cache_file.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-75 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * read a cache file, determine if it needs to be
     9|  * regenerated or not
    10|  *
    11|  * @param string $tpl_file
    12|  * @param string $cache_id
    13|  * @param string $compile_id
    14|  * @param string $results
    15|  * @return boolean
    16|  */
    17| function smarty_core_read_cache_file(&$params, &$smarty)
    18| {
    19|     static  $content_cache = array();
    20|     if ($smarty->force_compile) {
    21|         return false;
    22|     }
    23|     if (isset($content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']])) {
    24|         list($params['results'], $smarty->_cache_info) = $content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']];
    25|         return true;
    26|     }
    27|     if (!empty($smarty->cache_handler_func)) {
    28|         call_user_func_array($smarty->cache_handler_func,
    29|                              array('read', &$smarty, &$params['results'], $params['tpl_file'], $params['cache_id'], $params['compile_id'], null));
    30|     } else {
    31|         $_auto_id = $smarty->_get_auto_id($params['cache_id'], $params['compile_id']);
    32|         $_cache_file = $smarty->_get_auto_filename($smarty->cache_dir, $params['tpl_file'], $_auto_id);
    33|         $params['results'] = $smarty->_read_file($_cache_file);
    34|     }
    35|     if (empty($params['results'])) {
    36|         return false;
    37|     }
    38|     $_contents = $params['results'];
    39|     $_info_start = strpos($_contents, "\n") + 1;
    40|     $_info_len = (int)substr($_contents, 0, $_info_start - 1);
    41|     $_cache_info = unserialize(substr($_contents, $_info_start, $_info_len));
    42|     $params['results'] = substr($_contents, $_info_start + $_info_len);
    43|     if ($smarty->caching == 2 && isset ($_cache_info['expires'])){
    44|         if ($_cache_info['expires'] > -1 && (time() > $_cache_info['expires'])) {
    45|             return false;
    46|         }
    47|     } else {
    48|         if ($smarty->cache_lifetime > -1 && (time() - $_cache_info['timestamp'] > $smarty->cache_lifetime)) {
    49|             return false;
    50|         }
    51|     }
    52|     if ($smarty->compile_check) {
    53|         $_params = array('get_source' => false, 'quiet'=>true);
    54|         foreach (array_keys($_cache_info['template']) as $_template_dep) {
    55|             $_params['resource_name'] = $_template_dep;
    56|             if (!$smarty->_fetch_resource_info($_params) || $_cache_info['timestamp'] < $_params['resource_timestamp']) {
    57|                 return false;
    58|             }
    59|         }
    60|         if (isset($_cache_info['config'])) {
    61|             $_params = array('resource_base_path' => $smarty->config_dir, 'get_source' => false, 'quiet'=>true);
    62|             foreach (array_keys($_cache_info['config']) as $_config_dep) {
    63|                 $_params['resource_name'] = $_config_dep;
    64|                 if (!$smarty->_fetch_resource_info($_params) || $_cache_info['timestamp'] < $_params['resource_timestamp']) {
    65|                     return false;
    66|                 }
    67|             }
    68|         }
    69|     }
    70|     $content_cache[$params['tpl_file'].','.$params['cache_id'].','.$params['compile_id']] = array($params['results'], $_cache_info);
    71|     $smarty->_cache_info = $_cache_info;
    72|     return true;
    73| }
    74| /* vim: set expandtab: */
    75| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.rm_auto.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-61 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * delete an automagically created file by name and id
     9|  *
    10|  * @param string $auto_base
    11|  * @param string $auto_source
    12|  * @param string $auto_id
    13|  * @param integer $exp_time
    14|  * @return boolean
    15|  */
    16| function smarty_core_rm_auto($params, &$smarty)
    17| {
    18|     if (!@is_dir($params['auto_base']))
    19|       return false;
    20|     if(!isset($params['auto_id']) && !isset($params['auto_source'])) {
    21|         $_params = array(
    22|             'dirname' => $params['auto_base'],
    23|             'level' => 0,
    24|             'exp_time' => $params['exp_time']
    25|         );
    26|         require_once(SMARTY_CORE_DIR . 'core.rmdir.php');
    27|         $_res = smarty_core_rmdir($_params, $smarty);
    28|     } else {
    29|         $_tname = $smarty->_get_auto_filename($params['auto_base'], $params['auto_source'], $params['auto_id']);
    30|         if(isset($params['auto_source'])) {
    31|             if (isset($params['extensions'])) {
    32|                 $_res = false;
    33|                 foreach ((array)$params['extensions'] as $_extension)
    34|                     $_res |= $smarty->_unlink($_tname.$_extension, $params['exp_time']);
    35|             } else {
    36|                 $_res = $smarty->_unlink($_tname, $params['exp_time']);
    37|             }
    38|         } elseif ($smarty->use_sub_dirs) {
    39|             $_params = array(
    40|                 'dirname' => $_tname,
    41|                 'level' => 1,
    42|                 'exp_time' => $params['exp_time']
    43|             );
    44|             require_once(SMARTY_CORE_DIR . 'core.rmdir.php');
    45|             $_res = smarty_core_rmdir($_params, $smarty);
    46|         } else {
    47|             $_handle = opendir($params['auto_base']);
    48|             $_res = true;
    49|             while (false !== ($_filename = readdir($_handle))) {
    50|                 if($_filename == '.' || $_filename == '..') {
    51|                     continue;
    52|                 } elseif (substr($params['auto_base'] . DIRECTORY_SEPARATOR . $_filename, 0, strlen($_tname)) == $_tname) {
    53|                     $_res &= (bool)$smarty->_unlink($params['auto_base'] . DIRECTORY_SEPARATOR . $_filename, $params['exp_time']);
    54|                 }
    55|             }
    56|         }
    57|     }
    58|     return $_res;
    59| }
    60| /* vim: set expandtab: */
    61| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.rmdir.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-44 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * delete a dir recursively (level=0 -> keep root)
     9|  * WARNING: no tests, it will try to remove what you tell it!
    10|  *
    11|  * @param string $dirname
    12|  * @param integer $level
    13|  * @param integer $exp_time
    14|  * @return boolean
    15|  */
    16| function smarty_core_rmdir($params, &$smarty)
    17| {
    18|    if(!isset($params['level'])) { $params['level'] = 1; }
    19|    if(!isset($params['exp_time'])) { $params['exp_time'] = null; }
    20|    if($_handle = @opendir($params['dirname'])) {
    21|         while (false !== ($_entry = readdir($_handle))) {
    22|             if ($_entry != '.' && $_entry != '..') {
    23|                 if (@is_dir($params['dirname'] . DIRECTORY_SEPARATOR . $_entry)) {
    24|                     $_params = array(
    25|                         'dirname' => $params['dirname'] . DIRECTORY_SEPARATOR . $_entry,
    26|                         'level' => $params['level'] + 1,
    27|                         'exp_time' => $params['exp_time']
    28|                     );
    29|                     smarty_core_rmdir($_params, $smarty);
    30|                 }
    31|                 else {
    32|                     $smarty->_unlink($params['dirname'] . DIRECTORY_SEPARATOR . $_entry, $params['exp_time']);
    33|                 }
    34|             }
    35|         }
    36|         closedir($_handle);
    37|    }
    38|    if ($params['level']) {
    39|        return @rmdir($params['dirname']);
    40|    }
    41|    return (bool)$_handle;
    42| }
    43| /* vim: set expandtab: */
    44| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.run_insert_handler.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-63 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Handle insert tags
     9|  *
    10|  * @param array $args
    11|  * @return string
    12|  */
    13| function smarty_core_run_insert_handler($params, &$smarty)
    14| {
    15|     require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    16|     if ($smarty->debugging) {
    17|         $_params = array();
    18|         $_debug_start_time = smarty_core_get_microtime($_params, $smarty);
    19|     }
    20|     if ($smarty->caching) {
    21|         $_arg_string = serialize($params['args']);
    22|         $_name = $params['args']['name'];
    23|         if (!isset($smarty->_cache_info['insert_tags'][$_name])) {
    24|             $smarty->_cache_info['insert_tags'][$_name] = array('insert',
    25|                                                              $_name,
    26|                                                              $smarty->_plugins['insert'][$_name][1],
    27|                                                              $smarty->_plugins['insert'][$_name][2],
    28|                                                              !empty($params['args']['script']) ? true : false);
    29|         }
    30|         return $smarty->_smarty_md5."{insert_cache $_arg_string}".$smarty->_smarty_md5;
    31|     } else {
    32|         if (isset($params['args']['script'])) {
    33|             $_params = array('resource_name' => $smarty->_dequote($params['args']['script']));
    34|             require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
    35|             if(!smarty_core_get_php_resource($_params, $smarty)) {
    36|                 return false;
    37|             }
    38|             if ($_params['resource_type'] == 'file') {
    39|                 $smarty->_include($_params['php_resource'], true);
    40|             } else {
    41|                 $smarty->_eval($_params['php_resource']);
    42|             }
    43|             unset($params['args']['script']);
    44|         }
    45|         $_funcname = $smarty->_plugins['insert'][$params['args']['name']][0];
    46|         $_content = $_funcname($params['args'], $smarty);
    47|         if ($smarty->debugging) {
    48|             $_params = array();
    49|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    50|             $smarty->_smarty_debug_info[] = array('type'      => 'insert',
    51|                                                 'filename'  => 'insert_'.$params['args']['name'],
    52|                                                 'depth'     => $smarty->_inclusion_depth,
    53|                                                 'exec_time' => smarty_core_get_microtime($_params, $smarty) - $_debug_start_time);
    54|         }
    55|         if (!empty($params['args']["assign"])) {
    56|             $smarty->assign($params['args']["assign"], $_content);
    57|         } else {
    58|             return $_content;
    59|         }
    60|     }
    61| }
    62| /* vim: set expandtab: */
    63| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.smarty_include_php.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-42 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * called for included php files within templates
     9|  *
    10|  * @param string $smarty_file
    11|  * @param string $smarty_assign variable to assign the included template's
    12|  *               output into
    13|  * @param boolean $smarty_once uses include_once if this is true
    14|  * @param array $smarty_include_vars associative array of vars from
    15|  *              {include file="blah" var=$var}
    16|  */
    17| function smarty_core_smarty_include_php($params, &$smarty)
    18| {
    19|     $_params = array('resource_name' => $params['smarty_file']);
    20|     require_once(SMARTY_CORE_DIR . 'core.get_php_resource.php');
    21|     smarty_core_get_php_resource($_params, $smarty);
    22|     $_smarty_resource_type = $_params['resource_type'];
    23|     $_smarty_php_resource = $_params['php_resource'];
    24|     if (!empty($params['smarty_assign'])) {
    25|         ob_start();
    26|         if ($_smarty_resource_type == 'file') {
    27|             $smarty->_include($_smarty_php_resource, $params['smarty_once'], $params['smarty_include_vars']);
    28|         } else {
    29|             $smarty->_eval($_smarty_php_resource, $params['smarty_include_vars']);
    30|         }
    31|         $smarty->assign($params['smarty_assign'], ob_get_contents());
    32|         ob_end_clean();
    33|     } else {
    34|         if ($_smarty_resource_type == 'file') {
    35|             $smarty->_include($_smarty_php_resource, $params['smarty_once'], $params['smarty_include_vars']);
    36|         } else {
    37|             $smarty->_eval($_smarty_php_resource, $params['smarty_include_vars']);
    38|         }
    39|     }
    40| }
    41| /* vim: set expandtab: */
    42| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.write_cache_file.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-69 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Prepend the cache information to the cache file
     9|  * and write it
    10|  *
    11|  * @param string $tpl_file
    12|  * @param string $cache_id
    13|  * @param string $compile_id
    14|  * @param string $results
    15|  * @return true|null
    16|  */
    17| function smarty_core_write_cache_file($params, &$smarty)
    18| {
    19|     $smarty->_cache_info['timestamp'] = time();
    20|     if ($smarty->cache_lifetime > -1){
    21|         $smarty->_cache_info['expires'] = $smarty->_cache_info['timestamp'] + $smarty->cache_lifetime;
    22|     } else {
    23|         $smarty->_cache_info['expires'] = -1;
    24|     }
    25|     if (preg_match_all('!\{(/?)nocache\:[0-9a-f]{32}#\d+\}!', $params['results'], $match, PREG_PATTERN_ORDER)) {
    26|         $match_count = count($match[0]);
    27|         $results = preg_split('!(\{/?nocache\:[0-9a-f]{32}#\d+\})!', $params['results'], -1, preg_split_DELIM_CAPTURE);
    28|         $level = 0;
    29|         $j = 0;
    30|         for ($i=0, $results_count = count($results); $i < $results_count && $j < $match_count; $i++) {
    31|             if ($results[$i] == $match[0][$j]) {
    32|                 if ($match[1][$j]) { // closing tag
    33|                     $level--;
    34|                     unset($results[$i]);
    35|                 } else { // opening tag
    36|                     if ($level++ > 0) unset($results[$i]);
    37|                 }
    38|                 $j++;
    39|             } elseif ($level > 0) {
    40|                 unset($results[$i]);
    41|             }
    42|         }
    43|         $params['results'] = implode('', $results);
    44|     }
    45|     $smarty->_cache_info['cache_serials'] = $smarty->_cache_serials;
    46|     $_cache_info = serialize($smarty->_cache_info);
    47|     $params['results'] = strlen($_cache_info) . "\n" . $_cache_info . $params['results'];
    48|     if (!empty($smarty->cache_handler_func)) {
    49|         call_user_func_array($smarty->cache_handler_func,
    50|                              array('write', &$smarty, &$params['results'], $params['tpl_file'], $params['cache_id'], $params['compile_id'], null));
    51|     } else {
    52|         if(!@is_writable($smarty->cache_dir)) {
    53|             if(!@is_dir($smarty->cache_dir)) {
    54|                 $smarty->trigger_error('the $cache_dir \'' . $smarty->cache_dir . '\' does not exist, or is not a directory.', E_USER_ERROR);
    55|                 return false;
    56|             }
    57|             $smarty->trigger_error('unable to write to $cache_dir \'' . realpath($smarty->cache_dir) . '\'. Be sure $cache_dir is writable by the web server user.', E_USER_ERROR);
    58|             return false;
    59|         }
    60|         $_auto_id = $smarty->_get_auto_id($params['cache_id'], $params['compile_id']);
    61|         $_cache_file = $smarty->_get_auto_filename($smarty->cache_dir, $params['tpl_file'], $_auto_id);
    62|         $_params = array('filename' => $_cache_file, 'contents' => $params['results'], 'create_dirs' => true);
    63|         require_once(SMARTY_CORE_DIR . 'core.write_file.php');
    64|         smarty_core_write_file($_params, $smarty);
    65|         return true;
    66|     }
    67| }
    68| /* vim: set expandtab: */
    69| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.write_compiled_include.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-72 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Extract non-cacheable parts out of compiled template and write it
     9|  *
    10|  * @param string $compile_path
    11|  * @param string $template_compiled
    12|  * @return boolean
    13|  */
    14| function smarty_core_write_compiled_include($params, &$smarty)
    15| {
    16|     $_tag_start = 'if \(\$this->caching && \!\$this->_cache_including\)\: echo \'\{nocache\:('.$params['cache_serial'].')#(\d+)\}\'; endif;';
    17|     $_tag_end   = 'if \(\$this->caching && \!\$this->_cache_including\)\: echo \'\{/nocache\:(\\2)#(\\3)\}\'; endif;';
    18|     preg_match_all('!('.$_tag_start.'(.*)'.$_tag_end.')!Us',
    19|                    $params['compiled_content'], $_match_source, PREG_SET_ORDER);
    20|     if (count($_match_source)==0) return;
    21|     $_include_compiled =  "<?php /* Smarty version ".$smarty->_version.", created on ".strftime("%Y-%m-%d %H:%M:%S")."\n";
    22|     $_include_compiled .= "         compiled from " . strtr(urlencode($params['resource_name']), array('%2F'=>'/', '%3A'=>':')) . " */\n\n";
    23|     $_compile_path = $params['include_file_path'];
    24|     $smarty->_cache_serials[$_compile_path] = $params['cache_serial'];
    25|     $_include_compiled .= "\$this->_cache_serials['".$_compile_path."'] = '".$params['cache_serial']."';\n\n?>";
    26|     $_include_compiled .= $params['plugins_code'];
    27|     $_include_compiled .= "<?php";
    28|     $this_varname = ((double)phpversion() >= 5.0) ? '_smarty' : 'this';
    29|     for ($_i = 0, $_for_max = count($_match_source); $_i < $_for_max; $_i++) {
    30|         $_match =& $_match_source[$_i];
    31|         $source = $_match[4];
    32|         if ($this_varname == '_smarty') {
    33|             /* rename $this to $_smarty in the sourcecode */
    34|             $tokens = token_get_all('<?php ' . $_match[4]);
    35|             /* remove trailing <?php */
    36|             $open_tag = '';
    37|             while ($tokens) {
    38|                 $token = array_shift($tokens);
    39|                 if (is_array($token)) {
    40|                     $open_tag .= $token[1];
    41|                 } else {
    42|                     $open_tag .= $token;
    43|                 }
    44|                 if ($open_tag == '<?php ') break;
    45|             }
    46|             for ($i=0, $count = count($tokens); $i < $count; $i++) {
    47|                 if (is_array($tokens[$i])) {
    48|                     if ($tokens[$i][0] == T_VARIABLE && $tokens[$i][1] == '$this') {
    49|                         $tokens[$i] = '$' . $this_varname;
    50|                     } else {
    51|                         $tokens[$i] = $tokens[$i][1];
    52|                     }                   
    53|                 }
    54|             }
    55|             $source = implode('', $tokens);
    56|         }
    57|         /* add function to compiled include */
    58|         $_include_compiled .= "
    59| function _smarty_tplfunc_$_match[2]_$_match[3](&\$$this_varname)
    60| {
    61| $source
    62| }
    63| ";
    64|     }
    65|     $_include_compiled .= "\n\n?>\n";
    66|     $_params = array('filename' => $_compile_path,
    67|                      'contents' => $_include_compiled, 'create_dirs' => true);
    68|     require_once(SMARTY_CORE_DIR . 'core.write_file.php');
    69|     smarty_core_write_file($_params, $smarty);
    70|     return true;
    71| }
    72| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.write_compiled_resource.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-30 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * write the compiled resource
     9|  *
    10|  * @param string $compile_path
    11|  * @param string $compiled_content
    12|  * @return true
    13|  */
    14| function smarty_core_write_compiled_resource($params, &$smarty)
    15| {
    16|     if(!@is_writable($smarty->compile_dir)) {
    17|         if(!@is_dir($smarty->compile_dir)) {
    18|             $smarty->trigger_error('the $compile_dir \'' . $smarty->compile_dir . '\' does not exist, or is not a directory.', E_USER_ERROR);
    19|             return false;
    20|         }
    21|         $smarty->trigger_error('unable to write to $compile_dir \'' . realpath($smarty->compile_dir) . '\'. Be sure $compile_dir is writable by the web server user.', E_USER_ERROR);
    22|         return false;
    23|     }
    24|     $_params = array('filename' => $params['compile_path'], 'contents' => $params['compiled_content'], 'create_dirs' => true);
    25|     require_once(SMARTY_CORE_DIR . 'core.write_file.php');
    26|     smarty_core_write_file($_params, $smarty);
    27|     return true;
    28| }
    29| /* vim: set expandtab: */
    30| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/internals/core.write_file.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-41 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * write out a file to disk
     9|  *
    10|  * @param string $filename
    11|  * @param string $contents
    12|  * @param boolean $create_dirs
    13|  * @return boolean
    14|  */
    15| function smarty_core_write_file($params, &$smarty)
    16| {
    17|     $_dirname = dirname($params['filename']);
    18|     if ($params['create_dirs']) {
    19|         $_params = array('dir' => $_dirname);
    20|         require_once(SMARTY_CORE_DIR . 'core.create_dir_structure.php');
    21|         smarty_core_create_dir_structure($_params, $smarty);
    22|     }
    23|     $_tmp_file = tempnam($_dirname, 'wrt');
    24|     if (!($fd = @fopen($_tmp_file, 'wb'))) {
    25|         $_tmp_file = $_dirname . DIRECTORY_SEPARATOR . uniqid('wrt');
    26|         if (!($fd = @fopen($_tmp_file, 'wb'))) {
    27|             $smarty->trigger_error("problem writing temporary file '$_tmp_file'");
    28|             return false;
    29|         }
    30|     }
    31|     fwrite($fd, $params['contents']);
    32|     fclose($fd);
    33|     if (DIRECTORY_SEPARATOR == '\\' || !@rename($_tmp_file, $params['filename'])) {
    34|         @unlink($params['filename']);
    35|         @rename($_tmp_file, $params['filename']);
    36|     }
    37|     @chmod($params['filename'], $smarty->_file_perms);
    38|     return true;
    39| }
    40| /* vim: set expandtab: */
    41| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/block.t.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-106 ---
     1| <?php
     2| /**
     3|  * block.t.php - Smarty gettext block plugin
     4|  *
     5|  * ------------------------------------------------------------------------- *
     6|  * This library is free software; you can redistribute it and/or             *
     7|  * modify it under the terms of the GNU Lesser General Public                *
     8|  * License as published by the Free Software Foundation; either              *
     9|  * version 2.1 of the License, or (at your option) any later version.        *
    10|  *                                                                           *
    11|  * This library is distributed in the hope that it will be useful,           *
    12|  * but WITHOUT ANY WARRANTY; without even the implied warranty of            *
    13|  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU         *
    14|  * Lesser General Public License for more details.                           *
    15|  *                                                                           *
    16|  * You should have received a copy of the GNU Lesser General Public          *
    17|  * License along with this library; if not, write to the Free Software       *
    18|  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA *
    19|  * ------------------------------------------------------------------------- *
    20|  *
    21|  * Installation: simply copy this file to the smarty plugins directory.
    22|  *
    23|  * @package	smarty-gettext
    24|  * @version	$Id: block.t.php,v 1.1 2005/07/27 17:58:56 sagi Exp $
    25|  * @link	http://smarty-gettext.sourceforge.net/
    26|  * @author	Sagi Bashari <sagi@boom.org.il>
    27|  * @copyright 2004-2005 Sagi Bashari
    28|  */
    29| /**
    30|  * Replaces arguments in a string with their values.
    31|  * Arguments are represented by % followed by their number.
    32|  *
    33|  * @param	string	Source string
    34|  * @param	mixed	Arguments, can be passed in an array or through single variables.
    35|  * @returns	string	Modified string
    36|  */
    37| function smarty_gettext_strarg($str)
    38| {
    39| 	$tr = array();
    40| 	$p = 0;
    41| 	for ($i=1; $i < func_num_args(); $i++) {
    42| 		$arg = func_get_arg($i);
    43| 		if (is_array($arg)) {
    44| 			foreach ($arg as $aarg) {
    45| 				$tr['%'.++$p] = $aarg;
    46| 			}
    47| 		} else {
    48| 			$tr['%'.++$p] = $arg;
    49| 		}
    50| 	}
    51| 	return strtr($str, $tr);
    52| }
    53| /**
    54|  * Smarty block function, provides gettext support for smarty.
    55|  *
    56|  * The block content is the text that should be translated.
    57|  *
    58|  * Any parameter that is sent to the function will be represented as %n in the translation text, 
    59|  * where n is 1 for the first parameter. The following parameters are reserved:
    60|  *   - escape - sets escape mode:
    61|  *       - 'html' for HTML escaping, this is the default.
    62|  *       - 'js' for javascript escaping.
    63|  *       - 'url' for url escaping.
    64|  *       - 'no'/'off'/0 - turns off escaping
    65|  *   - plural - The plural version of the text (2nd parameter of ngettext())
    66|  *   - count - The item count for plural mode (3rd parameter of ngettext())
    67|  */
    68| function smarty_block_t($params, $text, &$smarty)
    69| {
    70| 	$text = stripslashes($text);
    71| 	if (isset($params['escape'])) {
    72| 		$escape = $params['escape'];
    73| 		unset($params['escape']);
    74| 	}
    75| 	if (isset($params['plural'])) {
    76| 		$plural = $params['plural'];
    77| 		unset($params['plural']);
    78| 		if (isset($params['count'])) {
    79| 			$count = $params['count'];
    80| 			unset($params['count']);
    81| 		}
    82| 	}
    83| 	if (isset($count) && isset($plural)) {
    84| 		$text = ngettext($text, $plural, $count);
    85| 	} else { // use normal
    86| 		$text = gettext($text);
    87| 	}
    88| 	if (count($params)) {
    89| 		$text = smarty_gettext_strarg($text, $params);
    90| 	}
    91| 	if (!isset($escape) || $escape == 'html') { // html escape, default
    92| 	   $text = nl2br(htmlspecialchars($text));
    93|    } elseif (isset($escape)) {
    94| 		switch ($escape) {
    95| 			case 'javascript':
    96| 			case 'js':
    97| 				$text = str_replace('\'', '\\\'', stripslashes($text));
    98| 				break;
    99| 			case 'url':
   100| 				$text = urlencode($text);
   101| 				break;
   102| 		}
   103| 	}
   104| 	return $text;
   105| }
   106| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/block.textformat.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-85 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {textformat}{/textformat} block plugin
     9|  *
    10|  * Type:     block function<br />
    11|  * Name:     textformat<br />
    12|  * Purpose:  format text a certain way with preset styles
    13|  *           or custom wrap/indent settings<br />
    14|  * @link http://smarty.php.net/manual/en/language.function.textformat.php {textformat}
    15|  *       (Smarty online manual)
    16|  * @param array
    17|  * <pre>
    18|  * Params:   style: string (email)
    19|  *           indent: integer (0)
    20|  *           wrap: integer (80)
    21|  *           wrap_char string ("\n")
    22|  *           indent_char: string (" ")
    23|  *           wrap_boundary: boolean (true)
    24|  * </pre>
    25|  * @author Monte Ohrt <monte at ohrt dot com>
    26|  * @param string contents of the block
    27|  * @param Smarty clever simulation of a method
    28|  * @return string string $content re-formatted
    29|  */
    30| function smarty_block_textformat($params, $content, &$smarty)
    31| {
    32|     if (is_null($content)) {
    33|         return;
    34|     }
    35|     $style = null;
    36|     $indent = 0;
    37|     $indent_first = 0;
    38|     $indent_char = ' ';
    39|     $wrap = 80;
    40|     $wrap_char = "\n";
    41|     $wrap_cut = false;
    42|     $assign = null;
    43|     foreach ($params as $_key => $_val) {
    44|         switch ($_key) {
    45|             case 'style':
    46|             case 'indent_char':
    47|             case 'wrap_char':
    48|             case 'assign':
    49|                 $$_key = (string)$_val;
    50|                 break;
    51|             case 'indent':
    52|             case 'indent_first':
    53|             case 'wrap':
    54|                 $$_key = (int)$_val;
    55|                 break;
    56|             case 'wrap_cut':
    57|                 $$_key = (bool)$_val;
    58|                 break;
    59|             default:
    60|                 $smarty->trigger_error("textformat: unknown attribute '$_key'");
    61|         }
    62|     }
    63|     if ($style == 'email') {
    64|         $wrap = 72;
    65|     }
    66|     $_paragraphs = preg_split('![\r\n][\r\n]!',$content);
    67|     $_output = '';
    68|     for($_x = 0, $_y = count($_paragraphs); $_x < $_y; $_x++) {
    69|         if ($_paragraphs[$_x] == '') {
    70|             continue;
    71|         }
    72|         $_paragraphs[$_x] = preg_replace(array('!\s+!','!(^\s+)|(\s+$)!'), array(' ',''), $_paragraphs[$_x]);
    73|         if($indent_first > 0) {
    74|             $_paragraphs[$_x] = str_repeat($indent_char, $indent_first) . $_paragraphs[$_x];
    75|         }
    76|         $_paragraphs[$_x] = wordwrap($_paragraphs[$_x], $wrap - $indent, $wrap_char, $wrap_cut);
    77|         if($indent > 0) {
    78|             $_paragraphs[$_x] = preg_replace('!^!m', str_repeat($indent_char, $indent), $_paragraphs[$_x]);
    79|         }
    80|     }
    81|     $_output = implode($wrap_char . $wrap_char, $_paragraphs);
    82|     return $assign ? $smarty->assign($assign, $_output) : $_output;
    83| }
    84| /* vim: set expandtab: */
    85| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/compiler.assign.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-34 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {assign} compiler function plugin
     9|  *
    10|  * Type:     compiler function<br />
    11|  * Name:     assign<br />
    12|  * Purpose:  assign a value to a template variable
    13|  * @link http://smarty.php.net/manual/en/language.custom.functions.php#LANGUAGE.FUNCTION.ASSIGN {assign}
    14|  *       (Smarty online manual)
    15|  * @author Monte Ohrt <monte at ohrt dot com> (initial author)
    16|  * @auther messju mohr <messju at lammfellpuschen dot de> (conversion to compiler function)
    17|  * @param string containing var-attribute and value-attribute
    18|  * @param Smarty_Compiler
    19|  */
    20| function smarty_compiler_assign($tag_attrs, &$compiler)
    21| {
    22|     $_params = $compiler->_parse_attrs($tag_attrs);
    23|     if (!isset($_params['var'])) {
    24|         $compiler->_syntax_error("assign: missing 'var' parameter", E_USER_WARNING);
    25|         return;
    26|     }
    27|     if (!isset($_params['value'])) {
    28|         $compiler->_syntax_error("assign: missing 'value' parameter", E_USER_WARNING);
    29|         return;
    30|     }
    31|     return "\$this->assign({$_params['var']}, {$_params['value']});";
    32| }
    33| /* vim: set expandtab: */
    34| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.assign_debug_info.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-34 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {assign_debug_info} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     assign_debug_info<br />
    12|  * Purpose:  assign debug info to the template<br />
    13|  * @author Monte Ohrt <monte at ohrt dot com>
    14|  * @param array unused in this plugin, this plugin uses {@link Smarty::$_config},
    15|  *              {@link Smarty::$_tpl_vars} and {@link Smarty::$_smarty_debug_info}
    16|  * @param Smarty
    17|  */
    18| function smarty_function_assign_debug_info($params, &$smarty)
    19| {
    20|     $assigned_vars = $smarty->_tpl_vars;
    21|     ksort($assigned_vars);
    22|     if (@is_array($smarty->_config[0])) {
    23|         $config_vars = $smarty->_config[0];
    24|         ksort($config_vars);
    25|         $smarty->assign("_debug_config_keys", array_keys($config_vars));
    26|         $smarty->assign("_debug_config_vals", array_values($config_vars));
    27|     }
    28|     $included_templates = $smarty->_smarty_debug_info;
    29|     $smarty->assign("_debug_keys", array_keys($assigned_vars));
    30|     $smarty->assign("_debug_vals", array_values($assigned_vars));
    31|     $smarty->assign("_debug_tpls", $included_templates);
    32| }
    33| /* vim: set expandtab: */
    34| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.config_load.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-126 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {config_load} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     config_load<br />
    12|  * Purpose:  load config file vars
    13|  * @link http://smarty.php.net/manual/en/language.function.config.load.php {config_load}
    14|  *       (Smarty online manual)
    15|  * @author Monte Ohrt <monte at ohrt dot com>
    16|  * @author messju mohr <messju at lammfellpuschen dot de> (added use of resources)
    17|  * @param array Format:
    18|  * <pre>
    19|  * array('file' => required config file name,
    20|  *       'section' => optional config file section to load
    21|  *       'scope' => local/parent/global
    22|  *       'global' => overrides scope, setting to parent if true)
    23|  * </pre>
    24|  * @param Smarty
    25|  */
    26| function smarty_function_config_load($params, &$smarty)
    27| {
    28|         if ($smarty->debugging) {
    29|             $_params = array();
    30|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
    31|             $_debug_start_time = smarty_core_get_microtime($_params, $smarty);
    32|         }
    33|         $_file = isset($params['file']) ? $smarty->_dequote($params['file']) : null;
    34|         $_section = isset($params['section']) ? $smarty->_dequote($params['section']) : null;
    35|         $_scope = isset($params['scope']) ? $smarty->_dequote($params['scope']) : 'global';
    36|         $_global = isset($params['global']) ? $smarty->_dequote($params['global']) : false;
    37|         if (!isset($_file) || strlen($_file) == 0) {
    38|             $smarty->trigger_error("missing 'file' attribute in config_load tag", E_USER_ERROR, __FILE__, __LINE__);
    39|         }
    40|         if (isset($_scope)) {
    41|             if ($_scope != 'local' &&
    42|                 $_scope != 'parent' &&
    43|                 $_scope != 'global') {
    44|                 $smarty->trigger_error("invalid 'scope' attribute value", E_USER_ERROR, __FILE__, __LINE__);
    45|             }
    46|         } else {
    47|             if ($_global) {
    48|                 $_scope = 'parent';
    49|             } else {
    50|                 $_scope = 'local';
    51|             }
    52|         }
    53|         $_params = array('resource_name' => $_file,
    54|                          'resource_base_path' => $smarty->config_dir,
    55|                          'get_source' => false);
    56|         $smarty->_parse_resource_name($_params);
    57|         $_file_path = $_params['resource_type'] . ':' . $_params['resource_name'];
    58|         if (isset($_section))
    59|             $_compile_file = $smarty->_get_compile_path($_file_path.'|'.$_section);
    60|         else
    61|             $_compile_file = $smarty->_get_compile_path($_file_path);
    62|         if($smarty->force_compile || !file_exists($_compile_file)) {
    63|             $_compile = true;
    64|         } elseif ($smarty->compile_check) {
    65|             $_params = array('resource_name' => $_file,
    66|                              'resource_base_path' => $smarty->config_dir,
    67|                              'get_source' => false);
    68|             $_compile = $smarty->_fetch_resource_info($_params) &&
    69|                 $_params['resource_timestamp'] > filemtime($_compile_file);
    70|         } else {
    71|             $_compile = false;
    72|         }
    73|         if($_compile) {
    74|             if(!is_object($smarty->_conf_obj)) {
    75|                 require_once SMARTY_DIR . $smarty->config_class . '.class.php';
    76|                 $smarty->_conf_obj = new $smarty->config_class();
    77|                 $smarty->_conf_obj->overwrite = $smarty->config_overwrite;
    78|                 $smarty->_conf_obj->booleanize = $smarty->config_booleanize;
    79|                 $smarty->_conf_obj->read_hidden = $smarty->config_read_hidden;
    80|                 $smarty->_conf_obj->fix_newlines = $smarty->config_fix_newlines;
    81|             }
    82|             $_params = array('resource_name' => $_file,
    83|                              'resource_base_path' => $smarty->config_dir,
    84|                              $_params['get_source'] = true);
    85|             if (!$smarty->_fetch_resource_info($_params)) {
    86|                 return;
    87|             }
    88|             $smarty->_conf_obj->set_file_contents($_file, $_params['source_content']);
    89|             $_config_vars = array_merge($smarty->_conf_obj->get($_file),
    90|                     $smarty->_conf_obj->get($_file, $_section));
    91|             if(function_exists('var_export')) {
    92|                 $_output = '<?php $_config_vars = ' . var_export($_config_vars, true) . '; ?>';
    93|             } else {
    94|                 $_output = '<?php $_config_vars = unserialize(\'' . strtr(serialize($_config_vars),array('\''=>'\\\'', '\\'=>'\\\\')) . '\'); ?>';
    95|             }
    96|             $_params = (array('compile_path' => $_compile_file, 'compiled_content' => $_output, 'resource_timestamp' => $_params['resource_timestamp']));
    97|             require_once(SMARTY_CORE_DIR . 'core.write_compiled_resource.php');
    98|             smarty_core_write_compiled_resource($_params, $smarty);
    99|         } else {
   100|             include($_compile_file);
   101|         }
   102|         if ($smarty->caching) {
   103|             $smarty->_cache_info['config'][$_file] = true;
   104|         }
   105|         $smarty->_config[0]['vars'] = @array_merge($smarty->_config[0]['vars'], $_config_vars);
   106|         $smarty->_config[0]['files'][$_file] = true;
   107|         if ($_scope == 'parent') {
   108|                 $smarty->_config[1]['vars'] = @array_merge($smarty->_config[1]['vars'], $_config_vars);
   109|                 $smarty->_config[1]['files'][$_file] = true;
   110|         } else if ($_scope == 'global') {
   111|             for ($i = 1, $for_max = count($smarty->_config); $i < $for_max; $i++) {
   112|                 $smarty->_config[$i]['vars'] = @array_merge($smarty->_config[$i]['vars'], $_config_vars);
   113|                 $smarty->_config[$i]['files'][$_file] = true;
   114|             }
   115|         }
   116|         if ($smarty->debugging) {
   117|             $_params = array();
   118|             require_once(SMARTY_CORE_DIR . 'core.get_microtime.php');
   119|             $smarty->_smarty_debug_info[] = array('type'      => 'config',
   120|                                                 'filename'  => $_file.' ['.$_section.'] '.$_scope,
   121|                                                 'depth'     => $smarty->_inclusion_depth,
   122|                                                 'exec_time' => smarty_core_get_microtime($_params, $smarty) - $_debug_start_time);
   123|         }
   124| }
   125| /* vim: set expandtab: */
   126| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.counter.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-65 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {counter} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     counter<br />
    12|  * Purpose:  print out a counter value
    13|  * @author Monte Ohrt <monte at ohrt dot com>
    14|  * @link http://smarty.php.net/manual/en/language.function.counter.php {counter}
    15|  *       (Smarty online manual)
    16|  * @param array parameters
    17|  * @param Smarty
    18|  * @return string|null
    19|  */
    20| function smarty_function_counter($params, &$smarty)
    21| {
    22|     static $counters = array();
    23|     $name = (isset($params['name'])) ? $params['name'] : 'default';
    24|     if (!isset($counters[$name])) {
    25|         $counters[$name] = array(
    26|             'start'=>1,
    27|             'skip'=>1,
    28|             'direction'=>'up',
    29|             'count'=>1
    30|             );
    31|     }
    32|     $counter =& $counters[$name];
    33|     if (isset($params['start'])) {
    34|         $counter['start'] = $counter['count'] = (int)$params['start'];
    35|     }
    36|     if (!empty($params['assign'])) {
    37|         $counter['assign'] = $params['assign'];
    38|     }
    39|     if (isset($counter['assign'])) {
    40|         $smarty->assign($counter['assign'], $counter['count']);
    41|     }
    42|     if (isset($params['print'])) {
    43|         $print = (bool)$params['print'];
    44|     } else {
    45|         $print = empty($counter['assign']);
    46|     }
    47|     if ($print) {
    48|         $retval = $counter['count'];
    49|     } else {
    50|         $retval = null;
    51|     }
    52|     if (isset($params['skip'])) {
    53|         $counter['skip'] = $params['skip'];
    54|     }
    55|     if (isset($params['direction'])) {
    56|         $counter['direction'] = $params['direction'];
    57|     }
    58|     if ($counter['direction'] == "down")
    59|         $counter['count'] -= $counter['skip'];
    60|     else
    61|         $counter['count'] += $counter['skip'];
    62|     return $retval;
    63| }
    64| /* vim: set expandtab: */
    65| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.cycle.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-90 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {cycle} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     cycle<br />
    12|  * Date:     May 3, 2002<br />
    13|  * Purpose:  cycle through given values<br />
    14|  * Input:
    15|  *         - name = name of cycle (optional)
    16|  *         - values = comma separated list of values to cycle,
    17|  *                    or an array of values to cycle
    18|  *                    (this can be left out for subsequent calls)
    19|  *         - reset = boolean - resets given var to true
    20|  *         - print = boolean - print var or not. default is true
    21|  *         - advance = boolean - whether or not to advance the cycle
    22|  *         - delimiter = the value delimiter, default is ","
    23|  *         - assign = boolean, assigns to template var instead of
    24|  *                    printed.
    25|  *
    26|  * Examples:<br />
    27|  * <pre>
    28|  * {cycle values="#eeeeee,#d0d0d0d"}
    29|  * {cycle name=row values="one,two,three" reset=true}
    30|  * {cycle name=row}
    31|  * </pre>
    32|  * @link http://smarty.php.net/manual/en/language.function.cycle.php {cycle}
    33|  *       (Smarty online manual)
    34|  * @author Monte Ohrt <monte at ohrt dot com>
    35|  * @author credit to Mark Priatel <mpriatel@rogers.com>
    36|  * @author credit to Gerard <gerard@interfold.com>
    37|  * @author credit to Jason Sweat <jsweat_php@yahoo.com>
    38|  * @version  1.3
    39|  * @param array
    40|  * @param Smarty
    41|  * @return string|null
    42|  */
    43| function smarty_function_cycle($params, &$smarty)
    44| {
    45|     static $cycle_vars;
    46|     $name = (empty($params['name'])) ? 'default' : $params['name'];
    47|     $print = (isset($params['print'])) ? (bool)$params['print'] : true;
    48|     $advance = (isset($params['advance'])) ? (bool)$params['advance'] : true;
    49|     $reset = (isset($params['reset'])) ? (bool)$params['reset'] : false;
    50|     if (!in_array('values', array_keys($params))) {
    51|         if(!isset($cycle_vars[$name]['values'])) {
    52|             $smarty->trigger_error("cycle: missing 'values' parameter");
    53|             return;
    54|         }
    55|     } else {
    56|         if(isset($cycle_vars[$name]['values'])
    57|             && $cycle_vars[$name]['values'] != $params['values'] ) {
    58|             $cycle_vars[$name]['index'] = 0;
    59|         }
    60|         $cycle_vars[$name]['values'] = $params['values'];
    61|     }
    62|     $cycle_vars[$name]['delimiter'] = (isset($params['delimiter'])) ? $params['delimiter'] : ',';
    63|     if(is_array($cycle_vars[$name]['values'])) {
    64|         $cycle_array = $cycle_vars[$name]['values'];
    65|     } else {
    66|         $cycle_array = explode($cycle_vars[$name]['delimiter'],$cycle_vars[$name]['values']);
    67|     }
    68|     if(!isset($cycle_vars[$name]['index']) || $reset ) {
    69|         $cycle_vars[$name]['index'] = 0;
    70|     }
    71|     if (isset($params['assign'])) {
    72|         $print = false;
    73|         $smarty->assign($params['assign'], $cycle_array[$cycle_vars[$name]['index']]);
    74|     }
    75|     if($print) {
    76|         $retval = $cycle_array[$cycle_vars[$name]['index']];
    77|     } else {
    78|         $retval = null;
    79|     }
    80|     if($advance) {
    81|         if ( $cycle_vars[$name]['index'] >= count($cycle_array) -1 ) {
    82|             $cycle_vars[$name]['index'] = 0;
    83|         } else {
    84|             $cycle_vars[$name]['index']++;
    85|         }
    86|     }
    87|     return $retval;
    88| }
    89| /* vim: set expandtab: */
    90| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.debug.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-31 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {debug} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     debug<br />
    12|  * Date:     July 1, 2002<br />
    13|  * Purpose:  popup debug window
    14|  * @link http://smarty.php.net/manual/en/language.function.debug.php {debug}
    15|  *       (Smarty online manual)
    16|  * @author   Monte Ohrt <monte at ohrt dot com>
    17|  * @version  1.0
    18|  * @param array
    19|  * @param Smarty
    20|  * @return string output from {@link Smarty::_generate_debug_output()}
    21|  */
    22| function smarty_function_debug($params, &$smarty)
    23| {
    24|     if (isset($params['output'])) {
    25|         $smarty->assign('_smarty_debug_output', $params['output']);
    26|     }
    27|     require_once(SMARTY_CORE_DIR . 'core.display_debug_console.php');
    28|     return smarty_core_display_debug_console(null, $smarty);
    29| }
    30| /* vim: set expandtab: */
    31| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.eval.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-40 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {eval} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     eval<br />
    12|  * Purpose:  evaluate a template variable as a template<br />
    13|  * @link http://smarty.php.net/manual/en/language.function.eval.php {eval}
    14|  *       (Smarty online manual)
    15|  * @author Monte Ohrt <monte at ohrt dot com>
    16|  * @param array
    17|  * @param Smarty
    18|  */
    19| function smarty_function_eval($params, &$smarty)
    20| {
    21|     if (!isset($params['var'])) {
    22|         $smarty->trigger_error("eval: missing 'var' parameter");
    23|         return;
    24|     }
    25|     if($params['var'] == '') {
    26|         return;
    27|     }
    28|     $smarty->_compile_source('evaluated template', $params['var'], $_var_compiled);
    29|     ob_start();
    30|     $smarty->_eval('?>' . $_var_compiled);
    31|     $_contents = ob_get_contents();
    32|     ob_end_clean();
    33|     if (!empty($params['assign'])) {
    34|         $smarty->assign($params['assign'], $_contents);
    35|     } else {
    36|         return $_contents;
    37|     }
    38| }
    39| /* vim: set expandtab: */
    40| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.fetch.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-202 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {fetch} plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     fetch<br />
    12|  * Purpose:  fetch file, web or ftp data and display results
    13|  * @link http://smarty.php.net/manual/en/language.function.fetch.php {fetch}
    14|  *       (Smarty online manual)
    15|  * @author Monte Ohrt <monte at ohrt dot com>
    16|  * @param array
    17|  * @param Smarty
    18|  * @return string|null if the assign parameter is passed, Smarty assigns the
    19|  *                     result to a template variable
    20|  */
    21| function smarty_function_fetch($params, &$smarty)
    22| {
    23|     if (empty($params['file'])) {
    24|         $smarty->_trigger_fatal_error("[plugin] parameter 'file' cannot be empty");
    25|         return;
    26|     }
    27|     $content = '';
    28|     if ($smarty->security && !preg_match('!^(http|ftp)://!i', $params['file'])) {
    29|         $_params = array('resource_type' => 'file', 'resource_name' => $params['file']);
    30|         require_once(SMARTY_CORE_DIR . 'core.is_secure.php');
    31|         if(!smarty_core_is_secure($_params, $smarty)) {
    32|             $smarty->_trigger_fatal_error('[plugin] (secure mode) fetch \'' . $params['file'] . '\' is not allowed');
    33|             return;
    34|         }
    35|         if($fp = @fopen($params['file'],'r')) {
    36|             while(!feof($fp)) {
    37|                 $content .= fgets ($fp,4096);
    38|             }
    39|             fclose($fp);
    40|         } else {
    41|             $smarty->_trigger_fatal_error('[plugin] fetch cannot read file \'' . $params['file'] . '\'');
    42|             return;
    43|         }
    44|     } else {
    45|         if(preg_match('!^http://!i',$params['file'])) {
    46|             if($uri_parts = parse_url($params['file'])) {
    47|                 $host = $server_name = $uri_parts['host'];
    48|                 $timeout = 30;
    49|                 $accept = "image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*";
    50|                 $agent = "Smarty Template Engine ".$smarty->_version;
    51|                 $referer = "";
    52|                 $uri = !empty($uri_parts['path']) ? $uri_parts['path'] : '/';
    53|                 $uri .= !empty($uri_parts['query']) ? '?' . $uri_parts['query'] : '';
    54|                 $_is_proxy = false;
    55|                 if(empty($uri_parts['port'])) {
    56|                     $port = 80;
    57|                 } else {
    58|                     $port = $uri_parts['port'];
    59|                 }
    60|                 if(!empty($uri_parts['user'])) {
    61|                     $user = $uri_parts['user'];
    62|                 }
    63|                 if(!empty($uri_parts['pass'])) {
    64|                     $pass = $uri_parts['pass'];
    65|                 }
    66|                 foreach($params as $param_key => $param_value) {
    67|                     switch($param_key) {
    68|                         case "file":
    69|                         case "assign":
    70|                         case "assign_headers":
    71|                             break;
    72|                         case "user":
    73|                             if(!empty($param_value)) {
    74|                                 $user = $param_value;
    75|                             }
    76|                             break;
    77|                         case "pass":
    78|                             if(!empty($param_value)) {
    79|                                 $pass = $param_value;
    80|                             }
    81|                             break;
    82|                         case "accept":
    83|                             if(!empty($param_value)) {
    84|                                 $accept = $param_value;
    85|                             }
    86|                             break;
    87|                         case "header":
    88|                             if(!empty($param_value)) {
    89|                                 if(!preg_match('![\w\d-]+: .+!',$param_value)) {
    90|                                     $smarty->_trigger_fatal_error("[plugin] invalid header format '".$param_value."'");
    91|                                     return;
    92|                                 } else {
    93|                                     $extra_headers[] = $param_value;
    94|                                 }
    95|                             }
    96|                             break;
    97|                         case "proxy_host":
    98|                             if(!empty($param_value)) {
    99|                                 $proxy_host = $param_value;
   100|                             }
   101|                             break;
   102|                         case "proxy_port":
   103|                             if(!preg_match('!\D!', $param_value)) {
   104|                                 $proxy_port = (int) $param_value;
   105|                             } else {
   106|                                 $smarty->_trigger_fatal_error("[plugin] invalid value for attribute '".$param_key."'");
   107|                                 return;
   108|                             }
   109|                             break;
   110|                         case "agent":
   111|                             if(!empty($param_value)) {
   112|                                 $agent = $param_value;
   113|                             }
   114|                             break;
   115|                         case "referer":
   116|                             if(!empty($param_value)) {
   117|                                 $referer = $param_value;
   118|                             }
   119|                             break;
   120|                         case "timeout":
   121|                             if(!preg_match('!\D!', $param_value)) {
   122|                                 $timeout = (int) $param_value;
   123|                             } else {
   124|                                 $smarty->_trigger_fatal_error("[plugin] invalid value for attribute '".$param_key."'");
   125|                                 return;
   126|                             }
   127|                             break;
   128|                         default:
   129|                             $smarty->_trigger_fatal_error("[plugin] unrecognized attribute '".$param_key."'");
   130|                             return;
   131|                     }
   132|                 }
   133|                 if(!empty($proxy_host) && !empty($proxy_port)) {
   134|                     $_is_proxy = true;
   135|                     $fp = fsockopen($proxy_host,$proxy_port,$errno,$errstr,$timeout);
   136|                 } else {
   137|                     $fp = fsockopen($server_name,$port,$errno,$errstr,$timeout);
   138|                 }
   139|                 if(!$fp) {
   140|                     $smarty->_trigger_fatal_error("[plugin] unable to fetch: $errstr ($errno)");
   141|                     return;
   142|                 } else {
   143|                     if($_is_proxy) {
   144|                         fputs($fp, 'GET ' . $params['file'] . " HTTP/1.0\r\n");
   145|                     } else {
   146|                         fputs($fp, "GET $uri HTTP/1.0\r\n");
   147|                     }
   148|                     if(!empty($host)) {
   149|                         fputs($fp, "Host: $host\r\n");
   150|                     }
   151|                     if(!empty($accept)) {
   152|                         fputs($fp, "Accept: $accept\r\n");
   153|                     }
   154|                     if(!empty($agent)) {
   155|                         fputs($fp, "User-Agent: $agent\r\n");
   156|                     }
   157|                     if(!empty($referer)) {
   158|                         fputs($fp, "Referer: $referer\r\n");
   159|                     }
   160|                     if(isset($extra_headers) && is_array($extra_headers)) {
   161|                         foreach($extra_headers as $curr_header) {
   162|                             fputs($fp, $curr_header."\r\n");
   163|                         }
   164|                     }
   165|                     if(!empty($user) && !empty($pass)) {
   166|                         fputs($fp, "Authorization: BASIC ".base64_encode("$user:$pass")."\r\n");
   167|                     }
   168|                     fputs($fp, "\r\n");
   169|                     while(!feof($fp)) {
   170|                         $content .= fgets($fp,4096);
   171|                     }
   172|                     fclose($fp);
   173|                     $csplit = split("\r\n\r\n",$content,2);
   174|                     $content = $csplit[1];
   175|                     if(!empty($params['assign_headers'])) {
   176|                         $smarty->assign($params['assign_headers'],split("\r\n",$csplit[0]));
   177|                     }
   178|                 }
   179|             } else {
   180|                 $smarty->_trigger_fatal_error("[plugin] unable to parse URL, check syntax");
   181|                 return;
   182|             }
   183|         } else {
   184|             if($fp = @fopen($params['file'],'r')) {
   185|                 while(!feof($fp)) {
   186|                     $content .= fgets ($fp,4096);
   187|                 }
   188|                 fclose($fp);
   189|             } else {
   190|                 $smarty->_trigger_fatal_error('[plugin] fetch cannot read file \'' . $params['file'] .'\'');
   191|                 return;
   192|             }
   193|         }
   194|     }
   195|     if (!empty($params['assign'])) {
   196|         $smarty->assign($params['assign'],$content);
   197|     } else {
   198|         return $content;
   199|     }
   200| }
   201| /* vim: set expandtab: */
   202| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_checkboxes.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-118 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_checkboxes} function plugin
     9|  *
    10|  * File:       function.html_checkboxes.php<br />
    11|  * Type:       function<br />
    12|  * Name:       html_checkboxes<br />
    13|  * Date:       24.Feb.2003<br />
    14|  * Purpose:    Prints out a list of checkbox input types<br />
    15|  * Input:<br />
    16|  *           - name       (optional) - string default "checkbox"
    17|  *           - values     (required) - array
    18|  *           - options    (optional) - associative array
    19|  *           - checked    (optional) - array default not set
    20|  *           - separator  (optional) - ie <br /> or &nbsp;
    21|  *           - output     (optional) - the output next to each checkbox
    22|  *           - assign     (optional) - assign the output as an array to this variable
    23|  * Examples:
    24|  * <pre>
    25|  * {html_checkboxes values=$ids output=$names}
    26|  * {html_checkboxes values=$ids name='box' separator='<br />' output=$names}
    27|  * {html_checkboxes values=$ids checked=$checked separator='<br />' output=$names}
    28|  * </pre>
    29|  * @link http://smarty.php.net/manual/en/language.function.html.checkboxes.php {html_checkboxes}
    30|  *      (Smarty online manual)
    31|  * @author     Christopher Kvarme <christopher.kvarme@flashjab.com>
    32|  * @author credits to Monte Ohrt <monte at ohrt dot com>
    33|  * @version    1.0
    34|  * @param array
    35|  * @param Smarty
    36|  * @return string
    37|  * @uses smarty_function_escape_special_chars()
    38|  */
    39| function smarty_function_html_checkboxes($params, &$smarty)
    40| {
    41|     require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    42|     $name = 'checkbox';
    43|     $values = null;
    44|     $options = null;
    45|     $selected = null;
    46|     $separator = '';
    47|     $labels = true;
    48|     $output = null;
    49|     $extra = '';
    50|     foreach($params as $_key => $_val) {
    51|         switch($_key) {
    52|             case 'name':
    53|             case 'separator':
    54|                 $$_key = $_val;
    55|                 break;
    56|             case 'labels':
    57|                 $$_key = (bool)$_val;
    58|                 break;
    59|             case 'options':
    60|                 $$_key = (array)$_val;
    61|                 break;
    62|             case 'values':
    63|             case 'output':
    64|                 $$_key = array_values((array)$_val);
    65|                 break;
    66|             case 'checked':
    67|             case 'selected':
    68|                 $selected = array_map('strval', array_values((array)$_val));
    69|                 break;
    70|             case 'checkboxes':
    71|                 $smarty->trigger_error('html_checkboxes: the use of the "checkboxes" attribute is deprecated, use "options" instead', E_USER_WARNING);
    72|                 $options = (array)$_val;
    73|                 break;
    74|             case 'assign':
    75|                 break;
    76|             default:
    77|                 if(!is_array($_val)) {
    78|                     $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
    79|                 } else {
    80|                     $smarty->trigger_error("html_checkboxes: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
    81|                 }
    82|                 break;
    83|         }
    84|     }
    85|     if (!isset($options) && !isset($values))
    86|         return ''; /* raise error here? */
    87|     settype($selected, 'array');
    88|     $_html_result = array();
    89|     if (isset($options)) {
    90|         foreach ($options as $_key=>$_val)
    91|             $_html_result[] = smarty_function_html_checkboxes_output($name, $_key, $_val, $selected, $extra, $separator, $labels);
    92|     } else {
    93|         foreach ($values as $_i=>$_key) {
    94|             $_val = isset($output[$_i]) ? $output[$_i] : '';
    95|             $_html_result[] = smarty_function_html_checkboxes_output($name, $_key, $_val, $selected, $extra, $separator, $labels);
    96|         }
    97|     }
    98|     if(!empty($params['assign'])) {
    99|         $smarty->assign($params['assign'], $_html_result);
   100|     } else {
   101|         return implode("\n",$_html_result);
   102|     }
   103| }
   104| function smarty_function_html_checkboxes_output($name, $value, $output, $selected, $extra, $separator, $labels) {
   105|     $_output = '';
   106|     if ($labels) $_output .= '<label>';
   107|     $_output .= '<input type="checkbox" name="'
   108|         . smarty_function_escape_special_chars($name) . '[]" value="'
   109|         . smarty_function_escape_special_chars($value) . '"';
   110|     if (in_array((string)$value, $selected)) {
   111|         $_output .= ' checked="checked"';
   112|     }
   113|     $_output .= $extra . ' />' . $output;
   114|     if ($labels) $_output .= '</label>';
   115|     $_output .=  $separator;
   116|     return $_output;
   117| }
   118| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_image.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-127 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_image} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     html_image<br />
    12|  * Date:     Feb 24, 2003<br />
    13|  * Purpose:  format HTML tags for the image<br />
    14|  * Input:<br />
    15|  *         - file = file (and path) of image (required)
    16|  *         - height = image height (optional, default actual height)
    17|  *         - width = image width (optional, default actual width)
    18|  *         - basedir = base directory for absolute paths, default
    19|  *                     is environment variable DOCUMENT_ROOT
    20|  *         - path_prefix = prefix for path output (optional, default empty)
    21|  *
    22|  * Examples: {html_image file="/images/masthead.gif"}
    23|  * Output:   <img src="/images/masthead.gif" width=400 height=23>
    24|  * @link http://smarty.php.net/manual/en/language.function.html.image.php {html_image}
    25|  *      (Smarty online manual)
    26|  * @author   Monte Ohrt <monte at ohrt dot com>
    27|  * @author credits to Duda <duda@big.hu> - wrote first image function
    28|  *           in repository, helped with lots of functionality
    29|  * @version  1.0
    30|  * @param array
    31|  * @param Smarty
    32|  * @return string
    33|  * @uses smarty_function_escape_special_chars()
    34|  */
    35| function smarty_function_html_image($params, &$smarty)
    36| {
    37|     require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    38|     $alt = '';
    39|     $file = '';
    40|     $height = '';
    41|     $width = '';
    42|     $extra = '';
    43|     $prefix = '';
    44|     $suffix = '';
    45|     $path_prefix = '';
    46|     $server_vars = ($smarty->request_use_auto_globals) ? $_SERVER : $GLOBALS['HTTP_SERVER_VARS'];
    47|     $basedir = isset($server_vars['DOCUMENT_ROOT']) ? $server_vars['DOCUMENT_ROOT'] : '';
    48|     foreach($params as $_key => $_val) {
    49|         switch($_key) {
    50|             case 'file':
    51|             case 'height':
    52|             case 'width':
    53|             case 'dpi':
    54|             case 'path_prefix':
    55|             case 'basedir':
    56|                 $$_key = $_val;
    57|                 break;
    58|             case 'alt':
    59|                 if(!is_array($_val)) {
    60|                     $$_key = smarty_function_escape_special_chars($_val);
    61|                 } else {
    62|                     $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
    63|                 }
    64|                 break;
    65|             case 'link':
    66|             case 'href':
    67|                 $prefix = '<a href="' . $_val . '">';
    68|                 $suffix = '</a>';
    69|                 break;
    70|             default:
    71|                 if(!is_array($_val)) {
    72|                     $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
    73|                 } else {
    74|                     $smarty->trigger_error("html_image: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
    75|                 }
    76|                 break;
    77|         }
    78|     }
    79|     if (empty($file)) {
    80|         $smarty->trigger_error("html_image: missing 'file' parameter", E_USER_NOTICE);
    81|         return;
    82|     }
    83|     if (substr($file,0,1) == '/') {
    84|         $_image_path = $basedir . $file;
    85|     } else {
    86|         $_image_path = $file;
    87|     }
    88|     if(!isset($params['width']) || !isset($params['height'])) {
    89|         if(!$_image_data = @getimagesize($_image_path)) {
    90|             if(!file_exists($_image_path)) {
    91|                 $smarty->trigger_error("html_image: unable to find '$_image_path'", E_USER_NOTICE);
    92|                 return;
    93|             } else if(!is_readable($_image_path)) {
    94|                 $smarty->trigger_error("html_image: unable to read '$_image_path'", E_USER_NOTICE);
    95|                 return;
    96|             } else {
    97|                 $smarty->trigger_error("html_image: '$_image_path' is not a valid image file", E_USER_NOTICE);
    98|                 return;
    99|             }
   100|         }
   101|         if ($smarty->security &&
   102|             ($_params = array('resource_type' => 'file', 'resource_name' => $_image_path)) &&
   103|             (require_once(SMARTY_CORE_DIR . 'core.is_secure.php')) &&
   104|             (!smarty_core_is_secure($_params, $smarty)) ) {
   105|             $smarty->trigger_error("html_image: (secure) '$_image_path' not in secure directory", E_USER_NOTICE);
   106|         }        
   107|         if(!isset($params['width'])) {
   108|             $width = $_image_data[0];
   109|         }
   110|         if(!isset($params['height'])) {
   111|             $height = $_image_data[1];
   112|         }
   113|     }
   114|     if(isset($params['dpi'])) {
   115|         if(strstr($server_vars['HTTP_USER_AGENT'], 'Mac')) {
   116|             $dpi_default = 72;
   117|         } else {
   118|             $dpi_default = 96;
   119|         }
   120|         $_resize = $dpi_default/$params['dpi'];
   121|         $width = round($width * $_resize);
   122|         $height = round($height * $_resize);
   123|     }
   124|     return $prefix . '<img src="'.$path_prefix.$file.'" alt="'.$alt.'" width="'.$width.'" height="'.$height.'"'.$extra.' />' . $suffix;
   125| }
   126| /* vim: set expandtab: */
   127| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_options.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-99 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_options} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     html_options<br />
    12|  * Input:<br />
    13|  *           - name       (optional) - string default "select"
    14|  *           - values     (required if no options supplied) - array
    15|  *           - options    (required if no values supplied) - associative array
    16|  *           - selected   (optional) - string default not set
    17|  *           - output     (required if not options supplied) - array
    18|  * Purpose:  Prints the list of <option> tags generated from
    19|  *           the passed parameters
    20|  * @link http://smarty.php.net/manual/en/language.function.html.options.php {html_image}
    21|  *      (Smarty online manual)
    22|  * @author Monte Ohrt <monte at ohrt dot com>
    23|  * @param array
    24|  * @param Smarty
    25|  * @return string
    26|  * @uses smarty_function_escape_special_chars()
    27|  */
    28| function smarty_function_html_options($params, &$smarty)
    29| {
    30|     require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    31|     $name = null;
    32|     $values = null;
    33|     $options = null;
    34|     $selected = array();
    35|     $output = null;
    36|     $extra = '';
    37|     foreach($params as $_key => $_val) {
    38|         switch($_key) {
    39|             case 'name':
    40|                 $$_key = (string)$_val;
    41|                 break;
    42|             case 'options':
    43|                 $$_key = (array)$_val;
    44|                 break;
    45|             case 'values':
    46|             case 'output':
    47|                 $$_key = array_values((array)$_val);
    48|                 break;
    49|             case 'selected':
    50|                 $$_key = array_map('strval', array_values((array)$_val));
    51|                 break;
    52|             default:
    53|                 if(!is_array($_val)) {
    54|                     $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
    55|                 } else {
    56|                     $smarty->trigger_error("html_options: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
    57|                 }
    58|                 break;
    59|         }
    60|     }
    61|     if (!isset($options) && !isset($values))
    62|         return ''; /* raise error here? */
    63|     $_html_result = '';
    64|     if (isset($options)) {
    65|         foreach ($options as $_key=>$_val)
    66|             $_html_result .= smarty_function_html_options_optoutput($_key, $_val, $selected);
    67|     } else {
    68|         foreach ($values as $_i=>$_key) {
    69|             $_val = isset($output[$_i]) ? $output[$_i] : '';
    70|             $_html_result .= smarty_function_html_options_optoutput($_key, $_val, $selected);
    71|         }
    72|     }
    73|     if(!empty($name)) {
    74|         $_html_result = '<select name="' . $name . '"' . $extra . '>' . "\n" . $_html_result . '</select>' . "\n";
    75|     }
    76|     return $_html_result;
    77| }
    78| function smarty_function_html_options_optoutput($key, $value, $selected) {
    79|     if(!is_array($value)) {
    80|         $_html_result = '<option label="' . smarty_function_escape_special_chars($value) . '" value="' .
    81|             smarty_function_escape_special_chars($key) . '"';
    82|         if (in_array((string)$key, $selected))
    83|             $_html_result .= ' selected="selected"';
    84|         $_html_result .= '>' . smarty_function_escape_special_chars($value) . '</option>' . "\n";
    85|     } else {
    86|         $_html_result = smarty_function_html_options_optgroup($key, $value, $selected);
    87|     }
    88|     return $_html_result;
    89| }
    90| function smarty_function_html_options_optgroup($key, $values, $selected) {
    91|     $optgroup_html = '<optgroup label="' . smarty_function_escape_special_chars($key) . '">' . "\n";
    92|     foreach ($values as $key => $value) {
    93|         $optgroup_html .= smarty_function_html_options_optoutput($key, $value, $selected);
    94|     }
    95|     $optgroup_html .= "</optgroup>\n";
    96|     return $optgroup_html;
    97| }
    98| /* vim: set expandtab: */
    99| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_radios.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-131 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_radios} function plugin
     9|  *
    10|  * File:       function.html_radios.php<br />
    11|  * Type:       function<br />
    12|  * Name:       html_radios<br />
    13|  * Date:       24.Feb.2003<br />
    14|  * Purpose:    Prints out a list of radio input types<br />
    15|  * Input:<br />
    16|  *           - name       (optional) - string default "radio"
    17|  *           - values     (required) - array
    18|  *           - options    (optional) - associative array
    19|  *           - checked    (optional) - array default not set
    20|  *           - separator  (optional) - ie <br /> or &nbsp;
    21|  *           - output     (optional) - the output next to each radio button
    22|  *           - assign     (optional) - assign the output as an array to this variable
    23|  * Examples:
    24|  * <pre>
    25|  * {html_radios values=$ids output=$names}
    26|  * {html_radios values=$ids name='box' separator='<br />' output=$names}
    27|  * {html_radios values=$ids checked=$checked separator='<br />' output=$names}
    28|  * </pre>
    29|  * @link http://smarty.php.net/manual/en/language.function.html.radios.php {html_radios}
    30|  *      (Smarty online manual)
    31|  * @author     Christopher Kvarme <christopher.kvarme@flashjab.com>
    32|  * @author credits to Monte Ohrt <monte at ohrt dot com>
    33|  * @version    1.0
    34|  * @param array
    35|  * @param Smarty
    36|  * @return string
    37|  * @uses smarty_function_escape_special_chars()
    38|  */
    39| function smarty_function_html_radios($params, &$smarty)
    40| {
    41|     require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    42|     $name = 'radio';
    43|     $values = null;
    44|     $options = null;
    45|     $selected = null;
    46|     $separator = '';
    47|     $labels = true;
    48|     $label_ids = false;
    49|     $output = null;
    50|     $extra = '';
    51|     foreach($params as $_key => $_val) {
    52|         switch($_key) {
    53|             case 'name':
    54|             case 'separator':
    55|                 $$_key = (string)$_val;
    56|                 break;
    57|             case 'checked':
    58|             case 'selected':
    59|                 if(is_array($_val)) {
    60|                     $smarty->trigger_error('html_radios: the "' . $_key . '" attribute cannot be an array', E_USER_WARNING);
    61|                 } else {
    62|                     $selected = (string)$_val;
    63|                 }
    64|                 break;
    65|             case 'labels':
    66|             case 'label_ids':
    67|                 $$_key = (bool)$_val;
    68|                 break;
    69|             case 'options':
    70|                 $$_key = (array)$_val;
    71|                 break;
    72|             case 'values':
    73|             case 'output':
    74|                 $$_key = array_values((array)$_val);
    75|                 break;
    76|             case 'radios':
    77|                 $smarty->trigger_error('html_radios: the use of the "radios" attribute is deprecated, use "options" instead', E_USER_WARNING);
    78|                 $options = (array)$_val;
    79|                 break;
    80|             case 'assign':
    81|                 break;
    82|             default:
    83|                 if(!is_array($_val)) {
    84|                     $extra .= ' '.$_key.'="'.smarty_function_escape_special_chars($_val).'"';
    85|                 } else {
    86|                     $smarty->trigger_error("html_radios: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
    87|                 }
    88|                 break;
    89|         }
    90|     }
    91|     if (!isset($options) && !isset($values))
    92|         return ''; /* raise error here? */
    93|     $_html_result = array();
    94|     if (isset($options)) {
    95|         foreach ($options as $_key=>$_val)
    96|             $_html_result[] = smarty_function_html_radios_output($name, $_key, $_val, $selected, $extra, $separator, $labels, $label_ids);
    97|     } else {
    98|         foreach ($values as $_i=>$_key) {
    99|             $_val = isset($output[$_i]) ? $output[$_i] : '';
   100|             $_html_result[] = smarty_function_html_radios_output($name, $_key, $_val, $selected, $extra, $separator, $labels, $label_ids);
   101|         }
   102|     }
   103|     if(!empty($params['assign'])) {
   104|         $smarty->assign($params['assign'], $_html_result);
   105|     } else {
   106|         return implode("\n",$_html_result);
   107|     }
   108| }
   109| function smarty_function_html_radios_output($name, $value, $output, $selected, $extra, $separator, $labels, $label_ids) {
   110|     $_output = '';
   111|     if ($labels) {
   112|       if($label_ids) {
   113|           $_id = smarty_function_escape_special_chars(preg_replace('![^\w\-\.]!', '_', $name . '_' . $value));
   114|           $_output .= '<label for="' . $_id . '">';
   115|       } else {
   116|           $_output .= '<label>';           
   117|       }
   118|    }
   119|    $_output .= '<input type="radio" name="'
   120|         . smarty_function_escape_special_chars($name) . '" value="'
   121|         . smarty_function_escape_special_chars($value) . '"';
   122|    if ($labels && $label_ids) $_output .= ' id="' . $_id . '"';
   123|     if ((string)$value==$selected) {
   124|         $_output .= ' checked="checked"';
   125|     }
   126|     $_output .= $extra . ' />' . $output;
   127|     if ($labels) $_output .= '</label>';
   128|     $_output .=  $separator;
   129|     return $_output;
   130| }
   131| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_select_date.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-300 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_select_date} plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     html_select_date<br />
    12|  * Purpose:  Prints the dropdowns for date selection.
    13|  *
    14|  * ChangeLog:<br />
    15|  *           - 1.0 initial release
    16|  *           - 1.1 added support for +/- N syntax for begin
    17|  *                and end year values. (Monte)
    18|  *           - 1.2 added support for yyyy-mm-dd syntax for
    19|  *                time value. (Jan Rosier)
    20|  *           - 1.3 added support for choosing format for
    21|  *                month values (Gary Loescher)
    22|  *           - 1.3.1 added support for choosing format for
    23|  *                day values (Marcus Bointon)
    24|  *           - 1.3.2 support negative timestamps, force year
    25|  *             dropdown to include given date unless explicitly set (Monte)
    26|  *           - 1.3.4 fix behaviour of 0000-00-00 00:00:00 dates to match that
    27|  *             of 0000-00-00 dates (cybot, boots)
    28|  * @link http://smarty.php.net/manual/en/language.function.html.select.date.php {html_select_date}
    29|  *      (Smarty online manual)
    30|  * @version 1.3.4
    31|  * @author Andrei Zmievski
    32|  * @author Monte Ohrt <monte at ohrt dot com>
    33|  * @param array
    34|  * @param Smarty
    35|  * @return string
    36|  */
    37| function smarty_function_html_select_date($params, &$smarty)
    38| {
    39|     require_once $smarty->_get_plugin_filepath('shared','escape_special_chars');
    40|     require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
    41|     require_once $smarty->_get_plugin_filepath('function','html_options');
    42|     /* Default values. */
    43|     $prefix          = "Date_";
    44|     $start_year      = strftime("%Y");
    45|     $end_year        = $start_year;
    46|     $display_days    = true;
    47|     $display_months  = true;
    48|     $display_years   = true;
    49|     $month_format    = "%B";
    50|     /* Write months as numbers by default  GL */
    51|     $month_value_format = "%m";
    52|     $day_format      = "%02d";
    53|     /* Write day values using this format MB */
    54|     $day_value_format = "%d";
    55|     $year_as_text    = false;
    56|     /* Display years in reverse order? Ie. 2000,1999,.... */
    57|     $reverse_years   = false;
    58|     /* Should the select boxes be part of an array when returned from PHP?
    59|        e.g. setting it to "birthday", would create "birthday[Day]",
    60|        "birthday[Month]" & "birthday[Year]". Can be combined with prefix */
    61|     $field_array     = null;
    62|     /* <select size>'s of the different <select> tags.
    63|        If not set, uses default dropdown. */
    64|     $day_size        = null;
    65|     $month_size      = null;
    66|     $year_size       = null;
    67|     /* Unparsed attributes common to *ALL* the <select>/<input> tags.
    68|        An example might be in the template: all_extra ='class ="foo"'. */
    69|     $all_extra       = null;
    70|     /* Separate attributes for the tags. */
    71|     $day_extra       = null;
    72|     $month_extra     = null;
    73|     $year_extra      = null;
    74|     /* Order in which to display the fields.
    75|        "D" -> day, "M" -> month, "Y" -> year. */
    76|     $field_order     = 'MDY';
    77|     /* String printed between the different fields. */
    78|     $field_separator = "\n";
    79|     $time = time();
    80|     $all_empty       = null;
    81|     $day_empty       = null;
    82|     $month_empty     = null;
    83|     $year_empty      = null;
    84|     $extra_attrs     = '';
    85|     foreach ($params as $_key=>$_value) {
    86|         switch ($_key) {
    87|             case 'prefix':
    88|             case 'time':
    89|             case 'start_year':
    90|             case 'end_year':
    91|             case 'month_format':
    92|             case 'day_format':
    93|             case 'day_value_format':
    94|             case 'field_array':
    95|             case 'day_size':
    96|             case 'month_size':
    97|             case 'year_size':
    98|             case 'all_extra':
    99|             case 'day_extra':
   100|             case 'month_extra':
   101|             case 'year_extra':
   102|             case 'field_order':
   103|             case 'field_separator':
   104|             case 'month_value_format':
   105|             case 'month_empty':
   106|             case 'day_empty':
   107|             case 'year_empty':
   108|                 $$_key = (string)$_value;
   109|                 break;
   110|             case 'all_empty':
   111|                 $$_key = (string)$_value;
   112|                 $day_empty = $month_empty = $year_empty = $all_empty;
   113|                 break;
   114|             case 'display_days':
   115|             case 'display_months':
   116|             case 'display_years':
   117|             case 'year_as_text':
   118|             case 'reverse_years':
   119|                 $$_key = (bool)$_value;
   120|                 break;
   121|             default:
   122|                 if(!is_array($_value)) {
   123|                     $extra_attrs .= ' '.$_key.'="'.smarty_function_escape_special_chars($_value).'"';
   124|                 } else {
   125|                     $smarty->trigger_error("html_select_date: extra attribute '$_key' cannot be an array", E_USER_NOTICE);
   126|                 }
   127|                 break;
   128|         }
   129|     }
   130|     if (preg_match('!^-\d+$!', $time)) {
   131|         $time = date('Y-m-d', $time);
   132|     }
   133|     if (preg_match('/^(\d{0,4}-\d{0,2}-\d{0,2})/', $time, $found)) {
   134|         $time = $found[1];
   135|     } else {
   136|         $time = strftime('%Y-%m-%d', smarty_make_timestamp($time));
   137|     }
   138|     $time = explode("-", $time);
   139|     if (preg_match('!^(\+|\-)\s*(\d+)$!', $end_year, $match)) {
   140|         if ($match[1] == '+') {
   141|             $end_year = strftime('%Y') + $match[2];
   142|         } else {
   143|             $end_year = strftime('%Y') - $match[2];
   144|         }
   145|     }
   146|     if (preg_match('!^(\+|\-)\s*(\d+)$!', $start_year, $match)) {
   147|         if ($match[1] == '+') {
   148|             $start_year = strftime('%Y') + $match[2];
   149|         } else {
   150|             $start_year = strftime('%Y') - $match[2];
   151|         }
   152|     }
   153|     if (strlen($time[0]) > 0) {
   154|         if ($start_year > $time[0] && !isset($params['start_year'])) {
   155|             $start_year = $time[0];
   156|         }
   157|         if($end_year < $time[0] && !isset($params['end_year'])) {
   158|             $end_year = $time[0];
   159|         }
   160|     }
   161|     $field_order = strtoupper($field_order);
   162|     $html_result = $month_result = $day_result = $year_result = "";
   163|     $field_separator_count = -1;
   164|     if ($display_months) {
   165|     	$field_separator_count++;
   166|         $month_names = array();
   167|         $month_values = array();
   168|         if(isset($month_empty)) {
   169|             $month_names[''] = $month_empty;
   170|             $month_values[''] = '';
   171|         }
   172|         for ($i = 1; $i <= 12; $i++) {
   173|             $month_names[$i] = strftime($month_format, mktime(0, 0, 0, $i, 1, 2000));
   174|             $month_values[$i] = strftime($month_value_format, mktime(0, 0, 0, $i, 1, 2000));
   175|         }
   176|         $month_result .= '<select name=';
   177|         if (null !== $field_array){
   178|             $month_result .= '"' . $field_array . '[' . $prefix . 'Month]"';
   179|         } else {
   180|             $month_result .= '"' . $prefix . 'Month"';
   181|         }
   182|         if (null !== $month_size){
   183|             $month_result .= ' size="' . $month_size . '"';
   184|         }
   185|         if (null !== $month_extra){
   186|             $month_result .= ' ' . $month_extra;
   187|         }
   188|         if (null !== $all_extra){
   189|             $month_result .= ' ' . $all_extra;
   190|         }
   191|         $month_result .= $extra_attrs . '>'."\n";
   192|         $month_result .= smarty_function_html_options(array('output'     => $month_names,
   193|                                                             'values'     => $month_values,
   194|                                                             'selected'   => (int)$time[1] ? strftime($month_value_format, mktime(0, 0, 0, (int)$time[1], 1, 2000)) : '',
   195|                                                             'print_result' => false),
   196|                                                       $smarty);
   197|         $month_result .= '</select>';
   198|     }
   199|     if ($display_days) {
   200|     	$field_separator_count++;
   201|         $days = array();
   202|         if (isset($day_empty)) {
   203|             $days[''] = $day_empty;
   204|             $day_values[''] = '';
   205|         }
   206|         for ($i = 1; $i <= 31; $i++) {
   207|             $days[] = sprintf($day_format, $i);
   208|             $day_values[] = sprintf($day_value_format, $i);
   209|         }
   210|         $day_result .= '<select name=';
   211|         if (null !== $field_array){
   212|             $day_result .= '"' . $field_array . '[' . $prefix . 'Day]"';
   213|         } else {
   214|             $day_result .= '"' . $prefix . 'Day"';
   215|         }
   216|         if (null !== $day_size){
   217|             $day_result .= ' size="' . $day_size . '"';
   218|         }
   219|         if (null !== $all_extra){
   220|             $day_result .= ' ' . $all_extra;
   221|         }
   222|         if (null !== $day_extra){
   223|             $day_result .= ' ' . $day_extra;
   224|         }
   225|         $day_result .= $extra_attrs . '>'."\n";
   226|         $day_result .= smarty_function_html_options(array('output'     => $days,
   227|                                                           'values'     => $day_values,
   228|                                                           'selected'   => $time[2],
   229|                                                           'print_result' => false),
   230|                                                     $smarty);
   231|         $day_result .= '</select>';
   232|     }
   233|     if ($display_years) {
   234|     	$field_separator_count++;
   235|         if (null !== $field_array){
   236|             $year_name = $field_array . '[' . $prefix . 'Year]';
   237|         } else {
   238|             $year_name = $prefix . 'Year';
   239|         }
   240|         if ($year_as_text) {
   241|             $year_result .= '<input type="text" name="' . $year_name . '" value="' . $time[0] . '" size="4" maxlength="4"';
   242|             if (null !== $all_extra){
   243|                 $year_result .= ' ' . $all_extra;
   244|             }
   245|             if (null !== $year_extra){
   246|                 $year_result .= ' ' . $year_extra;
   247|             }
   248|             $year_result .= ' />';
   249|         } else {
   250|             $years = range((int)$start_year, (int)$end_year);
   251|             if ($reverse_years) {
   252|                 rsort($years, SORT_NUMERIC);
   253|             } else {
   254|                 sort($years, SORT_NUMERIC);
   255|             }
   256|             $yearvals = $years;
   257|             if(isset($year_empty)) {
   258|                 array_unshift($years, $year_empty);
   259|                 array_unshift($yearvals, '');
   260|             }
   261|             $year_result .= '<select name="' . $year_name . '"';
   262|             if (null !== $year_size){
   263|                 $year_result .= ' size="' . $year_size . '"';
   264|             }
   265|             if (null !== $all_extra){
   266|                 $year_result .= ' ' . $all_extra;
   267|             }
   268|             if (null !== $year_extra){
   269|                 $year_result .= ' ' . $year_extra;
   270|             }
   271|             $year_result .= $extra_attrs . '>'."\n";
   272|             $year_result .= smarty_function_html_options(array('output' => $years,
   273|                                                                'values' => $yearvals,
   274|                                                                'selected'   => $time[0],
   275|                                                                'print_result' => false),
   276|                                                          $smarty);
   277|             $year_result .= '</select>';
   278|         }
   279|     }
   280|     for ($i = 0; $i <= 2; $i++){
   281|         $c = substr($field_order, $i, 1);
   282|         switch ($c){
   283|             case 'D':
   284|                 $html_result .= $day_result;
   285|                 break;
   286|             case 'M':
   287|                 $html_result .= $month_result;
   288|                 break;
   289|             case 'Y':
   290|                 $html_result .= $year_result;
   291|                 break;
   292|         }
   293|         if($i < $field_separator_count) {
   294|             $html_result .= $field_separator;
   295|         }
   296|     }
   297|     return $html_result;
   298| }
   299| /* vim: set expandtab: */
   300| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_select_time.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-174 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_select_time} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     html_select_time<br />
    12|  * Purpose:  Prints the dropdowns for time selection
    13|  * @link http://smarty.php.net/manual/en/language.function.html.select.time.php {html_select_time}
    14|  *          (Smarty online manual)
    15|  * @author Roberto Berto <roberto@berto.net>
    16|  * @credits Monte Ohrt <monte AT ohrt DOT com>
    17|  * @param array
    18|  * @param Smarty
    19|  * @return string
    20|  * @uses smarty_make_timestamp()
    21|  */
    22| function smarty_function_html_select_time($params, &$smarty)
    23| {
    24|     require_once $smarty->_get_plugin_filepath('shared','make_timestamp');
    25|     require_once $smarty->_get_plugin_filepath('function','html_options');
    26|     /* Default values. */
    27|     $prefix             = "Time_";
    28|     $time               = time();
    29|     $display_hours      = true;
    30|     $display_minutes    = true;
    31|     $display_seconds    = true;
    32|     $display_meridian   = true;
    33|     $use_24_hours       = true;
    34|     $minute_interval    = 1;
    35|     $second_interval    = 1;
    36|     /* Should the select boxes be part of an array when returned from PHP?
    37|        e.g. setting it to "birthday", would create "birthday[Hour]",
    38|        "birthday[Minute]", "birthday[Seconds]" & "birthday[Meridian]".
    39|        Can be combined with prefix. */
    40|     $field_array        = null;
    41|     $all_extra          = null;
    42|     $hour_extra         = null;
    43|     $minute_extra       = null;
    44|     $second_extra       = null;
    45|     $meridian_extra     = null;
    46|     foreach ($params as $_key=>$_value) {
    47|         switch ($_key) {
    48|             case 'prefix':
    49|             case 'time':
    50|             case 'field_array':
    51|             case 'all_extra':
    52|             case 'hour_extra':
    53|             case 'minute_extra':
    54|             case 'second_extra':
    55|             case 'meridian_extra':
    56|                 $$_key = (string)$_value;
    57|                 break;
    58|             case 'display_hours':
    59|             case 'display_minutes':
    60|             case 'display_seconds':
    61|             case 'display_meridian':
    62|             case 'use_24_hours':
    63|                 $$_key = (bool)$_value;
    64|                 break;
    65|             case 'minute_interval':
    66|             case 'second_interval':
    67|                 $$_key = (int)$_value;
    68|                 break;
    69|             default:
    70|                 $smarty->trigger_error("[html_select_time] unknown parameter $_key", E_USER_WARNING);
    71|         }
    72|     }
    73|     $time = smarty_make_timestamp($time);
    74|     $html_result = '';
    75|     if ($display_hours) {
    76|         $hours       = $use_24_hours ? range(0, 23) : range(1, 12);
    77|         $hour_fmt = $use_24_hours ? '%H' : '%I';
    78|         for ($i = 0, $for_max = count($hours); $i < $for_max; $i++)
    79|             $hours[$i] = sprintf('%02d', $hours[$i]);
    80|         $html_result .= '<select name=';
    81|         if (null !== $field_array) {
    82|             $html_result .= '"' . $field_array . '[' . $prefix . 'Hour]"';
    83|         } else {
    84|             $html_result .= '"' . $prefix . 'Hour"';
    85|         }
    86|         if (null !== $hour_extra){
    87|             $html_result .= ' ' . $hour_extra;
    88|         }
    89|         if (null !== $all_extra){
    90|             $html_result .= ' ' . $all_extra;
    91|         }
    92|         $html_result .= '>'."\n";
    93|         $html_result .= smarty_function_html_options(array('output'          => $hours,
    94|                                                            'values'          => $hours,
    95|                                                            'selected'      => strftime($hour_fmt, $time),
    96|                                                            'print_result' => false),
    97|                                                      $smarty);
    98|         $html_result .= "</select>\n";
    99|     }
   100|     if ($display_minutes) {
   101|         $all_minutes = range(0, 59);
   102|         for ($i = 0, $for_max = count($all_minutes); $i < $for_max; $i+= $minute_interval)
   103|             $minutes[] = sprintf('%02d', $all_minutes[$i]);
   104|         $selected = intval(floor(strftime('%M', $time) / $minute_interval) * $minute_interval);
   105|         $html_result .= '<select name=';
   106|         if (null !== $field_array) {
   107|             $html_result .= '"' . $field_array . '[' . $prefix . 'Minute]"';
   108|         } else {
   109|             $html_result .= '"' . $prefix . 'Minute"';
   110|         }
   111|         if (null !== $minute_extra){
   112|             $html_result .= ' ' . $minute_extra;
   113|         }
   114|         if (null !== $all_extra){
   115|             $html_result .= ' ' . $all_extra;
   116|         }
   117|         $html_result .= '>'."\n";
   118|         $html_result .= smarty_function_html_options(array('output'          => $minutes,
   119|                                                            'values'          => $minutes,
   120|                                                            'selected'      => $selected,
   121|                                                            'print_result' => false),
   122|                                                      $smarty);
   123|         $html_result .= "</select>\n";
   124|     }
   125|     if ($display_seconds) {
   126|         $all_seconds = range(0, 59);
   127|         for ($i = 0, $for_max = count($all_seconds); $i < $for_max; $i+= $second_interval)
   128|             $seconds[] = sprintf('%02d', $all_seconds[$i]);
   129|         $selected = intval(floor(strftime('%S', $time) / $second_interval) * $second_interval);
   130|         $html_result .= '<select name=';
   131|         if (null !== $field_array) {
   132|             $html_result .= '"' . $field_array . '[' . $prefix . 'Second]"';
   133|         } else {
   134|             $html_result .= '"' . $prefix . 'Second"';
   135|         }
   136|         if (null !== $second_extra){
   137|             $html_result .= ' ' . $second_extra;
   138|         }
   139|         if (null !== $all_extra){
   140|             $html_result .= ' ' . $all_extra;
   141|         }
   142|         $html_result .= '>'."\n";
   143|         $html_result .= smarty_function_html_options(array('output'          => $seconds,
   144|                                                            'values'          => $seconds,
   145|                                                            'selected'      => $selected,
   146|                                                            'print_result' => false),
   147|                                                      $smarty);
   148|         $html_result .= "</select>\n";
   149|     }
   150|     if ($display_meridian && !$use_24_hours) {
   151|         $html_result .= '<select name=';
   152|         if (null !== $field_array) {
   153|             $html_result .= '"' . $field_array . '[' . $prefix . 'Meridian]"';
   154|         } else {
   155|             $html_result .= '"' . $prefix . 'Meridian"';
   156|         }
   157|         if (null !== $meridian_extra){
   158|             $html_result .= ' ' . $meridian_extra;
   159|         }
   160|         if (null !== $all_extra){
   161|             $html_result .= ' ' . $all_extra;
   162|         }
   163|         $html_result .= '>'."\n";
   164|         $html_result .= smarty_function_html_options(array('output'          => array('AM', 'PM'),
   165|                                                            'values'          => array('am', 'pm'),
   166|                                                            'selected'      => strtolower(strftime('%p', $time)),
   167|                                                            'print_result' => false),
   168|                                                      $smarty);
   169|         $html_result .= "</select>\n";
   170|     }
   171|     return $html_result;
   172| }
   173| /* vim: set expandtab: */
   174| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.html_table.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-155 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {html_table} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     html_table<br />
    12|  * Date:     Feb 17, 2003<br />
    13|  * Purpose:  make an html table from an array of data<br />
    14|  * Input:<br />
    15|  *         - loop = array to loop through
    16|  *         - cols = number of columns, comma separated list of column names
    17|  *                  or array of column names
    18|  *         - rows = number of rows
    19|  *         - table_attr = table attributes
    20|  *         - th_attr = table heading attributes (arrays are cycled)
    21|  *         - tr_attr = table row attributes (arrays are cycled)
    22|  *         - td_attr = table cell attributes (arrays are cycled)
    23|  *         - trailpad = value to pad trailing cells with
    24|  *         - caption = text for caption element 
    25|  *         - vdir = vertical direction (default: "down", means top-to-bottom)
    26|  *         - hdir = horizontal direction (default: "right", means left-to-right)
    27|  *         - inner = inner loop (default "cols": print $loop line by line,
    28|  *                   $loop will be printed column by column otherwise)
    29|  *
    30|  *
    31|  * Examples:
    32|  * <pre>
    33|  * {table loop=$data}
    34|  * {table loop=$data cols=4 tr_attr='"bgcolor=red"'}
    35|  * {table loop=$data cols="first,second,third" tr_attr=$colors}
    36|  * </pre>
    37|  * @author   Monte Ohrt <monte at ohrt dot com>
    38|  * @author credit to Messju Mohr <messju at lammfellpuschen dot de>
    39|  * @author credit to boots <boots dot smarty at yahoo dot com>
    40|  * @version  1.1
    41|  * @link http://smarty.php.net/manual/en/language.function.html.table.php {html_table}
    42|  *          (Smarty online manual)
    43|  * @param array
    44|  * @param Smarty
    45|  * @return string
    46|  */
    47| function smarty_function_html_table($params, &$smarty)
    48| {
    49|     $table_attr = 'border="1"';
    50|     $tr_attr = '';
    51|     $th_attr = '';
    52|     $td_attr = '';
    53|     $cols = $cols_count = 3;
    54|     $rows = 3;
    55|     $trailpad = '&nbsp;';
    56|     $vdir = 'down';
    57|     $hdir = 'right';
    58|     $inner = 'cols';
    59|     $caption = '';
    60|     if (!isset($params['loop'])) {
    61|         $smarty->trigger_error("html_table: missing 'loop' parameter");
    62|         return;
    63|     }
    64|     foreach ($params as $_key=>$_value) {
    65|         switch ($_key) {
    66|             case 'loop':
    67|                 $$_key = (array)$_value;
    68|                 break;
    69|             case 'cols':
    70|                 if (is_array($_value) && !empty($_value)) {
    71|                     $cols = $_value;
    72|                     $cols_count = count($_value);
    73|                 } elseif (!is_numeric($_value) && is_string($_value) && !empty($_value)) {
    74|                     $cols = explode(',', $_value);
    75|                     $cols_count = count($cols);
    76|                 } elseif (!empty($_value)) {
    77|                     $cols_count = (int)$_value;
    78|                 } else {
    79|                     $cols_count = $cols;
    80|                 }
    81|                 break;
    82|             case 'rows':
    83|                 $$_key = (int)$_value;
    84|                 break;
    85|             case 'table_attr':
    86|             case 'trailpad':
    87|             case 'hdir':
    88|             case 'vdir':
    89|             case 'inner':
    90|             case 'caption':
    91|                 $$_key = (string)$_value;
    92|                 break;
    93|             case 'tr_attr':
    94|             case 'td_attr':
    95|             case 'th_attr':
    96|                 $$_key = $_value;
    97|                 break;
    98|         }
    99|     }
   100|     $loop_count = count($loop);
   101|     if (empty($params['rows'])) {
   102|         /* no rows specified */
   103|         $rows = ceil($loop_count/$cols_count);
   104|     } elseif (empty($params['cols'])) {
   105|         if (!empty($params['rows'])) {
   106|             /* no cols specified, but rows */
   107|             $cols_count = ceil($loop_count/$rows);
   108|         }
   109|     }
   110|     $output = "<table $table_attr>\n";
   111|     if (!empty($caption)) {
   112|         $output .= '<caption>' . $caption . "</caption>\n";
   113|     }
   114|     if (is_array($cols)) {
   115|         $cols = ($hdir == 'right') ? $cols : array_reverse($cols);
   116|         $output .= "<thead><tr>\n";
   117|         for ($r=0; $r<$cols_count; $r++) {
   118|             $output .= '<th' . smarty_function_html_table_cycle('th', $th_attr, $r) . '>';
   119|             $output .= $cols[$r];
   120|             $output .= "</th>\n";
   121|         }
   122|         $output .= "</tr></thead>\n";
   123|     }
   124|     $output .= "<tbody>\n";
   125|     for ($r=0; $r<$rows; $r++) {
   126|         $output .= "<tr" . smarty_function_html_table_cycle('tr', $tr_attr, $r) . ">\n";
   127|         $rx =  ($vdir == 'down') ? $r*$cols_count : ($rows-1-$r)*$cols_count;
   128|         for ($c=0; $c<$cols_count; $c++) {
   129|             $x =  ($hdir == 'right') ? $rx+$c : $rx+$cols_count-1-$c;
   130|             if ($inner!='cols') {
   131|                 /* shuffle x to loop over rows*/
   132|                 $x = floor($x/$cols_count) + ($x%$cols_count)*$rows;
   133|             }
   134|             if ($x<$loop_count) {
   135|                 $output .= "<td" . smarty_function_html_table_cycle('td', $td_attr, $c) . ">" . $loop[$x] . "</td>\n";
   136|             } else {
   137|                 $output .= "<td" . smarty_function_html_table_cycle('td', $td_attr, $c) . ">$trailpad</td>\n";
   138|             }
   139|         }
   140|         $output .= "</tr>\n";
   141|     }
   142|     $output .= "</tbody>\n";
   143|     $output .= "</table>\n";
   144|     return $output;
   145| }
   146| function smarty_function_html_table_cycle($name, $var, $no) {
   147|     if(!is_array($var)) {
   148|         $ret = $var;
   149|     } else {
   150|         $ret = $var[$no % count($var)];
   151|     }
   152|     return ($ret) ? ' '.$ret : '';
   153| }
   154| /* vim: set expandtab: */
   155| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.mailto.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-136 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {mailto} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     mailto<br />
    12|  * Date:     May 21, 2002
    13|  * Purpose:  automate mailto address link creation, and optionally
    14|  *           encode them.<br />
    15|  * Input:<br />
    16|  *         - address = e-mail address
    17|  *         - text = (optional) text to display, default is address
    18|  *         - encode = (optional) can be one of:
    19|  *                * none : no encoding (default)
    20|  *                * javascript : encode with javascript
    21|  *                * javascript_charcode : encode with javascript charcode
    22|  *                * hex : encode with hexidecimal (no javascript)
    23|  *         - cc = (optional) address(es) to carbon copy
    24|  *         - bcc = (optional) address(es) to blind carbon copy
    25|  *         - subject = (optional) e-mail subject
    26|  *         - newsgroups = (optional) newsgroup(s) to post to
    27|  *         - followupto = (optional) address(es) to follow up to
    28|  *         - extra = (optional) extra tags for the href link
    29|  *
    30|  * Examples:
    31|  * <pre>
    32|  * {mailto address="me@domain.com"}
    33|  * {mailto address="me@domain.com" encode="javascript"}
    34|  * {mailto address="me@domain.com" encode="hex"}
    35|  * {mailto address="me@domain.com" subject="Hello to you!"}
    36|  * {mailto address="me@domain.com" cc="you@domain.com,they@domain.com"}
    37|  * {mailto address="me@domain.com" extra='class="mailto"'}
    38|  * </pre>
    39|  * @link http://smarty.php.net/manual/en/language.function.mailto.php {mailto}
    40|  *          (Smarty online manual)
    41|  * @version  1.2
    42|  * @author   Monte Ohrt <monte at ohrt dot com>
    43|  * @author   credits to Jason Sweat (added cc, bcc and subject functionality)
    44|  * @param    array
    45|  * @param    Smarty
    46|  * @return   string
    47|  */
    48| function smarty_function_mailto($params, &$smarty)
    49| {
    50|     $extra = '';
    51|     if (empty($params['address'])) {
    52|         $smarty->trigger_error("mailto: missing 'address' parameter");
    53|         return;
    54|     } else {
    55|         $address = $params['address'];
    56|     }
    57|     $text = $address;
    58|     $search = array('%40', '%2C');
    59|     $replace  = array('@', ',');
    60|     $mail_parms = array();
    61|     foreach ($params as $var=>$value) {
    62|         switch ($var) {
    63|             case 'cc':
    64|             case 'bcc':
    65|             case 'followupto':
    66|                 if (!empty($value))
    67|                     $mail_parms[] = $var.'='.str_replace($search,$replace,rawurlencode($value));
    68|                 break;
    69|             case 'subject':
    70|             case 'newsgroups':
    71|                 $mail_parms[] = $var.'='.rawurlencode($value);
    72|                 break;
    73|             case 'extra':
    74|             case 'text':
    75|                 $$var = $value;
    76|             default:
    77|         }
    78|     }
    79|     $mail_parm_vals = '';
    80|     for ($i=0; $i<count($mail_parms); $i++) {
    81|         $mail_parm_vals .= (0==$i) ? '?' : '&';
    82|         $mail_parm_vals .= $mail_parms[$i];
    83|     }
    84|     $address .= $mail_parm_vals;
    85|     $encode = (empty($params['encode'])) ? 'none' : $params['encode'];
    86|     if (!in_array($encode,array('javascript','javascript_charcode','hex','none')) ) {
    87|         $smarty->trigger_error("mailto: 'encode' parameter must be none, javascript or hex");
    88|         return;
    89|     }
    90|     if ($encode == 'javascript' ) {
    91|         $string = 'document.write(\'<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>\');';
    92|         $js_encode = '';
    93|         for ($x=0; $x < strlen($string); $x++) {
    94|             $js_encode .= '%' . bin2hex($string[$x]);
    95|         }
    96|         return '<script type="text/javascript">eval(unescape(\''.$js_encode.'\'))</script>';
    97|     } elseif ($encode == 'javascript_charcode' ) {
    98|         $string = '<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>';
    99|         for($x = 0, $y = strlen($string); $x < $y; $x++ ) {
   100|             $ord[] = ord($string[$x]);   
   101|         }
   102|         $_ret = "<script type=\"text/javascript\" language=\"javascript\">\n";
   103|         $_ret .= "<!--\n";
   104|         $_ret .= "{document.write(String.fromCharCode(";
   105|         $_ret .= implode(',',$ord);
   106|         $_ret .= "))";
   107|         $_ret .= "}\n";
   108|         $_ret .= "//-->\n";
   109|         $_ret .= "</script>\n";
   110|         return $_ret;
   111|     } elseif ($encode == 'hex') {
   112|         preg_match('!^(.*)(\?.*)$!',$address,$match);
   113|         if(!empty($match[2])) {
   114|             $smarty->trigger_error("mailto: hex encoding does not work with extra attributes. Try javascript.");
   115|             return;
   116|         }
   117|         $address_encode = '';
   118|         for ($x=0; $x < strlen($address); $x++) {
   119|             if(preg_match('!\w!',$address[$x])) {
   120|                 $address_encode .= '%' . bin2hex($address[$x]);
   121|             } else {
   122|                 $address_encode .= $address[$x];
   123|             }
   124|         }
   125|         $text_encode = '';
   126|         for ($x=0; $x < strlen($text); $x++) {
   127|             $text_encode .= '&#x' . bin2hex($text[$x]).';';
   128|         }
   129|         $mailto = "&#109;&#97;&#105;&#108;&#116;&#111;&#58;";
   130|         return '<a href="'.$mailto.$address_encode.'" '.$extra.'>'.$text_encode.'</a>';
   131|     } else {
   132|         return '<a href="mailto:'.$address.'" '.$extra.'>'.$text.'</a>';
   133|     }
   134| }
   135| /* vim: set expandtab: */
   136| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.math.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-69 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {math} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     math<br />
    12|  * Purpose:  handle math computations in template<br />
    13|  * @link http://smarty.php.net/manual/en/language.function.math.php {math}
    14|  *          (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param array
    17|  * @param Smarty
    18|  * @return string
    19|  */
    20| function smarty_function_math($params, &$smarty)
    21| {
    22|     if (empty($params['equation'])) {
    23|         $smarty->trigger_error("math: missing equation parameter");
    24|         return;
    25|     }
    26|     $equation = $params['equation'];
    27|     if (substr_count($equation,"(") != substr_count($equation,")")) {
    28|         $smarty->trigger_error("math: unbalanced parenthesis");
    29|         return;
    30|     }
    31|     preg_match_all("!(?:0x[a-fA-F0-9]+)|([a-zA-Z][a-zA-Z0-9_]+)!",$equation, $match);
    32|     $allowed_funcs = array('int','abs','ceil','cos','exp','floor','log','log10',
    33|                            'max','min','pi','pow','rand','round','sin','sqrt','srand','tan');
    34|     foreach($match[1] as $curr_var) {
    35|         if ($curr_var && !in_array($curr_var, array_keys($params)) && !in_array($curr_var, $allowed_funcs)) {
    36|             $smarty->trigger_error("math: function call $curr_var not allowed");
    37|             return;
    38|         }
    39|     }
    40|     foreach($params as $key => $val) {
    41|         if ($key != "equation" && $key != "format" && $key != "assign") {
    42|             if (strlen($val)==0) {
    43|                 $smarty->trigger_error("math: parameter $key is empty");
    44|                 return;
    45|             }
    46|             if (!is_numeric($val)) {
    47|                 $smarty->trigger_error("math: parameter $key: is not numeric");
    48|                 return;
    49|             }
    50|             $equation = preg_replace("/\b$key\b/", " \$params['$key'] ", $equation);
    51|         }
    52|     }
    53|     eval("\$smarty_math_result = ".$equation.";");
    54|     if (empty($params['format'])) {
    55|         if (empty($params['assign'])) {
    56|             return $smarty_math_result;
    57|         } else {
    58|             $smarty->assign($params['assign'],$smarty_math_result);
    59|         }
    60|     } else {
    61|         if (empty($params['assign'])){
    62|             printf($params['format'],$smarty_math_result);
    63|         } else {
    64|             $smarty->assign($params['assign'],sprintf($params['format'],$smarty_math_result));
    65|         }
    66|     }
    67| }
    68| /* vim: set expandtab: */
    69| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.popup.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-105 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {popup} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     popup<br />
    12|  * Purpose:  make text pop up in windows via overlib
    13|  * @link http://smarty.php.net/manual/en/language.function.popup.php {popup}
    14|  *          (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param array
    17|  * @param Smarty
    18|  * @return string
    19|  */
    20| function smarty_function_popup($params, &$smarty)
    21| {
    22|     $append = '';
    23|     foreach ($params as $_key=>$_value) {
    24|         switch ($_key) {
    25|             case 'text':
    26|             case 'trigger':
    27|             case 'function':
    28|             case 'inarray':
    29|                 $$_key = (string)$_value;
    30|                 if ($_key == 'function' || $_key == 'inarray')
    31|                     $append .= ',' . strtoupper($_key) . ",'$_value'";
    32|                 break;
    33|             case 'caption':
    34|             case 'closetext':
    35|             case 'status':
    36|                 $append .= ',' . strtoupper($_key) . ",'" . str_replace("'","\'",$_value) . "'";
    37|                 break;
    38|             case 'fgcolor':
    39|             case 'bgcolor':
    40|             case 'textcolor':
    41|             case 'capcolor':
    42|             case 'closecolor':
    43|             case 'textfont':
    44|             case 'captionfont':
    45|             case 'closefont':
    46|             case 'fgbackground':
    47|             case 'bgbackground':
    48|             case 'caparray':
    49|             case 'capicon':
    50|             case 'background':
    51|             case 'frame':
    52|                 $append .= ',' . strtoupper($_key) . ",'$_value'";
    53|                 break;
    54|             case 'textsize':
    55|             case 'captionsize':
    56|             case 'closesize':
    57|             case 'width':
    58|             case 'height':
    59|             case 'border':
    60|             case 'offsetx':
    61|             case 'offsety':
    62|             case 'snapx':
    63|             case 'snapy':
    64|             case 'fixx':
    65|             case 'fixy':
    66|             case 'padx':
    67|             case 'pady':
    68|             case 'timeout':
    69|             case 'delay':
    70|                 $append .= ',' . strtoupper($_key) . ",$_value";
    71|                 break;
    72|             case 'sticky':
    73|             case 'left':
    74|             case 'right':
    75|             case 'center':
    76|             case 'above':
    77|             case 'below':
    78|             case 'noclose':
    79|             case 'autostatus':
    80|             case 'autostatuscap':
    81|             case 'fullhtml':
    82|             case 'hauto':
    83|             case 'vauto':
    84|             case 'mouseoff':
    85|             case 'followmouse':
    86|             case 'closeclick':
    87|                 if ($_value) $append .= ',' . strtoupper($_key);
    88|                 break;
    89|             default:
    90|                 $smarty->trigger_error("[popup] unknown parameter $_key", E_USER_WARNING);
    91|         }
    92|     }
    93|     if (empty($text) && !isset($inarray) && empty($function)) {
    94|         $smarty->trigger_error("overlib: attribute 'text' or 'inarray' or 'function' required");
    95|         return false;
    96|     }
    97|     if (empty($trigger)) { $trigger = "onmouseover"; }
    98|     $retval = $trigger . '="return overlib(\''.preg_replace(array("!'!","![\r\n]!"),array("\'",'\r'),$text).'\'';
    99|     $retval .= $append . ');"';
   100|     if ($trigger == 'onmouseover')
   101|        $retval .= ' onmouseout="nd();"';
   102|     return $retval;
   103| }
   104| /* vim: set expandtab: */
   105| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/function.popup_init.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-34 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty {popup_init} function plugin
     9|  *
    10|  * Type:     function<br />
    11|  * Name:     popup_init<br />
    12|  * Purpose:  initialize overlib
    13|  * @link http://smarty.php.net/manual/en/language.function.popup.init.php {popup_init}
    14|  *          (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param array
    17|  * @param Smarty
    18|  * @return string
    19|  */
    20| function smarty_function_popup_init($params, &$smarty)
    21| {
    22|     $zindex = 1000;
    23|     if (!empty($params['zindex'])) {
    24|         $zindex = $params['zindex'];
    25|     }
    26|     if (!empty($params['src'])) {
    27|         return '<div id="overDiv" style="position:absolute; visibility:hidden; z-index:'.$zindex.';"></div>' . "\n"
    28|          . '<script type="text/javascript" language="JavaScript" src="'.$params['src'].'"></script>' . "\n";
    29|     } else {
    30|         $smarty->trigger_error("popup_init: missing src parameter");
    31|     }
    32| }
    33| /* vim: set expandtab: */
    34| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.capitalize.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-36 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty capitalize modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     capitalize<br />
    12|  * Purpose:  capitalize words in the string
    13|  * @link http://smarty.php.net/manual/en/language.modifiers.php#LANGUAGE.MODIFIER.CAPITALIZE
    14|  *      capitalize (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return string
    18|  */
    19| function smarty_modifier_capitalize($string, $uc_digits = false)
    20| {
    21|     smarty_modifier_capitalize_ucfirst(null, $uc_digits);
    22|     return preg_replace_callback('!\'?\b\w(\w|\')*\b!', 'smarty_modifier_capitalize_ucfirst', $string);
    23| }
    24| function smarty_modifier_capitalize_ucfirst($string, $uc_digits = null)
    25| {
    26|     static $_uc_digits = false;
    27|     if(isset($uc_digits)) {
    28|         $_uc_digits = $uc_digits;
    29|         return;
    30|     }
    31|     if(substr($string[0],0,1) != "'" && !preg_match("!\d!",$string[0]) || $_uc_digits)
    32|         return ucfirst($string[0]);
    33|     else
    34|         return $string[0];
    35| }
    36| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.cat.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-29 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty cat modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     cat<br />
    12|  * Date:     Feb 24, 2003
    13|  * Purpose:  catenate a value to a variable
    14|  * Input:    string to catenate
    15|  * Example:  {$var|cat:"foo"}
    16|  * @link http://smarty.php.net/manual/en/language.modifier.cat.php cat
    17|  *          (Smarty online manual)
    18|  * @author   Monte Ohrt <monte at ohrt dot com>
    19|  * @version 1.0
    20|  * @param string
    21|  * @param string
    22|  * @return string
    23|  */
    24| function smarty_modifier_cat($string, $cat)
    25| {
    26|     return $string . $cat;
    27| }
    28| /* vim: set expandtab: */
    29| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.count_characters.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-27 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty count_characters modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     count_characteres<br />
    12|  * Purpose:  count the number of characters in a text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.count.characters.php
    14|  *          count_characters (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param boolean include whitespace in the character count
    18|  * @return integer
    19|  */
    20| function smarty_modifier_count_characters($string, $include_spaces = false)
    21| {
    22|     if ($include_spaces)
    23|        return(strlen($string));
    24|     return preg_match_all("/[^\s]/",$string, $match);
    25| }
    26| /* vim: set expandtab: */
    27| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.count_paragraphs.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty count_paragraphs modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     count_paragraphs<br />
    12|  * Purpose:  count the number of paragraphs in a text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.count.paragraphs.php
    14|  *          count_paragraphs (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return integer
    18|  */
    19| function smarty_modifier_count_paragraphs($string)
    20| {
    21|     return count(preg_split('/[\r\n]+/', $string));
    22| }
    23| /* vim: set expandtab: */
    24| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.count_sentences.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-24 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty count_sentences modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     count_sentences
    12|  * Purpose:  count the number of sentences in a text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.count.paragraphs.php
    14|  *          count_sentences (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return integer
    18|  */
    19| function smarty_modifier_count_sentences($string)
    20| {
    21|     return preg_match_all('/[^\s]\.(?!\w)/', $string, $match);
    22| }
    23| /* vim: set expandtab: */
    24| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.count_words.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty count_words modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     count_words<br />
    12|  * Purpose:  count the number of words in a text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.count.words.php
    14|  *          count_words (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return integer
    18|  */
    19| function smarty_modifier_count_words($string)
    20| {
    21|     $preg_split_array = preg_split('/\s+/',$string);
    22|     $word_count = preg_grep('/[a-zA-Z0-9\\x80-\\xff]/', $preg_split_array);
    23|     return count($word_count);
    24| }
    25| /* vim: set expandtab: */
    26| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.date_format.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-55 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Include the {@link shared.make_timestamp.php} plugin
     9|  */
    10| require_once $smarty->_get_plugin_filepath('shared', 'make_timestamp');
    11| /**
    12|  * Smarty date_format modifier plugin
    13|  *
    14|  * Type:     modifier<br />
    15|  * Name:     date_format<br />
    16|  * Purpose:  format datestamps via strftime<br />
    17|  * Input:<br />
    18|  *         - string: input date string
    19|  *         - format: strftime format for output
    20|  *         - default_date: default date if $string is empty
    21|  * @link http://smarty.php.net/manual/en/language.modifier.date.format.php
    22|  *          date_format (Smarty online manual)
    23|  * @author   Monte Ohrt <monte at ohrt dot com>
    24|  * @param string
    25|  * @param string
    26|  * @param string
    27|  * @return string|void
    28|  * @uses smarty_make_timestamp()
    29|  */
    30| function smarty_modifier_date_format($string, $format = '%b %e, %Y', $default_date = '')
    31| {
    32|     if ($string != '') {
    33|         $timestamp = smarty_make_timestamp($string);
    34|     } elseif ($default_date != '') {
    35|         $timestamp = smarty_make_timestamp($default_date);
    36|     } else {
    37|         return;
    38|     }
    39|     if (DIRECTORY_SEPARATOR == '\\') {
    40|         $_win_from = array('%D',       '%h', '%n', '%r',          '%R',    '%t', '%T');
    41|         $_win_to   = array('%m/%d/%y', '%b', "\n", '%I:%M:%S %p', '%H:%M', "\t", '%H:%M:%S');
    42|         if (strpos($format, '%e') !== false) {
    43|             $_win_from[] = '%e';
    44|             $_win_to[]   = sprintf('%\' 2d', date('j', $timestamp));
    45|         }
    46|         if (strpos($format, '%l') !== false) {
    47|             $_win_from[] = '%l';
    48|             $_win_to[]   = sprintf('%\' 2d', date('h', $timestamp));
    49|         }
    50|         $format = str_replace($_win_from, $_win_to, $format);
    51|     }
    52|     return strftime($format, $timestamp);
    53| }
    54| /* vim: set expandtab: */
    55| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.debug_print_var.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-84 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty debug_print_var modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     debug_print_var<br />
    12|  * Purpose:  formats variable contents for display in the console
    13|  * @link http://smarty.php.net/manual/en/language.modifier.debug.print.var.php
    14|  *          debug_print_var (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param array|object
    17|  * @param integer
    18|  * @param integer
    19|  * @return string
    20|  */
    21| function smarty_modifier_debug_print_var($var, $depth = 0, $length = 40)
    22| {
    23|     $_replace = array(
    24|         "\n" => '<i>\n</i>',
    25|         "\r" => '<i>\r</i>',
    26|         "\t" => '<i>\t</i>'
    27|     );
    28|     switch (gettype($var)) {
    29|         case 'array' :
    30|             $results = '<b>Array (' . count($var) . ')</b>';
    31|             foreach ($var as $curr_key => $curr_val) {
    32|                 $results .= '<br />' . str_repeat('&nbsp;', $depth * 2)
    33|                     . '<b>' . strtr($curr_key, $_replace) . '</b> =&gt; '
    34|                     . smarty_modifier_debug_print_var($curr_val, ++$depth, $length);
    35|                     $depth--;
    36|             }
    37|             break;
    38|         case 'object' :
    39|             $object_vars = get_object_vars($var);
    40|             $results = '<b>' . get_class($var) . ' Object (' . count($object_vars) . ')</b>';
    41|             foreach ($object_vars as $curr_key => $curr_val) {
    42|                 $results .= '<br />' . str_repeat('&nbsp;', $depth * 2)
    43|                     . '<b> -&gt;' . strtr($curr_key, $_replace) . '</b> = '
    44|                     . smarty_modifier_debug_print_var($curr_val, ++$depth, $length);
    45|                     $depth--;
    46|             }
    47|             break;
    48|         case 'boolean' :
    49|         case 'NULL' :
    50|         case 'resource' :
    51|             if (true === $var) {
    52|                 $results = 'true';
    53|             } elseif (false === $var) {
    54|                 $results = 'false';
    55|             } elseif (null === $var) {
    56|                 $results = 'null';
    57|             } else {
    58|                 $results = htmlspecialchars((string) $var);
    59|             }
    60|             $results = '<i>' . $results . '</i>';
    61|             break;
    62|         case 'integer' :
    63|         case 'float' :
    64|             $results = htmlspecialchars((string) $var);
    65|             break;
    66|         case 'string' :
    67|             $results = strtr($var, $_replace);
    68|             if (strlen($var) > $length ) {
    69|                 $results = substr($var, 0, $length - 3) . '...';
    70|             }
    71|             $results = htmlspecialchars('"' . $results . '"');
    72|             break;
    73|         case 'unknown type' :
    74|         default :
    75|             $results = strtr((string) $var, $_replace);
    76|             if (strlen($results) > $length ) {
    77|                 $results = substr($results, 0, $length - 3) . '...';
    78|             }
    79|             $results = htmlspecialchars($results);
    80|     }
    81|     return $results;
    82| }
    83| /* vim: set expandtab: */
    84| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.default.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty default modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     default<br />
    12|  * Purpose:  designate default value for empty variables
    13|  * @link http://smarty.php.net/manual/en/language.modifier.default.php
    14|  *          default (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param string
    18|  * @return string
    19|  */
    20| function smarty_modifier_default($string, $default = '')
    21| {
    22|     if (!isset($string) || $string === '')
    23|         return $default;
    24|     else
    25|         return $string;
    26| }
    27| /* vim: set expandtab: */
    28| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.escape.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-72 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty escape modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     escape<br />
    12|  * Purpose:  Escape the string according to escapement type
    13|  * @link http://smarty.php.net/manual/en/language.modifier.escape.php
    14|  *          escape (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param html|htmlall|url|quotes|hex|hexentity|javascript
    18|  * @return string
    19|  */
    20| function smarty_modifier_escape($string, $esc_type = 'html', $char_set = 'ISO-8859-1')
    21| {
    22|     switch ($esc_type) {
    23|         case 'html':
    24|             return htmlspecialchars($string, ENT_QUOTES, $char_set);
    25|         case 'htmlall':
    26|             return htmlentities($string, ENT_QUOTES, $char_set);
    27|         case 'url':
    28|             return rawurlencode($string);
    29|         case 'urlpathinfo':
    30|             return str_replace('%2F','/',rawurlencode($string));
    31|         case 'quotes':
    32|             return preg_replace("%(?<!\\\\)'%", "\\'", $string);
    33|         case 'hex':
    34|             $return = '';
    35|             for ($x=0; $x < strlen($string); $x++) {
    36|                 $return .= '%' . bin2hex($string[$x]);
    37|             }
    38|             return $return;
    39|         case 'hexentity':
    40|             $return = '';
    41|             for ($x=0; $x < strlen($string); $x++) {
    42|                 $return .= '&#x' . bin2hex($string[$x]) . ';';
    43|             }
    44|             return $return;
    45|         case 'decentity':
    46|             $return = '';
    47|             for ($x=0; $x < strlen($string); $x++) {
    48|                 $return .= '&#' . ord($string[$x]) . ';';
    49|             }
    50|             return $return;
    51|         case 'javascript':
    52|             return strtr($string, array('\\'=>'\\\\',"'"=>"\\'",'"'=>'\\"',"\r"=>'\\r',"\n"=>'\\n','</'=>'<\/'));
    53|         case 'mail':
    54|             return str_replace(array('@', '.'),array(' [AT] ', ' [DOT] '), $string);
    55|         case 'nonstd':
    56|            $_res = '';
    57|            for($_i = 0, $_len = strlen($string); $_i < $_len; $_i++) {
    58|                $_ord = ord(substr($string, $_i, 1));
    59|                if($_ord >= 126){
    60|                    $_res .= '&#' . $_ord . ';';
    61|                }
    62|                else {
    63|                    $_res .= substr($string, $_i, 1);
    64|                }
    65|            }
    66|            return $_res;
    67|         default:
    68|             return $string;
    69|     }
    70| }
    71| /* vim: set expandtab: */
    72| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.indent.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty indent modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     indent<br />
    12|  * Purpose:  indent lines of text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.indent.php
    14|  *          indent (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param integer
    18|  * @param string
    19|  * @return string
    20|  */
    21| function smarty_modifier_indent($string,$chars=4,$char=" ")
    22| {
    23|     return preg_replace('!^!m',str_repeat($char,$chars),$string);
    24| }
    25| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.lower.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty lower modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     lower<br />
    12|  * Purpose:  convert string to lowercase
    13|  * @link http://smarty.php.net/manual/en/language.modifier.lower.php
    14|  *          lower (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return string
    18|  */
    19| function smarty_modifier_lower($string)
    20| {
    21|     return strtolower($string);
    22| }
    23| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.nl2br.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-31 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     nl2br<br />
    12|  * Date:     Feb 26, 2003
    13|  * Purpose:  convert \r\n, \r or \n to <<br />>
    14|  * Input:<br />
    15|  *         - contents = contents to replace
    16|  *         - preceed_test = if true, includes preceeding break tags
    17|  *           in replacement
    18|  * Example:  {$text|nl2br}
    19|  * @link http://smarty.php.net/manual/en/language.modifier.nl2br.php
    20|  *          nl2br (Smarty online manual)
    21|  * @version  1.0
    22|  * @author   Monte Ohrt <monte at ohrt dot com>
    23|  * @param string
    24|  * @return string
    25|  */
    26| function smarty_modifier_nl2br($string)
    27| {
    28|     return nl2br($string);
    29| }
    30| /* vim: set expandtab: */
    31| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.regex_replace.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-30 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty regex_replace modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     regex_replace<br />
    12|  * Purpose:  regular expression search/replace
    13|  * @link http://smarty.php.net/manual/en/language.modifier.regex.replace.php
    14|  *          regex_replace (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param string|array
    18|  * @param string|array
    19|  * @return string
    20|  */
    21| function smarty_modifier_regex_replace($string, $search, $replace)
    22| {
    23|     if (preg_match('!([a-zA-Z\s]+)$!s', $search, $match) && (strpos($match[1], 'e') !== false)) {
    24|         /* remove eval-modifier from $search */
    25|         $search = substr($search, 0, -strlen($match[1])) . preg_replace('![e\s]+!', '', $match[1]);
    26|     }
    27|     return preg_replace($search, $replace, $string);
    28| }
    29| /* vim: set expandtab: */
    30| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.replace.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty replace modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     replace<br />
    12|  * Purpose:  simple search/replace
    13|  * @link http://smarty.php.net/manual/en/language.modifier.replace.php
    14|  *          replace (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param string
    18|  * @param string
    19|  * @return string
    20|  */
    21| function smarty_modifier_replace($string, $search, $replace)
    22| {
    23|     return str_replace($search, $replace, $string);
    24| }
    25| /* vim: set expandtab: */
    26| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.spacify.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty spacify modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     spacify<br />
    12|  * Purpose:  add spaces between characters in a string
    13|  * @link http://smarty.php.net/manual/en/language.modifier.spacify.php
    14|  *          spacify (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param string
    18|  * @return string
    19|  */
    20| function smarty_modifier_spacify($string, $spacify_char = ' ')
    21| {
    22|     return implode($spacify_char,
    23|                    preg_split('//', $string, -1, preg_split_NO_EMPTY));
    24| }
    25| /* vim: set expandtab: */
    26| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.string_format.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-25 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty string_format modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     string_format<br />
    12|  * Purpose:  format strings via sprintf
    13|  * @link http://smarty.php.net/manual/en/language.modifier.string.format.php
    14|  *          string_format (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param string
    18|  * @return string
    19|  */
    20| function smarty_modifier_string_format($string, $format)
    21| {
    22|     return sprintf($format, $string);
    23| }
    24| /* vim: set expandtab: */
    25| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.strip.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-29 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty strip modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     strip<br />
    12|  * Purpose:  Replace all repeated spaces, newlines, tabs
    13|  *           with a single space or supplied replacement string.<br />
    14|  * Example:  {$var|strip} {$var|strip:"&nbsp;"}
    15|  * Date:     September 25th, 2002
    16|  * @link http://smarty.php.net/manual/en/language.modifier.strip.php
    17|  *          strip (Smarty online manual)
    18|  * @author   Monte Ohrt <monte at ohrt dot com>
    19|  * @version  1.0
    20|  * @param string
    21|  * @param string
    22|  * @return string
    23|  */
    24| function smarty_modifier_strip($text, $replace = ' ')
    25| {
    26|     return preg_replace('!\s+!', $replace, $text);
    27| }
    28| /* vim: set expandtab: */
    29| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.strip_tags.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-28 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty strip_tags modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     strip_tags<br />
    12|  * Purpose:  strip html tags from text
    13|  * @link http://smarty.php.net/manual/en/language.modifier.strip.tags.php
    14|  *          strip_tags (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param boolean
    18|  * @return string
    19|  */
    20| function smarty_modifier_strip_tags($string, $replace_with_space = true)
    21| {
    22|     if ($replace_with_space)
    23|         return preg_replace('!<[^>]*?>!', ' ', $string);
    24|     else
    25|         return strip_tags($string);
    26| }
    27| /* vim: set expandtab: */
    28| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.truncate.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-45 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty truncate modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     truncate<br />
    12|  * Purpose:  Truncate a string to a certain length if necessary,
    13|  *           optionally preg_splitting in the middle of a word, and
    14|  *           appending the $etc string or inserting $etc into the middle.
    15|  * @link http://smarty.php.net/manual/en/language.modifier.truncate.php
    16|  *          truncate (Smarty online manual)
    17|  * @author   Monte Ohrt <monte at ohrt dot com>
    18|  * @param string
    19|  * @param integer
    20|  * @param string
    21|  * @param boolean
    22|  * @param boolean
    23|  * @return string
    24|  */
    25| function smarty_modifier_truncate($string, $length = 80, $etc = '...',
    26|                                   $break_words = false, $middle = false)
    27| {
    28|     if ($length == 0)
    29|         return '';
    30|     if (strlen($string) > $length) {
    31|         $length -= min($length, strlen($etc));
    32|         if (!$break_words && !$middle) {
    33|             $string = preg_replace('/\s+?(\S+)?$/', '', substr($string, 0, $length+1));
    34|         }
    35|         if(!$middle) {
    36|             return substr($string, 0, $length) . $etc;
    37|         } else {
    38|             return substr($string, 0, $length/2) . $etc . substr($string, -$length/2);
    39|         }
    40|     } else {
    41|         return $string;
    42|     }
    43| }
    44| /* vim: set expandtab: */
    45| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.upper.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-23 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty upper modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     upper<br />
    12|  * Purpose:  convert string to uppercase
    13|  * @link http://smarty.php.net/manual/en/language.modifier.upper.php
    14|  *          upper (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @return string
    18|  */
    19| function smarty_modifier_upper($string)
    20| {
    21|     return strtoupper($string);
    22| }
    23| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/modifier.wordwrap.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-26 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty wordwrap modifier plugin
     9|  *
    10|  * Type:     modifier<br />
    11|  * Name:     wordwrap<br />
    12|  * Purpose:  wrap a string of text at a given length
    13|  * @link http://smarty.php.net/manual/en/language.modifier.wordwrap.php
    14|  *          wordwrap (Smarty online manual)
    15|  * @author   Monte Ohrt <monte at ohrt dot com>
    16|  * @param string
    17|  * @param integer
    18|  * @param string
    19|  * @param boolean
    20|  * @return string
    21|  */
    22| function smarty_modifier_wordwrap($string,$length=80,$break="\n",$cut=false)
    23| {
    24|     return wordwrap($string,$length,$break,$cut);
    25| }
    26| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/outputfilter.trimwhitespace.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-56 ---
     1| <?php
     2| /**
     3|  * Smarty plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Smarty trimwhitespace outputfilter plugin
     9|  *
    10|  * File:     outputfilter.trimwhitespace.php<br />
    11|  * Type:     outputfilter<br />
    12|  * Name:     trimwhitespace<br />
    13|  * Date:     Jan 25, 2003<br />
    14|  * Purpose:  trim leading white space and blank lines from
    15|  *           template source after it gets interpreted, cleaning
    16|  *           up code and saving bandwidth. Does not affect
    17|  *           <<PRE>></PRE> and <SCRIPT></SCRIPT> blocks.<br />
    18|  * Install:  Drop into the plugin directory, call
    19|  *           <code>$smarty->load_filter('output','trimwhitespace');</code>
    20|  *           from application.
    21|  * @author   Monte Ohrt <monte at ohrt dot com>
    22|  * @author Contributions from Lars Noschinski <lars@usenet.noschinski.de>
    23|  * @version  1.3
    24|  * @param string
    25|  * @param Smarty
    26|  */
    27| function smarty_outputfilter_trimwhitespace($source, &$smarty)
    28| {
    29|     preg_match_all("!<script[^>]+>.*?</script>!is", $source, $match);
    30|     $_script_blocks = $match[0];
    31|     $source = preg_replace("!<script[^>]+>.*?</script>!is",
    32|                            '@@@SMARTY:TRIM:SCRIPT@@@', $source);
    33|     preg_match_all("!<pre>.*?</pre>!is", $source, $match);
    34|     $_pre_blocks = $match[0];
    35|     $source = preg_replace("!<pre>.*?</pre>!is",
    36|                            '@@@SMARTY:TRIM:PRE@@@', $source);
    37|     preg_match_all("!<textarea[^>]+>.*?</textarea>!is", $source, $match);
    38|     $_textarea_blocks = $match[0];
    39|     $source = preg_replace("!<textarea[^>]+>.*?</textarea>!is",
    40|                            '@@@SMARTY:TRIM:TEXTAREA@@@', $source);
    41|     $source = trim(preg_replace('/((?<!\?>)\n)[\s]+/m', '\1', $source));
    42|     smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:TEXTAREA@@@",$_textarea_blocks, $source);
    43|     smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:PRE@@@",$_pre_blocks, $source);
    44|     smarty_outputfilter_trimwhitespace_replace("@@@SMARTY:TRIM:SCRIPT@@@",$_script_blocks, $source);
    45|     return $source;
    46| }
    47| function smarty_outputfilter_trimwhitespace_replace($search_str, $replace, &$subject) {
    48|     $_len = strlen($search_str);
    49|     $_pos = 0;
    50|     for ($_i=0, $_count=count($replace); $_i<$_count; $_i++)
    51|         if (($_pos=strpos($subject, $search_str, $_pos))!==false)
    52|             $subject = substr_replace($subject, $replace[$_i], $_pos, $_len);
    53|         else
    54|             break;
    55| }
    56| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/shared.escape_special_chars.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-27 ---
     1| <?php
     2| /**
     3|  * Smarty shared plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * escape_special_chars common function
     9|  *
    10|  * Function: smarty_function_escape_special_chars<br />
    11|  * Purpose:  used by other smarty functions to escape
    12|  *           special chars except for already escaped ones
    13|  * @author   Monte Ohrt <monte at ohrt dot com>
    14|  * @param string
    15|  * @return string
    16|  */
    17| function smarty_function_escape_special_chars($string)
    18| {
    19|     if(!is_array($string)) {
    20|         $string = preg_replace('!&(#?\w+);!', '%%%SMARTY_START%%%\\1%%%SMARTY_END%%%', $string);
    21|         $string = htmlspecialchars($string);
    22|         $string = str_replace(array('%%%SMARTY_START%%%','%%%SMARTY_END%%%'), array('&',';'), $string);
    23|     }
    24|     return $string;
    25| }
    26| /* vim: set expandtab: */
    27| ?>


# ====================================================================
# FILE: GPL_LIB/Smarty/libs/plugins/shared.make_timestamp.php
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-33 ---
     1| <?php
     2| /**
     3|  * Smarty shared plugin
     4|  * @package Smarty
     5|  * @subpackage plugins
     6|  */
     7| /**
     8|  * Function: smarty_make_timestamp<br />
     9|  * Purpose:  used by other smarty functions to make a timestamp
    10|  *           from a string.
    11|  * @author   Monte Ohrt <monte at ohrt dot com>
    12|  * @param string
    13|  * @return string
    14|  */
    15| function smarty_make_timestamp($string)
    16| {
    17|     if(empty($string)) {
    18|         $time = time();
    19|     } elseif (preg_match('/^\d{14}$/', $string)) {
    20|         $time = mktime(substr($string, 8, 2),substr($string, 10, 2),substr($string, 12, 2),
    21|                        substr($string, 4, 2),substr($string, 6, 2),substr($string, 0, 4));
    22|     } elseif (is_numeric($string)) {
    23|         $time = (int)$string;
    24|     } else {
    25|         $time = strtotime($string);
    26|         if ($time == -1 || $time === false) {
    27|             $time = time();
    28|         }
    29|     }
    30|     return $time;
    31| }
    32| /* vim: set expandtab: */
    33| ?>

