--- a/phpmyfaq/404.php
+++ b//dev/null
@@ -1,28 +0,0 @@
-<?php
-/**
- * 404 error page
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2019-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2019-01-25
- */
-use phpMyFAQ\Enums\SessionActionType;
-use phpMyFAQ\Template\TwigWrapper;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking(SessionActionType::NOT_FOUND->value, 0);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./404.twig');

--- a/phpmyfaq/add.php
+++ b//dev/null
@@ -1,115 +0,0 @@
-<?php
-/**
- * This is the page there a user can add a FAQ record.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-16
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Enums\Forms\FormIds;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Forms;
-use phpMyFAQ\Helper\CategoryHelper as HelperCategory;
-use phpMyFAQ\Question;
-use phpMyFAQ\Strings;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqSystem = new System();
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-if (-1 === $user->getUserId() && !$faqConfig->get('records.allowNewFaqsForGuests')) {
-    $response = new RedirectResponse($faqSystem->getSystemUri($faqConfig) . 'login');
-    $response->send();
-}
-if (-1 !== $user->getUserId() && !$user->perm->hasPermission($user->getUserId(), PermissionType::FAQ_ADD->value)) {
-    $response = new RedirectResponse($faqSystem->getSystemUri($faqConfig));
-    $response->send();
-}
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$questionObject = new Question($faqConfig);
-$faqSession->userTracking('new_entry', 0);
-$selectedQuestion = Filter::filterVar($request->query->get('question'), FILTER_VALIDATE_INT);
-$selectedCategory = Filter::filterVar($request->query->get('cat'), FILTER_VALIDATE_INT, -1);
-$question = '';
-$readonly = '';
-$displayFullForm = false;
-if (!is_null($selectedQuestion)) {
-    $questionData = $questionObject->get($selectedQuestion);
-    $question = Strings::htmlentities($questionData['question']);
-    if (Strings::strlen($question) !== 0) {
-        $readonly = ' readonly';
-    }
-    $displayFullForm = true;
-}
-$category->buildCategoryTree();
-$categoryHelper = new HelperCategory();
-$categoryHelper->setCategory($category);
-$captchaHelper = $container->get('phpmyfaq.captcha.helper.captcha_helper');
-$forms = new Forms($faqConfig);
-$formData = $forms->getFormData(FormIds::ADD_NEW_FAQ->value);
-$category = new Category($faqConfig);
-$categories = $category->getAllCategoryIds();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./add.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgAddContent'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf('%s | %s', Translation::get('msgNewContentHeader'), $faqConfig->getTitle()),
-    'msgNewContentHeader' => Translation::get('msgNewContentHeader'),
-    'msgNewContentAddon' => Translation::get('msgNewContentAddon'),
-    'lang' => $Language->getLanguage(),
-    'openQuestionID' => $selectedQuestion,
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'msgNewContentName' => Translation::get('msgNewContentName'),
-    'msgNewContentMail' => Translation::get('msgNewContentMail'),
-    'msgNewContentCategory' => Translation::get('msgNewContentCategory'),
-    'renderCategoryOptions' => $categoryHelper->renderOptions($selectedCategory),
-    'msgNewContentTheme' => Translation::get('msgNewContentTheme'),
-    'readonly' => $readonly,
-    'printQuestion' => $question,
-    'msgNewContentArticle' => Translation::get('msgNewContentArticle'),
-    'msgNewContentKeywords' => Translation::get('msgNewContentKeywords'),
-    'msgNewContentLink' => Translation::get('msgNewContentLink'),
-    'captchaFieldset' =>
-        $captchaHelper->renderCaptcha($captcha, 'add', Translation::get('msgCaptcha'), $user->isLoggedIn()),
-    'msgNewContentSubmit' => Translation::get('msgNewContentSubmit'),
-    'enableWysiwygEditor' => $faqConfig->get('main.enableWysiwygEditorFrontend'),
-    'currentTimestamp' => $request->server->get('REQUEST_TIME'),
-    'msgSeparateKeywordsWithCommas' => Translation::get('msgSeparateKeywordsWithCommas'),
-    'noCategories' => empty($categories),
-    'msgFormDisabledDueToMissingCategories' => Translation::get('msgFormDisabledDueToMissingCategories'),
-    'displayFullForm' => $displayFullForm,
-];
-foreach ($formData as $input) {
-    $active = sprintf('id%d_active', (int)$input->input_id);
-    $label = sprintf('id%d_label', (int)$input->input_id);
-    $required = sprintf('id%d_required', (int)$input->input_id);
-    $templateVars = [
-        ...$templateVars,
-        $active => (bool)$input->input_active,
-        $label => $input->input_label,
-        $required => ((int)$input->input_required !== 0) ? 'required' : ''
-    ];
-}
-return $templateVars;

--- a/phpmyfaq/admin/attachments.php
+++ b//dev/null
@@ -1,72 +0,0 @@
-<?php
-/**
- * Frontend for handling with attachments.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Anatoliy Belsky <ab@php.net>
- * @copyright 2010-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2010-12-13
- */
-use phpMyFAQ\Attachment\AttachmentCollection;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\FormatBytesTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::ATTACHMENT_DELETE->value)) {
-    $page = Filter::filterVar($request->query->get('page'), FILTER_VALIDATE_INT);
-    $page = max(1, $page);
-    $attachmentCollection = new AttachmentCollection($faqConfig);
-    $itemsPerPage = 24;
-    $allCrumbs = $attachmentCollection->getBreadcrumbs();
-    $crumbs = array_slice($allCrumbs, ($page - 1) * $itemsPerPage, $itemsPerPage);
-    $baseUrl = sprintf(
-        '%sadmin/?action=attachments&amp;page=%d',
-        $faqConfig->getDefaultUrl(),
-        $page
-    );
-    $pagination = new Pagination(
-        [
-            'baseUrl' => $baseUrl,
-            'total' => is_countable($allCrumbs) ? count($allCrumbs) : 0,
-            'perPage' => $itemsPerPage,
-        ]
-    );
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addExtension(new FormatBytesTwigExtension());
-    $template = $twig->loadTemplate('@admin/content/attachments.twig');
-    $templateVars = [
-        'adminHeaderAttachments' => Translation::get('ad_menu_attachment_admin'),
-        'adminMsgAttachmentsFilename' => Translation::get('msgAttachmentsFilename'),
-        'adminMsgTransToolLanguage' => Translation::get('msgTransToolLanguage'),
-        'adminMsgAttachmentsFilesize' => Translation::get('msgAttachmentsFilesize'),
-        'adminMsgAttachmentsMimeType' => Translation::get('msgAttachmentsMimeType'),
-        'csrfTokenDeletion' => Token::getInstance()->getTokenString('delete-attachment'),
-        'csrfTokenRefresh' => Token::getInstance()->getTokenString('refresh-attachment'),
-        'attachments' => $crumbs,
-        'adminMsgButtonDelete' => Translation::get('ad_gen_delete'),
-        'adminMsgFaqTitle' => Translation::get('ad_entry_faq_record'),
-        'adminAttachmentPagination' => $pagination->render()
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/backup.import.php
+++ b//dev/null
@@ -1,186 +0,0 @@
-<?php
-/**
- * The import function to import the phpMyFAQ backups.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Administration\Backup;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Database\DatabaseHelper;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-if (
-    $user->perm->hasPermission($user->getUserId(), PermissionType::RESTORE->value) &&
-    Token::getInstance()->verifyToken('restore', $csrfToken)
-) {
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/backup/import.twig');
-    $templateVars = [
-        'adminHeaderRestore' => Translation::get('ad_csv_rest')
-    ];
-    $request = Request::createFromGlobals();
-    $file = $request->files->get('userfile');
-    if ($file && $file->isValid()) {
-        $ok = 1;
-        $fileInfo = new finfo(FILEINFO_MIME_ENCODING);
-        $dbHelper = new DatabaseHelper($faqConfig);
-        $backup = new Backup($faqConfig, $dbHelper);
-        if ('utf-8' !== $fileInfo->file($file->getPathname())) {
-            $templateVars = [
-                ...$templateVars,
-                'errorMessageWrongEncoding' => 'This file is not UTF-8 encoded.'
-            ];
-            $ok = 0;
-        }
-        $handle = fopen($file->getPathname(), 'r');
-        $backupData = fgets($handle, 65536);
-        $versionFound = Strings::substr($backupData, 0, 9);
-        $versionExpected = '-- pmf' . substr($faqConfig->getVersion(), 0, 3);
-        $queries = [];
-        $fileName = $file->getClientOriginalName();
-        try {
-            $verification = $backup->verifyBackup(file_get_contents($file->getPathname()), $fileName);
-            if ($verification) {
-                $ok = 1;
-            } else {
-                $templateVars = [
-                    ...$templateVars,
-                    'errorMessageNoVerification' => 'This file is not a verified backup file.'
-                ];
-                $ok = 0;
-            }
-        } catch (SodiumException) {
-            $templateVars = [
-                ...$templateVars,
-                'errorMessageNoVerification' => 'This file cannot be verified.'
-            ];
-            $ok = 0;
-        }
-        if ($versionFound !== $versionExpected) {
-            $templateVars = [
-                ...$templateVars,
-                'errorMessageVersionMisMatch' => sprintf(
-                    '%s (Version check failure: "%s" found, "%s" expected)',
-                    Translation::get('ad_csv_no'),
-                    $versionFound,
-                    $versionExpected
-                )
-            ];
-            $ok = 0;
-        }
-        if ($ok === 1) {
-            $backupData = trim(Strings::substr($backupData, 11));
-            $tables = explode(' ', $backupData);
-            $numTables = count($tables);
-            for ($h = 0; $h < $numTables; ++$h) {
-                $queries[] = sprintf('DELETE FROM %s', $tables[$h]);
-            }
-            $ok = 1;
-        }
-        if ($ok === 1) {
-            $tablePrefix = '';
-            $templateVars = [
-                ...$templateVars,
-                'prepareMessage' => Translation::get('ad_csv_prepare')
-            ];
-            while ($backupData = fgets($handle, 65536)) {
-                $backupData = trim($backupData);
-                $backupPrefixPattern = '-- pmftableprefix:';
-                $backupPrefixPatternLength = Strings::strlen($backupPrefixPattern);
-                if (Strings::substr($backupData, 0, $backupPrefixPatternLength) === $backupPrefixPattern) {
-                    $tablePrefix = trim(Strings::substr($backupData, $backupPrefixPatternLength));
-                }
-                if ((Strings::substr($backupData, 0, 2) != '--') && ($backupData != '')) {
-                    $queries[] = trim(Strings::substr($backupData, 0, -1));
-                }
-            }
-            $k = 0;
-            $g = 0;
-            $templateVars = [
-                ...$templateVars,
-                'processMessage' => Translation::get('ad_csv_process')
-            ];
-            $numTables = count($queries);
-            $kg = '';
-            for ($i = 0; $i < $numTables; ++$i) {
-                $queries[$i] = DatabaseHelper::alignTablePrefix($queries[$i], $tablePrefix, Database::getTablePrefix());
-                $kg = $faqConfig->getDb()->query($queries[$i]);
-                if (!$kg) {
-                    $templateVars = [
-                        ...$templateVars,
-                        'errorMessageQueryFailed' => sprintf(
-                            '<strong>Query</strong>: "%s" failed (Reason: %s)',
-                            Strings::htmlspecialchars($queries[$i], ENT_QUOTES),
-                            $faqConfig->getDb()->error()
-                        )
-                    ];
-                    ++$k;
-                } else {
-                    printf(
-                        '<!-- Query: "%s" okay</div> -->%s',
-                        Strings::htmlspecialchars($queries[$i], ENT_QUOTES),
-                        "\n"
-                    );
-                    ++$g;
-                }
-            }
-            $templateVars = [
-                ...$templateVars,
-                'successMessage' => sprintf(
-                    '%d %s %d %s',
-                    $g,
-                    Translation::get('ad_csv_of'),
-                    $numTables,
-                    Translation::get('ad_csv_suc')
-                )
-            ];
-        } else {
-            $templateVars = [
-                ...$templateVars,
-                'errorMessageImportNotPossible' => Translation::get('ad_csv_no')
-            ];
-        }
-    } else {
-        $errorMessage = match ($file->getError()) {
-            1 => 'The uploaded file exceeds the upload_max_filesize directive in php.ini.',
-            2 => 'The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the ' . 'HTML form.',
-            3 => 'The uploaded file was only partially uploaded.',
-            4 => 'No file was uploaded.',
-            6 => 'Missing a temporary folder.',
-            7 => 'Failed to write file to disk.',
-            8 => 'A PHP extension stopped the file upload.',
-            default => 'Undefined error.',
-        };
-        $templateVars = [
-            ...$templateVars,
-            'errorMessageUpload' => Translation::get('ad_csv_no'),
-            'errorMessageUploadDetails' => $errorMessage
-        ];
-    }
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/backup.main.php
+++ b//dev/null
@@ -1,46 +0,0 @@
-<?php
-/**
- * Frontend for Backup and Restore.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::BACKUP->value)) {
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/backup/main.twig');
-    $templateVars = [
-        'adminHeaderBackup' => Translation::get('ad_csv_backup'),
-        'adminBackupCardHeader' => Translation::get('ad_csv_head'),
-        'adminBackupCardBody' => Translation::get('ad_csv_make'),
-        'adminBackupLinkData' => Translation::get('ad_csv_linkdat'),
-        'adminBackupLinkLogs' => Translation::get('ad_csv_linklog'),
-        'csrfToken' => Token::getInstance()->getTokenString('restore'),
-        'adminRestoreCardHeader' => Translation::get('ad_csv_head2'),
-        'adminRestoreCardBody' => Translation::get('ad_csv_restore'),
-        'adminRestoreLabel' => Translation::get('ad_csv_file'),
-        'adminRestoreButton' => Translation::get('ad_csv_ok'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/category.add.php
+++ b//dev/null
@@ -1,90 +0,0 @@
-<?php
-/**
- * Adds a new (sub-)category, a new sub-category inherits the permissions from
- * its parent category.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-12-20
- */
-use phpMyFAQ\Category\Permission;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\UserHelper;
-use phpMyFAQ\Language\LanguageCodes;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Translation;
-use phpMyFAQ\Template\TwigWrapper;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$currentUser = $container->get('phpmyfaq.user.current_user');
-if ($currentUser->perm->hasPermission($currentUser->getUserId(), PermissionType::CATEGORY_ADD->value)) {
-    $category = $container->get('phpmyfaq.admin.category');
-    $category->setUser($currentUser->getUserId());
-    $category->setGroups($currentAdminGroups);
-    $category->setLanguage($faqConfig->getLanguage()->getLanguage());
-    $category->loadCategories();
-    $categoryPermission = $container->get('phpmyfaq.category.permission');
-    $userHelper = new UserHelper($currentUser);
-    $parentId = Filter::filterInput(INPUT_GET, 'cat', FILTER_VALIDATE_INT, 0);
-    $templateVars = [
-        'csrfTokenInput' => Token::getInstance()->getTokenInput('save-category'),
-        'faqLangCode' => $faqLangCode,
-        'parentId' => $parentId,
-        'ad_categ_new' => Translation::get('ad_categ_new'),
-        'msgCategoryMatrix' => Translation::get('msgCategoryMatrix'),
-        'userOptions' => $userHelper->getAllUserOptions(),
-        'ad_categ_title' => Translation::get('ad_categ_titel'),
-        'ad_categ_owner' => Translation::get('ad_categ_owner'),
-        'ad_categ_desc' => Translation::get('ad_categ_desc'),
-        'ad_category_image' => Translation::get('ad_category_image'),
-        'ad_user_active' => Translation::get('ad_user_active'),
-        'ad_user_show_home' => Translation::get('ad_user_show_home'),
-        'permLevel' => $faqConfig->get('security.permLevel'),
-        'ad_entry_all_users' => Translation::get('ad_entry_all_users'),
-        'ad_entry_restricted_users' => Translation::get('ad_entry_restricted_users'),
-        'ad_entry_userpermission' => Translation::get('ad_entry_userpermission'),
-        'ad_categ_add' => Translation::get('ad_categ_add'),
-        'ad_entry_grouppermission' => Translation::get('ad_entry_grouppermission'),
-        'ad_entry_all_groups' => Translation::get('ad_entry_all_groups'),
-        'ad_entry_restricted_groups' => Translation::get('ad_entry_restricted_groups'),
-        'msgSerpTitle' => Translation::get('msgSerpTitle'),
-        'msgSerpDescription' => Translation::get('msgSerpDescription'),
-        'restricted_groups' => ($faqConfig->get('security.permLevel') === 'medium') ?
-            $currentUser->perm->getAllGroupsOptions([], $user) : '',
-    ];
-    if ($parentId > 0) {
-        $userAllowed = $categoryPermission->get(Permission::USER, [$parentId]);
-        $groupsAllowed = $categoryPermission->get(Permission::GROUP, [$parentId]);
-        $templateVars = [
-            ...$templateVars,
-            'categoryNameLangCode' => LanguageCodes::get($category->categoryName[$parentId]['lang']),
-            'userAllowed' => $categoryPermission->get(Permission::USER, [$parentId])[0],
-            'groupsAllowed' => $categoryPermission->get(Permission::GROUP, [$parentId]),
-            'categoryName' => $category->categoryName[$parentId]['name'],
-            'msgMainCategory' => Translation::get('msgMainCategory'),
-        ];
-    }
-    if ($faqConfig->get('security.permLevel') !== 'basic') {
-        $templateVars = [
-            ...$templateVars,
-            'groupsOptions' => $currentUser->perm->getAllGroupsOptions([], $currentUser),
-            'ad_categ_moderator' => Translation::get('ad_categ_moderator')
-        ];
-    }
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/category.add.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/category.edit.php
+++ b//dev/null
@@ -1,122 +0,0 @@
-<?php
-/**
- * Edits a category.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-03-10
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Permission;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Entity\SeoEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\SeoType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\UserHelper;
-use phpMyFAQ\Seo;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$currentUser = CurrentUser::getCurrentUser($faqConfig);
-$currentUserId = $currentUser->getUserId();
-if ($currentUser->perm->hasPermission($currentUser->getUserId(), PermissionType::CATEGORY_EDIT->value)) {
-    $categoryId = Filter::filterInput(INPUT_GET, 'cat', FILTER_VALIDATE_INT, 0);
-    $category = new Category($faqConfig, [], false);
-    $category
-        ->setUser($currentAdminUser)
-        ->setGroups($currentAdminGroups)
-        ->setLanguage($faqLangCode);
-    $categoryPermission = new Permission($faqConfig);
-    $userHelper = new UserHelper($currentUser);
-    $categoryData = $category->getCategoryData($categoryId);
-    $seo = new Seo($faqConfig);
-    $seoEntity = new SeoEntity();
-    $seoEntity->setType(SeoType::CATEGORY);
-    $seoEntity->setReferenceId($categoryId);
-    $seoEntity->setReferenceLanguage($categoryData->getLang());
-    $seoData = $seo->get($seoEntity);
-    $userPermission = $categoryPermission->get(Permission::USER, [$categoryId]);
-    if ($userPermission[0] == -1) {
-        $allUsers = true;
-        $restrictedUsers = false;
-    } else {
-        $allUsers = false;
-        $restrictedUsers = true;
-    }
-    $groupPermission = $categoryPermission->get(Permission::GROUP, [$categoryId]);
-    if ($groupPermission[0] == -1) {
-        $allGroups = true;
-        $restrictedGroups = false;
-    } else {
-        $allGroups = false;
-        $restrictedGroups = true;
-    }
-    $header = Translation::get('ad_categ_edit_1') . ' "' . $categoryData->getName() . '" ' .
-        Translation::get('ad_categ_edit_2');
-    $allGroupsOptions = '';
-    $restrictedGroupsOptions = '';
-    if ($faqConfig->get('security.permLevel') !== 'basic') {
-        $allGroupsOptions = $currentUser->perm->getAllGroupsOptions([$categoryData->getGroupId()], $currentUser);
-        $restrictedGroupsOptions = $currentUser->perm->getAllGroupsOptions($groupPermission, $currentUser);
-    }
-    $templateVars = [
-        'header' => $header,
-        'categoryId' => $categoryId,
-        'categoryLanguage' => $categoryData->getLang(),
-        'parentId' => $categoryData->getParentId(),
-        'csrfInputToken' => Token::getInstance()->getTokenInput('update-category'),
-        'categoryImage' => $categoryData->getImage(),
-        'categoryNameLabel' => Translation::get('ad_categ_titel'),
-        'categoryName' => $categoryData->getName(),
-        'categoryDescriptionLabel' => Translation::get('ad_categ_desc'),
-        'categoryDescription' => $categoryData->getDescription(),
-        'categoryActiveLabel' => Translation::get('ad_user_active'),
-        'categoryActive' => 1 === (int)$categoryData->getActive() ? 'checked' : '',
-        'categoryShowHomeLabel' => Translation::get('ad_user_show_home'),
-        'categoryShowHome' => 1 === (int)$categoryData->getShowHome() ? 'checked' : '',
-        'categoryImageLabel' => Translation::get('ad_category_image'),
-        'categoryImageReset' => 'Reset category image',
-        'categoryOwnerLabel' => Translation::get('ad_categ_owner'),
-        'categoryOwnerOptions' => $userHelper->getAllUserOptions($categoryData->getUserId()),
-        'isMediumPermission' => $faqConfig->get('security.permLevel') !== 'basic',
-        'categoryModeratorLabel' => Translation::get('ad_categ_moderator'),
-        'allGroupsOptions' => $allGroupsOptions,
-        'categoryGroupPermissionLabel' => Translation::get('ad_entry_grouppermission'),
-        'allGroups' => $allGroups ? 'checked' : '',
-        'categoryGroupPermissionAllLabel' => Translation::get('ad_entry_all_groups'),
-        'restrictedGroups' => $restrictedGroups ? 'checked' : '',
-        'restrictedGroupsLabel' => Translation::get('ad_entry_restricted_groups'),
-        'restrictedGroupsOptions' => $restrictedGroupsOptions,
-        'userPermissionLabel' => Translation::get('ad_entry_userpermission'),
-        'allUsers' => $allUsers ? 'checked' : '',
-        'allUsersLabel' => Translation::get('ad_entry_all_users'),
-        'restrictedUsers' => $restrictedUsers ? 'checked' : '',
-        'restrictedUsersLabel' => Translation::get('ad_entry_restricted_users'),
-        'allUsersOptions' => $userHelper->getAllUserOptions($categoryData->getUserId()),
-        'msgSerpTitle' => Translation::get('msgSerpTitle'),
-        'serpTitle' => $seoData->getTitle(),
-        'msgSerpDescription' => Translation::get('msgSerpDescription'),
-        'serpDescription' => $seoData->getDescription(),
-        'buttonUpdate' => Translation::get('ad_gen_save'),
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/category.edit.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/category.main.php
+++ b//dev/null
@@ -1,301 +0,0 @@
-<?php
-/**
- * List all categories in the admin section.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at http://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-12-20
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Image;
-use phpMyFAQ\Category\Order;
-use phpMyFAQ\Category\Permission;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Entity\CategoryEntity;
-use phpMyFAQ\Entity\SeoEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\SeoType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Seo;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\File\UploadedFile;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$currentUser = CurrentUser::getCurrentUser($faqConfig);
-$csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-$request = Request::createFromGlobals();
-$uploadedFile = $request->files->get('image') ?? [];
-$categoryImage = new Image($faqConfig);
-if ($uploadedFile instanceof UploadedFile) {
-    $categoryImage->setUploadedFile($uploadedFile);
-}
-$categoryPermission = new Permission($faqConfig);
-$seo = new Seo($faqConfig);
-if ($currentUser->perm->hasPermission($currentUser->getUserId(), PermissionType::CATEGORY_EDIT->value)) {
-    $templateVars = [
-        'msgHeaderCategoryMain' => Translation::get('msgHeaderCategoryOverview'),
-    ];
-    if ($action === 'savecategory' && Token::getInstance()->verifyToken('save-category', $csrfToken)) {
-        $category = new Category($faqConfig, [], false);
-        $category->setUser($currentAdminUser);
-        $category->setGroups($currentAdminGroups);
-        $parentId = Filter::filterInput(INPUT_POST, 'parent_id', FILTER_VALIDATE_INT);
-        $categoryId = $faqConfig->getDb()->nextId(Database::getTablePrefix() . 'faqcategories', 'id');
-        $categoryLang = Filter::filterInput(INPUT_POST, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
-        $categoryEntity = new CategoryEntity();
-        $categoryEntity
-            ->setParentId($parentId)
-            ->setLang($categoryLang)
-            ->setName(Filter::filterInput(INPUT_POST, 'name', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setDescription(Filter::filterInput(INPUT_POST, 'description', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setUserId(Filter::filterInput(INPUT_POST, 'user_id', FILTER_VALIDATE_INT))
-            ->setGroupId(Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT) ?? -1)
-            ->setActive(Filter::filterInput(INPUT_POST, 'active', FILTER_VALIDATE_INT) ?? false)
-            ->setImage($categoryImage->getFileName($categoryId, $categoryLang))
-            ->setParentId($parentId)
-            ->setShowHome(Filter::filterInput(INPUT_POST, 'show_home', FILTER_VALIDATE_INT));
-        $permissions = [];
-        if ('all' === Filter::filterInput(INPUT_POST, 'userpermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
-            $permissions += [
-                'restricted_user' => [
-                    -1,
-                ],
-            ];
-        } else {
-            $permissions += [
-                'restricted_user' => [
-                    Filter::filterInput(INPUT_POST, 'restricted_users', FILTER_VALIDATE_INT),
-                ],
-            ];
-        }
-        if ('all' === Filter::filterInput(INPUT_POST, 'grouppermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
-            $permissions += [
-                'restricted_groups' => [
-                    -1,
-                ],
-            ];
-        } else {
-            $permissions += Filter::filterInputArray(
-                INPUT_POST,
-                [
-                    'restricted_groups' => [
-                        'filter' => FILTER_VALIDATE_INT,
-                        'flags' => FILTER_REQUIRE_ARRAY,
-                    ],
-                ]
-            );
-        }
-        if ($category->checkIfCategoryExists($categoryEntity) > 0) {
-            $templateVars = [
-                ...$templateVars,
-                'isError' => true,
-                'errorMessage' => Translation::get('ad_categ_existing'),
-            ];
-        }
-        $categoryId = $category->create($categoryEntity);
-        if ($categoryId) {
-            $categoryPermission->add(Permission::USER, [$categoryId], $permissions['restricted_user']);
-            $categoryPermission->add(
-                Permission::GROUP,
-                [$categoryId],
-                $permissions['restricted_groups']
-            );
-            if ($categoryImage->getFileName($categoryId, $categoryLang)) {
-                try {
-                    $categoryImage->upload();
-                } catch (Exception $exception) {
-                    $templateVars = [
-                        ...$templateVars,
-                        'isWarning' => true,
-                        'warningMessage' => $exception->getMessage(),
-                    ];
-                }
-            }
-            $categoryOrder = new Order($faqConfig);
-            $categoryOrder->add($categoryId, $parentId);
-            $languages = Filter::filterInput(INPUT_POST, 'used_translated_languages', FILTER_SANITIZE_SPECIAL_CHARS);
-            $seoEntity = new SeoEntity();
-            $seoEntity
-                ->setType(SeoType::CATEGORY)
-                ->setReferenceId($categoryId)
-                ->setReferenceLanguage($categoryLang)
-                ->setTitle(Filter::filterInput(INPUT_POST, 'serpTitle', FILTER_SANITIZE_SPECIAL_CHARS))
-                ->setDescription(Filter::filterInput(INPUT_POST, 'serpDescription', FILTER_SANITIZE_SPECIAL_CHARS));
-            $seo->create($seoEntity);
-            $templateVars = [
-                ...$templateVars,
-                'isSuccess' => true,
-                'successMessage' => Translation::get('ad_categ_added')
-            ];
-        } else {
-            $templateVars = [
-                ...$templateVars,
-                'isError' => true,
-                'errorMessage' => $faqConfig->getDb()->error(),
-            ];
-        }
-    }
-    if ($action === 'updatecategory' && Token::getInstance()->verifyToken('update-category', $csrfToken)) {
-        $category = new Category($faqConfig, [], false);
-        $category->setUser($currentAdminUser);
-        $category->setGroups($currentAdminGroups);
-        $parentId = Filter::filterInput(INPUT_POST, 'parent_id', FILTER_VALIDATE_INT);
-        $categoryId = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);
-        $categoryLang = Filter::filterInput(INPUT_POST, 'catlang', FILTER_SANITIZE_SPECIAL_CHARS);
-        $existingImage = Filter::filterInput(INPUT_POST, 'existing_image', FILTER_SANITIZE_SPECIAL_CHARS);
-        $existingImage = is_null($existingImage) ? '' : $existingImage;
-        $image = count($uploadedFile) ? $categoryImage->getFileName(
-            $categoryId,
-            $categoryLang
-        ) : $existingImage;
-        $categoryEntity = new CategoryEntity();
-        $categoryEntity
-            ->setId($categoryId)
-            ->setLang($categoryLang)
-            ->setParentId($parentId)
-            ->setName(Filter::filterInput(INPUT_POST, 'name', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setDescription(Filter::filterInput(INPUT_POST, 'description', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setUserId(Filter::filterInput(INPUT_POST, 'user_id', FILTER_VALIDATE_INT))
-            ->setGroupId(Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT) ?? -1)
-            ->setActive(Filter::filterInput(INPUT_POST, 'active', FILTER_VALIDATE_INT))
-            ->setImage($image)
-            ->setShowHome(Filter::filterInput(INPUT_POST, 'show_home', FILTER_VALIDATE_INT));
-        $permissions = [];
-        if ('all' === Filter::filterInput(INPUT_POST, 'userpermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
-            $permissions += [
-                'restricted_user' => [
-                    -1,
-                ],
-            ];
-        } else {
-            $permissions += [
-                'restricted_user' => [
-                    Filter::filterInput(INPUT_POST, 'restricted_users', FILTER_VALIDATE_INT),
-                ],
-            ];
-        }
-        if ('all' === Filter::filterInput(INPUT_POST, 'grouppermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
-            $permissions += [
-                'restricted_groups' => [
-                    -1,
-                ],
-            ];
-        } else {
-            $permissions += Filter::filterInputArray(
-                INPUT_POST,
-                [
-                    'restricted_groups' => [
-                        'filter' => FILTER_VALIDATE_INT,
-                        'flags' => FILTER_REQUIRE_ARRAY,
-                    ],
-                ]
-            );
-        }
-        if (!$category->hasLanguage($categoryEntity->getId(), $categoryEntity->getLang())) {
-            if (
-                $category->create($categoryEntity) && $categoryPermission->add(
-                    Permission::USER,
-                    [$categoryEntity->getId()],
-                    $permissions['restricted_user']
-                ) && $categoryPermission->add(
-                    Permission::GROUP,
-                    [$categoryEntity->getId()],
-                    $permissions['restricted_groups']
-                )
-            ) {
-                $seoEntity = new SeoEntity();
-                $seoEntity
-                    ->setType(SeoType::CATEGORY)
-                    ->setReferenceId($categoryEntity->getId())
-                    ->setReferenceLanguage($categoryEntity->getLang())
-                    ->setTitle(Filter::filterInput(INPUT_POST, 'serpTitle', FILTER_SANITIZE_SPECIAL_CHARS))
-                    ->setDescription(Filter::filterInput(INPUT_POST, 'serpDescription', FILTER_SANITIZE_SPECIAL_CHARS));
-                if ($seo->get(clone $seoEntity)->getId() === null) {
-                    $seo->create($seoEntity);
-                } else {
-                    $seo->update($seoEntity);
-                }
-                $templateVars = [
-                    ...$templateVars,
-                    'isSuccess' => true,
-                    'successMessage' => Translation::get('ad_categ_translated')
-                ];
-            } else {
-                $templateVars = [
-                    ...$templateVars,
-                    'isError' => true,
-                    'errorMessage' => $faqConfig->getDb()->error(),
-                ];
-            }
-        } else {
-            if ($category->update($categoryEntity)) {
-                $categoryPermission->delete(Permission::USER, [$categoryEntity->getId()]);
-                $categoryPermission->delete(Permission::GROUP, [$categoryEntity->getId()]);
-                $categoryPermission->add(
-                    Permission::USER,
-                    [$categoryEntity->getId()],
-                    $permissions['restricted_user']
-                );
-                $categoryPermission->add(
-                    Permission::GROUP,
-                    [$categoryEntity->getId()],
-                    $permissions['restricted_groups']
-                );
-                if ($categoryImage->getFileName($categoryId, $categoryLang)) {
-                    try {
-                        $categoryImage->upload();
-                    } catch (Exception $exception) {
-                        $templateVars = [
-                            ...$templateVars,
-                            'isWarning' => true,
-                            'warningMessage' => $exception->getMessage(),
-                        ];
-                    }
-                }
-                $seoEntity = new SeoEntity();
-                $seoEntity
-                    ->setType(SeoType::CATEGORY)
-                    ->setReferenceId($categoryId)
-                    ->setReferenceLanguage($categoryLang)
-                    ->setTitle(Filter::filterInput(INPUT_POST, 'serpTitle', FILTER_SANITIZE_SPECIAL_CHARS))
-                    ->setDescription(Filter::filterInput(INPUT_POST, 'serpDescription', FILTER_SANITIZE_SPECIAL_CHARS));
-                if ($seo->get(clone $seoEntity)->getId() === null) {
-                    $seo->create($seoEntity);
-                } else {
-                    $seo->update($seoEntity);
-                }
-                $templateVars = [
-                    ...$templateVars,
-                    'isSuccess' => true,
-                    'successMessage' => Translation::get('ad_categ_updated')
-                ];
-            } else {
-                $templateVars = [
-                    ...$templateVars,
-                    'isError' => true,
-                    'errorMessage' => $faqConfig->getDb()->error(),
-                ];
-            }
-        }
-    }
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/category.main.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/category.overview.php
+++ b//dev/null
@@ -1,44 +0,0 @@
-<?php
-/**
- * List all categories in the admin section with drag and drop support for sorting.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at http://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2013-12-30
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Order;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = Configuration::getConfigurationInstance();
-$category = new Category($faqConfig, [], false);
-$category->buildCategoryTree();
-$categoryInfo = $category->getAllCategories();
-$categoryOrder = new Order($faqConfig);
-$orderedCategories = $categoryOrder->getAllCategories();
-$categoryTree = $categoryOrder->getCategoryTree($orderedCategories);
-if (empty($categoryTree)) {
-    $categoryTree = $category->buildAdminCategoryTree($categoryInfo);
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/content/category.overview.twig');
-$templateVars = [
-    'csrfTokenInput' => Token::getInstance()->getTokenInput('category'),
-    'categoryTree' => $categoryTree,
-    'categoryInfo' => $categoryInfo,
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/category.showstructure.php
+++ b//dev/null
@@ -1,110 +0,0 @@
-<?php
-/**
- * Builds a table of all categories in all languages.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Rudi Ferrari <bookcrossers@gmx.de>
- * @author    Jan Harms <model_railroader@gmx-topmail.de>
- * @copyright 2006-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2006-09-18
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Entity\CategoryEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Language\LanguageCodes;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::CATEGORY_EDIT->value)) {
-    $templateVars = [];
-    $category = new Category($faqConfig, [], false);
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $currentLanguage = LanguageCodes::get($faqLangCode);
-    $allLanguages = [];
-    $all_lang = [];
-    $showCategory = Filter::filterInput(INPUT_POST, 'showCategory', FILTER_SANITIZE_SPECIAL_CHARS);
-    if ($showCategory === 'yes') {
-        $categoryEntity = new CategoryEntity();
-        $categoryEntity
-            ->setId(Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT))
-            ->setLang(Filter::filterInput(INPUT_POST, 'lang', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setParentId(Filter::filterInput(INPUT_POST, 'parent_id', FILTER_VALIDATE_INT))
-            ->setName(Filter::filterInput(INPUT_POST, 'name', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setDescription(Filter::filterInput(INPUT_POST, 'description', FILTER_SANITIZE_SPECIAL_CHARS))
-            ->setUserId(Filter::filterInput(INPUT_POST, 'user_id', FILTER_VALIDATE_INT));
-        if ($category->create($categoryEntity)) {
-            $templateVars = [
-                ...$templateVars,
-                'message' => Translation::get('ad_categ_translated'),
-                'message_typ' => 'success'
-            ];
-        } else {
-            $templateVars = [
-                ...$templateVars,
-                'message_heading' => Translation::get('ad_adus_dberr'),
-                'error' => $faqConfig->getDb()->error(),
-                'message_typ' => 'danger'
-            ];
-        }
-    }
-    $category->getMissingCategories();
-    $category->buildCategoryTree();
-    $allLanguages = $faqConfig->getLanguage()->isLanguageAvailable(0, $table = 'faqcategories');
-    foreach ($allLanguages as $lang) {
-        $all_lang[$lang] = LanguageCodes::get($lang);
-    }
-    asort($all_lang);
-    $translations = [];
-    foreach ($category->getCategoryTree() as $cat) {
-        $id_languages = $category->getCategoryLanguagesTranslated($cat['id']);
-        $spokenLanguage = [];
-        $translation_array = [];
-        foreach ($id_languages as $lang => $title) {
-            $translation_array[] = $lang;
-        }
-        $translations[$cat['id']] = $translation_array;
-    }
-    $all_lang_codes = [LanguageCodes::getKey($currentLanguage)];
-    foreach ($all_lang as $language) {
-        if ($language !== $currentLanguage) {
-            $all_lang_codes[] = LanguageCodes::getKey($language);
-        }
-    }
-    $templateVars = [
-        ...$templateVars,
-        'currentLanguage' => $currentLanguage,
-        'allLangs' => $all_lang,
-        'allLangCodes' => $all_lang_codes,
-        'categoryTree' => $category->getCategoryTree(),
-        'basePath' => $request->getBasePath(),
-        'faqlangcode' => $faqLangCode,
-        'msgCategoryRemark_overview' => Translation::get('msgCategoryRemark_overview'),
-        'ad_categ_title' => Translation::get('ad_categ_titel'),
-        'ad_categ_translate' => Translation::get('ad_categ_translate'),
-        'ad_menu_categ_structure' => Translation::get('ad_menu_categ_structure'),
-        'msgAddCategory' => Translation::get('msgAddCategory'),
-        'msgHeaderCategoryOverview' => Translation::get('msgHeaderCategoryOverview'),
-        'msgCategory' => Translation::get('msgCategory'),
-        'translations' => $translations,
-        'ad_categ_translated' => Translation::get('ad_categ_translated')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/category.showstructure.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/category.translate.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/**
- * Category translation frontend
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Rudi Ferrari <bookcrossers@gmx.de>
- * @copyright 2006-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2006-09-10
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Permission;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\UserHelper;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::CATEGORY_EDIT->value)) {
-    $category = new Category($faqConfig, [], false);
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $category->getMissingCategories();
-    $categoryPermission = new Permission($faqConfig);
-    $userHelper = new UserHelper($user);
-    $id = Filter::filterInput(INPUT_GET, 'cat', FILTER_VALIDATE_INT);
-    $header = sprintf(
-        '%s %s: <em>%s</em>',
-        Translation::get('ad_categ_trans_1'),
-        Translation::get('ad_categ_trans_2'),
-        $category->categoryName[$id]['name']
-    );
-    $selectedLanguage = Filter::filterInput(INPUT_GET, 'trlang', FILTER_SANITIZE_SPECIAL_CHARS, $faqLangCode);
-    if ($selectedLanguage !== $faqLangCode) {
-        $action = 'showcategory';
-        $showcat = 'yes';
-    } else {
-        $action = 'updatecategory';
-        $showcat = 'no';
-    }
-    $userPermission = $categoryPermission->get(Permission::USER, [$id]);
-    $groupPermission = $categoryPermission->get(Permission::GROUP, [$id]);
-    $templateVars = [
-        'categoryName' => $category->categoryName[$id]['name'],
-        'ad_categ_trans_1' => Translation::get('ad_categ_trans_1'),
-        'ad_categ_trans_2' => Translation::get('ad_categ_trans_2'),
-        'categoryId' => $id,
-        'category' => $category->categoryName[$id],
-        'showcat' => $showcat,
-        'permLevel' => $faqConfig->get('security.permLevel'),
-        'groupPermission' => $groupPermission[0],
-        'userPermission' => $userPermission[0],
-        'csrf' => Token::getInstance()->getTokenString('update-category'),
-        'ad_categ_title' => Translation::get('ad_categ_titel'),
-        'ad_categ_lang' => Translation::get('ad_categ_lang'),
-        'langToTranslate' => $category->getCategoryLanguagesToTranslate($id, $selectedLanguage),
-        'ad_categ_desc' => Translation::get('ad_categ_desc'),
-        'ad_categ_owner' => Translation::get('ad_categ_owner'),
-        'userOptions' => $userHelper->getAllUserOptions($category->categoryName[$id]['user_id']),
-        'ad_categ_transalready' => Translation::get('ad_categ_transalready'),
-        'langTranslated' => $category->getCategoryLanguagesTranslated($id),
-        'ad_categ_translatecateg' => Translation::get('ad_categ_translatecateg')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/category.translate.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/comments.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/**
- * Shows all comments in the categories and provides a link to delete comments.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2007-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2007-03-04
- */
-use phpMyFAQ\Comments;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Date;
-use phpMyFAQ\Entity\CommentType;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Faq;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\FaqTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\User\CurrentUser;
-use Twig\Extra\Intl\IntlExtension;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-[$currentAdminUser, $currentAdminGroups] = CurrentUser::getCurrentUserGroupId($user);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$twig->addExtension(new IntlExtension());
-$twig->addExtension(new FaqTwigExtension());
-$template = $twig->loadTemplate('@admin/content/comments.twig');
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::COMMENT_DELETE->value)) {
-    $comment = new Comments($faqConfig);
-    $faq = new Faq($faqConfig);
-    $date = new Date($faqConfig);
-    $faqComments = $comment->getAllComments();
-    $newsComments = $comment->getAllComments(CommentType::NEWS);
-    $templateVars = [
-        'currentLocale' => $faqConfig->getLanguage()->getLanguage(),
-        'faqComments' => $faqComments,
-        'newsComments' => $newsComments,
-        'csrfToken' => Token::getInstance()->getTokenString('delete-comment'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/configuration.php
+++ b//dev/null
@@ -1,41 +0,0 @@
-<?php
-/**
- * The main configuration frontend.
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@scaramuccia.com>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-12-26
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value)) {
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/configuration/main.twig');
-    $templateVars = [
-        'adminHeaderConfiguration' => Translation::get('ad_config_edit'),
-        'csrfToken' => Token::getInstance()->getTokenString('configuration'),
-        'language' => $faqLangCode,
-        'adminConfigurationButtonReset' => Translation::get('ad_config_reset'),
-        'adminConfigurationButtonSave' => Translation::get('ad_config_save'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/dashboard.php
+++ b//dev/null
@@ -1,110 +0,0 @@
-<?php
-/**
- * The start page with some information about the FAQ.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Alexander M. Turek <me@derrabus.de>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2013-02-05
- */
-use phpMyFAQ\Administration\Api;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Contracts\HttpClient\Exception\DecodingExceptionInterface;
-use Symfony\Contracts\HttpClient\Exception\TransportExceptionInterface;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$faqTableInfo = $faqConfig->getDb()->getTableStatus(Database::getTablePrefix());
-$user = CurrentUser::getCurrentUser($faqConfig);
-$userId = $user->getUserId();
-$faqSystem = new System();
-$faqSession = new Session($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/dashboard.twig');
-$templateVars = [
-    'isDebugMode' => DEBUG,
-    'isMaintenanceMode' => $faqConfig->get('main.maintenanceMode'),
-    'isDevelopmentVersion' => System::isDevelopmentVersion(),
-    'currentVersionApp' => System::getVersion(),
-    'msgAdminWarningDevelopmentVersion' => sprintf(
-        Translation::get('msgAdminWarningDevelopmentVersion'),
-        System::getVersion(),
-        System::getGitHubIssuesUrl()
-    ),
-    'adminDashboardInfoNumVisits' => $faqSession->getNumberOfSessions(),
-    'adminDashboardInfoNumFaqs' => $faqTableInfo[Database::getTablePrefix() . 'faqdata'],
-    'adminDashboardInfoNumComments' => $faqTableInfo[Database::getTablePrefix() . 'faqcomments'],
-    'adminDashboardInfoNumQuestions' => $faqTableInfo[Database::getTablePrefix() . 'faqquestions'],
-    'adminDashboardInfoUser' => Translation::get('msgNews'),
-    'adminDashboardInfoNumUser' => $faqTableInfo[Database::getTablePrefix() . 'faquser'] - 1,
-    'adminDashboardHeaderVisits' => Translation::get('ad_stat_report_visits'),
-    'hasUserTracking' => $faqConfig->get('main.enableUserTracking'),
-    'adminDashboardHeaderInactiveFaqs' => Translation::get('ad_record_inactive'),
-    'adminDashboardInactiveFaqs' => $faq->getInactiveFaqsData(),
-    'hasPermissionEditConfig' => $user->perm->hasPermission($userId, PermissionType::CONFIGURATION_EDIT->value),
-    'showVersion' => $faqConfig->get('main.enableAutoUpdateHint'),
-    'documentationUrl' => System::getDocumentationUrl(),
-];
-if (version_compare($faqConfig->getVersion(), System::getVersion(), '<')) {
-    $templateVars = [
-        ...$templateVars,
-        'hasVersionConflict' => true,
-        'currentVersionDatabase' => $faqConfig->getVersion()
-    ];
-}
-if ($user->perm->hasPermission($userId, PermissionType::CONFIGURATION_EDIT->value)) {
-    $api = new Api($faqConfig, $faqSystem);
-    $version = Filter::filterInput(INPUT_POST, 'param', FILTER_SANITIZE_SPECIAL_CHARS);
-    if (!$faqConfig->get('main.enableAutoUpdateHint')) {
-        if ($version === 'version') {
-            $shouldUpdate = false;
-            $errorMessage = '';
-            $versions = [];
-            try {
-                $versions = $api->getVersions();
-                if (-1 === version_compare($versions['installed'], $versions['stable'])) {
-                    $templateVars = [
-                        ...$templateVars,
-                        'adminDashboardShouldUpdateMessage' => true,
-                        'adminDashboardLatestVersionMessage' => Translation::get('ad_you_should_update'),
-                        'adminDashboardVersions' => $versions,
-                    ];
-                } else {
-                    $templateVars = [
-                        ...$templateVars,
-                        'adminDashboardShouldUpdateMessage' => false,
-                        'adminDashboardLatestVersionMessage' => Translation::get('ad_xmlrpc_latest'),
-                        'adminDashboardVersions' => $versions,
-                    ];
-                }
-            } catch (DecodingExceptionInterface | TransportExceptionInterface | Exception $e) {
-                $templateVars = [
-                    ...$templateVars,
-                    'adminDashboardErrorMessage' => $e->getMessage()
-                ];
-            }
-        }
-    }
-    $templateVars = [
-        ...$templateVars,
-        'showVersion' => $faqConfig->get('main.enableAutoUpdateHint') || ($version === 'version'),
-    ];
-}
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/elasticsearch.php
+++ b//dev/null
@@ -1,46 +0,0 @@
-<?php
-/**
- * phpMyFAQ Elasticsearch information.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2015-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2015-12-25
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Instance\Elasticsearch;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if (
-    $user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value) &&
-    $faqConfig->get('search.enableElasticsearch')
-) {
-    $elasticsearch = new Elasticsearch($faqConfig);
-    $esConfigData = $faqConfig->getElasticsearchConfig();
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/configuration/elasticsearch.twig');
-    $templateVars = [
-        'adminHeaderElasticsearch' => Translation::get('ad_menu_elasticsearch'),
-        'adminElasticsearchButtonCreate' => Translation::get('ad_es_create_index'),
-        'adminElasticsearchButtonIndex' => Translation::get('ad_es_bulk_index'),
-        'adminElasticsearchButtonDelete' => Translation::get('ad_es_drop_index'),
-        'adminElasticsearchStats' => Translation::get('ad_menu_searchstats'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/export.php
+++ b//dev/null
@@ -1,65 +0,0 @@
-<?php
-/**
- * JSON, and PDF export
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-04-17
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Helper\CategoryHelper;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\HeaderUtils;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-[$currentAdminUser, $currentAdminGroups] = CurrentUser::getCurrentUserGroupId($user);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/import-export/export.twig');
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::EXPORT->value)) {
-    $category = new Category($faqConfig, [], false);
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $category->buildCategoryTree();
-    $categoryHelper = new CategoryHelper();
-    $categoryHelper->setCategory($category);
-    $templateVars = [
-        'adminHeaderExport' => Translation::get('ad_menu_export'),
-        'hasNoFaqs' => Database::checkOnEmptyTable('faqdata'),
-        'errorMessageNoFaqs' => Translation::get('msgErrorNoRecords'),
-        'hasCategories' => !Database::checkOnEmptyTable('faqcategories'),
-        'headerCategories' => Translation::get('ad_export_which_cat'),
-        'msgCategory' => Translation::get('ad_entry_category'),
-        'msgAllCategories' => Translation::get('msgShowAllCategories'),
-        'categoryOptions' => $categoryHelper->renderOptions(0),
-        'msgWithSubCategories' => Translation::get('ad_export_cat_downwards'),
-        'headerExportType' => Translation::get('ad_export_type'),
-        'msgChooseExportType' => Translation::get('ad_export_type_choose'),
-        'msgViewType' => Translation::get('ad_export_download_view'),
-        'msgDownloadType' => HeaderUtils::DISPOSITION_ATTACHMENT,
-        'msgDownload' => Translation::get('ad_export_download'),
-        'msgInlineType' => HeaderUtils::DISPOSITION_INLINE,
-        'msgInline' => Translation::get('ad_export_view'),
-        'buttonReset' => Translation::get('ad_config_reset'),
-        'buttonExport' => Translation::get('ad_menu_export'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/faqs.editor.php
+++ b//dev/null
@@ -1,378 +0,0 @@
-<?php
-/**
- * The FAQ record editor.
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-23
- */
-use phpMyFAQ\Administration\AdminLog;
-use phpMyFAQ\Administration\Changelog;
-use phpMyFAQ\Administration\Revision;
-use phpMyFAQ\Attachment\AttachmentFactory;
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Relation;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Date;
-use phpMyFAQ\Entity\SeoEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\SeoType;
-use phpMyFAQ\Faq;
-use phpMyFAQ\Faq\Permission;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\CategoryHelper;
-use phpMyFAQ\Helper\LanguageHelper;
-use phpMyFAQ\Helper\UserHelper;
-use phpMyFAQ\Link;
-use phpMyFAQ\Question;
-use phpMyFAQ\Seo;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Tags;
-use phpMyFAQ\Template\Extensions\FormatBytesTwigExtension;
-use phpMyFAQ\Template\Extensions\IsoDateTwigExtension;
-use phpMyFAQ\Template\Extensions\UserNameTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$currentUserId = $user->getUserId();
-if (
-    (
-    $user->perm->hasPermission($currentUserId, PermissionType::FAQ_EDIT->value) ||
-    $user->perm->hasPermission($currentUserId, PermissionType::FAQ_EDIT->value)) &&
-    !Database::checkOnEmptyTable('faqcategories')
-) {
-    $category = new Category($faqConfig, [], false);
-    if ($faqConfig->get('main.enableCategoryRestrictions')) {
-        $category = new Category($faqConfig, $currentAdminGroups, true);
-    }
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $category->buildCategoryTree();
-    $categoryRelation = new Relation($faqConfig, $category);
-    $categoryHelper = new CategoryHelper();
-    $categoryHelper->setCategory($category);
-    $faq = new Faq($faqConfig);
-    $faqPermission = new Permission($faqConfig);
-    $questionObject = new Question($faqConfig);
-    $changelog = new Changelog($faqConfig);
-    $userHelper = new UserHelper($user);
-    $tagging = new Tags($faqConfig);
-    $seo = new Seo($faqConfig);
-    $logging = new AdminLog($faqConfig);
-    $date = new Date($faqConfig);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addExtension(new FormatBytesTwigExtension());
-    $twig->addExtension(new IsoDateTwigExtension());
-    $twig->addExtension(new UserNameTwigExtension());
-    $template = $twig->loadTemplate('@admin/content/faq.editor.twig');
-    $selectedCategory = '';
-    $queryString = '';
-    $categories = [];
-    $faqData = [
-        'id' => 0,
-        'lang' => $faqLangCode,
-        'revision_id' => 0,
-        'title' => '',
-        'dateStart' => '',
-        'dateEnd' => '',
-    ];
-    if ('takequestion' === $action) {
-        $questionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-        $question = $questionObject->get($questionId);
-        $selectedCategory = $question['category_id'];
-        $faqData['title'] = $question['question'];
-        $notifyUser = $question['username'];
-        $notifyEmail = $question['email'];
-        $categories = [
-            'category_id' => $selectedCategory,
-            'category_lang' => $faqData['lang'],
-        ];
-    } else {
-        $questionId = 0;
-        $notifyUser = '';
-        $notifyEmail = '';
-    }
-    if ('editentry' === $action) {
-        $id = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-        $lang = Filter::filterInput(INPUT_GET, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
-        $translateTo = Filter::filterInput(INPUT_GET, 'translateTo', FILTER_SANITIZE_SPECIAL_CHARS);
-        $categoryId = Filter::filterInput(INPUT_GET, 'cat', FILTER_VALIDATE_INT);
-        $logging->log($user, 'admin-edit-faq ' . $id);
-        if (!is_null($translateTo)) {
-            $faqData['lang'] = $lang = $translateTo;
-            $selectedCategory = $categoryId;
-        }
-        if ((!isset($selectedCategory) && !isset($faqData['title'])) || !is_null($id)) {
-            $logging = new AdminLog($faqConfig);
-            $logging->log($user, 'admin-edit-faq ' . $id);
-            $categories = $categoryRelation->getCategories($id, $lang);
-            if (count($categories) === 0) {
-                $categories = [
-                    'category_id' => $selectedCategory,
-                    'category_lang' => $faqData['lang'],
-                ];
-            }
-            $faq->getFaq($id, null, true);
-            $faqData = $faq->faqRecord;
-            if (!is_null($translateTo)) {
-                $faqData['lang'] = $translateTo; // once again
-            }
-            $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
-        } else {
-            $queryString = 'insertentry';
-            if (isset($categoryId)) {
-                $categories = ['category_id' => $categoryId, 'category_lang' => $lang];
-            }
-        }
-    } elseif ('copyentry' === $action) {
-        $logging->log($user, 'admin-copy-faq');
-        $faqData['id'] = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-        $faqData['lang'] = Filter::filterInput(INPUT_GET, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
-        $categories = $categoryRelation->getCategories($faqData['id'], $faqData['lang']);
-        $faq->getFaq($faqData['id'], null, true);
-        $faqData = $faq->faqRecord;
-        $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
-        $faqData['id'] = 0;
-        $faqData['revision_id'] = 0;
-        $queryString = 'insertentry';
-    } else {
-        $logging->log($user, 'admin-add-faq');
-        $queryString = 'insertentry';
-        if (!is_array($categories)) {
-            $categories = [];
-        }
-    }
-    $selectedRevisionId = Filter::filterInput(INPUT_POST, 'selectedRevisionId', FILTER_VALIDATE_INT);
-    if (is_null($selectedRevisionId)) {
-        $selectedRevisionId = $faqData['revision_id'];
-    }
-    $userPermission = $faqPermission->get(Permission::USER, $faqData['id']);
-    if (count($userPermission) == 0 || $userPermission[0] == -1) {
-        $allUsers = true;
-        $restrictedUsers = false;
-        $userPermission[0] = -1;
-    } else {
-        $allUsers = false;
-        $restrictedUsers = true;
-    }
-    $groupPermission = $faqPermission->get(Permission::GROUP, $faqData['id']);
-    if (count($groupPermission) == 0 || $groupPermission[0] == -1) {
-        $allGroups = true;
-        $restrictedGroups = false;
-        $groupPermission[0] = -1;
-    } else {
-        $allGroups = false;
-        $restrictedGroups = true;
-    }
-    $seoEntity = new SeoEntity();
-    $seoEntity
-        ->setType(SeoType::FAQ)
-        ->setReferenceId($faqData['id'])
-        ->setReferenceLanguage($faqData['lang']);
-    $seoData = $seo->get($seoEntity);
-    $faqData['serp-title'] = $seoData->getTitle();
-    $faqData['serp-description'] = $seoData->getDescription();
-    $faqData['title'] = ($faqData['title'] ?? '');
-    $faqData['content'] = (isset($faqData['content']) ? trim($faqData['content']) : '');
-    $faqData['tags'] = $faqData['tags'] ?? '';
-    $faqData['keywords'] = ($faqData['keywords'] ?? '');
-    $faqData['author'] = ($faqData['author'] ?? $user->getUserData('display_name'));
-    $faqData['email'] = ($faqData['email'] ?? $user->getUserData(
-        'email'
-    ));
-    $faqData['isoDate'] = ($faqData['date'] ?? date('Y-m-d H:i'));
-    $faqData['date'] = (isset($faqData['date']) ? $date->format($faqData['date']) : $date->format(date('Y-m-d H:i')));
-    $faqData['changed'] ??= '';
-    if (isset($faqData['comment']) && $faqData['comment'] == 'y') {
-        $faqData['comment'] = ' checked';
-    } elseif ($faqConfig->get('records.defaultAllowComments')) {
-        $faqData['comment'] = ' checked';
-    } else {
-        $faqData['comment'] = '';
-    }
-    $templateVars = [
-        'ad_record_faq' => Translation::get('ad_record_faq'),
-        'ad_menu_faq_meta' => Translation::get('ad_menu_faq_meta'),
-        'ad_record_permissions' => Translation::get('ad_record_permissions'),
-        'ad_admin_notes' => Translation::get('ad_admin_notes'),
-        'ad_entry_changelog' => Translation::get('ad_entry_changelog'),
-    ];
-    if (0 !== $faqData['id'] && 'copyentry' !== $action) {
-        $currentRevision = sprintf('%s 1.%d', Translation::get('ad_entry_revision'), $selectedRevisionId);
-        $faqUrl = sprintf(
-            '%sindex.php?action=faq&cat=%s&id=%d&artlang=%s',
-            $faqConfig->getDefaultUrl(),
-            $category->getCategoryIdFromFaq($faqData['id']),
-            $faqData['id'],
-            $faqData['lang']
-        );
-        $link = new Link($faqUrl, $faqConfig);
-        $link->itemTitle = $faqData['title'];
-        $templateVars = [
-            ...$templateVars,
-            'adminFaqEditorHeader' => Translation::get('ad_entry_edit_1') . ' ' . Translation::get('ad_entry_edit_2'),
-            'editExistingFaq' => true,
-            'currentRevision' => $currentRevision,
-            'faqUrl' => $link->toString(),
-            'ad_view_faq' => Translation::get('ad_view_faq'),
-        ];
-    } else {
-        $templateVars = [
-            ...$templateVars,
-            'adminFaqEditorHeader' => Translation::get('ad_entry_add'),
-            'editExistingFaq' => false,
-        ];
-    }
-    if ($user->perm->hasPermission($currentUserId, PermissionType::REVISION_UPDATE->value) && $action === 'editentry') {
-        $faqRevision = new Revision($faqConfig);
-        $revisions = $faqRevision->get($faqData['id'], $faqData['lang'], $faqData['author']);
-        if (isset($selectedRevisionId) && isset($faqData['revision_id']) && $selectedRevisionId !== $faqData['revision_id']) {
-            $faq->getFaq($faqData['id'], $selectedRevisionId, true);
-            $faqData = $faq->faqRecord;
-            $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
-            $faqData['revision_id'] = $selectedRevisionId;
-        }
-        $templateVars = [
-            ...$templateVars,
-            'numberOfRevisions' => count($revisions),
-            'faqId' => $faqData['id'],
-            'faqLang' => $faqData['lang'],
-            'faqRevisionId' => $faqData['revision_id'],
-            'ad_changerev' => Translation::get('ad_changerev'),
-            'revisions' => $revisions,
-            'selectedRevisionId' => $selectedRevisionId,
-            'ad_entry_revision' => Translation::get('ad_entry_revision'),
-        ];
-    }
-    if (isset($faqData['active']) && $faqData['active'] === 'yes') {
-        $isActive = ' checked';
-        $isInActive = null;
-    } else {
-        $isActive = null;
-        $isInActive = ' checked';
-    }
-    if ($faqConfig->get('records.defaultActivation') && $queryString === 'insertentry') {
-        $isActive = ' checked';
-        $isInActive = null;
-    }
-    $attList = AttachmentFactory::fetchByRecordId(
-        $faqConfig,
-        $faqData['id']
-    );
-    $templateVars = [
-        ...$templateVars,
-        'isEditorEnabled' => $faqConfig->get('main.enableWysiwygEditor'),
-        'isMarkdownEditorEnabled' => $faqConfig->get('main.enableMarkdownEditor'),
-        'isBasicPermission' => $faqConfig->get('security.permLevel') === 'basic',
-        'defaultUrl' => $faqConfig->getDefaultUrl(),
-        'faqRevisionId' => $faqData['revision_id'],
-        'faqData' => $faqData,
-        'openQuestionId' => $questionId,
-        'notifyUser' => $notifyUser,
-        'notifyEmail' => $notifyEmail,
-        'csrfToken' => Token::getInstance()->getTokenString('edit-faq'),
-        'ad_entry_theme' => Translation::get('ad_entry_theme'),
-        'msgNoHashAllowed' => Translation::get('msgNoHashAllowed'),
-        'msgShowHelp' => Translation::get('msgShowHelp'),
-        'ad_entry_content' => Translation::get('ad_entry_content'),
-        'ad_entry_category' => Translation::get('ad_entry_category'),
-        'categoryOptions' => $categoryHelper->renderOptions($categories),
-        'ad_entry_locale' => Translation::get('ad_entry_locale'),
-        'languageOptions' => LanguageHelper::renderSelectLanguage($faqData['lang'], false, [], 'lang'),
-        'hasPermissionForAddAttachments' => $user->perm->hasPermission(
-            $currentUserId,
-            PermissionType::ATTACHMENT_ADD->value
-        ),
-        'hasPermissionForDeleteAttachments' => $user->perm->hasPermission(
-            $currentUserId,
-            PermissionType::ATTACHMENT_DELETE->value
-        ),
-        'ad_menu_attachments' => Translation::get('ad_menu_attachments'),
-        'csrfTokenDeleteAttachment' => Token::getInstance()->getTokenString('delete-attachment'),
-        'attachments' => $attList,
-        'ad_att_add' => Translation::get('ad_att_add'),
-        'ad_entry_tags' => Translation::get('ad_entry_tags'),
-        'ad_entry_keywords' => Translation::get('ad_entry_keywords'),
-        'ad_entry_author' => Translation::get('ad_entry_author'),
-        'msgEmail' => Translation::get('msgEmail'),
-        'msgSeoCenter' => Translation::get('seoCenter'),
-        'msgSerp' => Translation::get('msgSerp'),
-        'msgSerpTitle' => Translation::get('msgSerpTitle'),
-        'msgSerpDescription' => Translation::get('msgSerpDescription'),
-        'ad_entry_grouppermission' => Translation::get('ad_entry_grouppermission'),
-        'ad_entry_all_groups' => Translation::get('ad_entry_all_groups'),
-        'allGroups' => $allGroups,
-        'restrictedGroups' => $restrictedGroups,
-        'ad_entry_restricted_groups' => Translation::get('ad_entry_restricted_groups'),
-        'groupPermissionOptions' => ($faqConfig->get('security.permLevel') === 'medium') ?
-            $user->perm->getAllGroupsOptions($groupPermission, $user) : '',
-        'ad_entry_userpermission' => Translation::get('ad_entry_userpermission'),
-        'allUsers' => $allUsers,
-        'ad_entry_all_users' => Translation::get('ad_entry_all_users'),
-        'restrictedUsers' => $restrictedUsers,
-        'ad_entry_restricted_users' => Translation::get('ad_entry_restricted_users'),
-        'userPermissionOptions' => $userHelper->getAllUserOptions($userPermission[0], true),
-        'ad_entry_changelog' => Translation::get('ad_entry_changelog'),
-        'ad_entry_date' => Translation::get('ad_entry_date'),
-        'ad_entry_changed' => Translation::get('ad_entry_changed'),
-        'ad_admin_notes_hint' => Translation::get('ad_admin_notes_hint'),
-        'ad_admin_notes' => Translation::get('ad_admin_notes'),
-        'ad_entry_changelog_history' => Translation::get('ad_entry_changelog_history'),
-        'changelogs' => $changelog->getByFaqId($faqData['id']),
-        'ad_entry_revision' => Translation::get('ad_entry_revision'),
-        'ad_gen_reset' => Translation::get('ad_gen_reset'),
-        'ad_entry_save' => Translation::get('ad_entry_save'),
-        'msgUpdateFaqDate' => Translation::get('msgUpdateFaqDate'),
-        'msgKeepFaqDate' => Translation::get('msgKeepFaqDate'),
-        'msgEditFaqDat' => Translation::get('msgEditFaqDat'),
-        'ad_entry_status' => Translation::get('ad_entry_status'),
-        'hasPermissionForApprove' => $user->perm->hasPermission($currentUserId, PermissionType::FAQ_APPROVE->value),
-        'isActive' => $isActive,
-        'isInActive' => $isInActive,
-        'ad_entry_visibility' => Translation::get('ad_entry_visibility'),
-        'ad_entry_not_visibility' => Translation::get('ad_entry_not_visibility'),
-        'canBeNewRevision' => $queryString !== 'insertentry' && !$faqConfig->get('records.enableAutoRevisions'),
-        'ad_entry_new_revision' => Translation::get('ad_entry_new_revision'),
-        'ad_gen_yes' => Translation::get('ad_gen_yes'),
-        'ad_gen_no' => Translation::get('ad_gen_no'),
-        'ad_entry_sticky' => Translation::get('ad_entry_sticky'),
-        'ad_entry_allowComments' => Translation::get('ad_entry_allowComments'),
-        'ad_entry_solution_id' => Translation::get('ad_entry_solution_id'),
-        'nextSolutionId' => $faq->getNextSolutionId(),
-        'nextFaqId' => 0 === $faqData['id'] ? $faqConfig->getDb()->nextId(
-            Database::getTablePrefix() . 'faqdata',
-            'id'
-        ) : $faqData['id'],
-        'ad_att_addto' => Translation::get('ad_att_addto'),
-        'ad_att_addto_2' => Translation::get('ad_att_addto_2'),
-        'ad_att_att' => Translation::get('ad_att_att'),
-        'maxAttachmentSize' => $faqConfig->get('records.maxAttachmentSize'),
-        'csrfTokenUploadAttachment' => Token::getInstance()->getTokenString('upload-attachment'),
-        'msgAttachmentsFilesize' => Translation::get('msgAttachmentsFilesize'),
-        'ad_att_butt' => Translation::get('ad_att_butt'),
-    ];
-    echo $template->render($templateVars);
-} elseif (
-    $user->perm->hasPermission($currentUserId, PermissionType::FAQ_EDIT->value) &&
-    !Database::checkOnEmptyTable('faqcategories')
-) {
-    require __DIR__ . '/no-permission.php';
-} elseif (
-    $user->perm->hasPermission($currentUserId, PermissionType::FAQ_EDIT->value) &&
-    Database::checkOnEmptyTable('faqcategories')
-) {
-    echo Translation::get('no_cats');
-}

--- a/phpmyfaq/admin/faqs.overview.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/**
- * List of records ordered by categories.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2020-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2020-11-21
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Category\Relation;
-use phpMyFAQ\Comments;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-[ $currentAdminUser, $currentAdminGroups ] = CurrentUser::getCurrentUserGroupId($user);
-$category = new Category($faqConfig, $currentAdminGroups, true);
-$category->setUser($currentAdminUser);
-$category->setGroups($currentAdminGroups);
-$category->buildCategoryTree();
-$categoryRelation = new Relation($faqConfig, $category);
-$categoryRelation->setGroups($currentAdminGroups);
-$comments = new Comments($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/content/faq.overview.twig');
-$templateVars = [
-    'csrfTokenSearch' => Token::getInstance()->getTokenInput('edit-faq'),
-    'csrfTokenOverview' => Token::getInstance()->getTokenString('faq-overview'),
-    'categories' => $category->getCategoryTree(),
-    'numberOfRecords' => $categoryRelation->getNumberOfFaqsPerCategory(),
-    'numberOfComments' => $comments->getNumberOfCommentsByCategory(),
-    'msgComments' => Translation::get('ad_start_comments'),
-    'msgQuestion' => Translation::get('ad_entry_theme'),
-    'msgDate' => Translation::get('ad_entry_date'),
-    'msgSticky' => Translation::get('ad_entry_sticky'),
-    'msgActive' => Translation::get('ad_record_active'),
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/footer.php
+++ b//dev/null
@@ -1,42 +0,0 @@
-<?php
-/**
- * Footer of the admin area.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-26
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/footer.twig');
-$templateVars = [
-    'msgSessionExpiringSoon' => Translation::get('msgSessionExpiringSoon'),
-    'msgModalSessionWarning' => sprintf(Translation::get('ad_session_expiring'), PMF_AUTH_TIMEOUT_WARNING),
-    'msgNoLogMeOut' => Translation::get('msgNoLogMeOut'),
-    'msgYesKeepMeLoggedIn' => Translation::get('msgYesKeepMeLoggedIn'),
-    'msgPoweredBy' => System::getPoweredByString(),
-    'documentationUrl' => System::getDocumentationUrl(),
-    'phpMyFaqUrl' => System::PHPMYFAQ_URL,
-    'isUserLoggedIn' => $user->isLoggedIn(),
-    'currentLanguage' => $faqLangCode,
-    'currentTimeStamp' => time(),
-    'currentYear' => date('Y'),
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/forms.php
+++ b//dev/null
@@ -1,54 +0,0 @@
-<?php
-/**
- * Edit forms
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Jan Harms <modelrailroader@gmx-topmail.de>
- * @copyright 2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2024-03-09
- */
-use phpMyFAQ\Forms;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Enums\Forms\FormIds;
-use phpMyFAQ\User\CurrentUser;
-use phpMyFAQ\Enums\PermissionType;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::FORMS_EDIT->value)) {
-    $forms = new Forms($faqConfig);
-    $translation = new Translation();
-    $templateVars = [
-        'msgEditForms' => Translation::get('msgEditForms'),
-        'formDataAskQuestion' => $forms->getFormData(FormIds::ASK_QUESTION->value),
-        'formDataAddContent' => $forms->getFormData(FormIds::ADD_NEW_FAQ->value),
-        'msgQuestion' => Translation::get('msgQuestion'),
-        'msgAddContent' => Translation::get('msgAddContent'),
-        'csrfActivate' => Token::getInstance()->getTokenString('activate-input'),
-        'csrfRequired' => Token::getInstance()->getTokenString('require-input'),
-        'ad_entry_id' => Translation::get('ad_entry_id'),
-        'msgInputLabel' => Translation::get('msgInputLabel'),
-        'msgInputType' => Translation::get('msgInputType'),
-        'ad_entry_active' => Translation::get('ad_entry_active'),
-        'msgRequiredInputField' => Translation::get('msgRequiredInputField'),
-        'msgFormsEditTranslations' => Translation::get('msgFormsEditTranslations'),
-        'ad_categ_translate' => Translation::get('ad_categ_translate'),
-        'msgHintDeactivateForms' => Translation::get('msgHintDeactivateForms')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/configuration/forms.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/forms.translations.php
+++ b//dev/null
@@ -1,71 +0,0 @@
-<?php
-/**
- * Edit forms
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Jan Harms <modelrailroader@gmx-topmail.de>
- * @copyright 2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2024-03-09
- */
-use phpMyFAQ\Forms;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\User\CurrentUser;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Language\LanguageCodes;
-use Twig\TwigFilter;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::FORMS_EDIT->value)) {
-    $forms = new Forms($faqConfig);
-    $formId = Filter::filterInput(INPUT_GET, 'formid', FILTER_SANITIZE_NUMBER_INT);
-    $inputId = Filter::filterInput(INPUT_GET, 'inputid', FILTER_SANITIZE_NUMBER_INT);
-    $languages = [];
-    foreach (LanguageCodes::getAllSupported() as $code => $language) {
-        if (!in_array($code, $forms->getTranslatedLanguages($formId, $inputId))) {
-            $languages[] = $language;
-        }
-    }
-    $filter = new TwigFilter('languageCode', function ($string) {
-        if ($string === 'default') {
-            return $string;
-        } else {
-            return LanguageCodes::get($string);
-        }
-    });
-    $templateVars = [
-        'translations' => $forms->getTranslations($formId, $inputId),
-        'ad_entry_locale' => Translation::get('ad_entry_locale'),
-        'msgInputLabel' => Translation::get('msgInputLabel'),
-        'ad_sess_pageviews' => Translation::get('ad_sess_pageviews'),
-        'msgFormsEditTranslations' => Translation::get('msgFormsEditTranslations'),
-        'csrfTokenEditTranslation' => Token::getInstance()->getTokenString('edit-translation'),
-        'csrfTokenDeleteTranslation' => Token::getInstance()->getTokenString('delete-translation'),
-        'languages' => $languages,
-        'msgSelectLanguage' => Translation::get('msgSelectLanguage'),
-        'msgTranslationText' => Translation::get('msgTranslationText'),
-        'msgAddTranslation' => Translation::get('msgAddTranslation'),
-        'csrfTokenAddTranslation' => Token::getInstance()->getTokenString('add-translation'),
-        'formId' => $formId,
-        'inputId' => $inputId,
-        'msgEditForms' => Translation::get('msgEditForms')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addFilter($filter);
-    $template = $twig->loadTemplate('@admin/configuration/forms.translations.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/glossary.php
+++ b//dev/null
@@ -1,57 +0,0 @@
-<?php
-/**
- * The main glossary index file.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-09-15
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Glossary;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if (
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GLOSSARY_ADD->value) ||
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GLOSSARY_EDIT->value) ||
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GLOSSARY_DELETE->value)
-) {
-    $glossary = new Glossary($faqConfig);
-    $glossary->setLanguage($faqLangCode);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/content/glossary.twig');
-    $templateVars = [
-        'adminHeaderGlossary' => Translation::get('ad_menu_glossary'),
-        'msgAddGlossary' => Translation::get('ad_glossary_add'),
-        'msgGlossaryItem' => Translation::get('ad_glossary_item'),
-        'msgGlossaryDefinition' => Translation::get('ad_glossary_definition'),
-        'glossaryItems' => $glossary->fetchAll(),
-        'buttonDelete' => Translation::get('msgDelete'),
-        'csrfTokenDelete' => Token::getInstance()->getTokenString('delete-glossary'),
-        'currentLanguage' => $faqLangCode,
-        'addGlossaryTitle' => Translation::get('ad_glossary_add'),
-        'addGlossaryCsrfTokenInput' => Token::getInstance()->getTokenInput('add-glossary'),
-        'closeModal' => Translation::get('ad_att_close'),
-        'saveModal' => Translation::get('ad_gen_save'),
-        'updateGlossaryTitle' => Translation::get('ad_glossary_edit'),
-        'updateGlossaryCsrfToken' => Token::getInstance()->getTokenString('update-glossary'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/group.php
+++ b//dev/null
@@ -1,289 +0,0 @@
-<?php
-/**
- * Displays the group management frontend.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Lars Tiedemann <php@larstiedemann.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Charles Boin <c.boin@h-tube.com>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-12-15
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\Extensions\PermissionTranslationTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$templateVars = [];
-if (
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_ADD->value) &&
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_DELETE->value) &&
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_EDIT->value)
-) {
-    require __DIR__ . '/no-permission.php';
-}
-$defaultGroupAction = 'list';
-$groupActionList = [
-    'update_members',
-    'update_rights',
-    'update_data',
-    'delete_confirm',
-    'delete',
-    'addsave',
-    'add',
-    'list',
-    'import-ldap-groups',
-];
-$groupAction = Filter::filterInput(INPUT_GET, 'group_action', FILTER_SANITIZE_SPECIAL_CHARS, $defaultGroupAction);
-$currentUser = new CurrentUser($faqConfig);
-if (isset($_POST['group_action_deleteConfirm'])) {
-    $groupAction = 'delete_confirm';
-}
-if (isset($_POST['cancel'])) {
-    $groupAction = $defaultGroupAction;
-}
-if (!in_array($groupAction, $groupActionList)) {
-}
-if (
-    $groupAction == 'update_members' &&
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_EDIT->value)
-) {
-    $message = '';
-    $groupAction = $defaultGroupAction;
-    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT);
-    $groupMembers = $_POST['group_members'] ?? [];
-    if ($groupId == 0) {
-        $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_user_error_noId'));
-    } else {
-        $user = new User($faqConfig);
-        $perm = $user->perm;
-        if (!$perm->removeAllUsersFromGroup($groupId)) {
-            $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_msg_mysqlerr'));
-        }
-        foreach ($groupMembers as $memberId) {
-            $perm->addToGroup((int)$memberId, $groupId);
-        }
-        $message .= sprintf(
-            '<p class="alert alert-success">%s <strong>%s</strong> %s</p>',
-            Translation::get('ad_msg_savedsuc_1'),
-            $perm->getGroupName($groupId),
-            Translation::get('ad_msg_savedsuc_2')
-        );
-    }
-}
-if (
-    $groupAction == 'update_rights' &&
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_EDIT->value)
-) {
-    $message = '';
-    $groupAction = $defaultGroupAction;
-    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT);
-    if ($groupId == 0) {
-        $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_user_error_noId'));
-    } else {
-        $user = new User($faqConfig);
-        $perm = $user->perm;
-        $groupRights = $_POST['group_rights'] ?? [];
-        if (!$perm->refuseAllGroupRights($groupId)) {
-            $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_msg_mysqlerr'));
-        }
-        foreach ($groupRights as $rightId) {
-            $perm->grantGroupRight($groupId, (int)$rightId);
-        }
-        $message .= sprintf(
-            '<p class="alert alert-success">%s <strong>%s</strong> %s</p>',
-            Translation::get('ad_msg_savedsuc_1'),
-            $perm->getGroupName($groupId),
-            Translation::get('ad_msg_savedsuc_2')
-        );
-    }
-}
-if (
-    $groupAction == 'update_data' &&
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_EDIT->value)
-) {
-    $message = '';
-    $groupAction = $defaultGroupAction;
-    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT);
-    if ($groupId == 0) {
-        $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_user_error_noId'));
-    } else {
-        $groupData = [];
-        $dataFields = ['name', 'description', 'auto_join'];
-        foreach ($dataFields as $field) {
-            $groupData[$field] = Filter::filterInput(INPUT_POST, $field, FILTER_SANITIZE_SPECIAL_CHARS, '');
-        }
-        $user = new User($faqConfig);
-        $perm = $user->perm;
-        if (!$perm->changeGroup($groupId, $groupData)) {
-            $message .= sprintf(
-                '<div class="alert alert-danger">%s %s</div>',
-                Translation::get('ad_msg_mysqlerr'),
-                $faqConfig->getDb()->error()
-            );
-        } else {
-            $message .= sprintf(
-                '<p class="alert alert-success">%s <strong>%s</strong> %s</p>',
-                Translation::get('ad_msg_savedsuc_1'),
-                $perm->getGroupName($groupId),
-                Translation::get('ad_msg_savedsuc_2')
-            );
-        }
-    }
-}
-if (
-    $groupAction == 'delete_confirm' &&
-    $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_DELETE->value)
-) {
-    $message = '';
-    $user = new CurrentUser($faqConfig);
-    $perm = $user->perm;
-    $groupId = Filter::filterInput(INPUT_POST, 'group_list_select', FILTER_VALIDATE_INT, 0);
-    if ($groupId <= 0) {
-        $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_user_error_noId'));
-        $groupAction = $defaultGroupAction;
-    } else {
-        $groupData = $perm->getGroupData($groupId);
-        $showDeleteGroupForm = true;
-        $templateVars = [
-            ...$templateVars,
-            'ad_group_deleteGroup' => Translation::get('ad_group_deleteGroup'),
-            'groupName' => Strings::htmlentities($groupData['name']),
-            'ad_group_deleteQuestion' => Translation::get('ad_group_deleteQuestion'),
-            'groupId' => $groupId,
-            'csrfDeleteGroup' => Token::getInstance()->getTokenString('delete-group'),
-            'ad_gen_no' => Translation::get('ad_gen_no'),
-            'ad_gen_yes' => Translation::get('ad_gen_yes'),
-            'showDeleteGroupForm' => $showDeleteGroupForm
-        ];
-    }
-}
-if ($groupAction == 'delete' && $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_DELETE->value)) {
-    $message = '';
-    $user = new User($faqConfig);
-    $groupId = Filter::filterInput(INPUT_POST, 'group_id', FILTER_VALIDATE_INT);
-    $csrfOkay = true;
-    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-    if (!Token::getInstance()->verifyToken('delete-group', $csrfToken)) {
-        $csrfOkay = false;
-    }
-    $groupAction = $defaultGroupAction;
-    if ($groupId <= 0) {
-        $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_user_error_noId'));
-    } else {
-        if (!$user->perm->deleteGroup($groupId) && !$csrfOkay) {
-            $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_group_error_delete'));
-        } else {
-            $message .= sprintf('<div class="alert alert-danger">%s</div>', Translation::get('ad_group_deleted'));
-        }
-        $userError = $user->error();
-        if ($userError != '') {
-            $message .= sprintf('<p class="alert alert-danger">%s</p>', $userError);
-        }
-    }
-}
-if ($groupAction == 'addsave' && $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_ADD->value)) {
-    $user = new User($faqConfig);
-    $message = '';
-    $messages = [];
-    $groupName = Filter::filterInput(INPUT_POST, 'group_name', FILTER_SANITIZE_SPECIAL_CHARS, '');
-    $groupDescription = Filter::filterInput(INPUT_POST, 'group_description', FILTER_SANITIZE_SPECIAL_CHARS, '');
-    $groupAutoJoin = Filter::filterInput(INPUT_POST, 'group_auto_join', FILTER_SANITIZE_SPECIAL_CHARS, '');
-    $csrfOkay = true;
-    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-    if (!Token::getInstance()->verifyToken('add-group', $csrfToken)) {
-        $csrfOkay = false;
-    }
-    if ($groupName == '') {
-        $messages[] = Translation::get('ad_group_error_noName');
-    }
-    if (count($messages) == 0 && $csrfOkay) {
-        $groupData = [
-            'name' => $groupName,
-            'description' => $groupDescription,
-            'auto_join' => $groupAutoJoin,
-        ];
-        if ($user->perm->addGroup($groupData) <= 0) {
-            $messages[] = Translation::get('ad_adus_dberr');
-        }
-    }
-    if (count($messages) === 0) {
-        $groupAction = $defaultGroupAction;
-        $message = sprintf('<div class="alert alert-success">%s</div>', Translation::get('ad_group_suc'));
-    } else {
-        $groupAction = 'add';
-        $message = '<p class="alert alert-danger">';
-        foreach ($messages as $err) {
-            $message .= $err . '<br>';
-        }
-        $message .= '</p>';
-    }
-}
-if (!isset($message)) {
-    $message = '';
-}
-if ($groupAction == 'add' && $user->perm->hasPermission($user->getUserId(), PermissionType::GROUP_ADD->value)) {
-    $user = new CurrentUser($faqConfig);
-    $templateVars = [
-        ...$templateVars,
-        'ad_group_add' => Translation::get('ad_group_add'),
-        'csrfAddGroup' => Token::getInstance()->getTokenString('add-group'),
-        'ad_group_name' => Translation::get('ad_group_name'),
-        'groupName' => $groupName ?? '',
-        'ad_group_description' => Translation::get('ad_group_description'),
-        'groupDescription' => $groupDescription ?? '',
-        'ad_group_autoJoin' => Translation::get('ad_group_autoJoin'),
-        'autoJoinCheckbox' => ((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : ''),
-        'ad_gen_cancel' => Translation::get('ad_gen_cancel'),
-        'ad_gen_save' => Translation::get('ad_gen_save'),
-        'groupAction' => $groupAction
-    ];
-}
-if ('list' === $groupAction) {
-    $templateVars = [
-        ...$templateVars,
-        'ad_menu_group_administration' => Translation::get('ad_menu_group_administration'),
-        'ad_group_add_link' => Translation::get('ad_group_add_link'),
-        'message' => $message,
-        'ad_groups' => Translation::get('ad_groups'),
-        'ad_gen_delete' => Translation::get('ad_gen_delete'),
-        'ad_group_details' => Translation::get('ad_group_details'),
-        'ad_group_name' => Translation::get('ad_group_name'),
-        'groupName' => $groupName ?? '',
-        'ad_group_description' => Translation::get('ad_group_description'),
-        'groupDescription' => $groupDescription ?? '',
-        'autoJoinCheckbox' => ((isset($groupAutoJoin) && $groupAutoJoin) ? ' checked' : ''),
-        'ad_group_autoJoin' => Translation::get('ad_group_autoJoin'),
-        'ad_gen_save' => Translation::get('ad_gen_save'),
-        'ad_group_membership' => Translation::get('ad_group_membership'),
-        'ad_group_addMember' => Translation::get('ad_group_addMember'),
-        'ad_group_members' => Translation::get('ad_group_members'),
-        'ad_group_removeMember' => Translation::get('ad_group_removeMember'),
-        'ad_group_rights' => Translation::get('ad_group_rights'),
-        'ad_user_checkall' => Translation::get('ad_user_checkall'),
-        'ad_user_uncheckall' => Translation::get('ad_user_uncheckall'),
-        'rightData' => $user->perm->getAllRightsData(),
-        'groupAction' => $groupAction
-    ];
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$twig->addExtension(new PermissionTranslationTwigExtension());
-$template = $twig->loadTemplate('@admin/user/group.twig');
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/header.php
+++ b//dev/null
@@ -1,275 +0,0 @@
-<?php
-/**
- * Header of the admin area.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-26
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Helper\AdministrationHelper;
-use phpMyFAQ\Helper\LanguageHelper;
-use phpMyFAQ\Services\Gravatar;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$dashboardPage = true;
-$contentPage = false;
-$userPage = false;
-$statisticsPage = false;
-$exportsPage = false;
-$backupPage = false;
-$configurationPage = false;
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$adminHelper = new AdministrationHelper();
-$adminHelper->setUser($user);
-$secLevelEntries['user'] = $adminHelper->addMenuEntry(
-    'add_user+edit_user+delete_user',
-    'user',
-    'ad_menu_user_administration',
-    $action
-);
-if ($faqConfig->get('security.permLevel') !== 'basic') {
-    $secLevelEntries['user'] .= $adminHelper->addMenuEntry(
-        'addgroup+editgroup+delgroup',
-        'group',
-        'ad_menu_group_administration',
-        $action
-    );
-}
-$secLevelEntries['content'] = $adminHelper->addMenuEntry(
-    'addcateg+editcateg+delcateg',
-    'category-overview',
-    'msgHeaderCategoryOverview',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    PermissionType::FAQ_ADD->value,
-    'editentry',
-    'ad_entry_add',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    'edit_faq+delete_faq',
-    'faqs-overview',
-    'msgHeaderFAQOverview',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    PermissionType::FAQ_EDIT->value,
-    'stickyfaqs',
-    'stickyRecordsHeader',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry('delquestion', 'question', 'ad_menu_open', $action);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry('delcomment', 'comments', 'ad_menu_comments', $action);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    'addattachment+editattachment+delattachment',
-    'attachments',
-    'ad_menu_attachments',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    PermissionType::FAQ_EDIT->value,
-    'tags',
-    'ad_entry_tags',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    'addglossary+editglossary+delglossary',
-    'glossary',
-    'ad_menu_glossary',
-    $action
-);
-$secLevelEntries['content'] .= $adminHelper->addMenuEntry(
-    'addnews+editnews+delnews',
-    'news',
-    'ad_menu_news_edit',
-    $action
-);
-$secLevelEntries['statistics'] = $adminHelper->addMenuEntry(
-    PermissionType::STATISTICS_VIEWLOGS->value,
-    'statistics',
-    'ad_menu_stat',
-    $action
-);
-$secLevelEntries['statistics'] .= $adminHelper->addMenuEntry(
-    PermissionType::STATISTICS_VIEWLOGS->value,
-    'viewsessions',
-    'ad_menu_session',
-    $action
-);
-$secLevelEntries['statistics'] .= $adminHelper->addMenuEntry(
-    PermissionType::STATISTICS_ADMINLOG->value,
-    'adminlog',
-    'ad_menu_adminlog',
-    $action
-);
-$secLevelEntries['statistics'] .= $adminHelper->addMenuEntry(
-    PermissionType::STATISTICS_VIEWLOGS->value,
-    'searchstats',
-    'ad_menu_searchstats',
-    $action
-);
-$secLevelEntries['statistics'] .= $adminHelper->addMenuEntry('reports', 'reports', 'ad_menu_reports', $action);
-$secLevelEntries['imports_exports'] = $adminHelper->addMenuEntry(
-    PermissionType::FAQ_ADD->value,
-    'importcsv',
-    'msgImportRecords',
-    $action
-);
-$secLevelEntries['imports_exports'] .= $adminHelper->addMenuEntry('export', 'export', 'ad_menu_export', $action);
-$secLevelEntries['backup'] = $adminHelper->addMenuEntry('editconfig', 'backup', 'ad_menu_backup', $action);
-$secLevelEntries['config'] = $adminHelper->addMenuEntry('editconfig', 'config', 'ad_menu_editconfig', $action);
-$secLevelEntries['config'] .= $adminHelper->addMenuEntry('forms_edit', 'forms', 'msgEditForms', $action);
-$secLevelEntries['config'] .= $adminHelper->addMenuEntry(
-    'editinstances+addinstances+delinstances',
-    'instances',
-    'ad_menu_instances',
-    $action
-);
-$secLevelEntries['config'] .= $adminHelper->addMenuEntry(
-    'editconfig',
-    'stopwordsconfig',
-    'ad_menu_stopwordsconfig',
-    $action
-);
-if ($faqConfig->get('upgrade.onlineUpdateEnabled')) {
-    $secLevelEntries['config'] .= $adminHelper->addMenuEntry('editconfig', 'upgrade', 'ad_menu_upgrade', $action);
-}
-if ($faqConfig->get('search.enableElasticsearch')) {
-    $secLevelEntries['config'] .= $adminHelper->addMenuEntry(
-        'editconfig',
-        'elasticsearch',
-        'ad_menu_elasticsearch',
-        $action
-    );
-}
-$secLevelEntries['config'] .= $adminHelper->addMenuEntry('editconfig', 'system', 'ad_system_info', $action);
-switch ($action) {
-    case 'user':
-    case 'group':
-    case 'passwd':
-    case 'cookies':
-        $userPage = true;
-        break;
-    case 'category-overview':
-    case 'addcategory':
-    case 'savecategory':
-    case 'editcategory':
-    case 'translatecategory':
-    case 'updatecategory':
-    case 'showcategory':
-    case 'faqs-overview':
-    case 'editentry':
-    case 'copyentry':
-    case 'glossary':
-    case 'saveglossary':
-    case 'updateglossary':
-    case 'deleteglossary':
-    case 'addglossary':
-    case 'editglossary':
-    case 'news':
-    case 'add-news':
-    case 'edit-news':
-    case 'save-news':
-    case 'update-news':
-    case 'delete-news':
-    case 'question':
-    case 'takequestion':
-    case 'comments':
-    case 'attachments':
-    case 'tags':
-    case 'delete-tag':
-    case 'stickyfaqs':
-        $contentPage = true;
-        break;
-    case 'statistics':
-    case 'viewsessions':
-    case 'sessionbrowse':
-    case 'sessionsuche':
-    case 'adminlog':
-    case 'searchstats':
-    case 'reports':
-    case 'reportview':
-        $statisticsPage = true;
-        break;
-    case 'export':
-    case 'importcsv':
-        $exportsPage = true;
-        break;
-    case 'backup':
-        $backupPage = true;
-        break;
-    case 'config':
-    case 'stopwordsconfig':
-    case 'upgrade':
-    case 'instances':
-    case 'system':
-    case 'elasticsearch':
-    case 'forms':
-        $configurationPage = true;
-        break;
-    default:
-        $dashboardPage = true;
-        break;
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/header.twig');
-if ($faqConfig->get('main.enableGravatarSupport')) {
-    $avatar = new Gravatar();
-    $gravatarImage = $avatar->getImage(
-        $user->getUserData('email'),
-        ['size' => 24, 'class' => 'img-profile rounded-circle']
-    );
-}
-$templateVars = [
-    'metaLanguage' => Translation::get('metaLanguage'),
-    'layoutMode' => 'light',
-    'pageTitle' => $faqConfig->getTitle() . ' - ' . System::getPoweredByString(),
-    'baseHref' => $faqConfig->getDefaultUrl() . 'admin/',
-    'version' => System::getVersion(),
-    'currentYear' => date('Y'),
-    'metaRobots' => $faqConfig->get('seo.metaTagsAdmin'),
-    'templateSetName' => TwigWrapper::getTemplateSetName(),
-    'pageDirection' => Translation::get('direction'),
-    'userHasAccessPermission' => $adminHelper->canAccessContent($user),
-    'msgSessionExpiration' => Translation::get('ad_session_expiration'),
-    'pageAction' => isset($action) ? '?action=' . $action : '',
-    'renderedLanguageSelection' => LanguageHelper::renderSelectLanguage($faqLangCode, true),
-    'userName' => $user->getUserData('display_name'),
-    'hasGravatarSupport' => $faqConfig->get('main.enableGravatarSupport'),
-    'gravatarImage' => $gravatarImage ?? '',
-    'msgChangePassword' => Translation::get('ad_menu_passwd'),
-    'csrfTokenLogout' => Token::getInstance()->getTokenString('admin-logout'),
-    'msgLogout' => Translation::get('admin_mainmenu_logout'),
-    'secondLevelEntries' => $secLevelEntries,
-    'menuUsers' => Translation::get('admin_mainmenu_users'),
-    'menuContent' => Translation::get('admin_mainmenu_content'),
-    'menuStatistics' => Translation::get('admin_mainmenu_statistics'),
-    'menuImportsExports' => Translation::get('admin_mainmenu_imports_exports'),
-    'menuBackup' => Translation::get('admin_mainmenu_backup'),
-    'menuConfiguration' => Translation::get('admin_mainmenu_configuration'),
-    'userPage' => $userPage,
-    'contentPage' => $contentPage,
-    'statisticsPage' => $statisticsPage,
-    'exportsPage' => $exportsPage,
-    'backupPage' => $backupPage,
-    'configurationPage' => $configurationPage,
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/import.csv.php
+++ b//dev/null
@@ -1,56 +0,0 @@
-<?php
-/**
- * Frontend for importing records from a csv file.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::FAQ_ADD->value)) {
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/import-export/import.csv.twig');
-    $templateVars = [
-        'adminHeaderImport' => Translation::get('msgImportRecords'),
-        'adminHeaderCSVImport' => Translation::get('msgImportCSVFile'),
-        'adminBodyCSVImport' => Translation::get('msgImportCSVFileBody'),
-        'adminImportLabel' => Translation::get('ad_csv_file'),
-        'adminCSVImport' => Translation::get('msgImport'),
-        'adminHeaderCSVImportColumns' => Translation::get('msgColumnStructure'),
-        'categoryId' => Translation::get('ad_categ_categ'),
-        'question' => Translation::get('ad_entry_topic'),
-        'answer' => Translation::get('ad_entry_content'),
-        'keywords' => Translation::get('ad_entry_keywords'),
-        'author' => Translation::get('ad_entry_author'),
-        'email' => Translation::get('msgEmail'),
-        'languageCode' => Translation::get('msgLanguageCode'),
-        'seperateWithCommas' => Translation::get('msgSeperateWithCommas'),
-        'tags' => Translation::get('ad_entry_tags'),
-        'msgImportRecordsColumnStructure' => Translation::get('msgImportRecordsColumnStructure'),
-        'csrfToken' => Token::getInstance()->getTokenString('importfaqs'),
-        'is_active' => Translation::get('ad_entry_active'),
-        'is_sticky' => Translation::get('ad_entry_sticky'),
-        'trueFalse' => Translation::get('msgCSVImportTrueOrFalse')
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/index.php
+++ b//dev/null
@@ -1,317 +0,0 @@
-<?php
-/**
- * The main admin backend index file.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Bastian Poettner <bastian@poettner.net>
- * @author    Meikel Katzengreis <meikel@katzengreis.com>
- * @author    Minoru TODA <todam@netjapan.co.jp>
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-16
- */
-use phpMyFAQ\Administration\AdminLog;
-use phpMyFAQ\Attachment\AttachmentFactory;
-use phpMyFAQ\Faq;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Language;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use phpMyFAQ\User\TwoFactor;
-use phpMyFAQ\User\UserAuthentication;
-use Symfony\Component\Config\FileLocator;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-define('PMF_ROOT_DIR', dirname(__DIR__));
-const IS_VALID_PHPMYFAQ = null;
-require PMF_ROOT_DIR . '/src/Bootstrap.php';
-$response = new Response();
-$request = Request::createFromGlobals();
-$container = new ContainerBuilder();
-$loader = new PhpFileLoader($container, new FileLocator(__DIR__));
-try {
-    $loader->load('../src/services.php');
-} catch (Exception $e) {
-    echo $e->getMessage();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$Language = $container->get('phpmyfaq.language');
-$faqLangCode = $Language->setLanguage($faqConfig->get('main.languageDetection'), $faqConfig->get('main.language'));
-$faqConfig->setLanguage($Language);
-if (!Language::isASupportedLanguage($faqLangCode)) {
-    $faqLangCode = 'en';
-}
-try {
-    Translation::create()
-            ->setLanguagesDir(PMF_TRANSLATION_DIR)
-            ->setDefaultLanguage('en')
-            ->setCurrentLanguage($faqLangCode)
-            ->setMultiByteLanguage();
-} catch (Exception $e) {
-    echo '<strong>Error:</strong> ' . $e->getMessage();
-}
-Strings::init($faqLangCode);
-TwigWrapper::setTemplateSetName($faqConfig->get('layout.templateSet'));
-AttachmentFactory::init(
-    $faqConfig->get('records.defaultAttachmentEncKey'),
-    $faqConfig->get('records.enableAttachmentEncryption')
-);
-$faqSystem = new System();
-$faq = new Faq($faqConfig);
-$action = Filter::filterInput(INPUT_GET, 'action', FILTER_SANITIZE_SPECIAL_CHARS);
-if (is_null($action)) {
-    $action = Filter::filterInput(INPUT_POST, 'action', FILTER_SANITIZE_SPECIAL_CHARS);
-}
-if (!is_null($action)) {
-    $action = Strings::htmlentities($action);
-}
-$redirectAction = Filter::filterInput(INPUT_POST, 'redirect-action', FILTER_SANITIZE_SPECIAL_CHARS);
-if (is_null($action) && '' !== $redirectAction && 'logout' !== $redirectAction) {
-    $action = $redirectAction;
-}
-$error = '';
-$faqusername = Filter::filterVar($request->request->get('faqusername'), FILTER_SANITIZE_SPECIAL_CHARS);
-$faqpassword = Filter::filterVar($request->request->get('faqpassword'), FILTER_SANITIZE_SPECIAL_CHARS, FILTER_FLAG_NO_ENCODE_QUOTES);
-$rememberMe = Filter::filterVar($request->request->get('faqrememberme'), FILTER_VALIDATE_BOOLEAN);
-$token = Filter::filterVar($request->request->get('token'), FILTER_SANITIZE_SPECIAL_CHARS);
-$userid = Filter::filterVar($request->request->get('userid'), FILTER_VALIDATE_INT);
-if (!is_null($token) && !is_null($userid)) {
-    $user = new CurrentUser($faqConfig);
-    $user->getUserById($userid);
-    if (strlen((string) $token) === 6 && is_numeric((string) $token)) {
-        $tfa = new TwoFactor($faqConfig, $user);
-        $res = $tfa->validateToken($token, $userid);
-        if (!$res) {
-            $error = Translation::get('msgTwofactorErrorToken');
-            $action = 'twofactor';
-        } else {
-            $user->twoFactorSuccess();
-            require 'header.php';
-            require 'dashboard.php';
-            exit();
-        }
-    } else {
-        $error = Translation::get('msgTwofactorErrorToken');
-        $action = 'twofactor';
-    }
-}
-if (!isset($user)) {
-    $user = new CurrentUser($faqConfig);
-}
-if ($faqConfig->get('security.ssoSupport') && $request->server->get('REMOTE_USER') !== null) {
-    $faqusername = trim((string) $request->server->get('REMOTE_USER'));
-    $faqpassword = '';
-}
-if ($faqusername !== '' && ($faqpassword !== '' || $faqConfig->get('security.ssoSupport'))) {
-    $userAuth = new UserAuthentication($faqConfig, $user);
-    $userAuth->setRememberMe($faqremember ?? false);
-    try {
-        $user = $userAuth->authenticate($faqusername, $faqpassword);
-        $userid = $user->getUserId();
-        if ($userAuth->hasTwoFactorAuthentication()) {
-            $action = 'twofactor';
-        }
-    } catch (Exception $e) {
-        $logging = new AdminLog($faqConfig);
-        $logging->log($user, 'Login-error\nLogin: ' . $faqusername . '\nErrors: ' . implode(', ', $user->errors));
-        $action = 'login';
-        $error = $e->getMessage();
-    }
-} else {
-    $user = CurrentUser::getCurrentUser($faqConfig);
-}
-if (isset($userAuth)) {
-    if ($userAuth instanceof UserAuthentication) {
-        if ($userAuth->hasTwoFactorAuthentication()) {
-            $action = 'twofactor';
-        }
-    }
-}
-$csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-if (
-    $csrfToken &&
-    Token::getInstance()->verifyToken('admin-logout', $csrfToken) &&
-    $action === 'logout' &&
-    $user->isLoggedIn()
-) {
-    $user->deleteFromSession(true);
-    $ssoLogout = $faqConfig->get('security.ssoLogoutRedirect');
-    if ($faqConfig->get('security.ssoSupport') && !empty($ssoLogout)) {
-        $response->isRedirect($ssoLogout);
-        $response->send();
-        exit();
-    }
-}
-[$currentAdminUser, $currentAdminGroups] = CurrentUser::getCurrentUserGroupId($user);
-switch ($action) {
-    case 'reportexport':
-        require 'report.export.php';
-        exit();
-}
-require 'header.php';
-if ($action === 'twofactor') {
-    require 'twofactor.php';
-    exit();
-}
-$numRights = $user->perm->getUserRightsCount($user);
-if ($user->isLoggedIn() && $user->getUserId() > 0 && ($numRights > 0 || $user->isSuperAdmin())) {
-    if (!is_null($action)) {
-        switch ($action) {
-            case 'user':
-                require 'user.php';
-                break;
-            case 'group':
-                require 'group.php';
-                break;
-            case 'faqs-overview':
-                require 'faqs.overview.php';
-                break;
-            case 'viewinactive':
-            case 'viewactive':
-            case 'takequestion':
-            case 'editentry':
-            case 'copyentry':
-                require 'faqs.editor.php';
-                break;
-            case 'question':
-                require 'open-questions.php';
-                break;
-            case 'comments':
-                require 'comments.php';
-                break;
-            case 'stickyfaqs':
-                require 'stickyfaqs.php';
-                break;
-            case 'tags':
-            case 'delete-tag':
-                require 'tags.php';
-                break;
-            case 'news':
-            case 'add-news':
-            case 'edit-news':
-            case 'save-news':
-            case 'update-news':
-            case 'delete-news':
-                require 'news.php';
-                break;
-            case 'savecategory':
-            case 'updatecategory':
-                require 'category.main.php';
-                break;
-            case 'category-overview':
-                require 'category.overview.php';
-                break;
-            case 'addcategory':
-                require 'category.add.php';
-                break;
-            case 'editcategory':
-                require 'category.edit.php';
-                break;
-            case 'translatecategory':
-                require 'category.translate.php';
-                break;
-            case 'showcategory':
-                require 'category.showstructure.php';
-                break;
-            case 'glossary':
-                require 'glossary.php';
-                break;
-            case 'passwd':
-                require 'password.change.php';
-                break;
-            case 'adminlog':
-                require 'statistics.admin-log.php';
-                break;
-            case 'viewsessions':
-            case 'clear-visits':
-                require 'statistics.sessions.php';
-                break;
-            case 'sessionbrowse':
-                require 'statistics.sessions.day.php';
-                break;
-            case 'viewsession':
-                require 'statistics.show.php';
-                break;
-            case 'clear-statistics':
-            case 'statistics':
-                require 'statistics.ratings.php';
-                break;
-            case 'truncatesearchterms':
-            case 'searchstats':
-                require 'statistics.search.php';
-                break;
-            case 'reports':
-                require 'report.main.php';
-                break;
-            case 'reportview':
-                require 'report.view.php';
-                break;
-            case 'config':
-                require 'configuration.php';
-                break;
-            case 'system':
-                require 'system.php';
-                break;
-            case 'update-instance':
-            case 'instances':
-                require 'instances.php';
-                break;
-            case 'edit-instance':
-                require 'instances.edit.php';
-                break;
-            case 'stopwordsconfig':
-                require 'stopwords.php';
-                break;
-            case 'elasticsearch':
-                require 'elasticsearch.php';
-                break;
-            case 'upgrade':
-                require 'upgrade.php';
-                break;
-            case 'backup':
-                require 'backup.main.php';
-                break;
-            case 'restore':
-                require 'backup.import.php';
-                break;
-            case 'importcsv':
-                require 'import.csv.php';
-                break;
-            case 'export':
-                require 'export.php';
-                break;
-            case 'attachments':
-                require 'attachments.php';
-                break;
-            case 'forms':
-                require 'forms.php';
-                break;
-            case 'forms-translations':
-                require 'forms.translations.php';
-                break;
-            default:
-                echo 'Dave, this conversation can serve no purpose anymore. Goodbye.';
-                break;
-        }
-    } else {
-        require 'dashboard.php';
-    }
-} elseif ($user->isLoggedIn() && $numRights === 0) {
-    require __DIR__ . '/no-permission.php';
-} else {
-    require 'login.php';
-}
-require 'footer.php';

--- a/phpmyfaq/admin/instances.edit.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-/**
- * Frontend to edit an instance.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-04-16
- */
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Instance;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::INSTANCE_EDIT->value)) {
-    $instanceId = Filter::filterInput(INPUT_GET, 'instance_id', FILTER_VALIDATE_INT);
-    $instance = new Instance($faqConfig);
-    $instanceData = $instance->getById($instanceId, 'array');
-    $templateVars = [
-        'ad_menu_instances' => Translation::get('ad_menu_instances'),
-        'instanceConfig' => $instance->getInstanceConfig($instanceData->id),
-        'ad_instance_url' => Translation::get('ad_instance_url'),
-        'ad_instance_button' => Translation::get('ad_instance_button'),
-        'ad_instance_path' => Translation::get('ad_instance_path'),
-        'ad_instance_name' => Translation::get('ad_instance_name'),
-        'ad_instance_config' => Translation::get('ad_instance_config'),
-        'ad_entry_back' => Translation::get('ad_entry_back'),
-        'instance' => $instanceData
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/configuration/instances.edit.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/instances.php
+++ b/phpmyfaq/admin/instances.php
@@ -1,108 +1,217 @@
 <?php
 /**
  * The main multi-site instances frontend.
  *
  * This Source Code Form is subject to the terms of the Mozilla Public License,
  * v. 2.0. If a copy of the MPL was not distributed with this file, You can
  * obtain one at https://mozilla.org/MPL/2.0/.
  *
  * @package   phpMyFAQ
  * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
+ * @copyright 2012-2023 phpMyFAQ Team
  * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
  * @link      https://www.phpmyfaq.de
  * @since     2012-03-16
  */
-use phpMyFAQ\Configuration;
+use phpMyFAQ\Component\Alert;
 use phpMyFAQ\Entity\InstanceEntity;
-use phpMyFAQ\Enums\PermissionType;
 use phpMyFAQ\Filesystem;
 use phpMyFAQ\Filter;
 use phpMyFAQ\Instance;
 use phpMyFAQ\Instance\Client;
 use phpMyFAQ\Session\Token;
+use phpMyFAQ\Strings;
 use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
 use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
 use Symfony\Component\HttpFoundation\Request;
 if (!defined('IS_VALID_PHPMYFAQ')) {
     http_response_code(400);
     exit();
 }
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::INSTANCE_EDIT->value)) {
+?>
+    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
+        <h1 class="h2">
+            <i aria-hidden="true" class="fa fa-wrench fa-fw"></i> <?= Translation::get('ad_menu_instances') ?>
+        </h1>
+        <?php if ($user->perm->hasPermission($user->getUserId(), 'addinstances') &&
+            is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite')
+        ) : ?>
+        <div class="btn-toolbar mb-2 mb-md-0">
+            <div class="btn-group mr-2">
+                <a class="btn btn-sm btn-success" data-bs-toggle="modal" href="#pmf-modal-add-instance">
+                    <i aria-hidden="true" class="fa fa-plus"></i> <?= Translation::get('ad_instance_add') ?>
+                </a>
+            </div>
+        </div>
+        <?php endif; ?>
+    </div>
+  <div class="row">
+  <div class="col-lg-12">
+<?php
+if ($user->perm->hasPermission($user->getUserId(), 'editinstances')) {
     $fileSystem = new Filesystem(PMF_ROOT_DIR);
     $instance = new Instance($faqConfig);
     $currentClient = new Client($faqConfig);
     $currentClient->setFileSystem($fileSystem);
     $instanceId = Filter::filterInput(INPUT_POST, 'instance_id', FILTER_VALIDATE_INT);
-    $templateVars = [];
+    if (!$currentClient->isMultiSiteWriteable()) {
+        echo Alert::danger('ad_instance_error_notwritable');
+    }
     if ('update-instance' === $action && is_integer($instanceId)) {
         $system = new System();
         $updatedClient = new Client($faqConfig);
         $moveInstance = false;
         $instance->setId($instanceId);
         $updatedData = new InstanceEntity();
         $updatedData->setUrl(Filter::filterInput(INPUT_POST, 'url', FILTER_VALIDATE_URL));
         $updatedData->setInstance(Filter::filterInput(INPUT_POST, 'instance', FILTER_SANITIZE_SPECIAL_CHARS));
         $updatedData->setComment(Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_SPECIAL_CHARS));
-        $originalData = $currentClient->getById($instanceId);
+        $originalData = $currentClient->getInstanceById($instanceId);
         if ($originalData->url !== $updatedData->getUrl() && !$instance->getConfig('isMaster')) {
             $moveInstance = true;
         }
         if (is_null($updatedData->getUrl())) {
-            $templateVars = [
-                ... $templateVars,
-                'updateError' => $faqConfig->getDb()->error(),
-            ];
+            echo Alert::danger('ad_entryins_fail', $faqConfig->getDb()->error());
         } else {
-            if ($updatedClient->update($instanceId, $updatedData)) {
+            if ($updatedClient->updateInstance($instanceId, $updatedData)) {
                 if ($moveInstance) {
                     $updatedClient->moveClientFolder($originalData->url, $updatedData->getUrl());
                     $updatedClient->deleteClientFolder($originalData->url);
                 }
-                $templateVars = [
-                    ... $templateVars,
-                    'updateSuccess' => Translation::get('ad_config_saved'),
-                ];
+                echo Alert::success('ad_config_saved');
             } else {
-                $templateVars = [
-                    ... $templateVars,
-                    'updateError' => $faqConfig->getDb()->error(),
-                ];
+                echo Alert::danger('ad_entryins_fail', $faqConfig->getDb()->error());
             }
         }
     }
-    $mainConfig = [];
-    foreach ($instance->getAll() as $site) {
-        $mainConfig[$site->id] = $instance->getInstanceConfig($site->id)['isMaster'];
-    }
-    $templateVars = [
-        ... $templateVars,
-        'userPermInstanceAdd' => $user->perm->hasPermission($user->getUserId(), PermissionType::INSTANCE_ADD->value),
-        'multisiteFolderIsWritable' => is_writable(PMF_ROOT_DIR . DIRECTORY_SEPARATOR . 'multisite'),
-        'ad_instance_add' => Translation::get('ad_instance_add'),
-        'allInstances' => $instance->getAll(),
-        'csrfTokenDeleteInstance' => Token::getInstance()->getTokenString('delete-instance'),
-        'csrfTokenAddInstance' => Token::getInstance()->getTokenString('add-instance'),
-        'mainConfig' => $mainConfig,
-        'requestHost' => Request::createFromGlobals()->getHost(),
-        'ad_instance_button' => Translation::get('ad_instance_button'),
-        'ad_instance_hint' => Translation::get('ad_instance_hint'),
-        'ad_instance_admin' => Translation::get('ad_instance_admin'),
-        'ad_instance_password' => Translation::get('ad_instance_password'),
-        'ad_instance_email' => Translation::get('ad_instance_email'),
-        'ad_instance_name' => Translation::get('ad_instance_name'),
-        'ad_instance_path' => Translation::get('ad_instance_path'),
-        'ad_instance_url' => Translation::get('ad_instance_url'),
-        'ad_instance_error_notwritable' => Translation::get('ad_instance_error_notwritable'),
-        'ad_menu_instances' => Translation::get('ad_menu_instances')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/configuration/instances.twig');
-    echo $template->render($templateVars);
+    ?>
+  <table class="table">
+    <thead>
+    <tr>
+      <th>#</th>
+      <th><?= Translation::get('ad_instance_url') ?></th>
+      <th><?= Translation::get('ad_instance_path') ?></th>
+      <th colspan="3"><?= Translation::get('ad_instance_name') ?></th>
+    </tr>
+    </thead>
+    <tbody>
+    <?php
+    foreach ($instance->getAllInstances() as $site) :
+        $currentInstance = new Instance($faqConfig);
+        $currentInstance->getInstanceById($site->id);
+        $currentInstance->setId($site->id);
+        ?>
+      <tr id="row-instance-<?= $site->id ?>">
+        <td><?= $site->id ?></td>
+        <td>
+          <a href="<?= Strings::htmlentities($site->url . $site->instance, ENT_QUOTES) ?>">
+                <?= Strings::htmlentities($site->url, ENT_QUOTES) ?>
+          </a>
+        </td>
+        <td><?= Strings::htmlentities($site->instance, ENT_QUOTES) ?></td>
+        <td><?= Strings::htmlentities($site->comment, ENT_QUOTES) ?></td>
+        <td>
+          <a href="?action=edit-instance&instance_id=<?= $site->id ?>" class="btn btn-info">
+            <i aria-hidden="true" class="fa fa-pencil"></i>
+          </a>
+        </td>
+        <td>
+            <?php
+            if (!$currentInstance->getConfig('isMaster')) {
+                $csrfToken = Token::getInstance()->getTokenString('delete-instance');
+            ?>
+              <button data-delete-instance-id="<?= $site->id ?>" type="button"
+                 class="btn btn-danger pmf-instance-delete"
+                 data-csrf-token="<?= $csrfToken ?>">
+                <i aria-hidden="true" class="fa fa-trash" data-delete-instance-id="<?= $site->id ?>"
+                   data-csrf-token="<?= $csrfToken ?>"></i>
+              </button>
+            <?php } ?>
+        </td>
+      </tr>
+    <?php endforeach; ?>
+    </tbody>
+  </table>
+  <div class="modal fade" id="pmf-modal-add-instance">
+    <div class="modal-dialog modal-lg">
+      <div class="modal-content">
+        <div class="modal-header">
+          <h4><?= Translation::get('ad_instance_add') ?></h4>
+            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
+        </div>
+        <div class="modal-body">
+          <form action="#" method="post" accept-charset="utf-8" class="needs-validation" novalidate>
+            <?= Token::getInstance()->getTokenInput('add-instance') ?>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="url">
+                  <?= Translation::get('ad_instance_url') ?>:
+              </label>
+              <div class="col-lg-8">
+                <div class="input-group">
+                  <div class="input-group-prepend">
+                    <div class="input-group-text">https://</div>
+                  </div>
+                  <input class="form-control mb-2" type="text" name="url" id="url" required>
+                  <div class="input-group-append">
+                    <div class="input-group-text">.<?= Request::createFromGlobals()->getHost() ?></div>
+                  </div>
+                </div>
+              </div>
+            </div>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="instance">
+                  <?= Translation::get('ad_instance_path') ?>:
+              </label>
+              <div class="col-lg-8">
+                <input class="form-control mb-2" type="text" name="instance" id="instance" required>
+              </div>
+            </div>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="comment">
+                  <?= Translation::get('ad_instance_name') ?>:
+              </label>
+              <div class="col-lg-8">
+                <input class="form-control mb-2" type="text" name="comment" id="comment" required>
+              </div>
+            </div>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="email">
+                  <?= Translation::get('ad_instance_email') ?>:
+              </label>
+              <div class="col-lg-8">
+                <input class="form-control mb-2" type="email" name="email" id="email" required>
+              </div>
+            </div>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="admin">
+                  <?= Translation::get('ad_instance_admin') ?>:
+              </label>
+              <div class="col-lg-8">
+                <input class="form-control mb-2" type="text" name="admin" id="admin" required>
+              </div>
+            </div>
+            <div class="form-group row">
+              <label class="col-form-label col-lg-4" for="password">
+                  <?= Translation::get('ad_instance_password') ?>:
+              </label>
+              <div class="col-lg-8">
+                <input class="form-control mb-2" type="password" autocomplete="off" name="password" id="password" required>
+              </div>
+            </div>
+          </form>
+        </div>
+        <div class="modal-footer">
+          <p class="text-sm-start"><?= Translation::get('ad_instance_hint') ?></p>
+          <button class="btn btn-primary pmf-instance-add" type="submit">
+              <?= Translation::get('ad_instance_button') ?>
+          </button>
+        </div>
+      </div>
+    </div>
+  </div>
+  </div>
+  </div>
+    <?php
 } else {
-    require __DIR__ . '/no-permission.php';
+    print Translation::get('err_NotAuth');
 }

--- a/phpmyfaq/admin/login.php
+++ b//dev/null
@@ -1,53 +0,0 @@
-<?php
-/**
- * The login form.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Alexander M. Turek <me@derrabus.de>
- * @copyright 2013-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2013-02-05
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-$faqConfig = Configuration::getConfigurationInstance();
-if (isset($error) && 0 < strlen((string) $error)) {
-    $errorMessage = $error;
-} else {
-    $errorMessage = '';
-}
-$request = Request::createFromGlobals();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/login.twig');
-$templateVars = [
-    'isSecure' => $request->isSecure() || !$faqConfig->get('security.useSslForLogins'),
-    'isError' => isset($error) && 0 < strlen((string) $error),
-    'errorMessage' => $errorMessage,
-    'loginMessage' => Translation::get('ad_auth_insert'),
-    'isLogout' => $request->query->get('action') === 'logout',
-    'logoutMessage' => Translation::get('ad_logout'),
-    'loginUrl' => $faqConfig->getDefaultUrl() . 'admin/index.php',
-    'redirectAction' => Strings::htmlentities($request->query->get('action') ?? '') ,
-    'msgUsername' => Translation::get('ad_auth_user'),
-    'msgPassword' => Translation::get('ad_auth_passwd'),
-    'msgRememberMe' => Translation::get('rememberMe'),
-    'msgLostPassword' => Translation::get('lostPassword'),
-    'msgLoginUser' => Translation::get('msgLoginUser'),
-    'hasRegistrationEnabled' => $faqConfig->get('security.enableRegistration'),
-    'msgRegistration' => Translation::get('msgRegistration'),
-    'hasSignInWithMicrosoftActive' => $faqConfig->isSignInWithMicrosoftActive(),
-    'msgSignInWithMicrosoft' => Translation::get('msgSignInWithMicrosoft'),
-    'secureUrl' => sprintf('https://%s%s', $request->getHost(), $request->getRequestUri()),
-    'msgNotSecure' => Translation::get('msgSecureSwitch'),
-    'isWebAuthnEnabled' => $faqConfig->get('security.enableWebAuthnSupport'),
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/media.browser.php
+++ b//dev/null
@@ -1,74 +0,0 @@
-<?php
-/**
- * Media browser backend for TinyMCE v6
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2015-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2015-10-18
- */
-use phpMyFAQ\Language;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\Config\FileLocator;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;
-define('PMF_ROOT_DIR', dirname(__DIR__));
-const IS_VALID_PHPMYFAQ = null;
-require PMF_ROOT_DIR . '/src/Bootstrap.php';
-$container = new ContainerBuilder();
-$loader = new PhpFileLoader($container, new FileLocator(__DIR__));
-try {
-    $loader->load('../src/services.php');
-} catch (\Exception $e) {
-    echo $e->getMessage();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = CurrentUser::getCurrentUser($faqConfig);
-$Language = $container->get('phpmyfaq.language');
-$faqLangCode = $Language->setLanguage($faqConfig->get('main.languageDetection'), $faqConfig->get('main.language'));
-$faqConfig->setLanguage($Language);
-if (!Language::isASupportedLanguage($faqLangCode)) {
-    $faqLangCode = 'en';
-}
-try {
-    Translation::create()
-        ->setLanguagesDir(PMF_TRANSLATION_DIR)
-        ->setDefaultLanguage('en')
-        ->setCurrentLanguage($faqLangCode)
-        ->setMultiByteLanguage();
-} catch (Exception $e) {
-    echo '<strong>Error:</strong> ' . $e->getMessage();
-}
-Strings::init($faqLangCode);
-$allowedExtensions = ['png', 'gif', 'jpg', 'jpeg', 'mov', 'mpg', 'mp4', 'ogg', 'wmv', 'avi', 'webm'];
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/content/media.browser.twig');
-$images = [];
-if (is_dir(PMF_CONTENT_DIR . '/user/images')) {
-    $files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator(PMF_CONTENT_DIR . '/user/images'));
-    foreach ($files as $file) {
-        if ($file->isDir() || !in_array(strtolower($file->getExtension()), $allowedExtensions)) {
-            continue;
-        }
-        $path = str_replace(dirname(__DIR__) . '/', '', (string)$file->getPath());
-        $images[] = $faqConfig->getDefaultUrl() . $path . '/' . $file->getFilename();
-    }
-}
-$templateVars = [
-    'metaLanguage' => Translation::get('metaLanguage'),
-    'notAuthenticated' => !$user->isLoggedIn(),
-    'msgNotAuthenticated' => Translation::get('err_NotAuth'),
-    'msgMediaSearch' => Translation::get('ad_media_name_search'),
-    'isImageDirectoryMissing' => !is_dir(PMF_CONTENT_DIR . '/user/images'),
-    'msgImageDirectoryMissing' => sprintf(Translation::get('ad_dir_missing'), '/images'),
-    'images' => $images,
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/news.php
+++ b//dev/null
@@ -1,121 +0,0 @@
-<?php
-/**
- * The main administration file for the news.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-23
- */
-use phpMyFAQ\Comments;
-use phpMyFAQ\Entity\CommentType;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\LanguageHelper;
-use phpMyFAQ\News;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\FormatDateTwigExtension;
-use phpMyFAQ\Template\Extensions\IsoDateTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$news = new News($faqConfig);
-$csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-$templateVars = [
-    'action' => $action,
-    'permissionAddNews' => $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_ADD),
-    'permissionEditNews' => $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_EDIT),
-    'permissionDeleteNews' => $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_DELETE),
-    'defaultUrl' => $faqConfig->getDefaultUrl(),
-    'enableWysiwyg' => $faqConfig->get('main.enableWysiwygEditor'),
-    'ad_news_add' => Translation::get('ad_news_add'),
-    'csrfToken_saveNews' => Token::getInstance()->getTokenString('save-news'),
-    'ad_news_author_name' => Translation::get('ad_news_author_name'),
-    'ad_news_set_active' => Translation::get('ad_news_set_active'),
-    'ad_news_link_url' => Translation::get('ad_news_link_url'),
-    'ad_news_link_title' => Translation::get('ad_news_link_title'),
-    'ad_news_link_target' => Translation::get('ad_news_link_target'),
-    'ad_news_link_window' => Translation::get('ad_news_link_window'),
-    'ad_news_link_faq' => Translation::get('ad_news_link_faq'),
-    'ad_news_link_parent' => Translation::get('ad_news_link_parent'),
-    'selectLanguage' => LanguageHelper::renderSelectLanguage($faqLangCode, false, [], 'langTo'),
-    'ad_news_expiration_window' => Translation::get('ad_news_expiration_window'),
-    'ad_news_from' => Translation::get('ad_news_from'),
-    'ad_news_to' => Translation::get('ad_news_to'),
-    'ad_entry_back' => Translation::get('ad_entry_back'),
-    'ad_menu_news_add' => Translation::get('ad_menu_news_add'),
-    'ad_news_headline' => Translation::get('ad_news_headline'),
-    'ad_news_date' => Translation::get('ad_news_date'),
-    'ad_news_update' => Translation::get('ad_news_update'),
-    'ad_news_delete' => Translation::get('ad_news_delete'),
-    'ad_news_nodata' => Translation::get('ad_news_nodata'),
-    'ad_news_edit' => Translation::get('ad_news_edit'),
-    'ad_news_header' => Translation::get('ad_news_header'),
-    'ad_news_text' => Translation::get('ad_news_text'),
-    'ad_news_allowComments' => Translation::get('ad_news_allowComments'),
-    'ad_entry_locale' => Translation::get('ad_entry_locale'),
-    'ad_entry_comment' => Translation::get('ad_entry_comment'),
-    'ad_entry_commentby' => Translation::get('ad_entry_commentby'),
-    'newsCommentDate' => Translation::get('newsCommentDate'),
-    'ad_news_insertfail' => Translation::get('ad_news_insertfail'),
-    'msgNews' => Translation::get('msgNews'),
-    'ad_news_data' => Translation::get('ad_news_data'),
-    'ad_news_del' => Translation::get('ad_news_del'),
-    'ad_news_nodelete' => Translation::get('ad_news_nodelete'),
-    'ad_news_yesdelete' => Translation::get('ad_news_yesdelete'),
-    'ad_news_delsuc' => Translation::get('ad_news_delsuc'),
-    'ad_news_updatesuc' => Translation::get('ad_news_updatesuc'),
-    'msgDeleteNews' => Translation::get('msgDeleteNews'),
-    'csrfToken_deleteNews' => Token::getInstance()->getTokenString('delete-news'),
-    'csrfToken_updateNews' => Token::getInstance()->getTokenString('update-news'),
-    'ad_entry_active' => Translation::get('ad_entry_active'),
-    'csrfToken_activateNews' => Token::getInstance()->getTokenString('activate-news')
-];
-if ('add-news' == $action && $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_ADD)) {
-    $templateVars = [
-        ...$templateVars,
-        'userEmail' => $user->getUserData('email'),
-        'userName' => $user->getUserData('display_name')
-    ];
-} elseif ('news' == $action && $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_EDIT)) {
-    $newsHeaders = $news->getHeader();
-    $templateVars = [
-        ...$templateVars,
-        'news' => $newsHeaders,
-    ];
-} elseif ('edit-news' == $action && $user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_EDIT)) {
-    $id = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-    $newsData = $news->get($id, true);
-    $newsId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-    $oComment = new Comments($faqConfig);
-    $comments = $oComment->getCommentsData($newsId, CommentType::NEWS);
-    $templateVars = [
-        ...$templateVars,
-        'newsData' => $newsData,
-        'newsDataContent' => (isset($newsData['content']) ? htmlspecialchars(
-            (string)$newsData['content'],
-            ENT_QUOTES
-        ) : ''),
-        'comments' => $comments,
-        'newsId' => $newsId,
-        'commentTypeNews' => CommentType::NEWS
-    ];
-} else {
-    require __DIR__ . '/no-permission.php';
-    exit();
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$twig->addExtension(new IsoDateTwigExtension());
-$twig->addExtension(new FormatDateTwigExtension());
-$template = $twig->loadTemplate('@admin/content/news.twig');
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/no-permission.php
+++ b//dev/null
@@ -1,25 +0,0 @@
-<?php
-/**
- * The error page if a user has no permission to view the requested resource.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-06-11
- */
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/no-permission.twig');
-echo $template->render(
-    [
-        'adminHeaderNoPermission' => Translation::get('ad_entryins_fail'),
-        'msgNoPermission' => Translation::get('err_NotAuth')
-    ]
-);

--- a/phpmyfaq/admin/open-questions.php
+++ b//dev/null
@@ -1,76 +0,0 @@
-<?php
-/**
- * Delete open questions.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package phpMyFAQ
- * @author Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link https://www.phpmyfaq.de
- * @since 2003-02-24
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Date;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Question;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\CategoryNameTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Twig\Extra\Intl\IntlExtension;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::QUESTION_DELETE->value)) {
-    $category = new Category($faqConfig, [], false);
-    $question = new Question($faqConfig);
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $date = new Date($faqConfig);
-    $questionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-    $csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-    if ($csrfToken && Token::getInstance()->verifyToken('toggle-question-visibility', $csrfToken)) {
-        $csrfChecked = true;
-    } else {
-        $csrfChecked = false;
-    }
-    $toggle = Filter::filterInput(INPUT_GET, 'is_visible', FILTER_SANITIZE_SPECIAL_CHARS);
-    if ($csrfChecked && $toggle === 'toggle') {
-        $isVisible = $question->getVisibility($questionId);
-        $question->setVisibility($questionId, ($isVisible == 'N' ? 'Y' : 'N'));
-    }
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addExtension(new IntlExtension());
-    $twig->addExtension(new CategoryNameTwigExtension());
-    $template = $twig->loadTemplate('@admin/content/open-questions.twig');
-    $openQuestions = $question->getAll();
-    $templateVars = [
-        'msgOpenQuestions' => Translation::get('msgOpenQuestions'),
-        'csrfTokenDeleteQuestion' => Token::getInstance()->getTokenString('delete-questions'),
-        'currentLocale' => $faqConfig->getLanguage()->getLanguage(),
-        'msgAuthor' => Translation::get('ad_entry_author'),
-        'msgQuestion' => Translation::get('ad_entry_theme'),
-        'msgVisibility' => Translation::get('ad_entry_visibility'),
-        'questions' => $openQuestions,
-        'yes' => Translation::get('ad_gen_yes'),
-        'no' => Translation::get('ad_gen_no'),
-        'enableCloseQuestion' => $faqConfig->get('records.enableCloseQuestion'),
-        'msg2answerFAQ' => Translation::get('msg2answerFAQ'),
-        'msgTakeQuestion' => Translation::get('ad_ques_take'),
-        'csrfTokenToggleVisibility' => Token::getInstance()->getTokenString('toggle-question-visibility'),
-        'msgDeleteAllOpenQuestions' => Translation::get('msgDelete'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/password.change.php
+++ b//dev/null
@@ -1,75 +0,0 @@
-<?php
-/**
- * Form to change the password of the current user.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-23
- */
-use phpMyFAQ\Auth;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/user/password.change.twig');
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::PASSWORD_CHANGE->value)) {
-    $save = Filter::filterInput(INPUT_POST, 'save', FILTER_SANITIZE_SPECIAL_CHARS);
-    $csrfToken = Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-    $successMessage = $errorMessage = '';
-    if (!is_null($save) && Token::getInstance()->verifyToken('password', $csrfToken)) {
-        $auth = new Auth($faqConfig);
-        $authSource = $auth->selectAuth($user->getAuthSource('name'));
-        $authSource->getEncryptionContainer($user->getAuthData('encType'));
-        $authSource->setReadOnly($user->getAuthData('readOnly'));
-        $oldPassword = Filter::filterInput(INPUT_POST, 'faqpassword_old', FILTER_SANITIZE_SPECIAL_CHARS);
-        $newPassword = Filter::filterInput(INPUT_POST, 'faqpassword', FILTER_SANITIZE_SPECIAL_CHARS);
-        $retypedPassword = Filter::filterInput(INPUT_POST, 'faqpassword_confirm', FILTER_SANITIZE_SPECIAL_CHARS);
-        if (strlen((string) $newPassword) <= 7 || strlen((string) $retypedPassword) <= 7) {
-            $errorMessage = Translation::get('ad_passwd_fail');
-        } else {
-            if (
-                ($authSource->checkCredentials(
-                    $user->getLogin(),
-                    $oldPassword
-                )) && ($newPassword == $retypedPassword)
-            ) {
-                if (!$user->changePassword($newPassword)) {
-                    $errorMessage = Translation::get('ad_passwd_fail');
-                }
-                $successMessage = Translation::get('ad_passwdsuc');
-            } else {
-                $errorMessage = Translation::get('ad_passwd_fail');
-            }
-        }
-    }
-    $templateVars = [
-        'adminHeaderPasswordChange' => Translation::get('ad_passwd_cop'),
-        'successMessage' => $successMessage,
-        'errorMessage' => $errorMessage,
-        'csrfToken' => Token::getInstance()->getTokenString('password'),
-        'adminMsgOldPassword' => Translation::get('ad_passwd_old'),
-        'adminMsgNewPassword' => Translation::get('ad_passwd_new'),
-        'adminMsgNewPasswordConfirm' => Translation::get('ad_passwd_con'),
-        'adminMsgButtonNewPassword' => Translation::get('ad_passwd_change')
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a//dev/null
+++ b/phpmyfaq/admin/record.edit.php
@@ -0,0 +1,854 @@
+<?php
+/**
+ * The FAQ record editor.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2003-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2003-02-23
+ */
+use phpMyFAQ\Attachment\AttachmentFactory;
+use phpMyFAQ\Category;
+use phpMyFAQ\Category\CategoryRelation;
+use phpMyFAQ\Changelog;
+use phpMyFAQ\Configuration;
+use phpMyFAQ\Database;
+use phpMyFAQ\Date;
+use phpMyFAQ\Faq;
+use phpMyFAQ\Faq\FaqPermission;
+use phpMyFAQ\Filter;
+use phpMyFAQ\Helper\CategoryHelper;
+use phpMyFAQ\Helper\LanguageHelper;
+use phpMyFAQ\Helper\UserHelper;
+use phpMyFAQ\Link;
+use phpMyFAQ\AdminLog;
+use phpMyFAQ\Question;
+use phpMyFAQ\Revision;
+use phpMyFAQ\Session\Token;
+use phpMyFAQ\Strings;
+use phpMyFAQ\Tags;
+use phpMyFAQ\Translation;
+use phpMyFAQ\User;
+use phpMyFAQ\User\CurrentUser;
+use phpMyFAQ\Utils;
+if (!defined('IS_VALID_PHPMYFAQ')) {
+    http_response_code(400);
+    exit();
+}
+$faqConfig = Configuration::getConfigurationInstance();
+$currentUserId = CurrentUser::getCurrentUser($faqConfig)->getUserId();
+if (
+    ($user->perm->hasPermission($currentUserId, 'edit_faq') ||
+     $user->perm->hasPermission($currentUserId, 'add_faq')) && !Database::checkOnEmptyTable('faqcategories')
+) {
+    $category = new Category($faqConfig, [], false);
+    if ($faqConfig->get('main.enableCategoryRestrictions')) {
+        $category = new Category($faqConfig, $currentAdminGroups, true);
+    }
+    $category->setUser($currentAdminUser);
+    $category->setGroups($currentAdminGroups);
+    $category->buildCategoryTree();
+    $categoryRelation = new CategoryRelation($faqConfig, $category);
+    $categoryHelper = new CategoryHelper();
+    $categoryHelper->setCategory($category);
+    $faq = new Faq($faqConfig);
+    $faqPermission = new FaqPermission($faqConfig);
+    $questionObject = new Question($faqConfig);
+    $changelog = new Changelog($faqConfig);
+    $userHelper = new UserHelper($user);
+    $selectedCategory = '';
+    $categories = [];
+    $faqData = [
+        'id' => 0,
+        'lang' => $faqLangCode,
+        'revision_id' => 0,
+        'title' => '',
+        'dateStart' => '',
+        'dateEnd' => '',
+    ];
+    $tagging = new Tags($faqConfig);
+    $date = new Date($faqConfig);
+    if ('takequestion' === $action) {
+        $questionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
+        $question = $questionObject->getQuestion($questionId);
+        $selectedCategory = $question['category_id'];
+        $faqData['title'] = $question['question'];
+        $notifyUser = $question['username'];
+        $notifyEmail = $question['email'];
+        $categories = [
+            'category_id' => $selectedCategory,
+            'category_lang' => $faqData['lang'],
+        ];
+    } else {
+        $questionId = 0;
+        $notifyUser = '';
+        $notifyEmail = '';
+    }
+    if ('editpreview' === $action) {
+        $faqData['id'] = Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);
+        if (!is_null($faqData['id'])) {
+            $queryString = 'saveentry&id=' . $faqData['id'];
+        } else {
+            $queryString = 'insertentry';
+        }
+        $faqData['lang'] = Filter::filterInput(INPUT_POST, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
+        $selectedCategory = Filter::filterInputArray(
+            INPUT_POST,
+            [
+                'rubrik' => [
+                    'filter' => FILTER_VALIDATE_INT,
+                    'flags' => FILTER_REQUIRE_ARRAY,
+                ],
+            ]
+        );
+        if (is_array($selectedCategory)) {
+            foreach ($selectedCategory as $cats) {
+                $categories[] = ['category_id' => $cats, 'category_lang' => $faqData['lang']];
+            }
+        }
+        $faqData['active'] = Filter::filterInput(INPUT_POST, 'active', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['keywords'] = Filter::filterInput(INPUT_POST, 'keywords', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['title'] = Filter::filterInput(INPUT_POST, 'thema', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['content'] = Filter::filterInput(INPUT_POST, 'content', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['author'] = Filter::filterInput(INPUT_POST, 'author', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['email'] = Filter::filterInput(INPUT_POST, 'email', FILTER_VALIDATE_EMAIL);
+        $faqData['comment'] = Filter::filterInput(INPUT_POST, 'comment', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['solution_id'] = Filter::filterInput(INPUT_POST, 'solution_id', FILTER_VALIDATE_INT);
+        $faqData['revision_id'] = Filter::filterInput(INPUT_POST, 'revision_id', FILTER_VALIDATE_INT, 0);
+        $faqData['sticky'] = Filter::filterInput(INPUT_POST, 'sticky', FILTER_VALIDATE_INT);
+        $faqData['tags'] = Filter::filterInput(INPUT_POST, 'tags', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['changed'] = Filter::filterInput(INPUT_POST, 'changed', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['dateStart'] = Filter::filterInput(INPUT_POST, 'dateStart', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['dateEnd'] = Filter::filterInput(INPUT_POST, 'dateEnd', FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqData['content'] = html_entity_decode((string) $faqData['content']);
+    } elseif ('editentry' === $action) {
+        $id = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
+        $lang = Filter::filterInput(INPUT_GET, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
+        $translateTo = Filter::filterInput(INPUT_GET, 'translateTo', FILTER_SANITIZE_SPECIAL_CHARS);
+        $categoryId = Filter::filterInput(INPUT_GET, 'cat', FILTER_VALIDATE_INT);
+        if (!is_null($translateTo)) {
+            $faqData['lang'] = $lang = $translateTo;
+            $selectedCategory = $categoryId;
+        }
+        if ((!isset($selectedCategory) && !isset($faqData['title'])) || !is_null($id)) {
+            $logging = new AdminLog($faqConfig);
+            $logging->log($user, 'admin-edit-faq ' . $id);
+            $categories = $categoryRelation->getCategories($id, $lang);
+            if (count($categories) === 0) {
+                $categories = [
+                    'category_id' => $selectedCategory,
+                    'category_lang' => $faqData['lang'],
+                ];
+            }
+            $faq->getRecord($id, null, true);
+            $faqData = $faq->faqRecord;
+            if (!is_null($translateTo)) {
+                $faqData['lang'] = $translateTo; // once again
+            }
+            $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
+            $queryString = 'saveentry&amp;id=' . $faqData['id'];
+        } else {
+            $queryString = 'insertentry';
+            if (isset($categoryId)) {
+                $categories = ['category_id' => $categoryId, 'category_lang' => $lang];
+            }
+        }
+    } elseif ('copyentry' === $action) {
+        $faqData['id'] = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
+        $faqData['lang'] = Filter::filterInput(INPUT_GET, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
+        $categories = $categoryRelation->getCategories($faqData['id'], $faqData['lang']);
+        $faq->getRecord($faqData['id'], null, true);
+        $faqData = $faq->faqRecord;
+        $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
+        $queryString = 'insertentry';
+    } else {
+        $logging = new AdminLog($faqConfig);
+        $logging->log($user, 'admin-add-faq');
+        $queryString = 'insertentry';
+        if (!is_array($categories)) {
+            $categories = [];
+        }
+    }
+    $selectedRevisionId = Filter::filterInput(INPUT_POST, 'revisionid_selected', FILTER_VALIDATE_INT);
+    if (is_null($selectedRevisionId)) {
+        $selectedRevisionId = $faqData['revision_id'];
+    }
+    $userPermission = $faqPermission->get(FaqPermission::USER, $faqData['id']);
+    if (count($userPermission) == 0 || $userPermission[0] == -1) {
+        $allUsers = true;
+        $restrictedUsers = false;
+        $userPermission[0] = -1;
+    } else {
+        $allUsers = false;
+        $restrictedUsers = true;
+    }
+    $groupPermission = $faqPermission->get(FaqPermission::GROUP, $faqData['id']);
+    if (empty($groupPermission) || in_array(-1, $groupPermission, true)) {
+        $allGroups = true;
+        $restrictedGroups = false;
+        $groupPermission[0] = -1;
+    } else {
+        $allGroups = false;
+        $restrictedGroups = true;
+    }
+    $faqData['title'] = (isset($faqData['title']) ? Strings::htmlentities($faqData['title'], ENT_HTML5 | ENT_COMPAT) : '');
+    $faqData['content'] =
+        (isset($faqData['content']) ? trim(Strings::htmlentities($faqData['content'], ENT_COMPAT, 'utf-8', true)) : '');
+    $faqData['tags'] = (isset($faqData['tags']) ? Strings::htmlentities($faqData['tags']) : '');
+    $faqData['keywords'] = (isset($faqData['keywords']) ? Strings::htmlentities($faqData['keywords']) : '');
+    $faqData['author'] = (isset($faqData['author']) ? Strings::htmlentities(
+        $faqData['author']
+    ) : $user->getUserData('display_name'));
+    $faqData['email'] = (isset($faqData['email']) ? Strings::htmlentities($faqData['email']) : $user->getUserData(
+        'email'
+    ));
+    $faqData['isoDate'] = ($faqData['date'] ?? date('Y-m-d H:i'));
+    $faqData['date'] = (isset($faqData['date']) ? $date->format($faqData['date']) : $date->format(date('Y-m-d H:i')));
+    $faqData['changed'] ??= '';
+    if (isset($faqData['comment']) && $faqData['comment'] == 'y') {
+        $faqData['comment'] = ' checked';
+    } elseif ($faqConfig->get('records.defaultAllowComments')) {
+        $faqData['comment'] = ' checked';
+    } else {
+        $faqData['comment'] = '';
+    }
+    if (0 !== $faqData['id'] && 'copyentry' !== $action) {
+        $currentRevision = sprintf('%s 1.%d', Translation::get('ad_entry_revision'), $selectedRevisionId);
+        $faqUrl = sprintf(
+            '%sindex.php?action=faq&cat=%s&id=%d&artlang=%s',
+            $faqConfig->getDefaultUrl(),
+            $category->getCategoryIdFromFaq($faqData['id']),
+            $faqData['id'],
+            $faqData['lang']
+        );
+        $link = new Link($faqUrl, $faqConfig);
+        $link->itemTitle = $faqData['title'];
+        ?>
+        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
+            <h1 class="h2">
+                <i aria-hidden="true" class="fa fa-edit"></i>
+                <?= Translation::get('ad_entry_edit_1') ?>
+                <?= Translation::get('ad_entry_edit_2') ?>
+            </h1>
+            <div class="btn-toolbar mb-2 mb-md-0">
+                <div class="btn-group mr-2">
+              <span class="btn btn-sm btn-info">
+                <i class="fa fa-hashtag" aria-hidden="true"></i>
+                <?= $currentRevision ?>
+              </span>
+                    <a href="<?= $link->toString() ?>" class="btn btn-sm btn-success">
+                        <i class="fa fa-arrow-alt-circle-right" aria-hidden="true"></i>
+                        <?= Translation::get('ad_view_faq') ?>
+                    </a>
+                </div>
+            </div>
+        </div>
+    <?php } else { ?>
+        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
+            <h1 class="h2">
+                <i aria-hidden="true" class="fa fa-edit"></i>
+                <?= Translation::get('ad_entry_add') ?>
+            </h1>
+        </div>
+    <?php } ?>
+        <div class="row">
+            <div class="col-lg-9">
+                <div class="card mb-4">
+                    <div class="card-header">
+                        <ul class="nav nav-tabs card-header-tabs" id="nav-tab" role="tablist">
+                            <li class="nav-item">
+                                <a class="nav-link active" data-bs-toggle="tab" href="#tab-question-answer" role="tab">
+                                    <i class="fa fa-pencil-square-o"></i> <?= Translation::get('ad_record_faq') ?>
+                                </a>
+                            </li>
+                            <li class="nav-item">
+                                <a class="nav-link" data-bs-toggle="tab" href="#tab-meta-data" role="tab">
+                                    <i class="fa fa-database"></i> <?= Translation::get('ad_menu_faq_meta') ?>
+                                </a>
+                            </li>
+                            <li class="nav-item">
+                                <a class="nav-link" data-bs-toggle="tab" href="#tab-permissions" role="tab">
+                                    <i class="fa fa-unlock-alt"></i> <?= Translation::get('ad_record_permissions') ?>
+                                </a>
+                            </li>
+                            <li class="nav-item">
+                                <a class="nav-link" data-bs-toggle="tab" href="#tab-notes-changelog" role="tab">
+                                    <i class="fa fa-sticky-note-o"></i>
+                                    <?= Translation::get('ad_admin_notes') . ' / ' . Translation::get('ad_entry_changelog') ?>
+                                </a>
+                            </li>
+                        </ul>
+                    </div>
+                    <div class="card-body">
+                        <div class="tab-content">
+                            <div class="tab-pane active" id="tab-question-answer">
+                                <!-- Revision -->
+                                <?php
+                                if ($user->perm->hasPermission($currentUserId, 'changebtrevs') && $action === 'editentry') {
+                                    $faqRevision = new Revision($faqConfig);
+                                    $revisions = $faqRevision->get($faqData['id'], $faqData['lang'], $faqData['author']);
+                                    if (count($revisions)) { ?>
+                                        <div class="form-group mb-2">
+                                            <form id="selectRevision" name="selectRevision" method="post"
+                                                  action="?action=editentry&amp;id=<?= $faqData['id'] ?>&amp;lang=<?= $faqData['lang'] ?>">
+                                                <select name="revisionid_selected" onchange="this.form.submit();"
+                                                        class="form-select">
+                                                    <option value="<?= $faqData['revision_id'] ?>">
+                                                        <?= Translation::get('ad_changerev') ?>
+                                                    </option>
+                                                    <?php foreach ($revisions as $revisionData) { ?>
+                                                        <option value="<?= $revisionData['revision_id'] ?>" <?php if ($selectedRevisionId == $revisionData['revision_id']) {
+                                                            echo 'selected';
+                                                                       }
+                                                                        ?>>
+                                                            <?php printf(
+                                                                '%s 1.%d: %s - %s',
+                                                                Translation::get('ad_entry_revision'),
+                                                                $revisionData['revision_id'],
+                                                                Date::createIsoDate($revisionData['updated']),
+                                                                $revisionData['author']
+                                                            );
+                                                            ?>
+                                                        </option>
+                                                        <?php
+                                                    }
+                                                    ?>
+                                                </select>
+                                            </form>
+                                        </div>
+                                    <?php }
+                                    if (
+                                        isset($selectedRevisionId) &&
+                                        isset($faqData['revision_id']) &&
+                                        $selectedRevisionId !== $faqData['revision_id']
+                                    ) {
+                                        $faq->language = $faqData['lang'];
+                                        $faq->getRecord($faqData['id'], $selectedRevisionId, true);
+                                        $faqData = $faq->faqRecord;
+                                        $faqData['tags'] = implode(', ', $tagging->getAllTagsById($faqData['id']));
+                                        $faqData['revision_id'] = $selectedRevisionId;
+                                    }
+                                }
+                                ?>
+                              <form id="faqEditor" action="?action=<?= $queryString ?>" method="post"
+                                    data-pmf-enable-editor="<?= $faqConfig->get('main.enableWysiwygEditor') ?>"
+                                    data-pmf-editor-language="en"
+                                    data-pmf-default-url="<?= $faqConfig->getDefaultUrl() ?>">
+                                <input type="hidden" name="revision_id" id="revision_id" value="<?= $faqData['revision_id'] ?>">
+                                <input type="hidden" name="record_id" id="record_id" value="<?= $faqData['id'] ?>">
+                                <input type="hidden" name="openQuestionId" id="openQuestionId" value="<?= $questionId ?>">
+                                  <input type="hidden" name="notifyUser" id="notifyUser"
+                                         value="<?= Strings::htmlentities($notifyUser) ?>">
+                                  <input type="hidden" name="notifyEmail" id="notifyEmail"
+                                         value="<?= Strings::htmlentities($notifyEmail) ?>">
+                                <?= Token::getInstance()->getTokenInput('edit-faq') ?>
+                                <!-- Question -->
+                                <div class="form-group mb-2">
+                                    <input type="text" name="question" id="question"
+                                           class="form-control form-control-lg"
+                                           placeholder="<?= Translation::get('ad_entry_theme') ?>"
+                                           value="<?= $faqData['title'] ?>">
+                                </div>
+                                <!-- Answer -->
+                                <?php if ($faqConfig->get('main.enableWysiwygEditor')): ?>
+                                    <div class="row">
+                                        <div class="col-lg-12">
+                                            <noscript>Please enable JavaScript to use the WYSIWYG editor!</noscript>
+                                            <textarea id="editor" name="answer" class="form-control" rows="7"
+                                                      placeholder="<?= Translation::get('ad_entry_content') ?>"
+                                            ><?= $faqData['content'] ?></textarea>
+                                        </div>
+                                    </div>
+                                <?php endif; ?>
+                                <?php if ($faqConfig->get('main.enableMarkdownEditor')) : ?>
+                                    <div class="row">
+                                      <div class="col-lg-12">
+                                        <ul class="nav nav-tabs mb-2" id="markdown-tabs">
+                                          <li class="nav-item">
+                                            <a class="nav-link active" data-bs-toggle="tab" href="#text">Text</a>
+                                          </li>
+                                          <li class="nav-item">
+                                            <a class="nav-link" data-bs-toggle="tab" href="#preview" data-markdown-tab="preview">Preview</a>
+                                          </li>
+                                        </ul>
+                                        <div class="tab-content">
+                                          <div class="tab-pane active" id="text">
+                                            <div class="row">
+                                              <div class="col-lg-12">
+                                                <textarea id="answer-markdown" name="answer" class="form-control"
+                                                          rows="7" placeholder="<?= Translation::get('ad_entry_content') ?>"
+                                                ><?= $faqData['content'] ?></textarea>
+                                              </div>
+                                            </div>
+                                          </div>
+                                          <div class="tab-pane" id="preview">
+                                            <article id="markdown-preview"></article>
+                                          </div>
+                                        </div>
+                                      </div>
+                                    </div>
+                                <?php endif; ?>
+                            </div>
+                            <div class="tab-pane" id="tab-meta-data">
+                                <!-- Categories -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="phpmyfaq-categories">
+                                        <?= Translation::get('ad_entry_category') ?>
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <select name="rubrik[]" id="phpmyfaq-categories" size="5" multiple
+                                                class="form-control">
+                                            <?= $categoryHelper->renderOptions($categories) ?>
+                                        </select>
+                                    </div>
+                                </div>
+                                <!-- Language -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="lang">
+                                        <?= Translation::get('ad_entry_locale') ?>:
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <?= LanguageHelper::renderSelectLanguage($faqData['lang'], false, [], 'lang') ?>
+                                    </div>
+                                </div>
+                                <!-- Attachments -->
+                                <?php if ($user->perm->hasPermission($currentUserId, 'addattachment')) : ?>
+                                    <div class="row mb-2">
+                                        <label class="col-lg-2 col-form-label">
+                                            <?= Translation::get('ad_menu_attachments') ?>:
+                                        </label>
+                                        <div class="col-lg-10">
+                                            <ul class="list-unstyled adminAttachments">
+                                                <?php
+                                                $attList = AttachmentFactory::fetchByRecordId(
+                                                    $faqConfig,
+                                                    $faqData['id']
+                                                );
+                                                foreach ($attList as $att) {
+                                                    printf(
+                                                        '<li><a href="../%s">%s</a> ',
+                                                        $att->buildUrl(),
+                                                        Strings::htmlentities($att->getFilename())
+                                                    );
+                                                    if ($user->perm->hasPermission($currentUserId, 'delattachment')) {
+                                                        printf(
+                                                            '<a class="badge bg-danger" href="?action=delatt&amp;record_id=%d&amp;id=%d&amp;lang=%s"><i aria-hidden="true" class="fa fa-trash"></i></a>',
+                                                            $faqData['id'],
+                                                            $att->getId(),
+                                                            $faqData['lang']
+                                                        );
+                                                    }
+                                                    echo "</li>\n";
+                                                }
+                                                ?>
+                                            </ul>
+                                            <?php
+                                            printf(
+                                                '<button type="button" class="btn btn-primary mt-2" data-bs-toggle="modal" data-bs-target="#attachmentModal">%s</button>',
+                                                Translation::get('ad_att_add')
+                                            );
+                                            ?>
+                                        </div>
+                                    </div>
+                                <?php endif; ?>
+                                <!-- Tags -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="tags">
+                                        <?= Translation::get('ad_entry_tags') ?>:
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <input type="text" name="tags" id="tags" value="<?= $faqData['tags'] ?>"
+                                               autocomplete="off"
+                                               class="form-control pmf-tags-autocomplete">
+                                        <small id="tagsHelp"
+                                               class="form-text visually-hidden"><?= Translation::get('msgShowHelp') ?></small>
+                                    </div>
+                                </div>
+                                <!-- Keywords -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="keywords">
+                                        <?= Translation::get('ad_entry_keywords') ?>:
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <input type="text" name="keywords" id="keywords" maxlength="255"
+                                               class="form-control" autocomplete="off"
+                                               value="<?= $faqData['keywords'] ?>">
+                                        <small id="keywordsHelp"
+                                               class="form-text visually-hidden"><?= Translation::get('msgShowHelp') ?></small>
+                                    </div>
+                                </div>
+                                <!-- Author -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="author">
+                                        <?= Translation::get('ad_entry_author') ?>
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <input type="text" name="author" id="author" value="<?= $faqData['author'] ?>"
+                                               class="form-control">
+                                    </div>
+                                </div>
+                                <!-- E-Mail -->
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="email">
+                                        <?= Translation::get('ad_entry_email') ?>
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <input type="email" name="email" id="email" value="<?= $faqData['email'] ?>"
+                                               class="form-control">
+                                    </div>
+                                </div>
+                            </div>
+                            <div class="tab-pane" id="tab-permissions">
+                                <!-- Permissions -->
+                                <?php if ($faqConfig->get('security.permLevel') !== 'basic') : ?>
+                                    <fieldset class="form-group">
+                                        <div class="row">
+                                            <legend class="col-lg-2 col-form-label pt-0">
+                                              <?= Translation::get('ad_entry_grouppermission') ?>
+                                            </legend>
+                                            <div class="col-lg-10">
+                                              <div class="form-check">
+                                                <input type="radio" id="allgroups" name="grouppermission"
+                                                       value="all" class="form-check-input"
+                                                  <?php echo($allGroups ? 'checked' : ''); ?>>
+                                                <label class="form-check-label" for="allgroups">
+                                                  <?= Translation::get('ad_entry_all_groups') ?>
+                                                </label>
+                                              </div>
+                                              <div class="form-check">
+                                                <input type="radio" id="restrictedgroups" name="grouppermission"
+                                                       class="form-check-input"
+                                                       value="restricted" <?php echo($restrictedGroups ? 'checked' : ''); ?>>
+                                                <label for="selected-groups" class="form-check-label"
+                                                       for="restrictedgroups">
+                                                  <?= Translation::get('ad_entry_restricted_groups') ?>
+                                                </label>
+                                                <select id="selected-groups" name="restricted_groups[]" size="3"
+                                                        class="form-control" multiple>
+                                                    <?= $user->perm->getAllGroupsOptions($groupPermission, $user) ?>
+                                                </select>
+                                              </div>
+                                            </div>
+                                        </div>
+                                    </fieldset>
+                                <?php else : ?>
+                                    <input type="hidden" name="grouppermission" value="all">
+                                <?php endif; ?>
+                                <fieldset class="form-group">
+                                    <div class="row">
+                                        <legend class="col-lg-2 col-form-label pt-0">
+                                            <?= Translation::get('ad_entry_userpermission') ?>
+                                        </legend>
+                                        <div class="col-lg-10">
+                                            <div class="form-check">
+                                                <input type="radio" id="allusers" name="userpermission" value="all"
+                                                       class="form-check-input"
+                                                       <?= $allUsers ? 'checked' : '' ?>>
+                                                <label class="form-check-label" for="allusers">
+                                                    <?= Translation::get('ad_entry_all_users') ?>
+                                                </label>
+                                            </div>
+                                            <div class="form-check">
+                                                <input type="radio" id="restrictedusers" name="userpermission"
+                                                       class="form-check-input"
+                                                       value="restricted" <?= $restrictedUsers ? 'checked' : '' ?>>
+                                                <label class="form-check-label" for="restrictedusers">
+                                                    <?= Translation::get('ad_entry_restricted_users') ?>
+                                                </label>
+                                                <select name="restricted_users" id="selected-user" class="form-select">
+                                                    <?= $userHelper->getAllUserOptions($userPermission[0], false) ?>
+                                                </select>
+                                            </div>
+                                        </div>
+                                    </div>
+                                </fieldset>
+                            </div>
+                            <div class="tab-pane" id="tab-notes-changelog">
+                                <h6 class="card-title sr-only">
+                                    <?= Translation::get('ad_entry_changelog') ?>
+                                </h6>
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="changelog-date">
+                                        <?= Translation::get('ad_entry_date') ?>
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <input type="text" readonly class="form-control-plaintext" id="changelog-date"
+                                               value="<?= $faqData['date'] ?>">
+                                    </div>
+                                </div>
+                                <div class="row mb-2">
+                                    <label class="col-lg-2 col-form-label" for="changed">
+                                        <?= Translation::get('ad_entry_changed') ?>
+                                    </label>
+                                    <div class="col-lg-10">
+                                        <textarea name="changed" id="changed" rows="3" class="form-control"
+                                        ><?= $faqData['changed'] ?></textarea>
+                                    </div>
+                                </div>
+                                <h6 class="card-title">
+                                    <label for="notes">
+                                        <?php printf(Translation::get('ad_admin_notes_hint'), Translation::get('ad_admin_notes')) ?>
+                                    </label>
+                                </h6>
+                                <div class="row mb-2">
+                                    <div class="col-lg-10 offset-lg-2">
+                                        <textarea id="notes" name="notes" class="form-control" rows="3"
+                                        ><?= $faqData['notes'] ?? '' ?></textarea>
+                                    </div>
+                                </div>
+                                <div class="row mb-2">
+                                    <div class="col-lg-2">
+                                        <h6 class="card-title">
+                                            <?= Translation::get('ad_entry_changelog_history') ?>
+                                        </h6>
+                                    </div>
+                                    <div class="col-lg-10">
+                                        <ul>
+                                            <?php foreach ($changelog->getByFaqId($faqData['id']) as $entry) {
+                                                $entryUser = new User($faqConfig);
+                                                $entryUser->getUserById($entry['user']);
+                                                ?>
+                                                <li class="small pt-0">
+                                                    <?php printf(
+                                                        '<i class="fa fa-hand-o-right"></i> %s  1.%d <i class="fa fa-calendar"></i> %s <i class="fa fa-user"></i> %s',
+                                                        Translation::get('ad_entry_revision'),
+                                                        $entry['revision_id'],
+                                                        $date->format(date('Y-m-d H:i', $entry['date'])),
+                                                        $entryUser->getUserData('display_name')
+                                                    );
+                                                    ?>
+                                                    <br>
+                                                    <?= Strings::htmlentities($entry['changelog'] ?? '') ?>
+                                                </li>
+                                            <?php } ?>
+                                        </ul>
+                                    </div>
+                                </div>
+                            </div>
+                        </div>
+                    </div>
+                </div>
+            </div>
+            <!-- Sidebar -->
+            <div class="col-lg-3">
+                <div id="accordion" role="tablist">
+                    <div class="card mb-4">
+                        <div class="card-header text-center" role="tab" id="pmf-heading-date">
+                            <?php if ($selectedRevisionId === $faqData['revision_id']) : ?>
+                                <button class="btn btn-lg btn-info" type="reset">
+                                    <?= Translation::get('ad_gen_reset') ?>
+                                </button>
+                                <button class="btn btn-lg btn-primary" type="submit">
+                                    <?= Translation::get('ad_entry_save') ?>
+                                </button>
+                            <?php endif ?>
+                        </div>
+                        <div class="card-body">
+                            <h5 class="mb-0">
+                                <?= Translation::get('ad_entry_date') ?>
+                            </h5>
+                            <div class="form-group">
+                                <div class="form-check">
+                                    <input type="radio" id="updateDate" checked name="recordDateHandling"
+                                           class="form-check-input" value="updateDate"
+                                           onchange="setRecordDate(this.id);">
+                                    <label class="form-check-label" for="updateDate">
+                                        <?= Translation::get('msgUpdateFaqDate') ?>
+                                    </label>
+                                </div>
+                                <div class="form-check">
+                                    <input type="radio" id="keepDate" name="recordDateHandling" class="form-check-input"
+                                           onchange="setRecordDate(this.id);" value="keepDate">
+                                    <label class="form-check-label" for="keepDate">
+                                        <?= Translation::get('msgKeepFaqDate') ?>
+                                    </label>
+                                </div>
+                                <div class="form-check">
+                                    <input type="radio" id="manualDate" name="recordDateHandling"
+                                           class="form-check-input" value="manualDate"
+                                           onchange="setRecordDate(this.id);">
+                                    <label class="form-check-label" for="manualDate">
+                                        <?= Translation::get('msgEditFaqDat') ?>
+                                    </label>
+                                </div>
+                                <div id="recordDateInputContainer" class="invisible mb-2">
+                                    <input type="datetime-local" name="date" id="date" class="form-control"
+                                           placeholder="<?= $faqData['date'] ?>">
+                                </div>
+                            </div>
+                            <h5 class="mb-0">
+                                <?= Translation::get('ad_entry_status') ?>
+                            </h5>
+                            <div class="form-group">
+                                <!-- active or not -->
+                                <?php if ($user->perm->hasPermission($currentUserId, 'approverec')) :
+                                    if (isset($faqData['active']) && $faqData['active'] === 'yes') {
+                                        $isActive = ' checked';
+                                        $isInActive = null;
+                                    } else {
+                                        $isActive = null;
+                                        $isInActive = ' checked';
+                                    }
+                                    if ($faqConfig->get('records.defaultActivation') && $queryString === 'insertentry') {
+                                        $isActive = ' checked';
+                                        $isInActive = null;
+                                    }
+                                    ?>
+                                    <div class="form-check">
+                                        <input type="radio" id="active" name="active" value="yes"
+                                               class="form-check-input"
+                                            <?php if (isset($isActive)) {
+                                                echo $isActive;
+                                            } ?>>
+                                        <label class="form-check-label" for="active">
+                                            <?= Translation::get('ad_entry_visibility') ?>
+                                        </label>
+                                    </div>
+                                    <div class="form-check">
+                                        <input type="radio" id="inactive" name="active" value="no"
+                                               class="form-check-input"
+                                            <?php if (isset($isInActive)) {
+                                                echo $isInActive;
+                                            } ?>>
+                                        <label class="form-check-label" for="inactive">
+                                          <?= Translation::get('ad_entry_not_visibility') ?>
+                                        </label>
+                                    </div>
+                                <?php else : ?>
+                                    <div class="form-check">
+                                        <input type="radio" id="inactive" name="active" value="no"
+                                               class="form-check-input" checked>
+                                        <label class="form-check-label" for="inactive">
+                                            <?= Translation::get('ad_entry_not_visibility') ?>
+                                        </label>
+                                    </div>
+                                <?php endif; ?>
+                            </div>
+                            <?php if ($queryString != 'insertentry' && !$faqConfig->get('records.enableAutoRevisions')) : ?>
+                              <h5 class="mb-0">
+                                  <?= Translation::get('ad_entry_new_revision') ?>
+                              </h5>
+                              <div class="form-group">
+                                <div class="form-check">
+                                  <input type="radio" name="revision" id="revision" value="yes"
+                                         class="form-check-input">
+                                  <label class="form-check-label"
+                                         for="revision"><?= Translation::get('ad_gen_yes') ?></label>
+                                </div>
+                                <div class="form-check">
+                                  <input type="radio" name="revision" id="no-revision" value="no"
+                                         checked class="form-check-input">
+                                  <label class="form-check-label"
+                                         for="no-revision"><?= Translation::get('ad_gen_no') ?></label>
+                                </div>
+                              </div>
+                            <?php endif ?>
+                            <div class="form-group">
+                                <!-- sticky or not -->
+                                <div class="form-check">
+                                    <input type="checkbox" id="sticky" name="sticky" class="form-check-input"
+                                        <?php echo(isset($faqData['sticky']) && $faqData['sticky'] ? 'checked' : '') ?>>
+                                    <label class="form-check-label"
+                                           for="sticky"><?= Translation::get('ad_entry_sticky') ?></label>
+                                </div>
+                                <!-- comments allowed or not -->
+                                <div class="form-check">
+                                    <input type="checkbox" name="comment" id="comment" value="y"
+                                           class="form-check-input"
+                                           <?= $faqData['comment'] ?>>
+                                    <label class="form-check-label"
+                                           for="comment"><?= Translation::get('ad_entry_allowComments') ?></label>
+                                </div>
+                            </div>
+                            <div class="form-group">
+                                <!-- solution id -->
+                                <label class="col-form-label" for="solution_id">
+                                    <?= Translation::get('ad_entry_solution_id') ?>:
+                                </label>
+                                <input type="number" name="solution_id" id="solution_id" size="5" class="form-control"
+                                       readonly
+                                       value="<?= $faqData['solution_id'] ?? $faq->getNextSolutionId() ?>">
+                            </div>
+                        </div>
+                    </div>
+                </div>
+            </div>
+        </div>
+    </form>
+    <!-- Attachment Upload Dialog -->
+    <?php
+    if (0 === $faqData['id']) {
+        $faqData['id'] = $faqConfig->getDb()->nextId(
+            Database::getTablePrefix() . 'faqdata',
+            'id'
+        );
+    }
+    ?>
+  <div class="modal fade" id="attachmentModal" tabindex="-1" role="dialog" aria-labelledby="attachmentModalLabel"
+       aria-hidden="true">
+    <div class="modal-dialog" role="document">
+      <div class="modal-content">
+        <div class="modal-header">
+          <h5 class="modal-title" id="attachmentModalLabel">
+              <?= Translation::get('ad_att_addto') . ' ' . Translation::get('ad_att_addto_2') ?>
+            (max <?= Utils::formatBytes($faqConfig->get('records.maxAttachmentSize')) ?>)
+          </h5>
+            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
+        </div>
+        <div class="modal-body">
+          <form action="api/attachment.php?action=upload" enctype="multipart/form-data" method="post"
+                id="attachmentForm" novalidate>
+            <fieldset>
+              <input type="hidden" name="MAX_FILE_SIZE" value="<?= $faqConfig->get('records.maxAttachmentSize') ?>">
+              <input type="hidden" name="record_id" id="attachment_record_id" value="<?= $faqData['id'] ?>">
+              <input type="hidden" name="record_lang" id="attachment_record_lang" value="<?= $faqData['lang'] ?>">
+              <input type="hidden" name="save" value="true">
+              <?= Token::getInstance()->getTokenInput('upload-attachment') ?>
+              <div class="mb-2">
+                <label class="form-label" for="filesToUpload">
+                  <?= Translation::get('ad_att_att') ?>
+                </label>
+                <input type="file" class="form-control" name="filesToUpload[]" id="filesToUpload" multiple>
+                <div class="invalid-feedback">
+                  The file is too big.
+                </div>
+              </div>
+              <div class="pmf-attachment-upload-files invisible mb-2">
+                <?= Translation::get('msgAttachmentsFilesize') ?>:
+                <output id="filesize"></output>
+              </div>
+            </fieldset>
+          </form>
+        </div>
+        <div class="modal-footer">
+          <button type="button" class="btn btn-primary" id="pmf-attachment-modal-upload">
+              <?= Translation::get('ad_att_butt') ?>
+          </button>
+        </div>
+      </div>
+    </div>
+  </div>
+    <script>
+      function setRecordDate(how) {
+        if ('updateDate' === how) {
+          document.getElementById('date').value = '';
+        } else if ('keepDate' === how) {
+          document.getElementById('date').value = '<?= $faqData['isoDate'] ?>';
+        } else if ('manualDate' === how) {
+          document.getElementById('recordDateInputContainer').classList.remove('invisible');
+          document.getElementById('date').value = '';
+        }
+      }
+    </script>
+    <?php
+} elseif ($user->perm->hasPermission($currentUserId, 'edit_faq') && !Database::checkOnEmptyTable('faqcategories')) {
+    echo Translation::get('err_NotAuth');
+} elseif ($user->perm->hasPermission($currentUserId, 'edit_faq') && Database::checkOnEmptyTable('faqcategories')) {
+    echo Translation::get('no_cats');
+}

--- a/phpmyfaq/admin/report.main.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/**
- * The reporting page.
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Gustavo Solt <gustavo.solt@mayflower.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2011-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2011-01-12
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::REPORTS->value)) {
-    $templateVars = [
-        'ad_menu_reports' => Translation::get('ad_menu_reports'),
-        'csrfTokenInput' => Token::getInstance()->getTokenInput('create-report'),
-        'ad_stat_report_make_report' => Translation::get('ad_stat_report_make_report'),
-        'ad_stat_report_fields' => Translation::get('ad_stat_report_fields'),
-        'ad_stat_report_category' => Translation::get('ad_stat_report_category'),
-        'ad_stat_report_sub_category' => Translation::get('ad_stat_report_sub_category'),
-        'ad_stat_report_translations' => Translation::get('ad_stat_report_translations'),
-        'ad_stat_report_language' => Translation::get('ad_stat_report_language'),
-        'ad_stat_report_id' => Translation::get('ad_stat_report_id'),
-        'ad_stat_report_sticky' => Translation::get('ad_stat_report_sticky'),
-        'ad_stat_report_title' => Translation::get('ad_stat_report_title'),
-        'ad_stat_report_creation_date' => Translation::get('ad_stat_report_creation_date'),
-        'ad_stat_report_owner' => Translation::get('ad_stat_report_owner'),
-        'ad_stat_report_last_modified_person' => Translation::get('ad_stat_report_last_modified_person'),
-        'ad_stat_report_url' => Translation::get('ad_stat_report_url'),
-        'ad_stat_report_visits' => Translation::get('ad_stat_report_visits')
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/statistics/report.main.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/session.keepalive.php
+++ b//dev/null
@@ -1,61 +0,0 @@
-<?php
-/**
- * A dummy page used within an IFRAME for warning the user about his next
- * session expiration and to give him the contextual possibility for
- * refreshing the session by clicking <OK>.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Uwe Pries <uwe.pries@digartis.de>
- * @copyright 2006-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2006-05-08
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Language;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-define('PMF_ROOT_DIR', dirname(__DIR__));
-const IS_VALID_PHPMYFAQ = null;
-require PMF_ROOT_DIR . '/src/Bootstrap.php';
-require PMF_ROOT_DIR . '/translations/language_en.php';
-$faqConfig = Configuration::getConfigurationInstance();
-$language = Filter::filterInput(INPUT_GET, 'lang', FILTER_SANITIZE_SPECIAL_CHARS);
-if (!is_null($language) && Language::isASupportedLanguage($language)) {
-    require PMF_ROOT_DIR . '/translations/language_' . $language . '.php';
-}
-try {
-    Translation::create()
-        ->setLanguagesDir(PMF_TRANSLATION_DIR)
-        ->setDefaultLanguage('en')
-        ->setCurrentLanguage($language);
-} catch (Exception $e) {
-    echo '<strong>Error:</strong> ' . $e->getMessage();
-}
-Strings::init($language);
-$user = CurrentUser::getCurrentUser($faqConfig);
-$refreshTime = (PMF_AUTH_TIMEOUT - PMF_AUTH_TIMEOUT_WARNING) * 60;
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/session-keepalive.twig');
-$templateVars = [
-    'metaLanguage' => Translation::get('metaLanguage'),
-    'phpMyFAQVersion' => System::getVersion(),
-    'currentYear' => date('Y'),
-    'isUserLoggedIn' => $user->isLoggedIn() && ($refreshTime > 0),
-    'csrfToken' => Token::getInstance()->getTokenString('admin-logout'),
-    'msgConfirm' => sprintf(Translation::get('ad_session_expiring'), PMF_AUTH_TIMEOUT_WARNING),
-    'sessionTimeout' => PMF_AUTH_TIMEOUT,
-    'refreshTime' => $refreshTime,
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/statistics.admin-log.php
+++ b//dev/null
@@ -1,75 +0,0 @@
-<?php
-/**
- * Overview of actions in the admin section.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-23
- */
-use phpMyFAQ\Administration\AdminLog;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Date;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\UserNameTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Twig\Extra\Intl\IntlExtension;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_ADMINLOG->value)) {
-    $logging = new AdminLog($faqConfig);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addExtension(new IntlExtension());
-    $twig->addExtension(new UserNameTwigExtension());
-    $template = $twig->loadTemplate('@admin/statistics/admin-log.twig');
-    $date = new Date($faqConfig);
-    $itemsPerPage = 15;
-    $pages = Filter::filterInput(INPUT_GET, 'pages', FILTER_VALIDATE_INT);
-    $page = Filter::filterInput(INPUT_GET, 'page', FILTER_VALIDATE_INT, 1);
-    if (is_null($pages)) {
-        $pages = round(($logging->getNumberOfEntries() + ($itemsPerPage / 3)) / $itemsPerPage, 0);
-    }
-    $baseUrl = sprintf('%sadmin/?action=adminlog&amp;page=%d', $faqConfig->getDefaultUrl(), $page);
-    $options = [
-        'baseUrl' => $baseUrl,
-        'total' => $logging->getNumberOfEntries(),
-        'perPage' => $itemsPerPage,
-        'pageParamName' => 'page',
-    ];
-    $pagination = new Pagination($options);
-    $loggingData = $logging->getAll();
-    $totalItems = count($loggingData);
-    $totalPages = ceil($totalItems / $itemsPerPage);
-    $offset = ($page - 1) * $itemsPerPage;
-    $currentItems = array_slice($loggingData, $offset, $itemsPerPage);
-    $templateVars = [
-        'headerAdminLog' => Translation::get('ad_menu_adminlog'),
-        'buttonDeleteAdminLog' => Translation::get('ad_adminlog_del_older_30d'),
-        'csrfDeleteAdminLogToken' => Token::getInstance()->getTokenString('delete-adminlog'),
-        'currentLocale' => $faqConfig->getLanguage()->getLanguage(),
-        'pagination' => $pagination->render(),
-        'msgId' => Translation::get('ad_categ_id'),
-        'msgDate' => Translation::get('ad_adminlog_date'),
-        'msgUser' => Translation::get('ad_adminlog_user'),
-        'msgIp' => Translation::get('ad_adminlog_ip'),
-        'loggingData' => $currentItems,
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/statistics.ratings.php
+++ b//dev/null
@@ -1,78 +0,0 @@
-<?php
-/**
- * The page with the ratings.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Administration\RatingData;
-use phpMyFAQ\Category;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Rating;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-[ $currentAdminUser, $currentAdminGroups ] = CurrentUser::getCurrentUserGroupId($user);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_VIEWLOGS->value)) {
-    $csrfToken = Filter::filterInput(INPUT_GET, 'csrf', FILTER_SANITIZE_SPECIAL_CHARS);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/statistics/ratings.twig');
-    $category = new Category($faqConfig, [], false);
-    $category->setUser($currentAdminUser);
-    $category->setGroups($currentAdminGroups);
-    $ratingData = new RatingData($faqConfig);
-    $ratings = new Rating($faqConfig);
-    if ($csrfToken && !Token::getInstance()->verifyToken('clear-statistics', $csrfToken)) {
-        $clearStatistics = false;
-    } else {
-        $clearStatistics = true;
-    }
-    if ('clear-statistics' === $action && $clearStatistics) {
-        if ($ratings->deleteAll()) {
-            $deletedStatistics = true;
-        } else {
-            $deletedStatistics = false;
-        }
-    }
-    $data = $ratingData->getAll();
-    $numberOfRatings = is_countable($data) ? count($data) : 0;
-    $currentCategory = 0;
-    $templateVars = [
-        'adminHeaderRatings' => Translation::get('ad_rs'),
-        'csrfToken' => Token::getInstance()->getTokenString('clear-statistics'),
-        'buttonDeleteAllVotings' => Translation::get('ad_delete_all_votings'),
-        'isDeleteAllVotings' => 'clear-statistics' === $action && $clearStatistics,
-        'isDeletedStatistics' => $deletedStatistics ?? false,
-        'msgDeleteAllVotings' => Translation::get('msgDeleteAllVotings'),
-        'msgDeleteAllVotingsError' => Translation::get('msgDeleteAllVotingsError'),
-        'currentCategory' => $currentCategory,
-        'ratingData' => $data,
-        'numberOfRatings' => $numberOfRatings,
-        'categoryNames' => $category->categoryName,
-        'green' => Translation::get('ad_rs_green'),
-        'greenNote' => Translation::get('ad_rs_ahtf'),
-        'red' => Translation::get('ad_rs_red'),
-        'redNote' => Translation::get('ad_rs_altt'),
-        'msgNoRatings' => Translation::get('ad_rs_no')
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/statistics.search.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/**
- * Frontend for search log statistics.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Anatoliy Belsky <anatoliy.belsky@mayflower.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-03-30
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Search;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\LanguageCodeTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$request = Request::createFromGlobals();
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_VIEWLOGS->value)) {
-    $perPage = 10;
-    $pages = Filter::filterVar($request->query->get('pages'), FILTER_VALIDATE_INT);
-    $page = Filter::filterVar($request->query->get('page'), FILTER_VALIDATE_INT, 1);
-    $search = new Search($faqConfig);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->addExtension(new LanguageCodeTwigExtension());
-    $template = $twig->loadTemplate('@admin/statistics/search.twig');
-    $searchesCount = $search->getSearchesCount();
-    $searchesList = $search->getMostPopularSearches($searchesCount + 1, true);
-    if (is_null($pages)) {
-        $pages = round(((is_countable($searchesList) ? count($searchesList) : 0) + ($perPage / 3)) / $perPage, 0);
-    }
-    $start = ($page - 1) * $perPage;
-    $end = $start + $perPage;
-    $baseUrl = sprintf(
-        '%sadmin/?action=searchstats&amp;page=%d',
-        $faqConfig->getDefaultUrl(),
-        $page
-    );
-    $options = [
-        'baseUrl' => $request->getUri(),
-        'total' => is_countable($searchesList) ? count($searchesList) : 0,
-        'perPage' => $perPage,
-        'pageParamName' => 'page',
-    ];
-    $pagination = new Pagination($options);
-    $templateVars = [
-        'ad_menu_searchstats' => Translation::get('ad_menu_searchstats'),
-        'csrfToken' => Token::getInstance()->getTokenString('truncate-search-terms'),
-        'ad_searchterm_del' => Translation::get('ad_searchterm_del'),
-        'ad_searchstats_search_term' => Translation::get('ad_searchstats_search_term'),
-        'ad_searchstats_search_term_count' => Translation::get('ad_searchstats_search_term_count'),
-        'ad_searchstats_search_term_lang' => Translation::get('ad_searchstats_search_term_lang'),
-        'ad_searchstats_search_term_percentage' => Translation::get('ad_searchstats_search_term_percentage'),
-        'pagination' => $pagination->render(),
-        'searchesCount' => $searchesCount,
-        'searchesList' => $searchesList,
-        'csrfTokenDelete' => Token::getInstance()->getTokenString('delete-searchterm'),
-        'ad_news_delete' => Translation::get('ad_news_delete'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/statistics.sessions.day.php
+++ b//dev/null
@@ -1,55 +0,0 @@
-<?php
-/**
- * Sessions per day.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Date;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-use Twig\Extension\CoreExtension;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$request = Request::createFromGlobals();
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_VIEWLOGS->value)) {
-    $perPage = 50;
-    $day = Filter::filterVar($request->request->get('day'), FILTER_VALIDATE_INT);
-    $firstHour = strtotime('midnight', $day);
-    $lastHour = strtotime('tomorrow', $firstHour) - 1;
-    $session = new Session($faqConfig);
-    $sessionData = $session->getSessionsByDate($firstHour, $lastHour);
-    $date = new Date($faqConfig);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $twig->getExtension(CoreExtension::class)->setDateFormat('Y-m-d H:i', '%d days');
-    $template = $twig->loadTemplate('@admin/statistics/sessions.day.twig');
-    $templateVars = [
-        'adminHeaderSessionsPerDay' => Translation::get('ad_sess_session'),
-        'currentDay' => date('Y-m-d', $day),
-        'msgIpAddress' => Translation::get('ad_sess_ip'),
-        'msgSessionDate' => Translation::get('ad_sess_s_date'),
-        'msgSession' => Translation::get('ad_sess_session'),
-        'sessionData' => $sessionData,
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/statistics.sessions.php
+++ b//dev/null
@@ -1,99 +0,0 @@
-<?php
-/**
- * The main statistics page.
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@scaramuccia.com>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Date;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\StatisticsHelper;
-use phpMyFAQ\Session;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use phpMyFAQ\Visits;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$request = Request::createFromGlobals();
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_VIEWLOGS->value)) {
-    $session = new Session($faqConfig);
-    $date = new Date($faqConfig);
-    $visits = new Visits($faqConfig);
-    $statisticsHelper = new StatisticsHelper($session, $visits, $date);
-    $stats = $statisticsHelper->getTrackingFilesStatistics();
-    $visitsPerDay = $session->getNumberOfSessions();
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/statistics/sessions.twig');
-    $statdelete = Filter::filterVar($request->request->get('statdelete'), FILTER_SANITIZE_SPECIAL_CHARS);
-    $month = Filter::filterVar($request->request->get('month'), FILTER_SANITIZE_SPECIAL_CHARS);
-    $csrfTokenFromPost = Filter::filterVar($request->request->get('csrf'), FILTER_SANITIZE_SPECIAL_CHARS);
-    $csrfTokenFromGet = Filter::filterVar($request->query->get('csrf'), FILTER_SANITIZE_SPECIAL_CHARS);
-    if ($csrfTokenFromPost && !Token::getInstance()->verifyToken('sessions', $csrfTokenFromPost)) {
-        $statdelete = null;
-    }
-    if ($csrfTokenFromGet && !Token::getInstance()->verifyToken('clear-visits', $csrfTokenFromGet)) {
-        $clearVisits = false;
-    } else {
-        $clearVisits = true;
-    }
-    if ($statdelete == 'delete' && $month !== '') {
-        $hasMessage = $statisticsHelper->deleteTrackingFiles($month);
-        $message = Translation::get('ad_adminlog_delete_success');
-    }
-    if ('clear-visits' === $action && $clearVisits) {
-        $hasMessage = $statisticsHelper->clearAllVisits();
-        $message = Translation::get('ad_reset_visits_success');
-    }
-    $templateVars = [
-        'adminHeaderSessions' => Translation::get('ad_stat_sess'),
-        'csrfTokenClearVisits' => Token::getInstance()->getTokenString('clear-visits'),
-        'msgClearVisits' => Translation::get('ad_clear_all_visits'),
-        'hasMessage' => $hasMessage ?? false,
-        'message' => $message ?? '',
-        'msgDays' => Translation::get('ad_stat_days'),
-        'numberOfDays' => $stats->numberOfDays,
-        'msgVisits' => Translation::get('ad_stat_vis'),
-        'numberOfVisits' => $visitsPerDay,
-        'msgVisitsPerDay' => Translation::get('ad_stat_vpd'),
-        'visitsPerDay' => ($stats->numberOfDays != 0) ? round(($visitsPerDay / $stats->numberOfDays), 2) : 0,
-        'msgFirstDate' =>  Translation::get('ad_stat_fien'),
-        'firstDate' =>  $statisticsHelper->getFirstTrackingDate($stats->firstDate),
-        'msgLastDate' => Translation::get('ad_stat_laen'),
-        'lastDate' => $statisticsHelper->getLastTrackingDate($stats->lastDate),
-        'msgSessionBrowse' => Translation::get('ad_stat_browse'),
-        'renderedDaySelector' => $statisticsHelper->renderDaySelector(),
-        'buttonOkay' => Translation::get('ad_stat_ok'),
-        'msgSessionManagement' => Translation::get('ad_stat_management'),
-        'csrfTokenSessions' => Token::getInstance()->getTokenInput('sessions'),
-        'msgChooseMonth' => Translation::get('ad_stat_choose'),
-        'renderedMonthSelector' => $statisticsHelper->renderMonthSelector(),
-        'buttonDeleteMonth' => Translation::get('ad_stat_delete'),
-        'msgExportSessions' => Translation::get('msgExportSessions'),
-        'msgExportSessionsAsCSV' => Translation::get('msgExportSessionsAsCSV'),
-        'csrfTokenExport' => Token::getInstance()->getTokenString('export-sessions'),
-        'dateToday' => date('Y-m-d'),
-        'msgExportSessionsFrom' => Translation::get('msgExportSessionsFrom'),
-        'msgExportSessionsTo' => Translation::get('msgExportSessionsTo'),
-        'datePickerMinDate' => date('Y-m-d', $stats->firstDate),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/statistics.show.php
+++ b//dev/null
@@ -1,48 +0,0 @@
-<?php
-/**
- * Show the session.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$sessionId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::STATISTICS_VIEWLOGS->value)) {
-    $session = new Session($faqConfig);
-    $time = $session->getTimeFromSessionId($sessionId);
-    $trackingData = explode("\n", file_get_contents(PMF_CONTENT_DIR . '/core/data/tracking' . date('dmY', $time)));
-    $templateVars = [
-        'ad_sess_session' => Translation::get('ad_sess_session'),
-        'sessionId' => $sessionId,
-        'ad_sess_back' => Translation::get('ad_sess_back'),
-        'ad_sess_referer' => Translation::get('ad_sess_referer'),
-        'ad_sess_browser' => Translation::get('ad_sess_browser'),
-        'ad_sess_ip' => Translation::get('ad_sess_ip'),
-        'trackingData' => $trackingData
-    ];
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-    $template = $twig->loadTemplate('@admin/statistics/statistics.show.twig');
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/stickyfaqs.php
+++ b//dev/null
@@ -1,39 +0,0 @@
-<?php
-/**
- * Shows the function for ordering sticky faqs customly.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Jan Harms <model_railroader@gmx-topmail.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-12-27
- */
-use phpMyFAQ\Faq;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\Session\Token;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/content/stickyfaqs.twig');
-$faq = new Faq($faqConfig);
-$stickyData = $faq->getStickyFaqsData();
-$templateVars = [
-    'stickyFAQsHeader' => Translation::get('stickyRecordsHeader'),
-    'stickyData' => $stickyData,
-    'sortableDisabled' => ($faqConfig->get('records.orderStickyFaqsCustom') === false) ? 'sortable-disabled' : '',
-    'orderingStickyFaqsActivated' => $faqConfig->get('records.orderStickyFaqsCustom'),
-    'alertMessageStickyFaqsDeactivated' => Translation::get('msgOrderStickyFaqsCustomDeactivated'),
-    'alertMessageNoStickyRecords' => Translation::get('msgNoStickyFaqs'),
-    'csrfToken' => Token::getInstance()->getTokenString('order-stickyfaqs')
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/stopwords.php
+++ b//dev/null
@@ -1,50 +0,0 @@
-<?php
-/**
- * The main stop words configuration frontend.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Anatoliy Belsky <ab@php.net>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2009-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2009-04-01
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Language\LanguageCodes;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/configuration/stopwords.twig');
-$sortedLanguageCodes = [];
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value)) {
-    $sortedLanguageCodes = LanguageCodes::getAll();
-    asort($sortedLanguageCodes);
-    reset($sortedLanguageCodes);
-}
-$templateVars = [
-    'adminHeaderStopWords' => Translation::get('ad_menu_stopwordsconfig'),
-    'hasPermission' => $user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT),
-    'msgDescription' => Translation::get('ad_stopwords_desc'),
-    'csrfToken' => Token::getInstance()->getTokenInput('stopwords'),
-    'msgStopWordsLabel' => Translation::get('ad_stopwords_desc'),
-    'sortedLanguageCodes' => $sortedLanguageCodes,
-    'buttonAdd' => Translation::get('ad_config_stopword_input'),
-];
-echo $template->render($templateVars);
-if (!$user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value)) {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/system.php
+++ b//dev/null
@@ -1,72 +0,0 @@
-<?php
-/**
- * phpMyFAQ System Information page.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@phpmyfaq.de>
- * @copyright 2013-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2013-01-02
- */
-use Elastic\Elasticsearch\Exception\ClientResponseException;
-use Elastic\Elasticsearch\Exception\ServerResponseException;
-use Elastic\Transport\Exception\NoNodeAvailableException;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Database;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/configuration/system.twig');
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value)) {
-    $faqSystem = new System();
-    if ($faqConfig->get('search.enableElasticsearch')) {
-        try {
-            $esFullInformation = $faqConfig->getElasticsearch()->info();
-            $esInformation = $esFullInformation['version']['number'];
-        } catch (ClientResponseException | ServerResponseException | NoNodeAvailableException $e) {
-            $faqConfig->getLogger()->error('Error while fetching Elasticsearch information', [$e->getMessage()]);
-            $esInformation = 'n/a';
-        }
-    } else {
-        $esInformation = 'n/a';
-    }
-    $templateVars = [
-        'adminHeaderSystemInfo' => Translation::get('ad_system_info'),
-        'systemInformation' => [
-            'phpMyFAQ Version' => $faqSystem->getVersion(),
-            'phpMyFAQ API Version' => $faqSystem->getApiVersion(),
-            'phpMyFAQ Plugin API Version' => $faqSystem->getPluginVersion(),
-            'phpMyFAQ Installation Path' => dirname((string) $request->server->get('SCRIPT_FILENAME'), 2),
-            'Web server software' => $request->server->get('SERVER_SOFTWARE'),
-            'Web server document root' => $request->server->get('DOCUMENT_ROOT'),
-            'Web server Interface' => strtoupper(PHP_SAPI),
-            'PHP Version' => PHP_VERSION,
-            'PHP Extensions' => implode(', ', get_loaded_extensions()),
-            'PHP Session path' => session_save_path(),
-            'Database Server' => Database::getType(),
-            'Database Server Version' => $faqConfig->getDb()->serverVersion(),
-            'Database Client Version' => $faqConfig->getDb()->clientVersion(),
-            'Elasticsearch Version' => $esInformation
-        ]
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/tags.php
+++ b//dev/null
@@ -1,59 +0,0 @@
-<?php
-/**
- * Administration frontend for Tags.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2003-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2003-02-24
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Tags;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$tagId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/content/tags.twig');
-$tags = new Tags($faqConfig);
-if ('delete-tag' === $action) {
-    $tagId = Filter::filterInput(INPUT_GET, 'id', FILTER_VALIDATE_INT);
-    if ($tags->delete($tagId)) {
-        $deleteSuccess = true;
-    } else {
-        $deleteSuccess = false;
-    }
-}
-$tagData = $tags->getAllTags();
-$templateVars = [
-    'adminHeaderTags' => Translation::get('ad_entry_tags'),
-    'csrfToken' => Token::getInstance()->getTokenInput('tags'),
-    'isDelete' => 'delete-tag' === $action,
-    'isDeleteSuccess' => $deleteSuccess ?? false,
-    'msgDeleteSuccess' => Translation::get('ad_tag_delete_success'),
-    'msgDeleteError' => Translation::get('ad_tag_delete_error'),
-    'tags' => $tagData,
-    'noTags' => Translation::get('ad_news_nodata'),
-    'buttonEdit' => Translation::get('ad_user_edit'),
-    'msgConfirm' => Translation::get('ad_user_del_3'),
-    'buttonDelete' => Translation::get('msgDelete'),
-];
-echo $template->render($templateVars);
-if (!$user->perm->hasPermission($user->getUserId(), PermissionType::FAQ_EDIT->value)) {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/twofactor.php
+++ b//dev/null
@@ -1,39 +0,0 @@
-<?php
-/**
- * The 2fa-form for entering the token for two-factor-authentication.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Jan Harms <model_railroader@gmx-topmail.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-03-11
- */
-use phpMyFAQ\Translation;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Configuration;
-use Symfony\Component\HttpFoundation\Request;
-$request = Request::createFromGlobals();
-$faqConfig = Configuration::getConfigurationInstance();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/user/twofactor.twig');
-$templateVars = [
-    'msgTwofactorEnabled' => Translation::get('msgTwofactorEnabled'),
-    'msgTwofactorCheck' => Translation::get('msgTwofactorCheck'),
-    'msgEnterTwofactorToken' => Translation::get('msgEnterTwofactorToken'),
-    'requestIsSecure' => $request->isSecure(),
-    'security.useSslForLogins' => $faqConfig->get('security.useSslForLogins'),
-    'actionIsLogout' => $request->query->get('action') === 'logout',
-    'ad_logout' => Translation::get('ad_logout'),
-    'error' => $error,
-    'requestHost' => $request->getHost(),
-    'requestUri' => $request->getRequestUri(),
-    'msgSecureSwitch' => Translation::get('msgSecureSwitch'),
-    'systemUri' => $faqConfig->getDefaultUrl()
-];
-echo $template->render($templateVars);

--- a/phpmyfaq/admin/upgrade.php
+++ b//dev/null
@@ -1,58 +0,0 @@
-<?php
-/**
- * The upgrade administration view
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-07-01
- */
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\ReleaseType;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = Configuration::getConfigurationInstance();
-$user = CurrentUser::getCurrentUser($faqConfig);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$template = $twig->loadTemplate('@admin/configuration/upgrade.twig');
-if (
-    $faqConfig->get('upgrade.onlineUpdateEnabled') &&
-    $user->perm->hasPermission($user->getUserId(), PermissionType::CONFIGURATION_EDIT->value)
-) {
-    $templateVars = [
-        'adminHeaderUpgrade' => Translation::get('ad_menu_upgrade'),
-        'headerCheckHealth' => Translation::get('headerCheckHealth'),
-        'msgHealthCheck' => Translation::get('msgHealthCheck'),
-        'buttonCheckHealth' => Translation::get('buttonCheckHealth'),
-        'headerCheckUpdates' => Translation::get('headerCheckUpdates'),
-        'msgUpdateCheck' => Translation::get('msgUpdateCheck'),
-        'buttonCheckUpdates' => Translation::get('buttonCheckUpdates'),
-        'headerExtractPackage' => Translation::get('headerExtractPackage'),
-        'msgExtractPackage' => Translation::get('msgExtractPackage'),
-        'buttonExtractPackage' => Translation::get('buttonExtractPackage'),
-        'headerInstallDownloadedPackage' => Translation::get('headerInstallDownloadedPackage'),
-        'msgExtractToFileSystem' => Translation::get('msgExtractToFileSystem'),
-        'msgInstallDownloadedPackage' => Translation::get('msgInstallDownloadedPackage'),
-        'isOnNightlies' => $faqConfig->get('upgrade.releaseEnvironment') === ReleaseType::NIGHTLY->value,
-        'releaseEnvironment' => ucfirst((string) $faqConfig->get('upgrade.releaseEnvironment')),
-        'dateLastChecked' => $faqConfig->get('upgrade.dateLastChecked'),
-        'versionCurrent' => $faqConfig->get('main.currentVersion'),
-    ];
-    echo $template->render($templateVars);
-} else {
-    require __DIR__ . '/no-permission.php';
-}

--- a/phpmyfaq/admin/user.php
+++ b//dev/null
@@ -1,166 +0,0 @@
-<?php
-/**
- * Displays the user management frontend.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Lars Tiedemann <php@larstiedemann.de>
- * @author    Uwe Pries <uwe.pries@digartis.de>
- * @author    Sarah Hermann <sayh@gmx.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-12-15
- */
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\Extensions\PermissionTranslationTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-if (
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::USER_EDIT->value) ||
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::USER_DELETE->value) ||
-    !$user->perm->hasPermission($user->getUserId(), PermissionType::USER_ADD->value)
-) {
-    require __DIR__ . '/no-permission.php';
-    exit();
-}
-$templateVars = [];
-$userId = Filter::filterInput(INPUT_GET, 'user_id', FILTER_VALIDATE_INT);
-$selectSize = 10;
-$defaultUserAction = 'list';
-$userActionList = [
-    'list',
-    'listallusers'
-];
-$userAction = Filter::filterInput(INPUT_GET, 'user_action', FILTER_SANITIZE_SPECIAL_CHARS, $defaultUserAction);
-$currentUser = new CurrentUser($faqConfig);
-if ($userAction == 'listallusers') {
-    if (!$user->perm->hasPermission($user->getUserId(), PermissionType::USER_EDIT->value)) {
-        require __DIR__ . '/no-permission.php';
-        exit();
-    }
-    $allUsers = $user->getAllUsers(false);
-    $numUsers = is_countable($allUsers) ? count($allUsers) : 0;
-    $page = Filter::filterInput(INPUT_GET, 'page', FILTER_VALIDATE_INT, 0);
-    $perPage = 10;
-    $numPages = ceil($numUsers / $perPage);
-    $lastPage = $page * $perPage;
-    $firstPage = $lastPage - $perPage;
-    $baseUrl = sprintf(
-        '%sadmin/?action=user&amp;user_action=listallusers&amp;page=%d',
-        $faqConfig->getDefaultUrl(),
-        $page
-    );
-    $options = [
-        'baseUrl' => $baseUrl,
-        'total' => $numUsers,
-        'perPage' => $perPage,
-        'pageParamName' => 'page',
-    ];
-    $pagination = new Pagination($options);
-    $counter = $displayedCounter = 0;
-    $users = [];
-    foreach ($allUsers as $listedUserId) {
-        $user->getUserById($listedUserId, true);
-        $tempUser = [];
-        if ($displayedCounter >= $perPage) {
-            continue;
-        }
-        ++$counter;
-        if ($counter <= $firstPage) {
-            continue;
-        }
-        ++$displayedCounter;
-        $tempUser = [
-            'display_name' => $user->getUserData('display_name'),
-            'id' => $user->getUserId(),
-            'email' => $user->getUserData('email'),
-            'status' => $user->getStatus(),
-            'isSuperAdmin' => $user->isSuperAdmin(),
-            'isVisible' => $user->getUserData('is_visible'),
-            'login' => $user->getLogin()
-        ];
-        $users[] = $tempUser;
-    }
-    $user = CurrentUser::getCurrentUser($faqConfig);
-    $templateVars = [
-        ...$templateVars,
-        'perPage' => $perPage,
-        'numUsers' => $numUsers,
-        'pagination' => $pagination->render(),
-        'users' => $users,
-        'userIsSuperAdmin' => $user->isSuperAdmin()
-    ];
-}
-$templateVars = [
-    ...$templateVars,
-    'userAction' => $userAction,
-    'ad_user' => Translation::get('ad_user'),
-    'permissionAddUser' => $currentUser->perm->hasPermission($user->getUserId(), PermissionType::USER_ADD->value),
-    'ad_user_add' => Translation::get('ad_user_add'),
-    'permissionEditUser' => $currentUser->perm->hasPermission($user->getUserId(), PermissionType::USER_EDIT->value),
-    'list_all_users' => Translation::get('list_all_users'),
-    'userId' => $userId,
-    'msgSearch' => Translation::get('msgSearch'),
-    'ad_auth_user' => Translation::get('ad_auth_user'),
-    'ad_user_profou' => Translation::get('ad_user_profou'),
-    'csrfToken_updateUserData' => Token::getInstance()->getTokenString('update-user-data'),
-    'msgAuthenticationSource' => Translation::get('msgAuthenticationSource'),
-    'ad_user_status' => Translation::get('ad_user_status'),
-    'ad_user_active' => Translation::get('ad_user_active'),
-    'ad_user_blocked' => Translation::get('ad_user_blocked'),
-    'ad_user_protected' => Translation::get('ad_user_protected'),
-    'msgRealname' => Translation::get('msgRealname'),
-    'msgEmail' => Translation::get('msgEmail'),
-    'ad_user_is_superadmin' => Translation::get('ad_user_is_superadmin'),
-    'ad_user_overwrite_passwd' => Translation::get('ad_user_overwrite_passwd'),
-    'ad_user_overwrite_twofactor' => Translation::get('ad_user_overwrite_twofactor'),
-    'ad_user_delete' => Translation::get('ad_user_delete'),
-    'ad_gen_save' => Translation::get('ad_gen_save'),
-    'csrfToken_updateUserRights' => Token::getInstance()->getTokenString('update-user-rights'),
-    'ad_user_rights' => Translation::get('ad_user_rights'),
-    'ad_user_checkall' => Translation::get('ad_user_checkall'),
-    'ad_user_uncheckall' => Translation::get('ad_user_uncheckall'),
-    'userRights' => $user->perm->getAllRightsData(),
-    'msgExportUsersAsCSV' => Translation::get('msgExportUsersAsCSV'),
-    'msgNewContentName' => Translation::get('msgNewContentName'),
-    'msgNewContentMail' => Translation::get('msgNewContentMail'),
-    'ad_user_is_visible' => Translation::get('ad_user_is_visible'),
-    'ad_user_edit' => Translation::get('ad_user_edit'),
-    'csrfToken_activateUser' => Token::getInstance()->getTokenString('activate-user'),
-    'ad_news_set_active' => Translation::get('ad_news_set_active'),
-    'permissionDeleteUser' =>
-        $currentUser->perm->hasPermission($user->getUserId(), PermissionType::USER_DELETE->value),
-    'csrfToken_deleteUser' => Token::getInstance()->getTokenString('delete-user'),
-    'ad_adus_adduser' => Translation::get('ad_adus_adduser'),
-    'csrfToken_addUser' => Token::getInstance()->getTokenString('add-user'),
-    'ad_adus_name' => Translation::get('ad_adus_name'),
-    'ad_add_user_change_password' => Translation::get('ad_add_user_change_password'),
-    'ad_adus_password' => Translation::get('ad_adus_password'),
-    'ad_passwd_con' => Translation::get('ad_passwd_con'),
-    'ad_gen_cancel' => Translation::get('ad_gen_cancel'),
-    'ad_menu_passwd' => Translation::get('ad_menu_passwd'),
-    'csrfToken_overwritePassword' => Token::getInstance()->getTokenString('overwrite-password'),
-    'ad_passwd_new' => Translation::get('ad_passwd_new'),
-    'msgWarning' => Translation::get('msgWarning'),
-    'ad_gen_yes' => Translation::get('ad_gen_yes'),
-    'ad_gen_no' => Translation::get('ad_gen_no'),
-    'ad_user_deleteUser' => Translation::get('ad_user_deleteUser'),
-    'msgUserList' => Translation::get('msgUserList')
-];
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates');
-$twig->addExtension(new PermissionTranslationTwigExtension());
-$template = $twig->loadTemplate('@admin/user/users.twig');
-echo $template->render($templateVars);

--- a//dev/null
+++ b/phpmyfaq/api.service.php
@@ -0,0 +1,865 @@
+<?php
+/**
+ * The API Service Layer.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2010-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2010-09-15
+ */
+const IS_VALID_PHPMYFAQ = null;
+use phpMyFAQ\Captcha\Captcha;
+use phpMyFAQ\Category;
+use phpMyFAQ\Comments;
+use phpMyFAQ\Configuration;
+use phpMyFAQ\Entity\Comment;
+use phpMyFAQ\Entity\CommentType;
+use phpMyFAQ\Entity\FaqEntity;
+use phpMyFAQ\Faq;
+use phpMyFAQ\Faq\FaqMetaData;
+use phpMyFAQ\Faq\FaqPermission;
+use phpMyFAQ\Filter;
+use phpMyFAQ\Helper\CategoryHelper;
+use phpMyFAQ\Helper\FaqHelper;
+use phpMyFAQ\Helper\QuestionHelper;
+use phpMyFAQ\Helper\RegistrationHelper;
+use phpMyFAQ\Language;
+use phpMyFAQ\Language\Plurals;
+use phpMyFAQ\Link;
+use phpMyFAQ\Mail;
+use phpMyFAQ\Network;
+use phpMyFAQ\News;
+use phpMyFAQ\Notification;
+use phpMyFAQ\Question;
+use phpMyFAQ\Rating;
+use phpMyFAQ\Search;
+use phpMyFAQ\Search\SearchResultSet;
+use phpMyFAQ\Session;
+use phpMyFAQ\Session\Token;
+use phpMyFAQ\StopWords;
+use phpMyFAQ\Strings;
+use phpMyFAQ\Translation;
+use phpMyFAQ\User;
+use phpMyFAQ\User\CurrentUser;
+use phpMyFAQ\Utils;
+use Symfony\Component\HttpFoundation\JsonResponse;
+use Symfony\Component\HttpFoundation\Request;
+use Symfony\Component\HttpFoundation\Response;
+use Symfony\Component\Mailer\Exception\TransportExceptionInterface;
+require 'src/Bootstrap.php';
+$response = new JsonResponse();
+$request = Request::createFromGlobals();
+$faqConfig = Configuration::getConfigurationInstance();
+$postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+$apiLanguage = Filter::filterVar($postData['lang'], FILTER_SANITIZE_SPECIAL_CHARS);
+$currentToken = Filter::filterVar($postData['csrf'] ?? '', FILTER_SANITIZE_SPECIAL_CHARS);
+$action = Filter::filterVar($request->get('action'), FILTER_SANITIZE_SPECIAL_CHARS);
+if ($faqConfig->get('security.enableGoogleReCaptchaV2')) {
+    $code = Filter::filterVar($postData['g-recaptcha-response'] ?? '', FILTER_SANITIZE_SPECIAL_CHARS);
+} else {
+    $code = Filter::filterVar($postData['captcha'] ?? '', FILTER_SANITIZE_SPECIAL_CHARS);
+}
+$Language = new Language($faqConfig);
+$languageCode = $Language->setLanguage($faqConfig->get('main.languageDetection'), $faqConfig->get('main.language'));
+require_once 'lang/language_en.php';
+$faqConfig->setLanguage($Language);
+if (Language::isASupportedLanguage($apiLanguage)) {
+    $languageCode = trim((string) $apiLanguage);
+    require_once 'lang/language_' . $languageCode . '.php';
+} else {
+    $languageCode = 'en';
+    require_once 'lang/language_en.php';
+}
+try {
+    Translation::create()
+        ->setLanguagesDir(PMF_LANGUAGE_DIR)
+        ->setDefaultLanguage('en')
+        ->setCurrentLanguage($languageCode);
+} catch (Exception $e) {
+    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+    $response->setData(['error' => $e->getMessage()]);
+}
+Strings::init($languageCode);
+$user = CurrentUser::getCurrentUser($faqConfig);
+$faqSession = new Session($faqConfig);
+$faqSession->setCurrentUser($user);
+$network = new Network($faqConfig);
+$stopWords = new StopWords($faqConfig);
+$faqHelper = new FaqHelper($faqConfig);
+if ($network->isBanned($request->server->get('REMOTE_ADDR'))) {
+    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+    $response->setData(['error' => Translation::get('err_bannedIP')]);
+}
+$captcha = Captcha::getInstance($faqConfig);
+$captcha->setUserIsLoggedIn($user->isLoggedIn());
+$fatalError = false;
+if (
+    'add-voting' !== $action && 'submit-user-data' !== $action && 'change-password' !== $action &&
+    'submit-request-removal' !== $action && !$captcha->checkCaptchaCode($code ?? '')
+) {
+    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+    $response->setData(['error' => Translation::get('msgCaptcha')]);
+    $fatalError = true;
+}
+if (
+    !$user->isLoggedIn() && $faqConfig->get('security.enableLoginOnly') && 'submit-request-removal' !== $action &&
+    'change-password' !== $action && 'save-registration' !== $action
+) {
+    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+    $response->setData(['error' => Translation::get('ad_msg_noauth')]);
+    $fatalError = true;
+}
+if ($fatalError) {
+    $response->send();
+    exit();
+}
+switch ($action) {
+    case 'add-comment':
+        if (
+            !$faqConfig->get('records.allowCommentsForGuests') &&
+            !$user->perm->hasPermission($user->getUserId(), 'addcomment')
+        ) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_NotAuth')]);
+            break;
+        }
+        $faq = new Faq($faqConfig);
+        $oComment = new Comments($faqConfig);
+        $category = new Category($faqConfig);
+        $type = Filter::filterVar($postData['type'], FILTER_SANITIZE_SPECIAL_CHARS);
+        $faqId = Filter::filterVar($postData['id'] ?? null, FILTER_VALIDATE_INT, 0);
+        $newsId = Filter::filterVar($postData['newsId'] ?? null, FILTER_VALIDATE_INT);
+        $username = Filter::filterVar($postData['user'], FILTER_SANITIZE_SPECIAL_CHARS);
+        $mailer = Filter::filterVar($postData['mail'], FILTER_VALIDATE_EMAIL);
+        $comment = Filter::filterVar($postData['comment_text'], FILTER_SANITIZE_SPECIAL_CHARS);
+        switch ($type) {
+            case 'news':
+                $id = $newsId;
+                break;
+            case 'faq':
+                $id = $faqId;
+                break;
+        }
+        if (!$faqConfig->get('main.optionalMailAddress') && is_null($mailer)) {
+            $mailer = $faqConfig->getAdminEmail();
+        }
+        if (!$user->isLoggedIn()) {
+            $user = new User($faqConfig);
+            if (true === $user->checkDisplayName($username) && true === $user->checkMailAddress($mailer)) {
+                $response->setStatusCode(Response::HTTP_CONFLICT);
+                $response->setData(['error' => Translation::get('err_SaveComment')]);
+                $faqConfig->getLogger()->error('Name and mail already used by registered user.');
+                break;
+            }
+        }
+        if (
+            !is_null($username) && !is_null($mailer) && !is_null($comment) && $stopWords->checkBannedWord($comment) &&
+            !$faq->commentDisabled($id, $languageCode, $type) && !$faq->isActive($id, $languageCode, $type)
+        ) {
+            try {
+                $faqSession->userTracking('save_comment', $id);
+            } catch (Exception $exception) {
+                $faqConfig->getLogger()->error('Tracking of save new comment', ['exception' => $exception->getMessage()]);
+            }
+            $commentEntity = new Comment();
+            $commentEntity
+                ->setRecordId($id)
+                ->setType($type)
+                ->setUsername($username)
+                ->setEmail($mailer)
+                ->setComment(nl2br(strip_tags((string) $comment)))
+                ->setDate($request->server->get('REQUEST_TIME'));
+            if ($oComment->addComment($commentEntity)) {
+                $emailTo = $faqConfig->getAdminEmail();
+                $title = '';
+                $urlToContent = '';
+                if ('faq' == $type) {
+                    $faq->getRecord($id);
+                    if ($faq->faqRecord['email'] != '') {
+                        $emailTo = $faq->faqRecord['email'];
+                    }
+                    $title = $faq->getRecordTitle($id);
+                    $faqUrl = sprintf(
+                        '%s?action=faq&cat=%d&id=%d&artlang=%s',
+                        $faqConfig->getDefaultUrl(),
+                        $category->getCategoryIdFromFaq($faq->faqRecord['id']),
+                        $faq->faqRecord['id'],
+                        $faq->faqRecord['lang']
+                    );
+                    $oLink = new Link($faqUrl, $faqConfig);
+                    $oLink->itemTitle = $faq->faqRecord['title'];
+                    $urlToContent = $oLink->toString();
+                } else {
+                    $news = new News($faqConfig);
+                    $newsData = $news->getNewsEntry($id);
+                    if ($newsData['authorEmail'] != '') {
+                        $emailTo = $newsData['authorEmail'];
+                    }
+                    $title = $newsData['header'];
+                    $link = sprintf(
+                        '%s?action=news&newsid=%d&newslang=%s',
+                        $faqConfig->getDefaultUrl(),
+                        $newsData['id'],
+                        $newsData['lang']
+                    );
+                    $oLink = new Link($link, $faqConfig);
+                    $oLink->itemTitle = $newsData['header'];
+                    $urlToContent = $oLink->toString();
+                }
+                $commentMail =
+                    'User: ' . $commentEntity->getUsername() . ', mailto:' . $commentEntity->getEmail() . "\n" .
+                    'Title: ' . $title . "\n" .
+                    'New comment posted here: ' . $urlToContent .
+                    "\n\n" .
+                    wordwrap((string) $comment, 72);
+                $send = [];
+                $mailer = new Mail($faqConfig);
+                $mailer->setReplyTo($commentEntity->getEmail(), $commentEntity->getUsername());
+                $mailer->addTo($emailTo);
+                $send[$emailTo] = 1;
+                $send[$faqConfig->getAdminEmail()] = 1;
+                if ($type === CommentType::FAQ) {
+                    $category = new Category($faqConfig);
+                    $categories = $category->getCategoryIdsFromFaq($faq->faqRecord['id']);
+                    foreach ($categories as $_category) {
+                        $userId = $category->getOwner($_category);
+                        $catUser = new User($faqConfig);
+                        $catUser->getUserById($userId);
+                        $catOwnerEmail = $catUser->getUserData('email');
+                        if ($catOwnerEmail !== '') {
+                            if (!isset($send[$catOwnerEmail]) && $catOwnerEmail !== $emailTo) {
+                                $mailer->addCc($catOwnerEmail);
+                                $send[$catOwnerEmail] = 1;
+                            }
+                        }
+                    }
+                }
+                $mailer->subject = $faqConfig->getTitle() . ': New comment for "' . $title . '"';
+                $mailer->message = strip_tags($commentMail);
+                $result = $mailer->send();
+                unset($mailer);
+                $response->setStatusCode(Response::HTTP_OK);
+                $response->setData(['success' => Translation::get('msgCommentThanks')]);
+            } else {
+                try {
+                    $faqSession->userTracking('error_save_comment', $id);
+                } catch (Exception) {
+                }
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => Translation::get('err_SaveComment')]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => 'Please add your name, your e-mail address and a comment!']);
+        }
+        break;
+    case 'add-faq':
+        if (
+            !$faqConfig->get('records.allowNewFaqsForGuests') &&
+            !$user->perm->hasPermission($user->getUserId(), 'addfaq')
+        ) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_NotAuth')]);
+            break;
+        }
+        $faq = new Faq($faqConfig);
+        $category = new Category($faqConfig);
+        $questionObject = new Question($faqConfig);
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));
+        $question = Filter::filterVar($postData['question'], FILTER_SANITIZE_SPECIAL_CHARS);
+        $question = trim(strip_tags((string) $question));
+        if ($faqConfig->get('main.enableWysiwygEditorFrontend')) {
+            $answer = Filter::filterVar($postData['answer'], FILTER_SANITIZE_SPECIAL_CHARS);
+            $answer = trim(html_entity_decode((string) $answer));
+        } else {
+            $answer = Filter::filterVar($postData['answer'], FILTER_SANITIZE_SPECIAL_CHARS);
+            $answer = strip_tags((string) $answer);
+            $answer = trim(nl2br($answer));
+        }
+        $contentLink = Filter::filterVar($postData['contentlink'], FILTER_VALIDATE_URL);
+        $keywords = Filter::filterVar($postData['keywords'], FILTER_SANITIZE_SPECIAL_CHARS);
+        if (isset($postData['rubrik[]'])) {
+            if (is_string($postData['rubrik[]'])) {
+                $postData['rubrik[]'] = [ $postData['rubrik[]'] ];
+            }
+            $categories = Filter::filterArray(
+                $postData['rubrik[]']
+            );
+        }
+        if (isset($postData['faqid']) && isset($postData['lang']) && isset($postData['translated_answer'])) {
+            $faqId = Filter::filterVar($postData['faqid'], FILTER_VALIDATE_INT);
+            $faqLanguage = Filter::filterVar($postData['lang'], FILTER_SANITIZE_SPECIAL_CHARS);
+            $answer = trim((string) Filter::filterVar($postData['translated_answer'], FILTER_SANITIZE_SPECIAL_CHARS));
+        }
+        if (
+            !is_null($author) && !is_null($email) && !empty($question) &&
+            $stopWords->checkBannedWord(strip_tags($question)) &&
+            !empty($answer) && $stopWords->checkBannedWord(strip_tags($answer))
+        ) {
+            $isNew = true;
+            $newLanguage = '';
+            if (!isset($faqId)) {
+                $isNew = false;
+                try {
+                    $faqSession->userTracking('save_new_translation_entry', 0);
+                } catch (Exception) {
+                }
+            } else {
+                try {
+                    $faqSession->userTracking('save_new_entry', 0);
+                } catch (Exception) {
+                }
+            }
+            $isTranslation = false;
+            if (isset($faqLanguage) && !is_null($faqLanguage)) {
+                $isTranslation = true;
+                $newLanguage = $faqLanguage;
+            }
+            if (!is_null($contentLink) && Strings::substr($contentLink, 7) !== '') {
+                $answer = sprintf(
+                    '%s<br><div id="newFAQContentLink">%s<a href="https://%s" target="_blank">%s</a></div>',
+                    $answer,
+                    Translation::get('msgInfo'),
+                    Strings::substr($contentLink, 7),
+                    Strings::htmlentities($contentLink)
+                );
+            }
+            $autoActivate = $faqConfig->get('records.defaultActivation');
+            $faqEntity = new FaqEntity();
+            $faqEntity
+                ->setLanguage(($isTranslation === true ? $newLanguage : $languageCode))
+                ->setQuestion($question)
+                ->setActive($autoActivate)
+                ->setSticky(false)
+                ->setAnswer($answer)
+                ->setKeywords($keywords)
+                ->setAuthor($author)
+                ->setEmail($email)
+                ->setComment(true)
+                ->setNotes('');
+            if (!$isNew && isset($faqId)) {
+                $faqEntity->setId($faqId);
+                $categories = $category->getCategoryIdsFromFaq($faqId);
+            }
+            $recordId = $faq->create($faqEntity);
+            $openQuestionId = Filter::filterInput(INPUT_POST, 'openQuestionID', FILTER_VALIDATE_INT);
+            if ($openQuestionId) {
+                if ($faqConfig->get('records.enableDeleteQuestion')) {
+                    $questionObject->deleteQuestion($openQuestionId);
+                } else { // adds this faq record id to the related open question
+                    $questionObject->updateQuestionAnswer($openQuestionId, $recordId, $categories[0]);
+                }
+            }
+            $faqMetaData = new FaqMetaData($faqConfig);
+            $faqMetaData
+                ->setFaqId($recordId)
+                ->setFaqLanguage($faqEntity->getLanguage())
+                ->setCategories($categories)
+                ->save();
+            $categoryHelper = new CategoryHelper();
+            $categoryHelper
+                ->setCategory($category)
+                ->setConfiguration($faqConfig);
+            $moderators = $categoryHelper->getModerators($categories);
+            try {
+                $notification = new Notification($faqConfig);
+                $notification->sendNewFaqAdded($moderators, $recordId, $faqEntity->getLanguage());
+            } catch (Exception | TransportExceptionInterface $e) {
+                $faqConfig->getLogger()->info('Notification could not be sent: ', [ $e->getMessage() ]);
+            }
+            if ($faqConfig->get('records.defaultActivation')) {
+                $link = [
+                    'link' => $faqHelper->createFaqUrl($faqEntity, $categories[0]),
+                    'info' => Translation::get('msgRedirect')
+                ];
+            } else {
+                $link = [];
+            }
+            $response->setStatusCode(Response::HTTP_OK);
+            $response->setData([
+                'success' =>
+                    ($isNew ? Translation::get('msgNewContentThanks') : Translation::get('msgNewTranslationThanks')),
+                ... $link
+            ]);
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_SaveEntries')]);
+        }
+        break;
+    case 'ask-question':
+        if (
+            !$faqConfig->get('records.allowQuestionsForGuests') &&
+            !$faqConfig->get('main.enableAskQuestions') &&
+            !$user->perm->hasPermission($user->getUserId(), 'addquestion')
+        ) {
+            $response->setStatusCode(Response::HTTP_UNAUTHORIZED);
+            $response->setData(['error' => Translation::get('err_NotAuth')]);
+            break;
+        }
+        $faq = new Faq($faqConfig);
+        $cat = new Category($faqConfig);
+        $questionObject = new Question($faqConfig);
+        $categories = $cat->getAllCategories();
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));
+        $ucategory = Filter::filterVar($postData['category'], FILTER_VALIDATE_INT);
+        $question = Filter::filterVar($postData['question'], FILTER_SANITIZE_SPECIAL_CHARS);
+        $question = trim(strip_tags((string) $question));
+        $save = Filter::filterVar($postData['save'] ?? 0, FILTER_VALIDATE_INT);
+        if (!$faqConfig->get('main.optionalMailAddress') && is_null($email)) {
+            $email = $faqConfig->getAdminEmail();
+        }
+        if (false === $faqConfig->get('main.enableSmartAnswering')) {
+            $save = true;
+        }
+        if (!empty($author) && !empty($email) && !empty($question) && $stopWords->checkBannedWord($question)) {
+            if ($faqConfig->get('records.enableVisibilityQuestions')) {
+                $visibility = 'Y';
+            } else {
+                $visibility = 'N';
+            }
+            $questionData = [
+                'username' => $author,
+                'email' => $email,
+                'category_id' => $ucategory,
+                'question' => Strings::htmlentities($question),
+                'is_visible' => $visibility
+            ];
+            if (false === (bool)$save) {
+                $cleanQuestion = $stopWords->clean($question);
+                $user = new CurrentUser($faqConfig);
+                $faqSearch = new Search($faqConfig);
+                $faqSearch->setCategory(new Category($faqConfig));
+                $faqSearch->setCategoryId((int) $ucategory);
+                $faqPermission = new FaqPermission($faqConfig);
+                $faqSearchResult = new SearchResultSet($user, $faqPermission, $faqConfig);
+                $plr = new Plurals();
+                $searchResult = [];
+                $mergedResult = [];
+                foreach ($cleanQuestion as $word) {
+                    if (!empty($word)) {
+                        try {
+                            $searchResult[] = $faqSearch->search($word, false);
+                        } catch (Exception $e) {
+                        }
+                    }
+                }
+                foreach ($searchResult as $resultSet) {
+                    foreach ($resultSet as $result) {
+                        $mergedResult[] = $result;
+                    }
+                }
+                $faqSearchResult->reviewResultSet($mergedResult);
+                if (0 < $faqSearchResult->getNumberOfResults()) {
+                    $smartAnswer = sprintf(
+                        '<h5>%s</h5>',
+                        $plr->getMsg('plmsgSearchAmount', $faqSearchResult->getNumberOfResults())
+                    );
+                    $smartAnswer .= '<ul>';
+                    foreach ($faqSearchResult->getResultSet() as $result) {
+                        $url = sprintf(
+                            '%sindex.php?action=faq&cat=%d&id=%d&artlang=%s',
+                            $faqConfig->getDefaultUrl(),
+                            $result->category_id,
+                            $result->id,
+                            $result->lang
+                        );
+                        $oLink = new Link($url, $faqConfig);
+                        $oLink->text = Utils::chopString($result->question, 15);
+                        $oLink->itemTitle = $result->question;
+                        try {
+                            $smartAnswer .= sprintf(
+                                '<li>%s<br><small class="pmf-search-preview">%s...</small></li>',
+                                $oLink->toHtmlAnchor(),
+                                $faqHelper->renderAnswerPreview($result->answer, 10)
+                            );
+                        } catch (Exception) {
+                        }
+                    }
+                    $smartAnswer .= '</ul>';
+                    $response->setData(['result' => $smartAnswer]);
+                } else {
+                    $questionObject->addQuestion($questionData);
+                    $questionHelper = new QuestionHelper($faqConfig, $cat);
+                    try {
+                        $questionHelper->sendSuccessMail($questionData, $categories);
+                    } catch (Exception | TransportExceptionInterface $exception) {
+                        $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                        $response->setData(['error' => $exception->getMessage()]);
+                    }
+                    $response->setStatusCode(Response::HTTP_OK);
+                    $response->setData(['success' => Translation::get('msgAskThx4Mail')]);
+                }
+            } else {
+                $questionObject->addQuestion($questionData);
+                $questionHelper = new QuestionHelper($faqConfig, $cat);
+                try {
+                    $questionHelper->sendSuccessMail($questionData, $categories);
+                } catch (Exception | TransportExceptionInterface $exception) {
+                    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                    $response->setData(['error' => $exception->getMessage()]);
+                }
+                $response->setStatusCode(Response::HTTP_OK);
+                $response->setData(['success' => Translation::get('msgAskThx4Mail')]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_SaveQuestion')]);
+        }
+        break;
+    case 'save-registration':
+        $registration = new RegistrationHelper($faqConfig);
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $fullName = trim((string) Filter::filterVar($postData['realname'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $userName = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));
+        $isVisible = Filter::filterVar($postData['is_visible'], FILTER_SANITIZE_SPECIAL_CHARS) ?? false;
+        if (!$registration->isDomainAllowed($email)) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => 'The domain is not whitelisted.']);
+            break;
+        }
+        if (!is_null($userName) && !is_null($email) && !is_null($fullName)) {
+            try {
+                $response->setData($registration->createUser($userName, $fullName, $email, $isVisible));
+            } catch (Exception | TransportExceptionInterface $exception) {
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => $exception->getMessage()]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_sendMail')]);
+        }
+        break;
+    case 'add-voting':
+        $faq = new Faq($faqConfig);
+        $rating = new Rating($faqConfig);
+        $faqId = Filter::filterVar($postData['id'] ?? null, FILTER_VALIDATE_INT, 0);
+        $vote = Filter::filterVar($postData['value'], FILTER_VALIDATE_INT);
+        $userIp = Filter::filterVar($request->server->get('REMOTE_ADDR'), FILTER_VALIDATE_IP);
+        if (isset($vote) && $rating->check($faqId, $userIp) && $vote > 0 && $vote < 6) {
+            try {
+                $faqSession->userTracking('save_voting', $faqId);
+            } catch (Exception) {
+            }
+            $votingData = [
+                'record_id' => $faqId,
+                'vote' => $vote,
+                'user_ip' => $userIp,
+            ];
+            if (!$rating->getNumberOfVotings($faqId)) {
+                $rating->addVoting($votingData);
+            } else {
+                $rating->update($votingData);
+            }
+            $response->setStatusCode(Response::HTTP_OK);
+            $response->setData([
+                'success' => Translation::get('msgVoteThanks'),
+                'rating' => $rating->getVotingResult($faqId),
+            ]);
+        } elseif (!$rating->check($faqId, $userIp)) {
+            try {
+                $faqSession->userTracking('error_save_voting', $faqId);
+            } catch (Exception $exception) {
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => $exception->getMessage()]);
+            }
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_VoteTooMuch')]);
+        } else {
+            try {
+                $faqSession->userTracking('error_save_voting', $faqId);
+            } catch (Exception $exception) {
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => $exception->getMessage()]);
+            }
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_noVote')]);
+        }
+        break;
+    case 'submit-contact':
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL);
+        $question = trim((string) Filter::filterVar($postData['question'], FILTER_SANITIZE_SPECIAL_CHARS));
+        if (!$faqConfig->get('main.optionalMailAddress') && is_null($email)) {
+            $email = $faqConfig->getAdminEmail();
+        }
+        if (!empty($author) && !empty($email) && !empty($question) && $stopWords->checkBannedWord($question)) {
+            $question = sprintf(
+                "%s: %s\n%s: %s\n\n %s",
+                Translation::get('msgNewContentName'),
+                $author,
+                Translation::get('msgNewContentMail'),
+                $email,
+                $question
+            );
+            $mailer = new Mail($faqConfig);
+            try {
+                $mailer->setReplyTo($email, $author);
+                $mailer->addTo($faqConfig->getAdminEmail());
+                $mailer->subject = Utils::resolveMarkers('Feedback: %sitename%', $faqConfig);
+                $mailer->message = $question;
+                $mailer->send();
+                unset($mailer);
+                $response->setStatusCode(Response::HTTP_OK);
+                $response->setData(['success' => Translation::get('msgMailContact')]);
+            } catch (Exception | TransportExceptionInterface $e) {
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => $e->getMessage()]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_sendMail')]);
+        }
+        break;
+    case 'sendtofriends':
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL);
+        $attached = trim((string) Filter::filterVar($postData['message'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $mailto = Filter::filterArray($postData['mailto[]']);
+        $faqLanguage = trim((string) Filter::filterVar($postData['lang'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $faqId = trim((string) Filter::filterVar($postData['faqId'], FILTER_VALIDATE_INT));
+        $categoryId = trim((string) Filter::filterVar($postData['categoryId'], FILTER_VALIDATE_INT));
+        if (is_array($mailto) && count($mailto) > 5) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_sendMail')]);
+            break;
+        }
+        if (
+            !is_null($author) && !is_null($email) && is_array($mailto) &&
+            $stopWords->checkBannedWord(Strings::htmlspecialchars($attached))
+        ) {
+            $send2friendLink = sprintf(
+                '%sindex.php?action=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                $faqConfig->getDefaultUrl(),
+                $categoryId,
+                $faqId,
+                urlencode($faqLanguage)
+            );
+            foreach ($mailto as $recipient) {
+                $recipient = trim(strip_tags((string) $recipient));
+                if (!empty($recipient)) {
+                    $mailer = new Mail($faqConfig);
+                    try {
+                        $mailer->setReplyTo($email, $author);
+                        $mailer->addTo($recipient);
+                    } catch (Exception $exception) {
+                        $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                        $response->setData(['error' => $exception->getMessage()]);
+                    }
+                    $mailer->subject = Translation::get('msgS2FMailSubject') . $author;
+                    $mailer->message = sprintf(
+                        "%s\r\n\r\n%s\r\n%s\r\n\r\n%s",
+                        $faqConfig->get('main.send2friendText'),
+                        Translation::get('msgS2FText2'),
+                        $send2friendLink,
+                        strip_tags($attached)
+                    );
+                    $result = $mailer->send();
+                    unset($mailer);
+                    usleep(250);
+                }
+            }
+            $response->setStatusCode(Response::HTTP_OK);
+            $response->setData(['success' => Translation::get('msgS2FThx')]);
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_sendMail')]);
+        }
+        break;
+    case 'submit-user-data':
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $csrfToken = Filter::filterVar($postData[Token::PMF_SESSION_NAME], FILTER_SANITIZE_SPECIAL_CHARS);
+        if (!Token::getInstance()->verifyToken('ucp', $csrfToken)) {
+            $response->setStatusCode(Response::HTTP_UNAUTHORIZED);
+            $response->setData(['error' => Translation::get('ad_msg_noauth')]);
+            break;
+        }
+        $userId = Filter::filterVar($postData['userid'], FILTER_VALIDATE_INT);
+        $userName = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL);
+        $isVisible = Filter::filterVar($postData['is_visible'], FILTER_SANITIZE_SPECIAL_CHARS);
+        $password = trim((string) Filter::filterVar($postData['faqpassword'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $confirm = trim((string) Filter::filterVar($postData['faqpassword_confirm'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $twoFactorEnabled = Filter::filterVar($postData['twofactor_enabled'] ?? 'off', FILTER_SANITIZE_SPECIAL_CHARS);
+        $deleteSecret = Filter::filterVar($postData['newsecret'] ?? '', FILTER_SANITIZE_SPECIAL_CHARS);
+        $user = CurrentUser::getFromSession($faqConfig);
+        $isAzureAdUser = $user->getUserAuthSource() === 'azure';
+        $isLdapUser = $user->getUserAuthSource() === 'ldap';
+        if ($deleteSecret === 'on') {
+            $secret = '';
+        } else {
+            $secret = $user->getUserData('secret');
+        }
+        if ($userId !== $user->getUserId()) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => 'User ID mismatch!']);
+            break;
+        }
+        if (!$isAzureAdUser && !$isLdapUser) {
+            if ($password !== $confirm) {
+                $response->setStatusCode(Response::HTTP_CONFLICT);
+                $response->setData(['error' => Translation::get('ad_user_error_passwordsDontMatch')]);
+                break;
+            }
+            if (strlen($password) <= 7 || strlen($confirm) <= 7) {
+                $response->setStatusCode(Response::HTTP_CONFLICT);
+                $response->setData(['error' => Translation::get('ad_passwd_fail')]);
+                break;
+            } else {
+                $userData = [
+                    'display_name' => $userName,
+                    'email' => $email,
+                    'is_visible' => $isVisible === 'on' ? 1 : 0,
+                    'twofactor_enabled' => $twoFactorEnabled === 'on' ? 1 : 0,
+                    'secret' => $secret
+                ];
+                $success = $user->setUserData($userData);
+                foreach ($user->getAuthContainer() as $auth) {
+                    if ($auth->setReadOnly()) {
+                        continue;
+                    }
+                    if (!$auth->update($user->getLogin(), $password)) {
+                        $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                        $response->setData(['error' => $auth->error()]);
+                        $success = false;
+                    } else {
+                        $success = true;
+                    }
+                }
+            }
+        } else {
+            $userData = [
+                'is_visible' => $isVisible === 'on' ? 1 : 0,
+                'twofactor_enabled' => $twoFactorEnabled === 'on' ? 1 : 0,
+                'secret' => $secret
+            ];
+            $success = $user->setUserData($userData);
+        }
+        if ($success) {
+            $response->setStatusCode(Response::HTTP_OK);
+            $response->setData(['success' => Translation::get('ad_entry_savedsuc')]);
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('ad_entry_savedfail')]);
+        }
+        break;
+    case 'change-password':
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $username = trim((string) Filter::filterVar($postData['username'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));
+        if (!empty($username) && !empty($email)) {
+            $user = new CurrentUser($faqConfig);
+            $loginExist = $user->getUserByLogin($username);
+            if ($loginExist && ($email == $user->getUserData('email'))) {
+                try {
+                    $newPassword = $user->createPassword();
+                } catch (Exception $exception) {
+                    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                    $response->setData(['error' => $exception->getMessage()]);
+                }
+                try {
+                    $user->changePassword($newPassword);
+                } catch (Exception $exception) {
+                    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                    $response->setData(['error' => $exception->getMessage()]);
+                }
+                $text = Translation::get('lostpwd_text_1') . "\nUsername: " . $username . "\nNew Password: " .
+                    $newPassword . "\n\n" . Translation::get('lostpwd_text_2');
+                $mailer = new Mail($faqConfig);
+                try {
+                    $mailer->addTo($email);
+                } catch (Exception $exception) {
+                    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                    $response->setData(['error' => $exception->getMessage()]);
+                }
+                $mailer->subject = Utils::resolveMarkers('[%sitename%] Username / password request', $faqConfig);
+                $mailer->message = $text;
+                try {
+                    $result = $mailer->send();
+                } catch (Exception | TransportExceptionInterface $exception) {
+                    $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                    $response->setData(['error' => $exception->getMessage()]);
+                }
+                unset($mailer);
+                $response->setStatusCode(Response::HTTP_OK);
+                $response->setData(['success' => Translation::get('lostpwd_mail_okay')]);
+            } else {
+                $response->setStatusCode(Response::HTTP_CONFLICT);
+                $response->setData(['error' => Translation::get('lostpwd_err_1')]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_CONFLICT);
+            $response->setData(['error' => Translation::get('lostpwd_err_2')]);
+        }
+        break;
+    case 'submit-request-removal':
+        $postData = json_decode(file_get_contents('php://input'), true, 512, JSON_THROW_ON_ERROR);
+        $csrfToken = Filter::filterVar($postData[Token::PMF_SESSION_NAME], FILTER_SANITIZE_SPECIAL_CHARS);
+        if (!Token::getInstance()->verifyToken('request-removal', $csrfToken)) {
+            $response->setStatusCode(Response::HTTP_UNAUTHORIZED);
+            $response->setData(['error' => Translation::get('ad_msg_noauth')]);
+            break;
+        }
+        $userId = Filter::filterVar($postData['userId'], FILTER_VALIDATE_INT);
+        $author = trim((string) Filter::filterVar($postData['name'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $loginName = trim((string) Filter::filterVar($postData['loginname'], FILTER_SANITIZE_SPECIAL_CHARS));
+        $email = trim((string) Filter::filterVar($postData['email'], FILTER_VALIDATE_EMAIL));
+        $question = trim((string) Filter::filterVar($postData['question'], FILTER_SANITIZE_SPECIAL_CHARS));
+        if (!$faqConfig->get('main.optionalMailAddress') && is_null($email)) {
+            $email = $faqConfig->getAdminEmail();
+        }
+        $user = new User($faqConfig);
+        if (
+            !$user->getUserById($userId) ||
+            $userId !== $user->getUserId() ||
+            $loginName !== $user->getLogin() ||
+            $email !== $user->getUserData('email')
+        ) {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('ad_user_error_loginInvalid')]);
+            break;
+        }
+        if (!empty($author) && !empty($email) && !empty($question) && $stopWords->checkBannedWord($question)) {
+            $question = sprintf(
+                "%s %s\n%s %s\n%s %s\n\n %s",
+                Translation::get('ad_user_loginname'),
+                $loginName,
+                Translation::get('msgNewContentName'),
+                $author,
+                Translation::get('msgNewContentMail'),
+                $email,
+                $question
+            );
+            $mailer = new Mail($faqConfig);
+            try {
+                $mailer->setReplyTo($email, $author);
+                $mailer->addTo($faqConfig->getAdminEmail());
+                $mailer->subject = $faqConfig->getTitle() . ': Remove User Request';
+                $mailer->message = $question;
+                $result = $mailer->send();
+                unset($mailer);
+                $response->setStatusCode(Response::HTTP_OK);
+                $response->setData(['success' => Translation::get('msgMailContact')]);
+            } catch (Exception | TransportExceptionInterface $exception) {
+                $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+                $response->setData(['error' => $exception->getMessage()]);
+            }
+        } else {
+            $response->setStatusCode(Response::HTTP_BAD_REQUEST);
+            $response->setData(['error' => Translation::get('err_sendMail')]);
+        }
+        break;
+}
+$response->send();

--- a/phpmyfaq/ask.php
+++ b//dev/null
@@ -1,77 +0,0 @@
-<?php
-/**
- * Page for adding new questions.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-17
- */
-use phpMyFAQ\Enums\Forms\FormIds;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Forms;
-use phpMyFAQ\Helper\CategoryHelper as HelperCategory;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-if ((-1 === $user->getUserId() && !$faqConfig->get('records.allowQuestionsForGuests'))) {
-    $response = new RedirectResponse($faqConfig->getDefaultUrl() . 'login');
-    $response->send();
-}
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$faqSession->userTracking('ask_question', 0);
-$category->buildCategoryTree();
-$categoryId = Filter::filterVar($request->query->get('category_id'), FILTER_VALIDATE_INT, 0);
-$categoryHelper = new HelperCategory();
-$categoryHelper->setCategory($category);
-$captchaHelper = $container->get('phpmyfaq.captcha.helper.captcha_helper');
-$forms = new Forms($faqConfig);
-$formData = $forms->getFormData(FormIds::ASK_QUESTION->value);
-$categories = $category->getAllCategoryIds();
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./ask.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgQuestion'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgQuestionMetaDesc'), $faqConfig->getTitle()),
-    'msgMatchingQuestions' => Translation::get('msgMatchingQuestions'),
-    'msgFinishSubmission' => Translation::get('msgFinishSubmission'),
-    'lang' => $Language->getLanguage(),
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'renderCategoryOptions' => $categoryHelper->renderOptions($categoryId),
-    'captchaFieldset' =>
-        $captchaHelper->renderCaptcha($captcha, 'ask', Translation::get('msgCaptcha'), $user->isLoggedIn()),
-    'msgNewContentSubmit' => Translation::get('msgNewContentSubmit'),
-    'noCategories' => empty($categories),
-    'msgFormDisabledDueToMissingCategories' => Translation::get('msgFormDisabledDueToMissingCategories')
-];
-foreach ($formData as $input) {
-    if ((int)$input->input_active !== 0) {
-        $label = sprintf('id%d_label', (int)$input->input_id);
-        $required = sprintf('id%d_required', (int)$input->input_id);
-        $templateVars = [
-            ...$templateVars,
-            $label => $input->input_label,
-            $required => ((int)$input->input_required !== 0) ? 'required' : ''
-        ];
-    }
-}
-return $templateVars;

--- a/phpmyfaq/assets/src/configuration/update.js
+++ b//dev/null
@@ -1,147 +0,0 @@
-/**
- * Update functions
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-10-22
- */
-export const handleUpdateNextStepButton = () => {
-  const nextStepButton = document.getElementById('phpmyfaq-update-next-step-button');
-  const nextStep = document.getElementById('phpmyfaq-update-next-step');
-  if (nextStepButton && nextStep) {
-    nextStepButton.addEventListener('click', (event) => {
-      event.preventDefault();
-      window.location.replace(`?step=${nextStep.value}`);
-    });
-  }
-};
-export const handleUpdateInformation = async () => {
-  if (window.location.href.endsWith('/update/')) {
-    const installedVersion = document.getElementById('phpmyfaq-update-installed-version');
-    try {
-      const response = await fetch('../api/setup/check', {
-        method: 'POST',
-        headers: {
-          Accept: 'application/json, text/plain, */*',
-          'Content-Type': 'application/json',
-        },
-        body: installedVersion.value,
-      });
-      if (!response.ok) {
-        let errorMessage = await response.json();
-        throw new Error(errorMessage.message);
-      }
-      const button = document.getElementById('phpmyfaq-update-next-step-button');
-      const alert = document.getElementById('phpmyfaq-update-check-success');
-      alert.classList.remove('d-none');
-      button.classList.remove('disabled');
-      button.disabled = false;
-    } catch (errorMessage) {
-      if (errorMessage instanceof SyntaxError) {
-        errorMessage =
-          'The requested resource was not found on the server. ' +
-          'Please check your server configuration, especially the RewriteBase in your .htaccess configuration.';
-      } else {
-        errorMessage = errorMessage.message;
-      }
-      const alert = document.getElementById('phpmyfaq-update-check-alert');
-      const alertResult = document.getElementById('phpmyfaq-update-check-result');
-      alert.classList.remove('d-none');
-      alertResult.innerText = errorMessage;
-    }
-  }
-};
-export const handleConfigBackup = async () => {
-  if (window.location.href.endsWith('/update/?step=2')) {
-    const installedVersion = document.getElementById('phpmyfaq-update-installed-version');
-    try {
-      const response = await fetch('../api/setup/backup', {
-        method: 'POST',
-        headers: {
-          Accept: 'application/json, text/plain, */*',
-          'Content-Type': 'application/json',
-        },
-        body: installedVersion.value,
-      });
-      if (!response.ok) {
-        throw new Error('Network response was not ok');
-      }
-      const data = await response.json();
-      const downloadLink = document.getElementById('phpmyfaq-update-backup-download-link');
-      downloadLink.href = data.backupFile;
-    } catch (error) {
-      const errorMessage =
-        error.cause && error.cause.response ? await error.cause.response.json() : { error: 'Unknown error' };
-      return errorMessage.error;
-    }
-  }
-};
-export const handleDatabaseUpdate = async () => {
-  if (window.location.href.endsWith('/update/?step=3')) {
-    const installedVersion = document.getElementById('phpmyfaq-update-installed-version');
-    try {
-      const response = await fetch('../api/setup/update-database', {
-        method: 'POST',
-        headers: {
-          Accept: 'application/json, text/plain, */*',
-          'Content-Type': 'application/json',
-        },
-        body: installedVersion.value,
-      });
-      const progressBarInstallation = document.getElementById('result-update');
-      const reader = response.body.getReader();
-      async function pump() {
-        const { done, value } = await reader.read();
-        const decodedValue = new TextDecoder().decode(value);
-        if (done) {
-          progressBarInstallation.style.width = '100%';
-          progressBarInstallation.innerText = '100%';
-          progressBarInstallation.classList.remove('progress-bar-animated');
-          const alert = document.getElementById('phpmyfaq-update-database-success');
-          alert.classList.remove('d-none');
-          return;
-        } else {
-          let value;
-          try {
-            value = JSON.parse(decodedValue);
-          } catch (error) {
-            console.error('Failed to parse JSON:', error);
-            const alert = document.getElementById('phpmyfaq-update-database-error');
-            const errorMessage = document.getElementById('error-messages');
-            alert.classList.remove('d-none');
-            errorMessage.innerText = `Error: ${error.message}\nFull Error: ${decodedValue}`;
-            return;
-          }
-          if (value.progress) {
-            progressBarInstallation.style.width = value.progress;
-            progressBarInstallation.innerText = value.progress;
-          }
-          if (value.error) {
-            progressBarInstallation.style.width = '100%';
-            progressBarInstallation.innerText = '100%';
-            progressBarInstallation.classList.remove('progress-bar-animated');
-            const alert = document.getElementById('phpmyfaq-update-database-error');
-            const errorMessage = document.getElementById('error-messages');
-            alert.classList.remove('d-none');
-            errorMessage.innerHTML = value.error;
-            return;
-          }
-        }
-        await pump();
-      }
-      await pump();
-    } catch (error) {
-      console.error('Error details:', error);
-      const alert = document.getElementById('phpmyfaq-update-database-error');
-      alert.classList.remove('d-none');
-      alert.innerText = `Error: ${error.message}`;
-    }
-  }
-};

--- a/phpmyfaq/attachment.php
+++ b//dev/null
@@ -1,102 +0,0 @@
-<?php
-/**
- * Handle attachment downloads.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package phpMyFAQ
- * @author Anatoliy Belsky <ab@php.net>
- * @copyright 2009-2024 phpMyFAQ Team
- * @license https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link https://www.phpmyfaq.de
- * @since 2009-06-23
- */
-use phpMyFAQ\Attachment\AttachmentException;
-use phpMyFAQ\Attachment\AttachmentFactory;
-use phpMyFAQ\Faq\Permission;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Permission\MediumPermission;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\Config\FileLocator;
-use Symfony\Component\DependencyInjection\ContainerBuilder;
-use Symfony\Component\DependencyInjection\Loader\PhpFileLoader;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-set_time_limit(0);
-if (headers_sent()) {
-    die();
-}
-$attachmentErrors = [];
-$container = new ContainerBuilder();
-$loader = new PhpFileLoader($container, new FileLocator(__DIR__));
-try {
-    $loader->load('src/services.php');
-} catch (\Exception $e) {
-    echo $e->getMessage();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$request = Request::createFromGlobals();
-$user = $container->get('phpmyfaq.user.current_user');
-$id = Filter::filterVar($request->query->get('id'), FILTER_VALIDATE_INT);
-$faqPermission = new Permission($faqConfig);
-$userPermission = [];
-$groupPermission = [];
-try {
-    $attachment = AttachmentFactory::create($id);
-    $userPermission = $faqPermission->get(Permission::USER, $attachment->getRecordId());
-    $groupPermission = $faqPermission->get(Permission::GROUP, $attachment->getRecordId());
-} catch (AttachmentException $attachmentException) {
-    $attachmentErrors[] = Translation::get('msgAttachmentInvalid') . ' (' . $attachmentException->getMessage() . ')';
-}
-if ($user->perm instanceof MediumPermission) {
-    if ($groupPermission !== []) {
-        foreach ($user->perm->getUserGroups($user->getUserId()) as $userGroups) {
-            if (in_array($userGroups, $groupPermission)) {
-                $groupPermission = true;
-                break;
-            }
-        }
-    } else {
-        $groupPermission = false;
-    }
-} else {
-    $groupPermission = true;
-}
-$userPermission = in_array($user->getUserId(), $userPermission);
-$permission = [];
-if ($user->isLoggedIn()) {
-    $allRights = $user->perm->getAllRightsData();
-    foreach ($allRights as $right) {
-        $permission[$right['name']] = false;
-    }
-    $allUserRights = $user->perm->getAllUserRights($user->getUserId());
-    foreach ($allRights as $allRight) {
-        if (in_array($allRight['right_id'], $allUserRights)) {
-            $permission[$allRight['name']] = true;
-        }
-    }
-}
-if (
-    $attachment && $attachment->getRecordId() > 0 && ($faqConfig->get('records.allowDownloadsForGuests') ||
-        (($groupPermission || ($groupPermission && $userPermission)) && isset($permission['dlattachment'])))
-) {
-    try {
-        $attachment->rawOut();
-    } catch (AttachmentException|ErrorException $e) {
-        $attachmentErrors[] = $e->getMessage();
-    }
-} else {
-    $attachmentErrors[] = Translation::get('msgAttachmentInvalid');
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./attachment.twig');
-$templateVars = [
-    'attachmentErrors' => $attachmentErrors,
-];
-return $templateVars;

--- a/phpmyfaq/bookmarks.php
+++ b//dev/null
@@ -1,43 +0,0 @@
-<?php
-/**
- * Shows the page with the user's bookmarks.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Jan Harms <model_railroader@gmx-topmail.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-07-20
- */
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Bookmark;
-use phpMyFAQ\Translation;
-use phpMyFAQ\Session\Token;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-if ($user->isLoggedIn()) {
-    $bookmark = new Bookmark($faqConfig, $user);
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-    $twigTemplate = $twig->loadTemplate('./bookmarks.twig');
-    $templateVars = [
-        ... $templateVars,
-        'title' => sprintf('%s - %s', Translation::get('msgBookmarks'), $faqConfig->getTitle()),
-        'bookmarksList' => $bookmark->getBookmarkList(),
-        'csrfTokenDeleteBookmark' => Token::getInstance()->getTokenString('delete-bookmark'),
-        'csrfTokenDeleteAllBookmarks' => Token::getInstance()->getTokenString('delete-all-bookmarks')
-    ];
-    return $templateVars;
-} else {
-    $response = new RedirectResponse($faqConfig->getDefaultUrl());
-    $response->send();
-}

--- a/phpmyfaq/contact.php
+++ b//dev/null
@@ -1,49 +0,0 @@
-<?php
-/**
- * Contact page.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-16
- */
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('contact', 0);
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$captchaHelper = $container->get('phpmyfaq.captcha.helper.captcha_helper');
-if ($faqConfig->get('layout.contactInformationHTML')) {
-    $contactText = html_entity_decode((string) $faqConfig->get('main.contactInformation'));
-} else {
-    $contactText = nl2br($faqConfig->get('main.contactInformation'));
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./contact.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgContact'), $faqConfig->getTitle()),
-    'msgContactOwnText' => $contactText,
-    'privacyURL' => $faqConfig->get('main.privacyURL'),
-    'lang' => $Language->getLanguage(),
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'version' => $faqConfig->getVersion(),
-    'captchaFieldset' =>
-        $captchaHelper->renderCaptcha($captcha, 'contact', Translation::get('msgCaptcha'), $user->isLoggedIn()),
-];
-return $templateVars;

--- a/phpmyfaq/faq.php
+++ b//dev/null
@@ -1,299 +0,0 @@
-<?php
-/**
- * Shows the page with the FAQ record and - when available - the user comments.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Lars Tiedemann <larstiedemann@yahoo.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-08-27
- */
-use League\CommonMark\CommonMarkConverter;
-use phpMyFAQ\Attachment\AttachmentException;
-use phpMyFAQ\Attachment\AttachmentFactory;
-use phpMyFAQ\Captcha\Helper\CaptchaHelper;
-use phpMyFAQ\Comments;
-use phpMyFAQ\Date;
-use phpMyFAQ\Entity\CommentType;
-use phpMyFAQ\Entity\SeoEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\SeoType;
-use phpMyFAQ\Faq\Permission;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Glossary;
-use phpMyFAQ\Helper\AttachmentHelper;
-use phpMyFAQ\Helper\CommentHelper;
-use phpMyFAQ\Helper\FaqHelper as HelperFaq;
-use phpMyFAQ\Helper\SearchHelper;
-use phpMyFAQ\Link;
-use phpMyFAQ\Rating;
-use phpMyFAQ\Relation;
-use phpMyFAQ\Search\SearchResultSet;
-use phpMyFAQ\Seo;
-use phpMyFAQ\Services;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Tags;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use phpMyFAQ\Utils;
-use phpMyFAQ\Visits;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$glossary = new Glossary($faqConfig);
-$tagging = new Tags($faqConfig);
-$relation = new Relation($faqConfig);
-$rating = new Rating($faqConfig);
-$comment = new Comments($faqConfig);
-$faqHelper = new HelperFaq($faqConfig);
-$faqPermission = new Permission($faqConfig);
-$seo = new Seo($faqConfig);
-$attachmentHelper = new AttachmentHelper();
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$converter = new CommonMarkConverter([
-    'html_input' => 'strip',
-    'allow_unsafe_links' => false,
-]);
-if (is_null($user)) {
-    $user = new CurrentUser($faqConfig);
-}
-$templateVars = [
-    ... $templateVars
-];
-$faqSearchResult = new SearchResultSet($user, $faqPermission, $faqConfig);
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$currentCategory = $cat;
-$request = Request::createFromGlobals();
-$faqId = Filter::filterVar($request->query->get('id'), FILTER_VALIDATE_INT, 0);
-$solutionId = Filter::filterVar($request->query->get('solution_id'), FILTER_VALIDATE_INT);
-$highlight = Filter::filterVar($request->query->get('highlight'), FILTER_SANITIZE_SPECIAL_CHARS);
-$bookmarkAction = Filter::filterVar($request->query->get('bookmark_action'), FILTER_SANITIZE_SPECIAL_CHARS);
-$bookmark = $container->get('phpmyfaq.bookmark');
-if ($bookmarkAction === 'add' && isset($faqId)) {
-    $bookmark->add($faqId);
-}
-if ($bookmarkAction === 'remove' && isset($faqId)) {
-    $bookmark->remove($faqId);
-}
-if (0 === (int)$solutionId) {
-    $faq->getFaq($faqId);
-} else {
-    $faq->getFaqBySolutionId($solutionId);
-}
-if (isset($faq->faqRecord['id'])) {
-    $faqId = $faq->faqRecord['id'];
-}
-$faqSession->userTracking('article_view', $faqId);
-$faqVisits = new Visits($faqConfig);
-$faqVisits->logViews((int) $faqId);
-$question = $faq->getQuestion($faqId);
-if ($faqConfig->get('main.enableMarkdownEditor')) {
-    $answer = $converter->convert($faq->faqRecord['content'])->getContent();
-} else {
-    $answer = $faqHelper->rewriteLanguageMarkupClass($faq->faqRecord['content']);
-}
-$answer = $faqHelper->cleanUpContent($answer);
-$currentUrl = sprintf('//%s%s', $request->getHost(), $request->getRequestUri());
-$answer = $faqHelper->rewriteUrlFragments($answer, $currentUrl);
-$answer = $glossary->insertItemsIntoContent($answer);
-$categoryName = $category->getPath($currentCategory, ' &raquo; ', true);
-if (
-    !is_null($highlight) && $highlight != '/' && $highlight != '<' && $highlight != '>' && Strings::strlen(
-        $highlight
-    ) > 3
-) {
-    $highlight = str_replace("'", '', (string) $highlight);
-    $highlight = str_replace(['^', '.', '?', '*', '+', '{', '}', '(', ')', '[', ']'], '', $highlight);
-    $highlight = preg_quote($highlight, '/');
-    $searchItems = explode(' ', $highlight);
-    foreach ($searchItems as $searchItem) {
-        if (Strings::strlen($searchItem) > 2) {
-            $question = Utils::setHighlightedString($question, $searchItem);
-            $answer = Utils::setHighlightedString($answer, $searchItem);
-        }
-    }
-}
-if ($faqConfig->get('records.disableAttachments') && 'yes' == $faq->faqRecord['active']) {
-    try {
-        $attList = AttachmentFactory::fetchByRecordId($faqConfig, $faqId);
-        $answer .= $attachmentHelper->renderAttachmentList($attList);
-    } catch (AttachmentException) {
-    }
-}
-$renderedCategoryPath = '';
-$multiCategories = $category->getCategoriesFromFaq($faqId);
-if ((is_countable($multiCategories) ? count($multiCategories) : 0) > 1) {
-    foreach ($multiCategories as $multiCategory) {
-        $path = $category->getPath($multiCategory['id'], ' &raquo; ', true, 'breadcrumb-related-categories');
-        if ('' === trim($path)) {
-            continue;
-        }
-        $renderedCategoryPath .= $path;
-    }
-}
-try {
-    $faqSearchResult->reviewResultSet(
-        $relation->getAllRelatedByQuestion($faq->faqRecord['title'], $faq->faqRecord['keywords'])
-    );
-} catch (Exception) {
-}
-$searchHelper = new SearchHelper($faqConfig);
-$relatedFaqs = $searchHelper->renderRelatedFaqs($faqSearchResult, $faqId);
-$expired = (date('YmdHis') > $faq->faqRecord['dateEnd']);
-$numComments = $comment->getNumberOfComments();
-$comments = $comment->getCommentsData($faqId, CommentType::FAQ);
-$commentHelper = new CommentHelper();
-$commentHelper->setConfiguration($faqConfig);
-if (
-    (-1 === $user->getUserId() && !$faqConfig->get('records.allowCommentsForGuests')) ||
-    ($faq->faqRecord['active'] === 'no') || ('n' === $faq->faqRecord['comment']) || $expired
-) {
-    $commentMessage = Translation::get('msgWriteNoComment');
-} else {
-    $commentMessage = sprintf(
-        '%s<a href="#" data-bs-toggle="modal" data-bs-target="#pmf-modal-add-comment">%s</a>',
-        Translation::get('msgYouCan'),
-        Translation::get('msgWriteComment')
-    );
-    $templateVars = [
-        ... $templateVars,
-        'numberOfComments' => sprintf('%d %s', $numComments[$faqId] ?? 0, Translation::get('ad_start_comments')),
-        'writeCommentMsg' => $commentMessage
-    ];
-}
-if (-1 !== $user->getUserId()) {
-    $templateVars = [
-        ...$templateVars,
-        'bookmarkIcon' => $bookmark->isFaqBookmark($faqId) ? 'bi bi-bookmark-fill' : 'bi bi-bookmark',
-        'msgAddBookmark' =>
-            $bookmark->isFaqBookmark($faqId) ? Translation::get('removeBookmark') : Translation::get('msgAddBookmark'),
-        'isFaqBookmark' => $bookmark->isFaqBookmark($faqId)
-    ];
-}
-$availableLanguages = $faqConfig->getLanguage()->isLanguageAvailable($faq->faqRecord['id']);
-if (!empty($availableLanguages) && (is_countable($availableLanguages) ? count($availableLanguages) : 0) > 1) {
-    $templateVars = [
-        ...$templateVars,
-        'msgChangeLanguage' => Translation::get('msgLanguageSubmit')
-    ];
-}
-if (
-    $user->perm->hasPermission($user->getUserId(), PermissionType::FAQ_EDIT->value) &&
-    !empty($faq->faqRecord['notes'])
-) {
-    $templateVars = [
-        ...$templateVars,
-        'notesHeader' => Translation::get('ad_admin_notes'),
-        'notes' => $faq->faqRecord['notes']
-    ];
-}
-if ('-' !== $tagging->getAllLinkTagsById($faqId)) {
-    $templateVars = [
-        ...$templateVars,
-        'renderTagsHeader' => Translation::get('msg_tags'),
-        'renderTags' =>  $tagging->getAllLinkTagsById($faqId),
-    ];
-}
-if ('' !== $renderedCategoryPath) {
-    $templateVars = [
-        ...$templateVars,
-        'renderRelatedCategoriesHeader' => Translation::get('msgArticleCategories'),
-        'renderRelatedCategories' => $renderedCategoryPath,
-    ];
-}
-if ('' !== $relatedFaqs) {
-    $templateVars = [
-        ...$templateVars,
-        'renderRelatedArticlesHeader' => Translation::get('msg_related_articles'),
-        'renderRelatedArticles' => $relatedFaqs,
-    ];
-}
-$date = new Date($faqConfig);
-$captchaHelper = CaptchaHelper::getInstance($faqConfig);
-$faqServices = new Services($faqConfig);
-$faqServices->setCategoryId($cat);
-$faqServices->setFaqId($id);
-$faqServices->setLanguage($lang);
-$faqServices->setQuestion($faq->getQuestion($id));
-if (!$category->categoryHasLinkToFaq($faqId, $currentCategory)) {
-    $response = new Response();
-    $response->setStatusCode(Response::HTTP_NOT_FOUND);
-}
-$author = $user->getUserVisibilityByEmail($faq->faqRecord['email']) ? $faq->faqRecord['author'] : 'n/a';
-$seoEntity = new SeoEntity();
-$seoEntity
-    ->setType(SeoType::FAQ)
-    ->setReferenceId($faq->faqRecord['id'])
-    ->setReferenceLanguage($faq->faqRecord['lang']);
-$seoData = $seo->get($seoEntity);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./faq.twig');
-$templateVars = [
-    ...$templateVars,
-    'title' => sprintf('%s - %s', $seoData->getTitle() ?? $question, $faqConfig->getTitle()),
-    'metaDescription' => $seoData->getDescription(),
-    'solutionId' => $faq->faqRecord['solution_id'],
-    'solutionIdLink' => Link::getSystemRelativeUri() . '?solution_id=' . $faq->faqRecord['solution_id'],
-    'question' => $question,
-    'answer' => $answer,
-    'faqDate' => $date->format($faq->faqRecord['date']),
-    'faqAuthor' => Strings::htmlentities($author),
-    'msgPdf' => Translation::get('msgPDF'),
-    'msgPrintFaq' => Translation::get('msgPrintArticle'),
-    'enableSendToFriend' => $faqConfig->get('main.enableSendToFriend'),
-    'msgShareText' => Translation::get('msgShareText'),
-    'msgShareViaWhatsapp' => Translation::get('msgShareViaWhatsapp'),
-    'msgSend2Friend' => Translation::get('msgSend2Friend'),
-    'linkToPdf' => $faqServices->getPdfLink(),
-    'msgAverageVote' => Translation::get('msgAverageVote'),
-    'renderVotingResult' => $rating->get($faqId),
-    'switchLanguage' => $faqHelper->renderChangeLanguageSelector($faq, $currentCategory),
-    'msgVoteBad' => Translation::get('msgVoteBad'),
-    'msgVoteGood' => Translation::get('msgVoteGood'),
-    'msgVoteSubmit' => Translation::get('msgVoteSubmit'),
-    'msgWriteComment' => Translation::get('msgWriteComment'),
-    'id' => $faqId,
-    'lang' => $lang,
-    'msgCommentHeader' => Translation::get('msgCommentHeader'),
-    'msgNewContentName' => Translation::get('msgNewContentName'),
-    'msgNewContentMail' => Translation::get('msgNewContentMail'),
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'msgYourComment' => Translation::get('msgYourComment'),
-    'msgCancel' => Translation::get('ad_gen_cancel'),
-    'msgNewContentSubmit' => Translation::get('msgNewContentSubmit'),
-    'csrfTokenAddComment' => Token::getInstance()->getTokenString('add-comment'),
-    'captchaFieldset' => $captchaHelper->renderCaptcha(
-        $captcha,
-        'writecomment',
-        Translation::get('msgCaptcha'),
-        $user->isLoggedIn()
-    ),
-    'renderComments' => $commentHelper->getComments($comments),
-    'msg_about_faq' => Translation::get('msg_about_faq'),
-    'userId' => $user->getUserId(),
-    'permissionEditFaq' => $user->perm->hasPermission($user->getUserId(), PermissionType::FAQ_EDIT->value),
-    'ad_entry_edit_1' => Translation::get('ad_entry_edit_1'),
-    'ad_entry_edit_2' => Translation::get('ad_entry_edit_2'),
-    'bookmarkAction' => $bookmarkAction ?? '',
-    'msgBookmarkAdded' => Translation::get('msgBookmarkAdded'),
-    'msgBookmarkRemoved' => Translation::get('msgBookmarkRemoved'),
-    'csrfTokenRemoveBookmark' => Token::getInstance()->getTokenString('delete-bookmark'),
-    'csrfTokenAddBookmark' => Token::getInstance()->getTokenString('add-bookmark')
-];
-return $templateVars;

--- a/phpmyfaq/glossary.php
+++ b//dev/null
@@ -1,59 +0,0 @@
-<?php
-/**
- * This is the page there a user can view all glossary items.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-09-03
- */
-use phpMyFAQ\Filter;
-use phpMyFAQ\Glossary;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('glossary', 0);
-$request = Request::createFromGlobals();
-$page = Filter::filterVar($request->query->get('page'), FILTER_VALIDATE_INT, 1);
-$glossary = new Glossary($faqConfig);
-$glossaryItems = $glossary->fetchAll();
-$numItems = is_countable($glossaryItems) ? count($glossaryItems) : 0;
-$itemsPerPage = 8;
-$baseUrl = sprintf(
-    '%sindex.php?action=glossary&amp;page=%d',
-    $faqConfig->getDefaultUrl(),
-    $page
-);
-$options = [
-    'baseUrl' => $baseUrl,
-    'total' => is_countable($glossaryItems) ? count($glossaryItems) : 0,
-    'perPage' => $itemsPerPage,
-    'pageParamName' => 'page',
-];
-$pagination = new Pagination($options);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./glossary.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('ad_menu_glossary'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgGlossaryMetaDesc'), $faqConfig->getTitle()),
-    'pageHeader' => Translation::get('ad_menu_glossary'),
-    'glossaryItems' => array_slice($glossaryItems, ($page - 1) * $itemsPerPage, $itemsPerPage),
-    'pagination' => $pagination->render(),
-];
-return $templateVars;

--- a/phpmyfaq/login.php
+++ b//dev/null
@@ -1,55 +0,0 @@
-<?php
-/**
- * This is the page there a user can log in.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-02-12
- */
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('login', 0);
-$loginMessage = '';
-if (!is_null($error)) {
-    $loginMessage = '<div class="alert alert-danger" role="alert">' . $error . '</div>';
-}
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./login.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgLoginUser'), $faqConfig->getTitle()),
-    'loginHeader' => Translation::get('msgLoginUser'),
-    'sendPassword' => Translation::get('lostPassword'),
-    'loginMessage' => $loginMessage,
-    'writeLoginPath' => $faqConfig->getDefaultUrl(),
-    'faqloginaction' => $action,
-    'login' => Translation::get('ad_auth_ok'),
-    'username' => Translation::get('ad_auth_user'),
-    'password' => Translation::get('ad_auth_passwd'),
-    'rememberMe' => Translation::get('rememberMe'),
-    'msgTwofactorEnabled' => Translation::get('msgTwofactorEnabled'),
-    'msgTwofactorTokenModelTitle' => Translation::get('msgTwofactorTokenModelTitle'),
-    'msgEnterTwofactorToken' => Translation::get('msgEnterTwofactorToken'),
-    'msgTwofactorCheck' => Translation::get('msgTwofactorCheck'),
-    'userid' => $userId,
-    'enableRegistration' => $faqConfig->get('security.enableRegistration'),
-    'registerUser' => Translation::get('msgRegistration'),
-    'useSignInWithMicrosoft' => $faqConfig->isSignInWithMicrosoftActive(),
-    'isWebAuthnEnabled' => $faqConfig->get('security.enableWebAuthnSupport'),
-];
-return $templateVars;

--- a/phpmyfaq/news.php
+++ b//dev/null
@@ -1,132 +0,0 @@
-<?php
-/**
- * Shows the page with the news record and - when available - the user
- * comments.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Matteo Scaramuccia <matteo@scaramuccia.com>
- * @copyright 2006-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2006-07-23
- */
-use phpMyFAQ\Captcha\Helper\CaptchaHelper;
-use phpMyFAQ\Comments;
-use phpMyFAQ\Date;
-use phpMyFAQ\Entity\CommentType;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Glossary;
-use phpMyFAQ\Helper\CommentHelper;
-use phpMyFAQ\Helper\FaqHelper;
-use phpMyFAQ\News;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$comment = new Comments($faqConfig);
-$request = Request::createFromGlobals();
-$newsId = Filter::filterVar($request->query->get('newsid'), FILTER_VALIDATE_INT);
-$oNews = new News($faqConfig);
-$faqSession->userTracking('news_view', $newsId);
-$newsMainHeader = $faqConfig->getTitle() . Translation::get('msgNews');
-$news = $oNews->get($newsId);
-$newsContent = $news['content'];
-$newsHeader = $news['header'];
-$oGlossary = new Glossary($faqConfig);
-$newsContent = $oGlossary->insertItemsIntoContent($newsContent ?? '');
-$newsHeader = $oGlossary->insertItemsIntoContent($newsHeader ?? '');
-$helper = new FaqHelper($faqConfig);
-$newsContent = $helper->cleanUpContent($newsContent);
-if (strlen((string) $news['link']) > 0) {
-    $newsContent .= sprintf(
-        '</p><p>%s<a href="%s" target="%s">%s</a>',
-        Translation::get('msgInfo'),
-        Strings::htmlentities($news['link']),
-        $news['target'],
-        Strings::htmlentities($news['linkTitle'])
-    );
-}
-$editThisEntry = '';
-if ($user->perm->hasPermission($user->getUserId(), PermissionType::NEWS_EDIT)) {
-    $editThisEntry = sprintf(
-        '<a href="./admin/index.php?action=news&amp;do=edit&amp;id=%d">%s</a>',
-        $newsId,
-        Translation::get('ad_menu_news_edit')
-    );
-}
-if (
-    (-1 === $user->getUserId() && !$faqConfig->get('records.allowCommentsForGuests')) ||
-    (!$news['active']) || (!$news['allowComments'])
-) {
-    $commentMessage = Translation::get('msgWriteNoComment');
-} else {
-    $commentMessage = sprintf(
-        '<a href="#" data-bs-toggle="modal" data-bs-target="#pmf-modal-add-comment">%s</a>',
-        Translation::get('newsWriteComment')
-    );
-}
-if ($news['active']) {
-    $date = new Date($faqConfig);
-    $newsDate = sprintf(
-        '%s<span id="newsLastUpd">%s</span>',
-        Translation::get('msgLastUpdateArticle'),
-        $date->format($news['date'])
-    );
-} else {
-    $newsDate = '';
-}
-$captchaHelper = CaptchaHelper::getInstance($faqConfig);
-$commentHelper = new CommentHelper();
-$commentHelper->setConfiguration($faqConfig);
-$comment = new Comments($faqConfig);
-$comments = $comment->getCommentsData($newsId, CommentType::NEWS);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./news.twig');
-$templateVars = [
-    ... $templateVars,
-    'writeNewsHeader' => $newsMainHeader,
-    'newsHeader' => $newsHeader,
-    'mainPageContent' => $newsContent,
-    'writeDateMsg' => $newsDate,
-    'msgAboutThisNews' => Translation::get('msgAboutThisNews'),
-    'writeAuthor' => ($news['active']) ? Translation::get('msgAuthor') . ': ' . $news['authorName'] : '',
-    'editThisEntry' => $editThisEntry,
-    'writeCommentMsg' => $commentMessage,
-    'msgWriteComment' => Translation::get('newsWriteComment'),
-    'newsId' => $newsId,
-    'newsLang' => $news['lang'],
-    'msgCommentHeader' => Translation::get('msgCommentHeader'),
-    'msgNewContentName' => Translation::get('msgNewContentName'),
-    'msgNewContentMail' => Translation::get('msgNewContentMail'),
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'msgYourComment' => Translation::get('msgYourComment'),
-    'csrfInput' => Token::getInstance()->getTokenInput('add-comment'),
-    'msgCancel' => Translation::get('ad_gen_cancel'),
-    'msgNewContentSubmit' => Translation::get('msgNewContentSubmit'),
-    'captchaFieldset' => $captchaHelper->renderCaptcha(
-        $captcha,
-        'writecomment',
-        Translation::get('msgCaptcha'),
-        $user->isLoggedIn()
-    ),
-    'renderComments' => $commentHelper->getComments($comments),
-];
-return $templateVars;

--- a/phpmyfaq/open-questions.php
+++ b//dev/null
@@ -1,51 +0,0 @@
-<?php
-/**
- * Open questions frontend.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-17
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Helper\QuestionHelper;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('open_questions', 0);
-$category = new Category($faqConfig);
-$questionHelper = new QuestionHelper();
-$questionHelper
-    ->setConfiguration($faqConfig)
-    ->setCategory($category);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./open-questions.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgOpenQuestions'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgOpenQuestionsMetaDesc'), $faqConfig->getTitle()),
-    'pageHeader' => Translation::get('msgOpenQuestions'),
-    'msgQuestionText' => Translation::get('msgQuestionText'),
-    'msgDate_User' => Translation::get('msgDate_User'),
-    'msgQuestion2' => Translation::get('msgQuestion2'),
-    'openQuestions' => $questionHelper->getOpenQuestions(),
-    'isCloseQuestionEnabled' => $faqConfig->get('records.enableCloseQuestion'),
-    'msgQuestionsWaiting' => Translation::get('msgQuestionsWaiting'),
-    'msgNoQuestionsAvailable' => Translation::get('msgNoQuestionsAvailable'),
-    'msg2answerFAQ' => Translation::get('msg2answerFAQ'),
-    'msg2answer' => Translation::get('msg2answer')
-];
-return $templateVars;

--- a/phpmyfaq/overview.php
+++ b//dev/null
@@ -1,48 +0,0 @@
-<?php
-/**
- * FAQ overview page.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2015-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2015-09-27
- */
-use phpMyFAQ\Helper\FaqHelper;
-use phpMyFAQ\Template\Extensions\CategoryNameTwigExtension;
-use phpMyFAQ\Template\Extensions\CreateLinkTwigExtension;
-use phpMyFAQ\Template\Extensions\FaqTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('overview', 0);
-$faqHelper = new FaqHelper($faqConfig);
-$faq->setUser($user->getUserId());
-$faq->setGroups($currentGroups);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twig->addExtension(new CategoryNameTwigExtension());
-$twig->addExtension(new CreateLinkTwigExtension());
-$twig->addExtension(new FaqTwigExtension());
-$twigTemplate = $twig->loadTemplate('./overview.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('faqOverview'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgOverviewMetaDesc'), $faqConfig->getTitle()),
-    'pageHeader' => Translation::get('faqOverview'),
-    'faqOverview' => $faqHelper->createOverview($category, $faq, $faqLangCode),
-    'msgAuthor' => Translation::get('msgAuthor'),
-    'msgLastUpdateArticle' => Translation::get('msgLastUpdateArticle')
-];
-return $templateVars;

--- a/phpmyfaq/password.php
+++ b//dev/null
@@ -1,30 +0,0 @@
-<?php
-/**
- * This is the page there a user can request a new password.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-03-26
- */
-use phpMyFAQ\Template\TwigWrapper;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->userTracking('forgot_password', 0);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./password.twig');
-$templateVars = [
-    ... $templateVars,
-    'lang' => $faqConfig->getLanguage()->getLanguage(),
-];
-return $templateVars;

--- a/phpmyfaq/register.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/**
- * This module is for user registration.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Elger Thiele <elger@phpmyfaq.de>
- * @copyright 2008-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2008-01-25
- */
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-if (!$faqConfig->get('security.enableRegistration')) {
-    $redirect = new RedirectResponse($faqConfig->getDefaultUrl());
-    $redirect->send();
-}
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('registration', 0);
-$captcha = $container->get('phpmyfaq.captcha');
-$captcha->setSessionId($sids);
-$captchaHelper = $container->get('phpmyfaq.captcha.helper.captcha_helper');
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./register.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgRegistration'), $faqConfig->getTitle()),
-    'lang' => $faqLangCode,
-    'isWebAuthnEnabled' => $faqConfig->get('security.enableWebAuthnSupport'),
-    'captchaFieldset' => $captchaHelper->renderCaptcha(
-        $captcha,
-        'register',
-        Translation::get('msgCaptcha'),
-        $user->isLoggedIn()
-    ),
-];
-return $templateVars;

--- a/phpmyfaq/request-removal.php
+++ b//dev/null
@@ -1,39 +0,0 @@
-<?php
-/**
- * Request removal page.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2018-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2018-02-03
- */
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Template\TwigWrapper;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('request_removal', 0);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./request-removal.twig');
-$templateVars = [
-    ... $templateVars,
-    'privacyURL' => $faqConfig->get('main.privacyURL'),
-    'csrf' => Token::getInstance()->getTokenInput('request-removal'),
-    'lang' => $Language->getLanguage(),
-    'userId' => $user->getUserId(),
-    'defaultContentMail' => ($user->getUserId() > 0) ? $user->getUserData('email') : '',
-    'defaultContentName' => ($user->getUserId() > 0) ? $user->getUserData('display_name') : '',
-    'defaultLoginName' => ($user->getUserId() > 0) ? $user->getLogin() : '',
-];
-return $templateVars;

--- a/phpmyfaq/search.php
+++ b//dev/null
@@ -1,241 +0,0 @@
-<?php
-/**
- * The fulltext search page.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-09-16
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Faq;
-use phpMyFAQ\Faq\Permission;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\CategoryHelper;
-use phpMyFAQ\Helper\SearchHelper;
-use phpMyFAQ\Helper\TagsHelper;
-use phpMyFAQ\Language\Plurals;
-use phpMyFAQ\Pagination;
-use phpMyFAQ\Search;
-use phpMyFAQ\Search\SearchResultSet;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Tags;
-use phpMyFAQ\Template\Extensions\TagNameTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('fulltext_search', 0);
-$faq = new Faq($faqConfig);
-$faq->setUser($currentUser);
-$faq->setGroups($currentGroups);
-$category = new Category($faqConfig);
-$plurals = new Plurals();
-$request = Request::createFromGlobals();
-$inputLanguage = Filter::filterVar($request->query->get('pmf-all-languages'), FILTER_SANITIZE_SPECIAL_CHARS);
-$inputCategory = Filter::filterVar($request->query->get('pmf-search-category'), FILTER_VALIDATE_INT, '%');
-$inputSearchTerm = Filter::filterVar($request->query->get('search'), FILTER_SANITIZE_SPECIAL_CHARS);
-$inputSearchTerm = Strings::substr($inputSearchTerm, 0, 255);
-$inputTag = Filter::filterVar($request->query->get('tagging_id'), FILTER_SANITIZE_SPECIAL_CHARS);
-if (!is_null($inputTag)) {
-    $inputTag = str_replace(' ', '', (string) $inputTag);
-    $inputTag = str_replace(',,', ',', $inputTag);
-}
-$searchTerm = Filter::filterVar($request->request->get('search'), FILTER_SANITIZE_SPECIAL_CHARS);
-$searchTerm = Strings::substr($searchTerm, 0, 255);
-$page = Filter::filterVar($request->query->get('seite'), FILTER_VALIDATE_INT, 1);
-if ($inputLanguage !== '') {
-    $allLanguages = true;
-    $languages = '&amp;langs=all';
-} else {
-    $allLanguages = false;
-    $languages = '';
-}
-if ($allLanguages) {
-    $category->transform(0);
-}
-$faqSearch = new Search($faqConfig);
-$faqPermission = new Permission($faqConfig);
-$faqSearchResult = new SearchResultSet($user, $faqPermission, $faqConfig);
-$tagging = new Tags($faqConfig);
-$tagHelper = new TagsHelper();
-$tagSearch = false;
-if ('' !== $inputTag) {
-    $tagSearch = true;
-    $tags = [];
-    $tagIds = explode(',', (string) $inputTag);
-    $relTags = '';
-    $tagHelper->setTaggingIds($tagIds);
-    foreach ($tagIds as $tagId) {
-        if (isset($tags[$tagId])) {
-            continue;
-        }
-        if (!is_numeric($tagId)) {
-            continue;
-        }
-        $tags[$tagId] = $tagging->getTagNameById($tagId);
-    }
-    $recordIds = $tagging->getFaqsByIntersectionTags($tags);
-    if (0 === (is_countable($recordIds) ? count($recordIds) : 0)) {
-        $searchResult = '';
-    } else {
-        $relatedTags = [];
-        foreach ($recordIds as $recordId) {
-            $resultTags = $tagging->getAllTagsById($recordId);
-            foreach (array_keys($resultTags) as $resultTagId) {
-                if (isset($tags[$resultTagId])) {
-                    continue;
-                }
-                if (isset($relatedTags[$resultTagId])) {
-                    ++$relatedTags[$resultTagId];
-                } else {
-                    $relatedTags[$resultTagId] = 1;
-                }
-            }
-        }
-        uasort($relatedTags, static fn($a, $b) => $b - $a);
-        $numTags = 0;
-        foreach ($relatedTags as $tagId => $relevance) {
-            $relTags .= $tagHelper->renderRelatedTag($tagId, $tagging->getTagNameById($tagId), $relevance);
-            if ($numTags++ > 20) {
-                break;
-            }
-        }
-        $searchResult = $faq->renderFaqsByFaqIds($recordIds);
-    }
-} else {
-    $searchResult = '';
-    $relTags = '';
-    $tags = [];
-}
-if ($inputSearchTerm !== '' || $searchTerm !== '') {
-    $searchResults = [];
-    if ($inputSearchTerm !== '') {
-        $inputSearchTerm = $faqConfig->getDb()->escape(strip_tags($inputSearchTerm));
-    }
-    if ($searchTerm !== '') {
-        $inputSearchTerm = $faqConfig->getDb()->escape(strip_tags($searchTerm));
-    }
-    $faqSearch->setCategory($category);
-    $faqSearch->setCategoryId((int) $inputCategory);
-    try {
-        $searchResults = $faqSearch->search($inputSearchTerm, $allLanguages);
-    } catch (Exception $exception) {
-        $faqConfig->getLogger()->debug($exception->getMessage());
-    }
-    foreach ($searchResults as $faqKey => $faqValue) {
-        $checkedFaq = $faq->getFaqResult($faqValue->id, $faqValue->lang);
-        if (0 === $faqConfig->getDb()->numRows($checkedFaq)) {
-            unset($searchResults[$faqKey]);
-        }
-    }
-    $faqSearchResult->reviewResultSet($searchResults);
-    $inputSearchTerm = stripslashes($inputSearchTerm);
-    try {
-        $faqSearch->logSearchTerm($inputSearchTerm);
-    } catch (Exception $exception) {
-        $faqConfig->getLogger()->debug($exception->getMessage());
-    }
-}
-$inputCategory = ('%' == $inputCategory) ? 0 : $inputCategory;
-$faqSession->userTracking('fulltext_search', $inputSearchTerm);
-$numOfResults = $faqSearchResult->getNumberOfResults();
-if (
-    is_numeric($inputSearchTerm) &&
-    PMF_SOLUTION_ID_START_VALUE <= $inputSearchTerm &&
-    0 < $numOfResults &&
-    $faqConfig->get('search.searchForSolutionId')
-) {
-    $response = new Response();
-    $response->isRedirect($faqConfig->getDefaultUrl() . 'solution_id_' . $inputSearchTerm . '.html');
-    $response->send();
-    exit();
-}
-$category->buildCategoryTree();
-$mostPopularSearchData = $faqSearch->getMostPopularSearches($faqConfig->get('search.numberSearchTerms'));
-$baseUrl = sprintf(
-    '%ssearch.html?search=%s&amp;seite=%d%s&amp;pmf-search-category=%d',
-    $faqConfig->getDefaultUrl(),
-    urlencode($inputSearchTerm),
-    $page,
-    $languages,
-    $inputCategory
-);
-$options = [
-    'baseUrl' => $baseUrl,
-    'total' => $numOfResults,
-    'perPage' => $faqConfig->get('records.numberOfRecordsPerPage'),
-    'pageParamName' => 'seite',
-    'layoutTpl' => '<ul class="pagination justify-content-center">{LAYOUT_CONTENT}</ul>',
-];
-$faqPagination = new Pagination($options);
-$categoryHelper = new CategoryHelper();
-$categoryHelper->setCategory($category);
-$searchHelper = new SearchHelper($faqConfig);
-$searchHelper->setSearchTerm($inputSearchTerm);
-$searchHelper->setCategory($category);
-$searchHelper->setPagination($faqPagination);
-$searchHelper->setPlurals(new Plurals());
-$searchHelper->setSessionId($sids);
-$searchResults = [];
-if ('' == $searchResult && !is_null($inputSearchTerm)) {
-    try {
-        $searchResults = $searchHelper->getSearchResult($faqSearchResult, $page);
-    } catch (Exception) {
-    }
-}
-$confPerPage = $faqConfig->get('records.numberOfRecordsPerPage');
-$totalPages = (int)ceil($numOfResults / $confPerPage);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twig->addExtension(new TagNameTwigExtension());
-$twigTemplate = $twig->loadTemplate('./search.twig');
-$pageHeader = ($tagSearch ? Translation::get('msgTagSearch') : Translation::get('msgAdvancedSearch'));
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', $pageHeader, $faqConfig->getTitle()),
-    'pageHeader' => $pageHeader,
-    'isTagSearch' => $tagSearch,
-    'renderCategoryOptions' => $categoryHelper->renderOptions($inputCategory),
-    'msgSearch' => Translation::get('msgSearch'),
-    'msgAdvancedSearch' => ($tagSearch ? Translation::get('msgTagSearch') : Translation::get('msgAdvancedSearch')),
-    'msgCurrentTags' => Translation::get('msg_tags'),
-    'numberOfSearchResults' => $numOfResults,
-    'totalPages' => $totalPages,
-    'msgPage' => Translation::get('msgPage'),
-    'currentPage' => $page,
-    'from' => Translation::get('msgVoteFrom'),
-    'msgSearchResults' => $plurals->GetMsg('plmsgSearchAmount', $numOfResults),
-    'searchTerm' => $searchTerm,
-    'searchTags' =>  ($tagSearch ? $tagHelper->renderTagList($tags) : ''),
-    'msgSearchWord' => Translation::get('msgSearchWord'),
-    'searchResults' => $searchResults,
-    'formActionUrl' => '?action=search',
-    'searchString' => $inputSearchTerm,
-    'searchOnAllLanguages' => Translation::get('msgSearchOnAllLanguages'),
-    'checkedAllLanguages' => $allLanguages ? ' checked' : '',
-    'selectCategories' => Translation::get('msgSelectCategories'),
-    'allCategories' => Translation::get('msgAllCategories'),
-    'noSearchResults' => Translation::get('msgErrorNoRecords'),
-    'pagination' => $faqPagination->render(),
-    'msgMostPopularSearches' => Translation::get('msgMostPopularSearches'),
-    'mostPopularSearches' => $mostPopularSearchData,
-    'relatedTagsHeader' => Translation::get('msgRelatedTags'),
-    'relatedTags' => $relTags,
-    'msgTags' => Translation::get('msgPopularTags'),
-    'tagList' => $tagging->getPopularTags(),
-];
-return $templateVars;

--- a/phpmyfaq/show.php
+++ b//dev/null
@@ -1,126 +0,0 @@
-<?php
-/**
- * Frontend for categories or list of records.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-08-27
- */
-use phpMyFAQ\Category;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\CategoryHelper;
-use phpMyFAQ\Language\Plurals;
-use phpMyFAQ\Link;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$request = Request::createFromGlobals();
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$selectedCategoryId = Filter::filterVar($request->query->get('cat'), FILTER_VALIDATE_INT);
-$subCategoryContent = null;
-if ($selectedCategoryId === 0) {
-    $selectedCategoryId = null;
-}
-if (!is_null($selectedCategoryId) && !isset($category->categoryName[$selectedCategoryId])) {
-    $response = new Response();
-    $response->setStatusCode(Response::HTTP_NOT_FOUND);
-}
-$categoryHelper = new CategoryHelper();
-$categoryHelper->setPlurals(new Plurals());
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./show.twig');
-if (!is_null($selectedCategoryId) && isset($category->categoryName[$selectedCategoryId])) {
-    $faqSession->userTracking('show_category', $selectedCategoryId);
-    $categoryData = $category->getCategoryData($selectedCategoryId);
-    $records = $faq->renderFaqsByCategoryId(
-        $selectedCategoryId,
-        $faqConfig->get('records.orderby'),
-        $faqConfig->get('records.sortby')
-    );
-    if (empty($records) || $category->getChildNodes((int) $selectedCategoryId)) {
-        $subCategory = new Category($faqConfig, $currentGroups, true);
-        $subCategory->setUser($currentUser);
-        $subCategory->transform($selectedCategoryId);
-        $categoryHelper
-            ->setConfiguration($faqConfig)
-            ->setCategory($subCategory);
-        if (empty($records)) {
-            $records = sprintf('<div class="mb-5 alert alert-info">%s</div>', Translation::get('msgErrorNoRecords'));
-        }
-        if ((is_countable($category->getChildNodes((int) $selectedCategoryId)) ? count($category->getChildNodes((int) $selectedCategoryId)) : 0) !== 0) {
-            $categoryFaqsHeader = Translation::get('msgSubCategories');
-            $subCategoryContent = $categoryHelper->renderCategoryTree($selectedCategoryId);
-            $templateVars = [
-                ... $templateVars,
-                'categorySubsHeader' => $categoryFaqsHeader
-            ];
-        }
-    }
-    $up = '';
-    if ($categoryData->getId() !== 0) {
-        $url = sprintf(
-            '%sindex.php?%saction=show&amp;cat=%d',
-            $faqConfig->getDefaultUrl(),
-            $sids,
-            $categoryData->getParentId()
-        );
-        $text = $category->categoryName[$categoryData->getParentId()]['name'] ?? Translation::get('msgCategoryUp');
-        $link = new Link($url, $faqConfig);
-        $link->itemTitle = $text;
-        $link->text = $text;
-        $link->tooltip = Translation::get('msgCategoryUp');
-        $up = sprintf('<i class="bi bi-arrow-90deg-up"></i> %s', $link->toHtmlAnchor());
-    }
-    if (!is_null($categoryData->getImage()) && strlen((string) $categoryData->getImage()) > 0) {
-        $categoryImage = $faqConfig->getDefaultUrl() . 'content/user/images/' . $categoryData->getImage();
-    }
-    $categoryHeader = Translation::get('msgEntriesIn') . $categoryData->getName();
-    $templateVars = [
-        ... $templateVars,
-        'categoryFaqsHeader' => $categoryData->getName(),
-        'categoryDescription' => $categoryData->getDescription() ?? '',
-        'categorySubsHeader' => Translation::get('msgSubCategories'),
-        'categoryImage' => $categoryImage ?? null,
-        'categoryContent' => $records,
-        'subCategoryContent' => $subCategoryContent,
-        'categoryLevelUp' => $up,
-    ];
-} else {
-    $selectedCategoryId = 0;
-    $faqSession->userTracking('show_all_categories', 0);
-    $categoryHelper
-        ->setConfiguration($faqConfig)
-        ->setCategory($category);
-    $categoryHeader = Translation::get('msgFullCategories');
-    $templateVars = [
-        ... $templateVars,
-        'categoryFaqsHeader' => Translation::get('msgShowAllCategories'),
-        'categoryDescription' => Translation::get('msgCategoryDescription'),
-        'categorySubsHeader' => Translation::get('msgSubCategories'),
-        'categoryContent' => $categoryHelper->renderCategoryTree($selectedCategoryId),
-        'subCategoryContent' => Translation::get('msgSubCategoryContent'),
-        'categoryLevelUp' => '',
-    ];
-}
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', $categoryHeader, $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgCategoryMetaDesc'), $faqConfig->getTitle()),
-    'categoryHeader' => $categoryHeader,
-];
-return $templateVars;

--- a/phpmyfaq/sitemap.php
+++ b//dev/null
@@ -1,52 +0,0 @@
-<?php
-/**
- * Sitemap frontend.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thomas Zeithaml <seo@annatom.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-08-21
- */
-use phpMyFAQ\Filter;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-$faqSession = $container->get('phpmyfaq.session');
-$faqSession->setCurrentUser($user);
-$faqSession->userTracking('sitemap', 0);
-$request = Request::createFromGlobals();
-$letter = Filter::filterVar($request->query->get('letter'), FILTER_SANITIZE_SPECIAL_CHARS);
-if (!is_null($letter) && (1 == Strings::strlen($letter))) {
-    $currLetter = strtoupper(Strings::substr($letter, 0, 1));
-} else {
-    $currLetter = '';
-}
-$siteMap = $container->get('phpmyfaq.sitemap');
-$siteMap->setUser($currentUser);
-$siteMap->setGroups($currentGroups);
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twigTemplate = $twig->loadTemplate('./sitemap.twig');
-$templateVars = [
-    ... $templateVars,
-    'title' => sprintf('%s - %s', Translation::get('msgSitemap'), $faqConfig->getTitle()),
-    'metaDescription' => sprintf(Translation::get('msgSitemapMetaDesc'), $faqConfig->getTitle()),
-    'pageHeader' => $currLetter === '' || $currLetter === '0' ? Translation::get('msgSitemap') : $currLetter,
-    'letters' => $siteMap->getAllFirstLetters(),
-    'faqs' => $siteMap->getFaqsFromLetter($currLetter),
-    'writeCurrentLetter' => $currLetter === '' || $currLetter === '0' ? Translation::get('msgSitemap') : $currLetter,
-];
-return $templateVars;

--- a/phpmyfaq/src/phpMyFAQ/Auth/AuthEntraId.php
+++ b//dev/null
@@ -1,164 +0,0 @@
-<?php
-/**
- * Manages user authentication with Microsoft Entra ID.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2022-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2022-09-09
- */
-namespace phpMyFAQ\Auth;
-use phpMyFAQ\Auth;
-use phpMyFAQ\Auth\Azure\OAuth;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Enums\AuthenticationSourceType;
-use phpMyFAQ\Session;
-use phpMyFAQ\User;
-use SensitiveParameter;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-/**q
- * Class AuthEntraId
- *
- * @package phpMyFAQ\Auth
- */
-class AuthEntraId extends Auth implements AuthDriverInterface
-{
-    private readonly Session $session;
-    private string $oAuthVerifier = '';
-    private string $oAuthChallenge;
-    /** @var string */
-    private const ENTRAID_CHALLENGE_METHOD = 'S256';
-    /** @var string URL to logout */
-    private const ENTRAID_LOGOUT_URL = 'https://login.microsoftonline.com/common/wsfederation?wa=wsignout1.0';
-    /**
-     * @inheritDoc
-     */
-    public function __construct(Configuration $configuration, private readonly OAuth $oAuth)
-    {
-        $this->configuration = $configuration;
-        $this->session = new Session($configuration);
-        parent::__construct($configuration);
-    }
-    /**
-     * @inheritDoc
-     * @throws Exception
-     */
-    public function create(string $login, #[SensitiveParameter] string $password, string $domain = ''): mixed
-    {
-        $result = false;
-        $user = new User($this->configuration);
-        try {
-            $result = $user->createUser($login, '', $domain);
-        } catch (\Exception $e) {
-            $this->configuration->getLogger()->info($e->getMessage());
-        }
-        $user->setStatus('active');
-        $user->setAuthSource(AuthenticationSourceType::AUTH_AZURE->value);
-        $user->setUserData(
-            [
-                'display_name' => $this->oAuth->getName(),
-                'email' => $this->oAuth->getMail(),
-            ]
-        );
-        return $result;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function update(string $login, #[SensitiveParameter] string $password): bool
-    {
-        return true;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function delete(string $login): bool
-    {
-        return true;
-    }
-    /**
-     * @inheritDoc
-     * @throws Exception
-     */
-    public function checkCredentials(
-        string $login,
-        ?array $optionalData = []
-    ): bool {
-        $this->create($login, '');
-        return true;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function isValidLogin(string $login, ?array $optionalData = []): int
-    {
-        if ($login === $this->oAuth->getMail()) {
-            return 1;
-        }
-        return 0;
-    }
-    /**
-     * Method to authorize against Entra ID
-     *
-     * @throws \Exception
-     */
-    public function authorize(): void
-    {
-        $this->createOAuthChallenge();
-        $this->session->setCurrentSessionKey();
-        $this->session->set(Session::PMF_AZURE_AD_OAUTH_VERIFIER, $this->oAuthVerifier);
-        $this->session->setCookie(Session::PMF_AZURE_AD_OAUTH_VERIFIER, $this->oAuthVerifier, 7200, false);
-        $oAuthURL = sprintf(
-            'https://login.microsoftonline.com/%s/oauth2/v2.0/authorize' .
-            '?response_type=code&client_id=%s&redirect_uri=%s&scope=%s&code_challenge=%s&code_challenge_method=%s',
-            AAD_OAUTH_TENANTID,
-            AAD_OAUTH_CLIENTID,
-            urlencode($this->configuration->getDefaultUrl() . 'services/azure/callback.php'),
-            AAD_OAUTH_SCOPE,
-            $this->oAuthChallenge,
-            self::ENTRAID_CHALLENGE_METHOD
-        );
-        $redirectResponse = new RedirectResponse($oAuthURL);
-        $redirectResponse->send();
-    }
-    /**
-     * Logout
-     *
-     */
-    public function logout(): void
-    {
-        $redirectResponse = new RedirectResponse(self::ENTRAID_LOGOUT_URL);
-        $redirectResponse->send();
-    }
-    /**
-     * Method to generate code verifier and code challenge for oAuth login.
-     * See RFC7636 for details.
-     *
-     * @throws \Exception
-     */
-    private function createOAuthChallenge(): void
-    {
-        $verifier = $this->oAuthVerifier;
-        if ($this->oAuthVerifier === '' || $this->oAuthVerifier === '0') {
-            $chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-._~';
-            $charLen = strlen($chars) - 1;
-            $verifier = '';
-            for ($i = 0; $i < 128; ++$i) {
-                $verifier .= $chars[random_int(0, $charLen)];
-            }
-            $this->oAuthVerifier = $verifier;
-        }
-        $this->oAuthChallenge = str_replace(
-            '=',
-            '',
-            strtr(base64_encode(pack('H*', hash('sha256', $verifier))), '+/', '-_')
-        );
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Auth/AuthLdap.php
+++ b//dev/null
@@ -1,159 +0,0 @@
-<?php
-/**
- * Manages user authentication with LDAP server.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Alberto Cabello <alberto@unex.es>
- * @author    Lars Scheithauer <larsscheithauer@googlemail.com>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2009-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2009-03-01
- */
-namespace phpMyFAQ\Auth;
-use phpMyFAQ\Auth;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Enums\AuthenticationSourceType;
-use phpMyFAQ\Ldap as LdapCore;
-use phpMyFAQ\User;
-use SensitiveParameter;
-/**
- * Class AuthLdap
- *
- * @package phpMyFAQ\Auth
- */
-class AuthLdap extends Auth implements AuthDriverInterface
-{
-    private ?LdapCore $ldapCore = null;
-    /** @var string[] Array of LDAP servers */
-    private readonly array $ldapServer;
-    /** @var int Active LDAP server */
-    private int $activeServer = 0;
-    /** @var bool */
-    private readonly mixed $multipleServers;
-    /**
-     * @inheritDoc
-     * @throws Exception
-     */
-    public function __construct(Configuration $configuration)
-    {
-        $this->configuration = $configuration;
-        $this->ldapServer = $this->configuration->getLdapServer();
-        $this->multipleServers = $this->configuration->get('ldap.ldap_use_multiple_servers');
-        parent::__construct($this->configuration);
-        if (0 === (is_countable($this->ldapServer) ? count($this->ldapServer) : 0)) {
-            throw new AuthException('An error occurred while contacting LDAP: No configuration found.');
-        }
-        $this->ldapCore = new LdapCore($this->configuration);
-        $this->connect($this->activeServer);
-    }
-    /**
-     * @inheritDoc
-     * @throws Exception
-     */
-    public function create(string $login, #[SensitiveParameter] string $password, string $domain = ''): bool
-    {
-        $user = new User($this->configuration);
-        $result = $user->createUser($login, '', $domain);
-        $this->connect($this->activeServer);
-        $user->setStatus('active');
-        $user->setAuthSource(AuthenticationSourceType::AUTH_LDAP->value);
-        $user->setUserData(
-            [
-                'display_name' => $this->ldapCore->getCompleteName($login),
-                'email' => $this->ldapCore->getMail($login)
-            ]
-        );
-        return $result;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function update(string $login, #[SensitiveParameter] string $password): bool
-    {
-        return true;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function delete(string $login): bool
-    {
-        return true;
-    }
-    /**
-     * @inheritDoc
-     * @throws AuthException|Exception
-     */
-    public function checkCredentials(
-        string $login,
-        ?array $optionalData = null
-    ): bool {
-        if ('' === trim($password)) {
-            throw new AuthException(User::ERROR_USER_INCORRECT_PASSWORD);
-        }
-        if ($this->multipleServers) {
-            foreach (array_keys($this->ldapServer) as $key) {
-                $this->connect($key);
-                $this->activeServer = (int)$key;
-                break;
-            }
-        }
-        $bindLogin = $login;
-        if ($this->configuration->get('ldap.ldap_use_domain_prefix')) {
-            if (array_key_exists('domain', $optionalData)) {
-                $bindLogin = $optionalData['domain'] . '\\' . $login;
-            }
-        } else {
-            $this->connect($this->activeServer);
-            $bindLogin = $this->ldapCore->getDn($login);
-        }
-        $this->ldapCore = new LdapCore($this->configuration);
-        $this->ldapCore->connect(
-            $this->ldapServer[$this->activeServer]['ldap_server'],
-            $this->ldapServer[$this->activeServer]['ldap_port'],
-            $this->ldapServer[$this->activeServer]['ldap_base'],
-            $bindLogin,
-            htmlspecialchars_decode($password)
-        );
-        if (!$this->ldapCore->bind($bindLogin, htmlspecialchars_decode($password))) {
-            throw new AuthException($this->ldapCore->error);
-        }
-        $this->create($login, htmlspecialchars_decode($password));
-        return true;
-    }
-    /**
-     * @inheritDoc
-     */
-    public function isValidLogin(string $login, ?array $optionalData = null): int
-    {
-        if ($this->multipleServers) {
-            foreach (array_keys($this->ldapServer) as $key) {
-                $this->connect($key);
-                $this->activeServer = (int)$key;
-                break;
-            }
-        }
-        $this->connect($this->activeServer);
-        return strlen((string) $this->ldapCore->getCompleteName($login));
-    }
-    private function connect(int $activeServer = 0): void
-    {
-        $this->ldapCore->connect(
-            $this->ldapServer[$activeServer]['ldap_server'],
-            $this->ldapServer[$activeServer]['ldap_port'],
-            $this->ldapServer[$activeServer]['ldap_base'],
-            $this->ldapServer[$activeServer]['ldap_user'],
-            $this->ldapServer[$activeServer]['ldap_password']
-        );
-        if ($this->ldapCore->error) {
-            $this->configuration->getLogger()->error($this->ldapCore->error);
-            $this->errors[] = $this->ldapCore->error;
-        }
-    }
-}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Auth/AuthSso.php
@@ -0,0 +1,95 @@
+<?php
+/**
+ * Manages user authentication with Apache's SSO authentication, e.g. mod_sspi or mod_auth_kerb.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2011-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2011-06-22
+ */
+namespace phpMyFAQ\Auth;
+use phpMyFAQ\Auth;
+use phpMyFAQ\Configuration;
+use phpMyFAQ\Core\Exception;
+use phpMyFAQ\Enums\AuthenticationSourceType;
+use phpMyFAQ\User;
+/**
+ * Class Sso
+ *
+ * @package phpMyFAQ\Auth
+ */
+class AuthSso extends Auth implements AuthDriverInterface
+{
+    /**
+     * @inheritDoc
+     * @throws Exception
+     */
+    public function create(string $login, string $password, string $domain = ''): bool
+    {
+        if ($this->config->isLdapActive()) {
+            $authLdap = new AuthLdap($this->config);
+            return $authLdap->create($login, '', $domain);
+        } else {
+            $user = new User($this->config);
+            $result = $user->createUser($login, '', $domain);
+            $user->setStatus('active');
+            $user->setAuthSource(AuthenticationSourceType::AUTH_SSO->value);
+            $user->setUserData([ 'display_name' => $login ]);
+            return $result;
+        }
+    }
+    /**
+     * @inheritDoc
+     */
+    public function update(string $login, string $password): bool
+    {
+        return true;
+    }
+    /**
+     * @inheritDoc
+     */
+    public function delete(string $login): bool
+    {
+        return true;
+    }
+    /**
+     * @inheritDoc
+     * @throws Exception
+     */
+    public function checkCredentials(string $login, string $password, array $optionalData = null): bool
+    {
+        if (!isset($_SERVER['REMOTE_USER'])) {
+            return false;
+        } else {
+            $remoteUser = explode('\\', (string) $_SERVER['REMOTE_USER']);
+            if (is_array($remoteUser) && count($remoteUser) > 1) {
+                $user = $remoteUser[1];
+            } else {
+                $remoteUser = explode('@', (string) $_SERVER['REMOTE_USER']);
+                if (is_array($remoteUser) && count($remoteUser) > 1) {
+                    $user = $remoteUser[0];
+                } else {
+                    $user = $_SERVER['REMOTE_USER'];
+                }
+            }
+            if ($user === $login) {
+                return true;
+            } else {
+                return false;
+            }
+        }
+    }
+    /**
+     * @inheritDoc
+     */
+    public function isValidLogin(string $login, array $optionalData = null): int
+    {
+        return isset($_SERVER['REMOTE_USER']) ? 1 : 0;
+    }
+}

--- a/phpmyfaq/src/phpMyFAQ/Category/Image.php
+++ b//dev/null
@@ -1,129 +0,0 @@
-<?php
-/**
- * The category image class.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2016-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2016-09-08
- */
-namespace phpMyFAQ\Category;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Core\Exception;
-use Symfony\Component\HttpFoundation\File\UploadedFile;
-/**
- * Class CategoryImage
- *
- * @package phpMyFAQ\Category
- */
-class Image
-{
-    /** @var string */
-    private const UPLOAD_DIR = PMF_CONTENT_DIR . '/user/images/';
-    private bool $isUpload = false;
-    private UploadedFile $uploadedFile;
-    private string $fileName = '';
-    /**
-     * Constructor.
-     *
-     * @param Configuration $configuration Configuration object
-     */
-    public function __construct(private readonly Configuration $configuration)
-    {
-    }
-    /**
-     * Sets the uploaded file
-     */
-    public function setUploadedFile(UploadedFile $uploadedFile): Image
-    {
-        if ($uploadedFile->isValid()) {
-            $this->isUpload = true;
-        }
-        $this->uploadedFile = $uploadedFile;
-        return $this;
-    }
-    /**
-     * Returns the filename for the given category ID and language.
-     */
-    public function getFileName(int $categoryId, string $categoryName): string
-    {
-        if ($this->isUpload) {
-            $this->setFileName(
-                sprintf(
-                    'category-%d-%s.%s',
-                    $categoryId,
-                    $categoryName,
-                    $this->getFileExtension($this->uploadedFile->getMimeType())
-                )
-            );
-        }
-        return $this->fileName;
-    }
-    /**
-     * Returns the filename.
-     */
-    public function setFileName(string $fileName): Image
-    {
-        $this->fileName = $fileName;
-        return $this;
-    }
-    /**
-     * Returns the image file extension from a given MIME type.
-     */
-    private function getFileExtension(string $mimeType): string
-    {
-        $mapping = [
-            'image/gif' => 'gif',
-            'image/jpeg' => 'jpg',
-            'image/png' => 'png',
-            'image/webp' => 'webp',
-        ];
-        return $mapping[$mimeType] ?? 'png';
-    }
-    /**
-     * Checks for valid image MIME types, returns true if valid
-     */
-    private function isValidMimeType(string $contentType): bool
-    {
-        $types = ['image/jpeg','image/gif','image/png', 'image/webp'];
-        return in_array($contentType, $types);
-    }
-    /**
-     * Uploads the current file and moves it into the images/ folder.
-     *
-     * @throws Exception
-     */
-    public function upload(): bool
-    {
-        if (
-            $this->isUpload && $this->uploadedFile->isValid()
-            && $this->uploadedFile->getSize() < $this->configuration->get('records.maxAttachmentSize')
-        ) {
-            if (false === $this->uploadedFile->getSize()) {
-                throw new Exception('Cannot detect image size');
-            }
-            if (!$this->isValidMimeType($this->uploadedFile->getClientMimeType())) {
-                throw new Exception('Image MIME type validation failed.');
-            }
-            $this->uploadedFile->move(self::UPLOAD_DIR, $this->fileName);
-            return true;
-        }
-        throw new Exception('Uploaded image is too big');
-    }
-    /**
-     * Deletes the current file, returns true, if no file is available.
-     */
-    public function delete(): bool
-    {
-        if (is_file(self::UPLOAD_DIR . $this->fileName)) {
-            return unlink(self::UPLOAD_DIR . $this->fileName);
-        }
-        return true;
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Controller/Administration/ConfigurationTabController.php
+++ b//dev/null
@@ -1,255 +0,0 @@
-<?php
-/**
- * The Admin Configuration Tab Controller
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-10-30
- */
-namespace phpMyFAQ\Controller\Administration;
-use phpMyFAQ\Controller\AbstractController;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Helper\AdministrationHelper;
-use phpMyFAQ\Helper\LanguageHelper;
-use phpMyFAQ\Helper\PermissionHelper;
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TemplateException;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Exception\BadRequestException;
-use Symfony\Component\HttpFoundation\JsonResponse;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\Routing\Annotation\Route;
-class ConfigurationTabController extends AbstractController
-{
-    /**
-     * @throws TemplateException
-     * @throws Exception
-     */
-    public function list(Request $request): Response
-    {
-        $this->userHasPermission(PermissionType::CONFIGURATION_EDIT);
-        $language = $this->container->get('phpmyfaq.language');
-        $currentLanguage = $language->setLanguageByAcceptLanguage();
-        try {
-            Translation::create()
-                ->setLanguagesDir(PMF_LANGUAGE_DIR)
-                ->setDefaultLanguage('en')
-                ->setCurrentLanguage($currentLanguage)
-                ->setMultiByteLanguage();
-        } catch (Exception $exception) {
-            throw new BadRequestException($exception->getMessage());
-        }
-        $mode = $request->get('mode');
-        $configurationList = Translation::getConfigurationItems($mode);
-        return $this->render(
-            '@admin/configuration/tab-list.twig',
-            [
-                'mode' => $mode,
-                'configurationList' => $configurationList,
-                'configurationData' => $this->configuration->getAll(),
-                'specialCases' => [
-                    'ldapSupport' => extension_loaded('ldap'),
-                    'useSslForLogins' => Request::createFromGlobals()->isSecure(),
-                    'useSslOnly' => Request::createFromGlobals()->isSecure(),
-                    'ssoSupport' => Request::createFromGlobals()->server->get('REMOTE_USER'),
-                    'buttonTes'
-                ]
-            ]
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function save(Request $request): JsonResponse
-    {
-        $this->userHasPermission(PermissionType::CONFIGURATION_EDIT);
-        $csrfToken = $request->get('pmf-csrf-token');
-        $configurationData = $request->get('edit');
-        $oldConfigurationData = $this->configuration->getAll();
-        if (!Token::getInstance()->verifyToken('configuration', $csrfToken)) {
-            return $this->json(['error' => Translation::get('err_NotAuth')], Response::HTTP_UNAUTHORIZED);
-        } else {
-            $newConfigValues = [];
-            $escapeValues = [
-                'main.contactInformation',
-                'main.customPdfHeader',
-                'main.customPdfFooter',
-                'main.titleFAQ',
-            ];
-            if (isset($configurationData['main.enableMarkdownEditor'])) {
-                $configurationData['main.enableWysiwygEditor'] = false; // Disable WYSIWYG editor if Markdown is enabled
-            }
-            if (isset($configurationData['main.currentVersion'])) {
-                unset($configurationData['main.currentVersion']); // don't update the version number
-            }
-            if (isset($configurationData['records.attachmentsPath'])) {
-                if (false !== realpath($configurationData['records.attachmentsPath'])) {
-                    $configurationData['records.attachmentsPath'] = str_replace(
-                        Request::createFromGlobals()->server->get('DOCUMENT_ROOT') . DIRECTORY_SEPARATOR,
-                        '',
-                        realpath($configurationData['records.attachmentsPath'])
-                    );
-                } else {
-                    unset($configurationData['records.attachmentsPath']);
-                }
-            }
-            if (
-                isset($configurationData['main.referenceURL']) &&
-                is_null(Filter::filterVar($configurationData['main.referenceURL'], FILTER_VALIDATE_URL))
-            ) {
-                unset($configurationData['main.referenceURL']);
-            }
-            $newConfigClass = [];
-            foreach ($configurationData as $key => $value) {
-                $newConfigValues[$key] = (string) $value;
-                if (isset($escapeValues[$key])) {
-                    $newConfigValues[$key] = Strings::htmlspecialchars($value, ENT_QUOTES);
-                }
-                $keyArray = array_values(explode('.', (string) $key));
-                $newConfigClass = array_shift($keyArray);
-            }
-            foreach ($oldConfigurationData as $key => $value) {
-                $keyArray = array_values(explode('.', (string) $key));
-                $oldConfigClass = array_shift($keyArray);
-                if (isset($newConfigValues[$key])) {
-                    continue;
-                }
-                if ($oldConfigClass === $newConfigClass && $value === 'true') {
-                    $newConfigValues[$key] = 'false';
-                } else {
-                    $newConfigValues[$key] = $value;
-                }
-            }
-            if ($oldConfigurationData['main.referenceURL'] !== $newConfigValues['main.referenceURL']) {
-                $this->configuration->replaceMainReferenceUrl(
-                    $oldConfigurationData['main.referenceURL'],
-                    $newConfigValues['main.referenceURL']
-                );
-            }
-            $this->configuration->update($newConfigValues);
-            return $this->json(['success' => Translation::get('ad_config_saved')], Response::HTTP_OK);
-        }
-    }
-    /**
-     * @throws Exception
-     */
-    public function translations(): Response
-    {
-        $this->userIsAuthenticated();
-        $response = new Response();
-        $languages = LanguageHelper::getAvailableLanguages();
-        if ($languages !== []) {
-            return $response->setContent(LanguageHelper::renderLanguageOptions(
-                str_replace(
-                    [ 'language_', '.php', ],
-                    '',
-                    (string) $this->configuration->get('main.language')
-                ),
-                false,
-                true
-            ));
-        }
-        return $response->setContent('<option value="language_en.php">English</option>');
-    }
-    /**
-     * @throws Exception
-     */
-    public function templates(): Response
-    {
-        $this->userIsAuthenticated();
-        $response = new Response();
-        $faqSystem = new System();
-        $templates = $faqSystem->getAvailableTemplates();
-        $htmlString = '';
-        foreach ($templates as $template => $selected) {
-            $htmlString .= sprintf(
-                '<option%s>%s</option>',
-                ($selected === true ? ' selected' : ''),
-                $template
-            );
-        }
-        return $response->setContent($htmlString);
-    }
-    /**
-     * @throws Exception
-     */
-    public function faqsSortingKey(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::sortingKeyOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function faqsSortingOrder(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::sortingOrderOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function faqsSortingPopular(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::sortingPopularFaqsOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function permLevel(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            PermissionHelper::permOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function releaseEnvironment(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::renderReleaseTypeOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function searchRelevance(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::searchRelevanceOptions($request->get('current'))
-        );
-    }
-    /**
-     * @throws Exception
-     */
-    public function seoMetaTags(Request $request): Response
-    {
-        $this->userIsAuthenticated();
-        return new Response(
-            AdministrationHelper::renderMetaRobotsDropdown($request->get('current'))
-        );
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Controller/Frontend/SetupController.php
+++ b//dev/null
@@ -1,141 +0,0 @@
-<?php
-/**
- * The Setup Controller
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2024-06-01
- */
-namespace phpMyFAQ\Controller\Frontend;
-use Elastic\Elasticsearch\Exception\AuthenticationException;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Language\LanguageCodes;
-use phpMyFAQ\Setup\Installer;
-use phpMyFAQ\Setup\Update;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TemplateException;
-use phpMyFAQ\Template\TwigWrapper;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\Routing\Annotation\Route;
-class SetupController
-{
-    /**
-     * @throws TemplateException
-     * @throws \Exception
-     */
-    public function index(Request $request): Response
-    {
-        $system = new System();
-        $installer = new Installer($system);
-        $checkBasicError = '';
-        try {
-            $installer->checkBasicStuff();
-        } catch (Exception $e) {
-            $checkBasicError = $e->getMessage();
-        }
-        try {
-            $installer->checkInitialRewriteBasePath($request);
-        } catch (Exception $e) {
-            $checkBasicError = $e->getMessage();
-        }
-        return $this->render(
-            '@setup/index.twig',
-            [
-                'newVersion' => System::getVersion(),
-                'setupType' => 'Setup',
-                'currentYear' => date('Y'),
-                'currentLanguage' => 'en',
-                'documentationUrl' => System::getDocumentationUrl(),
-                'checkBasicError' => $checkBasicError,
-                'nonCriticalSettings' => $installer->checkNoncriticalSettings(),
-                'filePermissions' => $installer->checkFilesystemPermissions(),
-                'supportedDatabases' => $system->getSupportedSafeDatabases(),
-                'currentPath' => dirname(__DIR__, 4),
-                'isLdapEnabled' => $installer->hasLdapSupport(),
-                'isElasticsearchEnabled' => $installer->hasElasticsearchSupport(),
-                'supportedTranslations' => LanguageCodes::getAllSupported(),
-            ]
-        );
-    }
-    /**
-     * @throws TemplateException
-     * @throws \Exception
-     */
-    public function install(): Response
-    {
-        $system = new System();
-        $installer = new Installer($system);
-        $installationError = '';
-        try {
-            $installer->startInstall();
-        } catch (Exception | AuthenticationException $e) {
-            $installationError = $e->getMessage();
-        }
-        return $this->render(
-            '@setup/install.twig',
-            [
-                'newVersion' => System::getVersion(),
-                'setupType' => 'Setup',
-                'currentYear' => date('Y'),
-                'documentationUrl' => System::getDocumentationUrl(),
-                'installationError' => $installationError,
-            ]
-        );
-    }
-    /**
-     * @throws TemplateException
-     * @throws Exception
-     * @throws \Exception
-     */
-    public function update(Request $request): Response
-    {
-        $currentStep = Filter::filterVar($request->get('step'), FILTER_VALIDATE_INT);
-        $configuration = Configuration::getConfigurationInstance();
-        $update = new Update(new System(), $configuration);
-        $checkBasicError = '';
-        try {
-            $update->checkInitialRewriteBasePath($request);
-        } catch (Exception $e) {
-            $checkBasicError = $e->getMessage();
-        }
-        return $this->render(
-            '@setup/update.twig',
-            [
-                'currentStep' => $currentStep ?? 1,
-                'installedVersion' => $configuration->getVersion(),
-                'newVersion' => System::getVersion(),
-                'checkBasicError' => $checkBasicError,
-                'currentYear' => date('Y'),
-                'documentationUrl' => System::getDocumentationUrl(),
-                'configTableNotAvailable' => $update->isConfigTableNotAvailable($configuration->getDb()),
-            ]
-        );
-    }
-    /**
-     * Returns a Twig rendered template as response.
-     *
-     * @param string        $pathToTwigFile
-     * @param string[]      $templateVars
-     * @param Response|null $response
-     * @return Response
-     * @throws Exception
-     */
-    public function render(string $pathToTwigFile, array $templateVars = [], ?Response $response = null): Response
-    {
-        $response ??= new Response();
-        $twigWrapper = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates', true);
-        $template = $twigWrapper->loadTemplate($pathToTwigFile);
-        $response->setContent($template->render($templateVars));
-        return $response;
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Controller/SitemapController.php
+++ b//dev/null
@@ -1,45 +0,0 @@
-<?php
-/**
- * The XML Sitemap Controller
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2024-06-16
- */
-namespace phpMyFAQ\Controller;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Template\TemplateException;
-use Symfony\Component\HttpFoundation\Response;
-class SitemapController extends AbstractController
-{
-    private const PMF_SITEMAP_GOOGLE_MAX_URLS = 50000;
-    /**
-     * @throws TemplateException|Exception|\Exception
-     */
-    public function index(): Response
-    {
-        $response = new Response();
-        $faqStatistics = $this->container->get('phpmyfaq.faq.statistics');
-        $items = $faqStatistics->getTopTenData(self::PMF_SITEMAP_GOOGLE_MAX_URLS - 1);
-        $urls = [];
-        foreach ($items as $item) {
-            $urls[] = [
-                'loc' => $item['url'],
-                'lastmod' => $item['date'],
-                'priority' => '1.00',
-            ];
-        }
-        $xml = $this->renderView('./sitemap.xml.twig', ['urls' => $urls]);
-        $response->headers->set('Content-Type', 'text/xml');
-        $response->setStatusCode(Response::HTTP_OK);
-        $response->setContent($xml);
-        return $response;
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Controller/WebAuthnController.php
+++ b//dev/null
@@ -1,122 +0,0 @@
-<?php
-/**
- * The WebAuthn Controller
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2024-09-11
- */
-namespace phpMyFAQ\Controller;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Helper\LanguageHelper;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\CurrentUser;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\HttpFoundation\Response;
-use Symfony\Component\Routing\Annotation\Route;
-class WebAuthnController extends AbstractController
-{
-    public function __construct()
-    {
-        parent::__construct();
-    }
-    /**
-     * @throws Exception
-     */
-    public function index(Request $request): Response
-    {
-        $system = new System();
-        $user = CurrentUser::getCurrentUser($this->configuration);
-        $topNavigation = [
-            [
-                'name' => Translation::get('msgShowAllCategories'),
-                'link' => './show-categories.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('msgAddContent'),
-                'link' => './add-faq.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('msgQuestion'),
-                'link' => './add-question.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('msgOpenQuestions'),
-                'link' => './open-questions.html',
-                'active' => '',
-            ],
-        ];
-        $footerNavigation = [
-            [
-                'name' => Translation::get('faqOverview'),
-                'link' => './overview.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('msgSitemap'),
-                'link' => './sitemap/A/' . $this->configuration->getDefaultLanguage() . '.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('ad_menu_glossary'),
-                'link' => './glossary.html',
-                'active' => '',
-            ],
-            [
-                'name' => Translation::get('msgContact'),
-                'link' => './contact.html',
-                'active' => '',
-            ],
-        ];
-        return $this->render(
-            '/webauthn.twig',
-            [
-                'isMaintenanceMode' => $this->configuration->get('main.maintenanceMode'),
-                'isCompletelySecured' => $this->configuration->get('security.enableLoginOnly'),
-                'isDebugEnabled' => DEBUG,
-                'richSnippetsEnabled' => $this->configuration->get('seo.enableRichSnippets'),
-                'tplSetName' => TwigWrapper::getTemplateSetName(),
-                'msgLoginUser' => Translation::get('msgLoginUser'),
-                'isUserLoggedIn' => $user->isLoggedIn(),
-                'title' => Translation::get('msgLoginUser'),
-                'baseHref' => $system->getSystemUri($this->configuration),
-                'customCss' => $this->configuration->getCustomCss(),
-                'version' => $this->configuration->getVersion(),
-                'header' => str_replace('"', '', $this->configuration->getTitle()),
-                'metaPublisher' => $this->configuration->get('main.metaPublisher'),
-                'metaLanguage' => Translation::get('metaLanguage'),
-                'phpmyfaqVersion' => $this->configuration->getVersion(),
-                'stylesheet' => Translation::get('direction') == 'rtl' ? 'style.rtl' : 'style',
-                'currentPageUrl' => $request->getSchemeAndHttpHost() . $request->getRequestUri(),
-                'dir' => Translation::get('direction'),
-                'searchBox' => Translation::get('msgSearch'),
-                'faqHome' => $this->configuration->getDefaultUrl(),
-                'topNavigation' => $topNavigation,
-                'footerNavigation' => $footerNavigation,
-                'languageBox' => Translation::get('msgLanguageSubmit'),
-                'switchLanguages' =>
-                    LanguageHelper::renderSelectLanguage($this->configuration->getDefaultLanguage(), true),
-                'copyright' => System::getPoweredByString(true),
-                'isUserRegistrationEnabled' => $this->configuration->get('security.enableRegistration'),
-                'msgRegisterUser' => Translation::get('msgRegisterUser'),
-                'isPrivacyLinkEnabled' => $this->configuration->get('layout.enablePrivacyLink'),
-                'urlPrivacyLink' => $this->configuration->get('main.privacyURL'),
-                'msgPrivacyNote' => Translation::get('msgPrivacyNote'),
-                'isCookieConsentEnabled' => $this->configuration->get('layout.enableCookieConsent'),
-                'cookiePreferences' => Translation::get('cookiePreferences')
-            ]
-        );
-    }
-}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Database/Mysqli.php
@@ -0,0 +1,312 @@
+<?php
+/**
+ * The phpMyFAQ\Database\Mysqli class provides methods and functions for MySQL and
+ * MariaDB databases.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @author    David Soria Parra <dsoria@gmx.net>
+ * @copyright 2005-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ */
+namespace phpMyFAQ\Database;
+use mysqli_result;
+use mysqli_sql_exception;
+use phpMyFAQ\Database;
+use phpMyFAQ\Core\Exception;
+use phpMyFAQ\Utils;
+/**
+ * Class Mysqli
+ *
+ * @package phpMyFAQ\Database
+ */
+class Mysqli implements DatabaseDriver
+{
+    /**
+     * @var string[] Tables.
+     */
+    public array $tableNames = [];
+    /**
+     * The connection object.
+     *
+     * @var \mysqli|bool
+     */
+    private \mysqli|bool $conn = false;
+    /**
+     * The query log string.
+     */
+    private string $sqllog = '';
+    /**
+     * Connects to the database.
+     *
+     * @param string $host Hostname or path to socket
+     * @param string $user Username
+     * @param string $password Password
+     * @param string $database Database name
+     * @param int|null $port
+     * @return null|bool true, if connected, otherwise false
+     * @throws Exception
+     */
+    public function connect(
+        string $host,
+        string $user,
+        string $password,
+        string $database = '',
+        int $port = null
+    ): ?bool {
+        try {
+            if (str_starts_with($host, '/')) {
+                $this->conn = new \mysqli(null, $user, $password, null, $port, $host);
+            } else {
+                $this->conn = new \mysqli($host, $user, $password, null, $port);
+            }
+        } catch (mysqli_sql_exception $exception) {
+            throw new Exception($exception->getMessage());
+        }
+        if ($this->conn->connect_error) {
+            Database::errorPage($this->conn->connect_errno . ': ' . $this->conn->connect_error);
+            die();
+        }
+        if (!$this->conn->set_charset('utf8mb4')) {
+            Database::errorPage($this->error());
+        }
+        if ('' !== $database) {
+            try {
+                $this->conn->select_db($database);
+            } catch (mysqli_sql_exception) {
+                throw new Exception('Cannot connect to database ' . $database);
+            }
+        }
+        return true;
+    }
+    /**
+     * Returns the error string.
+     */
+    public function error(): string
+    {
+        return $this->conn->error;
+    }
+    /**
+     * Escapes a string for use in a query.
+     */
+    public function escape(string $string): string
+    {
+        return $this->conn->real_escape_string($string);
+    }
+    /**
+     * Fetch a result row as an associative array.
+     */
+    public function fetchArray(mixed $result): ?array
+    {
+        return $result->fetch_assoc();
+    }
+    /**
+     * Fetch a result row.
+     */
+    public function fetchRow(mixed $result): mixed
+    {
+        return $result->fetch_row()[0] ?? false;
+    }
+    /**
+     * Fetches a complete result as an object.
+     *
+     * @param mixed $result Result set
+     * @throws Exception
+     */
+    public function fetchAll(mixed $result): ?array
+    {
+        $ret = [];
+        if (false === $result) {
+            throw new Exception('Error while fetching result: ' . $this->error());
+        }
+        while ($row = $this->fetchObject($result)) {
+            $ret[] = $row;
+        }
+        return $ret;
+    }
+    /**
+     * Fetch a result row as an object.
+     * This function fetches a result row as an object.
+     *
+     * @throws Exception
+     */
+    public function fetchObject(mixed $result): mixed
+    {
+        return $result->fetch_object();
+    }
+    /**
+     * Number of rows in a result.
+     */
+    public function numRows(mixed $result): int
+    {
+        if ($result instanceof mysqli_result) {
+            return $result->num_rows;
+        } else {
+            return 0;
+        }
+    }
+    /**
+     * Logs the queries.
+     */
+    public function log(): string
+    {
+        return $this->sqllog;
+    }
+    /**
+     * This function returns the table status.
+     *
+     * @param string $prefix Table prefix
+     * @return string[]
+     */
+    public function getTableStatus(string $prefix = ''): array
+    {
+        $status = [];
+        foreach ($this->getTableNames($prefix) as $table) {
+            $status[$table] = $this->getOne('SELECT count(*) FROM ' . $table);
+        }
+        return $status;
+    }
+    /**
+     * Returns an array with all table names.
+     *
+     * @todo Have to be refactored because of https://github.com/thorsten/phpMyFAQ/issues/965
+     *
+     * @param string $prefix Table prefix
+     *
+     * @return string[]
+     */
+    public function getTableNames(string $prefix = ''): array
+    {
+        return $this->tableNames = [
+            $prefix . 'faqadminlog',
+            $prefix . 'faqattachment',
+            $prefix . 'faqattachment_file',
+            $prefix . 'faqbackup',
+            $prefix . 'faqcaptcha',
+            $prefix . 'faqcategories',
+            $prefix . 'faqcategoryrelations',
+            $prefix . 'faqcategory_group',
+            $prefix . 'faqcategory_news',
+            $prefix . 'faqcategory_order',
+            $prefix . 'faqcategory_user',
+            $prefix . 'faqchanges',
+            $prefix . 'faqcomments',
+            $prefix . 'faqconfig',
+            $prefix . 'faqdata',
+            $prefix . 'faqdata_group',
+            $prefix . 'faqdata_revisions',
+            $prefix . 'faqdata_tags',
+            $prefix . 'faqdata_user',
+            $prefix . 'faqglossary',
+            $prefix . 'faqgroup',
+            $prefix . 'faqgroup_right',
+            $prefix . 'faqinstances',
+            $prefix . 'faqinstances_config',
+            $prefix . 'faqmeta',
+            $prefix . 'faqnews',
+            $prefix . 'faqquestions',
+            $prefix . 'faqright',
+            $prefix . 'faqsearches',
+            $prefix . 'faqsessions',
+            $prefix . 'faqstopwords',
+            $prefix . 'faqtags',
+            $prefix . 'faquser',
+            $prefix . 'faquserdata',
+            $prefix . 'faquserlogin',
+            $prefix . 'faquser_group',
+            $prefix . 'faquser_right',
+            $prefix . 'faqvisits',
+            $prefix . 'faqvoting',
+        ];
+    }
+    /**
+     * Returns just one row.
+     */
+    private function getOne(string $query): string
+    {
+        $row = $this->conn->query($query)->fetch_row();
+        return $row[0];
+    }
+    /**
+     * This function is a replacement for MySQL's auto-increment so that
+     * we don't need it anymore.
+     *
+     * @param string $table The name of the table
+     * @param string $id    The name of the ID column
+     */
+    public function nextId(string $table, string $id): int
+    {
+        $select = sprintf(
+            '
+           SELECT
+               MAX(%s) AS current_id
+           FROM
+               %s',
+            $id,
+            $table
+        );
+        $result = $this->query($select);
+        if ($result instanceof mysqli_result) {
+            $current = $result->fetch_row();
+        } else {
+            $current = [0];
+        }
+        return $current[0] + 1;
+    }
+    /**
+     * This function sends a query to the database.
+     *
+     *
+     * @return mysqli_result $result
+     */
+    public function query(string $query, int $offset = 0, int $rowcount = 0): mixed
+    {
+        $this->sqllog .= Utils::debug($query);
+        if (0 < $rowcount) {
+            $query .= sprintf(' LIMIT %d,%d', $offset, $rowcount);
+        }
+        $result = $this->conn->query($query);
+        if (false === $result) {
+            $this->sqllog .= $this->conn->errno . ': ' . $this->error();
+        }
+        return $result;
+    }
+    /**
+     * Returns the client version string.
+     */
+    public function clientVersion(): string
+    {
+        return mysqli_get_client_info();
+    }
+    /**
+     * Returns the server version string.
+     */
+    public function serverVersion(): string
+    {
+        return $this->conn->server_info;
+    }
+    /**
+     * Closes the connection to the database.
+     */
+    public function close(): void
+    {
+        if ($this->conn) {
+            $this->conn->close();
+        }
+    }
+    public function __destruct()
+    {
+        if ($this->conn) {
+            $this->conn->close();
+        }
+    }
+    public function now(): string
+    {
+        return 'NOW()';
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Database/Pgsql.php
@@ -0,0 +1,291 @@
+<?php
+/**
+ * The phpMyFAQ\Db_Pgsql class provides methods and functions for a PostgreSQL
+ * database.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @author    Tom Rochester <tom.rochester@gmail.com>
+ * @copyright 2003-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ */
+namespace phpMyFAQ\Database;
+use Exception;
+use PgSql\Connection;
+use PgSql\Result;
+use phpMyFAQ\Database;
+use phpMyFAQ\Utils;
+/**
+ * Class Pgsql
+ *
+ * @package phpMyFAQ\Database
+ */
+class Pgsql implements DatabaseDriver
+{
+    /**
+     * The query log string.
+     *
+     * @var string
+     */
+    public $sqllog = '';
+    /**
+     * Tables.
+     *
+     * @var string[]
+     */
+    public array $tableNames = [];
+    /**
+     * The connection resource.
+     */
+    private Connection|null $conn = null;
+    /**
+     * Connects to the database.
+     *
+     * @param string $host Database hostname
+     * @param string $user Database username
+     * @param string $password Password
+     * @param string $database Database name
+     * @return null|bool true, if connected, otherwise false
+     */
+    public function connect(
+        string $host,
+        string $user,
+        string $password,
+        string $database = '',
+        int $port = null
+    ): ?bool {
+        $connectionString = sprintf(
+            'host=%s port=%d dbname=%s user=%s password=%s',
+            $host,
+            $port,
+            $database,
+            $user,
+            $password
+        );
+        $this->conn = pg_connect($connectionString);
+        if (empty($database) || !$this->conn) {
+            Database::errorPage(pg_last_error($this->conn));
+            die();
+        }
+        return true;
+    }
+    /**
+     * This function sends a query to the database.
+     *
+     * @return bool|Result $result
+     */
+    public function query(string $query, int $offset = 0, int $rowcount = 0): bool|Result
+    {
+        $this->sqllog .= Utils::debug($query);
+        if (0 < $rowcount) {
+            $query .= sprintf(' LIMIT %d OFFSET %d', $rowcount, $offset);
+        }
+        $result = pg_query($this->conn, $query);
+        if (!$result) {
+            $this->sqllog .= $this->error();
+        }
+        if (pg_result_status($result) === PGSQL_COMMAND_OK) {
+            return true;
+        }
+        return $result;
+    }
+    /**
+     * Returns the error string.
+     */
+    public function error(): string
+    {
+        return pg_last_error($this->conn);
+    }
+    /**
+     * Escapes a string for use in a query.
+     */
+    public function escape(string $string): string
+    {
+        return pg_escape_string($this->conn, $string);
+    }
+    /**
+     * Fetches a complete result as an object.
+     *
+     * @param mixed $result Resultset
+     * @throws Exception
+     */
+    public function fetchAll(mixed $result): ?array
+    {
+        $ret = [];
+        if (false === $result) {
+            throw new Exception('Error while fetching result: ' . $this->error());
+        }
+        while ($row = $this->fetchObject($result)) {
+            $ret[] = $row;
+        }
+        return $ret;
+    }
+    /**
+     * Fetch a result row as an object.
+     *
+     * @return false|object
+     */
+    public function fetchObject(mixed $result): mixed
+    {
+        return pg_fetch_object($result);
+    }
+    /**
+     * Fetch a result row.
+     */
+    public function fetchRow(mixed $result): array|false
+    {
+        return pg_fetch_row($result);
+    }
+    /**
+     * Number of rows in a result.
+     */
+    public function numRows(mixed $result): int
+    {
+        return pg_num_rows($result);
+    }
+    /**
+     * Logs the queries.
+     */
+    public function log(): string
+    {
+        return $this->sqllog;
+    }
+    /**
+     * This function returns the table status.
+     *
+     * @param string $prefix Table prefix
+     */
+    public function getTableStatus(string $prefix = ''): array
+    {
+        $select = 'SELECT relname FROM pg_stat_user_tables ORDER BY relname;';
+        $arr = [];
+        $result = $this->query($select);
+        while ($row = $this->fetchArray($result)) {
+            $count = $this->getOne('SELECT count(1) FROM ' . $row['relname'] . ';');
+            $arr[$row['relname']] = $count;
+        }
+        return $arr;
+    }
+    /**
+     * Fetch a result row as an object.
+     */
+    public function fetchArray(mixed $result): ?array
+    {
+        $result = pg_fetch_array($result, null, PGSQL_ASSOC);
+        if ($result) {
+            return $result;
+        }
+        return [];
+    }
+    /**
+     * Returns just one row.
+     */
+    private function getOne(string $query): string
+    {
+        $row = pg_fetch_row($this->query($query));
+        return $row[0];
+    }
+    /**
+     * Returns the next ID of a table.
+     *
+     * @param string $table the name of the table
+     * @param string $id    the name of the ID column
+     */
+    public function nextId(string $table, string $id): int
+    {
+        return (int) $this->getOne("SELECT nextval('" . $table . '_' . $id . "_seq') as current_id;");
+    }
+    /**
+     * This function returns the client version string.
+     */
+    public function clientVersion(): string
+    {
+        $pg_version = pg_version($this->conn);
+        if (isset($pg_version['client'])) {
+            return $pg_version['client'];
+        } else {
+            return 'n/a';
+        }
+    }
+    /**
+     * Returns the server version string.
+     */
+    public function serverVersion(): string
+    {
+        $pg_version = pg_version($this->conn);
+        if (isset($pg_version['server_version'])) {
+            return $pg_version['server_version'];
+        } else {
+            return 'n/a';
+        }
+    }
+    /**
+     * Returns an array with all table names.
+     *
+     * @todo Have to be refactored because of https://github.com/thorsten/phpMyFAQ/issues/965
+     *
+     * @param string $prefix Table prefix
+     *
+     * @return string[]
+     */
+    public function getTableNames(string $prefix = ''): array
+    {
+        return $this->tableNames = [
+            $prefix . 'faqadminlog',
+            $prefix . 'faqattachment',
+            $prefix . 'faqattachment_file',
+            $prefix . 'faqbackup',
+            $prefix . 'faqcaptcha',
+            $prefix . 'faqcategories',
+            $prefix . 'faqcategoryrelations',
+            $prefix . 'faqcategory_group',
+            $prefix . 'faqcategory_news',
+            $prefix . 'faqcategory_order',
+            $prefix . 'faqcategory_user',
+            $prefix . 'faqchanges',
+            $prefix . 'faqcomments',
+            $prefix . 'faqconfig',
+            $prefix . 'faqdata',
+            $prefix . 'faqdata_group',
+            $prefix . 'faqdata_revisions',
+            $prefix . 'faqdata_tags',
+            $prefix . 'faqdata_user',
+            $prefix . 'faqglossary',
+            $prefix . 'faqgroup',
+            $prefix . 'faqgroup_right',
+            $prefix . 'faqinstances',
+            $prefix . 'faqinstances_config',
+            $prefix . 'faqmeta',
+            $prefix . 'faqnews',
+            $prefix . 'faqquestions',
+            $prefix . 'faqright',
+            $prefix . 'faqsearches',
+            $prefix . 'faqsessions',
+            $prefix . 'faqstopwords',
+            $prefix . 'faqtags',
+            $prefix . 'faquser',
+            $prefix . 'faquserdata',
+            $prefix . 'faquserlogin',
+            $prefix . 'faquser_group',
+            $prefix . 'faquser_right',
+            $prefix . 'faqvisits',
+            $prefix . 'faqvoting',
+        ];
+    }
+    /**
+     * Closes the connection to the database.
+     */
+    public function close(): bool
+    {
+        return pg_close($this->conn);
+    }
+    public function now(): string
+    {
+        return 'CURRENT_TIMESTAMP';
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Database/Sqlite3.php
@@ -0,0 +1,280 @@
+<?php
+/**
+ * The Sqlite3 class provides methods and functions for a SQLite v3 database.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2012-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2012-03-02
+ */
+namespace phpMyFAQ\Database;
+use phpMyFAQ\Core\Exception;
+use phpMyFAQ\Utils;
+/**
+ * Class Sqlite3
+ *
+ * @package phpMyFAQ\Database
+ */
+class Sqlite3 implements DatabaseDriver
+{
+    /**
+     * @var string[] Tables.
+     */
+    public array $tableNames = [];
+    /**
+     * The connection object.
+     *
+     * @var \SQLite3|bool
+     */
+    private \Sqlite3|bool $conn = false;
+    /**
+     * The query log string.
+     *
+     *
+     * @see query()
+     */
+    private string $sqllog = '';
+    /** @var string */
+    private const ERROR_MESSAGE =
+        'Do not call numRows() after you\'ve fetched one or more result records, because ' .
+        'phpMyFAQ\Database\Sqlite3::numRows() has to reset the results at its end.';
+    /**
+     * Connects to the database.
+     *
+     * @param int|null $port
+     */
+    public function connect(
+        string $host,
+        string $user,
+        string $password,
+        string $database = '',
+        int $port = null
+    ): ?bool {
+        $this->conn = new \Sqlite3($host);
+        return true;
+    }
+    /**
+     * Escapes a string for use in a query.
+     */
+    public function escape(string $string): string
+    {
+        return \SQLite3::escapeString($string);
+    }
+    /**
+     * Fetch a result row as an object.
+     *
+     * @return object|null or NULL if there are no more results
+     */
+    public function fetchObject(mixed $result): ?object
+    {
+        $return = $result->fetchArray(SQLITE3_ASSOC);
+        return $return
+            ? (object)$return
+            : null;
+    }
+    /**
+     * Fetch a result row as an array.
+     */
+    public function fetchArray(mixed $result): ?array
+    {
+        $fetchedData = $result->fetchArray();
+        return is_array($fetchedData) ? $fetchedData : [];
+    }
+    /**
+     * Fetch a result row.
+     */
+    public function fetchRow(mixed $result): mixed
+    {
+        return $result->fetchSingle();
+    }
+    /**
+     * Fetches a complete result as an object.
+     *
+     * @param mixed $result Resultset
+     * @return array|null of stdClass
+     * @throws Exception
+     */
+    public function fetchAll(mixed $result): ?array
+    {
+        $ret = [];
+        if (false === $result) {
+            throw new Exception('Error while fetching result: ' . $this->error());
+        }
+        while ($row = $result->fetchArray(SQLITE3_ASSOC)) {
+            $ret[] = (object)$row;
+        }
+        return $ret;
+    }
+    /**
+     * Returns the error string.
+     */
+    public function error(): string
+    {
+        if (0 === $this->conn->lastErrorCode()) {
+            return '';
+        }
+        return $this->conn->lastErrorMsg();
+    }
+    /**
+     * Logs the queries.
+     */
+    public function log(): string
+    {
+        return $this->sqllog;
+    }
+    /**
+     * This function returns the table status.
+     *
+     * @param string $prefix Table prefix
+     */
+    public function getTableStatus(string $prefix = ''): array
+    {
+        $arr = [];
+        $result = $this->query("SELECT name FROM sqlite_master WHERE type='table' ORDER BY name");
+        while ($row = $this->fetchAssoc($result)) {
+            $num_result = $this->query('SELECT * FROM ' . $row['name']);
+            $arr[$row['name']] = $this->numRows($num_result);
+        }
+        return $arr;
+    }
+    /**
+     * This function sends a query to the database.
+     *
+     * @return \SQLite3Result|bool $result
+     */
+    public function query(string $query, int $offset = 0, int $rowcount = 0): \SQLite3Result|bool
+    {
+        $this->sqllog .= Utils::debug($query);
+        if (0 < $rowcount) {
+            $query .= sprintf(' LIMIT %d,%d', $offset, $rowcount);
+        }
+        $result = $this->conn->query($query);
+        if (!$result) {
+            $this->sqllog .= $this->error();
+        }
+        return $result;
+    }
+    /**
+     * Fetch a result row as an associate array.
+     */
+    public function fetchAssoc(mixed $result): array
+    {
+        $fetchedData = $result->fetchArray(SQLITE3_ASSOC);
+        return is_array($fetchedData) ? $fetchedData : [];
+    }
+    /**
+     * Number of rows in a result.
+     */
+    public function numRows(mixed $result): int
+    {
+        !isset($result->fetchedByPMF) || !$result->fetchedByPMF || die(self::ERROR_MESSAGE);
+        $numberOfRows = 0;
+        while ($result->fetchArray(SQLITE3_NUM)) {
+            ++$numberOfRows;
+        }
+        $result->reset();
+        return $numberOfRows;
+    }
+    /**
+     * Returns an array with all table names.
+     *
+     * @todo Have to be refactored because of https://github.com/thorsten/phpMyFAQ/issues/965
+     *
+     * @param string $prefix Table prefix
+     *
+     * @return string[]
+     */
+    public function getTableNames(string $prefix = ''): array
+    {
+        return $this->tableNames = [
+            $prefix . 'faqadminlog',
+            $prefix . 'faqattachment',
+            $prefix . 'faqattachment_file',
+            $prefix . 'faqbackup',
+            $prefix . 'faqcaptcha',
+            $prefix . 'faqcategories',
+            $prefix . 'faqcategoryrelations',
+            $prefix . 'faqcategory_group',
+            $prefix . 'faqcategory_news',
+            $prefix . 'faqcategory_order',
+            $prefix . 'faqcategory_user',
+            $prefix . 'faqchanges',
+            $prefix . 'faqcomments',
+            $prefix . 'faqconfig',
+            $prefix . 'faqdata',
+            $prefix . 'faqdata_group',
+            $prefix . 'faqdata_revisions',
+            $prefix . 'faqdata_tags',
+            $prefix . 'faqdata_user',
+            $prefix . 'faqglossary',
+            $prefix . 'faqgroup',
+            $prefix . 'faqgroup_right',
+            $prefix . 'faqinstances',
+            $prefix . 'faqinstances_config',
+            $prefix . 'faqmeta',
+            $prefix . 'faqnews',
+            $prefix . 'faqquestions',
+            $prefix . 'faqright',
+            $prefix . 'faqsearches',
+            $prefix . 'faqsessions',
+            $prefix . 'faqstopwords',
+            $prefix . 'faqtags',
+            $prefix . 'faquser',
+            $prefix . 'faquserdata',
+            $prefix . 'faquserlogin',
+            $prefix . 'faquser_group',
+            $prefix . 'faquser_right',
+            $prefix . 'faqvisits',
+            $prefix . 'faqvoting',
+        ];
+    }
+    /**
+     * Returns the next ID of a table.
+     *
+     * @param string $table the name of the table
+     * @param string $id the name of the ID column
+     */
+    public function nextId(string $table, string $id): int
+    {
+        $result = (int)$this->conn->querySingle(
+            sprintf(
+                'SELECT max(%s) AS current_id FROM %s',
+                $id,
+                $table
+            )
+        );
+        return ($result + 1);
+    }
+    /**
+     * Returns the library version string.
+     */
+    public function serverVersion(): string
+    {
+        return $this->clientVersion();
+    }
+    /**
+     * Returns the library version string.
+     */
+    public function clientVersion(): string
+    {
+        $version = \Sqlite3::version();
+        return $version['versionString'];
+    }
+    /**
+     * Closes the connection to the database.
+     */
+    public function close(): bool
+    {
+        return $this->conn->close();
+    }
+    public function now(): string
+    {
+        return "DATETIME('now', 'localtime')";
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Database/Sqlsrv.php
@@ -0,0 +1,321 @@
+<?php
+/**
+ * The phpMyFAQ\Db_Sqlsrv class provides methods and functions for SQL Server Driver
+ * for PHP from Microsoft for Microsoft SQL Server 2012 or later.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2009-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2009-02-18
+ */
+namespace phpMyFAQ\Database;
+use Exception;
+use phpMyFAQ\Database;
+use phpMyFAQ\Utils;
+/**
+ * Class Sqlsrv
+ *
+ * @package phpMyFAQ\Database
+ */
+class Sqlsrv implements DatabaseDriver
+{
+    /** @var string[] Tables */
+    public array $tableNames = [];
+    /** @var resource|bool */
+    private $conn = false;
+    /** The query log string. */
+    private string $sqllog = '';
+    /**
+     * Connection options array.
+     */
+    private array $connectionOptions = [];
+    /**
+     * Connects to the database.
+     * This function connects to a MySQL database
+     *
+     * @param string   $host A string specifying the name of the server to which a connection is being established
+     * @param string   $user Specifies the User ID to be used when connecting with SQL Server Authentication
+     * @param string   $password Specifies the password associated with the User ID to be used when connecting with
+     *                         SQL Server Authentication
+     * @param string   $database Specifies the name of the database in use for the connection being established
+     * @param int|null $port
+     * @return bool|null true, if connected, otherwise false
+     */
+    public function connect(
+        string $host,
+        string $user,
+        string $password,
+        string $database = '',
+        int $port = null
+    ): ?bool {
+        $this->setConnectionOptions($user, $password, $database);
+        $this->conn = sqlsrv_connect($host . ', ' . $port, $this->connectionOptions);
+        if (!$this->conn) {
+            Database::errorPage($this->formatErrors(sqlsrv_errors()));
+            die();
+        }
+        return true;
+    }
+    /**
+     * Escapes a string for use in a query.
+     *
+     * @param string $string String
+     */
+    public function escape(string $string): string
+    {
+        return str_replace("'", "''", $string);
+    }
+    /**
+     * Fetch a result row as an assoc array.
+     *
+     * @param mixed $result Resultset
+     */
+    public function fetchArray(mixed $result): ?array
+    {
+        $fetchedData = sqlsrv_fetch_array($result, SQLSRV_FETCH_ASSOC);
+        return is_array($fetchedData) ? $fetchedData : [];
+    }
+    /**
+     * Fetch a result row.
+     */
+    public function fetchRow(mixed $result): mixed
+    {
+        return $this->fetchArray($result)[0];
+    }
+    /**
+     * Fetches a complete result as an object.
+     *
+     * @param mixed $result Resultset
+     * @throws Exception
+     */
+    public function fetchAll(mixed $result): ?array
+    {
+        $ret = [];
+        if (false === $result) {
+            throw new Exception('Error while fetching result: ' . $this->error());
+        }
+        while ($row = $this->fetchObject($result)) {
+            $ret[] = $row;
+        }
+        return $ret;
+    }
+    /**
+     * Returns the error string.
+     */
+    public function error(): string
+    {
+        $errors = sqlsrv_errors();
+        if (null !== $errors) {
+            return $errors[0]['SQLSTATE'] . ': ' . $errors[0]['message'];
+        }
+        return '';
+    }
+    /**
+     * Fetch a result row as an object.
+     *
+     * @param mixed $result Results
+     */
+    public function fetchObject(mixed $result): mixed
+    {
+        return sqlsrv_fetch_object($result);
+    }
+    /**
+     * Number of rows in a result.
+     *
+     * @param mixed $result Resultset
+     */
+    public function numRows(mixed $result): int
+    {
+        return sqlsrv_num_rows($result);
+    }
+    /**
+     * Logs the queries.
+     */
+    public function log(): string
+    {
+        return $this->sqllog;
+    }
+    /**
+     * This function returns the table status.
+     *
+     * @param string $prefix Table prefix
+     */
+    public function getTableStatus(string $prefix = ''): array
+    {
+        $tables = [];
+        $query = "
+            SELECT
+                obj.name AS table_name,
+                idx.rows AS table_rows
+            FROM
+                sysobjects obj, sysindexes idx
+            WHERE
+                    idx.id = OBJECT_ID(obj.name)
+                AND idx.indid < 2
+                AND obj.xtype = 'U'
+            ORDER BY obj.name";
+        $result = $this->query($query);
+        while ($row = $this->fetchObject($result)) {
+            $tables[$row->table_name] = $row->table_rows;
+        }
+        return $tables;
+    }
+    /**
+     * This function sends a query to the database.
+     *
+     *
+     * @return mixed $result
+     */
+    public function query(string $query, int $offset = 0, int $rowcount = 0): mixed
+    {
+        $this->sqllog .= Utils::debug($query);
+        $options = ['Scrollable' => SQLSRV_CURSOR_KEYSET];
+        if (0 < $rowcount) {
+            $query .= sprintf(' OFFSET %d ROWS FETCH NEXT %d ROWS ONLY', $offset, $rowcount);
+        }
+        $result = sqlsrv_query($this->conn, $query, [], $options);
+        if (!$result) {
+            $this->sqllog .= $this->error();
+        }
+        return $result;
+    }
+    /**
+     * Returns the next ID of a table.
+     *
+     * @param string $table the name of the table
+     * @param string $id    the name of the ID column
+     */
+    public function nextId(string $table, string $id): int
+    {
+        $select = sprintf(
+            '
+           SELECT 
+               max(%s) as current_id
+           FROM 
+               %s',
+            $id,
+            $table
+        );
+        $result = $this->query($select);
+        sqlsrv_fetch($result);
+        return (sqlsrv_get_field($result, 0) + 1);
+    }
+    /**
+     * Returns the library version string.
+     */
+    public function clientVersion(): string
+    {
+        $client_info = sqlsrv_client_info($this->conn);
+        return $client_info['DriverODBCVer'] . ' ' . $client_info['DriverVer'];
+    }
+    /**
+     * Returns the library version string.
+     */
+    public function serverVersion(): string
+    {
+        $server_info = sqlsrv_server_info($this->conn);
+        return $server_info['SQLServerVersion'];
+    }
+    /**
+     * Returns an array with all table names.
+     *
+     * @todo Have to be refactored because of https://github.com/thorsten/phpMyFAQ/issues/965
+     *
+     * @param string $prefix Table prefix
+     */
+    public function getTableNames(string $prefix = ''): array
+    {
+        return $this->tableNames = [
+            $prefix . 'faqadminlog',
+            $prefix . 'faqattachment',
+            $prefix . 'faqattachment_file',
+            $prefix . 'faqbackup',
+            $prefix . 'faqcaptcha',
+            $prefix . 'faqcategories',
+            $prefix . 'faqcategoryrelations',
+            $prefix . 'faqcategory_group',
+            $prefix . 'faqcategory_news',
+            $prefix . 'faqcategory_order',
+            $prefix . 'faqcategory_user',
+            $prefix . 'faqchanges',
+            $prefix . 'faqcomments',
+            $prefix . 'faqconfig',
+            $prefix . 'faqdata',
+            $prefix . 'faqdata_group',
+            $prefix . 'faqdata_revisions',
+            $prefix . 'faqdata_tags',
+            $prefix . 'faqdata_user',
+            $prefix . 'faqglossary',
+            $prefix . 'faqgroup',
+            $prefix . 'faqgroup_right',
+            $prefix . 'faqinstances',
+            $prefix . 'faqinstances_config',
+            $prefix . 'faqmeta',
+            $prefix . 'faqnews',
+            $prefix . 'faqquestions',
+            $prefix . 'faqright',
+            $prefix . 'faqsearches',
+            $prefix . 'faqsessions',
+            $prefix . 'faqstopwords',
+            $prefix . 'faqtags',
+            $prefix . 'faquser',
+            $prefix . 'faquserdata',
+            $prefix . 'faquserlogin',
+            $prefix . 'faquser_group',
+            $prefix . 'faquser_right',
+            $prefix . 'faqvisits',
+            $prefix . 'faqvoting',
+        ];
+    }
+    /**
+     * Closes the connection to the database.
+     */
+    public function close(): void
+    {
+        sqlsrv_close($this->conn);
+    }
+    public function now(): string
+    {
+        return 'GETDATE()';
+    }
+    /**
+     * Sets the connection options.
+     *
+     * @param string $user Specifies the User ID to be used when connecting with SQL Server Authentication
+     * @param string $password Specifies the password associated with the User ID to be used when connecting with
+     *                         SQL Server Authentication
+     * @param string $database Specifies the name of the database in use for the connection being established
+     */
+    private function setConnectionOptions(string $user, string $password, string $database): void
+    {
+        $this->connectionOptions = [
+            'UID' => $user,
+            'PWD' => $password,
+            'Database' => $database,
+            'CharacterSet' => 'UTF-8',
+            'TrustServerCertificate' => true, // even trust self-signed certificates
+        ];
+    }
+    /**
+     * Formats the error output
+     */
+    private function formatErrors(array $errors): string
+    {
+        $error = '<h3>SQL Error:</h3>' . 'MS SQL Error information: <br/>';
+        foreach ($errors as $error) {
+            $error .= sprintf(
+                'SQLSTATE: %s<br/>Code: %s<br/>Message: %s<br/>',
+                $error['SQLSTATE'],
+                $error['code'],
+                $error['message']
+            );
+        }
+        return $error;
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Faq.php
@@ -0,0 +1,2326 @@
+<?php
+/**
+ * The main FAQ class. Yes, it's very huge.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @author    Matteo Scaramuccia <matteo@scaramuccia.com>
+ * @author    Georgi Korchev <korchev@yahoo.com>
+ * @author    Adrianna Musiol <musiol@imageaccess.de>
+ * @author    Peter Caesar <p.caesar@osmaco.de>
+ * @copyright 2005-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2005-12-20
+ */
+namespace phpMyFAQ;
+use DateTimeInterface;
+use Exception;
+use phpMyFAQ\Attachment\AttachmentFactory;
+use phpMyFAQ\Entity\FaqEntity;
+use phpMyFAQ\Helper\FaqHelper;
+use phpMyFAQ\Instance\Elasticsearch;
+use phpMyFAQ\Language\Plurals;
+/*
+ * SQL constants definitions
+ */
+define('FAQ_SQL_ACTIVE_YES', 'yes');
+define('FAQ_SQL_ACTIVE_NO', 'no');
+/*
+ * Query type definitions
+ */
+define('FAQ_QUERY_TYPE_DEFAULT', 'faq_default');
+define('FAQ_QUERY_TYPE_APPROVAL', 'faq_approval');
+define('FAQ_QUERY_TYPE_EXPORT_PDF', 'faq_export_pdf');
+define('FAQ_QUERY_TYPE_EXPORT_XHTML', 'faq_export_xhtml');
+define('FAQ_QUERY_TYPE_EXPORT_XML', 'faq_export_xml');
+/*
+ * Sorting type definitions
+ */
+define('FAQ_SORTING_TYPE_NONE', 0);
+define('FAQ_SORTING_TYPE_CATID_FAQID', 1);
+define('FAQ_SORTING_TYPE_FAQTITLE_FAQID', 2);
+define('FAQ_SORTING_TYPE_DATE_FAQID', 3);
+define('FAQ_SORTING_TYPE_FAQID', 4);
+/**
+ * Class Faq
+ *
+ * @package phpMyFAQ
+ */
+class Faq
+{
+    /**
+     * The current FAQ record.
+     */
+    public array $faqRecord = [];
+    /**
+     * All current FAQ records in an array.
+     */
+    public array $faqRecords = [];
+    /**
+     * Plural form support.
+     */
+    private readonly Plurals $plurals;
+    /**
+     * Users.
+     */
+    private int $user = -1;
+    /**
+     * Groups.
+     *
+     * @var int[]
+     */
+    private array $groups = [-1];
+    /**
+     * Flag for Group support.
+     */
+    private bool $groupSupport = false;
+    /**
+     * Constructor.
+     */
+    public function __construct(private readonly Configuration $config)
+    {
+        $this->plurals = new Plurals();
+        if ($this->config->get('security.permLevel') !== 'basic') {
+            $this->groupSupport = true;
+        }
+    }
+    public function setUser(int $userId = -1): Faq
+    {
+        $this->user = $userId;
+        return $this;
+    }
+    /**
+     * @param int[] $groups
+     */
+    public function setGroups(array $groups): Faq
+    {
+        $this->groups = $groups;
+        return $this;
+    }
+    /**
+     * This function returns all not expired records from one category.
+     *
+     * @param int    $categoryId Entity ID
+     * @param string $orderBy    Order by
+     * @param string $sortBy     Sort by
+     *
+     * @throws Exception
+     */
+    public function getAllFaqsByCategoryId(
+        int $categoryId,
+        string $orderBy = 'id',
+        string $sortBy = 'ASC',
+        bool $preview = true
+    ): array {
+        global $sids;
+        $faqData = [];
+        if ($orderBy == 'visits') {
+            $currentTable = 'fv';
+        } else {
+            $currentTable = 'fd';
+        }
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema,
+                fd.content AS record_content,
+                fd.updated AS updated,
+                fcr.category_id AS category_id,
+                fv.visits AS visits,
+                fd.created AS created
+            FROM
+                %sfaqdata AS fd
+            LEFT JOIN
+                %sfaqcategoryrelations AS fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqvisits AS fv
+            ON
+                fd.id = fv.id
+            AND
+                fv.lang = fd.lang
+            LEFT JOIN
+                %sfaqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.date_start <= '%s'
+            AND
+                fd.date_end   >= '%s'
+            AND
+                fd.active = 'yes'
+            AND
+                fcr.category_id = %d
+            AND
+                fd.lang = '%s'
+                %s
+            ORDER BY
+                %s.%s %s",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $now,
+            $now,
+            $categoryId,
+            $this->config->getLanguage()->getLanguage(),
+            $this->queryPermission($this->groupSupport),
+            $currentTable,
+            $this->config->getDb()->escape($orderBy),
+            $this->config->getDb()->escape($sortBy)
+        );
+        $result = $this->config->getDb()->query($query);
+        $num = $this->config->getDb()->numRows($result);
+        if ($num > 0) {
+            $faqHelper = new FaqHelper($this->config);
+            while (($row = $this->config->getDb()->fetchObject($result))) {
+                if (empty($row->visits)) {
+                    $visits = 0;
+                } else {
+                    $visits = $row->visits;
+                }
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&cat=%d&id=%d&artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $oLink->text = $oLink->tooltip = $row->thema;
+                if ($preview) {
+                    $faqData[] = [
+                        'record_id' => $row->id,
+                        'record_lang' => $row->lang,
+                        'category_id' => $row->category_id,
+                        'record_title' => $row->thema,
+                        'record_preview' => $faqHelper->renderAnswerPreview($row->record_content, 25),
+                        'record_link' => $oLink->toString(),
+                        'record_updated' => $row->updated,
+                        'visits' => $visits,
+                        'record_created' => $row->created,
+                    ];
+                } else {
+                    $faqData[] = [
+                        'faq_id' => $row->id,
+                        'faq_lang' => $row->lang,
+                        'category_id' => $row->category_id,
+                        'question' => $row->thema,
+                        'answer' => $row->record_content,
+                        'link' => $oLink->toString(),
+                        'updated' => $row->updated,
+                        'visits' => $visits,
+                        'created' => $row->created,
+                    ];
+                }
+            }
+        } else {
+            return $faqData;
+        }
+        return $faqData;
+    }
+    /**
+     * Returns a part of a query to check permissions.
+     *
+     *
+     */
+    protected function queryPermission(bool $hasGroupSupport = false): string
+    {
+        if ($hasGroupSupport) {
+            if (-1 === $this->user) {
+                return sprintf(
+                    'AND fdg.group_id IN (%s)',
+                    implode(', ', $this->groups)
+                );
+            } else {
+                return sprintf(
+                    'AND ( fdu.user_id = %d OR fdg.group_id IN (%s) )',
+                    $this->user,
+                    implode(', ', $this->groups)
+                );
+            }
+        }
+        if (-1 !== $this->user) {
+            return sprintf(
+                'AND ( fdu.user_id = %d OR fdu.user_id = -1 )',
+                $this->user
+            );
+        } else {
+            return 'AND fdu.user_id = -1';
+        }
+    }
+    /**
+     * This function returns all not expired records from one category.
+     *
+     * @param int    $categoryId Entity ID
+     * @param string $orderBy    Order by
+     * @param string $sortBy     Sort by
+     */
+    public function renderRecordsByCategoryId(int $categoryId, string $orderBy = 'id', string $sortBy = 'ASC'): string
+    {
+        global $sids;
+        $numPerPage = $this->config->get('records.numberOfRecordsPerPage');
+        $page = Filter::filterInput(INPUT_GET, 'seite', FILTER_VALIDATE_INT, 1);
+        $output = '';
+        $title = '';
+        if ($orderBy == 'visits') {
+            $currentTable = 'fv';
+        } else {
+            $currentTable = 'fd';
+        }
+        if (true === $this->config->get('records.randomSort')) {
+            $order = '';
+        } else {
+            $order = sprintf(
+                'ORDER BY fd.sticky DESC, %s.%s %s',
+                $currentTable,
+                $this->config->getDb()->escape($orderBy),
+                $this->config->getDb()->escape($sortBy)
+            );
+        }
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.sticky AS sticky,
+                fd.thema AS question,
+                fd.content as answer,
+                fcr.category_id AS category_id,
+                fv.visits AS visits
+            FROM
+                %sfaqdata AS fd
+            LEFT JOIN
+                %sfaqcategoryrelations AS fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqvisits AS fv
+            ON
+                fd.id = fv.id
+            AND
+                fv.lang = fd.lang
+            LEFT JOIN
+                %sfaqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.date_start <= '%s'
+            AND
+                fd.date_end   >= '%s'
+            AND
+                fd.active = 'yes'
+            AND
+                fcr.category_id = %d
+            AND
+                fd.lang = '%s'
+            %s
+            %s",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $now,
+            $now,
+            $categoryId,
+            $this->config->getLanguage()->getLanguage(),
+            $this->queryPermission($this->groupSupport),
+            $order
+        );
+        $result = $this->config->getDb()->query($query);
+        $num = $this->config->getDb()->numRows($result);
+        $pages = (int)ceil($num / $numPerPage);
+        if ($page == 1) {
+            $first = 0;
+        } else {
+            $first = $page * $numPerPage - $numPerPage;
+        }
+        if ($num > 0) {
+            if ($pages > 1) {
+                $output .= sprintf(
+                    '<p>%s <strong>%d</strong> %s <strong>%d</strong> %s</p>',
+                    Translation::get('msgPage'),
+                    $page,
+                    Translation::get('msgVoteFrom'),
+                    $pages,
+                    Translation::get('msgPages')
+                );
+            }
+            $output .= '<ul class="list-group list-group-flush mb-4">';
+            $counter = 0;
+            $displayedCounter = 0;
+            $renderedItems = [];
+            while (($row = $this->config->getDb()->fetchObject($result)) && $displayedCounter < $numPerPage) {
+                ++$counter;
+                if ($counter <= $first) {
+                    continue;
+                }
+                ++$displayedCounter;
+                if (empty($row->visits)) {
+                    $visits = 0;
+                } else {
+                    $visits = $row->visits;
+                }
+                $title = Strings::htmlentities($row->question);
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $oLink->text = $oLink->tooltip = $title;
+                $oLink->class = 'text-decoration-none';
+                if (true === $this->config->get('records.randomSort')) {
+                    $row->sticky = 0;
+                }
+                $renderedItems[$row->id] = sprintf(
+                    '<li class="list-group-item d-flex justify-content-between align-items-start %s">',
+                    ($row->sticky) ? 'list-group-item-primary rounded mb-3' : ''
+                );
+                $renderedItems[$row->id] .= sprintf(
+                    '<div class="ms-2 me-auto"><div class="fw-bold">%s</div><div class="small">%s</div></div>',
+                    $oLink->toHtmlAnchor(),
+                    Utils::chopString(strip_tags((string) $row->answer), 20)
+                );
+                $renderedItems[$row->id] .= sprintf(
+                    '<span id="viewsPerRecord" class="badge bg-primary rounded-pill">%s</span></li>',
+                    $this->plurals->getMsg('plmsgViews', $visits)
+                );
+            }
+            if (true === $this->config->get('records.randomSort')) {
+                shuffle($renderedItems);
+            }
+            $output .= implode("\n", $renderedItems);
+            $output .= '</ul>';
+        } else {
+            return false;
+        }
+        if ($pages > 1) {
+            if ($this->config->get('main.enableRewriteRules')) {
+                $link = new Link($this->config->getDefaultUrl(), $this->config);
+                $useRewrite = true;
+                $rewriteUrl = sprintf(
+                    '%scategory/%d/%%d/%s.html',
+                    $this->config->getDefaultUrl(),
+                    $categoryId,
+                    $link->getSEOItemTitle($title)
+                );
+            } else {
+                $useRewrite = false;
+                $rewriteUrl = '';
+            }
+            $baseUrl = sprintf(
+                '%sindex.php?%saction=show&amp;cat=%d&amp;seite=%d',
+                $this->config->getDefaultUrl(),
+                (empty($sids) ? '' : $sids),
+                $categoryId,
+                $page
+            );
+            $options = [
+                'baseUrl' => $baseUrl,
+                'total' => $num,
+                'perPage' => $this->config->get('records.numberOfRecordsPerPage'),
+                'useRewrite' => $useRewrite,
+                'rewriteUrl' => $rewriteUrl,
+                'pageParamName' => 'seite'
+            ];
+            $pagination = new Pagination($options);
+            $output .= $pagination->render();
+        }
+        return $output;
+    }
+    /**
+     * This function returns all not expired records from the given record ids.
+     *
+     * @param array  $recordIds Array of record ids
+     * @param string $orderBy   Order by
+     * @param string $sortBy    Sort by
+     */
+    public function renderRecordsByFaqIds(array $recordIds, string $orderBy = 'fd.id', string $sortBy = 'ASC'): string
+    {
+        global $sids;
+        $records = implode(', ', $recordIds);
+        $page = Filter::filterInput(INPUT_GET, 'seite', FILTER_VALIDATE_INT, 1);
+        $taggingId = Filter::filterInput(INPUT_GET, 'tagging_id', FILTER_VALIDATE_INT);
+        $output = '';
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema,
+                fcr.category_id AS category_id,
+                fv.visits AS visits
+            FROM
+                %sfaqdata AS fd
+            LEFT JOIN
+                %sfaqcategoryrelations AS fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqvisits AS fv
+            ON
+                fd.id = fv.id
+            AND
+                fv.lang = fd.lang
+            LEFT JOIN
+                %sfaqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.date_start <= '%s'
+            AND
+                fd.date_end   >= '%s'
+            AND
+                fd.active = 'yes'
+            AND
+                fd.id IN (%s)
+            AND
+                fd.lang = '%s'
+                %s
+            ORDER BY
+                %s %s",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $now,
+            $now,
+            $records,
+            $this->config->getLanguage()->getLanguage(),
+            $this->queryPermission($this->groupSupport),
+            $this->config->getDb()->escape($orderBy),
+            $this->config->getDb()->escape($sortBy)
+        );
+        $result = $this->config->getDb()->query($query);
+        $num = $this->config->getDb()->numRows($result);
+        $pages = ceil($num / $this->config->get('records.numberOfRecordsPerPage'));
+        if ($page == 1) {
+            $first = 0;
+        } else {
+            $first = ($page * $this->config->get('records.numberOfRecordsPerPage')) -
+                $this->config->get('records.numberOfRecordsPerPage');
+        }
+        if ($num > 0) {
+            if ($pages > 1) {
+                $output .= sprintf(
+                    '<p><strong>%s %s %s</strong></p>',
+                    Translation::get('msgPage') . $page,
+                    Translation::get('msgVoteFrom'),
+                    $pages . Translation::get('msgPages')
+                );
+            }
+            $output .= '<ul class="phpmyfaq_ul">';
+            $counter = 0;
+            $displayedCounter = 0;
+            $lastFaqId = 0;
+            while (
+                ($row = $this->config->getDb()->fetchObject($result)) &&
+                $displayedCounter < $this->config->get('records.numberOfRecordsPerPage')
+            ) {
+                ++$counter;
+                if ($counter <= $first) {
+                    continue;
+                }
+                ++$displayedCounter;
+                if ($lastFaqId == $row->id) {
+                    continue; // Don't show multiple FAQs
+                }
+                if (empty($row->visits)) {
+                    $visits = 0;
+                } else {
+                    $visits = $row->visits;
+                }
+                $title = $row->thema;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $row->thema;
+                $oLink->text = $title;
+                $oLink->tooltip = $title;
+                $listItem = sprintf(
+                    '<li>%s<br><small>(%s)</small></li>',
+                    $oLink->toHtmlAnchor(),
+                    $this->plurals->GetMsg('plmsgViews', $visits)
+                );
+                $output .= $listItem;
+                $lastFaqId = $row->id;
+            }
+            $output .= '</ul><span id="totFaqRecords" style="display: none;">' . $num . '</span>';
+        } else {
+            return false;
+        }
+        if ($num > $this->config->get('records.numberOfRecordsPerPage')) {
+            $output .= '<p class="text-center"><strong>';
+            if (!isset($page)) {
+                $page = 1;
+            }
+            $vor = $page - 1;
+            $next = $page + 1;
+            if ($vor != 0) {
+                $url = $sids . '&amp;action=search&amp;tagging_id=' . $taggingId . '&amp;seite=' . $vor;
+                $oLink = new Link($this->config->getDefaultUrl() . '?' . $url, $this->config);
+                $oLink->itemTitle = 'tag';
+                $oLink->text = Translation::get('msgPrevious');
+                $oLink->tooltip = Translation::get('msgPrevious');
+                $output .= '[ ' . $oLink->toHtmlAnchor() . ' ]';
+            }
+            $output .= ' ';
+            if ($next <= $pages) {
+                $url = $sids . '&amp;action=search&amp;tagging_id=' . $taggingId . '&amp;seite=' . $next;
+                $oLink = new Link($this->config->getDefaultUrl() . '?' . $url, $this->config);
+                $oLink->itemTitle = 'tag';
+                $oLink->text = Translation::get('msgNext');
+                $oLink->tooltip = Translation::get('msgNext');
+                $output .= '[ ' . $oLink->toHtmlAnchor() . ' ]';
+            }
+            $output .= '</strong></p>';
+        }
+        return $output;
+    }
+    /**
+     * Returns an array with all data from a FAQ record.
+     *
+     * @param int      $faqId FAQ ID
+     * @param int|null $faqRevisionId Revision ID
+     * @param bool     $isAdmin Must be true if it is called by an admin/author context
+     */
+    public function getRecord(int $faqId, int $faqRevisionId = null, bool $isAdmin = false)
+    {
+        $currentLanguage = $this->config->getLanguage()->getLanguage();
+        $defaultLanguage = $this->config->getDefaultLanguage();
+        $result = $this->getRecordResult($faqId, $currentLanguage, $faqRevisionId, $isAdmin);
+        if (0 === $this->config->getDb()->numRows($result)) {
+            $result = $this->getRecordResult($faqId, $defaultLanguage, $faqRevisionId, $isAdmin);
+        }
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            $question = nl2br((string) $row->thema);
+            $answer = $row->content;
+            $active = ('yes' === $row->active);
+            $expired = (date('YmdHis') > $row->date_end);
+            if (!$isAdmin) {
+                if (!$active) {
+                    $answer = Translation::get('err_inactiveArticle');
+                }
+                if ($expired) {
+                    $answer = Translation::get('err_expiredArticle');
+                }
+            }
+            $this->faqRecord = [
+                'id' => $row->id,
+                'lang' => $row->lang,
+                'solution_id' => $row->solution_id,
+                'revision_id' => $row->revision_id,
+                'active' => $row->active,
+                'sticky' => $row->sticky,
+                'keywords' => $row->keywords,
+                'title' => $question,
+                'content' => $answer,
+                'author' => $row->author,
+                'email' => $row->email,
+                'comment' => $row->comment,
+                'date' => Date::createIsoDate($row->updated),
+                'dateStart' => $row->date_start,
+                'dateEnd' => $row->date_end,
+                'notes' => $row->notes,
+                'created' => $row->created,
+            ];
+        } else {
+            $this->faqRecord = [
+                'id' => $faqId,
+                'lang' => $currentLanguage,
+                'solution_id' => 42,
+                'revision_id' => $faqRevisionId,
+                'active' => 'no',
+                'sticky' => 0,
+                'keywords' => '',
+                'title' => '',
+                'content' => Translation::get('msgAccessDenied'),
+                'author' => '',
+                'email' => '',
+                'comment' => '',
+                'date' => Date::createIsoDate(date('YmdHis')),
+                'dateStart' => '',
+                'dateEnd' => '',
+                'notes' => '',
+                'created' => date('c'),
+            ];
+        }
+    }
+    /**
+     * Executes a query to retrieve a single FAQ.
+     *
+     * @param int|null $faqRevisionId
+     */
+    public function getRecordResult(
+        int $faqId,
+        string $faqLanguage,
+        int $faqRevisionId = null,
+        bool $isAdmin = false
+    ): mixed {
+        $query = sprintf(
+            "SELECT
+                 id, lang, solution_id, revision_id, active, sticky, keywords,
+                 thema, content, author, email, comment, updated, date_start, 
+                 date_end, created, notes
+            FROM
+                %s%s fd
+            LEFT JOIN
+                %sfaqdata_group fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.id = %d
+            %s
+            AND
+                fd.lang = '%s'
+                %s",
+            Database::getTablePrefix(),
+            isset($faqRevisionId) ? 'faqdata_revisions' : 'faqdata',
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $faqId,
+            isset($faqRevisionId) ? 'AND revision_id = ' . $faqRevisionId : '',
+            $faqLanguage,
+            ($isAdmin) ? 'AND 1=1' : $this->queryPermission($this->groupSupport)
+        );
+        return $this->config->getDb()->query($query);
+    }
+    /**
+     * Return records from given IDs
+     *
+     * @throws Exception
+     */
+    public function getRecordsByIds(array $faqIds): array
+    {
+        $faqRecords = [];
+        $query = sprintf(
+            "SELECT
+                 fd.id AS id,
+                 fd.lang AS lang,
+                 fd.thema AS question,
+                 fd.content AS answer,
+                 fd.updated AS updated,
+                 fd.created AS created,
+                 fcr.category_id AS category_id,
+                 fv.visits AS visits
+            FROM
+                %sfaqdata fd
+            LEFT JOIN
+                %sfaqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqdata_group fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqvisits AS fv
+            ON
+                fd.id = fv.id
+            AND
+                fv.lang = fd.lang
+            LEFT JOIN
+                %sfaqdata_user fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.id IN (%s)
+            AND
+                fd.lang = '%s'
+                %s",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            implode(',', $faqIds),
+            $this->config->getLanguage()->getLanguage(),
+            $this->queryPermission($this->groupSupport)
+        );
+        $result = $this->config->getDb()->query($query);
+        $faqHelper = new FaqHelper($this->config);
+        while ($row = $this->config->getDb()->fetchObject($result)) {
+            if (empty($row->visits)) {
+                $visits = 0;
+            } else {
+                $visits = $row->visits;
+            }
+            $url = sprintf(
+                '%sindex.php?action=faq&cat=%d&id=%d&artlang=%s',
+                $this->config->getDefaultUrl(),
+                $row->category_id,
+                $row->id,
+                $row->lang
+            );
+            $oLink = new Link($url, $this->config);
+            $oLink->itemTitle = $oLink->text = $oLink->tooltip = $row->question;
+            $faqRecords[] = [
+                'record_id' => (int)$row->id,
+                'record_lang' => $row->lang,
+                'category_id' => (int)$row->category_id,
+                'record_title' => $row->question,
+                'record_preview' => $faqHelper->renderAnswerPreview($row->answer, 25),
+                'record_link' => $oLink->toString(),
+                'record_updated' => Date::createIsoDate($row->updated) . ':00',
+                'visits' => (int)$visits,
+                'record_created' => $row->created
+            ];
+        }
+        return $faqRecords;
+    }
+    /**
+     * Creates a new FAQ.
+     */
+    public function create(FaqEntity $faq): int
+    {
+        if (is_null($faq->getId())) {
+            $faq->setId($this->config->getDb()->nextId(Database::getTablePrefix() . 'faqdata', 'id'));
+        }
+        $query = sprintf(
+            "INSERT INTO %sfaqdata 
+            (id, lang, solution_id, revision_id, active, sticky, keywords, thema, content, author, email, comment, 
+            updated, date_start, date_end, created, notes)
+            VALUES
+            (%d, '%s', %d, %d, '%s', %d, '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s', '%s')",
+            Database::getTablePrefix(),
+            $faq->getId(),
+            $this->config->getDb()->escape($faq->getLanguage()),
+            $this->getNextSolutionId(),
+            0,
+            $faq->isActive() ? 'yes' : 'no',
+            $faq->isSticky() ? 1 : 0,
+            $this->config->getDb()->escape($faq->getKeywords()),
+            $this->config->getDb()->escape($faq->getQuestion()),
+            $this->config->getDb()->escape($faq->getAnswer()),
+            $this->config->getDb()->escape($faq->getAuthor()),
+            $this->config->getDb()->escape($faq->getEmail()),
+            $faq->isComment() ? 'y' : 'n',
+            date('YmdHis'),
+            '00000000000000',
+            '99991231235959',
+            date('Y-m-d H:i:s'),
+            $this->config->getDb()->escape($faq->getNotes())
+        );
+        $this->config->getDb()->query($query);
+        return $faq->getId();
+    }
+    /**
+     * Gets the latest solution id for a FAQ record.
+     */
+    public function getNextSolutionId(): int
+    {
+        $latestId = 0;
+        $query = sprintf('SELECT MAX(solution_id) AS solution_id FROM %sfaqdata', Database::getTablePrefix());
+        $result = $this->config->getDb()->query($query);
+        if ($result && $row = $this->config->getDb()->fetchObject($result)) {
+            $latestId = $row->solution_id;
+        }
+        if ($latestId < PMF_SOLUTION_ID_START_VALUE) {
+            $nextSolutionId = PMF_SOLUTION_ID_START_VALUE;
+        } else {
+            $nextSolutionId = $latestId + PMF_SOLUTION_ID_INCREMENT_VALUE;
+        }
+        return $nextSolutionId;
+    }
+    public function update(FaqEntity $faq): bool
+    {
+        $query = sprintf(
+            "UPDATE %sfaqdata SET
+            revision_id = %d,
+            active = '%s',
+            sticky = %d,
+            keywords = '%s',
+            thema = '%s',
+            content = '%s',
+            author = '%s',
+            email = '%s',
+            comment = '%s',
+            date_start = '%s',
+            date_end = '%s',
+            notes = '%s'",
+            Database::getTablePrefix(),
+            $faq->getRevisionId(),
+            $faq->isActive() ? 'yes' : 'no',
+            $faq->isSticky() ? 1 : 0,
+            $this->config->getDb()->escape($faq->getKeywords()),
+            $this->config->getDb()->escape($faq->getQuestion()),
+            $this->config->getDb()->escape($faq->getAnswer()),
+            $this->config->getDb()->escape($faq->getAuthor()),
+            $this->config->getDb()->escape($faq->getEmail()),
+            $faq->isComment() ? 'y' : 'n',
+            $faq->getValidFrom()->format('YmdHis'),
+            $faq->getValidTo()->format('YmdHis'),
+            $this->config->getDb()->escape($faq->getNotes())
+        );
+        if ($faq->getUpdatedDate() !== null) {
+            $query .= sprintf(", updated = '%s'", $faq->getUpdatedDate()->format('YmdHis'));
+        }
+        $query .= sprintf(
+            " WHERE id = %d AND lang = '%s'",
+            $faq->getId(),
+            $this->config->getDb()->escape($faq->getLanguage())
+        );
+        return (bool) $this->config->getDb()->query($query);
+    }
+    /**
+     * Deletes a record and all the dependencies.
+     *
+     * @param int    $recordId   Record id
+     * @param string $recordLang Record language
+     * @throws Attachment\AttachmentException
+     * @throws Attachment\Filesystem\File\FileException
+     */
+    public function deleteRecord(int $recordId, string $recordLang): bool
+    {
+        $solutionId = $this->getSolutionIdFromId($recordId, $recordLang);
+        $queries = [sprintf(
+            "DELETE FROM %sfaqchanges WHERE beitrag = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        ), sprintf(
+            "DELETE FROM %sfaqcategoryrelations WHERE record_id = %d AND record_lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        ), sprintf(
+            "DELETE FROM %sfaqdata WHERE id = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        ), sprintf(
+            "DELETE FROM %sfaqdata_revisions WHERE id = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        ), sprintf(
+            "DELETE FROM %sfaqvisits WHERE id = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        ), sprintf(
+            'DELETE FROM %sfaqdata_user WHERE record_id = %d',
+            Database::getTablePrefix(),
+            $recordId
+        ), sprintf(
+            'DELETE FROM %sfaqdata_group WHERE record_id = %d',
+            Database::getTablePrefix(),
+            $recordId
+        ), sprintf(
+            'DELETE FROM %sfaqdata_tags WHERE record_id = %d',
+            Database::getTablePrefix(),
+            $recordId
+        ), sprintf(
+            'DELETE FROM %sfaqdata_tags WHERE %sfaqdata_tags.record_id NOT IN (SELECT %sfaqdata.id FROM %sfaqdata)',
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix()
+        ), sprintf(
+            'DELETE FROM %sfaqcomments WHERE id = %d',
+            Database::getTablePrefix(),
+            $recordId
+        ), sprintf(
+            'DELETE FROM %sfaqvoting WHERE artikel = %d',
+            Database::getTablePrefix(),
+            $recordId
+        )];
+        foreach ($queries as $query) {
+            $this->config->getDb()->query($query);
+        }
+        $attachments = AttachmentFactory::fetchByRecordId($this->config, $recordId);
+        foreach ($attachments as $attachment) {
+            $currentAttachment = AttachmentFactory::create($attachment->getId());
+            $currentAttachment->delete();
+        }
+        if ($this->config->get('search.enableElasticsearch')) {
+            $esInstance = new Elasticsearch($this->config);
+            $esInstance->delete($solutionId);
+        }
+        return true;
+    }
+    /**
+     * Returns the solution ID from a given ID and language
+     */
+    public function getSolutionIdFromId(int $faqId, string $faqLang): int
+    {
+        $query = sprintf(
+            "
+            SELECT
+                solution_id
+            FROM
+                %sfaqdata
+            WHERE
+                id = %d
+                AND
+                lang = '%s'",
+            Database::getTablePrefix(),
+            $faqId,
+            $this->config->getDb()->escape($faqLang)
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            return $row->solution_id;
+        }
+        return $this->getNextSolutionId();
+    }
+    /**
+     * Checks if a record is already translated.
+     *
+     * @param int    $recordId   Record id
+     * @param string $recordLang Record language
+     */
+    public function hasTranslation(int $recordId, string $recordLang): bool
+    {
+        $query = sprintf(
+            "
+            SELECT
+                id, lang
+            FROM
+                %sfaqdata
+            WHERE
+                id = %d
+            AND
+                lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($this->config->getDb()->numRows($result)) {
+            return true;
+        }
+        return false;
+    }
+    public function isActive(int $recordId, string $recordLang, string $commentType = 'faq'): bool
+    {
+        if ('news' === $commentType) {
+            $table = 'faqnews';
+        } else {
+            $table = 'faqdata';
+        }
+        $query = sprintf(
+            "
+            SELECT
+                active
+            FROM
+                %s%s
+            WHERE
+                id = %d
+            AND
+                lang = '%s'",
+            Database::getTablePrefix(),
+            $table,
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            return !(($row->active === 'y' || $row->active === 'yes'));
+        } else {
+            return true;
+        }
+    }
+    /**
+     * Checks, if comments are disabled for the FAQ record.
+     *
+     * @param int    $recordId    Id of FAQ or news entry
+     * @param string $recordLang  Language
+     * @param string $commentType Type of comment: faq or news
+     * @return bool true, if comments are disabled
+     */
+    public function commentDisabled(int $recordId, string $recordLang, string $commentType = 'faq'): bool
+    {
+        if ('news' === $commentType) {
+            $table = 'faqnews';
+        } else {
+            $table = 'faqdata';
+        }
+        $query = sprintf(
+            "
+            SELECT
+                comment
+            FROM
+                %s%s
+            WHERE
+                id = %d
+            AND
+                lang = '%s'",
+            Database::getTablePrefix(),
+            $table,
+            $recordId,
+            $this->config->getDb()->escape($recordLang)
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            return !(($row->comment === 'y'));
+        } else {
+            return true;
+        }
+    }
+    /**
+     * Returns an array with all data from a FAQ record.
+     *
+     * @param int $solutionId Solution ID
+     */
+    public function getRecordBySolutionId(int $solutionId): void
+    {
+        $query = sprintf(
+            'SELECT
+                fd.*, COALESCE(fdg.group_id, -1) AS group_id, fdu.user_id
+            FROM
+                %sfaqdata fd
+            LEFT JOIN (
+                SELECT record_id, group_id FROM %sfaqdata_group fdg WHERE fdg.group_id <> -1
+                UNION ALL
+                SELECT fd.id AS record_id, -1 AS group_id FROM %sfaqdata fd WHERE fd.solution_id = %d
+            ) AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.solution_id = %d
+                %s',
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $solutionId,
+            Database::getTablePrefix(),
+            $solutionId,
+            $this->queryPermission($this->groupSupport)
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            $question = nl2br((string) $row->thema);
+            $content = $row->content;
+            $active = ('yes' == $row->active);
+            $expired = (date('YmdHis') > $row->date_end);
+            if (!$active) {
+                $content = Translation::get('err_inactiveArticle');
+            }
+            if ($expired) {
+                $content = Translation::get('err_expiredArticle');
+            }
+            $this->faqRecord = [
+                'id' => $row->id,
+                'lang' => $row->lang,
+                'solution_id' => $row->solution_id,
+                'revision_id' => $row->revision_id,
+                'active' => $row->active,
+                'sticky' => $row->sticky,
+                'keywords' => $row->keywords,
+                'title' => $question,
+                'content' => $content,
+                'author' => $row->author,
+                'email' => $row->email,
+                'comment' => $row->comment,
+                'date' => Date::createIsoDate($row->updated),
+                'dateStart' => $row->date_start,
+                'dateEnd' => $row->date_end,
+                'notes' => $row->notes
+            ];
+        }
+    }
+    /**
+     * Gets the record ID from a given solution ID.
+     *
+     * @param int $solutionId Solution ID
+     */
+    public function getIdFromSolutionId(int $solutionId): array
+    {
+        $query = sprintf(
+            '
+            SELECT
+                fd.id,
+                fd.lang,
+                fd.thema AS question,
+                fd.content,
+                fcr.category_id AS category_id
+            FROM
+                %sfaqdata fd
+            LEFT JOIN
+                %sfaqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            WHERE
+                fd.solution_id = %d',
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $solutionId
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($row = $this->config->getDb()->fetchObject($result)) {
+            return [
+                'id' => $row->id,
+                'lang' => $row->lang,
+                'question' => $row->question,
+                'content' => $row->content,
+                'category_id' => $row->category_id
+            ];
+        }
+        return [];
+    }
+    /**
+     * Returns an array with all data from all FAQ records.
+     *
+     * @param int        $sortType  Sorting type
+     * @param array|null $condition Condition
+     * @param ?string     $sortOrder Sorting order
+     */
+    public function getAllRecords(
+        int $sortType = FAQ_SORTING_TYPE_CATID_FAQID,
+        array $condition = null,
+        ?string $sortOrder = 'ASC'
+    ): void {
+        $where = '';
+        if (!is_null($condition)) {
+            $num = count($condition);
+            $where = 'WHERE ';
+            foreach ($condition as $field => $data) {
+                --$num;
+                $where .= $field;
+                if (is_array($data)) {
+                    $where .= ' IN (';
+                    $separator = '';
+                    foreach ($data as $value) {
+                        $where .= $separator . "'" . $this->config->getDb()->escape($value) . "'";
+                        $separator = ', ';
+                    }
+                    $where .= ')';
+                } else {
+                    $where .= " = '" . $this->config->getDb()->escape($data) . "'";
+                }
+                if ($num > 0) {
+                    $where .= ' AND ';
+                }
+            }
+        }
+        $orderBy = match ($sortType) {
+            FAQ_SORTING_TYPE_CATID_FAQID => sprintf('ORDER BY fcr.category_id, fd.id %s', $sortOrder),
+            FAQ_SORTING_TYPE_FAQID => sprintf('ORDER BY fd.id %s', $sortOrder),
+            FAQ_SORTING_TYPE_FAQTITLE_FAQID => sprintf('ORDER BY fcr.category_id, fd.thema %s', $sortOrder),
+            FAQ_SORTING_TYPE_DATE_FAQID => sprintf('ORDER BY fcr.category_id, fd.updated %s', $sortOrder),
+            default => '',
+        };
+        $groupBy = ' group by fd.id, fcr.category_id,fd.solution_id,fd.revision_id,fd.active,fd.sticky,fd.keywords,' .
+            'fd.thema,fd.content,fd.author,fd.email,fd.comment,fd.updated,' .
+            'fd.date_start,fd.date_end,fd.sticky,fd.created,fd.notes,fd.lang ';
+        $query = sprintf(
+            '
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fcr.category_id AS category_id,
+                fd.solution_id AS solution_id,
+                fd.revision_id AS revision_id,
+                fd.active AS active,
+                fd.sticky AS sticky,
+                fd.keywords AS keywords,
+                fd.thema AS thema,
+                fd.content AS content,
+                fd.author AS author,
+                fd.email AS email,
+                fd.comment AS comment,
+                fd.updated AS updated,
+                fd.date_start AS date_start,
+                fd.date_end AS date_end,
+                fd.sticky AS sticky,
+                fd.created AS created,
+                fd.notes AS notes
+            FROM
+                %sfaqdata fd
+            LEFT JOIN
+                %sfaqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            %s
+            %s
+            %s
+            %s',
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $where,
+            $this->queryPermission($this->groupSupport),
+            $groupBy,
+            $orderBy
+        );
+        $result = $this->config->getDb()->query($query);
+        while ($row = $this->config->getDb()->fetchObject($result)) {
+            $content = $row->content;
+            $active = ('yes' == $row->active);
+            $expired = (date('YmdHis') > $row->date_end);
+            if (!$active) {
+                $content = Translation::get('err_inactiveArticle');
+            }
+            if ($expired) {
+                $content = Translation::get('err_expiredArticle');
+            }
+            $this->faqRecords[] = [
+                'id' => $row->id,
+                'category_id' => $row->category_id,
+                'lang' => $row->lang,
+                'solution_id' => $row->solution_id,
+                'revision_id' => $row->revision_id,
+                'active' => $row->active,
+                'sticky' => $row->sticky,
+                'keywords' => $row->keywords,
+                'title' => $row->thema,
+                'content' => $content,
+                'author' => $row->author,
+                'email' => $row->email,
+                'comment' => $row->comment,
+                'updated' => Date::createIsoDate($row->updated, 'Y-m-d H:i:s'),
+                'dateStart' => $row->date_start,
+                'dateEnd' => $row->date_end,
+                'created' => $row->created,
+                'notes' => $row->notes
+            ];
+        }
+    }
+    /**
+     * Returns the FAQ record title from the ID and language.
+     *
+     * @param int $id Record id
+     */
+    public function getRecordTitle(int $id): string
+    {
+        if (isset($this->faqRecord['id']) && ($this->faqRecord['id'] == $id)) {
+            return $this->faqRecord['title'];
+        }
+        $question = '';
+        $query = sprintf(
+            "SELECT thema AS question FROM %sfaqdata WHERE id = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $id,
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($this->config->getDb()->numRows($result) > 0) {
+            while ($row = $this->config->getDb()->fetchObject($result)) {
+                $question = Strings::htmlentities($row->question);
+            }
+        } else {
+            $question = Translation::get('no_cats');
+        }
+        return $question;
+    }
+    /**
+     * Returns the keywords of a FAQ record from the ID and language.
+     *
+     * @param int $id record id
+     */
+    public function getRecordKeywords(int $id): string
+    {
+        if (isset($this->faqRecord['id']) && ($this->faqRecord['id'] == $id)) {
+            return $this->faqRecord['keywords'];
+        }
+        $query = sprintf(
+            "SELECT
+                keywords
+            FROM
+                %sfaqdata
+            WHERE id = %d AND lang = '%s'",
+            Database::getTablePrefix(),
+            $id,
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($this->config->getDb()->numRows($result) > 0) {
+            $row = $this->config->getDb()->fetchObject($result);
+            return Strings::htmlspecialchars($row->keywords, ENT_QUOTES, 'utf-8');
+        } else {
+            return '';
+        }
+    }
+    /**
+     * Returns a answer preview of the FAQ record.
+     *
+     * @param int $recordId  FAQ record ID
+     * @param int $wordCount Number of words, default: 12
+     */
+    public function getRecordPreview(int $recordId, int $wordCount = 12): string
+    {
+        if (isset($this->faqRecord['id']) && ((int)$this->faqRecord['id'] === $recordId)) {
+            $answerPreview = $this->faqRecord['content'];
+            return Utils::makeShorterText($answerPreview, $wordCount);
+        }
+        $query = sprintf(
+            "
+            SELECT
+                content as answer
+            FROM
+                %sfaqdata
+            WHERE 
+                id = %d 
+            AND 
+                lang = '%s'",
+            Database::getTablePrefix(),
+            $recordId,
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($this->config->getDb()->numRows($result) > 0) {
+            $row = $this->config->getDb()->fetchObject($result);
+            $answerPreview = strip_tags((string) $row->answer);
+        } else {
+            $answerPreview = $this->config->get('main.metaDescription');
+        }
+        return Utils::makeShorterText($answerPreview, $wordCount);
+    }
+    /**
+     * Returns the number of activated and not expired records, optionally
+     * not limited to the current language.
+     *
+     * @param string|null $language Language
+     */
+    public function getNumberOfRecords(string $language = null): int
+    {
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                id
+            FROM
+                %sfaqdata
+            WHERE
+                active = 'yes'
+            %s
+            AND
+                date_start <= '%s'
+            AND
+                date_end >= '%s'",
+            Database::getTablePrefix(),
+            null === $language ? '' : "AND lang = '" . $this->config->getDb()->escape($language) . "'",
+            $now,
+            $now
+        );
+        $num = $this->config->getDb()->numRows($this->config->getDb()->query($query));
+        if ($num > 0) {
+            return $num;
+        } else {
+            return 0;
+        }
+    }
+    /**
+     * This function generates a list with the most voted or most visited records.
+     *
+     * @param string $type Type definition visits/voted
+     */
+    public function getTopTen(string $type = 'visits'): array
+    {
+        if ('visits' === $type) {
+            $result = $this->getTopTenData(PMF_NUMBER_RECORDS_TOPTEN, 0, $this->config->getLanguage()->getLanguage());
+        } else {
+            $result = $this->getTopVotedData(PMF_NUMBER_RECORDS_TOPTEN, $this->config->getLanguage()->getLanguage());
+        }
+        $output = [];
+        if (count($result) > 0) {
+            foreach ($result as $row) {
+                if ('visits' == $type) {
+                    $output['title'][] = Strings::htmlentities(Utils::makeShorterText($row['question'], 8));
+                    $output['preview'][] = Strings::htmlentities($row['question']);
+                    $output['url'][] = Strings::htmlentities($row['url']);
+                    $output['visits'][] = $this->plurals->GetMsg('plmsgViews', $row['visits']);
+                } else {
+                    $output['title'][] = Strings::htmlentities(Utils::makeShorterText($row['question'], 8));
+                    $output['preview'][] = Strings::htmlentities($row['question']);
+                    $output['url'][] = Strings::htmlentities($row['url']);
+                    $output['voted'][] = sprintf(
+                        '%s %s 5 - %s',
+                        round($row['avg'], 2),
+                        Translation::get('msgVoteFrom'),
+                        $this->plurals->GetMsg('plmsgVotes', $row['user'])
+                    );
+                }
+            }
+        } else {
+            $output['error'] = Translation::get('err_noTopTen');
+        }
+        return $output;
+    }
+    /**
+     * This function generates the Top Ten data with the most viewed records.
+     *
+     * @param int  $count Number of records
+     * @param int  $categoryId Entity ID
+     * @param string|null $language Language
+     */
+    public function getTopTenData(
+        int $count = PMF_NUMBER_RECORDS_TOPTEN,
+        int $categoryId = 0,
+        string $language = null
+    ): array {
+        global $sids;
+        $now = date('YmdHis');
+        $query =
+            'SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS question,
+                fd.content AS answer,
+                fd.updated AS updated,
+                fcr.category_id AS category_id,
+                fv.visits AS visits,
+                fv.last_visit AS last_visit,
+                fdg.group_id AS group_id,
+                fdu.user_id AS user_id
+            FROM
+                ' . Database::getTablePrefix() . 'faqvisits fv,
+                ' . Database::getTablePrefix() . 'faqdata fd
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                    fd.date_start <= \'' . $now . '\'
+                AND fd.date_end   >= \'' . $now . '\'
+                AND fd.id = fv.id
+                AND fd.lang = fv.lang
+                AND fd.active = \'yes\'';
+        if (isset($categoryId) && is_numeric($categoryId) && ($categoryId != 0)) {
+            $query .= '
+            AND
+                fcr.category_id = \'' . $categoryId . '\'';
+        }
+        if (isset($language) && Language::isASupportedLanguage($language)) {
+            $query .= '
+            AND
+                fd.lang = \'' . $this->config->getDb()->escape($language) . '\'';
+        }
+        $query .= '
+                ' . $this->queryPermission($this->groupSupport) . '
+            GROUP BY
+                fd.id,fd.lang,fcr.category_id,fv.visits,fv.last_visit,fdg.group_id,fdu.user_id
+            ORDER BY
+                fv.visits DESC';
+        $result = $this->config->getDb()->query($query);
+        $topTen = [];
+        $data = [];
+        if ($result) {
+            while ($row = $this->config->getDb()->fetchObject($result)) {
+                if ($this->groupSupport) {
+                    if (!in_array($row->user_id, [-1, $this->user]) || !in_array($row->group_id, $this->groups)) {
+                        continue;
+                    }
+                } else {
+                    if (!in_array($row->user_id, [-1, $this->user])) {
+                        continue;
+                    }
+                }
+                $data['visits'] = (int)$row->visits;
+                $data['question'] = Filter::filterVar($row->question, FILTER_SANITIZE_SPECIAL_CHARS);
+                $data['answer'] = $row->answer;
+                $data['date'] = Date::createIsoDate($row->updated, DATE_ISO8601, true);
+                $data['last_visit'] = date('c', $row->last_visit);
+                $title = $row->question;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $row->question;
+                $oLink->tooltip = $title;
+                $data['url'] = $oLink->toString();
+                $topTen[$row->id] = $data;
+                if (count($topTen) === $count) {
+                    break;
+                }
+            }
+            array_multisort($topTen, SORT_DESC);
+        }
+        return $topTen;
+    }
+    /**
+     * This function generates a data-set with the most voted FAQs.
+     *
+     * @param int    $count    Number of records
+     * @param string|null $language Language
+     */
+    public function getTopVotedData(int $count = PMF_NUMBER_RECORDS_TOPTEN, string $language = null): array
+    {
+        global $sids;
+        $topten = $data = [];
+        $now = date('YmdHis');
+        $query =
+            '            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema,
+                fd.updated AS updated,
+                fcr.category_id AS category_id,
+                (fv.vote/fv.usr) AS avg,
+                fv.usr AS user
+            FROM
+                ' . Database::getTablePrefix() . 'faqvoting fv,
+                ' . Database::getTablePrefix() . 'faqdata fd
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                    fd.date_start <= \'' . $now . '\'
+                AND fd.date_end   >= \'' . $now . '\'
+                AND fd.id = fv.artikel
+                AND fd.active = \'yes\'';
+        if (isset($categoryId) && is_numeric($categoryId) && ($categoryId != 0)) {
+            $query .= '
+            AND
+                fcr.category_id = \'' . $categoryId . '\'';
+        }
+        if (isset($language) && Language::isASupportedLanguage($language)) {
+            $query .= '
+            AND
+                fd.lang = \'' . $this->config->getDb()->escape($language) . '\'';
+        }
+        $query .= '
+                ' . $this->queryPermission($this->groupSupport) . '
+            ORDER BY
+                avg DESC';
+        $result = $this->config->getDb()->query($query);
+        $i = 1;
+        $oldId = 0;
+        while (($row = $this->config->getDb()->fetchObject($result)) && $i <= $count) {
+            if ($oldId != $row->id) {
+                $data['avg'] = $row->avg;
+                $data['question'] = $row->thema;
+                $data['date'] = $row->updated;
+                $data['user'] = $row->user;
+                $title = $row->thema;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $row->thema;
+                $oLink->tooltip = $title;
+                $data['url'] = $oLink->toString();
+                $topten[] = $data;
+                ++$i;
+            }
+            $oldId = $row->id;
+        }
+        return $topten;
+    }
+    /**
+     * This function generates the list with the latest published records.
+     *
+     * @throws Exception
+     */
+    public function getLatest(): array
+    {
+        $date = new Date($this->config);
+        $result = $this->getLatestData(PMF_NUMBER_RECORDS_LATEST, $this->config->getLanguage()->getLanguage());
+        $output = [];
+        if (count($result) > 0) {
+            foreach ($result as $row) {
+                $output['url'][] = Strings::htmlentities($row['url']);
+                $output['title'][] = Strings::htmlentities(Utils::makeShorterText($row['question'], 8));
+                $output['preview'][] = Strings::htmlentities($row['question']);
+                $output['date'][] = $date->format($row['date']);
+            }
+        } else {
+            $output['error'] = Translation::get('err_noArticles');
+        }
+        return $output;
+    }
+    /**
+     * This function generates an array with a specified number of most recent
+     * published records.
+     *
+     * @param int    $count    Number of records
+     * @param string $language Language
+     */
+    public function getLatestData(int $count = PMF_NUMBER_RECORDS_LATEST, $language = null): array
+    {
+        global $sids;
+        $now = date('YmdHis');
+        $query =
+            '            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fcr.category_id AS category_id,
+                fd.thema AS question,
+                fd.content AS content,
+                fd.updated AS updated,
+                fv.visits AS visits,
+                fdg.group_id AS group_id,
+                fdu.user_id AS user_id
+            FROM
+                ' . Database::getTablePrefix() . 'faqvisits fv,
+                ' . Database::getTablePrefix() . 'faqdata fd
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                ' . Database::getTablePrefix() . 'faqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                    fd.date_start <= \'' . $now . '\'
+                AND fd.date_end   >= \'' . $now . '\'
+                AND fd.id = fv.id
+                AND fd.lang = fv.lang
+                AND fd.active = \'yes\'';
+        if (isset($language) && Language::isASupportedLanguage($language)) {
+            $query .= '
+            AND
+                fd.lang = \'' . $this->config->getDb()->escape($language) . '\'';
+        }
+        $query .= '
+                ' . $this->queryPermission($this->groupSupport) . '
+            GROUP BY
+                fd.id,fd.lang,fcr.category_id,fv.visits,fdg.group_id,fdu.user_id
+            ORDER BY
+                fd.updated DESC';
+        $result = $this->config->getDb()->query($query);
+        $latest = [];
+        $data = [];
+        if ($result) {
+            while (($row = $this->config->getDb()->fetchObject($result))) {
+                if ($this->groupSupport) {
+                    if (!in_array($row->user_id, [-1, $this->user]) || !in_array($row->group_id, $this->groups)) {
+                        continue;
+                    }
+                } else {
+                    if (!in_array($row->user_id, [-1, $this->user])) {
+                        continue;
+                    }
+                }
+                $data['date'] = Date::createIsoDate($row->updated, DATE_ISO8601, true);
+                $data['question'] = Filter::filterVar($row->question, FILTER_SANITIZE_SPECIAL_CHARS);
+                $data['answer'] = $row->content;
+                $data['visits'] = (int)$row->visits;
+                $title = $row->question;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $title;
+                $oLink->tooltip = $title;
+                $data['url'] = $oLink->toString();
+                $latest[$row->id] = $data;
+                if (count($latest) === $count) {
+                    break;
+                }
+            }
+        }
+        return $latest;
+    }
+    /**
+     * Retrieve faq records according to the constraints provided.
+     */
+    public function get(
+        string $queryType = FAQ_QUERY_TYPE_DEFAULT,
+        int $nCatid = 0,
+        bool $bDownwards = true,
+        string $lang = '',
+        string $date = ''
+    ): array {
+        $faqs = [];
+        $result = $this->config->getDb()->query($this->getSQLQuery($queryType, $nCatid, $bDownwards, $lang, $date));
+        if ($this->config->getDb()->numRows($result) > 0) {
+            $i = 0;
+            while ($row = $this->config->getDb()->fetchObject($result)) {
+                $faq = [];
+                $faq['id'] = $row->id;
+                $faq['solution_id'] = $row->solution_id;
+                $faq['revision_id'] = $row->revision_id;
+                $faq['lang'] = $row->lang;
+                $faq['category_id'] = $row->category_id;
+                $faq['active'] = $row->active;
+                $faq['sticky'] = $row->sticky;
+                $faq['keywords'] = $row->keywords;
+                $faq['topic'] = $row->thema;
+                $faq['content'] = $row->content;
+                $faq['author_name'] = $row->author;
+                $faq['author_email'] = $row->email;
+                $faq['comment_enable'] = $row->comment;
+                $faq['lastmodified'] = $row->updated;
+                $faq['hits'] = $row->visits;
+                $faq['hits_last'] = $row->last_visit;
+                $faq['notes'] = $row->notes;
+                $faqs[$i] = $faq;
+                ++$i;
+            }
+        }
+        return $faqs;
+    }
+    /**
+     * Build the SQL query for retrieving faq records according to the constraints provided.
+     */
+    private function getSQLQuery(
+        string $queryType,
+        int $categoryId,
+        bool $bDownwards,
+        string $lang,
+        string $date,
+        int $faqId = 0
+    ): string {
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.solution_id AS solution_id,
+                fd.revision_id AS revision_id,
+                fd.lang AS lang,
+                fcr.category_id AS category_id,
+                fd.active AS active,
+                fd.sticky AS sticky,
+                fd.keywords AS keywords,
+                fd.thema AS thema,
+                fd.content AS content,
+                fd.author AS author,
+                fd.email AS email,
+                fd.comment AS comment,
+                fd.updated AS updated,
+                fd.notes AS notes,
+                fv.visits AS visits,
+                fv.last_visit AS last_visit
+            FROM
+                %sfaqdata fd,
+                %sfaqvisits fv,
+                %sfaqcategoryrelations fcr
+            WHERE
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            AND
+                fd.date_start <= '%s'
+            AND
+                fd.date_end   >= '%s'
+            AND ",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $now,
+            $now
+        );
+        if (!empty($faqId)) {
+            $query .= "fd.id = '" . $faqId . "' AND ";
+        }
+        $query .= 'fd.id = fv.id
+            AND
+                fd.lang = fv.lang';
+        $needAndOp = true;
+        if ((!empty($categoryId)) && $categoryId > 0) {
+            $query .= ' AND';
+            $query .= ' (fcr.category_id = ' . $categoryId;
+            if ($bDownwards) {
+                $query .= $this->getCatidWhereSequence($categoryId, 'OR');
+            }
+            $query .= ')';
+            $needAndOp = true;
+        }
+        if ((!empty($date)) && Utils::isLikeOnPMFDate($date)) {
+            $query .= ' AND';
+            $query .= " fd.updated LIKE '" . $date . "'";
+            $needAndOp = true;
+        }
+        if ((!empty($lang)) && Utils::isLanguage($lang)) {
+            $query .= ' AND';
+            $query .= " fd.lang = '" . $this->config->getDb()->escape($lang) . "'";
+            $needAndOp = true;
+        }
+        switch ($queryType) {
+            case FAQ_QUERY_TYPE_APPROVAL:
+                $query .= ' AND';
+                $query .= " fd.active = '" . FAQ_SQL_ACTIVE_NO . "'";
+                break;
+            case FAQ_QUERY_TYPE_EXPORT_PDF:
+            case FAQ_QUERY_TYPE_EXPORT_XHTML:
+            case FAQ_QUERY_TYPE_EXPORT_XML:
+            default:
+                $query .= ' AND';
+                $query .= " fd.active = '" . FAQ_SQL_ACTIVE_YES . "'";
+                break;
+        }
+        match ($queryType) {
+            FAQ_QUERY_TYPE_EXPORT_PDF,
+            FAQ_QUERY_TYPE_EXPORT_XHTML,
+            FAQ_QUERY_TYPE_EXPORT_XML => $query .= "\nORDER BY fcr.category_id, fd.id",
+            default => $query .= "\nORDER BY fcr.category_id, fd.id",
+        };
+        return $query;
+    }
+    /**
+     * Build a logic sequence, for a WHERE statement, of those category IDs
+     * children of the provided category ID, if any.
+     *
+     * @param Category|null $oCat
+     */
+    private function getCatidWhereSequence(int $nCatid, string $logicOp = 'OR', Category $oCat = null): string
+    {
+        $sqlWhereFilter = '';
+        if (!isset($oCat)) {
+            $oCat = new Category($this->config);
+        }
+        $aChildren = array_values($oCat->getChildren($nCatid));
+        foreach ($aChildren as $catid) {
+            $sqlWhereFilter .= ' ' . $logicOp . ' fcr.category_id = ' . $catid;
+            $sqlWhereFilter .= $this->getCatidWhereSequence($catid, 'OR', $oCat);
+        }
+        return $sqlWhereFilter;
+    }
+    /**
+     * Returns all records of one category.
+     *
+     *
+     */
+    public function getRecordsWithoutPagingByCategoryId(int $categoryId): string
+    {
+        global $sids;
+        $output = '';
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema,
+                fcr.category_id AS category_id,
+                fv.visits AS visits
+            FROM
+                %sfaqdata fd
+            LEFT JOIN
+                %sfaqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqvisits fv
+            ON
+                fd.id = fv.id
+            AND
+                fv.lang = fd.lang
+            LEFT JOIN
+                %sfaqdata_group fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.date_start <= '%s'
+            AND
+                fd.date_end   >= '%s'
+            AND
+                fd.active = 'yes'
+            AND
+                fcr.category_id = %d
+            AND
+                fd.lang = '%s'
+                %s
+            GROUP BY
+                fd.id,fd.lang,fd.thema,fcr.category_id,fv.visits
+            ORDER BY
+                %s %s",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $now,
+            $now,
+            $categoryId,
+            $this->config->getLanguage()->getLanguage(),
+            $this->queryPermission($this->groupSupport),
+            $this->config->get('records.orderby'),
+            $this->config->get('records.sortby')
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($result) {
+            $output = '<ul>';
+            while (($row = $this->config->getDb()->fetchObject($result))) {
+                $title = $row->thema;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $row->thema;
+                $oLink->text = $title;
+                $oLink->tooltip = $title;
+                $listItem = '<li>' . $oLink->toHtmlAnchor() . '</li>';
+                $output .= $listItem;
+            }
+            $output .= '</ul>';
+        }
+        return $output;
+    }
+    /**
+     * Prints the open questions as a HTML table.
+     *
+     * @todo   needs to be moved to a QuestionHelper class
+     * @throws Exception
+     */
+    public function renderOpenQuestions(): string
+    {
+        global $sids, $category;
+        $date = new Date($this->config);
+        $mail = new Mail($this->config);
+        $query = sprintf(
+            "SELECT COUNT(id) AS num FROM %sfaqquestions WHERE lang = '%s' AND is_visible != 'Y'",
+            Database::getTablePrefix(),
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        $row = $this->config->getDb()->fetchObject($result);
+        $numOfInvisibles = $row->num;
+        if ($numOfInvisibles > 0) {
+            $extraout = sprintf(
+                '<tr><td colspan="3"><small>%s %s</small></td></tr>',
+                Translation::get('msgQuestionsWaiting'),
+                $numOfInvisibles
+            );
+        } else {
+            $extraout = '';
+        }
+        $query = sprintf(
+            "SELECT * FROM %sfaqquestions WHERE lang = '%s' AND is_visible = 'Y' ORDER BY created ASC",
+            Database::getTablePrefix(),
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        $output = '';
+        if ($result && $this->config->getDb()->numRows($result) > 0) {
+            while ($row = $this->config->getDb()->fetchObject($result)) {
+                $output .= '<tr class="openquestions">';
+                $output .= sprintf(
+                    '<td><small>%s</small><br><a href="mailto:%s">%s</a></td>',
+                    $date->format(Date::createIsoDate($row->created)),
+                    $mail->safeEmail($row->email),
+                    Strings::htmlentities($row->username)
+                );
+                $output .= sprintf(
+                    '<td><strong>%s:</strong><br>%s</td>',
+                    isset($category->categoryName[$row->category_id]['name']) ?
+                        Strings::htmlentities($category->categoryName[$row->category_id]['name']) :
+                        '',
+                    Strings::htmlentities($row->question)
+                );
+                if ($this->config->get('records.enableCloseQuestion') && $row->answer_id) {
+                    $output .= sprintf(
+                        '<td><a id="PMF_openQuestionAnswered" href="?%saction=faq&amp;cat=%d&amp;id=%d">%s</a></td>',
+                        $sids,
+                        $row->category_id,
+                        $row->answer_id,
+                        Translation::get('msg2answerFAQ')
+                    );
+                } else {
+                    $output .= sprintf(
+                        '<td class="text-end">' .
+                        '<a class="btn btn-primary" href="?%saction=add&amp;question=%d&amp;cat=%d">%s</a></td>',
+                        $sids,
+                        $row->id,
+                        $row->category_id,
+                        Translation::get('msg2answer')
+                    );
+                }
+                $output .= '</tr>';
+            }
+        } else {
+            $output = sprintf(
+                '<tr><td colspan="3">%s</td></tr>',
+                Translation::get('msgNoQuestionsAvailable')
+            );
+        }
+        return $output . $extraout;
+    }
+    /**
+     * Set or unset a faq item flag.
+     *
+     * @param int    $faqId       FAQ id
+     * @param string $faqLanguage Language code which is valid with Language::isASupportedLanguage
+     * @param bool   $flag        FAQ is set to sticky or not
+     * @param string $type        Type of the flag to set, use the column name
+     */
+    public function updateRecordFlag(int $faqId, string $faqLanguage, bool $flag, string $type): bool
+    {
+        $flag = match ($type) {
+            'sticky' => $flag ? 1 : 0,
+            'active' => $flag ? "'yes'" : "'no'",
+            default => null,
+        };
+        if (null !== $flag) {
+            $update = sprintf(
+                "
+                UPDATE 
+                    %sfaqdata 
+                SET 
+                    %s = %s 
+                WHERE 
+                    id = %d 
+                AND 
+                    lang = '%s'",
+                Database::getTablePrefix(),
+                $type,
+                $flag,
+                $faqId,
+                $this->config->getDb()->escape($faqLanguage)
+            );
+            return (bool)$this->config->getDb()->query($update);
+        }
+        return false;
+    }
+    /**
+     * Prepares and returns the sticky records for the frontend.
+     */
+    public function getStickyRecords(): array
+    {
+        $result = $this->getStickyRecordsData();
+        $output = [];
+        if (count($result) > 0) {
+            foreach ($result as $row) {
+                $output['title'][] = Utils::makeShorterText(Strings::htmlentities($row['question']), 8);
+                $output['preview'][] = Strings::htmlentities($row['question']);
+                $output['url'][] = Strings::htmlentities($row['url']);
+            }
+        } else {
+            $output['error'] = sprintf('<li>%s</li>', Translation::get('err_noTopTen'));
+        }
+        return $output;
+    }
+    /**
+     * Returns the sticky records with URL and Title.
+     */
+    public function getStickyRecordsData(): array
+    {
+        global $sids;
+        $now = date('YmdHis');
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema,
+                fcr.category_id AS category_id,
+                fv.visits AS visits
+            FROM
+                %sfaqvisits fv,
+                %sfaqdata fd
+            LEFT JOIN
+                %sfaqcategoryrelations fcr
+            ON
+                fd.id = fcr.record_id
+            AND
+                fd.lang = fcr.record_lang
+            LEFT JOIN
+                %sfaqdata_group AS fdg
+            ON
+                fd.id = fdg.record_id
+            LEFT JOIN
+                %sfaqdata_user AS fdu
+            ON
+                fd.id = fdu.record_id
+            WHERE
+                fd.lang = '%s'
+            AND 
+                fd.date_start <= '%s'
+            AND 
+                fd.date_end   >= '%s'
+            AND 
+                fd.active = 'yes'
+            AND 
+                fd.sticky = 1
+            AND
+                fd.id = fv.id
+            AND 
+                fd.lang = fv.lang
+            %s
+            GROUP BY
+                fd.id, fd.lang, fd.thema, fcr.category_id, fv.visits
+            ORDER BY
+                fv.visits DESC",
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            Database::getTablePrefix(),
+            $this->config->getLanguage()->getLanguage(),
+            $now,
+            $now,
+            $this->queryPermission($this->groupSupport)
+        );
+        $result = $this->config->getDb()->query($query);
+        $sticky = [];
+        $data = [];
+        $oldId = 0;
+        while (($row = $this->config->getDb()->fetchObject($result))) {
+            if ($oldId != $row->id) {
+                $data['question'] = $row->thema;
+                $title = $row->thema;
+                $url = sprintf(
+                    '%sindex.php?%saction=faq&amp;cat=%d&amp;id=%d&amp;artlang=%s',
+                    $this->config->getDefaultUrl(),
+                    $sids,
+                    $row->category_id,
+                    $row->id,
+                    $row->lang
+                );
+                $oLink = new Link($url, $this->config);
+                $oLink->itemTitle = $row->thema;
+                $oLink->tooltip = $title;
+                $data['url'] = $oLink->toString();
+                $sticky[] = $data;
+            }
+            $oldId = $row->id;
+        }
+        return $sticky;
+    }
+    /**
+     * Returns the inactive records with admin URL to edit the FAQ and title.
+     */
+    public function getInactiveFaqsData(): array
+    {
+        $query = sprintf(
+            "
+            SELECT
+                fd.id AS id,
+                fd.lang AS lang,
+                fd.thema AS thema
+            FROM
+                %sfaqdata fd
+            WHERE
+                fd.lang = '%s'
+            AND 
+                fd.active = 'no'
+            GROUP BY
+                fd.id, fd.lang, fd.thema
+            ORDER BY
+                fd.id DESC",
+            Database::getTablePrefix(),
+            $this->config->getLanguage()->getLanguage()
+        );
+        $result = $this->config->getDb()->query($query);
+        $inactive = [];
+        $data = [];
+        $oldId = 0;
+        while (($row = $this->config->getDb()->fetchObject($result))) {
+            if ($oldId != $row->id) {
+                $data['question'] = $row->thema;
+                $data['url'] = sprintf(
+                    '%sadmin/?action=editentry&id=%d&lang=%s',
+                    $this->config->getDefaultUrl(),
+                    $row->id,
+                    $row->lang
+                );
+                $inactive[] = $data;
+            }
+            $oldId = $row->id;
+        }
+        return $inactive;
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Faq/FaqPermission.php
@@ -0,0 +1,140 @@
+<?php
+/**
+ * FAQ permissions class for phpMyFAQ.
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2020-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2020-11-04
+ */
+namespace phpMyFAQ\Faq;
+use phpMyFAQ\Configuration;
+use phpMyFAQ\Database;
+use phpMyFAQ\Filter;
+/**
+ * Class FaqPermission
+ *
+ * @package phpMyFAQ\Faq
+ */
+class FaqPermission
+{
+    /** @var string */
+    final public const USER = 'user';
+    /** @var string */
+    final public const GROUP = 'group';
+    /**
+     * FaqPermission constructor.
+     */
+    public function __construct(private readonly Configuration $config)
+    {
+    }
+    /**
+     * Adds the record permissions for users and groups.
+     *
+     * @param string $mode 'group' or 'user'
+     * @param int    $faqId ID of the current record
+     * @param int[]  $ids Array of group or user IDs
+     */
+    public function add(string $mode, int $faqId, array $ids): bool
+    {
+        if (self::USER !== $mode && self::GROUP !== $mode) {
+            return false;
+        }
+        foreach ($ids as $id) {
+            $query = sprintf(
+                'INSERT INTO %sfaqdata_%s (record_id, %s_id) VALUES (%d, %d)',
+                Database::getTablePrefix(),
+                $mode,
+                $mode,
+                $faqId,
+                $id
+            );
+            $this->config->getDb()->query($query);
+        }
+        return true;
+    }
+    /**
+     * Deletes the record permissions for users and groups.
+     *
+     * @param string $mode 'group' or 'user'
+     * @param int    $faqId ID of the current record
+     */
+    public function delete(string $mode, int $faqId): bool
+    {
+        if (self::USER !== $mode && self::GROUP !== $mode) {
+            return false;
+        }
+        $query = sprintf(
+            'DELETE FROM %sfaqdata_%s WHERE record_id = %d',
+            Database::getTablePrefix(),
+            $mode,
+            $faqId
+        );
+        return (bool) $this->config->getDb()->query($query);
+    }
+    /**
+     * Returns the record permissions for users and groups.
+     *
+     * @param string $mode 'group' or 'user'
+     */
+    public function get(string $mode, int $faqId): array
+    {
+        $permissions = [];
+        if (self::USER !== $mode && self::GROUP !== $mode) {
+            return $permissions;
+        }
+        if (0 === $faqId) {
+            return [-1];
+        }
+        $query = sprintf(
+            'SELECT %s_id AS permission FROM %sfaqdata_%s WHERE record_id = %d',
+            $mode,
+            Database::getTablePrefix(),
+            $mode,
+            $faqId
+        );
+        $result = $this->config->getDb()->query($query);
+        if ($this->config->getDb()->numRows($result) > 0) {
+            while (($row = $this->config->getDb()->fetchObject($result))) {
+                $permissions[] = (int)$row->permission;
+            }
+        }
+        return $permissions;
+    }
+    public function createPermissionArray(): array
+    {
+        $permissions = [];
+        if ('all' === Filter::filterInput(INPUT_POST, 'userpermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
+            $permissions += [
+                'restricted_user' => [-1],
+            ];
+        } else {
+            $permissions += [
+                'restricted_user' => [
+                    Filter::filterInput(INPUT_POST, 'restricted_users', FILTER_VALIDATE_INT),
+                ],
+            ];
+        }
+        if ('all' === Filter::filterInput(INPUT_POST, 'grouppermission', FILTER_SANITIZE_SPECIAL_CHARS)) {
+            $permissions += [
+                'restricted_groups' => [-1],
+            ];
+        } else {
+            $permissions += Filter::filterInputArray(
+                INPUT_POST,
+                [
+                    'restricted_groups' => [
+                        'filter' => FILTER_VALIDATE_INT,
+                        'flags' => FILTER_REQUIRE_ARRAY,
+                    ],
+                ]
+            );
+        }
+        return $permissions;
+    }
+}

--- a/phpmyfaq/src/phpMyFAQ/Helper/FaqHelper.php
+++ b//dev/null
@@ -1,172 +0,0 @@
-<?php
-/**
- * Helper class for phpMyFAQ FAQs.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL wasn't distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ\Helper
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2010-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2010-11-12
- */
-namespace phpMyFAQ\Helper;
-use League\CommonMark\CommonMarkConverter;
-use League\CommonMark\Exception\CommonMarkException;
-use phpMyFAQ\Category;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Entity\FaqEntity;
-use phpMyFAQ\Faq;
-use phpMyFAQ\Language\LanguageCodes;
-use phpMyFAQ\Link;
-use phpMyFAQ\Utils;
-use Symfony\Component\HtmlSanitizer\HtmlSanitizer;
-use Symfony\Component\HtmlSanitizer\HtmlSanitizerConfig;
-use Symfony\Component\HttpFoundation\Request;
-/**
- * Class FaqHelper
- *
- * @package phpMyFAQ\Helper
- */
-class FaqHelper extends AbstractHelper
-{
-    /**
-     * Constructor.
-     */
-    public function __construct(Configuration $configuration)
-    {
-        $this->configuration = $configuration;
-    }
-    /**
-     * Rewrites the CSS class generated by TinyMCE for HighlightJS.
-     */
-    public function rewriteLanguageMarkupClass(string $answer): string
-    {
-        return str_replace('class="language-markup"', 'class="language-html"', $answer);
-    }
-    /**
-     * Extends URL fragments (e.g. <a href="#foo">) with the full default URL.
-     */
-    public function rewriteUrlFragments(string $answer, string $currentUrl): string
-    {
-        return str_replace('href="#', 'href="' . $currentUrl . '#', $answer);
-    }
-    /**
-     * Renders a select box with all translations of a FAQ.
-     *
-     * @param Faq $faq
-     * @param int $categoryId
-     * @return string
-     * @todo This method should be moved to a Twig macro.
-     * @deprecated Rewrite this method to use Twig, will be removed in v4.1
-     */
-    public function renderChangeLanguageSelector(Faq $faq, int $categoryId): string
-    {
-        $html = '';
-        $faqUrl = sprintf(
-            '?action=faq&amp;cat=%d&amp;id=%d&amp;artlang=%%s',
-            $categoryId,
-            $faq->faqRecord['id']
-        );
-        $oLink = new Link($this->configuration->getDefaultUrl() . $faqUrl, $this->configuration);
-        $oLink->itemTitle = $faq->faqRecord['title'];
-        $availableLanguages = $this->configuration->getLanguage()->isLanguageAvailable($faq->faqRecord['id']);
-        if ((is_countable($availableLanguages) ? count($availableLanguages) : 0) > 1) {
-            $html = '<form method="post">';
-            $html .= '<select class="form-select" name="language" ';
-            $html .= 'onchange="top.location.href = this.options[this.selectedIndex].value;">';
-            foreach ($availableLanguages as $availableLanguage) {
-                $html .= sprintf('<option value="%s"', sprintf($oLink->toString(), $availableLanguage));
-                $html .= ($faq->faqRecord['lang'] === $availableLanguage ? ' selected' : '');
-                $html .= sprintf('>%s</option>', LanguageCodes::get($availableLanguage));
-            }
-            $html .= '</select></form>';
-        }
-        return $html;
-    }
-    /**
-     * Renders a preview of the answer
-     *
-     * @param string $answer The answer to be previewed
-     * @param int    $wordCount The number of words to display in the preview
-     * @return string The preview of the answer
-     * @throws CommonMarkException
-     */
-    public function renderAnswerPreview(string $answer, int $wordCount): string
-    {
-        if ($this->configuration->get('main.enableMarkdownEditor')) {
-            $markdownConverter = new CommonMarkConverter([
-                'html_input' => 'strip',
-                'allow_unsafe_links' => false,
-            ]);
-            $cleanedAnswer = $markdownConverter->convert($answer)->getContent();
-            return Utils::chopString(strip_tags($cleanedAnswer), $wordCount);
-        }
-        return Utils::chopString(strip_tags($answer), $wordCount);
-    }
-    /**
-     * Creates an overview with all categories with their FAQs.
-     *
-     * @param Category $category
-     * @param Faq      $faq
-     * @param string   $language
-     * @return array
-     */
-    public function createOverview(Category $category, Faq $faq, string $language = ''): array
-    {
-        $category->transform(0);
-        $faq->getAllFaqs(FAQ_SORTING_TYPE_CATID_FAQID, ['lang' => $language, 'active' => 'yes']);
-        return $faq->faqRecords;
-    }
-    /**
-     * Returns the URL for a given FAQ Entity and category ID.
-     */
-    public function createFaqUrl(FaqEntity $faqEntity, int $categoryId): string
-    {
-        return sprintf(
-            '%s?action=faq&cat=%d&id=%d&artlang=%s',
-            $this->configuration->getDefaultUrl() . 'index.php',
-            $categoryId,
-            $faqEntity->getId(),
-            $faqEntity->getLanguage()
-        );
-    }
-    /**
-     * Remove <script> tags, we don't need them
-     */
-    public function cleanUpContent(string $content): string
-    {
-        $contentLength = strlen($content);
-        $allowedMediaHosts = $this->configuration->getAllowedMediaHosts();
-        $allowedMediaHosts[] = Request::createFromGlobals()->getHost();
-        $htmlSanitizer = new HtmlSanitizer(
-            (new HtmlSanitizerConfig())
-                ->withMaxInputLength($contentLength + 1)
-                ->allowSafeElements()
-                ->allowRelativeLinks()
-                ->allowStaticElements()
-                ->allowRelativeMedias()
-                ->forceHttpsUrls($this->configuration->get('security.useSslOnly'))
-                ->allowElement('iframe', ['title', 'src', 'width', 'height', 'allow', 'allowfullscreen'])
-                ->allowMediaSchemes(['https', 'http', 'mailto', 'data'])
-                ->allowMediaHosts($allowedMediaHosts)
-        );
-        $sanitizedContent = $htmlSanitizer->sanitize($content);
-        $sanitizedContent = preg_replace('/<iframe\b(?:(?!src)[^>])*>\s*<\/iframe>/i', '', $sanitizedContent);
-        return preg_replace_callback(
-            '/style\s*=\s*"([^"]*)"/i',
-            function ($matches) {
-                $styles = explode(';', $matches[1]);
-                $filteredStyles = array_filter($styles, function ($style) {
-                    return stripos(trim($style), 'overflow:') !== 0; // Exclude 'overflow' properties
-                });
-                $newStyle = implode('; ', $filteredStyles);
-                return $newStyle ? 'style="' . $newStyle . '"' : ''; // Remove style attribute if empty
-            },
-            $sanitizedContent
-        );
-    }
-}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Ldap.php
@@ -0,0 +1,265 @@
+<?php
+/**
+ * The Ldap class provides methods and functions for LDAP and/or Active Directory.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Adam Greene <phpmyfaq@skippy.fastmail.fm>
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @author    Alberto Cabello Sanchez <alberto@unex.es>
+ * @author    Lars Scheithauer <larsscheithauer@googlemail.com>
+ * @copyright 2004-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2004-12-16
+ */
+namespace phpMyFAQ;
+use LDAP\Connection;
+/**
+ * Class Ldap
+ *
+ * @package phpMyFAQ
+ */
+class Ldap
+{
+    /**
+     * Error.
+     */
+    public ?string $error = null;
+    /**
+     * LDAP error number.
+     */
+    public ?int $errno = null;
+    private readonly array $ldapConfig;
+    /**
+     * An LDAP link identifier, returned by ldap_connect()
+     *
+     * @var resource|false
+     */
+    private Connection|bool|null $ds = null;
+    /**
+     * The LDAP base.
+     */
+    private ?string $base = null;
+    /**
+     * Constructor.
+     */
+    public function __construct(private readonly Configuration $config)
+    {
+        $this->ldapConfig = $this->config->getLdapConfig();
+    }
+    /**
+     * Connects to given LDAP server with given credentials.
+     */
+    public function connect(
+        string $ldapServer,
+        int $ldapPort,
+        string $ldapBase,
+        string $ldapUser = '',
+        string $ldapPassword = ''
+    ): bool {
+        if ('' === $ldapServer || '' === $ldapBase) {
+            return false;
+        }
+        $this->base = $ldapBase;
+        $this->ds = ldap_connect($ldapServer . ':' . $ldapPort);
+        if (!$this->ds) {
+            $this->error = 'Unable to connect to LDAP server';
+            return false;
+        }
+        foreach ($this->config->getLdapOptions() as $key => $value) {
+            if (!ldap_set_option($this->ds, constant($key), $value)) {
+                $this->errno = ldap_errno($this->ds);
+                $this->error = sprintf(
+                    'Unable to set LDAP option "%s" to "%s" (Error: %s).',
+                    $key,
+                    $value,
+                    ldap_error($this->ds)
+                );
+                return false;
+            }
+        }
+        if ($this->config->get('ldap.ldap_use_dynamic_login')) {
+            $ldapRdn = $this->config->get('ldap.ldap_dynamic_login_attribute') . '=' . $ldapUser . ',' . $ldapBase;
+            $ldapBind = $this->bind($ldapRdn, $ldapPassword);
+        } elseif ($this->config->get('ldap.ldap_use_anonymous_login')) {
+            $ldapBind = $this->bind();
+        } else {
+            $ldapBind = $this->bind($ldapUser, $ldapPassword);
+        }
+        if (false === $ldapBind) {
+            $this->errno = ldap_errno($this->ds);
+            $this->error = sprintf(
+                'Unable to bind to LDAP server (Error: %s).',
+                ldap_error($this->ds)
+            );
+            $this->ds = false;
+            return false;
+        }
+        return true;
+    }
+    /**
+     * Binds to the LDAP directory with specified RDN and password.
+     */
+    public function bind(string $rdn = '', string $password = ''): bool
+    {
+        if ($this->ds === false) {
+            $this->error = 'The LDAP connection handler is not a valid resource.';
+            return false;
+        }
+        if ('' === $rdn && '' === $password) {
+            return ldap_bind($this->ds);
+        } else {
+            return ldap_bind($this->ds, $rdn, $password);
+        }
+    }
+    /**
+     * Returns the user's email address from LDAP.
+     *
+     * @param string $username Username
+     */
+    public function getMail(string $username): bool|string
+    {
+        return $this->getLdapData($username, 'mail');
+    }
+    /**
+     * Returns specific data from LDAP.
+     *
+     * @param string $username Username
+     * @param string $data     MapKey
+     */
+    private function getLdapData(string $username, string $data): bool|string
+    {
+        if ($this->ds === false) {
+            $this->error = 'The LDAP connection handler is not a valid resource.';
+            return false;
+        }
+        if (!array_key_exists($data, $this->ldapConfig['ldap_mapping'])) {
+            $this->error = sprintf(
+                'The requested data field "%s" does not exist in LDAP mapping configuration.',
+                $data
+            );
+            return false;
+        }
+        $filter = sprintf(
+            '(%s=%s)',
+            $this->config->get('ldap.ldap_mapping.username'),
+            $this->quote($username)
+        );
+        if ($this->config->get('ldap.ldap_use_memberOf')) {
+            $filter = sprintf(
+                '(&%s(memberOf:1.2.840.113556.1.4.1941:=%s))',
+                $filter,
+                $this->config->get('ldap.ldap_mapping.memberOf')
+            );
+        }
+        $fields = [$this->ldapConfig['ldap_mapping'][$data]];
+        $searchResult = ldap_search($this->ds, $this->base, $filter, $fields);
+        if (!$searchResult) {
+            $this->errno = ldap_errno($this->ds);
+            $this->error = sprintf(
+                'Unable to search for "%s" (Error: %s)',
+                $username,
+                ldap_error($this->ds)
+            );
+            return false;
+        }
+        $entryId = ldap_first_entry($this->ds, $searchResult);
+        if (!$entryId) {
+            $this->errno = ldap_errno($this->ds);
+            $this->error = sprintf(
+                'Cannot get the value(s). Error: %s',
+                ldap_error($this->ds)
+            );
+            return false;
+        }
+        $entries = ldap_get_entries($this->ds, $searchResult);
+        for ($i = 0; $i < $entries['count']; $i++) {
+            if (isset($entries[$i][$fields[0]][0])) {
+                return $entries[$i][$fields[0]][0];
+            }
+        }
+        return false;
+    }
+    /**
+     * Quotes LDAP strings in accordance with the RFC 2254.
+     */
+    public function quote(string $string): string
+    {
+        return str_replace(
+            ['\\', ' ', '*', '(', ')'],
+            ['\\5c', '\\20', '\\2a', '\\28', '\\29'],
+            $string
+        );
+    }
+    /**
+     * Returns the user's DN.
+     *
+     * @param string $username Username
+     */
+    public function getDn(string $username): bool|string
+    {
+        return $this->getLdapDn($username);
+    }
+    /**
+     * Returns the DN from LDAP.
+     *
+     * @param string $username Username
+     */
+    private function getLdapDn(string $username): string|false
+    {
+        if ($this->ds === false) {
+            $this->error = 'The LDAP connection handler is not a valid resource.';
+            return false;
+        }
+        $filter = sprintf(
+            '(%s=%s)',
+            $this->config->get('ldap.ldap_mapping.username'),
+            $this->quote($username)
+        );
+        $sr = ldap_search($this->ds, $this->base, $filter);
+        if (false === $sr) {
+            $this->errno = ldap_errno($this->ds);
+            $this->error = sprintf(
+                'Unable to search for "%s" (Error: %s)',
+                $username,
+                ldap_error($this->ds)
+            );
+            return false;
+        }
+        $entryId = ldap_first_entry($this->ds, $sr);
+        if (false === $entryId) {
+            $this->errno = ldap_errno($this->ds);
+            $this->error = sprintf(
+                'Cannot get the value(s). Error: %s',
+                ldap_error($this->ds)
+            );
+            return false;
+        }
+        return ldap_get_dn($this->ds, $entryId);
+    }
+    /**
+     * Returns the user's full name from LDAP.
+     *
+     * @param string $username Username
+     */
+    public function getCompleteName(string $username): bool|string
+    {
+        return $this->getLdapData($username, 'name');
+    }
+    /**
+     * Returns the LDAP error message of the last LDAP command.
+     *
+     * @param resource $ds LDAP resource
+     */
+    public function error($ds = null): string
+    {
+        if ($ds === null) {
+            $ds = $this->ds;
+        }
+        return ldap_error($ds);
+    }
+}

--- a//dev/null
+++ b/phpmyfaq/src/phpMyFAQ/Mail/SMTP.php
@@ -0,0 +1,71 @@
+<?php
+/**
+ * MUA (Mail User Agent) implementation using the Symfony Mailer class.
+ *
+ * This Source Code Form is subject to the terms of the Mozilla Public License,
+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can
+ * obtain one at https://mozilla.org/MPL/2.0/.
+ *
+ * @package   phpMyFAQ
+ * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
+ * @copyright 2022-2023 phpMyFAQ Team
+ * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
+ * @link      https://www.phpmyfaq.de
+ * @since     2022-01-23
+ */
+namespace phpMyFAQ\Mail;
+use Symfony\Component\Mailer\Exception\TransportExceptionInterface;
+use Symfony\Component\Mailer\Mailer;
+use Symfony\Component\Mailer\MailerInterface;
+use Symfony\Component\Mailer\Transport;
+use Symfony\Component\Mime\Email;
+/**
+ * Class SMTP
+ */
+class SMTP implements MailUserAgentInterface
+{
+    private string $user;
+    private MailerInterface $mailer;
+    public function setAuthConfig(
+        string $server,
+        string $user = '',
+        string $password = '',
+        int $port = 25,
+        bool $disableTlsPeerVerification = false
+    ): void {
+        $dsn = sprintf('smtp://%s:%s@%s:%d', $this->user = $user, urlencode($password), $server, $port);
+        if ($disableTlsPeerVerification) {
+            $dsn .= '?verify_peer=0';
+        }
+        $this->mailer = new Mailer(Transport::fromDsn($dsn));
+    }
+    /**
+     * @param string[] $headers
+     * @throws TransportExceptionInterface
+     */
+    public function send(string $recipients, array $headers, string $body): int
+    {
+        $sender = '';
+        if (('WIN' !== strtoupper(substr(PHP_OS, 0, 3))) && !ini_get('safe_mode')) {
+            $sender = str_replace(['<', '>'], '', $headers['Return-Path']);
+            unset($headers['Return-Path']);
+        }
+        $email = (new Email())
+            ->from(empty($sender) ? $this->user : $sender)
+            ->to($recipients)
+            ->subject($headers['Subject'])
+            ->text($body)
+            ->html($body);
+        if (isset($headers['CC'])) {
+            $email->cc($headers['CC']);
+        }
+        if (isset($headers['Bcc'])) {
+            $email->bcc($headers['Bcc']);
+        }
+        if (isset($headers['Reply-To'])) {
+            $email->replyTo($headers['Reply-To']);
+        }
+        $this->mailer->send($email);
+        return 1;
+    }
+}

--- a/phpmyfaq/src/phpMyFAQ/Session.php
+++ b//dev/null
@@ -1,401 +0,0 @@
-<?php
-/**
- * The main Session class.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2007-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2007-03-31
- */
-namespace phpMyFAQ;
-use Exception;
-use phpMyFAQ\Enums\SessionActionType;
-use phpMyFAQ\User\CurrentUser;
-use Random\RandomException;
-use stdClass;
-use Symfony\Component\HttpFoundation\IpUtils;
-use Symfony\Component\HttpFoundation\Request;
-/**
- * Class Session
- *
- * @package phpMyFAQ
- */
-class Session
-{
-    /** @var string Name of the "remember me" cookie */
-    final public const PMF_COOKIE_NAME_REMEMBERME = 'pmf_rememberme';
-    /** @var string Name of the session cookie */
-    final public const PMF_COOKIE_NAME_SESSIONID = 'pmf_sid';
-    /** @var string Name of the session GET parameter */
-    final public const PMF_GET_KEY_NAME_SESSIONID = 'sid';
-    /** @var string EntraID session key */
-    final public const PMF_AZURE_AD_SESSIONKEY = 'phpmyfaq_aad_sessionkey';
-    /** @var string */
-    final public const PMF_AZURE_AD_OAUTH_VERIFIER = 'phpmyfaq_azure_ad_oauth_verifier';
-    /** @var string */
-    final public const PMF_AZURE_AD_JWT = 'phpmyfaq_azure_ad_jwt';
-    private ?int $currentSessionId = null;
-    private string $currentSessionKey;
-    private ?CurrentUser $currentUser = null;
-    public function __construct(private readonly Configuration $configuration)
-    {
-        $this->createCurrentSessionKey();
-    }
-    /**
-     * Returns the current session ID.
-     */
-    public function getCurrentSessionId(): ?int
-    {
-        return $this->currentSessionId;
-    }
-    /**
-     * Sets the current session ID.
-     */
-    public function setCurrentSessionId(int $currentSessionId): Session
-    {
-        $this->currentSessionId = $currentSessionId;
-        return $this;
-    }
-    /**
-     * Sets current User object
-     */
-    public function setCurrentUser(CurrentUser $currentUser): Session
-    {
-        $this->currentUser = $currentUser;
-        return $this;
-    }
-    /**
-     * Returns the current UUID session key
-     */
-    public function getCurrentSessionKey(): ?string
-    {
-        return $this->currentSessionKey ?? $this->get(self::PMF_AZURE_AD_SESSIONKEY);
-    }
-    /**
-     * Sets the current UUID session key
-     *
-     * @throws Exception
-     */
-    public function setCurrentSessionKey(): Session
-    {
-        if (!isset($this->currentSessionKey)) {
-            $this->createCurrentSessionKey();
-        }
-        $this->set(self::PMF_AZURE_AD_SESSIONKEY, $this->currentSessionKey);
-        return $this;
-    }
-    /**
-     * Creates the current UUID session key
-     */
-    public function createCurrentSessionKey(): void
-    {
-        $this->currentSessionKey = $this->uuid();
-    }
-    public function set(string $key, string $value): void
-    {
-        $_SESSION[$key] = $value;
-    }
-    public function get(string $key): string
-    {
-        return $_SESSION[$key] ?? '';
-    }
-    /**
-     * Returns the timestamp of a session.
-     *
-     * @param int $sessionId Session ID
-     */
-    public function getTimeFromSessionId(int $sessionId): int
-    {
-        $timestamp = 0;
-        $query = sprintf('SELECT time FROM %sfaqsessions WHERE sid = %d', Database::getTablePrefix(), $sessionId);
-        $result = $this->configuration->getDb()->query($query);
-        if ($result) {
-            $res = $this->configuration->getDb()->fetchObject($result);
-            $timestamp = $res->time;
-        }
-        return $timestamp;
-    }
-    /**
-     * Returns all session from a date.
-     *
-     * @param int $firstHour First hour
-     * @param int $lastHour Last hour
-     *
-     * @return array<int, string[]>
-     */
-    public function getSessionsByDate(int $firstHour, int $lastHour): array
-    {
-        $sessions = [];
-        $query = sprintf(
-            'SELECT sid, ip, time FROM %sfaqsessions WHERE time > %d AND time < %d ORDER BY time',
-            Database::getTablePrefix(),
-            $firstHour,
-            $lastHour
-        );
-        $result = $this->configuration->getDb()->query($query);
-        while ($row = $this->configuration->getDb()->fetchObject($result)) {
-            $sessions[$row->sid] = [
-                'ip' => $row->ip,
-                'time' => $row->time,
-            ];
-        }
-        return $sessions;
-    }
-    /**
-     * Returns the number of sessions.
-     */
-    public function getNumberOfSessions(): int
-    {
-        $num = 0;
-        $query = sprintf('SELECT COUNT(sid) as num_sessions FROM %sfaqsessions', Database::getTablePrefix());
-        $result = $this->configuration->getDb()->query($query);
-        if ($result) {
-            $row = $this->configuration->getDb()->fetchObject($result);
-            $num = $row->num_sessions;
-        }
-        return $num;
-    }
-    /**
-     * Deletes the sessions for a given timespan.
-     *
-     * @param int $first First session ID
-     * @param int $last Last session ID
-     */
-    public function deleteSessions(int $first, int $last): bool
-    {
-        $query = sprintf(
-            'DELETE FROM %sfaqsessions WHERE time >= %d AND time <= %d',
-            Database::getTablePrefix(),
-            $first,
-            $last
-        );
-        $this->configuration->getDb()->query($query);
-        return true;
-    }
-    /**
-     * Deletes all entries in the table.
-     */
-    public function deleteAllSessions(): mixed
-    {
-        $query = sprintf('DELETE FROM %sfaqsessions', Database::getTablePrefix());
-        return $this->configuration->getDb()->query($query);
-    }
-    /**
-     * Checks the Session ID.
-     *
-     * @param int    $sessionIdToCheck Session ID
-     * @param string $ipAddress IP
-     */
-    public function checkSessionId(int $sessionIdToCheck, string $ipAddress): void
-    {
-        $query = sprintf(
-            "SELECT sid FROM %sfaqsessions WHERE sid = %d AND ip = '%s' AND time > %d",
-            Database::getTablePrefix(),
-            $sessionIdToCheck,
-            $ipAddress,
-            Request::createFromGlobals()->server->get('REQUEST_TIME') - 86400
-        );
-        $result = $this->configuration->getDb()->query($query);
-        if ($this->configuration->getDb()->numRows($result) == 0) {
-            $this->userTracking(SessionActionType::OLD_SESSION->value, $sessionIdToCheck);
-        } else {
-            $this->setCurrentSessionId($sessionIdToCheck);
-            $query = sprintf(
-                "UPDATE %sfaqsessions SET time = %d, user_id = %d WHERE sid = %d AND ip = '%s'",
-                Database::getTablePrefix(),
-                Request::createFromGlobals()->server->get('REQUEST_TIME'),
-                $this->currentUser->getUserId(),
-                $sessionIdToCheck,
-                $ipAddress
-            );
-            $this->configuration->getDb()->query($query);
-        }
-    }
-    /**
-     * Returns the botIgnoreList as an array.
-     *
-     * @return array<string>
-     */
-    private function getBotIgnoreList(): array
-    {
-        return explode(',', (string) $this->configuration->get('main.botIgnoreList'));
-    }
-    /**
-     * Tracks the user and log what he did.
-     *
-     * @param string          $action Action string
-     * @param int|string|null $data
-     */
-    public function userTracking(string $action, int|string|null $data = null): void
-    {
-        if (!$this->configuration->get('main.enableUserTracking')) {
-            return;
-        }
-        $request = Request::createFromGlobals();
-        $bots = 0;
-        $banned = false;
-        $this->currentSessionId = Filter::filterVar(
-            $request->query->get(self::PMF_GET_KEY_NAME_SESSIONID),
-            FILTER_VALIDATE_INT
-        );
-        $cookieId = Filter::filterVar($request->query->get(self::PMF_COOKIE_NAME_SESSIONID), FILTER_VALIDATE_INT);
-        if (!is_null($cookieId)) {
-            $this->setCurrentSessionId($cookieId);
-        }
-        if ($action === SessionActionType::OLD_SESSION->value) {
-            $this->setCurrentSessionId(0);
-        }
-        foreach ($this->getBotIgnoreList() as $bot) {
-            if (Strings::strstr($request->headers->get('user-agent'), $bot)) {
-                ++$bots;
-            }
-        }
-        $remoteAddress = Request::createFromGlobals()->getClientIp();
-        $localAddresses = ['127.0.0.1', '::1'];
-        if (in_array($remoteAddress, $localAddresses) && $request->headers->has('X-Forwarded-For')) {
-            $remoteAddress = $request->headers->get('X-Forwarded-For');
-        }
-        $remoteAddress = preg_replace('([^0-9a-z:.]+)i', '', (string) $remoteAddress);
-        $remoteAddress = IpUtils::anonymize($remoteAddress);
-        $network = new Network($this->configuration);
-        if ($network->isBanned($remoteAddress)) {
-            $banned = true;
-        }
-        if (0 === $bots && false === $banned) {
-            if ($this->currentSessionId === null) {
-                $this->currentSessionId = $this->configuration->getDb()->nextId(
-                    Database::getTablePrefix() . 'faqsessions',
-                    'sid'
-                );
-                if (!is_null($cookieId) && (!$cookieId != $this->getCurrentSessionId())) {
-                    self::setCookie(self::PMF_COOKIE_NAME_SESSIONID, $this->getCurrentSessionId());
-                }
-                $query = sprintf(
-                    "INSERT INTO %sfaqsessions (sid, user_id, ip, time) VALUES (%d, %d, '%s', %d)",
-                    Database::getTablePrefix(),
-                    $this->getCurrentSessionId(),
-                    isset($this->currentUser) ? $this->currentUser->getUserId() : 0,
-                    $remoteAddress,
-                    $request->server->get('REQUEST_TIME')
-                );
-                $this->configuration->getDb()->query($query);
-            }
-            $data = $this->getCurrentSessionId() . ';' .
-                str_replace(';', ',', $action) . ';' .
-                $data . ';' .
-                $remoteAddress . ';' .
-                str_replace(';', ',', $request->server->get('QUERY_STRING') ?? '') . ';' .
-                str_replace(';', ',', $request->server->get('HTTP_REFERER') ?? '') . ';' .
-                str_replace(';', ',', urldecode((string) $request->server->get('HTTP_USER_AGENT'))) . ';' .
-                $request->server->get('REQUEST_TIME') . ";\n";
-            $file = PMF_ROOT_DIR . '/content/core/data/tracking' . date('dmY');
-            if (!is_file($file)) {
-                touch($file);
-            }
-            if (!is_writable($file)) {
-                $this->configuration->getLogger()->error('Cannot write to ' . $file);
-            }
-            file_put_contents($file, $data, FILE_APPEND | LOCK_EX);
-        }
-    }
-    /**
-     * Store the Session ID into a persistent cookie expiring
-     * 3600 seconds after the page request.
-     *
-     * @param string          $name Cookie name
-     * @param int|string|null $sessionId Session ID
-     * @param int             $timeout Cookie timeout
-     */
-    public function setCookie(string $name, int|string|null $sessionId, int $timeout = 3600, bool $strict = true): bool
-    {
-        $request = Request::createFromGlobals();
-        return setcookie(
-            $name,
-            $sessionId ?? '',
-            [
-                'expires' => $request->server->get('REQUEST_TIME') + $timeout,
-                'path' => dirname($request->server->get('SCRIPT_NAME')),
-                'domain' => parse_url($this->configuration->getDefaultUrl(), PHP_URL_HOST),
-                'samesite' => $strict ? 'strict' : '',
-                'secure' => $request->isSecure(),
-                'httponly' => true,
-            ]
-        );
-    }
-    /**
-     * Returns the value of a cookie.
-     *
-     * @param string $name Cookie name
-     */
-    public function getCookie(string $name): string
-    {
-        $request = Request::createFromGlobals();
-        return $request->cookies->get($name, '');
-    }
-    /**
-     * Calculates the number of visits per day the last 30 days.
-     *
-     * @return array<int, stdClass>
-     */
-    public function getLast30DaysVisits(): array
-    {
-        $stats = [];
-        $visits = [];
-        $completeData = [];
-        $startDate = strtotime('-1 month');
-        $endDate = Request::createFromGlobals()->server->get('REQUEST_TIME');
-        $query = sprintf(
-            'SELECT time FROM %sfaqsessions WHERE time > %d AND time < %d;',
-            Database::getTablePrefix(),
-            $startDate,
-            $endDate
-        );
-        $result = $this->configuration->getDb()->query($query);
-        while ($row = $this->configuration->getDb()->fetchObject($result)) {
-            $visits[] = $row->time;
-        }
-        for ($date = $startDate; $date <= $endDate; $date += 86400) {
-            $stats[date('Y-m-d', $date)] = 0;
-        }
-        foreach ($visits as $visitDate) {
-            if (isset($stats[date('Y-m-d', $visitDate)])) {
-                ++$stats[date('Y-m-d', $visitDate)];
-            }
-        }
-        foreach (array_keys($stats) as $date) {
-            $visit = new stdClass();
-            $visit->date = $date;
-            $visit->number = $stats[$date];
-            $completeData[] = $visit;
-        }
-        return $completeData;
-    }
-    /**
-     * Returns a UUID Version 4 compatible universally unique identifier.
-     */
-    public function uuid(): string
-    {
-        try {
-            return sprintf(
-                '%04x%04x-%04x-%04x-%04x-%04x%04x%04x',
-                random_int(0, 0xffff),
-                random_int(0, 0xffff),
-                random_int(0, 0xffff),
-                random_int(0, 0x0fff) | 0x4000,
-                random_int(0, 0x3fff) | 0x8000,
-                random_int(0, 0xffff),
-                random_int(0, 0xffff),
-                random_int(0, 0xffff)
-            );
-        } catch (RandomException $e) {
-            $this->configuration->getLogger()->error('Cannot generate UUID: ' . $e->getMessage());
-            return '';
-        }
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Setup/Installer.php
+++ b//dev/null
@@ -1,1016 +0,0 @@
-<?php
-/**
- * The Installer class installs phpMyFAQ. Classy.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Florian Anderiasch <florian@phpmyfaq.net>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-08-27
- */
-namespace phpMyFAQ\Setup;
-use Composer\Autoload\ClassLoader;
-use Elastic\Elasticsearch\ClientBuilder;
-use Elastic\Elasticsearch\Exception\AuthenticationException;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Configuration\DatabaseConfiguration;
-use phpMyFAQ\Configuration\ElasticsearchConfiguration;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Database;
-use phpMyFAQ\Database\DatabaseDriver;
-use phpMyFAQ\Entity\InstanceEntity;
-use phpMyFAQ\Enums\PermissionType;
-use phpMyFAQ\Enums\ReleaseType;
-use phpMyFAQ\Filter;
-use phpMyFAQ\Forms;
-use phpMyFAQ\Instance;
-use phpMyFAQ\Instance\Database as InstanceDatabase;
-use phpMyFAQ\Instance\Database\Stopwords;
-use phpMyFAQ\Instance\Elasticsearch;
-use phpMyFAQ\Instance\Main;
-use phpMyFAQ\Instance\Setup;
-use phpMyFAQ\Ldap;
-use phpMyFAQ\Link;
-use phpMyFAQ\System;
-use phpMyFAQ\User;
-use SplFileObject;
-use Symfony\Component\HttpFoundation\Request;
-use Tivie\HtaccessParser\Exception\SyntaxException;
-use Tivie\HtaccessParser\Parser;
-use const Tivie\HtaccessParser\Token\TOKEN_DIRECTIVE;
-/**
- * Class Installer
- *
- * @package phpMyFAQ
- */
-class Installer extends Setup
-{
-    /**
-     * Array with user rights.
-     * @var array<array>
-     */
-    protected array $mainRights = [
-        [
-            'name' => PermissionType::USER_ADD->value,
-            'description' => 'Right to add user accounts',
-        ],
-        [
-            'name' => PermissionType::USER_EDIT->value,
-            'description' => 'Right to edit user accounts',
-        ],
-        [
-            'name' => PermissionType::USER_DELETE->value,
-            'description' => 'Right to delete user accounts',
-        ],
-        [
-            'name' => PermissionType::FAQ_ADD->value,
-            'description' => 'Right to add faq entries',
-        ],
-        [
-            'name' => PermissionType::FAQ_EDIT->value,
-            'description' => 'Right to edit faq entries',
-        ],
-        [
-            'name' => PermissionType::FAQ_DELETE->value,
-            'description' => 'Right to delete faq entries',
-        ],
-        [
-            'name' => PermissionType::STATISTICS_VIEWLOGS->value,
-            'description' => 'Right to view logfiles',
-        ],
-        [
-            'name' => PermissionType::STATISTICS_ADMINLOG->value,
-            'description' => 'Right to view admin log',
-        ],
-        [
-            'name' => PermissionType::COMMENT_DELETE->value,
-            'description' => 'Right to delete comments',
-        ],
-        [
-            'name' => PermissionType::NEWS_ADD->value,
-            'description' => 'Right to add news',
-        ],
-        [
-            'name' => PermissionType::NEWS_EDIT->value,
-            'description' => 'Right to edit news',
-        ],
-        [
-            'name' => PermissionType::NEWS_DELETE->value,
-            'description' => 'Right to delete news',
-        ],
-        [
-            'name' => PermissionType::CATEGORY_ADD->value,
-            'description' => 'Right to add categories',
-        ],
-        [
-            'name' => PermissionType::CATEGORY_EDIT->value,
-            'description' => 'Right to edit categories',
-        ],
-        [
-            'name' => PermissionType::CATEGORY_DELETE->value,
-            'description' => 'Right to delete categories',
-        ],
-        [
-            'name' => PermissionType::PASSWORD_CHANGE->value,
-            'description' => 'Right to change passwords',
-        ],
-        [
-            'name' => PermissionType::CONFIGURATION_EDIT->value,
-            'description' => 'Right to edit configuration',
-        ],
-        [
-            'name' => PermissionType::VIEW_ADMIN_LINK->value,
-            'description' => 'Right to see the link to the admin section'
-        ],
-        [
-            'name' => PermissionType::BACKUP->value,
-            'description' => 'Right to save backups',
-        ],
-        [
-            'name' => PermissionType::RESTORE->value,
-            'description' => 'Right to load backups',
-        ],
-        [
-            'name' => PermissionType::QUESTION_DELETE->value,
-            'description' => 'Right to delete questions',
-        ],
-        [
-            'name' => PermissionType::GLOSSARY_ADD->value,
-            'description' => 'Right to add glossary entries',
-        ],
-        [
-            'name' => PermissionType::GLOSSARY_EDIT->value,
-            'description' => 'Right to edit glossary entries',
-        ],
-        [
-            'name' => PermissionType::GLOSSARY_DELETE->value,
-            'description' => 'Right to delete glossary entries',
-        ],
-        [
-            'name' => PermissionType::REVISION_UPDATE->value,
-            'description' => 'Right to edit revisions',
-        ],
-        [
-            'name' => PermissionType::GROUP_ADD->value,
-            'description' => 'Right to add group accounts',
-        ],
-        [
-            'name' => PermissionType::GROUP_EDIT->value,
-            'description' => 'Right to edit group accounts',
-        ],
-        [
-            'name' => PermissionType::GROUP_DELETE->value,
-            'description' => 'Right to delete group accounts',
-        ],
-        [
-            'name' => 'addtranslation',
-            'description' => 'Right to add translation',
-        ],
-        [
-            'name' => 'edittranslation',
-            'description' => 'Right to edit translations',
-        ],
-        [
-            'name' => 'deltranslation',
-            'description' => 'Right to delete translations',
-        ],
-        [
-            'name' => 'approverec',
-            'description' => 'Right to approve records',
-        ],
-        [
-            'name' => PermissionType::ATTACHMENT_ADD->value,
-            'description' => 'Right to add attachments',
-        ],
-        [
-            'name' => 'editattachment',
-            'description' => 'Right to edit attachments',
-        ],
-        [
-            'name' => 'delattachment',
-            'description' => 'Right to delete attachments',
-        ],
-        [
-            'name' => 'dlattachment',
-            'description' => 'Right to download attachments',
-        ],
-        [
-            'name' => 'reports',
-            'description' => 'Right to generate reports',
-        ],
-        [
-            'name' => 'addfaq',
-            'description' => 'Right to add FAQs in frontend',
-        ],
-        [
-            'name' => 'addquestion',
-            'description' => 'Right to add questions in frontend',
-        ],
-        [
-            'name' => PermissionType::COMMENT_ADD->value,
-            'description' => 'Right to add comments in frontend',
-        ],
-        [
-            'name' => 'editinstances',
-            'description' => 'Right to edit multi-site instances',
-        ],
-        [
-            'name' => 'addinstances',
-            'description' => 'Right to add multi-site instances',
-        ],
-        [
-            'name' => 'delinstances',
-            'description' => 'Right to delete multi-site instances',
-        ],
-        [
-            'name' => 'export',
-            'description' => 'Right to export the complete FAQ',
-        ],
-        [
-            'name' => 'view_faqs',
-            'description' => 'Right to view FAQs'
-        ],
-        [
-            'name' => 'view_categories',
-            'description' => 'Right to view categories'
-        ],
-        [
-            'name' => 'view_news',
-            'description' => 'Right to view news'
-        ],
-        [
-            'name' => 'administrate_groups',
-            'description' => 'Right to administrate groups'
-        ],
-        [
-            'name' => 'forms_edit',
-            'description' => 'Right to edit forms'
-        ]
-    ];
-    /**
-     * Configuration array.
-     *
-     * @var array<string, string>
-     */
-    protected array $mainConfig = [
-        'main.currentVersion' => null,
-        'main.currentApiVersion' => null,
-        'main.language' => '__PHPMYFAQ_LANGUAGE__',
-        'main.languageDetection' => 'true',
-        'main.phpMyFAQToken' => null,
-        'main.referenceURL' => '__PHPMYFAQ_REFERENCE_URL__',
-        'main.administrationMail' => 'webmaster@example.org',
-        'main.contactInformation' => '',
-        'main.enableAdminLog' => 'true',
-        'main.enableUserTracking' => 'true',
-        'main.metaDescription' => 'phpMyFAQ should be the answer for all questions in life',
-        'main.metaPublisher' => '__PHPMYFAQ_PUBLISHER__',
-        'main.titleFAQ' => 'phpMyFAQ Codename Pallas',
-        'main.enableWysiwygEditor' => 'true',
-        'main.enableWysiwygEditorFrontend' => 'false',
-        'main.enableMarkdownEditor' => 'false',
-        'main.dateFormat' => 'Y-m-d H:i',
-        'main.maintenanceMode' => 'false',
-        'main.enableGravatarSupport' => 'false',
-        'main.customPdfHeader' => '',
-        'main.customPdfFooter' => '',
-        'main.enableSmartAnswering' => 'true',
-        'main.enableCategoryRestrictions' => 'true',
-        'main.enableSendToFriend' => 'true',
-        'main.privacyURL' => '',
-        'main.enableAutoUpdateHint' => 'true',
-        'main.enableAskQuestions' => 'false',
-        'main.enableNotifications' => 'false',
-        'main.botIgnoreList' => 'nustcrape,webpost,GoogleBot,msnbot,crawler,scooter,bravobrian,archiver,' .
-        'w3c,controler,wget,bot,spider,Yahoo! Slurp,htdig,gsa-crawler,AirControler,Uptime-Kuma,facebookcatalog/1.0,' .
-        'facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php),facebookexternalhit/1.1',
-        'records.numberOfRecordsPerPage' => '10',
-        'records.numberOfShownNewsEntries' => '3',
-        'records.defaultActivation' => 'false',
-        'records.defaultAllowComments' => 'false',
-        'records.enableVisibilityQuestions' => 'false',
-        'records.numberOfRelatedArticles' => '5',
-        'records.orderby' => 'id',
-        'records.sortby' => 'DESC',
-        'records.orderingPopularFaqs' => 'visits',
-        'records.disableAttachments' => 'true',
-        'records.maxAttachmentSize' => '100000',
-        'records.attachmentsPath' => 'content/user/attachments',
-        'records.attachmentsStorageType' => '0',
-        'records.enableAttachmentEncryption' => 'false',
-        'records.defaultAttachmentEncKey' => '',
-        'records.enableCloseQuestion' => 'false',
-        'records.enableDeleteQuestion' => 'false',
-        'records.randomSort' => 'false',
-        'records.allowCommentsForGuests' => 'true',
-        'records.allowQuestionsForGuests' => 'true',
-        'records.allowNewFaqsForGuests' => 'true',
-        'records.hideEmptyCategories' => 'false',
-        'records.allowDownloadsForGuests' => 'false',
-        'records.numberMaxStoredRevisions' => '10',
-        'records.enableAutoRevisions' => 'false',
-        'records.orderStickyFaqsCustom' => 'false',
-        'records.allowedMediaHosts' => 'www.youtube.com',
-        'search.numberSearchTerms' => '10',
-        'search.relevance' => 'thema,content,keywords',
-        'search.enableRelevance' => 'false',
-        'search.enableHighlighting' => 'true',
-        'search.searchForSolutionId' => 'true',
-        'search.enableElasticsearch' => 'false',
-        'security.permLevel' => 'basic',
-        'security.ipCheck' => 'false',
-        'security.enableLoginOnly' => 'false',
-        'security.bannedIPs' => '',
-        'security.ssoSupport' => 'false',
-        'security.ssoLogoutRedirect' => '',
-        'security.useSslForLogins' => 'false',
-        'security.useSslOnly' => 'false',
-        'security.forcePasswordUpdate' => 'false',
-        'security.enableRegistration' => 'true',
-        'security.domainWhiteListForRegistrations' => '',
-        'security.enableSignInWithMicrosoft' => 'false',
-        'security.enableGoogleReCaptchaV2' => 'false',
-        'security.googleReCaptchaV2SiteKey' => '',
-        'security.googleReCaptchaV2SecretKey' => '',
-        'security.loginWithEmailAddress' => 'false',
-        'security.enableWebAuthnSupport' => 'false',
-        'spam.checkBannedWords' => 'true',
-        'spam.enableCaptchaCode' => null,
-        'spam.enableSafeEmail' => 'true',
-        'spam.manualActivation' => 'true',
-        'spam.mailAddressInExport' => 'true',
-        'seo.title' => 'phpMyFAQ Codename Pallas',
-        'seo.description' => 'phpMyFAQ should be the answer for all questions in life',
-        'seo.enableXMLSitemap' => 'true',
-        'seo.enableRichSnippets' => 'false',
-        'seo.metaTagsHome' => 'index, follow',
-        'seo.metaTagsFaqs' => 'index, follow',
-        'seo.metaTagsCategories' => 'index, follow',
-        'seo.metaTagsPages' => 'index, follow',
-        'seo.metaTagsAdmin' => 'noindex, nofollow',
-        'mail.noReplySenderAddress' => '',
-        'mail.remoteSMTP' => 'false',
-        'mail.remoteSMTPServer' => '',
-        'mail.remoteSMTPUsername' => '',
-        'mail.remoteSMTPPassword' => '',
-        'mail.remoteSMTPPort' => '25',
-        'mail.remoteSMTPDisableTLSPeerVerification' => 'false',
-        'ldap.ldapSupport' => 'false',
-        'ldap.ldap_mapping.name' => 'cn',
-        'ldap.ldap_mapping.username' => 'samAccountName',
-        'ldap.ldap_mapping.mail' => 'mail',
-        'ldap.ldap_mapping.memberOf' => '',
-        'ldap.ldap_use_domain_prefix' => 'true',
-        'ldap.ldap_options.LDAP_OPT_PROTOCOL_VERSION' => '3',
-        'ldap.ldap_options.LDAP_OPT_REFERRALS' => '0',
-        'ldap.ldap_use_memberOf' => 'false',
-        'ldap.ldap_use_sasl' => 'false',
-        'ldap.ldap_use_multiple_servers' => 'false',
-        'ldap.ldap_use_anonymous_login' => 'false',
-        'ldap.ldap_use_dynamic_login' => 'false',
-        'ldap.ldap_dynamic_login_attribute' => 'uid',
-        'api.enableAccess' => 'true',
-        'api.apiClientToken' => '',
-        'upgrade.dateLastChecked' => '',
-        'upgrade.lastDownloadedPackage' => '',
-        'upgrade.onlineUpdateEnabled' => 'false',
-        'upgrade.releaseEnvironment' => '__PHPMYFAQ_RELEASE__',
-        'layout.templateSet' => 'default',
-        'layout.enablePrivacyLink' => 'true',
-        'layout.enableCookieConsent' => 'true',
-        'layout.contactInformationHTML' => 'false',
-        'layout.customCss' => '',
-    ];
-    /**
-     * Array with form inputs
-     * @var array<array>
-     */
-    public array $formInputs = [
-        [
-            'form_id' => 1,
-            'input_id' => 1,
-            'input_type' => 'title',
-            'input_label' => 'msgQuestion',
-            'input_active' => 1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 1,
-            'input_id' => 2,
-            'input_type' => 'message',
-            'input_label' => 'msgNewQuestion',
-            'input_active' => 1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 1,
-            'input_id' => 3,
-            'input_type' => 'text',
-            'input_label' => 'msgNewContentName',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 1,
-            'input_id' => 4,
-            'input_type' => 'email',
-            'input_label' => 'msgNewContentMail',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 1,
-            'input_id' => 5,
-            'input_type' => 'select',
-            'input_label' => 'msgNewContentCategory',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 1,
-            'input_id' => 6,
-            'input_type' => 'textarea',
-            'input_label' => 'msgAskYourQuestion',
-            'input_active' => -1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 1,
-            'input_type' => 'title',
-            'input_label' => 'msgNewContentHeader',
-            'input_active' => 1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 2,
-            'input_type' => 'message',
-            'input_label' => 'msgNewContentAddon',
-            'input_active' => 1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 3,
-            'input_type' => 'text',
-            'input_label' => 'msgNewContentName',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 4,
-            'input_type' => 'email',
-            'input_label' => 'msgNewContentMail',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 5,
-            'input_type' => 'select',
-            'input_label' => 'msgNewContentCategory',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 6,
-            'input_type' => 'textarea',
-            'input_label' => 'msgNewContentTheme',
-            'input_active' => -1,
-            'input_required' => -1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 7,
-            'input_type' => 'textarea',
-            'input_label' => 'msgNewContentArticle',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 8,
-            'input_type' => 'text',
-            'input_label' => 'msgNewContentKeywords',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ],
-        [
-            'form_id' => 2,
-            'input_id' => 9,
-            'input_type' => 'title',
-            'input_label' => 'msgNewContentLink',
-            'input_active' => 1,
-            'input_required' => 1,
-            'input_lang' => 'default'
-        ]
-    ];
-    /**
-     * Constructor.
-     *
-     * @throws \Exception
-     */
-    public function __construct(private readonly System $system)
-    {
-        parent::__construct();
-        $dynMainConfig = [
-            'main.currentVersion' => System::getVersion(),
-            'main.currentApiVersion' => System::getApiVersion(),
-            'main.phpMyFAQToken' => bin2hex(random_bytes(16)),
-            'spam.enableCaptchaCode' => (extension_loaded('gd') ? 'true' : 'false'),
-            'upgrade.releaseEnvironment' =>
-                System::isDevelopmentVersion() ? ReleaseType::DEVELOPMENT->value : ReleaseType::STABLE->value
-        ];
-        $this->mainConfig = array_merge($this->mainConfig, $dynMainConfig);
-    }
-    /**
-     * Removes the database.php and the ldap.php if an installation failed.
-     */
-    public static function cleanFailedInstallationFiles(): void
-    {
-        if (file_exists(PMF_ROOT_DIR . '/content/core/config/database.php')) {
-            unlink(PMF_ROOT_DIR . '/content/core/config/database.php');
-        }
-        if (file_exists(PMF_ROOT_DIR . '/content/core/config/ldap.php')) {
-            unlink(PMF_ROOT_DIR . '/content/core/config/ldap.php');
-        }
-    }
-    /**
-     * Check the necessary stuff and throw an exception if something is wrong.
-     * @throws Exception
-     */
-    public function checkBasicStuff(): void
-    {
-        if (!$this->checkMinimumPhpVersion()) {
-            throw new Exception(sprintf('Sorry, but you need PHP %s or later!', System::VERSION_MINIMUM_PHP));
-        }
-        if (!function_exists('date_default_timezone_set')) {
-            throw new Exception('Sorry, but setting a default timezone does not work in your environment!');
-        }
-        if (!$this->system->checkDatabase()) {
-            throw new Exception('No supported database detected!');
-        }
-        if (!$this->system->checkRequiredExtensions()) {
-            throw new Exception(
-                sprintf(
-                    'Some required PHP extensions are missing: %s',
-                    implode(', ', $this->system->getMissingExtensions())
-                )
-            );
-        }
-        if (!$this->system->checkInstallation()) {
-            throw new Exception(
-                'Looks like phpMyFAQ is already installed! Please use the <a href="../update">update</a>.'
-            );
-        }
-    }
-    /**
-     * Checks if the file permissions are okay.
-     */
-    public function checkFilesystemPermissions(): string|null
-    {
-        $instanceSetup = new Setup();
-        $instanceSetup->setRootDir(PMF_ROOT_DIR);
-        $dirs = [
-            '/content/core/config',
-            '/content/core/data',
-            '/content/core/logs',
-            '/content/user/images',
-            '/content/user/attachments',
-        ];
-        $failedDirs = $instanceSetup->checkDirs($dirs);
-        $numDirs = count($failedDirs);
-        $hints = '';
-        if (1 <= $numDirs) {
-            $hints .= sprintf(
-                '<p class="alert alert-danger">The following %s could not be created or %s not writable:</p><ul>',
-                (1 < $numDirs) ? 'directories' : 'directory',
-                (1 < $numDirs) ? 'are' : 'is'
-            );
-            foreach ($failedDirs as $failedDir) {
-                $hints .= "<li>{$failedDir}</li>\n";
-            }
-            $hints .= sprintf(
-                '</ul><p class="alert alert-danger">Please create %s manually and/or change access to chmod 775 (or ' .
-                'greater if necessary).</p>',
-                (1 < $numDirs) ? 'them' : 'it'
-            );
-            return $hints;
-        }
-        return null;
-    }
-    /**
-     * Checks some non-critical settings and print some hints.
-     *
-     * @return string[]
-     */
-    public function checkNoncriticalSettings(): array
-    {
-        $hints = [];
-        if (!$this->system->getHttpsStatus()) {
-            $hints[] = '<p class="alert alert-warning">HTTPS support is not enabled in your web server.' .
-                ' To ensure the security of your data and protect against potential vulnerabilities,' .
-                ' we highly recommend enabling HTTPS. Please configure your web server to support HTTPS as soon as' .
-                ' possible.</p>';
-        }
-        if (!extension_loaded('gd')) {
-            $hints[] = '<p class="alert alert-warning">You don\'t have GD support enabled in your PHP installation. ' .
-                "Please enable GD support in your php.ini file otherwise you can't use Captchas for spam protection." .
-                "</p>";
-        }
-        if (!function_exists('imagettftext')) {
-            $hints[] = '<p class="alert alert-warning">You don\'t have Freetype support enabled in the GD extension ' .
-                ' of your PHP installation. Please enable Freetype support in GD extension otherwise the Captchas ' .
-                'for spam protection will be quite easy to break.</p>';
-        }
-        if (!extension_loaded('curl') || !extension_loaded('openssl')) {
-            $hints[] = '<p class="alert alert-warning">You don\'t have cURL and/or OpenSSL support enabled in your ' .
-                "PHP installation. Please enable cURL and/or OpenSSL support in your php.ini file otherwise you " .
-                " can't use Elasticsearch.</p>";
-        }
-        if (!extension_loaded('fileinfo')) {
-            $hints[] = '<p class="alert alert-warning">You don\'t have Fileinfo support enabled in your PHP ' .
-                "installation. Please enable Fileinfo support in your php.ini file otherwise you can't use our " .
-                'backup/restore functionality.</p>';
-        }
-        if (!extension_loaded('sodium')) {
-            $hints[] = '<p class="alert alert-warning">You don\'t have Sodium support enabled in your PHP ' .
-                "installation. Please enable Sodium support in your php.ini file otherwise you can't use our " .
-                'backup/restore functionality.</p>';
-        }
-        return $hints;
-    }
-    /**
-     * @throws Exception
-     */
-    public function checkInitialRewriteBasePath(Request $request): bool
-    {
-        $basePath = $request->getBasePath();
-        $basePath = rtrim($basePath, 'setup');
-        $htaccessPath = PMF_ROOT_DIR . '/.htaccess';
-        $file = new SplFileObject($htaccessPath);
-        $parser = new Parser();
-        try {
-            $htaccess = $parser->parse($file);
-        } catch (SyntaxException $e) {
-            throw new Exception('Syntax error in .htaccess file: ' . $e->getMessage());
-        } catch (\Tivie\HtaccessParser\Exception\Exception $e) {
-            throw new Exception('Error parsing .htaccess file: ' . $e->getMessage());
-        }
-        $rewriteBase = $htaccess->search('RewriteBase', TOKEN_DIRECTIVE);
-        $rewriteBase->removeArgument($rewriteBase->getArguments()[0]);
-        $rewriteBase->setArguments((array)$basePath);
-        $output = (string) $htaccess;
-        return file_put_contents($htaccessPath, $output);
-    }
-    /**
-     * Starts the installation.
-     *
-     * @param array|null $setup
-     * @throws Exception|AuthenticationException
-     */
-    public function startInstall(array|null $setup = null): void
-    {
-        $ldapSetup = [];
-        $query = [];
-        $uninstall = [];
-        $dbSetup = [];
-        $dbSetup['dbPrefix'] = Filter::filterInput(INPUT_POST, 'sqltblpre', FILTER_SANITIZE_SPECIAL_CHARS, '');
-        if ('' !== $dbSetup['dbPrefix']) {
-            Database::setTablePrefix($dbSetup['dbPrefix']);
-        }
-        if (!isset($setup['dbType'])) {
-            $dbSetup['dbType'] = Filter::filterInput(INPUT_POST, 'sql_type', FILTER_SANITIZE_SPECIAL_CHARS);
-        } else {
-            $dbSetup['dbType'] = $setup['dbType'];
-        }
-        if (!is_null($dbSetup['dbType'])) {
-            $dbSetup['dbType'] = trim((string) $dbSetup['dbType']);
-            if (!file_exists(PMF_SRC_DIR . '/phpMyFAQ/Instance/Database/' . ucfirst($dbSetup['dbType']) . '.php')) {
-                throw new Exception(sprintf('Installation Error: Invalid server type: %s', $dbSetup['dbType']));
-            }
-        } else {
-            throw new Exception('Installation Error: Please select a database type.');
-        }
-        $dbSetup['dbServer'] = Filter::filterInput(INPUT_POST, 'sql_server', FILTER_SANITIZE_SPECIAL_CHARS, '');
-        if (is_null($dbSetup['dbServer']) && !System::isSqlite($dbSetup['dbType'])) {
-            throw new Exception('Installation Error: Please add a database server.');
-        }
-        if (!isset($setup['dbType'])) {
-            $dbSetup['dbPort'] = Filter::filterInput(INPUT_POST, 'sql_port', FILTER_VALIDATE_INT);
-        } else {
-            $dbSetup['dbPort'] = $setup['dbPort'];
-        }
-        if (is_null($dbSetup['dbPort']) && ! System::isSqlite($dbSetup['dbType'])) {
-            throw new Exception('Installation Error: Please add a valid database port.');
-        }
-        $dbSetup['dbUser'] = Filter::filterInput(INPUT_POST, 'sql_user', FILTER_SANITIZE_SPECIAL_CHARS, '');
-        if (is_null($dbSetup['dbUser']) && !System::isSqlite($dbSetup['dbType'])) {
-            throw new Exception('Installation Error: Please add a database username.');
-        }
-        $dbSetup['dbPassword'] = Filter::filterInput(INPUT_POST, 'sql_password', FILTER_SANITIZE_SPECIAL_CHARS, '');
-        if (is_null($dbSetup['dbPassword']) && !System::isSqlite($dbSetup['dbType'])) {
-            $dbSetup['dbPassword'] = '';
-        }
-        if (!isset($setup['dbType'])) {
-            $dbSetup['dbDatabaseName'] = Filter::filterInput(INPUT_POST, 'sql_db', FILTER_SANITIZE_SPECIAL_CHARS);
-        } else {
-            $dbSetup['dbDatabaseName'] = $setup['dbDatabaseName'];
-        }
-        if (is_null($dbSetup['dbDatabaseName']) && !System::isSqlite($dbSetup['dbType'])) {
-            throw new Exception('Installation Error: Please add a database name.');
-        }
-        if (System::isSqlite($dbSetup['dbType'])) {
-            $dbSetup['dbServer'] = Filter::filterInput(
-                INPUT_POST,
-                'sql_sqlitefile',
-                FILTER_SANITIZE_SPECIAL_CHARS,
-                $setup['dbServer'] ?? null
-            );
-            if (is_null($dbSetup['dbServer'])) {
-                throw new Exception('Installation Error: Please add a SQLite database filename.');
-            }
-        }
-        Database::setTablePrefix($dbSetup['dbPrefix']);
-        $db = Database::factory($dbSetup['dbType']);
-        $db->connect(
-            $dbSetup['dbServer'],
-            $dbSetup['dbUser'],
-            $dbSetup['dbPassword'],
-            $dbSetup['dbDatabaseName'],
-            $dbSetup['dbPort']
-        );
-        $configuration = new Configuration($db);
-        $ldapEnabled = Filter::filterInput(INPUT_POST, 'ldap_enabled', FILTER_SANITIZE_SPECIAL_CHARS);
-        if (extension_loaded('ldap') && !is_null($ldapEnabled)) {
-            $ldapSetup['ldapServer'] = Filter::filterInput(INPUT_POST, 'ldap_server', FILTER_SANITIZE_SPECIAL_CHARS);
-            if (is_null($ldapSetup['ldapServer'])) {
-                throw new Exception('LDAP Installation Error: Please add a LDAP server.');
-            }
-            $ldapSetup['ldapPort'] = Filter::filterInput(INPUT_POST, 'ldap_port', FILTER_VALIDATE_INT);
-            if (is_null($ldapSetup['ldapPort'])) {
-                throw new Exception('LDAP Installation Error: Please add a LDAP port.');
-            }
-            $ldapSetup['ldapBase'] = Filter::filterInput(INPUT_POST, 'ldap_base', FILTER_SANITIZE_SPECIAL_CHARS);
-            if (is_null($ldapSetup['ldapBase'])) {
-                throw new Exception('LDAP Installation Error: Please add a LDAP base search DN.');
-            }
-            $ldapSetup['ldapUser'] = Filter::filterInput(INPUT_POST, 'ldap_user', FILTER_SANITIZE_SPECIAL_CHARS);
-            $ldapSetup['ldapPassword'] = Filter::filterInput(
-                INPUT_POST,
-                'ldap_password',
-                FILTER_SANITIZE_SPECIAL_CHARS
-            );
-            foreach ($this->mainConfig as $configKey => $configValue) {
-                if (str_contains($configKey, 'ldap.')) {
-                    $configuration->set($configKey, $configValue);
-                }
-            }
-            $ldap = new Ldap($configuration);
-            $ldapConnection = $ldap->connect(
-                $ldapSetup['ldapServer'],
-                $ldapSetup['ldapPort'],
-                $ldapSetup['ldapBase'],
-                $ldapSetup['ldapUser'],
-                $ldapSetup['ldapPassword']
-            );
-            if (!$ldapConnection) {
-                throw new Exception(sprintf('LDAP Installation Error: %s.', $ldap->error()));
-            }
-        }
-        $esEnabled = Filter::filterInput(INPUT_POST, 'elasticsearch_enabled', FILTER_SANITIZE_SPECIAL_CHARS);
-        if (!is_null($esEnabled)) {
-            $esSetup = [];
-            $esHostFilter = [
-                'elasticsearch_server' => [
-                    'filter' => FILTER_SANITIZE_SPECIAL_CHARS,
-                    'flags' => FILTER_REQUIRE_ARRAY
-                ]
-            ];
-            $esHosts = Filter::filterInputArray(INPUT_POST, $esHostFilter);
-            if (is_null($esHosts)) {
-                throw new Exception('Elasticsearch Installation Error: Please add at least one Elasticsearch host.');
-            }
-            $esSetup['hosts'] = $esHosts['elasticsearch_server'];
-            $esSetup['index'] = Filter::filterInput(INPUT_POST, 'elasticsearch_index', FILTER_SANITIZE_SPECIAL_CHARS);
-            if (is_null($esSetup['index'])) {
-                throw new Exception('Elasticsearch Installation Error: Please add an Elasticsearch index name.');
-            }
-            $classLoader = new ClassLoader();
-            $classLoader->addPsr4('Elasticsearch\\', PMF_SRC_DIR . '/libs/elasticsearch/src/Elasticsearch');
-            $classLoader->addPsr4('Monolog\\', PMF_SRC_DIR . '/libs/monolog/src/Monolog');
-            $classLoader->addPsr4('Psr\\', PMF_SRC_DIR . '/libs/psr/log/Psr');
-            $classLoader->addPsr4('React\\Promise\\', PMF_SRC_DIR . '/libs/react/promise/src');
-            $classLoader->register();
-            $esHosts = array_values($esHosts['elasticsearch_server']);
-            $esClient = ClientBuilder::create()->setHosts($esHosts)->build();
-            if (!$esClient) {
-                throw new Exception('Elasticsearch Installation Error: No connection to Elasticsearch.');
-            }
-        } else {
-            $esSetup = [];
-        }
-        if (!isset($setup['loginname'])) {
-            $loginName = Filter::filterInput(INPUT_POST, 'loginname', FILTER_SANITIZE_SPECIAL_CHARS);
-        } else {
-            $loginName = $setup['loginname'];
-        }
-        if (is_null($loginName)) {
-            throw new Exception('Installation Error: Please add a login name for your account.');
-        }
-        if (!isset($setup['password'])) {
-            $password = Filter::filterInput(INPUT_POST, 'password', FILTER_SANITIZE_SPECIAL_CHARS);
-        } else {
-            $password = $setup['password'];
-        }
-        if (is_null($password)) {
-            throw new Exception('Installation Error: Please add a password for your account.');
-        }
-        if (!isset($setup['password_retyped'])) {
-            $passwordRetyped = Filter::filterInput(INPUT_POST, 'password_retyped', FILTER_SANITIZE_SPECIAL_CHARS);
-        } else {
-            $passwordRetyped = $setup['password_retyped'];
-        }
-        if (is_null($passwordRetyped)) {
-            throw new Exception('Installation Error: Please add a retyped password.');
-        }
-        if (strlen((string) $password) <= 7 || strlen((string) $passwordRetyped) <= 7) {
-            throw new Exception(
-                'Installation Error: Your password and retyped password are too short. Please set your password ' .
-                'and your retyped password with a minimum of 8 characters.'
-            );
-        }
-        if ($password !== $passwordRetyped) {
-            throw new Exception(
-                'Installation Error: Your password and retyped password are not equal. Please check your password ' .
-                'and your retyped password.'
-            );
-        }
-        $language = Filter::filterInput(INPUT_POST, 'language', FILTER_SANITIZE_SPECIAL_CHARS, 'en');
-        $realname = Filter::filterInput(INPUT_POST, 'realname', FILTER_SANITIZE_SPECIAL_CHARS, '');
-        $email = Filter::filterInput(INPUT_POST, 'email', FILTER_SANITIZE_EMAIL, '');
-        $permLevel = Filter::filterInput(INPUT_POST, 'permLevel', FILTER_SANITIZE_SPECIAL_CHARS, 'basic');
-        $rootDir = $setup['rootDir'] ?? PMF_ROOT_DIR;
-        $instanceSetup = new Setup();
-        $instanceSetup->setRootDir($rootDir);
-        if (!$instanceSetup->createDatabaseFile($dbSetup)) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception('Installation Error: Setup cannot write to ./content/core/config/database.php.');
-        }
-        if (
-            extension_loaded('ldap') &&
-            !is_null($ldapEnabled) &&
-            count($ldapSetup) &&
-            !$instanceSetup->createLdapFile($ldapSetup, '')
-        ) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception('LDAP Installation Error: Setup cannot write to ./content/core/config/ldap.php.');
-        }
-        if (!is_null($esEnabled) && count($esSetup) && !$instanceSetup->createElasticsearchFile($esSetup, '')) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception(
-                'Elasticsearch Installation Error: Setup cannot write to ./content/core/config/elasticsearch.php.'
-            );
-        }
-        $databaseConfiguration = new DatabaseConfiguration($rootDir . '/content/core/config/database.php');
-        try {
-            $db = Database::factory($dbSetup['dbType']);
-        } catch (Exception $exception) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception(sprintf('Database Installation Error: %s', $exception->getMessage()));
-        }
-        $db->connect(
-            $databaseConfiguration->getServer(),
-            $databaseConfiguration->getUser(),
-            $databaseConfiguration->getPassword(),
-            $databaseConfiguration->getDatabase(),
-            $databaseConfiguration->getPort()
-        );
-        if (!$db instanceof DatabaseDriver) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception(sprintf('Database Installation Error: %s', $db->error()));
-        }
-        try {
-            $databaseInstaller = InstanceDatabase::factory($configuration, $dbSetup['dbType']);
-            $databaseInstaller->createTables($dbSetup['dbPrefix']);
-        } catch (Exception $exception) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception(sprintf('Database Installation Error: %s', $exception->getMessage()));
-        }
-        $stopWords = new Stopwords($configuration);
-        $stopWords->executeInsertQueries($dbSetup['dbPrefix']);
-        $this->system->setDatabase($db);
-        if (!System::isSqlite($dbSetup['dbType'])) {
-            $this->system->dropTables($uninstall);
-        }
-        $count = 0;
-        foreach ($query as $executeQuery) {
-            $result = @$db->query($executeQuery);
-            if (!$result) {
-                $this->system->dropTables($uninstall);
-                self::cleanFailedInstallationFiles();
-                throw new Exception(
-                    sprintf(
-                        'Installation Error: Please install your version of phpMyFAQ once again: %s (%s)',
-                        $db->error(),
-                        htmlentities($executeQuery)
-                    )
-                );
-            }
-            usleep(1000);
-            ++$count;
-            if ($count % 10 === 0) {
-                echo '| ';
-            }
-        }
-        $link = new Link('', $configuration);
-        $this->mainConfig['main.metaPublisher'] = $realname;
-        $this->mainConfig['main.administrationMail'] = $email;
-        $this->mainConfig['main.language'] = $language;
-        $this->mainConfig['security.permLevel'] = $permLevel;
-        foreach ($this->mainConfig as $name => $value) {
-            $configuration->add($name, $value);
-        }
-        $configuration->update(['main.referenceURL' => $setup['mainUrl'] ?? $link->getSystemUri('/setup/index.php')]);
-        $configuration->add('security.salt', md5($configuration->getDefaultUrl()));
-        $user = new User($configuration);
-        if (!$user->createUser($loginName, $password, '', 1)) {
-            self::cleanFailedInstallationFiles();
-            throw new Exception(
-                sprintf('Fatal Installation Error: Could not create the admin user: %s', $user->error())
-            );
-        }
-        $user->setStatus('protected');
-        $adminData = [
-            'display_name' => $realname,
-            'email' => $email,
-        ];
-        $user->setUserData($adminData);
-        $user->setSuperAdmin(true);
-        foreach ($this->mainRights as $mainRight) {
-            $user->perm->grantUserRight(1, $user->perm->addRight($mainRight));
-        }
-        $forms = new Forms($configuration);
-        foreach ($this->formInputs as $input) {
-            $forms->insertInputIntoDatabase($input);
-        }
-        $instanceSetup->createAnonymousUser($configuration);
-        $instanceEntity = new InstanceEntity();
-        $instanceEntity
-            ->setUrl($link->getSystemUri($_SERVER['SCRIPT_NAME']))
-            ->setInstance($link->getSystemRelativeUri('setup/index.php'))
-            ->setComment('phpMyFAQ ' . System::getVersion());
-        $faqInstance = new Instance($configuration);
-        $faqInstance->create($instanceEntity);
-        $faqMainInstance = new Main($configuration);
-        $faqMainInstance->createMain($faqInstance);
-        if (!is_null($esEnabled) && is_file($rootDir . '/config/elasticsearch.php')) {
-            $elasticsearchConfiguration = new ElasticsearchConfiguration($rootDir . '/config/elasticsearch.php');
-            $configuration->setElasticsearchConfig($elasticsearchConfiguration);
-            $esClient = ClientBuilder::create()->setHosts($elasticsearchConfiguration->getHosts())->build();
-            $configuration->setElasticsearch($esClient);
-            $faqInstanceElasticsearch = new Elasticsearch($configuration);
-            $faqInstanceElasticsearch->createIndex();
-        }
-        $configurator = new EnvironmentConfigurator($configuration);
-        $configurator->adjustRewriteBaseHtaccess();
-    }
-    /**
-     * Checks the minimum required PHP version, defined in System class.
-     * Returns true if it's okay.
-     */
-    public function checkMinimumPhpVersion(): bool
-    {
-        return version_compare(PHP_VERSION, System::VERSION_MINIMUM_PHP) >= 0;
-    }
-    public function hasLdapSupport(): bool
-    {
-        return extension_loaded('ldap');
-    }
-    public function hasElasticsearchSupport(): bool
-    {
-        return extension_loaded('curl') && extension_loaded('openssl');
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/Setup/Update.php
+++ b//dev/null
@@ -1,739 +0,0 @@
-<?php
-/**
- * The Update class updates phpMyFAQ. Classy.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-04-03
- */
-namespace phpMyFAQ\Setup;
-use phpMyFAQ\Configuration;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\Database;
-use phpMyFAQ\Database\DatabaseDriver;
-use phpMyFAQ\Enums\ReleaseType;
-use phpMyFAQ\Filesystem;
-use phpMyFAQ\Forms;
-use phpMyFAQ\Setup;
-use phpMyFAQ\System;
-use phpMyFAQ\User;
-use RecursiveDirectoryIterator;
-use RecursiveIteratorIterator;
-use SplFileObject;
-use Symfony\Component\HttpFoundation\Request;
-use Tivie\HtaccessParser\Exception\SyntaxException;
-use Tivie\HtaccessParser\Parser;
-use ZipArchive;
-use const Tivie\HtaccessParser\Token\TOKEN_DIRECTIVE;
-class Update extends Setup
-{
-    private string $version;
-    /** @var string[] */
-    private array $queries = [];
-    private bool $dryRun = false;
-    /** @var string[] */
-    private array $dryRunQueries = [];
-    public function __construct(protected System $system, private readonly Configuration $configuration)
-    {
-        parent::__construct($this->system);
-    }
-    public function setVersion(string $version): void
-    {
-        $this->version = $version;
-    }
-    /**
-     * Checks if the "faqconfig" table is available
-     */
-    public function isConfigTableNotAvailable(DatabaseDriver $databaseDriver): bool
-    {
-        $query = sprintf('SELECT * FROM %s%s', Database::getTablePrefix(), 'faqconfig');
-        $result = $databaseDriver->query($query);
-        return $databaseDriver->numRows($result) === 0;
-    }
-    /**
-     * Creates a backup of the current config files
-     * @throws Exception
-     */
-    public function createConfigBackup(string $configDir): string
-    {
-        $outputZipFile = $configDir . DIRECTORY_SEPARATOR . $this->getBackupFilename();
-        $zipArchive = new ZipArchive();
-        if ($zipArchive->open($outputZipFile, ZipArchive::CREATE | ZipArchive::OVERWRITE) !== true) {
-            throw new Exception('Cannot create config backup file.');
-        }
-        $files = new RecursiveIteratorIterator(
-            new RecursiveDirectoryIterator($configDir),
-            RecursiveIteratorIterator::SELF_FIRST
-        );
-        foreach ($files as $file) {
-            $file = realpath($file);
-            if (str_contains($file, $configDir . DIRECTORY_SEPARATOR)) {
-                if (is_dir($file)) {
-                    $zipArchive->addEmptyDir(
-                        str_replace($configDir . DIRECTORY_SEPARATOR, '', $file . DIRECTORY_SEPARATOR)
-                    );
-                } elseif (is_file($file)) {
-                    $zipArchive->addFile($file, str_replace($configDir . DIRECTORY_SEPARATOR, '', $file));
-                }
-            }
-        }
-        $zipArchive->close();
-        if (!file_exists($outputZipFile)) {
-            throw new Exception('Cannot store config backup file.');
-        }
-        return $this->configuration->getDefaultUrl() . 'content/core/config/' . $this->getBackupFilename();
-    }
-    /**
-     * @throws Exception
-     */
-    public function checkInitialRewriteBasePath(Request $request): bool
-    {
-        $basePath = $request->getBasePath();
-        $basePath = rtrim($basePath, 'update');
-        $htaccessPath = PMF_ROOT_DIR . '/.htaccess';
-        $file = new SplFileObject($htaccessPath);
-        $parser = new Parser();
-        try {
-            $htaccess = $parser->parse($file);
-        } catch (SyntaxException $e) {
-            throw new Exception('Syntax error in .htaccess file: ' . $e->getMessage());
-        } catch (\Tivie\HtaccessParser\Exception\Exception $e) {
-            throw new Exception('Error parsing .htaccess file: ' . $e->getMessage());
-        }
-        $rewriteBase = $htaccess->search('RewriteBase', TOKEN_DIRECTIVE);
-        $rewriteBase->removeArgument($rewriteBase->getArguments()[0]);
-        $rewriteBase->setArguments((array)$basePath);
-        $output = (string) $htaccess;
-        return file_put_contents($htaccessPath, $output);
-    }
-    /**
-     * @throws Exception
-     * @throws \Exception
-     */
-    public function applyUpdates(callable $progressCallback): bool
-    {
-        $this->applyUpdates310Alpha();
-        $this->applyUpdates310Alpha3();
-        $this->applyUpdates310Beta();
-        $this->applyUpdates310RC();
-        $this->applyUpdates320Alpha();
-        $this->applyUpdates320Beta();
-        $this->applyUpdates320Beta2();
-        $this->applyUpdates320RC();
-        $this->applyUpdates323();
-        $this->applyUpdates400Alpha();
-        $this->applyUpdates400Alpha2();
-        $this->applyUpdates400Alpha3();
-        $this->applyUpdates400Beta2();
-        $this->optimizeTables();
-        $this->executeQueries($progressCallback);
-        $this->updateVersion();
-        return true;
-    }
-    public function optimizeTables(): void
-    {
-        switch (Database::getType()) {
-            case 'mysqli':
-                $this->configuration->getDb()->getTableNames(Database::getTablePrefix());
-                foreach ($this->configuration->getDb()->tableNames as $tableName) {
-                    $this->queries[] = 'OPTIMIZE TABLE ' . $tableName;
-                }
-                break;
-            case 'pgsql':
-                $this->queries[] = 'VACUUM ANALYZE;';
-                break;
-        }
-    }
-    public function setDryRun(bool $dryRun): void
-    {
-        $this->dryRun = $dryRun;
-    }
-    public function getDryRunQueries(): array
-    {
-        return $this->dryRunQueries;
-    }
-    /**
-     * @throws Exception
-     */
-    private function executeQueries(callable $progressCallback): void
-    {
-        if ($this->dryRun) {
-            foreach ($this->queries as $query) {
-                array_push($this->dryRunQueries, $query);
-            }
-        } else {
-            foreach ($this->queries as $query) {
-                try {
-                    $this->configuration->getDb()->query($query);
-                    $progressCallback($query);
-                } catch (Exception $exception) {
-                    throw new Exception($exception->getMessage());
-                }
-            }
-        }
-    }
-    private function applyUpdates310Alpha(): void
-    {
-        if (version_compare($this->version, '3.1.0-alpha', '<')) {
-            if ('sqlite3' === Database::getType()) {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquserdata ADD COLUMN is_visible INT(1) DEFAULT 0',
-                    Database::getTablePrefix()
-                );
-            } else {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquserdata ADD is_visible INTEGER DEFAULT 0',
-                    Database::getTablePrefix()
-                );
-            }
-            $this->configuration->delete('main.enableRssFeeds');
-            $this->configuration->add('api.enableAccess', true);
-            $this->configuration->add('api.apiClientToken', '');
-            $this->configuration->add('security.domainWhiteListForRegistrations', '');
-        }
-    }
-    private function applyUpdates310Alpha3(): void
-    {
-        if (version_compare($this->version, '3.1.0-alpha.3', '<')) {
-            $this->configuration->add('main.loginWithEmailAddress', false);
-        }
-    }
-    private function applyUpdates310Beta(): void
-    {
-        if (version_compare($this->version, '3.1.0-beta', '<')) {
-            $this->queries[] = match (Database::getType()) {
-                'mysqli' => sprintf(
-                    'CREATE TABLE %sfaqcategory_order 
-                    (category_id int(11) NOT NULL, position int(11) NOT NULL, PRIMARY KEY (category_id))',
-                    Database::getTablePrefix()
-                ),
-                'pgsql', 'sqlite3', 'sqlsrv' => sprintf(
-                    'CREATE TABLE %sfaqcategory_order 
-                    (category_id INTEGER NOT NULL, position INTEGER NOT NULL, PRIMARY KEY (category_id))',
-                    Database::getTablePrefix()
-                ),
-            };
-        }
-    }
-    private function applyUpdates310RC(): void
-    {
-        if (version_compare($this->version, '3.1.0-RC', '<')) {
-            $this->configuration->delete('records.autosaveActive');
-            $this->configuration->delete('records.autosaveSecs');
-        }
-    }
-    private function applyUpdates320Alpha(): void
-    {
-        if (version_compare($this->version, '3.2.0-alpha', '<')) {
-            $this->configuration->add('security.enableSignInWithMicrosoft', false);
-            if ('sqlite3' === Database::getType()) {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquser 
-                        ADD COLUMN refresh_token TEXT NULL DEFAULT NULL,
-                        ADD COLUMN access_token TEXT NULL DEFAULT NULL,
-                        ADD COLUMN code_verifier VARCHAR(255) NULL DEFAULT NULL,
-                        ADD COLUMN jwt TEXT NULL DEFAULT NULL;',
-                    Database::getTablePrefix()
-                );
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquserdata
-                        ADD COLUMN twofactor_enabled INT(1) NULL DEFAULT 0,
-                        ADD COLUMN secret VARCHAR(128) NULL DEFAULT NULL',
-                    Database::getTablePrefix()
-                );
-            } else {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquser 
-                        ADD refresh_token TEXT NULL DEFAULT NULL,
-                        ADD access_token TEXT NULL DEFAULT NULL,
-                        ADD code_verifier VARCHAR(255) NULL DEFAULT NULL,
-                        ADD jwt TEXT NULL DEFAULT NULL;',
-                    Database::getTablePrefix()
-                );
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquserdata
-                        ADD twofactor_enabled INT NULL DEFAULT 0,
-                        ADD secret VARCHAR(128) NULL DEFAULT NULL',
-                    Database::getTablePrefix()
-                );
-            }
-            $this->queries[] = sprintf(
-                'CREATE TABLE %sfaqbackup (
-                    id INT NOT NULL,
-                    filename VARCHAR(255) NOT NULL,
-                    authkey VARCHAR(255) NOT NULL,
-                    authcode VARCHAR(255) NOT NULL,
-                    created timestamp NOT NULL,
-                    PRIMARY KEY (id))',
-                Database::getTablePrefix()
-            );
-            if ('mysqli' === Database::getType()) {
-                $this->queries[] = sprintf('ALTER TABLE %sfaqdata ENGINE=INNODB', Database::getTablePrefix());
-            }
-            $this->configuration->add('main.enableAskQuestions', true);
-            $this->configuration->add('main.enableNotifications', true);
-            $this->configuration->rename('security.loginWithEmailAddress', 'security.loginWithEmailAddress');
-            if ($this->configuration->get('security.permLevel') === 'large') {
-                $this->configuration->set('security.permLevel', 'medium');
-            }
-            $this->configuration->add('security.enableGoogleReCaptchaV2', false);
-            $this->configuration->add('security.googleReCaptchaV2SiteKey', '');
-            $this->configuration->add('security.googleReCaptchaV2SecretKey', '');
-            $this->queries[] = sprintf('DROP TABLE %sfaqsections', Database::getTablePrefix());
-            $this->queries[] = sprintf('DROP TABLE %sfaqsection_category', Database::getTablePrefix());
-            $this->queries[] = sprintf('DROP TABLE %sfaqsection_group', Database::getTablePrefix());
-            $this->queries[] = sprintf('DROP TABLE %sfaqsection_news', Database::getTablePrefix());
-        }
-    }
-    private function applyUpdates320Beta(): void
-    {
-        if (version_compare($this->version, '3.2.0-beta', '<')) {
-            $this->configuration->add('mail.remoteSMTPDisableTLSPeerVerification', false);
-            $this->configuration->delete('main.enableLinkVerification');
-            $this->queries[] = sprintf(
-                'ALTER TABLE %sfaqdata DROP COLUMN links_state, DROP COLUMN links_check_date',
-                Database::getTablePrefix()
-            );
-            $this->queries[] = sprintf(
-                'ALTER TABLE %sfaqdata_revisions DROP COLUMN links_state, DROP COLUMN links_check_date',
-                Database::getTablePrefix()
-            );
-            switch (Database::getType()) {
-                case 'mysqli':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqconfig MODIFY config_value TEXT DEFAULT NULL',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'pgsql':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqconfig ALTER COLUMN config_value TYPE TEXT',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlite3':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqconfig_new (
-                            config_name VARCHAR(255) NOT NULL default \'\', 
-                            config_value TEXT DEFAULT NULL, PRIMARY KEY (config_name)
-                         )',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'INSERT INTO %sfaqconfig_new SELECT config_name, config_value FROM %sfaqconfig',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'DROP TABLE %sfaqconfig',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqconfig_new RENAME TO %sfaqconfig',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlsrv':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqconfig ALTER COLUMN config_value TEXT',
-                        Database::getTablePrefix()
-                    );
-                    break;
-            }
-        }
-    }
-    private function applyUpdates320Beta2(): void
-    {
-        if (version_compare($this->version, '3.2.0-beta.2', '<')) {
-            $this->configuration->add('main.contactInformationHTML', false);
-            $this->configuration->rename('main.contactInformations', 'main.contactInformation');
-        }
-    }
-    private function applyUpdates320RC(): void
-    {
-        if (version_compare($this->version, '3.2.0-RC', '<')) {
-            $this->configuration->add('spam.mailAddressInExport', true);
-        }
-    }
-    private function applyUpdates323(): void
-    {
-        if (version_compare($this->version, '3.2.3', '<')) {
-            switch (Database::getType()) {
-                case 'mysqli':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaquser CHANGE ip ip VARCHAR(64) NULL DEFAULT NULL',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'pgsql':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaquser ALTER COLUMN ip TYPE VARCHAR(64)',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlite3':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaquser_new (
-                        user_id INTEGER NOT NULL,
-                        login VARCHAR(128) NOT NULL,
-                        session_id VARCHAR(150) NULL,
-                        session_timestamp INTEGER NULL,
-                        ip VARCHAR(64) NULL,
-                        account_status VARCHAR(50) NULL,
-                        last_login VARCHAR(14) NULL,
-                        auth_source VARCHAR(100) NULL,
-                        member_since VARCHAR(14) NULL,
-                        remember_me VARCHAR(150) NULL,
-                        success INT(1) NULL DEFAULT 1,
-                        is_superadmin INT(1) NULL DEFAULT 0,
-                        login_attempts INT(1) NULL DEFAULT 0,
-                        refresh_token TEXT NULL DEFAULT NULL,
-                        access_token TEXT NULL DEFAULT NULL,
-                        code_verifier VARCHAR(255) NULL DEFAULT NULL,
-                        jwt TEXT NULL DEFAULT NULL,
-                        PRIMARY KEY (user_id))',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'INSERT INTO %sfaquser_new SELECT * FROM %sfaquser',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix(),
-                    );
-                    $this->queries[] = sprintf(
-                        'DROP TABLE %sfaquser',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaquser_new RENAME TO %sfaquser',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix(),
-                    );
-                    break;
-                case 'sqlsrv':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaquser ALTER COLUMN ip VARCHAR(64)',
-                        Database::getTablePrefix()
-                    );
-                    break;
-            }
-        }
-    }
-    /**
-     * @throws Exception
-     */
-    private function applyUpdates400Alpha(): void
-    {
-        if (version_compare($this->version, '4.0.0-alpha', '<')) {
-            $fileSystem = new Filesystem(PMF_ROOT_DIR);
-            $fileSystem->copy(
-                PMF_LEGACY_CONFIG_DIR . '/database.php',
-                PMF_CONFIG_DIR . '/database.php'
-            );
-            if (file_exists(PMF_LEGACY_CONFIG_DIR . '/azure.php')) {
-                $fileSystem->copy(
-                    PMF_LEGACY_CONFIG_DIR . '/azure.php',
-                    PMF_CONFIG_DIR . '/azure.php'
-                );
-            }
-            if (file_exists(PMF_LEGACY_CONFIG_DIR . '/elasticsearch.php')) {
-                $fileSystem->copy(
-                    PMF_LEGACY_CONFIG_DIR . '/elasticsearch.php',
-                    PMF_CONFIG_DIR . '/elasticsearch.php'
-                );
-            }
-            if (file_exists(PMF_LEGACY_CONFIG_DIR . '/ldap.php')) {
-                $fileSystem->copy(
-                    PMF_LEGACY_CONFIG_DIR . '/ldap.php',
-                    PMF_CONFIG_DIR . '/ldap.php'
-                );
-            }
-            $fileSystem->recursiveCopy(
-                PMF_ROOT_DIR . '/data',
-                PMF_ROOT_DIR . '/content/core'
-            );
-            $fileSystem->recursiveCopy(
-                PMF_ROOT_DIR . '/logs',
-                PMF_ROOT_DIR . '/content/core'
-            );
-            $fileSystem->recursiveCopy(
-                PMF_ROOT_DIR . '/attachments',
-                PMF_ROOT_DIR . '/content/user'
-            );
-            $fileSystem->recursiveCopy(
-                PMF_ROOT_DIR . '/images',
-                PMF_ROOT_DIR . '/content/user'
-            );
-            $this->configuration->add('upgrade.onlineUpdateEnabled', true);
-            $this->configuration->add('upgrade.releaseEnvironment', ReleaseType::DEVELOPMENT->value);
-            $this->configuration->add('upgrade.dateLastChecked', '');
-            $this->configuration->add('upgrade.lastDownloadedPackage', '');
-            $this->configuration->delete('main.enableRewriteRules');
-            $this->configuration->delete('socialnetworks.enableTwitterSupport');
-            $this->configuration->delete('socialnetworks.twitterConsumerKey');
-            $this->configuration->delete('socialnetworks.twitterConsumerSecret');
-            $this->configuration->delete('socialnetworks.twitterAccessTokenKey');
-            $this->configuration->delete('socialnetworks.twitterAccessTokenSecret');
-            $this->configuration->delete('socialnetworks.disableAll');
-            $this->configuration->delete('mail.remoteSMTPEncryption');
-            $this->queries[] = match (Database::getType()) {
-                'mysqli' => sprintf(
-                    'CREATE TABLE %sfaqbookmarks (userid int(11) DEFAULT NULL, faqid int(11) DEFAULT NULL)',
-                    Database::getTablePrefix()
-                ),
-                'pgsql', 'sqlite3', 'sqlsrv' => sprintf(
-                    'CREATE TABLE %sfaqbookmarks (userid INTEGER DEFAULT NULL, faqid INTEGER DEFAULT NULL)',
-                    Database::getTablePrefix()
-                ),
-            };
-            $this->queries[] = match (Database::getType()) {
-                'mysqli' => sprintf(
-                    'ALTER TABLE %sfaqdata ADD COLUMN sticky_order int(10) DEFAULT NULL',
-                    Database::getTablePrefix()
-                ),
-                'pgsql', 'sqlite3', 'sqlsrv' => sprintf(
-                    'ALTER TABLE %sfaqdata ADD COLUMN sticky_order integer DEFAULT NULL',
-                    Database::getTablePrefix()
-                ),
-            };
-            $this->queries[] = match (Database::getType()) {
-                'mysqli' => sprintf(
-                    'ALTER TABLE %sfaqdata_revisions ADD COLUMN sticky_order int(10) DEFAULT NULL',
-                    Database::getTablePrefix()
-                ),
-                'pgsql', 'sqlite3', 'sqlsrv' => sprintf(
-                    'ALTER TABLE %sfaqdata_revisions ADD COLUMN sticky_order integer DEFAULT NULL',
-                    Database::getTablePrefix()
-                ),
-            };
-            $this->configuration->add('records.orderStickyFaqsCustom', 'false');
-            $this->queries[] = sprintf('DROP TABLE %sfaqmeta', Database::getTablePrefix());
-            $this->configuration->add('main.botIgnoreList', 'nustcrape,webpost,GoogleBot,msnbot,crawler,scooter,
-            bravobrian,archiver,w3c,controler,wget,bot,spider,Yahoo! Slurp,htdig,gsa-crawler,AirControler,Uptime-Kuma');
-            $this->configuration->add('main.enableCookieConsent', true);
-            switch (Database::getType()) {
-                case 'mysqli':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqcategory_order ADD COLUMN parent_id int(11) DEFAULT NULL AFTER category_id',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlsrv':
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqcategory_order ADD COLUMN parent_id INTEGER DEFAULT NULL AFTER category_id',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlite3':
-                case 'pgsql':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqcategory_order_new (
-                            category_id INTEGER NOT NULL,
-                            parent_id INTEGER DEFAULT NULL,
-                            position INTEGER NOT NULL,
-                            PRIMARY KEY (category_id))',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'INSERT INTO %sfaqcategory_order_new SELECT * FROM %sfaqcategory_order',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'DROP TABLE %sfaqcategory_order',
-                        Database::getTablePrefix()
-                    );
-                    $this->queries[] = sprintf(
-                        'ALTER TABLE %sfaqcategory_order_new RENAME TO %sfaqcategory_order',
-                        Database::getTablePrefix(),
-                        Database::getTablePrefix()
-                    );
-                    break;
-            }
-        }
-    }
-    /**
-     * @throws Exception
-     * @throws \Exception
-     */
-    private function applyUpdates400Alpha2(): void
-    {
-        if (version_compare($this->version, '4.0.0-alpha.2', '<')) {
-            $this->configuration->delete('main.optionalMailAddress');
-            $user = new User($this->configuration);
-            $rightData = [
-                'name' => 'forms_edit',
-                'description' => 'Right to edit forms'
-            ];
-            $user->perm->grantUserRight(1, $user->perm->addRight($rightData));
-            switch (Database::getType()) {
-                case 'mysqli':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqforms (
-                        form_id INT(1) NOT NULL,
-                        input_id INT(11) NOT NULL,
-                        input_type VARCHAR(1000) NOT NULL,
-                        input_label VARCHAR(100) NOT NULL,
-                        input_active INT(1) NOT NULL,
-                        input_required INT(1) NOT NULL,
-                        input_lang VARCHAR(11) NOT NULL)',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlsrv':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqforms (
-                        form_id INTEGER NOT NULL,
-                        input_id INTEGER NOT NULL,
-                        input_type NVARCHAR(1000) NOT NULL,
-                        input_label NVARCHAR(100) NOT NULL,
-                        input_active INTEGER NOT NULL,
-                        input_required INTEGER NOT NULL,
-                        input_lang NVARCHAR(11) NOT NULL)',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlite3':
-                case 'pgsql':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqforms (
-                        form_id INTEGER NOT NULL,
-                        input_id INTEGER NOT NULL,
-                        input_type VARCHAR(1000) NOT NULL,
-                        input_label VARCHAR(100) NOT NULL,
-                        input_active INTEGER NOT NULL,
-                        input_required INTEGER NOT NULL,
-                        input_lang VARCHAR(11) NOT NULL)',
-                        Database::getTablePrefix()
-                    );
-                    break;
-            }
-            $forms = new Forms($this->configuration);
-            $installer = new Installer(new System());
-            foreach ($installer->formInputs as $input) {
-                $this->queries[] = $forms->getInsertQueries($input);
-            }
-        }
-    }
-    /**
-     * @throws \Exception
-     */
-    private function applyUpdates400Alpha3(): void
-    {
-        if (version_compare($this->version, '4.0.0-alpha.3', '<')) {
-            switch (Database::getType()) {
-                case 'mysqli':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqseo (
-                            id INT(11) NOT NULL,
-                            type VARCHAR(32) NOT NULL,
-                            reference_id INT(11) NOT NULL,
-                            reference_language VARCHAR(5) NOT NULL,
-                            title TEXT DEFAULT NULL,
-                            description TEXT DEFAULT NULL,
-                            slug TEXT DEFAULT NULL,
-                            created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
-                            PRIMARY KEY (id)) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci ENGINE = InnoDB',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlsrv':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqseo (
-                            id INT NOT NULL,
-                            type VARCHAR(32) NOT NULL,
-                            reference_id INT NOT NULL,
-                            reference_language VARCHAR(5) NOT NULL,
-                            title TEXT NULL,
-                            description TEXT NULL,
-                            slug TEXT NULL,
-                            created DATE NOT NULL DEFAULT GETDATE(),
-                            PRIMARY KEY (id))',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'sqlite3':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqseo (
-                            id INT NOT NULL,
-                            type VARCHAR(32) NOT NULL,
-                            reference_id INT NOT NULL,
-                            reference_language VARCHAR(5) NOT NULL,
-                            title TEXT NULL,
-                            description TEXT NULL,
-                            slug TEXT NULL,
-                            created DATE NOT NULL DEFAULT (date(\'now\')),
-                            PRIMARY KEY (id))',
-                        Database::getTablePrefix()
-                    );
-                    break;
-                case 'pgsql':
-                    $this->queries[] = sprintf(
-                        'CREATE TABLE %sfaqseo (
-                            id INTEGER NOT NULL,
-                            type VARCHAR(32) NOT NULL,
-                            reference_id INTEGER NOT NULL,
-                            reference_language VARCHAR(5) NOT NULL,
-                            title TEXT,
-                            description TEXT,
-                            slug TEXT NULL,
-                            created DATE NOT NULL DEFAULT CURRENT_DATE,
-                            PRIMARY KEY (id))',
-                        Database::getTablePrefix()
-                    );
-                    break;
-            }
-            $this->configuration->update(['main.botIgnoreList' => 'nustcrape,webpost,GoogleBot,msnbot,crawler,scooter,
-            bravobrian,archiver,w3c,controler,wget,bot,spider,Yahoo! Slurp,htdig,gsa-crawler,AirControler,Uptime-Kuma,
-            facebookcatalog/1.0,facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php),
-            facebookexternalhit/1.1']);
-            $this->configuration->add('mail.noReplySenderAddress', '');
-            $this->configuration->add('records.allowedMediaHosts', 'www.youtube.com');
-            $this->configuration->add('seo.title', $this->configuration->get('main.titleFAQ'));
-            $this->configuration->add('seo.description', $this->configuration->get('main.metaDescription'));
-            $this->configuration->add('layout.enablePrivacyLink', 'true');
-            $this->configuration->add('layout.customCss', '');
-            $this->configuration->add('seo.enableRichSnippets', 'false');
-            $this->configuration->delete('main.urlValidateInterval');
-            $this->configuration->delete('main.enableGzipCompression');
-            $this->configuration->delete('main.metaKeywords');
-            $this->configuration->delete('main.send2friendText');
-            $this->configuration->rename('main.templateSet', 'layout.templateSet');
-            $this->configuration->rename('main.enableCookieConsent', 'layout.enableCookieConsent');
-            $this->configuration->rename('main.contactInformationHTML', 'layout.contactInformationHTML');
-        }
-    }
-    private function applyUpdates400Beta2(): void
-    {
-        if (version_compare($this->version, '4.0.0-beta.2', '<')) {
-            $this->configuration->add('security.enableWebAuthnSupport', false);
-            if ('sqlite3' === Database::getType()) {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquser ADD COLUMN webauthnkeys TEXT NULL DEFAULT NULL;',
-                    Database::getTablePrefix()
-                );
-            } else {
-                $this->queries[] = sprintf(
-                    'ALTER TABLE %sfaquser ADD webauthnkeys TEXT NULL DEFAULT NULL;',
-                    Database::getTablePrefix()
-                );
-            }
-        }
-    }
-    private function updateVersion(): void
-    {
-        $this->configuration->update(['main.currentApiVersion' => System::getApiVersion()]);
-        $this->configuration->update(['main.currentVersion' => System::getVersion()]);
-    }
-    private function getBackupFilename(): string
-    {
-        return sprintf('phpmyfaq-config-backup.%s.zip', date('Y-m-d'));
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/System.php
+++ b/phpmyfaq/src/phpMyFAQ/System.php
@@ -1,78 +1,69 @@
 <?php
 /**
  * Class for checking system requirements.
  *
  * This Source Code Form is subject to the terms of the Mozilla Public License,
  * v. 2.0. If a copy of the MPL was not distributed with this file, You can
  * obtain one at https://mozilla.org/MPL/2.0/.
  *
  * @package   phpMyFAQ
  * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2010-2024 phpMyFAQ Team
+ * @copyright 2010-2023 phpMyFAQ Team
  * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
  * @link      https://www.phpmyfaq.de
  * @since     2010-01-13
  */
 namespace phpMyFAQ;
 use DateTime;
 use DirectoryIterator;
 use Exception;
 use phpMyFAQ\Database\DatabaseDriver;
-use phpMyFAQ\Template\TwigWrapper;
 use RecursiveDirectoryIterator;
 use RecursiveIteratorIterator;
 use Symfony\Component\HttpFoundation\Request;
 use UnexpectedValueException;
 /**
  * Class System
  *
  * @package phpMyFAQ
  */
 class System
 {
     /**
      * Major version.
      */
-    private const VERSION_MAJOR = 4;
+    private const VERSION_MAJOR = 3;
     /**
      * Minor version.
      */
-    private const VERSION_MINOR = 0;
+    private const VERSION_MINOR = 2;
     /**
      * Patch level.
      */
-    private const VERSION_PATCH_LEVEL = 2;
+    private const VERSION_PATCH_LEVEL = 10;
     /**
      * Pre-release version.
      */
     private const VERSION_PRE_RELEASE = '';
     /**
      * API version.
      */
-    private const VERSION_API = '3.0';
-    /**
-     * Plugin version.
-     */
-    private const PLUGIN_VERSION = '0.1.0';
+    private const VERSION_API = '2.2';
     /**
      * Minimum required PHP version.
      */
-    final public const VERSION_MINIMUM_PHP = '8.2.0';
+    final public const VERSION_MINIMUM_PHP = '8.1.0';
     /**
      * phpMyFAQ homepage URL
      */
     final public const PHPMYFAQ_URL = 'https://www.phpmyfaq.de/';
-    /**
-     * GitHub Issues URL
-     */
-    final public const GITHUB_ISSUES_URL = 'https://github.com/thorsten/phpMyFAQ/issues';
     /**
      * Array of required PHP extensions.
      *
      * @var array<string>
      */
     private array $requiredExtensions = [
         'curl',
         'fileinfo',
         'filter',
         'gd',
@@ -88,279 +79,291 @@
      */
     private array $missingExtensions = [];
     /**
      * Supported databases for phpMyFAQ.
      *
      * @var array<string, array<int, string>>
      */
     private array $supportedDatabases = [
         'mysqli' => [
             self::VERSION_MINIMUM_PHP,
-            'MySQL v8 / MariaDB v10 / Percona Server v8 / Galera Cluster v4 for MySQL',
+            'MySQL v8 / MariaDB v10 / Percona Server v8 / Galera Cluster v4 for MySQL'
         ],
         'pgsql' => [
             self::VERSION_MINIMUM_PHP,
-            'PostgreSQL v10 or later',
+            'PostgreSQL v10 or later'
         ],
         'sqlite3' => [
             self::VERSION_MINIMUM_PHP,
-            'SQLite 3',
+            'SQLite 3'
         ],
         'sqlsrv' => [
             self::VERSION_MINIMUM_PHP,
-            'MS SQL Server 2016 or later',
-        ],
+            'MS SQL Server 2016 or later'
+        ]
     ];
     /**
      * Database handle.
      */
     private ?DatabaseDriver $database = null;
     /**
      * Returns the current version of phpMyFAQ for installation and
      * version in the database.
      * Releases will be numbered with the follow format:
      * <major>.<minor>.<patch>[-<prerelease>]
      */
     public static function getVersion(): string
     {
         $version = sprintf('%d.%d.%d', self::VERSION_MAJOR, self::VERSION_MINOR, self::VERSION_PATCH_LEVEL);
         return $version . (self::isDevelopmentVersion() ? '-' . self::VERSION_PRE_RELEASE : '');
     }
     /**
-     * Returns the current major version of phpMyFAQ
-     */
-    public static function getMajorVersion(): string
-    {
-        return sprintf('%d.%d', self::VERSION_MAJOR, self::VERSION_MINOR);
-    }
-    /**
      * Returns the current API version of phpMyFAQ for installation and
      * version in the database.
      */
     public static function getApiVersion(): string
     {
         return self::VERSION_API;
-    }
-    /**
-     * Returns the current plugin version of phpMyFAQ
-     */
-    public static function getPluginVersion(): string
-    {
-        return self::PLUGIN_VERSION;
     }
     public static function getPoweredByString(bool $withLink = false): string
     {
         if ($withLink) {
             return sprintf(
                 'powered with  and  by <a class="%s" target="_blank" href="%s">phpMyFAQ</a> %s',
                 'link-light text-decoration-none',
                 self::PHPMYFAQ_URL,
                 self::getVersion()
             );
-        }
-        return sprintf('powered with  and  by phpMyFAQ %s', self::getVersion());
+        } else {
+            return sprintf('powered with  and  by phpMyFAQ %s', self::getVersion());
+        }
     }
     /**
      * Returns the URL of the documentation
+     * @return string
      */
     public static function getDocumentationUrl(): string
     {
-        return sprintf('%sdocs/%s', self::PHPMYFAQ_URL, self::getMajorVersion());
-    }
-    public static function getGitHubIssuesUrl(): string
-    {
-        return self::GITHUB_ISSUES_URL;
+        return sprintf('%sdocs/%s', self::PHPMYFAQ_URL, substr(self::getVersion(), 0, 3));
     }
     /**
      * Returns true or false on SQLite3.
      *
      * @static
      */
     public static function isSqlite(string $dbType): bool
     {
         return 'sqlite3' === $dbType;
     }
     public static function isDevelopmentVersion(): bool
     {
         return strlen(self::VERSION_PRE_RELEASE) > 0;
     }
+    /**
+     * Print out the HTML5 Footer.
+     */
+    public static function renderFooter(bool $onePageBack = false): never
+    {
+        if (true === $onePageBack) {
+            printf(
+                '<p><a href="./index.php">%s</a></p>',
+                'Back to the Setup page'
+            );
+        }
+        printf(
+            '</div></section></main><footer class="setup-footer container"><p class="text-end">%s</p></footer>' .
+            '</body></html>',
+            '&copy; 2001-2023 <a target="_blank" href="https://www.phpmyfaq.de/">phpMyFAQ Team</a>'
+        );
+        exit();
+    }
     public function getDatabase(): ?DatabaseDriver
     {
         return $this->database;
     }
-    public function setDatabase(DatabaseDriver $databaseDriver): System
-    {
-        $this->database = $databaseDriver;
+    public function setDatabase(DatabaseDriver $database): System
+    {
+        $this->database = $database;
         return $this;
     }
     /**
      * Returns all available templates as array.
      *
      * @return array<string, bool>
      */
     public function getAvailableTemplates(): array
     {
         $templates = [];
-        $systemFolder = ['admin', 'setup'];
-        foreach (new DirectoryIterator(PMF_ROOT_DIR . '/assets/templates/') as $item) {
+        foreach (new DirectoryIterator(PMF_ROOT_DIR . '/assets/themes/') as $item) {
             $basename = $item->getBasename();
-            if ($item->isDot()) {
-                continue;
-            }
-            if (!$item->isDir()) {
-                continue;
-            }
-            if (in_array($basename, $systemFolder)) {
-                continue;
-            }
-            $templates[$basename] = TwigWrapper::getTemplateSetName() === $basename;
+            if (!$item->isDot() && $item->isDir()) {
+                $templates[$basename] = Template::getTplSetName() === $basename;
+            }
         }
         return $templates;
     }
     /**
      * Returns the locally supported databases.
      *
      * @return array<string, string>
      */
-    public function getSupportedSafeDatabases(): array
-    {
-        $databases = [];
+    public function getSupportedSafeDatabases(bool $returnAsHtml = false): array
+    {
+        $retVal = [];
         foreach ($this->getSupportedDatabases() as $extension => $database) {
-            if (!extension_loaded($extension)) {
-                continue;
-            }
-            if (version_compare(PHP_VERSION, $database[0]) < 0) {
-                continue;
-            }
-            $databases[$extension] = $database[1];
-        }
-        return $databases;
+            if (extension_loaded($extension) && version_compare(PHP_VERSION, $database[0]) >= 0) {
+                if ($returnAsHtml) {
+                    $retVal[] = sprintf('<option value="%s">%s</option>', $extension, $database[1]);
+                } else {
+                    $retVal[$extension] = $database;
+                }
+            }
+        }
+        return $retVal;
     }
     /**
      * Returns the supported databases.
      *
      * @return array<string, array<int, string>>
      */
     public function getSupportedDatabases(): array
     {
         return $this->supportedDatabases;
     }
     /**
      * Checks if the system URI is running with http or https.
      */
-    public function getSystemUri(Configuration $configuration): string
-    {
-        $mainUrl = $configuration->getDefaultUrl();
-        if (isset($_ENV['REQUEST_SCHEME']) && 'https' === $_ENV['REQUEST_SCHEME'] && !str_contains($mainUrl, 'https')) {
-            $mainUrl = str_replace('http://', 'https://', $mainUrl);
+    public function getSystemUri(Configuration $faqConfig): string
+    {
+        $mainUrl = $faqConfig->getDefaultUrl();
+        if (isset($_ENV['REQUEST_SCHEME']) && 'https' === $_ENV['REQUEST_SCHEME']) {
+            if (!str_contains($mainUrl, 'https')) {
+                $mainUrl = str_replace('http://', 'https://', $mainUrl);
+            }
         }
         if (!str_ends_with($mainUrl, '/')) {
             $mainUrl .= '/';
         }
         return $mainUrl;
     }
     /**
      * Returns true, if phpMyFAQ is running on HTTPS
      */
     public function getHttpsStatus(): bool
     {
         return Request::createFromGlobals()->isSecure();
     }
     /**
      * Checks for installed database extensions, if the first supported
      * extension is enabled, return true.
      */
     public function checkDatabase(): bool
     {
-        foreach (array_keys($this->supportedDatabases) as $extension) {
+        foreach ($this->supportedDatabases as $extension => $database) {
             if (extension_loaded($extension)) {
                 return true;
             }
         }
         return false;
     }
     /**
      * Checks for required PHP extensions.
      */
     public function checkRequiredExtensions(): bool
     {
-        foreach ($this->requiredExtensions as $requiredExtension) {
-            if (!extension_loaded($requiredExtension)) {
-                $this->missingExtensions[] = $requiredExtension;
-            }
-        }
-        return count($this->missingExtensions) <= 0;
+        foreach ($this->requiredExtensions as $extension) {
+            if (!extension_loaded($extension)) {
+                $this->missingExtensions[] = $extension;
+            }
+        }
+        if (count($this->missingExtensions) > 0) {
+            return false;
+        }
+        return true;
     }
     /**
      * Checks for an installed phpMyFAQ version
      */
     public function checkInstallation(): bool
     {
-        return !is_file(PMF_ROOT_DIR . '/content/core/config/database.php');
+        return !is_file(PMF_ROOT_DIR . '/config/database.php');
     }
     /**
      * Returns all missing extensions.
      *
      * @return array<string>
      */
     public function getMissingExtensions(): array
     {
         return $this->missingExtensions;
     }
     /**
      * Creates a JSON object with all .php files of phpMyFAQ with their sha1 hashes.
      *
      * @throws Exception
      */
     public function createHashes(): string
     {
-        $dateTime = new DateTime();
+        $created = new DateTime();
         $files = new RecursiveIteratorIterator(
             new RecursiveDirectoryIterator(PMF_ROOT_DIR),
             RecursiveIteratorIterator::SELF_FIRST
         );
         $hashes = [
-            'created' => $dateTime->format('Y-m-d H:i:sP'),
+            'created' => $created->format('Y-m-d H:i:sP'),
         ];
         $ignoredFiles = [
-            '/content/core/config/azure.php' => false,
-            '/content/core/config/constants.php' => false,
-            '/content/core/config/constants_elasticsearch.php' => false,
-            '/content/core/config/database.php' => false,
-            '/content/core/config/elasticsearch.php' => false,
-            '/content/core/config/ldap.php' => false,
+            '/config/constants.php' => false,
+            '/config/constants_elasticsearch.php' => false,
+            '/config/database.php' => false,
+            '/config/elasticsearch.php' => false,
+            '/config/ldap.php' => false,
         ];
         $current = '';
         try {
             foreach ($files as $file) {
                 if (
-                    'php' === pathinfo((string) $file->getFilename(), PATHINFO_EXTENSION) &&
-                    !str_contains((string)$file->getPath(), '/tests/') &&
-                    !str_contains((string)$file->getPath(), '/multisites/') &&
-                    !str_contains((string)$file->getPath(), '/upgrades/')
+                    'php' === pathinfo((string) $file->getFilename(), PATHINFO_EXTENSION) && !preg_match(
+                        '#/tests/#',
+                        (string) $file->getPath()
+                    )
                 ) {
                     $current = str_replace(PMF_ROOT_DIR, '', (string) $file->getPathname());
                     if (isset($ignoredFiles[$current])) {
                         continue;
                     }
                     $hashes[$current] = sha1(file_get_contents($file->getPathname()));
                 }
             }
-        } catch (UnexpectedValueException $exception) {
-            $hashes[$current . ' failed'] = $exception->getMessage();
+        } catch (UnexpectedValueException $e) {
+            $hashes[$current . ' failed'] = $e->getMessage();
         }
         return json_encode($hashes, JSON_THROW_ON_ERROR);
     }
     /**
      * Drops all given tables
      *
      * @param array<string> $queries
      */
     public function dropTables(array $queries): void
     {
         if ($this->database instanceof DatabaseDriver) {
             foreach ($queries as $query) {
                 $this->database->query($query);
             }
         }
     }
+    /**
+     * Removes the database.php and the ldap.php if an installation failed.
+     *
+     * @todo have to be moved to the Installer class
+     */
+    public function cleanFailedInstallationFiles(): void
+    {
+        if (file_exists(PMF_ROOT_DIR . '/config/database.php')) {
+            unlink(PMF_ROOT_DIR . '/config/database.php');
+        }
+        if (file_exists(PMF_ROOT_DIR . '/config/ldap.php')) {
+            unlink(PMF_ROOT_DIR . '/config/ldap.php');
+        }
+    }
 }

--- a/phpmyfaq/src/phpMyFAQ/Template/TwigWrapper.php
+++ b//dev/null
@@ -1,106 +0,0 @@
-<?php
-/**
- * This class is just a wrapper for Twig v3
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ\Template
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2023-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2023-05-27
- */
-namespace phpMyFAQ\Template;
-use phpMyFAQ\Core\Exception;
-use phpMyFAQ\System;
-use phpMyFAQ\Template\Extensions\PluginTwigExtension;
-use phpMyFAQ\Template\Extensions\TranslateTwigExtension;
-use Twig\Environment;
-use Twig\Error\LoaderError;
-use Twig\Error\RuntimeError;
-use Twig\Error\SyntaxError;
-use Twig\Extension\DebugExtension;
-use Twig\Extension\ExtensionInterface;
-use Twig\Loader\FilesystemLoader;
-use Twig\TemplateWrapper;
-use Twig\TwigFilter;
-use Twig\TwigFunction;
-class TwigWrapper
-{
-    private Environment $twigEnvironment;
-    private bool $isSetup;
-    /** @var string Name of an active template set. */
-    private static string $templateSetName = 'default';
-    /**
-     * @throws LoaderError
-     */
-    public function __construct(string $templatePath, bool $isSetup = false)
-    {
-        $this->isSetup = $isSetup;
-        $filesystemLoader = new FilesystemLoader();
-        $filesystemLoader->addPath($templatePath . '/' . self::$templateSetName);
-        $filesystemLoader->addPath($templatePath . '/admin', 'admin');
-        $filesystemLoader->addPath($templatePath . '/setup', 'setup');
-        $this->twigEnvironment = new Environment(
-            $filesystemLoader,
-            [
-                'debug' => System::isDevelopmentVersion()
-            ]
-        );
-        $this->twigEnvironment->addExtension(new TranslateTwigExtension());
-        if (!$this->isSetup) {
-            $this->twigEnvironment->addExtension(new PluginTwigExtension());
-        }
-        if (System::isDevelopmentVersion() || DEBUG) {
-            $this->twigEnvironment->addExtension(new DebugExtension());
-        }
-    }
-    public function setSetup(bool $isSetup): void
-    {
-        $this->isSetup = $isSetup;
-    }
-    /**
-     * @throws Exception
-     */
-    public function loadTemplate(string $templateFile): TemplateWrapper
-    {
-        try {
-            return $this->twigEnvironment->load($templateFile);
-        } catch (LoaderError | RuntimeError | SyntaxError $exception) {
-            throw new Exception($exception->getMessage());
-        }
-    }
-    public function addExtension(ExtensionInterface $extension): void
-    {
-        $this->twigEnvironment->addExtension($extension);
-    }
-    public function addFunction(TwigFunction $twigFunction): void
-    {
-        $this->twigEnvironment->addFunction($twigFunction);
-    }
-    public function getExtension(string $class): ExtensionInterface
-    {
-        return $this->twigEnvironment->getExtension($class); /** @phpstan-ignore-line */
-    }
-    public function addFilter(TwigFilter $filter): void
-    {
-        $this->twigEnvironment->addFilter($filter);
-    }
-    /**
-     * Returns the name of the actual template set.
-     */
-    public static function getTemplateSetName(): string
-    {
-        return self::$templateSetName;
-    }
-    /**
-     * Set the template set name to use.
-     */
-    public static function setTemplateSetName(string $tplSetName): void
-    {
-        self::$templateSetName = $tplSetName;
-    }
-}

--- a/phpmyfaq/src/phpMyFAQ/User.php
+++ b//dev/null
@@ -1,836 +0,0 @@
-<?php
-/**
- * Creates a new user object.
- *
- * A user are recognized by the session-id using getUserBySessionId(), by his
- * using getUserById() or by his nickname (login) using getUserByLogin(). New
- * are created using createNewUser().
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Lars Tiedemann <php@larstiedemann.de>
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @author    Sarah Hermann <sayh@gmx.de>
- * @copyright 2005-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2005-09-17
- */
-namespace phpMyFAQ;
-use Exception;
-use phpMyFAQ\Auth\AuthDriverInterface;
-use phpMyFAQ\Permission\BasicPermission;
-use phpMyFAQ\Permission\MediumPermission;
-use phpMyFAQ\Permission\PermissionInterface;
-use phpMyFAQ\User\UserData;
-use Symfony\Component\HttpFoundation\Request;
-use Symfony\Component\Mailer\Exception\TransportExceptionInterface;
-if (!defined('PMF_ENCRYPTION_TYPE')) {
-    define('PMF_ENCRYPTION_TYPE', 'hash');
-}
-/**
- * Class User
- *
- * @package phpMyFAQ
- */
-class User
-{
-    final public const ERROR_USER_ADD = 'Account could not be created. ';
-    final public const ERROR_USER_CANNOT_CREATE_USER = 'User account could not be created. ';
-    final public const ERROR_USER_CANNOT_CREATE_USERDATA = 'Entry for user data could not be created. ';
-    final public const ERROR_USER_CANNOT_DELETE_USER = 'User account could not be deleted. ';
-    final public const ERROR_USER_CANNOT_DELETE_USERDATA = 'Entry for user data could not be deleted. ';
-    final public const ERROR_USER_CHANGE = 'Account could not be updated. ';
-    final public const ERROR_USER_DELETE = 'Account could not be deleted. ';
-    final public const ERROR_USER_INCORRECT_LOGIN = 'The login name could not be found. ';
-    final public const ERROR_USER_INCORRECT_PASSWORD = 'The password is not correct.';
-    final public const ERROR_USER_INVALID_STATUS = 'Undefined user status.';
-    final public const ERROR_USER_LOGINNAME_TOO_SHORT = 'The chosen login name is too short.';
-    final public const ERROR_USER_LOGIN_NOT_UNIQUE = 'The Login name already exists.';
-    final public const ERROR_USER_LOGIN_INVALID = 'The chosen login is invalid. A valid login has at least four ' .
-        'characters. Only letters, numbers and underscore _ are allowed. The first letter must be a letter. ';
-    final public const ERROR_USER_NO_USERID = 'No user-ID found. ';
-    final public const ERROR_USER_NO_USERLOGINDATA = 'No user login data found. ';
-    final public const ERROR_USER_NOT_FOUND = 'User account could not be found. ';
-    final public const ERROR_USER_NO_AUTH_WRITABLE = 'No authentication object is writable.';
-    final public const ERROR_USER_TOO_MANY_FAILED_LOGINS = 'You exceeded the maximum amounts of login attempts and ' .
-        'are temporarily blocked. Please try again later.';
-    final public const STATUS_USER_PROTECTED = 'User account is protected. ';
-    final public const STATUS_USER_BLOCKED = 'User account is blocked. ';
-    final public const STATUS_USER_ACTIVE = 'User account is active. ';
-    public PermissionInterface $perm;
-    public ?UserData $userdata = null;
-    /**
-     * Public array that contains error messages.
-     * @var array<string>
-     */
-    public array $errors = [];
-    /**
-     * authentication container.
-     * @var array<string, Auth|AuthDriverInterface>
-     */
-    protected array $authContainer = [];
-    /**
-     * Default Authentication properties.
-     *
-     * @var array<string, array<string, string>|string|false>
-     */
-    private array $authData = [
-        'authSource' => [
-            'name' => 'database',
-            'type' => 'local',
-        ],
-        'encType' => PMF_ENCRYPTION_TYPE,
-        'readOnly' => false,
-    ];
-    private string $login = '';
-    private int $loginMinLength = 2;
-    /**
-     * regular expression to find invalid login strings
-     * (default: /^[a-z0-9][\w\.\-@]+/is ).
-     */
-    private string $validUsername = '/^[a-z0-9][\w.\-@]+/i';
-    private int $userId = -1;
-    private string $status = '';
-    /** Is the user a super admin? */
-    private bool $isSuperAdmin = false;
-    /** @var string $authSource Authentication, e.g. local, ldap, azure, sso, ... */
-    private string $authSource = 'local';
-    /**
-     * array of allowed values for status.
-     *
-     * @var array<string>
-     */
-    private array $allowedStatus = [
-        'active' => self::STATUS_USER_ACTIVE,
-        'blocked' => self::STATUS_USER_BLOCKED,
-        'protected' => self::STATUS_USER_PROTECTED,
-    ];
-    /**
-     * Constructor.
-     *
-     * @throws Core\Exception
-*/
-    public function __construct(protected ?Configuration $configuration)
-    {
-        $permission = Permission::createPermission(
-            $this->configuration->get('security.permLevel'),
-            $this->configuration
-        );
-        if (!$this->addPerm($permission)) {
-            return;
-        }
-        $this->authContainer = [];
-        $auth = new Auth($this->configuration);
-        $selectedAuth = $auth->selectAuth($this->getAuthSource('name'));
-        $selectedAuth->getEncryptionContainer($this->getAuthData('encType'));
-        $selectedAuth->setReadOnly($this->getAuthData('readOnly'));
-        if (!$this->addAuth($selectedAuth, $this->getAuthSource('type'))) {
-            return;
-        }
-        /** @phpstan-ignore-next-line */
-        foreach ($this->authContainer as $name => $authObject) {
-            if (!$this->addAuth($authObject, $name)) {
-                break;
-            }
-        }
-        $this->userdata = new UserData($this->configuration);
-    }
-    /**
-     * Adds a permission object to the user.
-     *
-     * @param PermissionInterface $permission Permission object
-     */
-    public function addPerm(PermissionInterface $permission): bool
-    {
-        $this->perm = $permission;
-        return true;
-    }
-    /**
-     * Returns a specific entry from the auth data source array.
-     */
-    public function getAuthSource(string $key): ?string
-    {
-        return $this->authData['authSource'][$key] ?? null;
-    }
-    public function getUserAuthSource(): string
-    {
-        return $this->authSource;
-    }
-    /**
-     * Returns a specific entry from the auth data array.
-     */
-    public function getAuthData(string $key): mixed
-    {
-        return $this->authData[$key] ?? null;
-    }
-    /**
-     * adds a new authentication object to the user object.
-     *
-     * @param Auth   $authDriver Driver object
-     * @param string $name       Auth name
-     */
-    public function addAuth(Auth $authDriver, string $name): bool
-    {
-        if ($this->checkAuth($authDriver)) {
-            $this->authContainer[$name] = $authDriver;
-            return true;
-        }
-        return false;
-    }
-    /**
-     * Returns true if auth is a valid authentication object.
-     *
-     * @param Auth $auth Auth object
-     */
-    protected function checkAuth(Auth $auth): bool
-    {
-        return method_exists($auth, 'checkCredentials');
-    }
-    /**
-     * Loads basic user information from the database selecting the user with
-     * specified cookie information.
-     */
-    public function getUserByCookie(string $cookie): bool
-    {
-        $select = sprintf(
-            "
-            SELECT
-                user_id,
-                login,
-                account_status
-            FROM
-                %sfaquser
-            WHERE
-                remember_me = '%s' AND account_status != 'blocked'",
-            Database::getTablePrefix(),
-            $this->configuration->getDb()->escape($cookie),
-        );
-        $res = $this->configuration->getDb()->query($select);
-        if ($this->configuration->getDb()->numRows($res) !== 1) {
-            $this->errors[] = self::ERROR_USER_INCORRECT_LOGIN;
-            return false;
-        }
-        $user = $this->configuration->getDb()->fetchArray($res);
-        if (-1 === $user['user_id']) {
-            return false;
-        }
-        $this->userId = (int)$user['user_id'];
-        $this->login = (string)$user['login'];
-        $this->status = (string)$user['account_status'];
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $this->userdata->load($this->getUserId());
-        return true;
-    }
-    /**
-     * Returns the User ID of the user.
-     */
-    public function getUserId(): int
-    {
-        if (isset($this->userId)) {
-            return $this->userId;
-        }
-        $this->userId = -1;
-        $this->errors[] = self::ERROR_USER_NO_USERID;
-        return -1;
-    }
-    /**
-     * Checks if display name is already used. Returns true, if already in use.
-     */
-    public function checkDisplayName(string $name): bool
-    {
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        return $name === $this->userdata->fetch('display_name', $name);
-    }
-    /**
-     * Checks if email address is already used. Returns true, if already in use.
-     */
-    public function checkMailAddress(string $name): bool
-    {
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        return $name === $this->userdata->fetch('email', $name);
-    }
-    /**
-     * Search users by login.
-     *
-     * @param string $search Login name
-     * @return array<string[]>
-     */
-    public function searchUsers(string $search): array
-    {
-        $select = sprintf(
-            "SELECT login, user_id, account_status FROM %sfaquser WHERE login LIKE '%s'",
-            Database::getTablePrefix(),
-            $this->configuration->getDb()->escape($search . '%'),
-        );
-        $res = $this->configuration->getDb()->query($select);
-        if (!$res) {
-            return [];
-        }
-        $result = [];
-        while ($row = $this->configuration->getDb()->fetchArray($res)) {
-            $result[] = $row;
-        }
-        return $result;
-    }
-    /**
-     * Creates a new user and stores basic data in the database.
-     *
-     * @throws Core\Exception
-     * @throws Exception
-     */
-    public function createUser(string $login, string $pass = '', string $domain = '', int $userId = 0): bool
-    {
-        foreach ($this->authContainer as $auth) {
-            if (!$this->checkAuth($auth)) {
-                return false;
-            }
-        }
-        if (!$this->isValidLogin($login)) {
-            throw new Exception(self::ERROR_USER_LOGINNAME_TOO_SHORT);
-        }
-        if ($this->getUserByLogin($login, false)) {
-            throw new Exception(self::ERROR_USER_LOGIN_NOT_UNIQUE);
-        }
-        if (0 === $userId) {
-            $this->userId = $this->configuration->getDb()->nextId(Database::getTablePrefix() . 'faquser', 'user_id');
-        } else {
-            $this->userId = $userId;
-        }
-        $insert = sprintf(
-            "INSERT INTO %sfaquser (user_id, login, session_timestamp, member_since) VALUES (%d, '%s', %d, '%s')",
-            Database::getTablePrefix(),
-            $this->getUserId(),
-            $this->configuration->getDb()->escape($login),
-            Request::createFromGlobals()->server->get('REQUEST_TIME'),
-            date('YmdHis', Request::createFromGlobals()->server->get('REQUEST_TIME')),
-        );
-        $this->configuration->getDb()->query($insert);
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $data = $this->userdata->add($this->getUserId());
-        if (!$data) {
-            throw new Exception(self::ERROR_USER_CANNOT_CREATE_USERDATA);
-        }
-        if ($pass === '') {
-            $pass = $this->createPassword();
-        }
-        $success = false;
-        foreach ($this->authContainer as $name => $auth) {
-            if ($auth->setReadOnly()) {
-                continue;
-            }
-            if (!$auth->create($login, $pass, $domain)) {
-                throw new Exception(self::ERROR_USER_CANNOT_CREATE_USER . 'in Auth ' . $name);
-            } else {
-                $success = true;
-            }
-        }
-        if (!$success) {
-            return false;
-        }
-        if ($this->perm instanceof MediumPermission) {
-            $this->perm->autoJoin($this->userId);
-        }
-        return $this->getUserByLogin($login, false);
-    }
-    /**
-     * Returns true if login is a valid login string.
-     * $this->loginMinLength defines the minimum length of the login string.
-     * If login has more characters than allowed, false is returned.
-     * $this->login_invalidRegExp is a regular expression.
-     * If login matches this false is returned.
-     *
-     * @param string $login Login name
-     */
-    public function isValidLogin(string $login): bool
-    {
-        if (strlen($login) < $this->loginMinLength || !preg_match($this->validUsername, $login)) {
-            $this->errors[] = self::ERROR_USER_LOGIN_INVALID;
-            return false;
-        }
-        return true;
-    }
-    /**
-     * loads basic user information from the database selecting the user with
-     * specified login.
-     *
-     * @param string $login Login name
-     * @param bool   $raiseError Raise error?
-     * @throws Exception
-     */
-    public function getUserByLogin(string $login, bool $raiseError = true): bool
-    {
-        $select = sprintf(
-            "SELECT user_id, login, account_status, is_superadmin, auth_source FROM %sfaquser WHERE login = '%s'",
-            Database::getTablePrefix(),
-            $this->configuration->getDb()->escape($login),
-        );
-        $result = $this->configuration->getDb()->query($select);
-        if ($this->configuration->getDb()->numRows($result) !== 1) {
-            if ($raiseError) {
-                throw new Core\Exception(self::ERROR_USER_INCORRECT_LOGIN);
-            }
-            return false;
-        }
-        $this->extractUserFromResult($result);
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $this->userdata->load($this->getUserId());
-        return true;
-    }
-    /**
-     * Returns a new password.
-     *
-     * @throws Exception
-     */
-    public function createPassword(int $minimumLength = 8, bool $allowUnderscore = true): string
-    {
-        $consonants = ['b', 'c', 'd', 'f', 'g', 'h', 'j', 'k', 'm', 'n', 'p', 'r', 's', 't', 'v', 'w', 'x', 'y', 'z'];
-        $vowels = ['a', 'e', 'i', 'u'];
-        $newPassword = '';
-        $nextChar = '';
-        $skipped = false;
-        while (strlen($newPassword) < $minimumLength) {
-            $caseFunc = random_int(0, 1) !== 0 ? 'strtoupper' : 'strtolower';
-            switch (random_int(0, $skipped ? 3 : ($allowUnderscore ? 5 : 4))) {
-                case 0:
-                case 1:
-                    $nextChar = $caseFunc($consonants[random_int(0, 18)]);
-                    break;
-                case 2:
-                case 3:
-                    $nextChar = $caseFunc($vowels[random_int(0, 3)]);
-                    break;
-                case 4:
-                    $nextChar = (string)random_int(2, 9);
-                    break;
-                case 5:
-                    $newPassword .= '_';
-                    continue 2;
-            }
-            $skipped = false;
-            if (!str_contains($newPassword, $nextChar)) {
-                $newPassword .= $nextChar;
-            } else {
-                $skipped = true;
-            }
-        }
-        return $newPassword;
-    }
-    /**
-     * deletes the user from the database.
-     */
-    public function deleteUser(): bool
-    {
-        if (!isset($this->userId) || $this->userId == 0) {
-            $this->errors[] = self::ERROR_USER_NO_USERID;
-            return false;
-        }
-        if (!isset($this->login) || strlen($this->login) == 0) {
-            $this->errors[] = self::ERROR_USER_LOGIN_INVALID;
-            return false;
-        }
-        if (
-            isset($this->allowedStatus[$this->status]) &&
-            $this->allowedStatus[$this->status] === self::STATUS_USER_PROTECTED
-        ) {
-            $this->errors[] = self::ERROR_USER_CANNOT_DELETE_USER . self::STATUS_USER_PROTECTED;
-            return false;
-        }
-        /** @phpstan-ignore-next-line */
-        $this->perm->refuseAllUserRights($this->userId);
-        $delete = sprintf(
-            'DELETE FROM %sfaquser WHERE user_id = %d',
-            Database::getTablePrefix(),
-            $this->userId,
-        );
-        $res = $this->configuration->getDb()->query($delete);
-        if (!$res) {
-            $this->errors[] = self::ERROR_USER_CANNOT_DELETE_USER . 'error: ' . $this->configuration->getDb()->error();
-            return false;
-        }
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $data = $this->userdata->delete($this->getUserId());
-        if (!$data) {
-            $this->errors[] = self::ERROR_USER_CANNOT_DELETE_USERDATA;
-            return false;
-        }
-        $readOnly = 0;
-        $authCount = 0;
-        $delete = [];
-        foreach ($this->authContainer as $auth) {
-            ++$authCount;
-            if ($auth->setReadOnly()) {
-                ++$readOnly;
-                continue;
-            }
-            $delete[] = $auth->delete($this->login);
-        }
-        if ($readOnly === $authCount) {
-            $this->errors[] = self::ERROR_USER_NO_AUTH_WRITABLE;
-        }
-        return in_array(true, $delete);
-    }
-    /**
-     * Returns a string with error messages.
-     * The string returned by error() contains messages for all errors that during object processing.
-     * New lines separate messages.
-     * Error messages are stored in the public array errors.
-     */
-    public function error(): string
-    {
-        $message = '';
-        foreach ($this->errors as $error) {
-            $message .= $error . "<br>\n";
-        }
-        $this->errors = [];
-        return $message;
-    }
-    /**
-     * Returns the data aof the auth container.
-     *
-     * @return AuthDriverInterface[]
-     */
-    public function getAuthContainer(): array
-    {
-        return $this->authContainer;
-    }
-    /**
-     * Returns an array with the user-IDs of all users found in
-     * the database. By default, the Anonymous User will not be returned.
-     *
-     * @param bool $withoutAnonymous Without anonymous?
-     * @param bool $allowBlockedUsers Allow blocked users as well, e.g. in admin
-     * @return array<int>
-     */
-    public function getAllUsers(bool $withoutAnonymous = true, bool $allowBlockedUsers = true): array
-    {
-        $query = sprintf(
-            'SELECT user_id FROM %sfaquser WHERE 1 = 1 %s %s ORDER BY user_id ASC',
-            Database::getTablePrefix(),
-            ($withoutAnonymous ? 'AND user_id <> -1' : ''),
-            ($allowBlockedUsers ? '' : "AND account_status != 'blocked'"),
-        );
-        $result = $this->configuration->getDb()->query($query);
-        if (!$result) {
-            return [];
-        }
-        $users = [];
-        if ($this->configuration->getDb()->numRows($result) === 0) {
-            return $result;
-        }
-        while ($row = $this->configuration->getDb()->fetchArray($result)) {
-            $users[] = (int) $row['user_id'];
-        }
-        return $users;
-    }
-    /**
-     * Loads basic user information from the database selecting the user with
-     * specified user-ID.
-     *
-     * @param int  $userId User ID
-     * @param bool $allowBlockedUsers Allow blocked users as well, e.g. in admin
-     */
-    public function getUserById(int $userId, bool $allowBlockedUsers = false): bool
-    {
-        $select = sprintf(
-            '
-            SELECT
-                user_id,
-                login,
-                account_status,
-                is_superadmin,
-                auth_source
-            FROM
-                %sfaquser
-            WHERE
-                user_id = %d ' . ($allowBlockedUsers ? '' : "AND account_status != 'blocked'"),
-            Database::getTablePrefix(),
-            $userId,
-        );
-        $result = $this->configuration->getDb()->query($select);
-        if ($this->configuration->getDb()->numRows($result) != 1) {
-            $this->errors[] = self::ERROR_USER_NO_USERID . 'error(): ' . $this->configuration->getDb()->error();
-            return false;
-        }
-        $this->extractUserFromResult($result);
-        if ('db' === $this->getAuthSource('name')) {
-            $select = sprintf(
-                "SELECT pass FROM %sfaquserlogin WHERE login = '%s'",
-                Database::getTablePrefix(),
-                $this->login,
-            );
-            $res = $this->configuration->getDb()->query($select);
-            if ($this->configuration->getDb()->numRows($res) != 1) {
-                $this->errors[] =
-                    self::ERROR_USER_NO_USERLOGINDATA . 'error: ' . $this->configuration->getDb()->error();
-                return false;
-            }
-        }
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $this->userdata->load($this->getUserId());
-        return true;
-    }
-    /**
-     * Returns the data of the current user.
-     *
-     * @param string $field Field
-     * @return array<string>|string|int|null
-     */
-    public function getUserData(string $field = '*'): array|int|string|null
-    {
-        if (!($this->userdata instanceof UserData)) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        return $this->userdata->get($field);
-    }
-    /**
-     * Adds user data.
-     *
-     * @param array<string> $data Array with user data
-     */
-    public function setUserData(array $data): bool
-    {
-        if (!($this->userdata instanceof UserData)) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $this->userdata->load($this->getUserId());
-        return $this->userdata->set(array_keys($data), array_values($data));
-    }
-    /**
-     * returns the user's login.
-     */
-    public function getLogin(): string
-    {
-        return $this->login;
-    }
-    /**
-     * Returns the user ID from the given email address
-     */
-    public function getUserIdByEmail(string $email): int
-    {
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $userData = $this->userdata->fetchAll('email', $email);
-        return $userData['user_id'];
-    }
-    /**
-     * Returns true or false for the visibility for the given email
-     * address, if the user is not a registered user, the method
-     * returns false for anonymous users
-     */
-    public function getUserVisibilityByEmail(string $email): bool
-    {
-        if (!$this->userdata instanceof UserData) {
-            $this->userdata = new UserData($this->configuration);
-        }
-        $userData = $this->userdata->fetchAll('email', $email);
-        return !isset($userData['is_visible']) || $userData['is_visible'];
-    }
-    /**
-     * Returns true on success.
-     * This will change a users' status to active, and send an email with a new password.
-     *
-     * @throws Exception|TransportExceptionInterface
-     */
-    public function activateUser(): bool
-    {
-        if ($this->getStatus() == 'blocked') {
-            $newPassword = $this->createPassword();
-            $this->changePassword($newPassword);
-            $subject = '[%sitename%] Login name / activation';
-            $message = sprintf(
-                "Name: %s<br>Login name: %s<br>New password: %s",
-                $this->getUserData('display_name'),
-                $this->getLogin(),
-                $newPassword,
-            );
-            if ($this->mailUser($subject, $message) !== 0) {
-                return $this->setStatus('active');
-            }
-            return true;
-        }
-        return false;
-    }
-    /**
-     * returns the user's status.
-     */
-    public function getStatus(): string
-    {
-        if (!isset($this->status)) {
-            return '';
-        }
-        if (strlen($this->status) <= 0) {
-            return '';
-        }
-        return $this->status;
-    }
-    /**
-     * Sets the user's status and updates the database entry.
-     *
-     * @param string $status Status
-     */
-    public function setStatus(string $status): bool
-    {
-        $status = strtolower($status);
-        if (!in_array($status, array_keys($this->allowedStatus))) {
-            $this->errors[] = self::ERROR_USER_INVALID_STATUS;
-            return false;
-        }
-        $this->status = $status;
-        $update = sprintf(
-            "UPDATE %sfaquser SET account_status = '%s' WHERE user_id = %d",
-            Database::getTablePrefix(),
-            $this->configuration->getDb()->escape($status),
-            $this->userId,
-        );
-        $res = $this->configuration->getDb()->query($update);
-        return (bool) $res;
-    }
-    /**
-     * Sets the auth container
-     */
-    public function setAuthSource(string $authSource): bool
-    {
-        $update = sprintf(
-            "UPDATE %sfaquser SET auth_source = '%s' WHERE user_id = %d",
-            Database::getTablePrefix(),
-            $this->configuration->getDb()->escape($authSource),
-            $this->getUserId(),
-        );
-        return (bool) $this->configuration->getDb()->query($update);
-    }
-    /**
-     * changes the user's password. If $pass is omitted, a new
-     * password is generated using the createPassword() method.
-     *
-     * @param string $pass Password
-     * @throws Exception
-     */
-    public function changePassword(string $pass = ''): bool
-    {
-        foreach ($this->authContainer as $auth) {
-            if (!$this->checkAuth($auth)) {
-                return false;
-            }
-        }
-        $login = $this->getLogin();
-        if ($pass == '') {
-            $pass = $this->createPassword();
-        }
-        $success = false;
-        foreach ($this->authContainer as $auth) {
-            if ($auth->setReadOnly()) {
-                continue;
-            }
-            if (!$auth->update($login, $pass)) {
-                continue;
-            }
-            $success = true;
-        }
-        return $success;
-    }
-    /**
-     * Sends mail to the current user.
-     *
-     * @throws Core\Exception|TransportExceptionInterface
-     */
-    public function mailUser(string $subject, string $message): int
-    {
-        $mail = new Mail($this->configuration);
-        $mail->addTo($this->getUserData('email'));
-        $mail->subject = $subject;
-        $mail->message = $message;
-        $result = $mail->send();
-        unset($mail);
-        return $result;
-    }
-    /**
-     * Returns true, if a user is a super admin.
-     */
-    public function isSuperAdmin(): bool
-    {
-        return $this->isSuperAdmin;
-    }
-    /**
-     * Sets the users "is_superadmin" flag and updates the database entry.
-     */
-    public function setSuperAdmin(bool $isSuperAdmin): bool
-    {
-        $this->isSuperAdmin = $isSuperAdmin;
-        $update = sprintf(
-            "UPDATE %sfaquser SET is_superadmin = %d WHERE user_id = %d",
-            Database::getTablePrefix(),
-            (int)$this->isSuperAdmin,
-            $this->userId,
-        );
-        $res = $this->configuration->getDb()->query($update);
-        return (bool) $res;
-    }
-    /**
-     * Terminates the session ID of user
-     */
-    public function terminateSessionId(): bool
-    {
-        $update = sprintf(
-            "UPDATE %sfaquser SET session_id = '' WHERE user_id = %d",
-            Database::getTablePrefix(),
-            $this->userId,
-        );
-        return (bool) $this->configuration->getDb()->query($update);
-    }
-    /**
-     * @param mixed $result
-     * @return void
-     */
-    public function extractUserFromResult(mixed $result): void
-    {
-        $user = $this->configuration->getDb()->fetchArray($result);
-        $this->userId = (int)$user['user_id'];
-        $this->login = (string)$user['login'];
-        $this->status = (string)$user['account_status'];
-        $this->isSuperAdmin = (bool)$user['is_superadmin'];
-        $this->authSource = (string) $user['auth_source'];
-    }
-    public function setWebAuthnKeys(string $webAuthnKeys): bool
-    {
-         $query = sprintf(
-             "UPDATE %sfaquser SET webauthnkeys = '%s' WHERE user_id = %d",
-             Database::getTablePrefix(),
-             $this->configuration->getDb()->escape($webAuthnKeys),
-             $this->getUserId(),
-         );
-         return (bool) $this->configuration->getDb()->query($query);
-    }
-    public function getWebAuthnKeys(): string
-    {
-        $select = sprintf(
-            "SELECT webauthnkeys FROM %sfaquser WHERE user_id = %d",
-            Database::getTablePrefix(),
-            $this->getUserId(),
-        );
-        $result = $this->configuration->getDb()->query($select);
-        if ($this->configuration->getDb()->numRows($result) === 1) {
-            $user = $this->configuration->getDb()->fetchArray($result);
-            return (string) $user['webauthnkeys'];
-        }
-        return '';
-    }
-}

--- a/phpmyfaq/startpage.php
+++ b//dev/null
@@ -1,79 +0,0 @@
-<?php
-/**
- * The main start page with the start page categories, the Top 10 and the latest messages.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2002-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2002-08-23
- */
-use phpMyFAQ\Category\Startpage;
-use phpMyFAQ\Faq\Statistics;
-use phpMyFAQ\Helper\CategoryHelper;
-use phpMyFAQ\Language\Plurals;
-use phpMyFAQ\News;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\Extensions\TagNameTwigExtension;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use Symfony\Component\HttpFoundation\Request;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$news = new News($faqConfig);
-$categoryHelper = new CategoryHelper();
-$plr = new Plurals();
-$faqStatistics = new Statistics($faqConfig);
-$request = Request::createFromGlobals();
-$writeNewsHeader = Translation::get('newsArchive');
-$startPageCategory = new Startpage($faqConfig);
-$startPageCategory
-    ->setLanguage($faqLangCode)
-    ->setUser($currentUser)
-    ->setGroups($currentGroups);
-$startPageCategories = $startPageCategory->getCategories();
-$param = $faqConfig->get('records.orderingPopularFaqs') == 'visits' ? 'visits' : 'voted';
-$twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-$twig->addExtension(new TagNameTwigExtension());
-$twigTemplate = $twig->loadTemplate('./startpage.twig');
-$templateVars = [
-    ... $templateVars,
-    'baseHref' => $faqSystem->getSystemUri($faqConfig),
-    'title' => $faqConfig->getTitle(),
-    'pageHeader' => $faqConfig->getTitle(),
-    'startPageCategories' => (is_countable($startPageCategories) ? count($startPageCategories) : 0) > 0,
-    'startPageCategoryDecks' => $startPageCategories,
-    'stickyRecordsHeader' => Translation::get('stickyRecordsHeader'),
-    'stickyRecordsList' => $faq->getStickyFaqsData(),
-    'writeTopTenHeader' => Translation::get('msgTopTen'),
-    'topRecordsList' => $faqStatistics->getTopTen($param),
-    'errorMsgTopTen' => Translation::get('err_noTopTen'),
-    'writeNewestHeader' => Translation::get('msgLatestArticles'),
-    'latestRecordsList' => $faqStatistics->getLatest(),
-    'errorMsgLatest' => Translation::get('msgErrorNoRecords'),
-    'msgTrendingFAQs' => Translation::get('msgTrendingFAQs'),
-    'trendingRecordsList' => $faqStatistics->getTrending(),
-    'errorMsgTrendingFaqs' => Translation::get('msgErrorNoRecords'),
-    'msgNewsHeader' => $writeNewsHeader,
-    'newsList' => $news->getAll(),
-    'writeNumberOfArticles' => $plr->getMsg('plmsgHomeArticlesOnline', $faqStatistics->totalFaqs($faqLangCode)),
-    'msgTags' => Translation::get('msgPopularTags'),
-    'tagsList' => $oTag->getPopularTags(12),
-    'formActionUrl' => '?' . $sids . 'action=search',
-    'searchBox' => Translation::get('msgSearch'),
-    'categoryId' => ($cat === 0) ? '%' : (int)$cat,
-    'msgSearch' => sprintf(
-        '<a class="help" href="%sindex.php?action=search">%s</a>',
-        Strings::htmlentities($faqSystem->getSystemUri($faqConfig)),
-        Translation::get('msgAdvancedSearch')
-    )
-];
-return $templateVars;

--- a/phpmyfaq/ucp.php
+++ b//dev/null
@@ -1,100 +0,0 @@
-<?php
-/**
- * User Control Panel.
- *
- * This Source Code Form is subject to the terms of the Mozilla Public License,
- * v. 2.0. If a copy of the MPL was not distributed with this file, You can
- * obtain one at https://mozilla.org/MPL/2.0/.
- *
- * @package   phpMyFAQ
- * @author    Thorsten Rinne <thorsten@phpmyfaq.de>
- * @copyright 2012-2024 phpMyFAQ Team
- * @license   https://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- * @link      https://www.phpmyfaq.de
- * @since     2012-01-12
- */
-use phpMyFAQ\Session\Token;
-use phpMyFAQ\Strings;
-use phpMyFAQ\Template\TwigWrapper;
-use phpMyFAQ\Translation;
-use phpMyFAQ\User\TwoFactor;
-use RobThree\Auth\TwoFactorAuthException;
-use Symfony\Component\HttpFoundation\RedirectResponse;
-if (!defined('IS_VALID_PHPMYFAQ')) {
-    http_response_code(400);
-    exit();
-}
-$faqConfig = $container->get('phpmyfaq.configuration');
-$user = $container->get('phpmyfaq.user.current_user');
-if ($user->isLoggedIn()) {
-    $faqSession = $container->get('phpmyfaq.session');
-    $faqSession->setCurrentUser($user);
-    $faqSession->userTracking('user_control_panel', $user->getUserId());
-    if ($faqConfig->get('main.enableGravatarSupport')) {
-        $gravatar = $container->get('phpmyfaq.services.gravatar');
-        $gravatarImg = sprintf(
-            '<a target="_blank" href="https://www.gravatar.com">%s</a>',
-            $gravatar->getImage(
-                $user->getUserData('email'),
-                ['class' => 'img-responsive rounded-circle', 'size' => 125]
-            )
-        );
-    } else {
-        $gravatarImg = '';
-    }
-    $qrCode = '';
-    try {
-        $twoFactor = new TwoFactor($faqConfig, $user);
-        $secret = $twoFactor->getSecret($user);
-        if ('' === $secret || is_null($secret)) {
-            try {
-                $secret = $twoFactor->generateSecret();
-            } catch (TwoFactorAuthException $e) {
-                $faqConfig->getLogger()->error('Cannot generate 2FA secret: ' . $e->getMessage());
-            }
-            $twoFactor->saveSecret($secret);
-        }
-        $qrCode = $twoFactor->getQrCode($secret);
-    } catch (TwoFactorAuthException | Exception $e) {
-    }
-    $twig = new TwigWrapper(PMF_ROOT_DIR . '/assets/templates/');
-    $twigTemplate = $twig->loadTemplate('./ucp.twig');
-    $templateVars = [
-        ... $templateVars,
-        'headerUserControlPanel' => Translation::get('headerUserControlPanel'),
-        'ucpGravatarImage' => $gravatarImg,
-        'msgHeaderUserData' => Translation::get('headerUserControlPanel'),
-        'userid' => $user->getUserId(),
-        'csrf' => Token::getInstance()->getTokenInput('ucp'),
-        'lang' => $faqConfig->getLanguage()->getLanguage(),
-        'readonly' => $user->isLocalUser() ? '' : 'readonly disabled',
-        'msgRealName' => Translation::get('ad_user_name'),
-        'realname' => Strings::htmlentities($user->getUserData('display_name')),
-        'msgEmail' => Translation::get('msgNewContentMail'),
-        'email' => Strings::htmlentities($user->getUserData('email')),
-        'msgIsVisible' => Translation::get('msgUserDataVisible'),
-        'checked' => (int)$user->getUserData('is_visible') === 1 ? 'checked' : '',
-        'msgPassword' => Translation::get('ad_auth_passwd'),
-        'msgConfirm' => Translation::get('ad_user_confirm'),
-        'msgSave' => Translation::get('msgSave'),
-        'msgCancel' => Translation::get('msgCancel'),
-        'twofactor_enabled' => (bool)$user->getUserData('twofactor_enabled'),
-        'msgTwofactorEnabled' => Translation::get('msgTwofactorEnabled'),
-        'msgTwofactorConfig' => Translation::get('msgTwofactorConfig'),
-        'msgTwofactorConfigModelTitle' => Translation::get('msgTwofactorConfigModelTitle'),
-        'twofactor_secret' => $secret ?? '',
-        'qr_code_secret' => $qrCode,
-        'qr_code_secret_alt' => Translation::get('qr_code_secret_alt'),
-        'msgTwofactorNewSecret' => Translation::get('msgTwofactorNewSecret'),
-        'msgWarning' => Translation::get('msgWarning'),
-        'ad_gen_yes' => Translation::get('ad_gen_yes'),
-        'ad_gen_no' => Translation::get('ad_gen_no'),
-        'msgConfirmTwofactorConfig' => Translation::get('msgConfirmTwofactorConfig'),
-        'csrfTokenRemoveTwofactor' => Token::getInstance()->getTokenString('remove-twofactor'),
-        'msgGravatarNotConnected' => Translation::get('msgGravatarNotConnected')
-    ];
-    return $templateVars;
-} else {
-    $response = new RedirectResponse($faqConfig->getDefaultUrl());
-    $response->send();
-}

--- a/scripts/version.sh
+++ b/scripts/version.sh
@@ -1,3 +1,3 @@
-if [ -z "${PMF_VERSION}" ]; then
-    PMF_VERSION="4.0.2"
+if [ "x${PMF_VERSION}" = "x" ]; then
+    PMF_VERSION="3.2.10"
 fi
