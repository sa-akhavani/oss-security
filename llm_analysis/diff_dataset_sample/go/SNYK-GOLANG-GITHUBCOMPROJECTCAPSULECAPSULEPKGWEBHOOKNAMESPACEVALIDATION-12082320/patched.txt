# ====================================================================
# FILE: pkg/webhook/namespace/validation/patch.go
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 28-56 ---
    28| 	}
    29| }
    30| func (r *patchHandler) OnUpdate(c client.Client, decoder admission.Decoder, recorder record.EventRecorder) capsulewebhook.Func {
    31| 	return func(ctx context.Context, req admission.Request) *admission.Response {
    32| 		ns := &corev1.Namespace{}
    33| 		if err := decoder.DecodeRaw(req.OldObject, ns); err != nil {
    34| 			return utils.ErroredResponse(err)
    35| 		}
    36| 		ln, err := capsuleutils.GetTypeLabel(&capsulev1beta2.Tenant{})
    37| 		if err != nil {
    38| 			response := admission.Errored(http.StatusBadRequest, err)
    39| 			return &response
    40| 		}
    41| 		e := fmt.Sprintf("namespace/%s can not be patched", ns.Name)
    42| 		if label, ok := ns.Labels[ln]; ok {
    43| 			tnt := &capsulev1beta2.Tenant{}
    44| 			if err = c.Get(ctx, types.NamespacedName{Name: label}, tnt); err != nil {
    45| 				response := admission.Errored(http.StatusBadRequest, err)
    46| 				return &response
    47| 			}
    48| 			if utils.IsTenantOwner(tnt.Spec.Owners, req.UserInfo) {
    49| 				return nil
    50| 			}
    51| 		}
    52| 		recorder.Eventf(ns, corev1.EventTypeWarning, "NamespacePatch", e)
    53| 		response := admission.Denied(e)
    54| 		return &response
    55| 	}
    56| }

