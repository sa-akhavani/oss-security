# ====================================================================
# FILE: src/index.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-32 ---
     1| import { valid, compare } from 'semver';
     2| import { exec } from 'child_process';
     3| const lsRemoteTags = (repo: string): Promise<string> => new Promise(
     4| 	(resolve, reject) => {
     5| 		exec(`git ls-remote --tags ${repo}`, (_, stdout, stderr) => {
     6| 			if (stderr) reject(new Error(stderr));
     7| 			resolve(stdout.toString().trim());
     8| 		});
     9| 	},
    10| );
    11| const parseTags = (tags: string): Map<string, string> => {
    12| 	const tagMap = new Map();
    13| 	tags.split('\n')
    14| 		.forEach((str) => {
    15| 			const ref = str.split(/\t/);
    16| 			tagMap.set(ref[1].split('/')[2].replace(/\^\{\}$/, ''), ref[0]);
    17| 		});
    18| 	return new Map(
    19| 		[...tagMap.entries()]
    20| 			.filter((arr) => valid(arr[0]))
    21| 			.sort((a, b) => compare(a[0], b[0]))
    22| 			.reverse(),
    23| 	);
    24| };
    25| export const get = async (repo: string): Promise<Map<string, string>> => {
    26| 	const tags = await lsRemoteTags(repo);
    27| 	return parseTags(tags);
    28| };
    29| export const latest = async (repo: string): Promise<[string, string]> => {
    30| 	const tags = await get(repo);
    31| 	return tags.entries().next().value as [string, string];
    32| };

