# ====================================================================
# FILE: src/index.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-40 ---
     1| import { valid, compare } from 'semver';
     2| import { spawn } from 'child_process';
     3| const lsRemoteTags = (repoPath: string): Promise<string> => new Promise((resolve, reject) => {
     4| 	let stderr = '';
     5| 	let stdout = '';
     6| 	const child = spawn('git', ['ls-remote', '--tags', repoPath]);
     7| 	child.stdout.on('data', (data) => {
     8| 		stdout += data;
     9| 	});
    10| 	child.stderr.on('data', (data) => {
    11| 		stderr += data;
    12| 	});
    13| 	child.on('error', reject);
    14| 	child.on('close', (exitCode) => {
    15| 		if (exitCode !== 0 || stderr.length) reject(new Error(stderr));
    16| 		resolve(stdout.toString().trim());
    17| 	});
    18| });
    19| const parseTags = (tags: string): Map<string, string> => {
    20| 	const tagMap = new Map<string, string>();
    21| 	tags.split('\n')
    22| 		.forEach((str) => {
    23| 			const ref = str.split(/\t/);
    24| 			tagMap.set(ref[1].split('/')[2].replace(/\^\{\}$/, ''), ref[0]);
    25| 		});
    26| 	return new Map(
    27| 		[...tagMap.entries()]
    28| 			.filter((arr) => valid(arr[0]))
    29| 			.sort((a, b) => compare(a[0], b[0]))
    30| 			.reverse(),
    31| 	);
    32| };
    33| export const get = async (repo: string): Promise<Map<string, string>> => {
    34| 	const tags = await lsRemoteTags(repo);
    35| 	return parseTags(tags);
    36| };
    37| export const latest = async (repo: string): Promise<[string, string]> => {
    38| 	const tags = await get(repo);
    39| 	return tags.entries().next().value as [string, string];
    40| };

