# ====================================================================
# FILE: lib/document.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 557-599 ---
   557|  * Init helper.
   558|  *
   559|  * @param {Object} self document instance
   560|  * @param {Object} obj raw mongodb doc
   561|  * @param {Object} doc object we are initializing
   562|  * @api private
   563|  */
   564| function init(self, obj, doc, opts, prefix) {
   565|   prefix = prefix || '';
   566|   const keys = Object.keys(obj);
   567|   const len = keys.length;
   568|   let schema;
   569|   let path;
   570|   let i;
   571|   let index = 0;
   572|   while (index < len) {
   573|     _init(index++);
   574|   }
   575|   function _init(index) {
   576|     i = keys[index];
   577|     if (i === '__proto__' || i === 'constructor') {
   578|       return;
   579|     }
   580|     path = prefix + i;
   581|     schema = self.$__schema.path(path);
   582|     if (self.$__schema.$isRootDiscriminator && !self.$__isSelected(path)) {
   583|       return;
   584|     }
   585|     if (!schema && utils.isPOJO(obj[i])) {
   586|       if (!doc[i]) {
   587|         doc[i] = {};
   588|       }
   589|       init(self, obj[i], doc[i], opts, path + '.');
   590|     } else if (!schema) {
   591|       doc[i] = obj[i];
   592|     } else {
   593|       if (obj[i] === null) {
   594|         doc[i] = schema._castNullish(null);
   595|       } else if (obj[i] !== undefined) {
   596|         const intCache = obj[i].$__ || {};
   597|         const wasPopulated = intCache.wasPopulated || null;
   598|         if (schema && !wasPopulated) {
   599|           try {

