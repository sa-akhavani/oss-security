# ====================================================================
# FILE: lib/document.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 557-596 ---
   557|  * Init helper.
   558|  *
   559|  * @param {Object} self document instance
   560|  * @param {Object} obj raw mongodb doc
   561|  * @param {Object} doc object we are initializing
   562|  * @api private
   563|  */
   564| function init(self, obj, doc, opts, prefix) {
   565|   prefix = prefix || '';
   566|   const keys = Object.keys(obj);
   567|   const len = keys.length;
   568|   let schema;
   569|   let path;
   570|   let i;
   571|   let index = 0;
   572|   while (index < len) {
   573|     _init(index++);
   574|   }
   575|   function _init(index) {
   576|     i = keys[index];
   577|     path = prefix + i;
   578|     schema = self.$__schema.path(path);
   579|     if (self.$__schema.$isRootDiscriminator && !self.$__isSelected(path)) {
   580|       return;
   581|     }
   582|     if (!schema && utils.isPOJO(obj[i])) {
   583|       if (!doc[i]) {
   584|         doc[i] = {};
   585|       }
   586|       init(self, obj[i], doc[i], opts, path + '.');
   587|     } else if (!schema) {
   588|       doc[i] = obj[i];
   589|     } else {
   590|       if (obj[i] === null) {
   591|         doc[i] = schema._castNullish(null);
   592|       } else if (obj[i] !== undefined) {
   593|         const intCache = obj[i].$__ || {};
   594|         const wasPopulated = intCache.wasPopulated || null;
   595|         if (schema && !wasPopulated) {
   596|           try {

