# ====================================================================
# FILE: dist/amd/aurelia-path.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-208 ---
     1| define(['exports'], function (exports) { 'use strict';
     2|     function trimDots(ary) {
     3|         for (var i = 0; i < ary.length; ++i) {
     4|             var part = ary[i];
     5|             if (part === '.') {
     6|                 ary.splice(i, 1);
     7|                 i -= 1;
     8|             }
     9|             else if (part === '..') {
    10|                 if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
    11|                     continue;
    12|                 }
    13|                 else if (i > 0) {
    14|                     ary.splice(i - 1, 2);
    15|                     i -= 2;
    16|                 }
    17|             }
    18|         }
    19|     }
    20|     function relativeToFile(name, file) {
    21|         var fileParts = file && file.split('/');
    22|         var nameParts = name.trim().split('/');
    23|         if (nameParts[0].charAt(0) === '.' && fileParts) {
    24|             var normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    25|             nameParts.unshift.apply(nameParts, normalizedBaseParts);
    26|         }
    27|         trimDots(nameParts);
    28|         return nameParts.join('/');
    29|     }
    30|     function join(path1, path2) {
    31|         if (!path1) {
    32|             return path2;
    33|         }
    34|         if (!path2) {
    35|             return path1;
    36|         }
    37|         var schemeMatch = path1.match(/^([^/]*?:)\//);
    38|         var scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    39|         path1 = path1.substr(scheme.length);
    40|         var urlPrefix;
    41|         if (path1.indexOf('///') === 0 && scheme === 'file:') {
    42|             urlPrefix = '///';
    43|         }
    44|         else if (path1.indexOf('//') === 0) {
    45|             urlPrefix = '//';
    46|         }
    47|         else if (path1.indexOf('/') === 0) {
    48|             urlPrefix = '/';
    49|         }
    50|         else {
    51|             urlPrefix = '';
    52|         }
    53|         var trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    54|         var url1 = path1.split('/');
    55|         var url2 = path2.split('/');
    56|         var url3 = [];
    57|         for (var i = 0, ii = url1.length; i < ii; ++i) {
    58|             if (url1[i] === '..') {
    59|                 if (url3.length && url3[url3.length - 1] !== '..') {
    60|                     url3.pop();
    61|                 }
    62|                 else {
    63|                     url3.push(url1[i]);
    64|                 }
    65|             }
    66|             else if (url1[i] === '.' || url1[i] === '') {
    67|                 continue;
    68|             }
    69|             else {
    70|                 url3.push(url1[i]);
    71|             }
    72|         }
    73|         for (var i = 0, ii = url2.length; i < ii; ++i) {
    74|             if (url2[i] === '..') {
    75|                 if (url3.length && url3[url3.length - 1] !== '..') {
    76|                     url3.pop();
    77|                 }
    78|                 else {
    79|                     url3.push(url2[i]);
    80|                 }
    81|             }
    82|             else if (url2[i] === '.' || url2[i] === '') {
    83|                 continue;
    84|             }
    85|             else {
    86|                 url3.push(url2[i]);
    87|             }
    88|         }
    89|         return scheme + urlPrefix + url3.join('/') + trailingSlash;
    90|     }
    91|     var encode = encodeURIComponent;
    92|     var encodeKey = function (k) { return encode(k).replace('%24', '$'); };
    93|     function buildParam(key, value, traditional) {
    94|         var result = [];
    95|         if (value === null || value === undefined) {
    96|             return result;
    97|         }
    98|         if (Array.isArray(value)) {
    99|             for (var i = 0, l = value.length; i < l; i++) {
   100|                 if (traditional) {
   101|                     result.push(encodeKey(key) + "=" + encode(value[i]));
   102|                 }
   103|                 else {
   104|                     var arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   105|                     result = result.concat(buildParam(arrayKey, value[i]));
   106|                 }
   107|             }
   108|         }
   109|         else if (typeof (value) === 'object' && !traditional) {
   110|             for (var propertyName in value) {
   111|                 result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   112|             }
   113|         }
   114|         else {
   115|             result.push(encodeKey(key) + "=" + encode(value));
   116|         }
   117|         return result;
   118|     }
   119|     function buildQueryString(params, traditional) {
   120|         var pairs = [];
   121|         var keys = Object.keys(params || {}).sort();
   122|         for (var i = 0, len = keys.length; i < len; i++) {
   123|             var key = keys[i];
   124|             pairs = pairs.concat(buildParam(key, params[key], traditional));
   125|         }
   126|         if (pairs.length === 0) {
   127|             return '';
   128|         }
   129|         return pairs.join('&');
   130|     }
   131|     function processScalarParam(existedParam, value) {
   132|         if (Array.isArray(existedParam)) {
   133|             existedParam.push(value);
   134|             return existedParam;
   135|         }
   136|         if (existedParam !== undefined) {
   137|             return [existedParam, value];
   138|         }
   139|         return value;
   140|     }
   141|     function parseComplexParam(queryParams, keys, value) {
   142|         var currentParams = queryParams;
   143|         var keysLastIndex = keys.length - 1;
   144|         for (var j = 0; j <= keysLastIndex; j++) {
   145|             var key = keys[j] === '' ? currentParams.length : keys[j];
   146|             preventPollution(key);
   147|             if (j < keysLastIndex) {
   148|                 var prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   149|                 currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1]) ? {} : []);
   150|             }
   151|             else {
   152|                 currentParams = currentParams[key] = value;
   153|             }
   154|         }
   155|     }
   156|     function parseQueryString(queryString) {
   157|         var queryParams = {};
   158|         if (!queryString || typeof queryString !== 'string') {
   159|             return queryParams;
   160|         }
   161|         var query = queryString;
   162|         if (query.charAt(0) === '?') {
   163|             query = query.substr(1);
   164|         }
   165|         var pairs = query.replace(/\+/g, ' ').split('&');
   166|         for (var i = 0; i < pairs.length; i++) {
   167|             var pair = pairs[i].split('=');
   168|             var key = decodeURIComponent(pair[0]);
   169|             if (!key) {
   170|                 continue;
   171|             }
   172|             var keys = key.split('][');
   173|             var keysLastIndex = keys.length - 1;
   174|             if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   175|                 keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   176|                 keys = keys.shift().split('[').concat(keys);
   177|                 keysLastIndex = keys.length - 1;
   178|             }
   179|             else {
   180|                 keysLastIndex = 0;
   181|             }
   182|             if (pair.length >= 2) {
   183|                 var value = pair[1] ? decodeURIComponent(pair[1]) : '';
   184|                 if (keysLastIndex) {
   185|                     parseComplexParam(queryParams, keys, value);
   186|                 }
   187|                 else {
   188|                     preventPollution(key);
   189|                     queryParams[key] = processScalarParam(queryParams[key], value);
   190|                 }
   191|             }
   192|             else {
   193|                 queryParams[key] = true;
   194|             }
   195|         }
   196|         return queryParams;
   197|     }
   198|     function preventPollution(key) {
   199|         if (key === '__proto__') {
   200|             throw new Error('Prototype pollution detected.');
   201|         }
   202|     }
   203|     exports.buildQueryString = buildQueryString;
   204|     exports.join = join;
   205|     exports.parseQueryString = parseQueryString;
   206|     exports.relativeToFile = relativeToFile;
   207|     Object.defineProperty(exports, '__esModule', { value: true });
   208| });


# ====================================================================
# FILE: dist/commonjs/aurelia-path.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-207 ---
     1| 'use strict';
     2| Object.defineProperty(exports, '__esModule', { value: true });
     3| function trimDots(ary) {
     4|     for (var i = 0; i < ary.length; ++i) {
     5|         var part = ary[i];
     6|         if (part === '.') {
     7|             ary.splice(i, 1);
     8|             i -= 1;
     9|         }
    10|         else if (part === '..') {
    11|             if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
    12|                 continue;
    13|             }
    14|             else if (i > 0) {
    15|                 ary.splice(i - 1, 2);
    16|                 i -= 2;
    17|             }
    18|         }
    19|     }
    20| }
    21| function relativeToFile(name, file) {
    22|     var fileParts = file && file.split('/');
    23|     var nameParts = name.trim().split('/');
    24|     if (nameParts[0].charAt(0) === '.' && fileParts) {
    25|         var normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    26|         nameParts.unshift.apply(nameParts, normalizedBaseParts);
    27|     }
    28|     trimDots(nameParts);
    29|     return nameParts.join('/');
    30| }
    31| function join(path1, path2) {
    32|     if (!path1) {
    33|         return path2;
    34|     }
    35|     if (!path2) {
    36|         return path1;
    37|     }
    38|     var schemeMatch = path1.match(/^([^/]*?:)\//);
    39|     var scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    40|     path1 = path1.substr(scheme.length);
    41|     var urlPrefix;
    42|     if (path1.indexOf('///') === 0 && scheme === 'file:') {
    43|         urlPrefix = '///';
    44|     }
    45|     else if (path1.indexOf('//') === 0) {
    46|         urlPrefix = '//';
    47|     }
    48|     else if (path1.indexOf('/') === 0) {
    49|         urlPrefix = '/';
    50|     }
    51|     else {
    52|         urlPrefix = '';
    53|     }
    54|     var trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    55|     var url1 = path1.split('/');
    56|     var url2 = path2.split('/');
    57|     var url3 = [];
    58|     for (var i = 0, ii = url1.length; i < ii; ++i) {
    59|         if (url1[i] === '..') {
    60|             if (url3.length && url3[url3.length - 1] !== '..') {
    61|                 url3.pop();
    62|             }
    63|             else {
    64|                 url3.push(url1[i]);
    65|             }
    66|         }
    67|         else if (url1[i] === '.' || url1[i] === '') {
    68|             continue;
    69|         }
    70|         else {
    71|             url3.push(url1[i]);
    72|         }
    73|     }
    74|     for (var i = 0, ii = url2.length; i < ii; ++i) {
    75|         if (url2[i] === '..') {
    76|             if (url3.length && url3[url3.length - 1] !== '..') {
    77|                 url3.pop();
    78|             }
    79|             else {
    80|                 url3.push(url2[i]);
    81|             }
    82|         }
    83|         else if (url2[i] === '.' || url2[i] === '') {
    84|             continue;
    85|         }
    86|         else {
    87|             url3.push(url2[i]);
    88|         }
    89|     }
    90|     return scheme + urlPrefix + url3.join('/') + trailingSlash;
    91| }
    92| var encode = encodeURIComponent;
    93| var encodeKey = function (k) { return encode(k).replace('%24', '$'); };
    94| function buildParam(key, value, traditional) {
    95|     var result = [];
    96|     if (value === null || value === undefined) {
    97|         return result;
    98|     }
    99|     if (Array.isArray(value)) {
   100|         for (var i = 0, l = value.length; i < l; i++) {
   101|             if (traditional) {
   102|                 result.push(encodeKey(key) + "=" + encode(value[i]));
   103|             }
   104|             else {
   105|                 var arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   106|                 result = result.concat(buildParam(arrayKey, value[i]));
   107|             }
   108|         }
   109|     }
   110|     else if (typeof (value) === 'object' && !traditional) {
   111|         for (var propertyName in value) {
   112|             result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   113|         }
   114|     }
   115|     else {
   116|         result.push(encodeKey(key) + "=" + encode(value));
   117|     }
   118|     return result;
   119| }
   120| function buildQueryString(params, traditional) {
   121|     var pairs = [];
   122|     var keys = Object.keys(params || {}).sort();
   123|     for (var i = 0, len = keys.length; i < len; i++) {
   124|         var key = keys[i];
   125|         pairs = pairs.concat(buildParam(key, params[key], traditional));
   126|     }
   127|     if (pairs.length === 0) {
   128|         return '';
   129|     }
   130|     return pairs.join('&');
   131| }
   132| function processScalarParam(existedParam, value) {
   133|     if (Array.isArray(existedParam)) {
   134|         existedParam.push(value);
   135|         return existedParam;
   136|     }
   137|     if (existedParam !== undefined) {
   138|         return [existedParam, value];
   139|     }
   140|     return value;
   141| }
   142| function parseComplexParam(queryParams, keys, value) {
   143|     var currentParams = queryParams;
   144|     var keysLastIndex = keys.length - 1;
   145|     for (var j = 0; j <= keysLastIndex; j++) {
   146|         var key = keys[j] === '' ? currentParams.length : keys[j];
   147|         preventPollution(key);
   148|         if (j < keysLastIndex) {
   149|             var prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   150|             currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1]) ? {} : []);
   151|         }
   152|         else {
   153|             currentParams = currentParams[key] = value;
   154|         }
   155|     }
   156| }
   157| function parseQueryString(queryString) {
   158|     var queryParams = {};
   159|     if (!queryString || typeof queryString !== 'string') {
   160|         return queryParams;
   161|     }
   162|     var query = queryString;
   163|     if (query.charAt(0) === '?') {
   164|         query = query.substr(1);
   165|     }
   166|     var pairs = query.replace(/\+/g, ' ').split('&');
   167|     for (var i = 0; i < pairs.length; i++) {
   168|         var pair = pairs[i].split('=');
   169|         var key = decodeURIComponent(pair[0]);
   170|         if (!key) {
   171|             continue;
   172|         }
   173|         var keys = key.split('][');
   174|         var keysLastIndex = keys.length - 1;
   175|         if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   176|             keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   177|             keys = keys.shift().split('[').concat(keys);
   178|             keysLastIndex = keys.length - 1;
   179|         }
   180|         else {
   181|             keysLastIndex = 0;
   182|         }
   183|         if (pair.length >= 2) {
   184|             var value = pair[1] ? decodeURIComponent(pair[1]) : '';
   185|             if (keysLastIndex) {
   186|                 parseComplexParam(queryParams, keys, value);
   187|             }
   188|             else {
   189|                 preventPollution(key);
   190|                 queryParams[key] = processScalarParam(queryParams[key], value);
   191|             }
   192|         }
   193|         else {
   194|             queryParams[key] = true;
   195|         }
   196|     }
   197|     return queryParams;
   198| }
   199| function preventPollution(key) {
   200|     if (key === '__proto__') {
   201|         throw new Error('Prototype pollution detected.');
   202|     }
   203| }
   204| exports.buildQueryString = buildQueryString;
   205| exports.join = join;
   206| exports.parseQueryString = parseQueryString;
   207| exports.relativeToFile = relativeToFile;


# ====================================================================
# FILE: dist/es2015/aurelia-path.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-202 ---
     1| function trimDots(ary) {
     2|     for (let i = 0; i < ary.length; ++i) {
     3|         let part = ary[i];
     4|         if (part === '.') {
     5|             ary.splice(i, 1);
     6|             i -= 1;
     7|         }
     8|         else if (part === '..') {
     9|             if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
    10|                 continue;
    11|             }
    12|             else if (i > 0) {
    13|                 ary.splice(i - 1, 2);
    14|                 i -= 2;
    15|             }
    16|         }
    17|     }
    18| }
    19| function relativeToFile(name, file) {
    20|     let fileParts = file && file.split('/');
    21|     let nameParts = name.trim().split('/');
    22|     if (nameParts[0].charAt(0) === '.' && fileParts) {
    23|         let normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    24|         nameParts.unshift(...normalizedBaseParts);
    25|     }
    26|     trimDots(nameParts);
    27|     return nameParts.join('/');
    28| }
    29| function join(path1, path2) {
    30|     if (!path1) {
    31|         return path2;
    32|     }
    33|     if (!path2) {
    34|         return path1;
    35|     }
    36|     let schemeMatch = path1.match(/^([^/]*?:)\//);
    37|     let scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    38|     path1 = path1.substr(scheme.length);
    39|     let urlPrefix;
    40|     if (path1.indexOf('///') === 0 && scheme === 'file:') {
    41|         urlPrefix = '///';
    42|     }
    43|     else if (path1.indexOf('//') === 0) {
    44|         urlPrefix = '//';
    45|     }
    46|     else if (path1.indexOf('/') === 0) {
    47|         urlPrefix = '/';
    48|     }
    49|     else {
    50|         urlPrefix = '';
    51|     }
    52|     let trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    53|     let url1 = path1.split('/');
    54|     let url2 = path2.split('/');
    55|     let url3 = [];
    56|     for (let i = 0, ii = url1.length; i < ii; ++i) {
    57|         if (url1[i] === '..') {
    58|             if (url3.length && url3[url3.length - 1] !== '..') {
    59|                 url3.pop();
    60|             }
    61|             else {
    62|                 url3.push(url1[i]);
    63|             }
    64|         }
    65|         else if (url1[i] === '.' || url1[i] === '') {
    66|             continue;
    67|         }
    68|         else {
    69|             url3.push(url1[i]);
    70|         }
    71|     }
    72|     for (let i = 0, ii = url2.length; i < ii; ++i) {
    73|         if (url2[i] === '..') {
    74|             if (url3.length && url3[url3.length - 1] !== '..') {
    75|                 url3.pop();
    76|             }
    77|             else {
    78|                 url3.push(url2[i]);
    79|             }
    80|         }
    81|         else if (url2[i] === '.' || url2[i] === '') {
    82|             continue;
    83|         }
    84|         else {
    85|             url3.push(url2[i]);
    86|         }
    87|     }
    88|     return scheme + urlPrefix + url3.join('/') + trailingSlash;
    89| }
    90| let encode = encodeURIComponent;
    91| let encodeKey = k => encode(k).replace('%24', '$');
    92| function buildParam(key, value, traditional) {
    93|     let result = [];
    94|     if (value === null || value === undefined) {
    95|         return result;
    96|     }
    97|     if (Array.isArray(value)) {
    98|         for (let i = 0, l = value.length; i < l; i++) {
    99|             if (traditional) {
   100|                 result.push(`${encodeKey(key)}=${encode(value[i])}`);
   101|             }
   102|             else {
   103|                 let arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   104|                 result = result.concat(buildParam(arrayKey, value[i]));
   105|             }
   106|         }
   107|     }
   108|     else if (typeof (value) === 'object' && !traditional) {
   109|         for (let propertyName in value) {
   110|             result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   111|         }
   112|     }
   113|     else {
   114|         result.push(`${encodeKey(key)}=${encode(value)}`);
   115|     }
   116|     return result;
   117| }
   118| function buildQueryString(params, traditional) {
   119|     let pairs = [];
   120|     let keys = Object.keys(params || {}).sort();
   121|     for (let i = 0, len = keys.length; i < len; i++) {
   122|         let key = keys[i];
   123|         pairs = pairs.concat(buildParam(key, params[key], traditional));
   124|     }
   125|     if (pairs.length === 0) {
   126|         return '';
   127|     }
   128|     return pairs.join('&');
   129| }
   130| function processScalarParam(existedParam, value) {
   131|     if (Array.isArray(existedParam)) {
   132|         existedParam.push(value);
   133|         return existedParam;
   134|     }
   135|     if (existedParam !== undefined) {
   136|         return [existedParam, value];
   137|     }
   138|     return value;
   139| }
   140| function parseComplexParam(queryParams, keys, value) {
   141|     let currentParams = queryParams;
   142|     let keysLastIndex = keys.length - 1;
   143|     for (let j = 0; j <= keysLastIndex; j++) {
   144|         let key = keys[j] === '' ? currentParams.length : keys[j];
   145|         preventPollution(key);
   146|         if (j < keysLastIndex) {
   147|             let prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   148|             currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1]) ? {} : []);
   149|         }
   150|         else {
   151|             currentParams = currentParams[key] = value;
   152|         }
   153|     }
   154| }
   155| function parseQueryString(queryString) {
   156|     let queryParams = {};
   157|     if (!queryString || typeof queryString !== 'string') {
   158|         return queryParams;
   159|     }
   160|     let query = queryString;
   161|     if (query.charAt(0) === '?') {
   162|         query = query.substr(1);
   163|     }
   164|     let pairs = query.replace(/\+/g, ' ').split('&');
   165|     for (let i = 0; i < pairs.length; i++) {
   166|         let pair = pairs[i].split('=');
   167|         let key = decodeURIComponent(pair[0]);
   168|         if (!key) {
   169|             continue;
   170|         }
   171|         let keys = key.split('][');
   172|         let keysLastIndex = keys.length - 1;
   173|         if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   174|             keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   175|             keys = keys.shift().split('[').concat(keys);
   176|             keysLastIndex = keys.length - 1;
   177|         }
   178|         else {
   179|             keysLastIndex = 0;
   180|         }
   181|         if (pair.length >= 2) {
   182|             let value = pair[1] ? decodeURIComponent(pair[1]) : '';
   183|             if (keysLastIndex) {
   184|                 parseComplexParam(queryParams, keys, value);
   185|             }
   186|             else {
   187|                 preventPollution(key);
   188|                 queryParams[key] = processScalarParam(queryParams[key], value);
   189|             }
   190|         }
   191|         else {
   192|             queryParams[key] = true;
   193|         }
   194|     }
   195|     return queryParams;
   196| }
   197| function preventPollution(key) {
   198|     if (key === '__proto__') {
   199|         throw new Error('Prototype pollution detected.');
   200|     }
   201| }
   202| export { buildQueryString, join, parseQueryString, relativeToFile };


# ====================================================================
# FILE: dist/native-modules/aurelia-path.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-202 ---
     1| function trimDots(ary) {
     2|     for (var i = 0; i < ary.length; ++i) {
     3|         var part = ary[i];
     4|         if (part === '.') {
     5|             ary.splice(i, 1);
     6|             i -= 1;
     7|         }
     8|         else if (part === '..') {
     9|             if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
    10|                 continue;
    11|             }
    12|             else if (i > 0) {
    13|                 ary.splice(i - 1, 2);
    14|                 i -= 2;
    15|             }
    16|         }
    17|     }
    18| }
    19| function relativeToFile(name, file) {
    20|     var fileParts = file && file.split('/');
    21|     var nameParts = name.trim().split('/');
    22|     if (nameParts[0].charAt(0) === '.' && fileParts) {
    23|         var normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    24|         nameParts.unshift.apply(nameParts, normalizedBaseParts);
    25|     }
    26|     trimDots(nameParts);
    27|     return nameParts.join('/');
    28| }
    29| function join(path1, path2) {
    30|     if (!path1) {
    31|         return path2;
    32|     }
    33|     if (!path2) {
    34|         return path1;
    35|     }
    36|     var schemeMatch = path1.match(/^([^/]*?:)\//);
    37|     var scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    38|     path1 = path1.substr(scheme.length);
    39|     var urlPrefix;
    40|     if (path1.indexOf('///') === 0 && scheme === 'file:') {
    41|         urlPrefix = '///';
    42|     }
    43|     else if (path1.indexOf('//') === 0) {
    44|         urlPrefix = '//';
    45|     }
    46|     else if (path1.indexOf('/') === 0) {
    47|         urlPrefix = '/';
    48|     }
    49|     else {
    50|         urlPrefix = '';
    51|     }
    52|     var trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    53|     var url1 = path1.split('/');
    54|     var url2 = path2.split('/');
    55|     var url3 = [];
    56|     for (var i = 0, ii = url1.length; i < ii; ++i) {
    57|         if (url1[i] === '..') {
    58|             if (url3.length && url3[url3.length - 1] !== '..') {
    59|                 url3.pop();
    60|             }
    61|             else {
    62|                 url3.push(url1[i]);
    63|             }
    64|         }
    65|         else if (url1[i] === '.' || url1[i] === '') {
    66|             continue;
    67|         }
    68|         else {
    69|             url3.push(url1[i]);
    70|         }
    71|     }
    72|     for (var i = 0, ii = url2.length; i < ii; ++i) {
    73|         if (url2[i] === '..') {
    74|             if (url3.length && url3[url3.length - 1] !== '..') {
    75|                 url3.pop();
    76|             }
    77|             else {
    78|                 url3.push(url2[i]);
    79|             }
    80|         }
    81|         else if (url2[i] === '.' || url2[i] === '') {
    82|             continue;
    83|         }
    84|         else {
    85|             url3.push(url2[i]);
    86|         }
    87|     }
    88|     return scheme + urlPrefix + url3.join('/') + trailingSlash;
    89| }
    90| var encode = encodeURIComponent;
    91| var encodeKey = function (k) { return encode(k).replace('%24', '$'); };
    92| function buildParam(key, value, traditional) {
    93|     var result = [];
    94|     if (value === null || value === undefined) {
    95|         return result;
    96|     }
    97|     if (Array.isArray(value)) {
    98|         for (var i = 0, l = value.length; i < l; i++) {
    99|             if (traditional) {
   100|                 result.push(encodeKey(key) + "=" + encode(value[i]));
   101|             }
   102|             else {
   103|                 var arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   104|                 result = result.concat(buildParam(arrayKey, value[i]));
   105|             }
   106|         }
   107|     }
   108|     else if (typeof (value) === 'object' && !traditional) {
   109|         for (var propertyName in value) {
   110|             result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   111|         }
   112|     }
   113|     else {
   114|         result.push(encodeKey(key) + "=" + encode(value));
   115|     }
   116|     return result;
   117| }
   118| function buildQueryString(params, traditional) {
   119|     var pairs = [];
   120|     var keys = Object.keys(params || {}).sort();
   121|     for (var i = 0, len = keys.length; i < len; i++) {
   122|         var key = keys[i];
   123|         pairs = pairs.concat(buildParam(key, params[key], traditional));
   124|     }
   125|     if (pairs.length === 0) {
   126|         return '';
   127|     }
   128|     return pairs.join('&');
   129| }
   130| function processScalarParam(existedParam, value) {
   131|     if (Array.isArray(existedParam)) {
   132|         existedParam.push(value);
   133|         return existedParam;
   134|     }
   135|     if (existedParam !== undefined) {
   136|         return [existedParam, value];
   137|     }
   138|     return value;
   139| }
   140| function parseComplexParam(queryParams, keys, value) {
   141|     var currentParams = queryParams;
   142|     var keysLastIndex = keys.length - 1;
   143|     for (var j = 0; j <= keysLastIndex; j++) {
   144|         var key = keys[j] === '' ? currentParams.length : keys[j];
   145|         preventPollution(key);
   146|         if (j < keysLastIndex) {
   147|             var prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   148|             currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1]) ? {} : []);
   149|         }
   150|         else {
   151|             currentParams = currentParams[key] = value;
   152|         }
   153|     }
   154| }
   155| function parseQueryString(queryString) {
   156|     var queryParams = {};
   157|     if (!queryString || typeof queryString !== 'string') {
   158|         return queryParams;
   159|     }
   160|     var query = queryString;
   161|     if (query.charAt(0) === '?') {
   162|         query = query.substr(1);
   163|     }
   164|     var pairs = query.replace(/\+/g, ' ').split('&');
   165|     for (var i = 0; i < pairs.length; i++) {
   166|         var pair = pairs[i].split('=');
   167|         var key = decodeURIComponent(pair[0]);
   168|         if (!key) {
   169|             continue;
   170|         }
   171|         var keys = key.split('][');
   172|         var keysLastIndex = keys.length - 1;
   173|         if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   174|             keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   175|             keys = keys.shift().split('[').concat(keys);
   176|             keysLastIndex = keys.length - 1;
   177|         }
   178|         else {
   179|             keysLastIndex = 0;
   180|         }
   181|         if (pair.length >= 2) {
   182|             var value = pair[1] ? decodeURIComponent(pair[1]) : '';
   183|             if (keysLastIndex) {
   184|                 parseComplexParam(queryParams, keys, value);
   185|             }
   186|             else {
   187|                 preventPollution(key);
   188|                 queryParams[key] = processScalarParam(queryParams[key], value);
   189|             }
   190|         }
   191|         else {
   192|             queryParams[key] = true;
   193|         }
   194|     }
   195|     return queryParams;
   196| }
   197| function preventPollution(key) {
   198|     if (key === '__proto__') {
   199|         throw new Error('Prototype pollution detected.');
   200|     }
   201| }
   202| export { buildQueryString, join, parseQueryString, relativeToFile };


# ====================================================================
# FILE: dist/system/aurelia-path.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-214 ---
     1| System.register([], function (exports) {
     2|     'use strict';
     3|     return {
     4|         execute: function () {
     5|             exports({
     6|                 buildQueryString: buildQueryString,
     7|                 join: join,
     8|                 parseQueryString: parseQueryString,
     9|                 relativeToFile: relativeToFile
    10|             });
    11|             function trimDots(ary) {
    12|                 for (var i = 0; i < ary.length; ++i) {
    13|                     var part = ary[i];
    14|                     if (part === '.') {
    15|                         ary.splice(i, 1);
    16|                         i -= 1;
    17|                     }
    18|                     else if (part === '..') {
    19|                         if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
    20|                             continue;
    21|                         }
    22|                         else if (i > 0) {
    23|                             ary.splice(i - 1, 2);
    24|                             i -= 2;
    25|                         }
    26|                     }
    27|                 }
    28|             }
    29|             function relativeToFile(name, file) {
    30|                 var fileParts = file && file.split('/');
    31|                 var nameParts = name.trim().split('/');
    32|                 if (nameParts[0].charAt(0) === '.' && fileParts) {
    33|                     var normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    34|                     nameParts.unshift.apply(nameParts, normalizedBaseParts);
    35|                 }
    36|                 trimDots(nameParts);
    37|                 return nameParts.join('/');
    38|             }
    39|             function join(path1, path2) {
    40|                 if (!path1) {
    41|                     return path2;
    42|                 }
    43|                 if (!path2) {
    44|                     return path1;
    45|                 }
    46|                 var schemeMatch = path1.match(/^([^/]*?:)\//);
    47|                 var scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    48|                 path1 = path1.substr(scheme.length);
    49|                 var urlPrefix;
    50|                 if (path1.indexOf('///') === 0 && scheme === 'file:') {
    51|                     urlPrefix = '///';
    52|                 }
    53|                 else if (path1.indexOf('//') === 0) {
    54|                     urlPrefix = '//';
    55|                 }
    56|                 else if (path1.indexOf('/') === 0) {
    57|                     urlPrefix = '/';
    58|                 }
    59|                 else {
    60|                     urlPrefix = '';
    61|                 }
    62|                 var trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    63|                 var url1 = path1.split('/');
    64|                 var url2 = path2.split('/');
    65|                 var url3 = [];
    66|                 for (var i = 0, ii = url1.length; i < ii; ++i) {
    67|                     if (url1[i] === '..') {
    68|                         if (url3.length && url3[url3.length - 1] !== '..') {
    69|                             url3.pop();
    70|                         }
    71|                         else {
    72|                             url3.push(url1[i]);
    73|                         }
    74|                     }
    75|                     else if (url1[i] === '.' || url1[i] === '') {
    76|                         continue;
    77|                     }
    78|                     else {
    79|                         url3.push(url1[i]);
    80|                     }
    81|                 }
    82|                 for (var i = 0, ii = url2.length; i < ii; ++i) {
    83|                     if (url2[i] === '..') {
    84|                         if (url3.length && url3[url3.length - 1] !== '..') {
    85|                             url3.pop();
    86|                         }
    87|                         else {
    88|                             url3.push(url2[i]);
    89|                         }
    90|                     }
    91|                     else if (url2[i] === '.' || url2[i] === '') {
    92|                         continue;
    93|                     }
    94|                     else {
    95|                         url3.push(url2[i]);
    96|                     }
    97|                 }
    98|                 return scheme + urlPrefix + url3.join('/') + trailingSlash;
    99|             }
   100|             var encode = encodeURIComponent;
   101|             var encodeKey = function (k) { return encode(k).replace('%24', '$'); };
   102|             function buildParam(key, value, traditional) {
   103|                 var result = [];
   104|                 if (value === null || value === undefined) {
   105|                     return result;
   106|                 }
   107|                 if (Array.isArray(value)) {
   108|                     for (var i = 0, l = value.length; i < l; i++) {
   109|                         if (traditional) {
   110|                             result.push(encodeKey(key) + "=" + encode(value[i]));
   111|                         }
   112|                         else {
   113|                             var arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   114|                             result = result.concat(buildParam(arrayKey, value[i]));
   115|                         }
   116|                     }
   117|                 }
   118|                 else if (typeof (value) === 'object' && !traditional) {
   119|                     for (var propertyName in value) {
   120|                         result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   121|                     }
   122|                 }
   123|                 else {
   124|                     result.push(encodeKey(key) + "=" + encode(value));
   125|                 }
   126|                 return result;
   127|             }
   128|             function buildQueryString(params, traditional) {
   129|                 var pairs = [];
   130|                 var keys = Object.keys(params || {}).sort();
   131|                 for (var i = 0, len = keys.length; i < len; i++) {
   132|                     var key = keys[i];
   133|                     pairs = pairs.concat(buildParam(key, params[key], traditional));
   134|                 }
   135|                 if (pairs.length === 0) {
   136|                     return '';
   137|                 }
   138|                 return pairs.join('&');
   139|             }
   140|             function processScalarParam(existedParam, value) {
   141|                 if (Array.isArray(existedParam)) {
   142|                     existedParam.push(value);
   143|                     return existedParam;
   144|                 }
   145|                 if (existedParam !== undefined) {
   146|                     return [existedParam, value];
   147|                 }
   148|                 return value;
   149|             }
   150|             function parseComplexParam(queryParams, keys, value) {
   151|                 var currentParams = queryParams;
   152|                 var keysLastIndex = keys.length - 1;
   153|                 for (var j = 0; j <= keysLastIndex; j++) {
   154|                     var key = keys[j] === '' ? currentParams.length : keys[j];
   155|                     preventPollution(key);
   156|                     if (j < keysLastIndex) {
   157|                         var prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   158|                         currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1]) ? {} : []);
   159|                     }
   160|                     else {
   161|                         currentParams = currentParams[key] = value;
   162|                     }
   163|                 }
   164|             }
   165|             function parseQueryString(queryString) {
   166|                 var queryParams = {};
   167|                 if (!queryString || typeof queryString !== 'string') {
   168|                     return queryParams;
   169|                 }
   170|                 var query = queryString;
   171|                 if (query.charAt(0) === '?') {
   172|                     query = query.substr(1);
   173|                 }
   174|                 var pairs = query.replace(/\+/g, ' ').split('&');
   175|                 for (var i = 0; i < pairs.length; i++) {
   176|                     var pair = pairs[i].split('=');
   177|                     var key = decodeURIComponent(pair[0]);
   178|                     if (!key) {
   179|                         continue;
   180|                     }
   181|                     var keys = key.split('][');
   182|                     var keysLastIndex = keys.length - 1;
   183|                     if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   184|                         keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   185|                         keys = keys.shift().split('[').concat(keys);
   186|                         keysLastIndex = keys.length - 1;
   187|                     }
   188|                     else {
   189|                         keysLastIndex = 0;
   190|                     }
   191|                     if (pair.length >= 2) {
   192|                         var value = pair[1] ? decodeURIComponent(pair[1]) : '';
   193|                         if (keysLastIndex) {
   194|                             parseComplexParam(queryParams, keys, value);
   195|                         }
   196|                         else {
   197|                             preventPollution(key);
   198|                             queryParams[key] = processScalarParam(queryParams[key], value);
   199|                         }
   200|                     }
   201|                     else {
   202|                         queryParams[key] = true;
   203|                     }
   204|                 }
   205|                 return queryParams;
   206|             }
   207|             function preventPollution(key) {
   208|                 if (key === '__proto__') {
   209|                     throw new Error('Prototype pollution detected.');
   210|                 }
   211|             }
   212|         }
   213|     };
   214| });


# ====================================================================
# FILE: dist/types/index.d.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-4 ---
     1| export declare function relativeToFile(name: string, file: string): string;
     2| export declare function join(path1: string, path2: string): string;
     3| export declare function buildQueryString(params?: Object, traditional?: boolean): string;
     4| export declare function parseQueryString(queryString: string): Object;


# ====================================================================
# FILE: gulpfile.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-71 ---
     1| const gulp = require('gulp');
     2| const bump = require('gulp-bump');
     3| const conventionalChangelog = require('gulp-conventional-changelog');
     4| const yargs = require('yargs');
     5| const fs = require('fs');
     6| const path = require('path');
     7| const exec = require('child_process').exec;
     8| const promisify = require('util').promisify;
     9| const DIR_DOC = './doc';
    10| const FILE_DOC = path.resolve(DIR_DOC, 'CHANGELOG.md');
    11| /**@type {{ bump: 'major' | 'minor' | 'patch' | 'prerelease' }}
    12| const argv = yargs.argv;
    13| const validBumpTypes = "major|minor|patch|prerelease".split("|");
    14| const bumpType = (argv.bump || 'patch').toLowerCase();
    15| if(validBumpTypes.indexOf(bumpType) === -1) {
    16|   throw new Error('Unrecognized bump "' + bumpType + '".');
    17| }
    18| gulp.task('build', async () => {
    19|   const { stderr: err1, stdout: out1 } = await promisify(exec)('npm run build');
    20|   if (err1) {
    21|     console.log('==== build warning ====');
    22|     console.log(err1);
    23|   }
    24|   console.log('==== build output ====');
    25|   console.log(out1);
    26| });
    27| gulp.task('lint', async () => {
    28|   const { stderr: err2, stdout: out2 } = await promisify(exec)('npm run lint');
    29|   if (err2) {
    30|     console.log('==== lint warning ====');
    31|     console.log(err2);
    32|   }
    33|   console.log('==== lint output ====');
    34|   console.log(out2);
    35| });
    36| gulp.task('doc', async () => {
    37|   const { stderr, stdout } = await promisify(exec)('npm run doc');
    38|   if (stderr) {
    39|     console.log('==== doc warning ====');
    40|     console.log(stderr);
    41|   }
    42|   try {
    43|     const content = fs.readFileSync(DIR_DOC + '/api.json', { encoding: 'utf-8' });
    44|     fs.writeFileSync(path.resolve(DIR_DOC, 'api.json'), JSON.stringify(JSON.parse(content)));
    45|   } finally {}
    46|   console.log('==== doc output ====');
    47|   console.log(stdout);
    48| });
    49| gulp.task('changelog', function () {
    50|   return gulp
    51|     .src(FILE_DOC)
    52|     .pipe(conventionalChangelog({}))
    53|     .pipe(gulp.dest(DIR_DOC));
    54| });
    55| gulp.task('bump-version', function () {
    56|   return gulp.src(['./package.json', './bower.json'])
    57|     .pipe(bump({ type: bumpType }))
    58|     .pipe(gulp.dest('./'));
    59| });
    60| gulp.task(
    61|   'prepare-release',
    62|   gulp.series(
    63|     'build',
    64|     'lint',
    65|     gulp.parallel(
    66|       'doc',
    67|       'bump-version',
    68|       'changelog'
    69|     )
    70|   )
    71| );


# ====================================================================
# FILE: rollup.config.js
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-57 ---
     1| import typescript from '@rollup/plugin-typescript';
     2| const name = require('./package.json').name;
     3| /**
     4|  * @type {import('rollup').RollupOptions[]}
     5|  */
     6| const rollupOptions = [
     7|   {
     8|     input: 'src/index.ts',
     9|     output: [
    10|       {
    11|         file: `dist/es2015/${name}.js`,
    12|         format: 'es',
    13|         sourcemap: true,
    14|       },
    15|     ],
    16|     plugins: [
    17|       typescript({
    18|         removeComments: true,
    19|         sourceMap: true,
    20|       })
    21|     ]
    22|   },
    23|   {
    24|     input: 'src/index.ts',
    25|     output: [
    26|       {
    27|         file: `dist/native-modules/${name}.js`,
    28|         format: 'es',
    29|         sourcemap: true,
    30|       },
    31|       {
    32|         file: `dist/amd/${name}.js`,
    33|         format: 'amd',
    34|         name: name,
    35|         sourcemap: true,
    36|       },
    37|       {
    38|         file: `dist/commonjs/${name}.js`,
    39|         format: 'cjs',
    40|         sourcemap: true,
    41|       },
    42|       {
    43|         file: `dist/system/${name}.js`,
    44|         format: 'system',
    45|         sourcemap: true,
    46|       }
    47|     ],
    48|     plugins: [
    49|       typescript({
    50|         target: 'es5',
    51|         removeComments: true,
    52|         sourceMap: true,
    53|       })
    54|     ]
    55|   }
    56| ];
    57| export default rollupOptions;


# ====================================================================
# FILE: src/index.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-234 ---
     1| function trimDots(ary: string[]): void {
     2|   for (let i = 0; i < ary.length; ++i) {
     3|     let part = ary[i];
     4|     if (part === '.') {
     5|       ary.splice(i, 1);
     6|       i -= 1;
     7|     } else if (part === '..') {
     8|       if (i === 0 || (i === 1 && ary[2] === '..') || ary[i - 1] === '..') {
     9|         continue;
    10|       } else if (i > 0) {
    11|         ary.splice(i - 1, 2);
    12|         i -= 2;
    13|       }
    14|     }
    15|   }
    16| }
    17| /**
    18| * Calculates a path relative to a file.
    19| *
    20| * @param name The relative path.
    21| * @param file The file path.
    22| * @return The calculated path.
    23| */
    24| export function relativeToFile(name: string, file: string): string {
    25|   let fileParts = file && file.split('/');
    26|   let nameParts = name.trim().split('/');
    27|   if (nameParts[0].charAt(0) === '.' && fileParts) {
    28|     let normalizedBaseParts = fileParts.slice(0, fileParts.length - 1);
    29|     nameParts.unshift(...normalizedBaseParts);
    30|   }
    31|   trimDots(nameParts);
    32|   return nameParts.join('/');
    33| }
    34| /**
    35| * Joins two paths.
    36| *
    37| * @param path1 The first path.
    38| * @param path2 The second path.
    39| * @return The joined path.
    40| */
    41| export function join(path1: string, path2: string): string {
    42|   if (!path1) {
    43|     return path2;
    44|   }
    45|   if (!path2) {
    46|     return path1;
    47|   }
    48|   let schemeMatch = path1.match(/^([^/]*?:)\//);
    49|   let scheme = (schemeMatch && schemeMatch.length > 0) ? schemeMatch[1] : '';
    50|   path1 = path1.substr(scheme.length);
    51|   let urlPrefix;
    52|   if (path1.indexOf('///') === 0 && scheme === 'file:') {
    53|     urlPrefix = '///';
    54|   } else if (path1.indexOf('//') === 0) {
    55|     urlPrefix = '//';
    56|   } else if (path1.indexOf('/') === 0) {
    57|     urlPrefix = '/';
    58|   } else {
    59|     urlPrefix = '';
    60|   }
    61|   let trailingSlash = path2.slice(-1) === '/' ? '/' : '';
    62|   let url1 = path1.split('/');
    63|   let url2 = path2.split('/');
    64|   let url3 = [];
    65|   for (let i = 0, ii = url1.length; i < ii; ++i) {
    66|     if (url1[i] === '..') {
    67|       if (url3.length && url3[url3.length - 1] !== '..') {
    68|         url3.pop();
    69|       } else {
    70|         url3.push(url1[i]);
    71|       }
    72|     } else if (url1[i] === '.' || url1[i] === '') {
    73|       continue;
    74|     } else {
    75|       url3.push(url1[i]);
    76|     }
    77|   }
    78|   for (let i = 0, ii = url2.length; i < ii; ++i) {
    79|     if (url2[i] === '..') {
    80|       if (url3.length && url3[url3.length - 1] !== '..') {
    81|         url3.pop();
    82|       } else {
    83|         url3.push(url2[i]);
    84|       }
    85|     } else if (url2[i] === '.' || url2[i] === '') {
    86|       continue;
    87|     } else {
    88|       url3.push(url2[i]);
    89|     }
    90|   }
    91|   return scheme + urlPrefix + url3.join('/') + trailingSlash;
    92| }
    93| let encode = encodeURIComponent;
    94| let encodeKey = k => encode(k).replace('%24', '$');
    95| /**
    96| * Recursively builds part of query string for parameter.
    97| *
    98| * @param key Parameter name for query string.
    99| * @param value Parameter value to deserialize.
   100| * @param traditional Boolean Use the old URI template standard (RFC6570)
   101| * @return Array with serialized parameter(s)
   102| */
   103| function buildParam(key: string, value: any, traditional?: boolean): Array<string> {
   104|   let result = [];
   105|   if (value === null || value === undefined) {
   106|     return result;
   107|   }
   108|   if (Array.isArray(value)) {
   109|     for (let i = 0, l = value.length; i < l; i++) {
   110|       if (traditional) {
   111|         result.push(`${encodeKey(key)}=${encode(value[i])}`);
   112|       } else {
   113|         let arrayKey = key + '[' + (typeof value[i] === 'object' && value[i] !== null ? i : '') + ']';
   114|         result = result.concat(buildParam(arrayKey, value[i]));
   115|       }
   116|     }
   117|   } else if (typeof (value) === 'object' && !traditional) {
   118|     for (let propertyName in value) {
   119|       result = result.concat(buildParam(key + '[' + propertyName + ']', value[propertyName]));
   120|     }
   121|   } else {
   122|     result.push(`${encodeKey(key) }=${encode(value) }`);
   123|   }
   124|   return result;
   125| }
   126| /**
   127| * Generate a query string from an object.
   128| *
   129| * @param params Object containing the keys and values to be used.
   130| * @param traditional Boolean Use the old URI template standard (RFC6570)
   131| * @returns The generated query string, excluding leading '?'.
   132| */
   133| export function buildQueryString(params?: Object, traditional?: boolean): string {
   134|   let pairs = [];
   135|   let keys = Object.keys(params || {}).sort();
   136|   for (let i = 0, len = keys.length; i < len; i++) {
   137|     let key = keys[i];
   138|     pairs = pairs.concat(buildParam(key, params[key], traditional));
   139|   }
   140|   if (pairs.length === 0) {
   141|     return '';
   142|   }
   143|   return pairs.join('&');
   144| }
   145| /**
   146| * Process parameter that was recognized as scalar param (primitive value or shallow array).
   147| *
   148| * @param existedParam Object with previously parsed values for specified key.
   149| * @param value Parameter value to append.
   150| * @returns Initial primitive value or transformed existedParam if parameter was recognized as an array.
   151| */
   152| function processScalarParam(existedParam: Object, value: Object): Object {
   153|   if (Array.isArray(existedParam)) {
   154|     existedParam.push(value);
   155|     return existedParam;
   156|   }
   157|   if (existedParam !== undefined) {
   158|     return [existedParam, value];
   159|   }
   160|   return value;
   161| }
   162| /**
   163| * Sequentially process parameter that was recognized as complex value (object or array).
   164| * For each keys part, if the current level is undefined create an
   165| *   object or array based on the type of the next keys part.
   166| *
   167| * @param queryParams root-level result object.
   168| * @param keys Collection of keys related to this parameter.
   169| * @param value Parameter value to append.
   170| */
   171| function parseComplexParam(queryParams: Object, keys: (string | number)[], value: any): void {
   172|   let currentParams = queryParams;
   173|   let keysLastIndex = keys.length - 1;
   174|   for (let j = 0; j <= keysLastIndex; j++) {
   175|     let key = keys[j] === '' ? (currentParams as any).length : keys[j];
   176|     preventPollution(key);
   177|     if (j < keysLastIndex) {
   178|       let prevValue = !currentParams[key] || typeof currentParams[key] === 'object' ? currentParams[key] : [currentParams[key]];
   179|       currentParams = currentParams[key] = prevValue || (isNaN(keys[j + 1] as number) ? {} : []);
   180|     } else {
   181|       currentParams = currentParams[key] = value;
   182|     }
   183|   }
   184| }
   185| /**
   186| * Parse a query string.
   187| *
   188| * @param queryString The query string to parse.
   189| * @returns Object with keys and values mapped from the query string.
   190| */
   191| export function parseQueryString(queryString: string): Object {
   192|   let queryParams = {};
   193|   if (!queryString || typeof queryString !== 'string') {
   194|     return queryParams;
   195|   }
   196|   let query = queryString;
   197|   if (query.charAt(0) === '?') {
   198|     query = query.substr(1);
   199|   }
   200|   let pairs = query.replace(/\+/g, ' ').split('&');
   201|   for (let i = 0; i < pairs.length; i++) {
   202|     let pair = pairs[i].split('=');
   203|     let key = decodeURIComponent(pair[0]);
   204|     if (!key) {
   205|       continue;
   206|     }
   207|     let keys = key.split('][');
   208|     let keysLastIndex = keys.length - 1;
   209|     if (/\[/.test(keys[0]) && /\]$/.test(keys[keysLastIndex])) {
   210|       keys[keysLastIndex] = keys[keysLastIndex].replace(/\]$/, '');
   211|       keys = keys.shift().split('[').concat(keys);
   212|       keysLastIndex = keys.length - 1;
   213|     } else {
   214|       keysLastIndex = 0;
   215|     }
   216|     if (pair.length >= 2) {
   217|       let value = pair[1] ? decodeURIComponent(pair[1]) : '';
   218|       if (keysLastIndex) {
   219|         parseComplexParam(queryParams, keys, value);
   220|       } else {
   221|         preventPollution(key);
   222|         queryParams[key] = processScalarParam(queryParams[key], value);
   223|       }
   224|     } else {
   225|       queryParams[key] = true;
   226|     }
   227|   }
   228|   return queryParams;
   229| }
   230| function preventPollution(key: string) {
   231|   if (key === '__proto__') {
   232|     throw new Error('Prototype pollution detected.');
   233|   }
   234| }

