# ====================================================================
# FILE: packages/grafana-data/src/text/index.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-11 ---
     1| export * from './string';
     2| export * from './markdown';
     3| export * from './text';
     4| import { escapeHtml, hasAnsiCodes, sanitize, sanitizeUrl, sanitizeAngularInterpolation } from './sanitize';
     5| export const textUtil = {
     6|   escapeHtml,
     7|   hasAnsiCodes,
     8|   sanitize,
     9|   sanitizeUrl,
    10|   sanitizeAngularInterpolation,
    11| };


# ====================================================================
# FILE: packages/grafana-data/src/text/sanitize.ts
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-36 ---
     1| import xss from 'xss';
     2| import { sanitizeUrl as braintreeSanitizeUrl } from '@braintree/sanitize-url';
     3| const XSSWL = Object.keys(xss.whiteList).reduce((acc, element) => {
     4|   acc[element] = xss.whiteList[element].concat(['class', 'style']);
     5|   return acc;
     6| }, {});
     7| const sanitizeXSS = new xss.FilterXSS({
     8|   whiteList: XSSWL,
     9| });
    10| /**
    11|  * Returns string safe from XSS attacks.
    12|  *
    13|  * Even though we allow the style-attribute, there's still default filtering applied to it
    14|  * Info: https://github.com/leizongmin/js-xss#customize-css-filter
    15|  * Whitelist: https://github.com/leizongmin/js-css-filter/blob/master/lib/default.js
    16|  */
    17| export function sanitize(unsanitizedString: string): string {
    18|   try {
    19|     return sanitizeXSS.process(unsanitizedString);
    20|   } catch (error) {
    21|     console.error('String could not be sanitized', unsanitizedString);
    22|     return unsanitizedString;
    23|   }
    24| }
    25| export function sanitizeUrl(url: string): string {
    26|   return braintreeSanitizeUrl(url);
    27| }
    28| export function hasAnsiCodes(input: string): boolean {
    29|   return /\u001b\[\d{1,2}m/.test(input);
    30| }
    31| export function escapeHtml(str: string): string {
    32|   return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    33| }
    34| export function sanitizeAngularInterpolation(url: string): string {
    35|   return url.replace(/\{\{/g, '%7B%7B').replace(/\}\}/g, '%7D%7D');
    36| }


# ====================================================================
# FILE: public/app/core/components/NavBar/DropdownChild.tsx
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-53 ---
     1| import React from 'react';
     2| import { css } from '@emotion/css';
     3| import { GrafanaTheme2, textUtil } from '@grafana/data';
     4| import { Icon, IconName, Link, useTheme2 } from '@grafana/ui';
     5| export interface Props {
     6|   isDivider?: boolean;
     7|   icon?: IconName;
     8|   onClick?: () => void;
     9|   target?: HTMLAnchorElement['target'];
    10|   text: string;
    11|   url?: string;
    12| }
    13| const DropdownChild = ({ isDivider = false, icon, onClick, target, text, url }: Props) => {
    14|   const theme = useTheme2();
    15|   const styles = getStyles(theme);
    16|   const linkContent = (
    17|     <>
    18|       {icon && <Icon data-testid="dropdown-child-icon" name={icon} className={styles.icon} />}
    19|       {text}
    20|     </>
    21|   );
    22|   let element = (
    23|     <button className={styles.element} onClick={onClick}>
    24|       {linkContent}
    25|     </button>
    26|   );
    27|   if (url) {
    28|     const sanitizedUrl = textUtil.sanitizeAngularInterpolation(url);
    29|     element =
    30|       !target && url.startsWith('/') ? (
    31|         <Link className={styles.element} onClick={onClick} href={sanitizedUrl}>
    32|           {linkContent}
    33|         </Link>
    34|       ) : (
    35|         <a className={styles.element} href={sanitizedUrl} target={target} rel="noopener" onClick={onClick}>
    36|           {linkContent}
    37|         </a>
    38|       );
    39|   }
    40|   return isDivider ? <li data-testid="dropdown-child-divider" className="divider" /> : <li>{element}</li>;
    41| };
    42| export default DropdownChild;
    43| const getStyles = (theme: GrafanaTheme2) => ({
    44|   element: css`
    45|     background-color: transparent;
    46|     border: none;
    47|     display: flex;
    48|     width: 100%;
    49|   `,
    50|   icon: css`
    51|     margin-right: ${theme.spacing(1)};
    52|   `,
    53| });


# ====================================================================
# FILE: public/app/core/components/NavBar/NavBarItem.tsx
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-143 ---
     1| import React, { ReactNode } from 'react';
     2| import { css, cx } from '@emotion/css';
     3| import { GrafanaTheme2, NavModelItem, textUtil } from '@grafana/data';
     4| import { Link, useTheme2 } from '@grafana/ui';
     5| import NavBarDropdown from './NavBarDropdown';
     6| export interface Props {
     7|   isActive?: boolean;
     8|   children: ReactNode;
     9|   label: string;
    10|   menuItems?: NavModelItem[];
    11|   menuSubTitle?: string;
    12|   onClick?: () => void;
    13|   reverseMenuDirection?: boolean;
    14|   target?: HTMLAnchorElement['target'];
    15|   url?: string;
    16| }
    17| const NavBarItem = ({
    18|   isActive = false,
    19|   children,
    20|   label,
    21|   menuItems = [],
    22|   menuSubTitle,
    23|   onClick,
    24|   reverseMenuDirection = false,
    25|   target,
    26|   url,
    27| }: Props) => {
    28|   const theme = useTheme2();
    29|   const styles = getStyles(theme, isActive);
    30|   let element = (
    31|     <button className={styles.element} onClick={onClick} aria-label={label}>
    32|       <span className={styles.icon}>{children}</span>
    33|     </button>
    34|   );
    35|   const sanitizedUrl = textUtil.sanitizeAngularInterpolation(url ?? '');
    36|   if (url) {
    37|     element =
    38|       !target && sanitizedUrl.startsWith('/') ? (
    39|         <Link
    40|           className={styles.element}
    41|           href={sanitizedUrl}
    42|           target={target}
    43|           aria-label={label}
    44|           onClick={onClick}
    45|           aria-haspopup="true"
    46|         >
    47|           <span className={styles.icon}>{children}</span>
    48|         </Link>
    49|       ) : (
    50|         <a href={sanitizedUrl} target={target} className={styles.element} onClick={onClick} aria-label={label}>
    51|           <span className={styles.icon}>{children}</span>
    52|         </a>
    53|       );
    54|   }
    55|   return (
    56|     <div className={cx(styles.container, 'dropdown', { dropup: reverseMenuDirection })}>
    57|       {element}
    58|       <NavBarDropdown
    59|         headerTarget={target}
    60|         headerText={label}
    61|         headerUrl={sanitizedUrl}
    62|         items={menuItems}
    63|         onHeaderClick={onClick}
    64|         reverseDirection={reverseMenuDirection}
    65|         subtitleText={menuSubTitle}
    66|       />
    67|     </div>
    68|   );
    69| };
    70| export default NavBarItem;
    71| const getStyles = (theme: GrafanaTheme2, isActive: Props['isActive']) => ({
    72|   container: css`
    73|     position: relative;
    74|     @keyframes dropdown-anim {
    75|       0% {
    76|         opacity: 0;
    77|       }
    78|       100% {
    79|         opacity: 1;
    80|       }
    81|     }
    82|     ${theme.breakpoints.up('md')} {
    83|       color: ${isActive ? theme.colors.text.primary : theme.colors.text.secondary};
    84|       &:hover {
    85|         background-color: ${theme.colors.action.hover};
    86|         color: ${theme.colors.text.primary};
    87|         .dropdown-menu {
    88|           animation: dropdown-anim 150ms ease-in-out 100ms forwards;
    89|           border: none;
    90|           display: flex;
    91|           left: ${theme.components.sidemenu.width - 1}px;
    92|           margin: 0;
    93|           opacity: 0;
    94|           top: 0;
    95|           z-index: ${theme.zIndex.sidemenu};
    96|         }
    97|         &.dropup .dropdown-menu {
    98|           top: auto;
    99|         }
   100|       }
   101|     }
   102|   `,
   103|   element: css`
   104|     background-color: transparent;
   105|     border: none;
   106|     color: inherit;
   107|     display: block;
   108|     line-height: 42px;
   109|     text-align: center;
   110|     width: ${theme.components.sidemenu.width - 1}px;
   111|     &::before {
   112|       display: ${isActive ? 'block' : 'none'};
   113|       content: ' ';
   114|       position: absolute;
   115|       left: 0;
   116|       top: 0;
   117|       bottom: 0;
   118|       width: 4px;
   119|       border-radius: 2px;
   120|       background-image: ${theme.colors.gradients.brandVertical};
   121|     }
   122|     &:focus-visible {
   123|       background-color: ${theme.colors.action.hover};
   124|       box-shadow: none;
   125|       color: ${theme.colors.text.primary};
   126|       outline: 2px solid ${theme.colors.primary.main};
   127|       outline-offset: -2px;
   128|       transition: none;
   129|     }
   130|     .sidemenu-open--xs & {
   131|       display: none;
   132|     }
   133|   `,
   134|   icon: css`
   135|     height: 100%;
   136|     width: 100%;
   137|     img {
   138|       border-radius: 50%;
   139|       height: 28px;
   140|       width: 28px;
   141|     }
   142|   `,
   143| });

