# ====================================================================
# FILE: src/pretalx/__init__.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1 ---
     1| __version__ = "2.3.2"


# ====================================================================
# FILE: src/pretalx/agenda/management/commands/export_schedule_html.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 66-124 ---
    66|     yield from schedule_version_urls(event)
    67|     yield event.urls.featured
    68|     yield event.urls.talks
    69|     yield from event_talk_urls(event)
    70|     yield event.urls.speakers
    71|     yield from event_speaker_urls(event)
    72|     yield from event_exporter_urls(event)
    73|     yield event.urls.changelog
    74|     yield event.urls.feed
    75| def get_path(url):
    76|     return urllib.parse.urlparse(url).path
    77| def get_content(response):
    78|     return (
    79|         b"".join(response.streaming_content) if response.streaming else response.content
    80|     )
    81| def dump_content(destination, path, getter):
    82|     logging.debug(path)
    83|     content = getter(path)
    84|     if path.endswith("/"):
    85|         path = path + "index.html"
    86|     path = (Path(destination) / path.lstrip("/")).resolve()
    87|     if not Path(destination) in path.parents:
    88|         raise CommandError("Path traversal detected, aborting.")
    89|     path.parent.mkdir(parents=True, exist_ok=True)
    90|     with open(path, "wb") as f:
    91|         f.write(content)
    92|     return content
    93| def get_mediastatic_content(url):
    94|     if url.startswith(settings.STATIC_URL):
    95|         local_path = settings.STATIC_ROOT / url[len(settings.STATIC_URL) :]
    96|     elif url.startswith(settings.MEDIA_URL):
    97|         local_path = settings.MEDIA_ROOT / url[len(settings.MEDIA_URL) :]
    98|     else:
    99|         raise FileNotFoundError()
   100|     local_path = local_path.resolve(strict=True)
   101|     if not any(
   102|         path in local_path.parents
   103|         for path in (settings.MEDIA_ROOT, settings.STATIC_ROOT)
   104|     ):
   105|         raise FileNotFoundError()
   106|     with open(local_path, "rb") as f:
   107|         return f.read()
   108| def export_event(event, destination):
   109|     with override_settings(
   110|         COMPRESS_ENABLED=True, COMPRESS_OFFLINE=True
   111|     ), override_timezone(event.timezone):
   112|         with fake_admin(event) as get:
   113|             logging.info("Collecting URLs for export")
   114|             urls = [*event_urls(event)]
   115|             assets = set()
   116|             logging.info(f"Exporting {len(urls)} pages")
   117|             for url in map(get_path, urls):
   118|                 content = dump_content(destination, url, get)
   119|                 assets |= set(map(get_path, find_assets(content)))
   120|             css_assets = set()
   121|             logging.info(f"Exporting {len(assets)} static files from HTML links")
   122|             for url in assets:
   123|                 content = dump_content(destination, url, get)
   124|                 if url.endswith(".css"):

