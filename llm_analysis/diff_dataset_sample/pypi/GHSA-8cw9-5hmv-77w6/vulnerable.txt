# ====================================================================
# FILE: sanic/__version__.py
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-1 ---
     1| __version__ = "20.12.6"


# ====================================================================
# FILE: sanic/static.py
# Total hunks: 2
# ====================================================================
# --- HUNK 1: Lines 1-59 ---
     1| from functools import partial, wraps
     2| from mimetypes import guess_type
     3| from os import path
     4| from re import sub
     5| from time import gmtime, strftime
     6| from urllib.parse import unquote
     7| from sanic.compat import stat_async
     8| from sanic.exceptions import (
     9|     ContentRangeError,
    10|     FileNotFound,
    11|     HeaderNotFound,
    12|     InvalidUsage,
    13| )
    14| from sanic.handlers import ContentRangeHandler
    15| from sanic.log import error_logger
    16| from sanic.response import HTTPResponse, file, file_stream
    17| async def _static_request_handler(
    18|     file_or_directory,
    19|     use_modified_since,
    20|     use_content_range,
    21|     stream_large_files,
    22|     request,
    23|     content_type=None,
    24|     file_uri=None,
    25| ):
    26|     if file_uri and "../" in file_uri:
    27|         raise InvalidUsage("Invalid URL")
    28|     root_path = file_path = file_or_directory
    29|     if file_uri:
    30|         file_path = path.join(file_or_directory, sub("^[/]*", "", file_uri))
    31|     file_path = path.abspath(unquote(file_path))
    32|     if not file_path.startswith(path.abspath(unquote(root_path))):
    33|         error_logger.exception(
    34|             f"File not found: path={file_or_directory}, "
    35|             f"relative_url={file_uri}"
    36|         )
    37|         raise FileNotFound(
    38|             "File not found", path=file_or_directory, relative_url=file_uri
    39|         )
    40|     try:
    41|         headers = {}
    42|         stats = None
    43|         if use_modified_since:
    44|             stats = await stat_async(file_path)
    45|             modified_since = strftime(
    46|                 "%a, %d %b %Y %H:%M:%S GMT", gmtime(stats.st_mtime)
    47|             )
    48|             if request.headers.get("If-Modified-Since") == modified_since:
    49|                 return HTTPResponse(status=304)
    50|             headers["Last-Modified"] = modified_since
    51|         _range = None
    52|         if use_content_range:
    53|             _range = None
    54|             if not stats:
    55|                 stats = await stat_async(file_path)
    56|             headers["Accept-Ranges"] = "bytes"
    57|             headers["Content-Length"] = str(stats.st_size)
    58|             if request.method != "HEAD":
    59|                 try:

