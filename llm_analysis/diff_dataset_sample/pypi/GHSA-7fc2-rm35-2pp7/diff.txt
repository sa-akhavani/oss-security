--- a/IPython/core/release.py
+++ b/IPython/core/release.py
@@ -1,15 +1,15 @@
 """Release data for the IPython project."""
 name = 'ipython'
 _version_major = 3
 _version_minor = 2
-_version_patch = 3
+_version_patch = 2
 _version_extra = ''  # Uncomment this for full releases
 codename = ''
 _ver = [_version_major, _version_minor, _version_patch]
 __version__ = '.'.join(map(str, _ver))
 if _version_extra:
     __version__ = __version__ + '-' + _version_extra
 version = __version__  # backwards compatibility name
 version_info = (_version_major, _version_minor, _version_patch, _version_extra)
 kernel_protocol_version_info = (5, 0)
 kernel_protocol_version = "%i.%i" % kernel_protocol_version_info

--- a/IPython/html/static/base/js/namespace.js
+++ b/IPython/html/static/base/js/namespace.js
@@ -1,7 +1,7 @@
 var IPython = IPython || {};
 define([], function(){
     "use strict";
-    IPython.version = "3.2.3";
+    IPython.version = "3.2.2";
     IPython._target = '_blank';
     return IPython;
 });

--- a/IPython/utils/io.py
+++ b/IPython/utils/io.py
@@ -1,16 +1,15 @@
 """
 IO related utilities.
 """
 from __future__ import print_function
 from __future__ import absolute_import
-import atexit
 import codecs
 from contextlib import contextmanager
 import io
 import os
 import shutil
 import stat
 import sys
 import tempfile
 from .capture import CapturedIO, capture_output
 from .py3compat import string_types, input, PY3
@@ -44,21 +43,20 @@
         if isinstance(lines, string_types):
             lines = [lines]
         for line in lines:
             self.write(line)
     @property
     def closed(self):
         return self.stream.closed
     def close(self):
         pass
 devnull = open(os.devnull, 'w') 
-atexit.register(devnull.close)
 stdin = IOStream(sys.stdin, fallback=devnull)
 stdout = IOStream(sys.stdout, fallback=devnull)
 stderr = IOStream(sys.stderr, fallback=devnull)
 class IOTerm:
     """ Term holds the file or file-like objects for handling I/O operations.
     These are normally just sys.stdin, sys.stdout and sys.stderr but for
     Windows they can can replaced to allow editing the strings before they are
     displayed."""
     def __init__(self, stdin=None, stdout=None, stderr=None):
         mymodule = sys.modules[__name__]

--- a/IPython/utils/text.py
+++ b/IPython/utils/text.py
@@ -358,21 +358,23 @@
     --------
     ::
         In [1]: f = FullEvalFormatter()
         In [2]: f.format('{n//4}', n=8)
         Out[2]: u'2'
         In [3]: f.format('{list(range(5))[2:4]}')
         Out[3]: u'[2, 3]'
         In [4]: f.format('{3*2}')
         Out[4]: u'6'
     """
-    def vformat(self, format_string, args, kwargs):
+    def _vformat(self, format_string, args, kwargs, used_args, recursion_depth):
+        if recursion_depth < 0:
+            raise ValueError('Max string recursion exceeded')
         result = []
         for literal_text, field_name, format_spec, conversion in \
                 self.parse(format_string):
             if literal_text:
                 result.append(literal_text)
             if field_name is not None:
                 if format_spec:
                     field_name = ':'.join([field_name, format_spec])
                 obj = eval(field_name, kwargs)
                 obj = self.convert_field(obj, conversion)

--- a/docs/gh-pages.py
+++ b/docs/gh-pages.py
@@ -1,32 +1,28 @@
-from __future__ import print_function
 """Script to commit the doc build outputs into the github-pages repo.
 Use:
   gh-pages.py [tag]
 If no tag is given, the current output of 'git describe' is used.  If given,
 that is how the resulting directory will be named.
 In practice, you should use either actual clean tags from a current build or
 something like 'current' as a stable URL for the most current version of the """
+from __future__ import print_function
 import os
 import shutil
 import sys
 from os import chdir as cd
 from os.path import join as pjoin
 from subprocess import Popen, PIPE, CalledProcessError, check_call
 pages_dir = 'gh-pages'
 html_dir = 'build/html'
 pdf_dir = 'build/latex'
 pages_repo = 'git@github.com:ipython/ipython-doc.git'
-if sys.version_info[0] <= 3: 
-    getcwd = os.getcwd
-else:
-    getcwd = os.getcwdu
 def sh(cmd):
     """Execute command in a subshell, return status code."""
     return check_call(cmd, shell=True)
 def sh2(cmd):
     """Execute command in a subshell, return stdout.
     Stderr is unbuffered from the subshell.x"""
     p = Popen(cmd, stdout=PIPE, shell=True)
     out = p.communicate()[0]
     retcode = p.returncode
     if retcode:
@@ -39,48 +35,48 @@
     p = Popen(cmd, stdout=PIPE, stderr=PIPE, shell=True)
     out, err = p.communicate()
     retcode = p.returncode
     if retcode:
         raise CalledProcessError(retcode, cmd)
     else:
         return out.rstrip(), err.rstrip()
 def init_repo(path):
     """clone the gh-pages repo if we haven't already."""
     sh("git clone %s %s"%(pages_repo, path))
-    here = getcwd()
+    here = os.getcwdu()
     cd(path)
     sh('git checkout gh-pages')
     cd(here)
 if __name__ == '__main__':
     try:
         tag = sys.argv[1]
     except IndexError:
         tag = "dev"
-    startdir = getcwd()
+    startdir = os.getcwdu()
     if not os.path.exists(pages_dir):
         init_repo(pages_dir)
     else:
         cd(pages_dir)
         sh('git checkout gh-pages')
         sh('git pull')
         cd(startdir)
     dest = pjoin(pages_dir, tag)
     if tag != 'dev':
         pass
     shutil.rmtree(dest, ignore_errors=True)
     shutil.copytree(html_dir, dest)
     if tag != 'dev':
         pass
     try:
         cd(pages_dir)
         branch = sh2('git rev-parse --abbrev-ref HEAD').strip()
-        if branch != b'gh-pages':
+        if branch != 'gh-pages':
             e = 'On %r, git branch is %r, MUST be "gh-pages"' % (pages_dir,
                                                                  branch)
             raise RuntimeError(e)
         sh('git add -A %s' % tag)
         sh('git commit -m"Updated doc release: %s"' % tag)
         print()
         print('Most recent 3 commits:')
         sys.stdout.flush()
         sh('git --no-pager log --oneline HEAD~3..')
     finally:

--- a/docs/source/conf.py
+++ b/docs/source/conf.py
@@ -26,26 +26,20 @@
     extensions.remove('matplotlib.sphinxext.plot_directive')
     extensions.remove('IPython.sphinxext.ipython_directive')
     extensions.remove('IPython.sphinxext.ipython_console_highlighting')
 templates_path = ['_templates']
 source_suffix = '.rst'
 if iprelease['_version_extra'] == 'dev':
     rst_prolog = """
     .. note::
         This documentation is for a development version of IPython. There may be
         significant differences from the latest stable release.
-    """
-elif os.environ.get('ARCHIVE', None):
-    rst_prolog = """
-    .. warning::
-        This documentation is for an old version of IPython.
-        You can find docs for newer versions `here <http://ipython.readthedocs.org/en/stable/>`_.
     """
 master_doc = 'index'
 project = 'IPython'
 copyright = 'The IPython Development Team'
 github_project_url = "https://github.com/ipython/ipython"
 numpydoc_show_class_members = False # Otherwise Sphinx emits thousands of warnings
 numpydoc_class_members_toctree = False
 release = "%s" % iprelease['version']
 version = iprelease['version'].split('-', 1)[0]
 today_fmt = '%B %d, %Y'
