# ====================================================================
# FILE: docker/docker-entrypoint.sh
# Total hunks: 1
# ====================================================================
# --- HUNK 1: Lines 1-33 ---
     1| set -e
     2| start_server() {
     3| 	local base_url="${MAVEN_REPO_URL:="https://repo1.maven.org/maven2"}"
     4| 	local driver_dir="$JDBC_BRIDGE_HOME/drivers"
     5| 	local jdbc_drivers="${JDBC_DRIVERS:=""}"
     6| 	cd $JDBC_BRIDGE_HOME
     7| 	if [ "$jdbc_drivers" != "" ] && [ "$(ls -A $driver_dir)" == "" ]; then
     8| 		echo "Downloading JDBC drivers to directory [$driver_dir]..."
     9| 		for i in $(echo "$jdbc_drivers" | sed "s/,/ /g"); do
    10| 			if [ "$i" != "" ]; then
    11| 				echo "  => [$base_url/$i]..."
    12| 				wget -q -P "$driver_dir" "$base_url/$i"
    13| 			fi
    14| 		done
    15| 	fi
    16| 	if [ "$(echo ${CUSTOM_DRIVER_LOADER:="true"} | tr '[:upper:]' '[:lower:]')" != "true" ]; then
    17| 		local classpath="./clickhouse-jdbc-bridge-shaded.jar:$(echo $(ls ${DRIVER_DIR:="drivers"}/*.jar) | tr ' ' ':'):."
    18| 		java -XX:+UseContainerSupport -XX:+IdleTuningCompactOnIdle -XX:+IdleTuningGcOnIdle \
    19| 			-Xdump:none -Xdump:tool:events=systhrow+throw,filter=*OutOfMemoryError,exec="kill -9 %pid" \
    20| 			-Djava.util.logging.config.file=$JDBC_BRIDGE_HOME/logging.properties -Dnashorn.args=--language=es6 \
    21| 			${JDBC_BRIDGE_JVM_OPTS:=""} -cp $classpath ru.yandex.clickhouse.jdbcbridge.JdbcBridgeVerticle
    22| 	else
    23| 		java -XX:+UseContainerSupport -XX:+IdleTuningCompactOnIdle -XX:+IdleTuningGcOnIdle \
    24| 			-Xdump:none -Xdump:tool:events=systhrow+throw,filter=*OutOfMemoryError,exec="kill -9 %pid" \
    25| 			-Djava.util.logging.config.file=$JDBC_BRIDGE_HOME/logging.properties -Dnashorn.args=--language=es6 \
    26| 			${JDBC_BRIDGE_JVM_OPTS:=""} -jar clickhouse-jdbc-bridge-shaded.jar
    27| 	fi
    28| }
    29| if [ $# -eq 0 ]; then
    30| 	start_server
    31| else
    32| 	exec "$@"
    33| fi

